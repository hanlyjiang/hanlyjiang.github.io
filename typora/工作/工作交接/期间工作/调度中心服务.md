# 数据协同系统

## kafka

Kafka® 用于构建实时的数据管道和流式的app.它可以水平扩展，高可用，速度快，并且已经运行在数千家公司的生产环境。

![image-20210421100211467](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210421100211.png)

> https://kafka.apachecn.org/

### Apache Kafka® 是 *一个分布式流处理平台*. 这到底意味着什么呢?

我们知道流处理平台有以下三种特性:

1. 可以让你发布和订阅流式的记录。这一方面与消息队列或者企业消息系统类似。
2. 可以储存流式的记录，并且有较好的容错性。
3. 可以在流式记录产生时就进行处理。

**Kafka适合什么样的场景?**

它可以用于两大类别的应用:

1. 构造实时流数据管道，它可以在系统或应用之间可靠地获取数据。 (相当于message queue)
2. 构建实时流式应用程序，对这些流数据进行转换或者影响。 (就是流处理，通过kafka stream topic和topic之间内部进行变化)

为了理解Kafka是如何做到以上所说的功能，从下面开始，我们将深入探索Kafka的特性。.

首先是一些概念:

- Kafka作为一个集群，运行在一台或者多台服务器上.
- Kafka 通过 *topic* 对存储的流数据进行分类。
- 每条记录中包含一个key，一个value和一个timestamp（时间戳）。

Kafka有四个核心的API:

- The [Producer API](https://kafka.apachecn.org/documentation.html#producerapi) 允许一个应用程序发布一串流式的数据到一个或者多个Kafka topic。
- The [Consumer API](https://kafka.apachecn.org/documentation.html#consumerapi) 允许一个应用程序订阅一个或多个 topic ，并且对发布给他们的流式数据进行处理。
- The [Streams API](https://kafka.apachecn.org/documentation/streams) 允许一个应用程序作为一个*流处理器*，消费一个或者多个topic产生的输入流，然后生产一个输出流到一个或多个topic中去，在输入输出流中进行有效的转换。
- The [Connector API](https://kafka.apachecn.org/documentation.html#connect) 允许构建并运行可重用的生产者或者消费者，将Kafka topics连接到已存在的应用程序或者数据系统。比如，连接到一个关系型数据库，捕捉表（table）的所有变更内容。

## 配置

| 服务                                             | 变量名                                                       | 说明及示例值                                              | springboot变量名             | 说明               |
| ------------------------------------------------ | ------------------------------------------------------------ | --------------------------------------------------------- | ---------------------------- | ------------------ |
| 调度中心                                         |                                                              |                                                           |                              |                    |
| mysql                                            | MYSQL_ADDRESS                                                | 172.17.0.103:3306                                         | mysql.address                | MySQL地址          |
| MYSQL_DATABASE                                   | xxl_job                                                      | mysql.database                                            | MySQL数据库名称              |                    |
| [MYSQL_USERNAME](https://hub.docker.com/_/mysql) | root                                                         | mysql.username                                            | MySQL用户名称                |                    |
| MYSQL_PASSWORD                                   | root                                                         | mysql.password                                            | MySQL密码                    |                    |
| 数据源管理系统                                   | DB_MANAGE_URL                                                | http://172.17.0.103:8888/datasource/geo-datasource-manage | db.manage.url                | 数据源管理系统地址 |
| flink                                            | FLINK_URL                                                    | [http://172.17.0.101:8091](http://172.17.0.101:8091/)     | flink.url                    | flink访问地址      |
| redis                                            | REDIS_HOST                                                   | 172.17.0.104                                              | redis.host                   | redis访问IP        |
| REDIS_PORT                                       | 6400                                                         | redis.port                                                | redis访问端口                |                    |
| REDIS_PASSWORD                                   | redis-123456-redis                                           | redis.password                                            | redis访问密码                |                    |
| 执行器                                           |                                                              |                                                           |                              |                    |
| xxl-job                                          | XXL_JOB_ADMIN_ADDRESS                                        | http://localhost:8070/geo-job-admin                       | xxl.job.admin.addresses      | 调度中心访问路径   |
| XXL_JOB_EXECUTOR_PORT                            | 9999                                                         | xxl.job.executor.port                                     | 执行器端口号                 |                    |
| XXL_JOB_EXECUTOR_LOGPATH                         | /soft/jyf/flinkx1.11/logs/                                   | xxl.job.executor.logpath                                  | 执行器输出日志路径           |                    |
| flinkx                                           | FLINKX_JOB_EXECUTOR_JSONPATH                                 | /soft/jyf/flinkx1.11/job/                                 | flinkx.job.executor.jsonpath | flinkx任务路径     |
| FLINKX_JOB_SHELL_PATH                            | /soft/jyf/flinkx1.11/bin/start-test.sh                       | flinkx.job.shell.path                                     | flinkx启动路径               |                    |
| flink                                            | FLINK_URL                                                    | http://172.17.0.101:8091                                  | flink.url                    | flink访问地址      |
| FLINK_RUN_PATH                                   | /soft/jyf/flink-1.11.3/bin/flink                             | flink.run.path                                            | flink启动路径                |                    |
| FLINK_JAR_PATH                                   | /soft/jyf/flinkx1.11/datawarehouse_realtime_sync-1.0-SNAPSHOT.jar | flink.jar.path                                            | flink程序jar包位置           |                    |
| FLINK_JAR_CLASS                                  | cn.com.geostar.Start                                         | flink.jar.class                                           | flink程序入口类              |                    |

**建议：**

1. mysql的用户名变量保持和官方镜像一致；
2. flink部分的变量应该可以固定；

## Flink介绍

### flink官方镜像

[参考官方使用docker运行flink](https://ci.apache.org/projects/flink/flink-docs-master/docs/deployment/resource-providers/standalone/docker/)

### 介绍

**‎数据流的状态计算‎**

输入，flink，输出

![img](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210421092353.png)

> 文档参考：
>
> * 官方教程：
>   * https://ci.apache.org/projects/flink/flink-docs-master/docs/learn-flink/overview/
>   * 中文文档：https://flink.apache.org/zh/flink-architecture.html
>   * 各公司flink应用场景介绍：https://flink.apache.org/zh/poweredby.html
>     * oppo：https://mp.weixin.qq.com/s/DPLJA8Q2gDXLZF17FOcczw
>
> * 知乎专栏：https://zhuanlan.zhihu.com/p/265930684
>
> * 知乎专栏：https://zhuanlan.zhihu.com/p/130964663



## FlinkX

github地址：https://github.com/DTStack/flinkx