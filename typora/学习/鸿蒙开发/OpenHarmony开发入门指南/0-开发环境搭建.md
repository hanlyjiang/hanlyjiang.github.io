# 开发环境搭建



## 主机虚拟环境搭建

* macOS（Host主机）
* 虚拟机软件：VMWare Fusion
* Ubuntu虚拟机： 用于编译
* Windows 虚拟机：用于烧录

### 整体结构

![image-20211119104112270](https://i.loli.net/2021/11/19/C2RwuEgHk96BQNV.png)



### 虚拟机安装

虚拟机安装步骤省略

### 源码及成果物共享

源码在Ubuntu中进行下载和编译，所以我们需要源码及编译成果物共享给macOS主机及windows虚拟机。Ubuntu上需要开启samba文件共享服务。

#### macOS访问源码

直接在ubuntu中开启文件共享（samba），然后在finder中连接到服务器（**⌘+K**）连接对对应的samba服务即可。

#### windows 访问源码

关于Windows中访问Harmony源码的方式，有如下两种方式：

1. Ubuntu开启samba的文件共享服务，然后直接在Windows虚拟机中映射网络驱动器；
2. Ubuntu开启samba的文件共享服务，然后在macOS（宿主机）中连接到samba服务，映射网络驱动器；接着再通过VMWare的文件共享功能将对应的samba的网络驱动添加到共享列表中。

经过对比测试，发现第一种方式在Windows中访问Ubuntu Samba服务的文件时，速度较慢，大文件拷贝只有不超过**40M/s**（虚拟网卡都是1Gbps的）；采用了第二种方式进行源码共享时，从Windows中访问则速度较快，大文件拷贝可达到**200M/s**



## Windows环境配置

参考官方文档进行安装配置即可

## Ubuntu环境配置

参考官方文档进行安装配置即可

### 文件共享配置

对于图形界面安装的Ubuntu，可以通过图形界面开启文件共享。可参考：[Ubuntu18.04局域网共享文件夹，实现win7和Ubuntu本地访问_Ubuntu18.04局域网共享文件夹，实现win7和Ubuntu本地访问-CSDN博客](https://blog.csdn.net/a18838956649/article/details/98472707)

## 常用命令记录

### 临时文件清理

samba的文件夹挂载到macOS之后，使用Finder进行浏览时，或者使用编辑器编辑文件时，可能会产生零时文件，可以通过如下命令进行清理：

```shell
# 清理vscode 编辑过程中产生的零时文件
find . -type f -name "._*.*" -print -delete
# 清理macOS Finder 浏览目录时产生的文件
find . -type f -name "*.DS_Store" -delete -print
```

### 查找

```shell
# 查找C文件
find . -type f -name "*.c" -exec grep --color "SampleUartHostInit" {} +
```



### 清除所有文件修改

```shell
repo forall -c "git st --short -uno | sed "s/M//g" | xargs -I {} git restore {}"
# M Makefile 这种情况下会有问题
```



* 