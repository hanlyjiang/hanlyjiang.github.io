# Android相机



## 学习路径（持续更新）

* HAL 简单示例实现，理解HAL的作用，实现方式； 





### 文档

* [HIDL 接口文档  | Android 开源项目  | Android Open Source Project (google.cn)](https://source.android.google.cn/reference/hidl) ：HAL 接口描述语言 (HIDL) 指定了 HAL 与其用户之间的接口。它定义了类型和方法调用，收集到接口和包中。 HIDL 是一种用于在可独立编译的代码库之间进行通信的系统，用于进程间通信。请参阅 HIDL 指南。

## 概述

对应用层Java来说，两个类：CameraDevice和CameraManager

![ape_fwk_camera2](https://source.android.google.cn/devices/camera/images/ape_fwk_camera2.png)

**图 1.** 相机架构

- 应用框架

  应用代码位于应用框架级别，它使用 [Camera 2](https://developer.android.google.cn/reference/android/hardware/camera2/package-summary) API 与相机硬件进行互动。在内部，此代码会调用相应的 [Binder](https://developer.android.google.cn/reference/android/os/Binder.html) 接口，以访问与相机互动的原生代码。

- AIDL

  与 `CameraService` 关联的 binder 接口可在 [frameworks/av/camera/aidl/android/hardware](https://android.googlesource.com/platform/frameworks/av/+/master/camera/aidl/android/hardware/ICameraService.aidl) 中找到。生成的代码会调用较低级别的原生代码以获取对实体相机的访问权限，并返回用于在框架级别创建 [`CameraDevice`](https://developer.android.google.cn/reference/android/hardware/camera2/CameraDevice) 并最终创建 [`CameraCaptureSession`](https://developer.android.google.cn/reference/android/hardware/camera2/CameraCaptureSession.html) 对象的数据。

- 原生框架

- 

  此框架位于 `frameworks/av/` 中，并提供相当于 [`CameraDevice`](https://developer.android.google.cn/reference/android/hardware/camera2/CameraDevice) 和 [`CameraCaptureSession`](https://developer.android.google.cn/reference/android/hardware/camera2/CameraCaptureSession) 类的原生类。另请参阅 [NDK camera2 参考](https://developer.android.google.cn/ndk/reference/group/camera)。

- binder IPC 接口

  IPC binder 接口用于实现跨越进程边界的通信。调用相机服务的若干个相机 binder 类位于 `frameworks/av/camera/camera/aidl/android/hardware` 目录中。[`ICameraService`](https://android.googlesource.com/platform/frameworks/av/+/master/camera/aidl/android/hardware/ICameraService.aidl) 是相机服务的接口；[`ICameraDeviceUser`](https://android.googlesource.com/platform/frameworks/av/+/master/camera/aidl/android/hardware/camera2/ICameraDeviceUser.aidl) 是已打开的特定相机设备的接口；[`ICameraServiceListener`](https://android.googlesource.com/platform/frameworks/av/+/master/camera/aidl/android/hardware/ICameraServiceListener.aidl) 和 [`ICameraDeviceCallbacks`](https://android.googlesource.com/platform/frameworks/av/+/master/camera/aidl/android/hardware/camera2/ICameraDeviceCallbacks.aidl) 分别是对应用框架的 `CameraService` 和 `CameraDevice` 回调。

- 相机服务

  位于 `frameworks/av/services/camera/libcameraservice/CameraService.cpp` 下的相机服务是与 HAL 进行互动的实际代码。

- HAL

  硬件抽象层定义了由相机服务调用、且您必须实现以确保相机硬件正常运行的标准接口。