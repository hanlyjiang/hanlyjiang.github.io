# 虚拟机网络模式

[link](https://www.evernote.com/shard/s402/client/snv?noteGuid=df9156c2-8c4d-4e1c-8e37-c3ceef128454&noteKey=69871b799112e4ffee5ff227f41c897e&sn=https%3A%2F%2Fwww.evernote.com%2Fshard%2Fs402%2Fsh%2Fdf9156c2-8c4d-4e1c-8e37-c3ceef128454%2F69871b799112e4ffee5ff227f41c897e&title=VMware-workstation%25E8%2599%259A%25E6%258B%259F%25E6%259C%25BA%25E8%25AE%25BE%25E7%25BD%25AE%25E7%25BD%2591%25E7%25BB%259C%25E6%25A8%25A1%25E5%25BC%258F_%25E8%258B%258F%25E5%2587%25AF%25E7%259A%2584%25E5%258D%259A%25E5%25AE%25A2-CSDN%25E5%258D%259A%25E5%25AE%25A2_vmware%25E8%2599%259A%25E6%258B%259F%25E6%259C%25BA%25E7%25BD%2591%25E7%25BB%259C%25E8%25AE%25BE%25E7%25BD%25AE)

vmware为我们提供了三种网络工作模式，它们分别是：Bridged（桥接模式）、NAT（网络地址转换模式）、Host-Only（仅主机模式）。

## Bridged（桥接模式）

什么是桥接模式？桥接模式就是将主机网卡与虚拟机虚拟的网卡利用虚拟网桥进行通信。在桥接的作用下，类似于把物理主机虚拟为一个交换机，所有桥接设置的虚拟机连接到这个交换机的一个接口上，物理主机也同样插在这个交换机当中，所以所有桥接下的网卡与网卡都是交换模式的，相互可以访问而不干扰。在桥接模式下，虚拟机ip地址需要与主机在同一个网段，如果需要联网，则网关与DNS需要与主机网卡一致。其网络结构如下图所示：



![img](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20211106131234.png)

## NAT（地址转换模式）

刚刚我们说到，如果你的网络ip资源紧缺，但是你又希望你的虚拟机能够联网，这时候NAT模式是最好的选择。NAT模式借助虚拟NAT设备和虚拟DHCP服务器，使得虚拟机可以联网。其网络结构如下图所示：



![img](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20211106131256.png)

在NAT模式中，主机网卡直接与虚拟NAT设备相连，然后虚拟NAT设备与虚拟DHCP服务器一起连接在虚拟交换机VMnet8上，这样就实现了虚拟机联网。那么我们会觉得很奇怪，为什么需要虚拟网卡VMware Network Adapter VMnet8呢？原来我们的VMware Network Adapter VMnet8虚拟网卡主要是为了实现主机与虚拟机之间的通信。在之后的设置步骤中，我们可以加以验证。



## Host-Only（仅主机模式）

Host-Only模式其实就是NAT模式去除了虚拟NAT设备，然后使用VMware Network Adapter VMnet1虚拟网卡连接VMnet1虚拟交换机来与虚拟机通信的，Host-Only模式将虚拟机与外网隔开，使得虚拟机成为一个独立的系统，只与主机相互通讯。其网络结构如下图所示：



![img](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20211106131415.png)



通过上图，我们可以发现，如果要使得虚拟机能联网，我们可以将主机网卡共享给VMware Network Adapter VMnet1网卡，从而达到虚拟机联网的目的。



## 虚拟机配置效果

```shell
$ ifconfig
// NAT
ens33: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.245.128  netmask 255.255.255.0  broadcast 192.168.245.255
        inet6 fe80::de5c:1640:261f:98d9  prefixlen 64  scopeid 0x20<link>
        ether 00:0c:29:bb:c5:63  txqueuelen 1000  (Ethernet)
        RX packets 6734  bytes 6819305 (6.8 MB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 3288  bytes 423451 (423.4 KB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
// 桥接
ens36: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.31.121  netmask 255.255.255.0  broadcast 192.168.31.255
        inet6 fe80::3ac5:165d:dd10:127d  prefixlen 64  scopeid 0x20<link>
        ether 00:50:56:33:7d:9e  txqueuelen 1000  (Ethernet)
        RX packets 617  bytes 95834 (95.8 KB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 431  bytes 42277 (42.2 KB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
// host only
ens38: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 172.16.6.128  netmask 255.255.255.0  broadcast 172.16.6.255
        inet6 fe80::71c0:2c9a:35c9:9b8d  prefixlen 64  scopeid 0x20<link>
        ether 00:50:56:21:85:64  txqueuelen 1000  (Ethernet)
        RX packets 131  bytes 10586 (10.5 KB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 184  bytes 19385 (19.3 KB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
```

192.168.160.128
