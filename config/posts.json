{
  "posts": [
    {
      "content": "æœ¬æ–‡ä¸»è¦æè¿°å¦‚ä½•ä½¿ç”¨Daggerè§£å†³å®é™…é¡¹ç›®ä¸­é‡åˆ°çš„é—®é¢˜ï¼Œè¿™ä¸¤ä¸ªé—®é¢˜æ˜¯ï¼š\n\n1. å¦‚ä½•åœ¨åº“ï¼ˆSDKï¼‰æ¨¡å—ä¸­ä½¿ç”¨Daggerä¾èµ–æ³¨å…¥ï¼Ÿ\n2. MVPä¸­çš„Daggerä¾èµ–æ³¨å…¥å¦‚ä½•å®ç°æ— æ„Ÿæ³¨å…¥ï¼Ÿ\n\næœ¬æ–‡ä¸ä¼šä»‹ç»å¦‚ä½•ä½¿ç”¨Daggerï¼Œåªä¸“æ³¨äºæè¿°å¦‚ä¸Šä¸¤ä¸ªé—®é¢˜çš„è§£å†³çš„å‰å› åæœåŠè§£å†³æ–¹æ¡ˆã€‚\n\n\n\n<!-- more -->\n\n## èƒŒæ™¯\n\næ¥æ‰‹å¼€å‘ä¸€ä¸ªSDKï¼Œå¤§è‡´æƒ…å†µå¦‚ä¸‹ï¼š\n\n- è¯¥SDKå†…éƒ¨æœ‰è‹¥å¹²ç•Œé¢ï¼ŒåŒ…æ‹¬Activityï¼ŒFragmentç­‰\n- ä½¿ç”¨MVPæ¶æ„\n\né€æ¸å‘ç°å†…éƒ¨ä¾èµ–æ··ä¹±ï¼Œåœ¨å¾—ç©ºåï¼Œé‚å¯¹å…¶ä¾èµ–éƒ¨åˆ†è¿›è¡Œé‡æ„æ”¹é€ ã€‚\n\n### ä¸ºä»€ä¹ˆä½¿ç”¨ä¾èµ–æ³¨å…¥è¿›è¡Œæ”¹é€ ï¼Ÿ\n\nä¸»è¦æ˜¯ä¾èµ–æ··ä¹±ï¼Œå•ä¾‹çš„æ»¥ç”¨å¯¼è‡´ä¾èµ–å…³ç³»ä¸æ˜æ˜¾ï¼Œæ— æ³•ç®¡ç†ï¼Œæ— æ³•æµ‹è¯•\n\næŸäº›å¯¹è±¡ï¼Œæˆ‘ä»¬åœ¨å¾ˆå¤šç±»ä¸­éƒ½éœ€è¦ä½¿ç”¨ï¼Œå¦‚ Retrofit çš„è¯·æ±‚å¯¹è±¡ï¼Œä»£è¡¨ä¿¡æ¯çš„æ ‡è¯†å­—æ®µç­‰ï¼Œæ­¤æ—¶ä¸ºäº†é¿å…é€šè¿‡æ„é€ å‡½æ•°æˆ–è€…setteræ–¹æ³•æ¥ä¼ é€’ï¼Œå°±ç›´æ¥èµ·äº†ä¸ªå•ä¾‹ï¼Œè¿˜æœ‰å¾ˆå¤šå…¶ä»–ç±»ä¼¼çš„æƒ…å†µï¼Œæœ€ç»ˆå¯¼è‡´å•ä¾‹æœ‰10å¤šä¸ªï¼Œè°ƒç”¨å•ä¾‹ getInstance çš„åœ°æ–¹æ›´æ˜¯æ•°ä¸èƒœæ•°ã€‚\n\nå¯¼è‡´æˆ‘ä»¬è¦å¯¹å¯¹åº”çš„ä»£ç è¿›è¡Œå•å…ƒæµ‹è¯•åšmockæ“ä½œå¼‚å¸¸å›°éš¾ï¼Œ\n\n1. å› ä¸ºä¾èµ–å…³ç³»å¤ªä¸æ˜æ˜¾ï¼Œå‡ ä¹å¾—ä¸€è¡Œè¡Œæ‰¾æ‰èƒ½æ‰¾åˆ°ç±»æˆ–æ–¹æ³•åˆ°åº•ä¾èµ–äº†å“ªäº›å¯¹è±¡\n2. åŒæ—¶mockçš„è¿‡ç¨‹ä¹Ÿå˜å¾—éº»çƒ¦ï¼Œç”±äºæ²¡æœ‰ä½œä¸ºç±»æˆå‘˜ï¼Œæ‰€ä»¥æ— æ³•ç®€å•é€šè¿‡mockæ›¿æ¢\få¯¹åº”æˆå‘˜ï¼›\n\n### ä¾èµ–æ³¨å…¥æ”¹é€ çš„é—®é¢˜ç‚¹\n\nä¸»è¦æœ‰å¦‚ä¸‹é—®é¢˜ï¼š\n\n<p style=\"color:red;\">1.Â æ²¡æœ‰Applicationã€‚è¯¥æ¨¡å—ä¸ºSDKï¼Œæˆ‘ä»¬å¹¶ä¸èƒ½ç›´æ¥ä¿®æ”¹Applicationå¯¹è±¡ï¼ŒApplicationä¸ºé›†æˆæ–¹è‡ªè¡Œç¼–å†™ã€‚</p>\n\n<p style=\"color:red;\">2. MVPçš„ç»‘å®šã€‚MVPç»‘å®šä¸­æ¨¡æ¿ä»£ç è¾ƒå¤šï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å°½å¯èƒ½çš„å®ç°æ— æ„Ÿçš„æ³¨å…¥ã€‚</p>\n\nä¹‹æ‰€ä»¥æç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œæ˜¯å› ä¸ºGoogle é’ˆå¯¹Androidï¼Œåœ¨Daggerçš„åŸºç¡€ä¸Šé’ˆå¯¹æ€§çš„æ„å»ºäº†ä¸€ä¸ªHilt çš„ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œèƒ½å¤Ÿå‡å°‘Androidä¸­ç›´æ¥ä½¿ç”¨Daggerçš„æ¨¡æ¿ä»£ç ã€‚ä½†æ˜¯Hiltçš„ä½¿ä¸­æœ‰è¦æ±‚ï¼š\n\n> **æ‰€æœ‰ä½¿ç”¨ Hilt çš„åº”ç”¨éƒ½å¿…é¡»åŒ…å«ä¸€ä¸ªå¸¦æœ‰ `@HiltAndroidApp` æ³¨é‡Šçš„ `Application` ç±»ã€‚**\n>\n> å‚è€ƒï¼š [ä½¿ç”¨ Hilt å®ç°ä¾èµ–é¡¹æ³¨å…¥  | Android å¼€å‘è€…  | Android Developers (google.cn)](https://developer.android.google.cn/training/dependency-injection/hilt-android)\n\nä¹Ÿå°±æ˜¯å¿…é¡»èƒ½æ§åˆ¶ä½Applicationï¼Œå¦‚ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬ä½œä¸ºä¸€ä¸ªSDKçš„æä¾›æ–¹ï¼š\n\n1. æ˜¯æ²¡æœ‰æœºä¼šä¿®æ”¹Applicationçš„ä»£ç çš„\n2. è€Œä¸”ï¼Œæˆ‘ä»¬ä¹Ÿä¸èƒ½è¦æ±‚ä½¿ç”¨æ–¹å»åšè¿™ç§é™åˆ¶ï¼›åŒæ—¶ï¼Œå¦‚æœä½¿ç”¨æ–¹æœ‰ä½¿ç”¨ Hilt å‘¢ï¼Œæˆ‘ä»¬çš„ä»£ç æ˜¯å¦ä¼šå¯¹å…¶äº§ç”Ÿå½±å“ï¼Ÿ\n\n**æ•…ï¼Œæˆ‘ä»¬åªèƒ½ç›´æ¥ä½¿ç”¨Daggerã€‚**\n\n\n\nè€Œå¦å¤–ä¸€ä¸ªé—®é¢˜åœ¨äºMVPçš„æ¶æ„é™åˆ¶ï¼ŒP å±‚éœ€è¦æŒæœ‰Vå±‚çš„å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯Pä¾èµ–Vï¼Œè€ŒVé€šå¸¸æ˜¯Activityæˆ–è€…Fragmentï¼Œè€ŒActivityåŠFragmentçš„åˆ›å»ºè¿‡ç¨‹ç”±Androidç³»ç»Ÿæ§åˆ¶ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨Daggeræ—¶æˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€äº›æ¨¡æ¿ä»£ç ï¼ˆä¸‹æ–¹ä¼šè¯´æ˜ï¼‰ï¼Œå°† ActivityåŠFragmentå¯¹è±¡æ³¨å…¥åˆ° Dagger çš„ä¾èµ–å›¾è°±ä¸­ã€‚\n\n\n\n## æ²¡æœ‰ Application çš„é—®é¢˜è§£å†³\n\né¦–å…ˆï¼Œæˆ‘ä»¬è¦è§£å†³çš„æ˜¯æ²¡æœ‰Applicationçš„é—®é¢˜ï¼Œé‚£ä¹ˆæ²¡æœ‰Applicationä¼šç»™æˆ‘ä»¬å¸¦æ¥å“ªäº›é—®é¢˜å‘¢ï¼Ÿ\n\n1. æ— æ³•ä½¿ç”¨ Hilt\n2. æ— æ³•ç›´æ¥ä½¿ç”¨ dagger-android\n\nè¿™ä¸¤ä¸ªé—®é¢˜å®é™…ä¸Šæ˜¯ç±»ä¼¼çš„ï¼ŒHiltåŠDagger-Androidéƒ½æ˜¯ç”¨äºè§£å†³ Android ç»„ä»¶ï¼ˆActivityï¼ŒFragmentï¼ŒServiceï¼ŒBroadcastReceiver ç­‰ï¼‰çš„ä¾èµ–æ³¨å…¥çš„ã€‚ä½†æ˜¯ä»–ä»¬éƒ½è¦æ±‚æˆ‘ä»¬å¿…é¡»ä½¿ç”¨ Applicationã€‚\n\n### ä¸ºä»€ä¹ˆä¸€å®šè¦Applicationï¼Ÿ\n\né¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹ä¸‹ dagger-android çš„ä½¿ç”¨æ–¹å¼ï¼Œè¿™é‡Œå‚è€ƒ [Google çš„ç¤ºä¾‹]([architecture-components-samples/GithubBrowserSample at master Â· android/architecture-components-samples](https://github.com/android/architecture-components-samples/tree/master/GithubBrowserSample)) è¿›è¡Œè¯´æ˜ã€‚\n\n#### Dagger-Android çš„ä½¿ç”¨\n\nè¿™é‡Œæˆ‘ä»¬çœç•¥ gradle ä¾èµ–çš„å¼•å…¥éƒ¨åˆ†ï¼Œç›´æ¥è§£é‡Šä»£ç ã€‚\n\n##### 1. Application è¿›è¡Œæ”¹é€ \n\nå¦‚ä¸‹ä»£ç æ‰€è¿°ï¼Œä¸»è¦æœ‰å¦‚ä¸‹ä¿®æ”¹ï¼š\n\n1. ä»¤ Application å®ç° `HasActivityInjector` æ¥å£ï¼›\n2. Application ä¸­æ³¨å…¥ä¸€ä¸ªç±»å‹ä¸º `DispatchingAndroidInjector<Activity>` çš„æˆå‘˜ï¼ŒåŒæ—¶é€šè¿‡HasActivityInjectoræ¥å£å®šä¹‰çš„é‡è½½æ–¹æ³• `activityInjector()` è¿”å›è¯¥æˆå‘˜ã€‚\n3. åœ¨ `Application.onCreate` ä¸­è°ƒç”¨ `AppInjector.init(this)` æ‰§è¡Œæ³¨å…¥æ“ä½œã€‚\n\nè‡³æ­¤ï¼Œå‡†å¤‡å·¥ä½œå°±å®Œæ¯•äº†ï¼Œä¹‹åå°±å¯ä»¥ä½¿ç”¨Dagger æ— æ„Ÿæ³¨å…¥Activityæˆ–è€…Fragmentäº†ã€‚\n\n```kotlin\nclass GithubApp : Application(), HasActivityInjector {\n    @Inject\n    lateinit var dispatchingAndroidInjector: DispatchingAndroidInjector<Activity>\n\n    override fun onCreate() {\n        super.onCreate()\n        if (BuildConfig.DEBUG) {\n            Timber.plant(Timber.DebugTree())\n        }\n        AppInjector.init(this)\n    }\n\n    override fun activityInjector() = dispatchingAndroidInjector\n}\n```\n\nAppInjector.init çš„å®ç°ä¹Ÿå¾ˆç®€å•ï¼Œå®é™…ä¸Šå°±æ˜¯ï¼š\n\n- åœ¨ Activity Create çš„æ—¶å€™è°ƒç”¨ `AndroidInjection.inject(activity)` åŠ \n- åœ¨ Fragment Create çš„æ—¶å€™è°ƒç”¨ `AndroidSupportInjection.inject(f)`\n\n```kotlin\nobject AppInjector {\n    fun init(githubApp: GithubApp) {\n        DaggerAppComponent.builder().application(githubApp)\n            .build().inject(githubApp)\n        githubApp\n            .registerActivityLifecycleCallbacks(object : Application.ActivityLifecycleCallbacks {\n                override fun onActivityCreated(activity: Activity, savedInstanceState: Bundle?) {\n                    handleActivity(activity)\n                }\n            })\n    }\n\n    private fun handleActivity(activity: Activity) {\n        if (activity is HasSupportFragmentInjector) {\n            AndroidInjection.inject(activity)\n        }\n        if (activity is FragmentActivity) {\n            activity.supportFragmentManager\n                .registerFragmentLifecycleCallbacks(\n                    object : FragmentManager.FragmentLifecycleCallbacks() {\n                        override fun onFragmentCreated(fm: FragmentManager,f: Fragment,savedInstanceState: Bundle?\n                        ) {\n                            if (f is Injectable) {\n                                AndroidSupportInjection.inject(f)\n                            }\n                        }\n                    }, true\n                )\n        }\n    }\n}\n```\n\n> `AndroidInjection.inject` åŠ `AndroidSupportInjection.inject`ä¸º dagger-android æä¾›çš„æ¥å£ï¼Œæˆ‘ä»¬åç»­è¿›è¡Œåˆ†æã€‚\n\n##### 2. ä½¿ç”¨\n\nå†å®Œæˆä¸Šè¿°å‡†å¤‡å·¥ä½œä¹‹åï¼Œè¦æƒ³è®©Activityæˆ–è€…Fragmentèƒ½å¤Ÿè‡ªåŠ¨æ³¨å…¥ï¼Œåªéœ€è¦è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼ˆæˆ‘ä»¬åŒæ ·è¿˜æ˜¯å‚è€ƒ[Googleç¤ºä¾‹ä»£ç ](https://github.com/android/architecture-components-samples/blob/master/GithubBrowserSample/app/src/main/java/com/android/example/github/di/MainActivityModule.kt)ï¼‰\n\n1. åœ¨ Module ä¸­ä½¿ç”¨`@ContributesAndroidInjector` æ ‡è®°ä¸€ä¸ªè¿”å›å¯¹åº”Activityï¼ˆå¦‚MainActivityï¼‰çš„æ–¹æ³•\n\n```kotlin\n// https://github.com/android/architecture-components-samples/blob/master/GithubBrowserSample/app/src/main/java/com/android/example/github/di/MainActivityModule.kt\n@Module\nabstract class MainActivityModule {\n    @ContributesAndroidInjector(modules = [FragmentBuildersModule::class])\n    abstract fun contributeMainActivity(): MainActivity\n}\n```\n\n2. å½“ç„¶è¿˜éœ€è¦å°†è¿™ä¸ªModuleåŒ…å«åˆ° AppComponentä¸­ï¼ˆåŒæ—¶ AppComponentä¸­éœ€è¦åŒ…å« `AndroidInjectionModule`è¿™ä¸ª dagger-android æä¾›çš„moduleï¼‰\n\n```kotlin\n// https://github.com/android/architecture-components-samples/blob/master/GithubBrowserSample/app/src/main/java/com/android/example/github/di/AppComponent.kt\n@Singleton\n@Component(\n    modules = [\n        AndroidInjectionModule::class,\n        MainActivityModule::class]\n)\ninterface AppComponent {\n    // åˆ é™¤å…¶ä»–éƒ¨åˆ†\n}\n```\n\n##### 3. æ€»ç»“\n\nä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨dagger-androidæ—¶ï¼Œåœ¨å®Œæˆäº†å‡†å¤‡åŠ¨ä½œä¹‹åï¼Œ**åç»­åªéœ€è¦æ·»åŠ ä¸€ä¸ª `@ContributesAndroidInjector` æ³¨è§£çš„æ–¹æ³•ï¼Œå°±å¯ä»¥è®©ä½ çš„Activityæ”¯æŒè‡ªåŠ¨ä¾èµ–æ³¨å…¥ã€‚**\n\n### ä¸ºä»€ä¹ˆéœ€è¦ Application\n\nä¸Šé¢ä»‹ç»äº† dagger-android çš„ä½¿ç”¨æ–¹å¼ï¼Œå®é™…ä¸Šæ˜¯ä¸ºäº†å±•ç¤ºåœ¨ä½¿ç”¨Dagger-Androidä¹‹åï¼Œæˆ‘ä»¬**å¯ä»¥æ— éœ€å¯¹Activityè¿›è¡Œä¿®æ”¹ï¼Œå°±å¯ä»¥è‡ªåŠ¨å‘å…¶ä¸­æ³¨å…¥ä¾èµ–**ã€‚ è¿™é‡Œçš„ä¿®æ”¹å®é™…ä¸ŠæŒ‡çš„æ˜¯æ‰‹åŠ¨åœ¨æ¯ä¸ªActivity çš„ onCreate æ–¹æ³•è°ƒç”¨Daggerç»„ä»¶çš„æ³¨å…¥æ–¹æ³•ã€‚\n\nä½†æ˜¯æˆ‘ä»¬çš„é—®é¢˜å¹¶æ²¡æœ‰å¾—åˆ°å›ç­”ï¼Œå³ï¼š\n\n<b><span style=\"color:red;\">ä¸ºä»€ä¹ˆéœ€è¦Applicationï¼Ÿ</span></b>\n\nç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹ä¸‹ `AndroidInjection.inject(activity)` çš„å®ç°ï¼š(AndroidInjection ä¸ºdagger-android åº“æä¾›çš„è¾…åŠ©å·¥å…·ç±»)\n\n```kotlin\npublic static void inject(Activity activity) {\n    checkNotNull(activity, \"activity\");\n    Application application = activity.getApplication();\n    if (!(application instanceof HasActivityInjector)) {\n      throw new RuntimeException(\n          String.format(\n              \"%s does not implement %s\",\n              application.getClass().getCanonicalName(),\n              HasActivityInjector.class.getCanonicalName()));\n    }\n\n    AndroidInjector<Activity> activityInjector =\n        ((HasActivityInjector) application).activityInjector();\n    checkNotNull(activityInjector, \"%s.activityInjector() returned null\", application.getClass());\n\n    activityInjector.inject(activity);\n  }\n```\n\nä»ä»£ç ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ‰§è¡Œäº†å¦‚ä¸‹æ­¥éª¤ï¼š\n\n1. **ç”±Activityè·å–Application**ï¼›\n2. åˆ¤æ–­ Application æ˜¯å¦å®ç°äº† HasActivityInjector\n3. ä» Application è·å– `AndroidInjector<Activity>`ï¼Œç„¶åä½¿ç”¨æ­¤å¯¹è±¡æ‰§è¡Œå¯¹ç›®æ ‡Activityçš„æ³¨å…¥ã€‚\n\n\n\nå¦å¤–ï¼ŒAndroidInjection ç±»è¿˜æœ‰å¯¹ Serviceï¼ŒFragmentç­‰çš„æ³¨å…¥è¾…åŠ©æ–¹æ³•ï¼Œè¿‡ç¨‹ä¸­ä¹Ÿéƒ½ç±»ä¼¼å¯¹Activityçš„æ³¨å…¥ï¼Œä¼šè·å– Application å¯¹è±¡ï¼Œç„¶åä»Applicationå¯¹è±¡ä¸­è·å–AndroidInejctorï¼Œå†ç”¨æ­¤å¯¹è±¡è¿›è¡Œç›®æ ‡ç»„ä»¶çš„ä¾èµ–æ³¨å…¥ã€‚\n\næ‰€ä»¥ï¼Œæˆ‘ä»¬ç°åœ¨çŸ¥é“äº†ä¸ºä»€ä¹ˆä¸€å®šè¦Applicationäº†ï¼š\n\n1. **å®é™…ä¸Šï¼Œæ˜¯éœ€è¦å…¶ä¸­çš„ AndroidInjector ï¼›**\n2. **åœ¨å„ç§Androidç»„ä»¶ä¸­ï¼ˆActivityï¼ŒServiceï¼Œç­‰ï¼‰æˆ‘ä»¬éƒ½èƒ½ç›´æ¥é€šè¿‡å…¶è·å–åˆ°Applicationå¯¹è±¡ï¼Œè¿™æ ·å°±èƒ½æ‰¾åˆ°å­˜åœ¨äºApplicationä¸­çš„ AndroidInjectorï¼Œç„¶åæ‰§è¡Œæ³¨å…¥æ“ä½œã€‚**\n\n### æ‰©å±• - AndroidInjector å“ªé‡Œæ¥çš„ï¼Ÿ\n\né€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“äº†ä¸ºä»€ä¹ˆ dagger-android ä¸€å®šéœ€è¦Applicationï¼Œæ˜¯ä¸ºäº†è·å–å…¶ä¸­çš„AndroidInjector ç”¨æ¥æ‰§è¡Œç›®æ ‡Androidç»„ä»¶çš„æ³¨å…¥æ“ä½œã€‚\n\né‚£ä¹ˆï¼Œ**è¿™ä¸ª AndroidInjector æ˜¯å“ªé‡Œæ¥çš„å‘¢ï¼Ÿ**\n\nç”±å‰é¢çš„GithubAppä»£ç ä¸­æˆ‘ä»¬çœ‹åˆ°ï¼Œè¿™ä¸ª AndroidInject å°±æ˜¯Applicationä¸­ä½¿ç”¨äº† `@Inject` æ ‡è®°çš„ç±»å‹ä¸º` DispatchingAndroidInjector<Activity>` çš„å¯¹è±¡\n\n```kotlin\n// AndroidInjection.inject(activity)\nAndroidInjector<Activity> activityInjector =\n        ((HasActivityInjector) application).activityInjector();    \n\n// GithubApp\n@Inject\nlateinit var dispatchingAndroidInjector: DispatchingAndroidInjector<Activity>\noverride fun activityInjector() = dispatchingAndroidInjector\n```\n\næˆ‘ä»¬å»Dagger çš„ç”Ÿæˆä»£ç ä¸­( `DaggerAppComponent` )ä¸­æŸ¥æ‰¾å¯¹åº”çš„ç±»å‹ `DispatchingAndroidInjector<Activity>`\n\n```java\n// DaggerAppComponent.java  \n\tprivate DispatchingAndroidInjector<Activity> getDispatchingAndroidInjectorOfActivity() {\n    return DispatchingAndroidInjector_Factory.newDispatchingAndroidInjector(\n        getMapOfClassOfAndProviderOfFactoryOf());\n  }\n\n  private GithubApp injectGithubApp(GithubApp instance) {\n    GithubApp_MembersInjector.injectDispatchingAndroidInjector(\n        instance, getDispatchingAndroidInjectorOfActivity());\n    return instance;\n  }\n \n\t@Override\n  public void inject(GithubApp githubApp) {\n    injectGithubApp(githubApp);\n  }\n\n// GithubApp_MembersInjector.java\n  @Override\n  public void injectMembers(GithubApp instance) {\n    injectDispatchingAndroidInjector(instance, dispatchingAndroidInjectorProvider.get());\n  }\n\n  public static void injectDispatchingAndroidInjector(\n      GithubApp instance, DispatchingAndroidInjector<Activity> dispatchingAndroidInjector) {\n    instance.dispatchingAndroidInjector = dispatchingAndroidInjector;\n  }\n```\n\nå¯ä»¥çœ‹åˆ° DaggerAppComponentä¸­åœ¨æ³¨å…¥`inject(GithubApp)`æ—¶ï¼Œä¼šå°†`DispatchingAndroidInjector<Activity>` ç±»å‹çš„ä¾èµ–æ³¨å…¥åˆ° GithubApp ä¸­ã€‚\n\n> **æ›´å¤šç»†èŠ‚ï¼š**\n>\n> 1. dagger-android-processor  å¤„ç†å…¶ä¼šæ ¹æ® `@ContributesAndroidInjector` è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªModuleçš„ä»£ç ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n>\n>    ```java\n>    @Module(subcomponents = MainActivityModule_ContributeMainActivity.MainActivitySubcomponent.class)\n>    public abstract class MainActivityModule_ContributeMainActivity {\n>      private MainActivityModule_ContributeMainActivity() {}\n>    \n>      @Binds\n>      @IntoMap\n>      @ActivityKey(MainActivity.class)\n>      abstract AndroidInjector.Factory<? extends Activity> bindAndroidInjectorFactory(\n>          MainActivitySubcomponent.Builder builder);\n>    \n>      @Subcomponent(modules = FragmentBuildersModule.class)\n>      public interface MainActivitySubcomponent extends AndroidInjector<MainActivity> {\n>        @Subcomponent.Builder\n>        abstract class Builder extends AndroidInjector.Builder<MainActivity> {}\n>      }\n>    }\n>    ```\n>\n>    - æ­¤æ¨¡å—ä¸­å®šä¹‰äº† `bindAndroidInjectorFactory` æ–¹æ³•ï¼Œä½¿ç”¨ `@Binds @IntoMap`ç”Ÿæˆ  `Map<Class<? extends T>, Provider<AndroidInjector.Factory<? extends T>>>` ç±»å‹çš„Map\n>    - åœ¨è¿™é‡Œæ³¨å…¥åˆ°Mapä¸­çš„å†…å®¹å°±æ˜¯ `(MainActivity.class, MainActivitySubcomponent.Builder builder)`, å…¶ä¸­ `MainActivitySubcomponent.Builder`  ç”¨äºæ„å»º `MainActivitySubcomponent`\n>    - `MainActivitySubcomponent` ç»§æ‰¿äº† `AndroidInjector<MainActivity>` ç±»ï¼Œæ‰€ä»¥ä¼šæœ‰ä¸€ä¸ª `inject(MainActivity instance)`çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯æœ€ä¸­å®ç°å¯¹ MainActivity ä¾èµ–æ³¨å…¥çš„å®ç°å…¥å£ï¼›\n>\n> 2. åŒæ—¶ `dagger-android` ä¸­çš„`DispatchingAndroidInjector` ç±»ä¸­ï¼Œä¼šå£°æ˜å¯¹ ç±»å‹`Map<Class<? extends T>, Provider<AndroidInjector.Factory<? extends T>>>` çš„ä¾èµ–ï¼Œæ‰€ä»¥ä¸Šé¢çš„`(MainActivity.class, MainActivitySubcomponent.Builder builder)`ä¼šè‡ªåŠ¨è¢«æ³¨å…¥åˆ° `DispatchingAndroidInjector` å¯¹è±¡ä¸­\n>\n>    ```java\n>     public final class DispatchingAndroidInjector<T> implements AndroidInjector<T> {\n>         private final Map<Class<? extends T>, Provider<AndroidInjector.Factory<? extends T>>>\n>          injectorFactories;\n>       \n>         @Inject\n>          DispatchingAndroidInjector(\n>            Map<Class<? extends T>, Provider<AndroidInjector.Factory<? extends T>>> injectorFactories) {\n>            this.injectorFactories = injectorFactories;\n>          }\n>     }\n>    ```\n>\n> 3. è€Œè¿™ä¸ª `DispatchingAndroidInjector<Activity>` åœ¨ GithubAppä¸­è¢«å£°æ˜ä¸ºä¾èµ–ï¼Œæ‰€ä»¥ä¹Ÿä¼šè¢«è‡ªåŠ¨æ³¨å…¥ï¼Œä»è€Œæˆ‘ä»¬èƒ½åœ¨GithubAppä¸­é€šè¿‡ AndroidInjection è·å–åˆ° `DispatchingAndroidInjector<Activity>`, ç„¶åè°ƒç”¨å…¶ `MainActivitySubcomponent` ï¼Œç„¶åè°ƒç”¨å…¶ inject æ–¹æ³•å®Œæˆæ³¨å…¥\n>\n>    ```java\n>    public final class DispatchingAndroidInjector<T> implements AndroidInjector<T> { \n>    \tpublic boolean maybeInject(T instance) {\n>        Provider<AndroidInjector.Factory<? extends T>> factoryProvider =\n>          // instance ç±»å‹ä¸º MainActivityï¼Œæ‰€ä»¥å¯ä»¥è·å–åˆ° Provider<MainActivitySubcomponent.Builder>\n>            injectorFactories.get(instance.getClass());\n>    \t\t// è¿™é‡Œå°±é€šè¿‡ MainActivitySubcomponent.Builder è·å–åˆ° factory = MainActivitySubcomponent.Builder\n>        AndroidInjector.Factory<T> factory = (AndroidInjector.Factory<T>) factoryProvider.get();\n>        try {\n>          AndroidInjector<T> injector =\n>              checkNotNull(\n>                  factory.create(instance), \"%s.create(I) should not return null.\", factory.getClass());\n>    \t\t\t// ä¸Šé¢è°ƒç”¨  factory.create(instance) å°±æ˜¯è°ƒç”¨ MainActivitySubcomponent.Builder.create æ–¹æ³•åˆ›å»º MainActivitySubcomponent\n>          // è¿™é‡Œçš„ inejctor å°±æ˜¯ MainActivitySubcomponent\n>          // ç„¶åé€šè¿‡ MainActivitySubcomponent çš„ inejct(MainActivity) æ–¹æ³•æ¥å®ç°å¯¹ MainActivity çš„æ³¨å…¥\n>          injector.inject(instance);\n>          return true;\n>        } catch (ClassCastException e) {\n>          throw new InvalidInjectorBindingException(\n>              String.format(\n>                  \"%s does not implement AndroidInjector.Factory<%s>\",\n>                  factory.getClass().getCanonicalName(), instance.getClass().getCanonicalName()),\n>              e);\n>        }\n>      }\n>    }\n>    ```\n\n### æ€»ç»“\n\nç°åœ¨ï¼Œæˆ‘ä»¬å¯¹å‰é¢çš„å†…å®¹æ€»ç»“ä¸€ä¸‹ï¼š\n\n**dagger-android ä¸ºäº†å®ç°å¯¹äºActivityç­‰Androidç»„ä»¶çš„æ— æ„Ÿæ³¨å…¥ï¼Œå°†Activityç­‰æ³¨å…¥çš„å®ç°Componentæ”¾åœ¨äº†Applicationçš„æˆå‘˜å˜é‡ä¸­**\n\n### è§£å†³æ–¹æ¡ˆ\n\nä¹‹æ‰€ä»¥é€‰æ‹©Applicationå¯¹è±¡ï¼Œæ˜¯å› ä¸ºå…¶ç”Ÿå‘½å‘¨æœŸæ¯”è¾ƒæŒä¹…ï¼Œå’Œåº”ç”¨ä¸€è‡´ã€‚è€Œä¸ºäº†å¯¹Activityå®ç°æ— æ„Ÿæ³¨å…¥ï¼Œä½¿ç”¨åˆ°çš„åªæ˜¯è¢«æ³¨å…¥åˆ°Applicationä¸­çš„ DispatchingAndroidInjector å¯¹è±¡ã€‚\n\næ•…æˆ‘ä»¬å¯ä»¥å°†Applicationæ›¿æ¢ä¸ºä»»æ„ä¸€ä¸ªé™æ€çš„å¯¹è±¡å³å¯ï¼Œç±»ä¼¼å¦‚ä¸‹ï¼š\n\n```java\npublic class SdkContainer implements HasAndroidInjector {\n    @Inject\n    protected DispatchingAndroidInjector<Object> androidInjector;\n\n    @Override\n    public AndroidInjector<Object> androidInjector() {\n        return androidInjector;\n    }\n}\n\npublic class SdkInjector {\n    private static final String TAG = \"SdkInjector\";\n\n    private static SdkContainer sSdkContainer;\n\n    public static SdkContainer getSdkContainer() {\n        return sSdkContainer;\n    }\n\n    public static void init(Application application) {\n        if (sSdkContainer != null) {\n            return;\n        }\n        SdkComponent sSdkComponent = DaggerSdkComponent.builder()\n                .application(application)\n                .build();\n        SdkInjector.sSdkContainer = new SdkContainer(sSdkComponent);\n        sSdkComponent.inject(sSdkContainer);\n    }\n}\n\n@Singleton\n@Component(\n        modules = {  AndroidInjectionModule.class,}\n)\npublic interface SdkComponent {\n    void inject(SdkContainer sdkContainer);\n    @Component.Builder\n    interface Builder {\n        @BindsInstance\n        Builder application(Application application);\n        SdkComponent build();\n    }\n}\n```\n\n## MVP æ¶æ„çš„æ³¨å…¥é—®é¢˜\n\n### MVP ä¸­çš„æ³¨å…¥é—®é¢˜ï¼Ÿ\n\nä¸€ä¸ª Presenter çš„ä¸€èˆ¬æ„é€ æ–¹å¼å¦‚ä¸‹ï¼š\n\n```java\npublic class TestDiMvpActivityPresenter {\n  public TestDiMvpActivityPresenter(TestDiView view) {}\n}\n\npublic class TestDiMvpActivity extends Activity implements TestDiView {\n}\n```\n\nå¯ä»¥çœ‹åˆ°Presenteræ„é€ æ—¶éœ€è¦ä¸€ä¸ªTestDiViewï¼Œè€Œè¿™ä¸ªTestDiViewå®é™…ä¸Šæ˜¯ TestDiMvpActivityï¼Œè€Œæˆ‘ä»¬æ— æ³•æ‰‹åŠ¨æ„é€  TestDiMvpActivity çš„å®ä¾‹ï¼Œåªèƒ½ç­‰ç³»ç»Ÿåˆ›å»ºä¹‹åæ‰èƒ½è·å–å®ä¾‹ï¼Œç„¶åè¿›è¡Œæ³¨å…¥ï¼Œæ‰€ä»¥**ä¸€èˆ¬MVPçš„æ³¨å…¥å†™æ³•å¦‚ä¸‹**ï¼š\n\n#### MVP æ³¨å…¥çš„ä¸€èˆ¬å†™æ³•\n\n1. **å®šä¹‰å­ç»„ä»¶åŠæ¨¡å—**\n\n```java\n// ä¿®æ”¹ç‚¹1âƒ£ï¸    \n@Module(\n          subcomponents = TestDiMvpActivityModule.MvpComponent.class\n    )\n    public interface TestDiMvpActivityModule {\n  \n      @Module\n      class MvpModule {\n          TestDiMvpActivityPresenter.TestDiView testDiView;\n  \n          public MvpModule(TestDiMvpActivityPresenter.TestDiView testDiView) {\n              this.testDiView = testDiView;\n          }\n  \n          @Provides\n          public TestDiMvpActivityPresenter.TestDiView providerView() {\n              return testDiView;\n          }\n      }\n  \n      @Subcomponent(modules = MvpModule.class)\n      interface MvpComponent {\n  \n          void inject(TestDiMvpActivity activity);\n  \n          @Subcomponent.Builder\n          interface Builder {\n              MvpComponent build();\n  \n              Builder module(MvpModule mvpModule);\n          }\n      }\n    }\n```\n\n2. **åœ¨ RootComponent ä¸­æ³¨å†Œæ¨¡å—å¹¶æä¾›Builderè·å–å‡½æ•°**\n```java\n   @Singleton\n   @Component(\n           modules = {\n             \t\t\t //  ä¿®æ”¹ç‚¹2âƒ£ï¸\n                   TestDiMvpActivityModule.class,\n           }\n   )\n   public interface SdkComponent {\n\t     // ä¿®æ”¹ç‚¹3âƒ£ï¸\n       TestDiMvpActivityModule.MvpComponent.Builder testDiMvpActivityMComponentBuilder();\n   \n       @Component.Builder\n       interface Builder {\n       }\n   }\n```\n\n3. **ä½¿ç”¨æ—¶åœ¨ TestDiMvpActivity.onCreate** ä¸­\n\n```java\n   public class TestDiMvpActivity extends Activity implements TestDiMvpActivityPresenter.TestDiView {\n   \n       @Override\n       protected void onCreate(@Nullable  Bundle savedInstanceState) {\n          // ä¿®æ”¹ç‚¹4âƒ£ï¸\n   \t\t\t\tSdkInjector.getSdkComponent().testDiMvpActivityMComponentBuilder()\n                   .module(new TestDiMvpActivityModule.MvpModule(this)).build()\n                   .inject(this);\n          super.onCreate(savedInstanceState);\n       }\n   }\n```\n\n<span style=\"color:green\">**å…¶å®ç°åŸç†åœ¨äºï¼š**</span>\n\n<span style=\"color:green\">1. åœ¨Activityè¢«ç³»ç»Ÿåˆå§‹åŒ–ä¹‹åï¼Œåœ¨å…¶onCreateä¸­è·å–å…¶å®ä¾‹Â </span>\n\n<span style=\"color:green\">2. å°†Activityå®ä¾‹ä¼ å…¥åˆ°MvpModuleä¸­ï¼Œç„¶åç”±MvpModuleä¸­çš„ providers æ–¹æ³•æ¥æä¾› View å±‚å¯¹è±¡Â </span>\n\n<span style=\"color:green\">3. å°† MvpModuleä½œä¸ºå‚æ•°æ„é€ MvpComponentï¼Œç„¶åä½¿ç”¨MvpComponent çš„inject æ–¹æ³•å¯¹TestDiMvpActivity æ‰§è¡Œæ³¨å…¥åŠ¨ä½œã€‚</span>\n\n#### MVP æ³¨å…¥ä¸€èˆ¬å†™æ³•çš„é—®é¢˜\n\n<span style=\"color:red;\">**è¿™é‡Œçš„çš„é—®é¢˜åœ¨äºï¼š**</span>\n\n<span style=\"color:red;\">1. æ¯æ·»åŠ ä¸€ä¸ªMvpçš„ç»„ä»¶ï¼Œéƒ½ä¿®æ”¹å››ä¸ªåœ°æ–¹ï¼Œæ·»åŠ èµ·æ¥éå¸¸éº»çƒ¦ï¼Œå®¹æ˜“æ¼æ‰ï¼›Â </span>\n\n<span style=\"color:red;\">2. æ¯æ¬¡æ·»åŠ ç»„ä»¶éƒ½éƒ½éœ€è¦ä¿®æ”¹é¡¶å±‚çš„ Root Componentï¼ˆç¤ºä¾‹ä»£ç ä¸­çš„SdkComponentï¼‰ï¼› </span>\n\n<span style=\"color:red;\">3. éœ€è¦åœ¨æ¯ä¸ªå…·ä½“Mvpç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼ˆå¦‚MvpActiviyçš„onCreateï¼‰ä¸­æ·»åŠ æ³¨å…¥ä»£ç ï¼Œå¯¼è‡´å…·ä½“çš„å®ç°çŸ¥é“äº†æ³¨å…¥ç»†èŠ‚ï¼› </span>\n\n### è§£å†³æ–¹æ¡ˆ\n\nä¸Šé¢æåˆ°çš„é—®é¢˜å°±æ˜¯æ–°å¢ä¸€ä¸ªæ”¯æŒæ³¨å…¥çš„MVPç»„ä»¶å¤ªéº»çƒ¦ï¼Œæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨ä¸€ç§ä¿®æ”¹ç‚¹å°‘çš„æ–¹æ¡ˆï¼Œè€Œä¸”å¯¹äºç»„ä»¶æ— æ„Ÿçš„æ–¹æ¡ˆã€‚å°±åƒ dagger-android ä¸€æ ·ã€‚\n\n**ç°åœ¨æˆ‘ä»¬å…ˆç»™å‡ºæ–¹æ¡ˆï¼Œä»¥ä¾¿èƒ½å¤Ÿå¿«é€Ÿçš„æŸ¥çœ‹è§£å†³æ–¹æ¡ˆçš„å…¨è²Œæ•ˆæœï¼Œç„¶åå†è¯´æ˜å…¶ä¸­çš„å…³é”®ç»†èŠ‚**ã€‚\n\næ•´ä½“æ–¹æ¡ˆç”±å¦‚ä¸‹ä¸»è¦æµç¨‹ï¼š\n\n#### æä¾›ç»Ÿä¸€çš„Mvpæ¨¡å—åŠç»„ä»¶å£°æ˜\n\næˆ‘ä»¬å¸Œæœ›æœ€ç»ˆå¢åŠ ä¸€ä¸ªç»„ä»¶æ—¶ï¼Œåªä¿®æ”¹ä¸€ä¸ªåœ°æ–¹ï¼Œä¸ç”¨ä¿®æ”¹ Dagger çˆ¶ç»„ä»¶ï¼Œæ•…æˆ‘ä»¬ç”¨ä¸€ä¸ªç»Ÿä¸€çš„MvpModuleæ¥å®šä¹‰ï¼Œåœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸¤ä¸ªéœ€è¦æ”¯æŒMvpçš„ç»„ä»¶ï¼Œå…¶ä¸­ä¸€ä¸ªä¸ºActivityï¼Œä¸€ä¸ªä¸ºFragmentã€‚å¢åŠ ä¸€ä¸ªMvp çš„Activityæˆ–è€…Fragmentæ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨MvpProviderä¸­æ·»åŠ ä¸¤ä¸ªæ–¹æ³•å³å¯ï¼Œä¸€ä¸ª`@Provider`æ ‡è®°ï¼Œå¦å¤–ä¸€ä¸ª `@ContributesAndroidInjector` æ ‡è®°\n\næ³¨æ„å…¶ä¸­ç”¨åˆ°äº†æˆ‘ä»¬è‡ªå®šä¹‰çš„ä¸€ä¸ªAndroidProvider çš„ç±»ï¼Œåé¢æˆ‘ä»¬ä¼šè¯´æ˜æ­¤ç±»çš„ä½œç”¨ï¼š\n\n```java\n@Module(subcomponents = {\n        MvpModule.MvpComponent.class,\n})\npublic interface MvpModule {\n    @Module\n    abstract class MvpProvider {\n\n        @MvpScope\n        @Provides\n        static TestDiMvpActivityPresenter.TestDiView bindTestDiView(@Nullable AndroidProvider<Activity> activityProvider) {\n            if (activityProvider != null) {\n                return (TestDiMvpActivityPresenter.TestDiView) activityProvider.get();\n            } else {\n                throw new NullPointerException(\"Please provider activity provider when build component!\");\n            }\n        }\n\n        @ContributesAndroidInjector\n        abstract TestDiMvpActivity contributeTestDiMvpActivity();\n\n        @MvpScope\n        @Provides\n        static TestDiMvpFragmentPresenter.View bindTestTestDiMvpFragmentView(@Nullable AndroidProvider<Fragment> fragmentAndroidProvider) {\n            // May delete null check to keep code clean since we provide Fragment correctly\n//            if (fragmentAndroidProvider != null) {\n            return (TestDiMvpFragmentPresenter.View) fragmentAndroidProvider.get();\n//            } else {\n//                throw new NullPointerException(\"Please provider Fragment provider when build component!\");\n//            }\n        }\n\n        /**\n         * æä¾› TestDiMvpFragment çš„æ³¨å…¥æ¥å£\n         *\n         * @return TestDiMvpFragment\n         */\n        @ContributesAndroidInjector\n        abstract TestDiMvpFragment contributeTestDiMvpFragment();\n\n    }\n\n\n    @MvpScope\n    @Subcomponent(modules = {\n            AndroidInjectionModule.class,\n            MvpProvider.class,\n    })\n    interface MvpComponent {\n\n        MvpContainer inject(MvpContainer mvpContainer);\n\n        @Subcomponent.Builder\n        interface Builder {\n            @BindsInstance\n            Builder activityProvider(@Nullable AndroidProvider<Activity> activityProvider);\n\n            @BindsInstance\n            Builder fragmentProvider(@Nullable AndroidProvider<Fragment> fragmentProvider);\n\n            MvpComponent build();\n        }\n    }\n\n}\n\n/**\n * Android ç»„ä»¶æä¾›ç­‰ï¼Œä¸»è¦ç”¨äºå»¶è¿Ÿæä¾›\n * @param <T> ç»„ä»¶ç±»å‹ï¼ˆActivityï¼ŒFragmentï¼‰ç­‰\n */\npublic class AndroidProvider<T> implements Provider<T> {\n\n    private final T item;\n\n    public AndroidProvider(T item) {\n        this.item = item;\n    }\n\n    @Override\n    public T get() {\n        return item;\n    }\n\n}\n```\n\n#### æ³¨å†Œåˆ° Root Component\n\næˆ‘ä»¬åªéœ€è¦è¿™ä¹ˆæ³¨å†Œä¸€æ¬¡å³å¯ï¼Œåç»­æ·»åŠ ç»„ä»¶æ—¶æ— éœ€å†ä¿®æ”¹ã€‚\n\n```java\n@Singleton\n@Component(\n        modules = {\n          \t\t\t// ...\n                // MVP ç»„ä»¶\n                MvpModule.class\n        }\n)\npublic interface SdkComponent {\n\n    // ...\n    MvpModule.MvpComponent.Builder mvpComponentBuilder();\n\n    @Component.Builder\n    interface Builder {\n\t\t\t// ...\n    }\n\n}\n```\n\n#### æ³¨å…¥è¿‡ç¨‹å°è£…éšè—\n\nåœ¨ä¹‹å‰æè¿°çš„ä¸€èˆ¬çš„MVP Activity çš„æ³¨å…¥è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ˜¯åœ¨æ¯ä¸ªå…·ä½“çš„MvpActivityä¸­çš„onCreate æ–¹æ³•ä¸­è¿›è¡Œæ³¨å†Œçš„ï¼Œç°åœ¨æˆ‘ä»¬å°†æ³¨å…¥çš„æµç¨‹éšè—èµ·æ¥ï¼Œæ”¾ç½®åˆ° ActivityLifeCycleCallbacks ä¸­ã€‚\n\n```java\npublic class SdkInjector {\n\n    private static final String TAG = \"SdkInjector\";\n\n    private static SdkContainer sSdkContainer;\n\n    public static SdkComponent getSdkComponent() {\n        return sSdkContainer.getSdkComponent();\n    }\n\n    public static SdkContainer getSdkContainer() {\n        return sSdkContainer;\n    }\n\n    /**\n     * åˆå§‹åŒ– DI\n     *\n     * @param application Application\n     */\n    public static void init(Application application) {\n        if (sSdkContainer != null) {\n            return;\n        }\n        SdkComponent sSdkComponent = DaggerSdkComponent.builder()\n                .application(application)\n                .build();\n        SdkInjector.sSdkContainer = new SdkContainer(sSdkComponent);\n        sSdkComponent.inject(sSdkContainer);\n        sSdkContainer.testInject();\n        application.registerActivityLifecycleCallbacks(new BasicActivityLifeCycleCallbacks() {\n            @Override\n            public void onActivityPreCreated(@NonNull Activity activity, @Nullable Bundle savedInstanceState) {\n                injectActivity(activity, savedInstanceState);\n                super.onActivityPreCreated(activity, savedInstanceState);\n            }\n        });\n    }\n\n    private static void injectActivity(@NotNull Activity activity, @Nullable Bundle savedInstanceState) {\n        if (activity instanceof MvpInjectable) {\n            // MVP çš„ Activity æ³¨å…¥\n            MvpModule.MvpComponent mvpActivityComponent = SdkInjector.getSdkComponent()\n                    .mvpComponentBuilder().activityProvider(new AndroidProvider<>(activity)).build();\n            MvpContainer mvpContainer = new MvpContainer(mvpActivityComponent);\n            mvpActivityComponent.inject(mvpContainer);\n            SdkAndroidInjection.inject(activity, mvpContainer);\n        } else if (activity instanceof Injectable) {\n            SdkAndroidInjection.inject(activity);\n        } else {\n            Log.w(TAG, \"Warning! You Activity \" + activity.getClass().getSimpleName() + \"is not injectable! \");\n        }\n        if (activity instanceof FragmentActivity) {\n            final FragmentManager.FragmentLifecycleCallbacks lifecycleCallbacks = new FragmentManager.FragmentLifecycleCallbacks() {\n                @Override\n                public void onFragmentAttached(@NonNull @NotNull FragmentManager fm, @NonNull @NotNull Fragment f, @NonNull @NotNull Context context) {\n                    super.onFragmentAttached(fm, f, context);\n                    injectFragment(f, activity);\n                }\n            };\n            ((FragmentActivity) activity).getSupportFragmentManager()\n                    .registerFragmentLifecycleCallbacks(lifecycleCallbacks, true);\n        }\n    }\n\n    private static void injectFragment(@NotNull Fragment f, @NotNull Activity activity) {\n        if (f instanceof Injectable) {\n            SdkAndroidInjection.inject(f);\n        } else if (f instanceof MvpInjectable) {\n            // MVP çš„ Fragment æ³¨å…¥\n            MvpModule.MvpComponent mvpComponent = SdkInjector.getSdkComponent()\n                    .mvpComponentBuilder()\n                    .activityProvider(new AndroidProvider<>(activity))\n                    .fragmentProvider(new AndroidProvider<>(f))\n                    .build();\n            MvpContainer mvpContainer = mvpComponent.inject(new MvpContainer(mvpComponent));\n            SdkAndroidInjection.inject(f, mvpContainer);\n        } else {\n            Log.w(TAG, \"Warning! You fragment  \" + f.getClass().getSimpleName() + \" is not injectable!\");\n        }\n    }\n}\n```\n\n### è§£å†³æ–¹æ¡ˆå…³é”®ç‚¹è¯´æ˜\n\næˆ‘ä»¬è€ƒè™‘ä¸‹æ™®é€šçš„MVPæ³¨å…¥è¿‡ç¨‹ä¸­ä¸ºä»€ä¹ˆéœ€è¦å¦‚æ­¤å¤šçš„æ¨¡æ¿ä»£ç ã€‚\n\n1. ç”±äºPå±‚ä¾èµ–Vï¼Œè€Œ V å±‚æ˜¯Activityï¼Œæ˜¯ç³»ç»Ÿç”Ÿæˆçš„ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åªèƒ½åœ¨onCreate å›è°ƒä¸­è·å–åˆ°Activityï¼Œç„¶åå°†å…¶å¡åˆ°Daggerçš„ä¾èµ–å¯¹è±¡çš„å›¾è°±ä¸­ï¼Œä¹Ÿå°±æ˜¯å¦‚ä¸‹ä»£ç æ‰€åšçš„\n\n   å³ï¼Œå¿…é¡»æ**ä¾›ä¸€ä¸ªModuleæ¥æ¥æ”¶Activity**å°†å…¶æ”¾å…¥åˆ°Daggerå¯¹è±¡Graphä¸­ï¼ŒåŒæ—¶ä¹Ÿå¿…é¡»åœ¨onCreateä¸­ä½ æ‰èƒ½è·å–åˆ°Activityã€‚\n\n   ```java\n   \t\t\t@Module\n         class MvpModule {\n             TestDiMvpActivityPresenter.TestDiView testDiView;\n     \n             public MvpModule(TestDiMvpActivityPresenter.TestDiView testDiView) {\n                 this.testDiView = testDiView;\n             }\n     \n             @Provides\n             public TestDiMvpActivityPresenter.TestDiView providerView() {\n                 return testDiView;\n             }\n         }\n   \n   \n   @Override\n   protected void onCreate(@Nullable  Bundle savedInstanceState) {\n   \t\t\tSdkInjector.getSdkComponent().testDiMvpActivityMComponentBuilder()\n           \t\t\t\t\t\t// å°†Activityå¡è¿›ä¾èµ–Graph\n                      .module(new TestDiMvpActivityModule.MvpModule(this)).build()\n                      .inject(this);\n   }\n   ```\n\n2. å¯¹äºæ— æ³•è‡ªåŠ¨æ³¨å…¥çš„å¯¹è±¡ï¼Œå¿…é¡»è¦é€šè¿‡ Component æä¾›ä¸€ä¸ª **inject æ–¹æ³•**ï¼Œç„¶åè°ƒç”¨injectæ–¹æ³•å®Œæˆå¯¹å…¶çš„æ‰‹åŠ¨æ³¨å…¥ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢onCreateæ–¹æ³•ä¸­æ‰€å†™çš„éƒ¨åˆ†ã€‚\n\n\n\n#### æ³¨å…¥é€»è¾‘ç§»åŠ¨åˆ°ActivityLifecycleCallbackå›è°ƒåŠé‡åˆ°çš„é—®é¢˜\n\nå®é™…ä¸Šï¼Œé€šè¿‡å‘Applicationæ³¨å†ŒActivityLifecycleCallbackå›è°ƒï¼Œæˆ‘ä»¬å¯ä»¥å°†å…·ä½“MvpActivityä¸­çš„onCreateé‡Œçš„æ³¨å…¥ä»£ç éšè—èµ·æ¥ï¼Œæˆ‘ä»¬åœ¨ä»”ç»†ç ”ç©¶ä¸‹onCreate ä¸­çš„æ³¨å…¥é€»è¾‘ï¼Œè€ƒè™‘å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜ï¼š\n\n```java\n@Override\nprotected void onCreate(@Nullable  Bundle savedInstanceState) {\n\t\t\tSdkInjector.getSdkComponent()\n        .testDiMvpActivityMComponentBuilder()\n        // å°†Activityå¡è¿›ä¾èµ–Graph\n        // 1âƒ£ï¸  å¡å…¥\n        .module(new TestDiMvpActivityModule.MvpModule(this)).build()\n        // 2âƒ£ï¸  æ³¨å…¥\n        .inject(this);\n}\n```\n\nè€ƒè™‘å¦‚ä¸‹ä¸¤ä¸ªåœ°æ–¹ï¼š\n\n1. å¡å…¥ï¼šåœ¨æ„é€ TestDiMvpActivityModule.MvpModuleæ—¶ï¼Œæˆ‘ä»¬å¿…é¡»è¦ä¼ å…¥ä¸€ä¸ªå…·ä½“ç±»å‹ï¼ˆTestDiMvpActivityï¼‰ï¼Œè€Œå¦‚æœæˆ‘ä»¬ç§»åŠ¨åˆ°ActivityLifecycleCallbackä¸­ä¹‹åï¼Œè¿™ä¸ªå…·ä½“çš„ç±»å‹ä¿¡æ¯ä¼šä¸¢å¤±ï¼›\n2. æ³¨å…¥ï¼šåœ¨injectæ—¶ï¼Œæˆ‘ä»¬çš„Componentä¸­å®šä¹‰çš„æ–¹æ³•ä¹Ÿæ˜¯éœ€è¦å…·ä½“ç±»å‹ä¿¡æ¯ï¼ˆTestDiMvpActivityï¼‰çš„ï¼Œå› ä¸ºè¿™æ ·Daggeræ‰èƒ½æ ¹æ®å…·ä½“ç±»å‹è·å–å…¶ä¾èµ–å“ªäº›ä¿¡æ¯ï¼Œç”Ÿæˆæ­£ç¡®çš„æ³¨å…¥ä»£ç ï¼Œè€Œç§»åŠ¨åˆ° ActivityLifecycleCallback ä¸­ä¹‹åï¼Œè¿™ä¸ªä¿¡æ¯ä¹Ÿä¼šä¸¢å¤±ï¼›\n\nä¹Ÿå°±æ˜¯è¯´ï¼Œç§»åŠ¨åˆ° ActivityLifecycleCallbackä¸­ä¹‹åï¼Œå…·ä½“çš„ç±»å‹ä¿¡æ¯ä¸¢å¤±äº†ï¼Œå¯¼è‡´æˆ‘ä»¬æ— æ³•æ­£ç¡®çš„è°ƒç”¨å¡å…¥æ–¹æ³•å’Œæ³¨å…¥æ–¹æ³•ã€‚\n\n#### ä½¿ç”¨ Dagger-Android ç”Ÿæˆ inject æ¨¡æ¿ä»£ç \n\nå¯¹äºinjectæ–¹æ³•æ¥è¯´ï¼Œæˆ‘ä»¬å®é™…ä¸Šå¯ä»¥ä½¿ç”¨ Dagger-Android çš„ `@ContributesAndroidInjector` æ¥å¸®åŠ©æˆ‘ä»¬è§£å†³ï¼›\n\n#### ä½¿ç”¨åŒ…è£…ç±»å‹é¿å…Daggerç±»å‹æ£€æŸ¥ï¼Œä½¿ç”¨provideræ–¹æ³•è¿˜åŸç±»å‹ä¿¡æ¯\n\nåœ¨å¡å…¥çš„è¿‡ç¨‹ä¸­ï¼Œç”±äºä¸¢å¤±äº†Activityçš„å…·ä½“ç±»å‹ä¿¡æ¯ï¼Œæˆ‘ä»¬å°†æ— æ³•é€šè¿‡ç±»å‹æ£€æŸ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º AndroidProvider çš„åŒ…è£…ç±»å‹ï¼Œæˆ‘ä»¬åœ¨æ„é€ ç»„ä»¶æ—¶ï¼ŒåŸå…ˆéœ€è¦TestDiMvpActivityè¿™ä¸ªå…·ä½“ç±»å‹ï¼Œç°åœ¨æˆ‘ä»¬åªéœ€è¦ä¼ å…¥æˆ‘ä»¬çš„åŒ…è£…ç±»å‹ï¼Œå¯ä»¥åšåˆ°ä»£ç ç»Ÿä¸€ã€‚\n\n```java\n// MVP çš„ Activity æ³¨å…¥\n            MvpModule.MvpComponent mvpActivityComponent = SdkInjector.getSdkComponent()\n              // TestDiMvpActivity ->  new AndroidProvider<Activity>(activity)\n                    .mvpComponentBuilder().activityProvider(new AndroidProvider<>(activity)).build();\n            MvpContainer mvpContainer = new MvpContainer(mvpActivityComponent);\n            mvpActivityComponent.inject(mvpContainer);\n            SdkAndroidInjection.inject(activity, mvpContainer);\n```\n\né‚£ä¹ˆæˆ‘ä»¬ä½•æ—¶å°†å…¶è¿˜åŸå‘¢ï¼Ÿ\n\nåœ¨æä¾›å¯¹åº”TestDiViewæ—¶ï¼Œæˆ‘ä»¬ç›´æ¥å¯¹å…¶è¿›è¡Œå¼ºåˆ¶è½¬æ¢ï¼Œç„¶åæä¾›ä¸º TestDiView ç±»å‹\n\n```java\n @Module\n    abstract class MvpProvider {\n        @Provides\n        static TestDiMvpActivityPresenter.TestDiView bindTestDiView(@Nullable AndroidProvider<Activity> activityProvider) {\n            if (activityProvider != null) {\n                return (TestDiMvpActivityPresenter.TestDiView) activityProvider.get();\n            } else {\n                throw new NullPointerException(\"Please provider activity provider when build component!\");\n            }\n        }\n}\n```\n\n##  ç¤ºä¾‹ä»£ç \n\n* [android-libraries/lib_di_sample at master Â· hanlyjiang/android-libraries (github.com)](https://github.com/hanlyjiang/android-libraries/tree/master/lib_di_sample)\n\n\n",
      "data": {
        "title": "Dagger åœ¨Androidåº“(SDK)æ¨¡å—ä¸­çš„ä½¿ç”¨å®è·µ",
        "date": "2022-03-06 15:11:54",
        "tags": [],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "æœ¬æ–‡ä¸»è¦æè¿°å¦‚ä½•ä½¿ç”¨Daggerè§£å†³å®é™…é¡¹ç›®ä¸­é‡åˆ°çš„é—®é¢˜ï¼Œè¿™ä¸¤ä¸ªé—®é¢˜æ˜¯ï¼š\n\n1. å¦‚ä½•åœ¨åº“ï¼ˆSDKï¼‰æ¨¡å—ä¸­ä½¿ç”¨Daggerä¾èµ–æ³¨å…¥ï¼Ÿ\n2. MVPä¸­çš„Daggerä¾èµ–æ³¨å…¥å¦‚ä½•å®ç°æ— æ„Ÿæ³¨å…¥ï¼Ÿ\n\næœ¬æ–‡ä¸ä¼šä»‹ç»å¦‚ä½•ä½¿ç”¨Daggerï¼Œåªä¸“æ³¨äºæè¿°å¦‚ä¸Šä¸¤ä¸ªé—®é¢˜çš„è§£å†³çš„å‰å› åæœåŠè§£å†³æ–¹æ¡ˆã€‚",
      "fileName": "dagger-zai-android-ku-sdkmo-kuai-zhong-de-shi-yong-shi-jian"
    },
    {
      "content": "\n\n\nå°† groovy ç¼–å†™çš„gradle è„šæœ¬è¿ç§»åˆ° kotlin dsl \n\n<!-- more -->\n\n\n## æ¦‚è¿°\n\n### IDE æ”¯æŒ\n\n|                          | Build import | Syntax highlighting <sub>1</sub> | Semantic editor <sub>2</sub> |\n| -----------------------: | :----------: | :------------------------------: | :--------------------------: |\n|            IntelliJ IDEA |    **âœ“**     |              **âœ“**               |            **âœ“**             |\n|           Android Studio |    **âœ“**     |              **âœ“**               |            **âœ“**             |\n|              Eclipse IDE |    **âœ“**     |              **âœ“**               |              âœ–               |\n|                    CLion |    **âœ“**     |              **âœ“**               |              âœ–               |\n|          Apache NetBeans |    **âœ“**     |              **âœ“**               |              âœ–               |\n| Visual Studio Code (LSP) |    **âœ“**     |              **âœ“**               |              âœ–               |\n|            Visual Studio |    **âœ“**     |                âœ–                 |              âœ–               |\n\n1. Gradle Kotlin DSL scripts ä¸­çš„Kotlinè¯­æ³•é«˜äº®\n2.  Gradle Kotlin DSL scripts ä¸­æ”¯æŒä»£ç è¡¥å…¨ï¼Œå¯¼èˆªåˆ°æºç ï¼Œæ–‡æ¡£æŸ¥çœ‹ï¼Œé‡æ„ç­‰ç­‰ï¼›\n\n### Kotlin DSL è„šæœ¬å‘½å\n\n#### å‘½å\n\nGroovy DSL script æ–‡ä»¶ä½¿ç”¨ `.gradle` æ‰©å±•æ–‡ä»¶å\n\nKotlin DSL script æ–‡ä»¶ä½¿ç”¨ `.gradle.kts` æ‰©å±•æ–‡ä»¶å\n\n#### æ¿€æ´»å¹¶ä½¿ç”¨ kotlin dsl\n\n* å°†è„šæœ¬æ–‡ä»¶å‘½åä¸º `.gradle.kts` å³å¯æ¿€æ´»ã€‚ä¹Ÿé€‚ç”¨äº [settings file](https://docs.gradle.org/current/userguide/build_lifecycle.html#sec:settings_file)ï¼ˆ `settings.gradle.kts`)å’Œ [initialization scripts](https://docs.gradle.org/current/userguide/init_scripts.html#init_scripts).\n* ä¸ºäº†å¾—åˆ°æ›´å¥½çš„IDEæ”¯æŒï¼Œå»ºè®®ä½¿ç”¨å¦‚ä¸‹å‘½åçº¦å®šï¼š\n  * Settingsè„šæœ¬å‘½åä¸º `*.settings.gradle.kts`ï¼ˆåŒ…æ‹¬æ‰€æœ‰ä»settingsè„šæœ¬ä¸­å¼•å…¥çš„è„šæœ¬ï¼‰\n  * [initialization scripts](https://docs.gradle.org/current/userguide/init_scripts.html#init_scripts) æŒ‰ `*.init.gradle.kts`çš„å‘½åæ¨¡å¼å‘½åï¼Œæˆ–è€…ç®€å•çš„å–åä¸º `init.gradle.kts`ã€‚\n* kotlin DSL æ„å»ºè„šæœ¬éšå¼çš„å¯¼å…¥äº†å¦‚ä¸‹å†…å®¹ï¼š\n  * [default Gradle API imports](https://docs.gradle.org/current/userguide/writing_build_scripts.html#script-default-imports)\n  * åœ¨`org.gradle.kotlin.dsl` å’Œ `org.gradle.kotlin.dsl.plugins.dsl` åŒ…ä¸­çš„Kotlin DSL API\n\n\n\n### kotlinä¸­è¯»å–è¿è¡Œæ—¶å±æ€§\n\n> [Gradle Kotlin DSL Primer](https://docs.gradle.org/current/userguide/kotlin_dsl.html#kotdsl:properties)\n\ngradle æ‹¥æœ‰ä¸¤ç§è¿è¡Œæ—¶å±æ€§:\n\n1.  [*project properties*](https://docs.gradle.org/current/userguide/build_environment.html#sec:project_properties) \n2. [*extra properties*](https://docs.gradle.org/current/userguide/writing_build_scripts.html#sec:extra_properties)\n\n#### é¡¹ç›®å±æ€§\n\nå¯ä»¥é€šè¿‡kotlinçš„ä»£ç†å±æ€§æ¥è®¿é—®:\n\n**build.gradle.kts**\n\n```kotlin\n// å±æ€§å¿…é¡»å­˜åœ¨\nval myProperty: String by project  \n// å±æ€§å¯ä»¥ä¸å­˜åœ¨\nval myNullableProperty: String? by project \n```\n\n#### extra å±æ€§\n\nextraå±æ€§åœ¨ä»»æ„å®ç°äº†[ExtensionAware](https://docs.gradle.org/current/dsl/org.gradle.api.plugins.ExtensionAware.html#org.gradle.api.plugins.ExtensionAware) æ¥å£çš„å¯¹è±¡ä¸Šéƒ½å¯ä»¥è®¿é—®; \n\n**build.gradle.kts**\n\n```kotlin\nval myNewProperty by extra(\"initial value\")   // â¶\nval myOtherNewProperty by extra { \"calculated initial value\" }   //â· \n\nval myProperty: String by extra   // â¸\nval myNullableProperty: String? by extra   // â¹\n```\n\nâ¶ åœ¨å½“å‰ä¸Šä¸‹æ–‡(å½“å‰ä¸ºprojectä¸­)åˆ›å»ºä¸€ä¸ªåä¸º`myNewProperty`æ–°çš„extraå±æ€§,å¹¶ä¸”åˆå§‹åŒ–å…¶å€¼ä¸º \"initial value\"\n\nâ· åŒ â¶ ï¼Œä¸è¿‡å±æ€§çš„åˆå§‹å€¼æ˜¯é€šè¿‡lamdbaè¡¨è¾¾å¼æ¥è®¡ç®—çš„;\n\nâ¸ ç»‘å®šå½“å‰ä¸Šä¸‹æ–‡(å½“å‰ä¸ºproject)ä¸­çš„å±æ€§åˆ°myPropertyå±æ€§ä¸­;\n\nâ¹ åŒ â¸ ï¼Œä¸è¿‡å…è®¸å€¼ä¸ºnullï¼›\n\n#### åœ¨å­é¡¹ç›®ä¸­è®¿é—®rootProjectçš„å±æ€§\n\n```kotlin\nval myNewProperty: String by rootProject.extra\n```\n\n> `by`æ˜¯kotlinçš„å…³é”®å­—ï¼Œè¡¨ç¤º provided by ï¼Œå³å±æ€§ç”±æŸä¸ªå…¶ä»–çš„å¯¹è±¡ä»£ç†\n\n#### åœ¨ä»»åŠ¡ä¸­å®šä¹‰å’Œä½¿ç”¨å±æ€§\n\nä»»åŠ¡ä¹Ÿç»§æ‰¿äº†ExtensionAwareï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ä»»åŠ¡ä¸­ä½¿ç”¨extraå±æ€§\n\n```kotlin\ntasks {\n    test {\n        val reportType by extra(\"dev\")  \n        doLast {\n            // Use 'suffix' for post processing of reports\n        }\n    }\n\n    register<Zip>(\"archiveTestReports\") {\n        val reportType: String by test.get().extra  \n        archiveAppendix.set(reportType)\n        from(test.get().reports.html.destination)\n    }\n}\n```\n\n#### é€šè¿‡mapæ ¼å¼å®šä¹‰å’Œè®¿é—®extraå±æ€§\n\n```kotlin\nextra[\"myNewProperty\"] = \"initial value\"   // â¶\n\ntasks.create(\"myTask\") {\n    doLast {\n        println(\"Property: ${project.extra[\"myNewProperty\"]}\")  // â· \n    }\n}\n```\n\n\n\n## è¿ç§»gradleæ„å»ºé€»è¾‘åˆ°Kotlin\n\n> å‚è€ƒæ–‡æ¡£ï¼š\n>\n> 1. [Migrating build logic from Groovy to Kotlin (gradle.org)](https://docs.gradle.org/current/userguide/migrating_from_groovy_to_kotlin_dsl.html)\n> 2. [Android Gradleè„šæœ¬ä»Groovyè¿ç§»åˆ°Kotlin DSL - åœ£éª‘å£«wind - åšå®¢å›­ (cnblogs.com)](https://www.cnblogs.com/mengdd/p/android-gradle-migrate-from-groovy-to-kotlin.html)\n\n### å‡†å¤‡groovyè„šæœ¬\n\n1. å¼•å·ç»Ÿä¸€ä¸ºåŒå¼•å·\n2. æ–¹æ³•è°ƒç”¨åŠ ä¸Šæ‹¬å·\n3. èµ‹å€¼æ“ä½œåŠ ä¸Šç­‰å·\n\n#### å¼•å·ç»Ÿä¸€\n\n* é€šè¿‡==âŒ˜â‡§R==å¿«æ·é”®è°ƒå‡ºæŸ¥æ‰¾æ›¿æ¢å·¥å…·çª—ï¼Œå°†æ–‡ä»¶åŒ¹é…è®¾ç½®ä¸º `.gradle` ï¼Œç„¶åå°†æ‰€æœ‰å•å¼•å·æ›¿æ¢ä¸ºåŒå¼•å·ã€‚\n\n* å®Œæˆä¹‹åé‡æ–°ä½¿ç”¨gradleæ–‡ä»¶åŒæ­¥é¡¹ç›®ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯\n\n#### èµ‹å€¼å’Œå±æ€§ä¿®æ”¹\n\n* å°†æ‰€æœ‰çš„èµ‹å€¼æ“ä½œæ·»åŠ ä¸Šç­‰å·\n* æ‰€æœ‰çš„å‡½æ•°è°ƒç”¨æ“ä½œæ·»åŠ æ‹¬å·\n\nè¿™é‡Œå°±éœ€è¦æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œè°ƒæ•´äº†ã€‚\n\n\n\n### é‡å‘½åæ–‡ä»¶\n\nå°† `.gradle`æ–‡ä»¶é‡å‘½åä¸º`.gradle.kts`ï¼Œé€šè¿‡å¦‚ä¸‹å‘½ä»¤å¯ä»¥å®Œæˆé‡å‘½åæ“ä½œ\n\n```shell\nfind . -name \"*.gradle\" -type f | xargs -I {} mv {} {}.kts\n```\n\n\n\n### å…¶ä»–å¸¸è§ä¿®æ”¹\n\n#### åœ¨kotlin rootProjectè„šæœ¬ä¸­è®¿é—® gradle å±æ€§\n\n```kotlin\nallprojects {\n    repositories {\n        maven {\n            name = \"Sonatype-Snapshots\"\n            setUrl(\"https://oss.sonatype.org/content/repositories/snapshots\")\n            credentials(PasswordCredentials::class.java) {\n                username = property(\"ossrhUsername\").toString()\n                password = property(\"ossrhPassword\").toString()\n            }\n        }\n        google()\n        jcenter()\n        mavenCentral()\n    }\n}\n```\n\n\n\n#### å®šä¹‰ä»»åŠ¡\n\n```kotlin\ntasks.register(\"clean\", Delete::class.java) {\n    group = \"build\"\n    delete(rootProject.buildDir)\n}\n```\n\n\n\n## è¿ç§»é…ç½®å®ä¾‹\n\n### rootProject kotlin dsl buildè„šæœ¬æ¨¡æ¿\n\n```kotlin\n// Top-level build file where you can add configuration options common to all sub-projects/modules.\nbuildscript {\n    // å®šä¹‰extra å±æ€§\n    val kotlin_version by extra(\"1.4.32\")\n    val android_gradle_build_version by extra(\"4.1.3\")\n    repositories {\n        maven { setUrl(\"https://maven.aliyun.com/repository/gradle-plugin\") }\n        maven { setUrl(\"https://maven.aliyun.com/repository/jcenter\") }\n        maven { setUrl(\"https://maven.aliyun.com/repository/google\") }\n        maven { setUrl(\"https://maven.aliyun.com/repository/public\") }\n        google()\n        jcenter()\n        mavenCentral()\n    }\n    dependencies {\n        classpath(\"com.android.tools.build:gradle:$android_gradle_build_version\")\n        classpath(\"org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version\")\n        // NOTE: Do not place your application dependencies here; they belong\n        // in the individual module build.gradle files\n    }\n}\n\nallprojects {\n    repositories {\n        maven { setUrl(\"https://maven.aliyun.com/repository/jcenter\") }\n        maven { setUrl(\"https://maven.aliyun.com/repository/google\") }\n        maven { setUrl(\"https://maven.aliyun.com/repository/gradle-plugin\") }\n        maven { setUrl(\"https://maven.aliyun.com/repository/public\") }\n        // åŠ å…¥é¡¹ç›®ä¸´æ—¶ä»“åº“ï¼Œæ–¹ä¾¿æµ‹è¯•\n        maven {\n            name = \"ProjectLocal-Snapshots\"\n            setUrl(File(rootProject.rootDir, \"local-maven-repo${File.separator}snapshots\"))\n        }\n        maven {\n            name = \"ProjectLocal-Release\"\n            setUrl(File(rootProject.rootDir, \"local-maven-repo${File.separator}release\"))\n        }\n\n        // åŠ å…¥ maven snapshot ä»“åº“åŠ release ä»“åº“\n        maven {\n            name = \"Sonatype-Snapshots\"\n            setUrl(\"https://oss.sonatype.org/content/repositories/snapshots\")\n        }\n        maven {\n            name = \"Sonatype-Staging\"\n            setUrl(\"https://oss.sonatype.org/service/local/staging/deploy/maven2/\")\n            credentials(PasswordCredentials::class.java) {\n                username = property(\"ossrhUsername\").toString()\n                password = property(\"ossrhPassword\").toString()\n            }\n        }\n        google()\n        mavenCentral()\n        jcenter()\n    }\n}\n\ntasks.register(\"clean\", Delete::class.java) {\n    group = \"build\"\n    delete(rootProject.buildDir)\n}\n```\n\n### æ¨¡å— build.gradle æ¨¡å—buildè„šæœ¬æ¨¡æ¿\n\n```kotlin\nplugins {\n    id(\"com.android.library\")\n    id(\"signing\")\n    // ç­‰åŒäº id(\"\")\n    `maven-publish`\n    kotlin(\"android\")\n    kotlin(\"android.extensions\")\n\n    // å¼•å…¥ä¸‰æ–¹Gradleæ’ä»¶\n    id(\"com.github.hanlyjiang.android_maven_pub\") version (\"0.0.9\") apply (false)\n}\n\nandroid {\n    compileSdkVersion(30)\n    buildToolsVersion(\"30.0.3\")\n\n    defaultConfig {\n        minSdkVersion(22)\n        targetSdkVersion(30)\n        versionCode(1)\n        versionName(\"1.0.0\")\n\n        testInstrumentationRunner(\"androidx.test.runner.AndroidJUnitRunner\")\n        consumerProguardFiles(\"consumer-rules.pro\")\n    }\n\n    buildTypes {\n        getByName(\"release\") {\n            minifyEnabled(false)\n            proguardFiles(\n                getDefaultProguardFile(\"proguard-android-optimize.txt\"),\n                \"proguard-rules.pro\"\n            )\n        }\n    }\n\n    compileOptions {\n        sourceCompatibility(JavaVersion.VERSION_1_8)\n        targetCompatibility(JavaVersion.VERSION_1_8)\n    }\n}\n\ndependencies {\n    implementation(\"org.jetbrains:annotations:21.0.1\")\n    testImplementation(\"junit:junit:4.13.2\")\n    androidTestImplementation(\"androidx.test.ext:junit:1.1.3\")\n    androidTestImplementation(\"androidx.test.espresso:espresso-core:3.4.0\")\n    \n    // StringRes æ³¨è§£\n    implementation(\"androidx.appcompat:appcompat:1.3.1\")\n    // æ³¨è§£åº“ https://developer.android.com/jetpack/androidx/releases/annotation#annotation-1.2.0\n    implementation(\"androidx.annotation:annotation:1.2.0\")\n}\n\n// åˆ›å»ºè‡ªå®šä¹‰ä»»åŠ¡\ntasks.create(\"showGitRepoInfo\") {\n    group = \"help\"\n    doLast {\n        println(\"${getGitBranch()}/${getGitRevision()}\")\n    }\n}\n\n// æ‰©å±•å‡½æ•°\nfun String.execute(): String {\n    val process = Runtime.getRuntime().exec(this)\n    return with(process.inputStream.bufferedReader()) {\n        readText()\n    }\n}\n\n/**\n * Get git revision with work tree status\n *\n * @return\n */\nfun getGitRevision(): String {\n    val rev = \"git rev-parse --short HEAD\".execute().trim()\n    val stat = \"git diff --stat\".execute().trim()\n    return if (stat.isEmpty()) {\n        rev\n    } else {\n        \"$rev-dirty\"\n    }\n}\n\n/**\n * Get git branch name\n *\n * @return\n */\nfun getGitBranch(): String {\n    return \"git rev-parse --abbrev-ref HEAD\".execute().trim()\n}\n```\n\n\n\n## é™åˆ¶/ä¸è¶³\n\nåœ¨ kotlin dsl è„šæœ¬ä¸­å¼•å…¥å…¶ä»–ç‹¬ç«‹çš„ kotlin çš„dsl è„šæœ¬ä¸æ–¹ä¾¿ï¼Œä¼šå­˜åœ¨æ— æ³•è¯†åˆ«ç›¸å…³ä¾èµ–å¯¹è±¡çš„é—®é¢˜ï¼Œéƒ¨åˆ†æƒ…å†µä¸‹è¿˜æ˜¯å¾—å¯¼å…¥ä½¿ç”¨ groovy ç¼–å†™çš„ gradle è„šæœ¬ã€‚\n\n\n\n\n",
      "data": {
        "title": "ä½¿ç”¨Kotlinç¼–å†™gradleè„šæœ¬",
        "date": "2022-02-24 22:29:04",
        "tags": [
          "Gradle"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "\n\n\nå°† groovy ç¼–å†™çš„gradle è„šæœ¬è¿ç§»åˆ° kotlin dsl ",
      "fileName": "shi-yong-kotlin-bian-xie-gradle-jiao-ben"
    },
    {
      "content": "\n\nè®°å½•ä¸‹ä½¿ç”¨Clioné…ç½®Arduinoå¼€å‘ç¯å¢ƒçš„è¿‡ç¨‹ã€‚\n\n<!-- more -->\n\n\n\nArduino å¼€å‘çš„ç¯å¢ƒæœ‰ä¸‹é¢å‡ ç§ï¼š\n\n1. Arduino IDEï¼šç›®å‰æœ‰1.8.x å’Œ 2.0.0 Betaç‰ˆæœ¬ï¼›\n2. VSCode + PlatformIOï¼›\n3. CLion + PlatformIOï¼›\n\nç›®å‰å·²ç»è¯•è¿‡äº†å‰é¢ä¸¤ç§ï¼Œéƒ½æ„Ÿè§‰ä¸æ˜¯å¾ˆæ»¡æ„ã€‚\n\n* Arduino IDEå¯¹ä»£ç è·³è½¬çš„æ”¯æŒä¸æ˜¯å¾ˆå¥½ï¼Œ2.0æ”¯æŒï¼Œ1.8ä¸æ”¯æŒï¼Œ2.0çš„é€‰æ‹©Arduinoçš„å¼€å‘æ¿è¿˜æ­£å¸¸ï¼Œä½†æ˜¯é€‰æ‹©esp32çš„æ¿å­ä¸€ç›´æ˜¾ç¤ºçº¢è‰²çš„è­¦å‘Šï¼Œæ— æ³•è·³è½¬ã€‚\n\n<img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/image/202112021303012.png\" alt=\"image-20211202130350932\" style=\"zoom: 50%;\" />\n\n* VSCode åˆ™æ˜¯å®åœ¨ç”¨ä¸ä¹ æƒ¯ã€‚ï¼ˆä¸»è¦æ˜¯ä¸€ç›´ç”¨AndroidStudioï¼Œæ“ä½œç†Ÿç»œäº†ï¼Œä¸æ„¿æ„å­¦ğŸ˜«ï¼‰\n\næ‰€ä»¥å‡†å¤‡å°è¯•ä¸‹CLionã€‚æµ‹è¯•ä¹‹åï¼Œæ„Ÿè§‰åˆ°äº†ç†Ÿæ‚‰çš„å‘³é“ğŸ˜‹ã€‚\n\n\n\n## ç¯å¢ƒè¯´æ˜\n\n* macOS 12.0.1\n* CLion 2021.2.3\n\n\n\n## å®‰è£… PlatformIO \n\n### å®‰è£…CLionæ’ä»¶\n\n* å®‰è£…æ’ä»¶ï¼Œå®‰è£…å®Œæˆä¹‹åï¼Œé‡å¯ä¸‹CLionã€‚\n\n<img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/image/202112021310220.png\" alt=\"image-20211202131036194\" style=\"zoom:50%;\" />\n\n\n\né‡å¯å®Œæˆä¹‹åï¼Œæ–°å»ºé¡¹ç›®æ—¶é€‰æ‹©ä¼šå‘ç°æç¤ºéœ€è¦å®‰è£…PlatformIO Core CLI\n\n<img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/image/202112021318583.png\" alt=\"image-20211202131833556\" style=\"zoom:50%;\" />\n\n### å®‰è£…Platform Core CLI\n\nmacOSä¸Šç›´æ¥ä½¿ç”¨ brew å®‰è£…å³å¯\n\n```shell\nbrew install platformio\n\n# æµ‹è¯•ä¸€ä¸‹\npio home\n# æ‰“å¼€ä¸€ä¸ªç½‘é¡µ http://127.0.0.1:8008\n```\n\n<img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/image/202112021512524.png\" alt=\"image-20211202151220500\" style=\"zoom:50%;\" />\n\n## è¿è¡Œç¤ºä¾‹\n\n### æ–°å»ºé¡¹ç›®\n\n<img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/image/202112021404249.png\" alt=\"image-20211202140453212\" style=\"zoom:50%;\" />\n\n> åˆæ¬¡åˆå§‹åŒ–çš„æŸç§æ¿å­çš„æ—¶å€™éœ€è¦ä¸‹è½½ä¸€äº›å·¥å…·é“¾ï¼Œæ­¤æ—¶å¯èƒ½ä¼šå¤±è´¥ï¼Œä¿è¯ç½‘ç»œè‰¯å¥½çš„æƒ…å†µä¸‹å¤šè¯•å‡ æ¬¡-é€‰ä¸­ `platformio.ini` æ–‡ä»¶å³é”®ï¼Œç„¶åé€‰æ‹© `PlatformIO`-`Re-Init`ã€‚\n>\n> <img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/image/202112021408296.png\" alt=\"image-20211202140817270\" style=\"zoom:50%;\" />\n\n### è¿è¡Œ\n\né€‰æ‹©PlatformIO Upload çš„è¿è¡Œé…ç½®ï¼Œç‚¹å‡»å°é”¤å­å³å¯ç¼–è¯‘ï¼Œç‚¹å‡»è¿è¡ŒæŒ‰é’®å³å¯ä¸Šä¼ åˆ°å¼€å‘æ¿è¿è¡Œï¼ˆä¼šè‡ªåŠ¨é€‰æ‹©ä¸²å£ï¼‰ã€‚\n\n<img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/image/202112021412112.png\" alt=\"image-20211202141206079\" style=\"zoom:50%;\" />\n\n### ä¸²å£è¿æ¥\n\n* æ‰¾åˆ°`Serial Monitor`å·¥å…·çª—å£\n* ç‚¹å‡»ğŸ”§è¿›è¡Œä¸²å£é…ç½®ç«¯å£åŠæ³¢ç‰¹ç‡ï¼Œç‚¹å‡»ğŸ”Œå›¾æ ‡è¿›è¡Œè¿æ¥ã€‚\n\n<img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/image/202112021414501.png\" alt=\"image-20211202141439470\" style=\"zoom:50%;\" />\n\n## ä¸‰æ–¹åº“å¯¼å…¥\nç›´æ¥åœ¨ `platformio.ini`æ–‡ä»¶ä¸­æ·»åŠ ä¾èµ–çš„é…ç½®å³å¯ï¼Œå¦‚ï¼š\n```ini\n[env:uno]\nplatform = atmelavr\nboard = uno\nframework = arduino\nlib_deps =\n    Wire @ ^1.0\n    fmalpartida/LiquidCrystal @ ^1.5.0\n```\n\nå¯¼å…¥äº† LiquidCrystal çš„åº“ï¼ˆä¾èµ–Wireï¼‰ï¼Œé…ç½®æ·»åŠ å®Œæˆä¹‹å `ReInit` ä¸€ä¸‹å³å¯ã€‚\n\né‚£ä¹ˆå»å“ªé‡ŒæŸ¥æ‰¾è¿™äº›åº“çš„åç§°åŠç‰ˆæœ¬ä¿¡æ¯å‘¢ï¼Ÿæ‰“å¼€ `pio home` ,åœ¨ç½‘é¡µä¸­å³å¯æŸ¥è¯¢ï¼Œç„¶åç›´æ¥å¤åˆ¶ç²˜è´´å³å¯ã€‚\n\n<img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/image/202112021511824.png\" alt=\"image-20211202151143802\" style=\"zoom:50%;\" />\n\n## ä½“éªŒ\n\n* ç¼–å†™ä»£ç ç®€ç›´ä¸è¦å¤ªæµç•…ã€‚\n* å¾ˆæ–¹ä¾¿çš„åœ¨ç¬¦å·ä¹‹é—´è·³è½¬ã€‚\n\n## å‚è€ƒ\n\n* [CLion â€” PlatformIO latest documentation](https://docs.platformio.org/en/latest//integration/ide/clion.html#installation)\n* [PlatformIO Core (CLI) â€” PlatformIO latest documentation](https://docs.platformio.org/en/latest/core/index.html)\n* PlatformIO ä¾èµ–åº“æŸ¥æ‰¾æ¡†æ¶ï¼š[Library Dependency Finder (LDF) â€” PlatformIO latest documentation](https://docs.platformio.org/en/latest/librarymanager/ldf.html)\n* [ESP-Prog â€” PlatformIO latest documentation](https://docs.platformio.org/en/latest/plus/debug-tools/esp-prog.html#debugging-tool-esp-prog)\n\n\n",
      "data": {
        "title": "CLionæ­å»ºArduinoå¼€å‘ç¯å¢ƒ",
        "date": "2021-12-02 14:16:46",
        "tags": [
          "Arduino"
        ],
        "published": true,
        "hideInList": false,
        "feature": "https://gitee.com/hanlyjiang/image-repo/raw/master/image/202112021512524.png",
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "\n\nè®°å½•ä¸‹ä½¿ç”¨Clioné…ç½®Arduinoå¼€å‘ç¯å¢ƒçš„è¿‡ç¨‹ã€‚",
      "fileName": "clion-da-jian-arduino-kai-fa-huan-jing"
    },
    {
      "content": "åŸºäºå®˜æ–¹æ–‡æ¡£æ•´ç†çš„é¸¿è’™å¼€å‘çš„åŸºç¡€çŸ¥è¯†\n<!-- more -->\n\n# Abilityæ¡†æ¶\n\n## ç®€ä»‹\n\n### æ•´ä½“å†…å®¹\n\n<img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/image/202111301012735.png\" alt=\"image-20211028145037926\" style=\"zoom: 50%;\" />\n\nåŒ`Android` å¯¹æ¯”å…³ç³»ï¼š\n\n* `FeatureAbility` - `Activity`\n* `ServiceAbility` - `Service`\n* `DataAbility` - `ContentProvider` \n* `CES` - å¹¿æ’­\n* `ANS` - é€šçŸ¥\n* çº¿ç¨‹é€šä¿¡\n  * `InnerEvent` - `Message`\n  * `EventHandler` - `Handler`\n  * `EventRunner` - `Looper`\n  * `EventQueue` - `MessageQueue`\n\n\n\n### Abilityè¯´æ˜\n\nåŒAndroid å•ç‹¬æä¾› Activityï¼ŒServiceï¼ŒContentProvider çš„åŸºç±»ä¸ä¸€æ ·ï¼Œé¸¿è’™è¿™ä¸‰ä¸ªç»„ä»¶å…¨éƒ½æ˜¯ç»§æ‰¿è‡ª Abilityï¼Œé‚£ä¹ˆå¦‚ä½•åŒºåˆ†ä¸€ä¸ªAbilityåˆ°åº•æ˜¯å“ªç§ç»„ä»¶å‘¢ï¼Ÿ\n\n* ç»§æ‰¿åå®ç°æ—¶é€‰æ‹©æ€§å®ç°å¯¹åº”ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼›\n\n* åœ¨ `config.json` ä¸­å®šä¹‰abilityæ—¶ï¼Œéœ€è¦å£°æ˜å¯¹åº”çš„ç±»å‹ï¼ˆpage-FAï¼›service - ServiceAbilityï¼› data - DataAbilityï¼‰\n\n  ```json\n  {\n      \"name\": \"com.hanlyjiang.ohosdemo.MainJSAbility2\",\n      \"icon\": \"$media:icon\",\n      \"description\": \"$string:mainjsability2_description\",\n      \"label\": \"$string:entry_MainJSAbility2\",\n      \"type\": \"page\",\n      \"launchType\": \"standard\",\n  },\n  {\n      \"name\": \"com.hanlyjiang.ohosdemo.ServiceAbility\",\n      \"icon\": \"$media:icon\",\n      \"description\": \"$string:serviceability_description\",\n      \"type\": \"service\"\n  },\n  {\n      \"name\": \"com.hanlyjiang.ohosdemo.DataAbility\",\n      \"icon\": \"$media:icon\",\n      \"description\": \"$string:dataability_description\",\n      \"type\": \"data\",\n      \"uri\": \"dataability://com.hanlyjiang.ohosdemo.DataAbility\"\n  }\n  ```\n\n## FAï¼ˆFeatureAbilityï¼‰\n\n### FA ç”Ÿå‘½å‘¨æœŸ\n\n| ç”Ÿå‘½å‘¨æœŸå›è°ƒ | è¯´æ˜                                      |\n| ------------ | ----------------------------------------- |\n| onStart      | é¦–æ¬¡åˆ›å»ºè§¦å‘ï¼Œä»…æ‰§è¡Œä¸€æ¬¡ éœ€è¦setMainRoute |\n| onActive     | è¿›å…¥å‰å°å¯äº¤äº’çŠ¶æ€åè°ƒç”¨                  |\n| onInactive   | Pageå¤±å»ç„¦ç‚¹æ—¶è°ƒç”¨                        |\n| onBackground | Pageä¸å†å¯è§ èµ„æºé‡Šæ”¾åŠè€—æ—¶ä¿å­˜æ“ä½œ       |\n| onForeground | é‡æ–°å›åˆ°å‰å°ï¼ˆè·å¾—ç„¦ç‚¹ é‡æ–°ç”³è¯·èµ„æº       |\n| onStop       | é”€æ¯é¡µé¢æ—¶è°ƒç”¨ é‡Šæ”¾ç³»ç»Ÿèµ„æº               |\n\nåŒ`Android`å¯¹æ¯”ï¼Œå…³ç³»å¦‚ä¸‹ï¼š\n\n![image-20211028144542021](https://gitee.com/hanlyjiang/image-repo/raw/master/image/202111301012429.png)\n\n| é¸¿è’™         | å®‰å“      |\n| ------------ | --------- |\n| onStart      | onCreate  |\n| onActive     | onResume  |\n| onInactive   | onPause   |\n| onBackground | onStop    |\n| onForeground | onRestart |\n| onStop       | onDestory |\n\n\n\n## Service Ability\n\nåŒ Android Serviceï¼Œæ²¡æœ‰ç•Œé¢ï¼Œå¯åå°è¿è¡Œï¼›\n\nä½†æ˜¯é¸¿è’™å¯ä»¥å¯åŠ¨/ç»‘å®šè¿œç¨‹è®¾å¤‡ä¸Šçš„æœåŠ¡ï¼ˆæŒ‡å®šè®¾å¤‡IDï¼‰ã€‚\n\n![ç‚¹å‡»æ”¾å¤§](https://gitee.com/hanlyjiang/image-repo/raw/master/image/202111301012611.jpg)\n\n\n\n# UIå¼€å‘æ¡†æ¶\n\n## ArkUI\n\n> å®˜æ–¹æ–‡æ¡£ï¼š [JS FAæ¦‚è¿°](https://developer.harmonyos.com/cn/docs/documentation/doc-guides/ui-js-fa-overview-0000000000585484)\n\n\n## ArkUI-JS UI\n\n> äº†è§£æ›´å¤šï¼š\n>\n> * [HarmonyOSåº”ç”¨å¼€å‘-æœåŠ¡å¼€å‘-å·¥å…·-HUAWEI DevEco Studioä½¿ç”¨æŒ‡å—-å·¥ç¨‹ç®¡ç†-HarmonyOSå·¥ç¨‹ä»‹ç»](https://developer.harmonyos.com/cn/docs/documentation/doc-guides/project_overview-0000001053822398)\n> * JS API å‚è€ƒï¼š[HarmonyOSåº”ç”¨å¼€å‘-æœåŠ¡å¼€å‘-JS APIå‚è€ƒ-æ‰‹æœºã€å¹³æ¿ã€æ™ºæ…§å±å’Œæ™ºèƒ½ç©¿æˆ´å¼€å‘-åŸºäºJSæ‰©å±•çš„ç±»Webå¼€å‘èŒƒå¼-æ¡†æ¶è¯´æ˜-æ–‡ä»¶ç»„ç»‡](https://developer.harmonyos.com/cn/docs/documentation/doc-references/js-framework-file-0000000000611396)\n\næ•´ä½“ä¸Šç±»ä¼¼ VUE & å¾®ä¿¡å°ç¨‹åº\n\n### å…³é”®è¯\n\n* `AceAbility`ï¼šåŠ è½½JSçš„Abilityçš„åŸºç±»å®ç°\n* `setInstanceName`ï¼š æŒ‡å®šAceAbilityåŠ è½½çš„jsç›®å½•ï¼ˆåŠ è½½å¤šä¸ªé€šè¿‡æ­¤æ–¹æ³•æŒ‡å®šjsç›®å½•ï¼‰\n\n### é¡¹ç›®ç»“æ„\n\n<img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/image/202111301012153.png\" alt=\"image-20211027164638077\" style=\"zoom:67%;\" />\n\n* `AceAbility` å­ç±»ï¼ˆä¸Šé¢å¯¹åº”çš„æ˜¯`MainJSAbility`ï¼‰\n* `default` ç›®å½•\n  * `app.js` ï¼š å…¨å±€çš„JavaScripté€»è¾‘æ–‡ä»¶å’Œåº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†\n  * `pages/index.js` : JS FA(JS ç•Œé¢) - ==å¯ä»¥æœ‰å¤šä¸ªpage==\n* `config.json`ï¼š js å£°æ˜\n\n### app.js\n\nåº”ç”¨ç”Ÿå‘½å‘¨æœŸå›è°ƒ\n\n```js\nexport default {\n    onCreate() {\n        console.info('AceApplication onCreate');\n    },\n    onDestroy() {\n        console.info('AceApplication onDestroy');\n    }\n};\n```\n\n### index.js(JS FA)\n\n* é¡µé¢ç”Ÿå‘½ç”Ÿå‘½å‘¨æœŸå›è°ƒ\n* é¡µé¢ä¸šåŠ¡é€»è¾‘(æ•°æ®ç»‘å®šï¼Œäº‹ä»¶å¤„ç†ç­‰)\n\n\n\n```js\nexport default {\n    data: {\n        title: \"\"\n    },\n    onInit() {\n        console.log(\"JS Page onInit\")\n    },\n    onActive(){\n        console.log(\"JS Page onActive\")\n    },\n    onInactive(){\n        console.log(\"JS Page onInactive\")\n    },\n    onShow(){\n        console.log(\"JS Page onShow\")\n    },\n    onHide(){\n        console.log(\"JS Page onHide\")\n    },\n    onDestroy(){\n        console.log(\"JS Page onDestroy\")\n    }\n}\n```\n\n### ç”Ÿå‘½å‘¨æœŸ\n\nè¯¦ç»†å‚è€ƒï¼š [HarmonyOSåº”ç”¨å¼€å‘-æœåŠ¡å¼€å‘-JS APIå‚è€ƒ-æ‰‹æœºã€å¹³æ¿ã€æ™ºæ…§å±å’Œæ™ºèƒ½ç©¿æˆ´å¼€å‘-åŸºäºJSæ‰©å±•çš„ç±»Webå¼€å‘èŒƒå¼-æ¡†æ¶è¯´æ˜-ç”Ÿå‘½å‘¨æœŸ](https://developer.harmonyos.com/cn/docs/documentation/doc-references/js-framework-lifecycle-0000001113708038)\n\n![img](https://gitee.com/hanlyjiang/image-repo/raw/master/image/202111301012303.png)\n\n\n\n```shell\nOHSO_DEMO:  Application initialized\nOHSO_DEMO:  MainAbility onStart\nOHSO_DEMO:  MainAbility onActive\n\n// æ‰“å¼€JS PAGE\nOHSO_DEMO:  MainAbility onInactive\nOHSO_DEMO:  MainJSAbility onStart\nJSApp:  app Log: AceApplication onCreateï¼ˆapp.jsï¼‰\nOHSO_DEMO:  MainJSAbility onActive\nJSApp:  app Log: JS Page onInit\nJSApp:  app Log: JS Page onActive\nJSApp:  app Log: JS Page onShow\nOHSO_DEMO:  MainAbility onBackground\n\n// åˆ‡æ¢æœ€è¿‘ä»»åŠ¡\nOHSO_DEMO:  MainJSAbility onInactive\nJSApp:  app Log: JS Page onInactive\nOHSO_DEMO:  MainJSAbility onBackground\nJSApp:  app Log: JS Page onHide\n\n// æ¢å¤\nOHSO_DEMO:  MainJSAbility onForeground\nJSApp:  app Log: JS Page onShow\nOHSO_DEMO:  MainJSAbility onActive\nJSApp:  app Log: JS Page onActive\n\n// å›é€€ï¼ˆé€€å‡ºJS PAGEï¼‰\nJSApp:  app Log: JS Page onHide\nJSApp:  app Log: JS Page onDestroy\nOHSO_DEMO:  MainJSAbility onInactive\nOHSO_DEMO:  MainAbility onInactive\nOHSO_DEMO:  MainAbility onActive\nOHSO_DEMO:  MainJSAbility onBackground\nOHSO_DEMO:  MainJSAbility onStop\nJSApp:  app Log: AceApplication onDestroy ï¼ˆapp.jsï¼‰\n```\n\n* JS çš„ç”Ÿå‘½å‘¨æœŸåœ¨Java Abilityçš„å†…éƒ¨ã€‚\n\n\n\n### HML \n\n> HMLï¼ˆHarmonyOS Markup Languageï¼‰æ˜¯ä¸€å¥—ç±»HTMLçš„æ ‡è®°è¯­è¨€ã€‚é€šè¿‡ç»„ä»¶ã€äº‹ä»¶æ„å»ºå‡ºé¡µé¢çš„å†…å®¹ã€‚é¡µé¢å…·å¤‡æ•°æ®ç»‘å®šã€äº‹ä»¶ç»‘å®šã€åˆ—è¡¨æ¸²æŸ“ã€æ¡ä»¶æ¸²æŸ“ç­‰é«˜çº§èƒ½åŠ›ã€‚\n\nå…·ä½“å¯å‚è€ƒï¼š [HarmonyOSåº”ç”¨å¼€å‘-æœåŠ¡å¼€å‘-JS APIå‚è€ƒ-æ‰‹æœºã€å¹³æ¿ã€æ™ºæ…§å±å’Œæ™ºèƒ½ç©¿æˆ´å¼€å‘-åŸºäºJSæ‰©å±•çš„ç±»Webå¼€å‘èŒƒå¼-æ¡†æ¶è¯´æ˜-è¯­æ³•-HMLè¯­æ³•å‚è€ƒ](https://developer.harmonyos.com/cn/docs/documentation/doc-references/js-framework-syntax-hml-0000000000611413)\n\n\n\n### index.CSS\n\nå‚è€ƒï¼š [HarmonyOSåº”ç”¨å¼€å‘-æœåŠ¡å¼€å‘-JS APIå‚è€ƒ-æ‰‹æœºã€å¹³æ¿ã€æ™ºæ…§å±å’Œæ™ºèƒ½ç©¿æˆ´å¼€å‘-åŸºäºJSæ‰©å±•çš„ç±»Webå¼€å‘èŒƒå¼-æ¡†æ¶è¯´æ˜-è¯­æ³•-CSSè¯­æ³•å‚è€ƒ](https://developer.harmonyos.com/cn/docs/documentation/doc-references/js-framework-syntax-css-0000000000611425)\n\n\n\n# é¸¿è’™ç‰¹æ€§\n\né¸¿è’™ç‰¹æœ‰çš„åŠŸèƒ½å’Œç‰¹æ€§ï¼Œä¸»è¦åŒ…æ‹¬ï¼šæœåŠ¡å¡ç‰‡ï¼Œæµè½¬ï¼Œåä¸ºåˆ†äº«åŠå¹³è¡Œè§†ç•Œã€‚\n\n## æœåŠ¡å¡ç‰‡\n\næœåŠ¡å¡ç‰‡ï¼ˆä»¥ä¸‹ç®€ç§°â€œå¡ç‰‡â€ï¼‰æ˜¯[FA](https://developer.harmonyos.com/cn/docs/documentation/doc-guides/glossary-0000000000029587#section5406185415236)çš„ä¸€ç§ç•Œé¢å±•ç¤ºå½¢å¼ï¼Œå°†FAçš„é‡è¦ä¿¡æ¯æˆ–æ“ä½œå‰ç½®åˆ°å¡ç‰‡ï¼Œä»¥è¾¾åˆ°æœåŠ¡ç›´è¾¾ï¼Œå‡å°‘ä½“éªŒå±‚çº§çš„ç›®çš„ã€‚æœåŠ¡å¡ç‰‡ä¹Ÿæ˜¯ä¸€ä¸ªFAï¼Œåªä¸è¿‡æ˜¯æ˜¾ç¤ºåœ¨å…¶ä»–åº”ç”¨ä¸­çš„ç•Œé¢ã€‚\n\nå¡ç‰‡å¸¸ç”¨äºåµŒå…¥åˆ°å…¶ä»–åº”ç”¨ï¼ˆå½“å‰åªæ”¯æŒç³»ç»Ÿåº”ç”¨ï¼‰ä¸­ä½œä¸ºå…¶ç•Œé¢çš„ä¸€éƒ¨åˆ†æ˜¾ç¤ºï¼Œå¹¶æ”¯æŒæ‹‰èµ·é¡µé¢ï¼Œå‘é€æ¶ˆæ¯ç­‰åŸºç¡€çš„äº¤äº’åŠŸèƒ½ã€‚å¡ç‰‡ä½¿ç”¨æ–¹è´Ÿè´£æ˜¾ç¤ºå¡ç‰‡ã€‚\n\n![img](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20210729150026.11448964563455945776572720158002:50520728101546:2800:FB99718B0883EC644C7B007DADE0F73F9A35B89CB4A68390F037D3A25D19B8B5.png?needInitFileName=true?needInitFileName=true)\n\nJava/JSå¡ç‰‡åœºæ™¯èƒ½åŠ›å·®å¼‚å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š\n\n| åœºæ™¯                 | Javaå¡ç‰‡                                                     | JSå¡ç‰‡                                                       | æ”¯æŒçš„ç‰ˆæœ¬          |\n| -------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------- |\n| å®æ—¶åˆ·æ–°ï¼ˆç±»ä¼¼æ—¶é’Ÿï¼‰ | Javaä½¿ç”¨ComponentProvideråšå®æ—¶åˆ·æ–°ä»£ä»·æ¯”è¾ƒå¤§                | JSå¯ä»¥åšåˆ°ç«¯ä¾§åˆ·æ–°ï¼Œä½†æ˜¯éœ€è¦å®šåˆ¶åŒ–ç»„ä»¶                       | HarmonyOS 2.0åŠä»¥ä¸Š |\n| å¼€å‘æ–¹å¼             | Java UIåœ¨å¡ç‰‡æä¾›æ–¹éœ€è¦åŒæ—¶å¯¹æ•°æ®å’Œç»„ä»¶è¿›è¡Œå¤„ç†ï¼Œç”ŸæˆComponentProviderè¿œç«¯æ¸²æŸ“ | JSå¡ç‰‡åœ¨ä½¿ç”¨æ–¹åŠ è½½æ¸²æŸ“ï¼Œæä¾›æ–¹åªè¦å¤„ç†æ•°æ®ã€ç»„ä»¶å’Œé€»è¾‘åˆ†ç¦»   | HarmonyOS 2.0åŠä»¥ä¸Š |\n| ç»„ä»¶æ”¯æŒ             | Textã€Imageã€DirectionalLayoutã€PositionLayoutã€DependentLayout | divã€listã€list-itemã€swiperã€stackã€imageã€textã€spanã€progressã€buttonï¼ˆå®šåˆ¶ï¼šchart ã€clockã€calendarï¼‰ | HarmonyOS 2.0åŠä»¥ä¸Š |\n| å¡ç‰‡å†…åŠ¨æ•ˆ           | ä¸æ”¯æŒ                                                       | æš‚ä¸å¼€æ”¾                                                     | HarmonyOS 2.0åŠä»¥ä¸Š |\n| é˜´å½±æ¨¡ç³Š             | ä¸æ”¯æŒ                                                       | æ”¯æŒ                                                         | HarmonyOS 2.0åŠä»¥ä¸Š |\n| åŠ¨æ€é€‚åº”å¸ƒå±€         | ä¸æ”¯æŒ                                                       | æ”¯æŒ                                                         | HarmonyOS 2.0åŠä»¥ä¸Š |\n| è‡ªå®šä¹‰å¡ç‰‡è·³è½¬é¡µé¢   | ä¸æ”¯æŒ                                                       | æ”¯æŒ                                                         | HarmonyOS 2.0åŠä»¥ä¸Š |\n\nç»¼ä¸Šæ‰€è¿°ï¼Œ==JSå¡ç‰‡æ¯”Javaå¡ç‰‡æ”¯æŒçš„æ§ä»¶å’Œèƒ½åŠ›éƒ½æ›´ä¸°å¯Œ==ï¼š\n\n- Javaå¡ç‰‡ï¼šé€‚åˆä½œä¸ºä¸€ä¸ªç›´è¾¾å…¥å£ï¼Œæ²¡æœ‰å¤æ‚çš„é¡µé¢å’Œäº‹ä»¶ã€‚\n- JSå¡ç‰‡ï¼šé€‚åˆæœ‰å¤æ‚ç•Œé¢çš„å¡ç‰‡ã€‚\n\n### å¡ç‰‡å¼€å‘ï¼ˆ[link](https://developer.harmonyos.com/cn/docs/documentation/doc-guides/ability-service-widget-provider-js-0000001150602175)ï¼‰\n\néœ€è¦é€šè¿‡ä¸€äº›å‚æ•°è¿›è¡Œé…ç½®ã€‚\n\n1. é…ç½®ï¼›\n2. FAä¸­å®ç°ç‰¹å®šçš„å›è°ƒæ–¹æ³•ç”¨æ¥å¤„ç†å¡ç‰‡çš„ç•Œé¢ç›¸å…³äº‹ä»¶\n\n> å¾…è¡¥å……\n\n## æœåŠ¡æµè½¬\n\n> [HarmonyOSåº”ç”¨å¼€å‘-æœåŠ¡å¼€å‘-ä¸“é¢˜-æµè½¬-æµè½¬æ¶æ„](https://developer.harmonyos.com/cn/docs/documentation/doc-guides/hop-architecture-0000001143104837)\n\nä¸¤ç§ç±»å‹ï¼š\n\n* è·¨ç«¯è¿ç§»\n* å¤šç«¯ååŒ\n\n### åŸºæœ¬æ¦‚å¿µ\n\n- æµè½¬ï¼šåœ¨HarmonyOSä¸­æ³›æŒ‡å¤šè®¾å¤‡åˆ†å¸ƒå¼æ“ä½œã€‚æµè½¬èƒ½åŠ›æ‰“ç ´è®¾å¤‡ç•Œé™ï¼Œå¤šè®¾å¤‡è”åŠ¨ï¼Œä½¿ç”¨æˆ·åº”ç”¨ç¨‹åºå¯åˆ†å¯åˆã€å¯æµè½¬ï¼Œå®ç°å¦‚é‚®ä»¶è·¨è®¾å¤‡ç¼–è¾‘ã€å¤šè®¾å¤‡ååŒå¥èº«ã€å¤šå±æ¸¸æˆç­‰åˆ†å¸ƒå¼ä¸šåŠ¡ã€‚æµè½¬ä¸ºå¼€å‘è€…æä¾›æ›´å¹¿çš„ä½¿ç”¨åœºæ™¯å’Œæ›´æ–°çš„äº§å“è§†è§’ï¼Œå¼ºåŒ–äº§å“ä¼˜åŠ¿ï¼Œå®ç°ä½“éªŒå‡çº§ã€‚æµè½¬æŒ‰ç…§ä½“éªŒå¯åˆ†ä¸º**è·¨ç«¯è¿ç§»**å’Œ**å¤šç«¯ååŒ**ã€‚\n- **è·¨ç«¯è¿ç§»**ï¼šä¸€ç§å®ç°ç”¨æˆ·åº”ç”¨ç¨‹åºæµè½¬çš„æŠ€æœ¯æ–¹æ¡ˆï¼ŒæŒ‡åœ¨Aç«¯è¿è¡Œçš„FAè¿ç§»åˆ°Bç«¯ä¸Šï¼Œå®Œæˆè¿ç§»åï¼Œ Bç«¯FAç»§ç»­ä»»åŠ¡ï¼Œè€ŒAç«¯åº”ç”¨é€€å‡ºã€‚åœ¨ç”¨æˆ·ä½¿ç”¨è®¾å¤‡çš„è¿‡ç¨‹ä¸­ï¼Œå½“ä½¿ç”¨æƒ…å¢ƒå‘ç”Ÿå˜åŒ–æ—¶ï¼ˆä¾‹å¦‚ï¼šä»å®¤å†…èµ°åˆ°æˆ·å¤–æˆ–è€…å‘¨å›´æœ‰æ›´åˆé€‚çš„è®¾å¤‡ç­‰ï¼‰ï¼Œä¹‹å‰ä½¿ç”¨çš„è®¾å¤‡å¯èƒ½å·²ç»ä¸é€‚åˆç»§ç»­å½“å‰çš„ä»»åŠ¡ï¼Œæ­¤æ—¶ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©æ–°çš„è®¾å¤‡æ¥ç»§ç»­å½“å‰çš„ä»»åŠ¡ã€‚å¸¸è§çš„è·¨ç«¯è¿ç§»åœºæ™¯å®ä¾‹ï¼š\n  - è§†é¢‘æ¥ç”µæ—¶ä»æ‰‹æœºè¿ç§»åˆ°æ™ºæ…§å±ï¼Œè§†é¢‘èŠå¤©ä½“éªŒæ›´ä½³ï¼Œæ‰‹æœºè§†é¢‘åº”ç”¨é€€å‡ºã€‚\n  - æ‰‹æœºä¸Šé˜…è¯»åº”ç”¨æµè§ˆæ–‡ç« ï¼Œè¿ç§»åˆ°å¹³æ¿ä¸Šç»§ç»­æŸ¥çœ‹ï¼Œæ‰‹æœºé˜…è¯»åº”ç”¨é€€å‡ºã€‚\n- **å¤šç«¯ååŒ**ï¼šä¸€ç§å®ç°ç”¨æˆ·åº”ç”¨ç¨‹åºæµè½¬çš„æŠ€æœ¯æ–¹æ¡ˆï¼ŒæŒ‡å¤šç«¯ä¸Šçš„ä¸åŒFA/PAåŒæ—¶è¿è¡Œã€æˆ–è€…äº¤æ›¿è¿è¡Œå®ç°å®Œæ•´çš„ä¸šåŠ¡ï¼›æˆ–è€…ï¼Œå¤šç«¯ä¸Šçš„ç›¸åŒFA/PAåŒæ—¶è¿è¡Œå®ç°å®Œæ•´çš„ä¸šåŠ¡ã€‚å¤šä¸ªè®¾å¤‡ä½œä¸ºä¸€ä¸ªæ•´ä½“ä¸ºç”¨æˆ·æä¾›æ¯”å•è®¾å¤‡æ›´åŠ é«˜æ•ˆã€æ²‰æµ¸çš„ä½“éªŒã€‚ä¾‹å¦‚ï¼šç”¨æˆ·é€šè¿‡æ™ºæ…§å±çš„åº”ç”¨Aæ‹ç…§åï¼ŒAå¯è°ƒç”¨æ‰‹æœºçš„åº”ç”¨Bè¿›è¡Œäººåƒç¾é¢œï¼Œæœ€ç»ˆå°†ç¾é¢œåçš„ç…§ç‰‡ä¿å­˜åœ¨æ™ºæ…§å±çš„åº”ç”¨Aã€‚å¸¸è§çš„å¤šç«¯ååŒåœºæ™¯å®ä¾‹è¿˜æœ‰ï¼š\n  - æ‰‹æœºä¾§åº”ç”¨Aåšæ¸¸æˆæ‰‹æŸ„ï¼Œæ™ºæ…§å±ä¾§åº”ç”¨Båšæ¸¸æˆæ˜¾ç¤ºï¼Œä¸ºç”¨æˆ·ç»„æˆä¸€ä¸ªå…¨æ–°çš„æ¸¸æˆä½“éªŒã€‚\n  - å¹³æ¿ä¾§åº”ç”¨Aåšç­”é¢˜æ¿ï¼Œæ™ºæ…§å±ä¾§åº”ç”¨Båšç›´æ’­ï¼Œä¸ºç”¨æˆ·ç»„æˆä¸€ä¸ªå…¨æ–°çš„ä¸Šç½‘è¯¾ä½“éªŒã€‚\n\n#### ä»»åŠ¡æµè½¬ç®¡ç†æœåŠ¡\n\nåœ¨æµè½¬å‘èµ·ç«¯ï¼Œæ¥å—ç”¨æˆ·åº”ç”¨ç¨‹åºæ³¨å†Œï¼Œæä¾›æµè½¬å…¥å£ã€çŠ¶æ€æ˜¾ç¤ºã€é€€å‡ºæµè½¬ç­‰ç®¡ç†èƒ½åŠ›ã€‚æµè½¬ä»»åŠ¡ç®¡ç†æœåŠ¡æä¾›çš„æ³¨å†Œã€è§£æ³¨å†Œã€æ˜¾ç¤ºè®¾å¤‡åˆ—è¡¨ã€ä¸ŠæŠ¥ä¸šåŠ¡çŠ¶æ€æ˜¯å®ç°è·¨ç«¯è¿ç§»çš„å‰æã€‚\n\n*ä»»åŠ¡æµè½¬ç®¡ç†æœåŠ¡*ç”±ä¸€ä¸ªå®ç°äº†æµè½¬ `IContinuationRegisterManager` æ¥å£çš„ç®¡ç†å™¨æä¾›ï¼ŒåŒ…æ‹¬å¦‚ä¸‹æ¥å£ï¼š\n\n* `register`ï¼šæ³¨å†Œå¹¶è¿æ¥åˆ°æµè½¬ä»»åŠ¡ç®¡ç†æœåŠ¡ã€‚\n* `showDeviceList`ï¼šæ˜¾ç¤ºç»„ç½‘å†…å¯é€‰æ‹©è®¾å¤‡åˆ—è¡¨ä¿¡æ¯ã€‚\n* `updateConnectStatus`ï¼šé€šçŸ¥æµè½¬ä»»åŠ¡ç®¡ç†æœåŠ¡æ›´æ–°å½“å‰ç”¨æˆ·ç¨‹åºçš„è¿æ¥çŠ¶æ€ï¼Œå¹¶åœ¨æµè½¬ä»»åŠ¡ç®¡ç†æœåŠ¡ç•Œé¢å±•ç¤ºç»™ç”¨æˆ·ã€‚\n* `disconnect`ï¼šåœ¨åº”ç”¨é€€å‡ºæ—¶ï¼Œä¸»åŠ¨è°ƒç”¨æ–­å¼€å’Œæµè½¬ä»»åŠ¡ç®¡ç†æœåŠ¡çš„è¿æ¥ã€‚\n* `unregister`ï¼šä»æµè½¬ä»»åŠ¡ç®¡ç†æœåŠ¡è§£æ³¨å†Œã€‚\n\nä¸€èˆ¬æµç¨‹æ˜¯: FA startæ—¶æ³¨å†Œï¼Œç„¶åæ˜¾ç¤ºè®¾å¤‡åˆ—è¡¨ï¼Œç”¨æˆ·é€‰æ‹©è®¾å¤‡åæ›´æ–°è¿æ¥çŠ¶æ€ã€‚é¡µé¢é”€æ¯æ—¶æ–­å¼€è¿æ¥å¹¶è§£é™¤æ³¨å†Œã€‚\n\n**éƒ¨åˆ†è®¾å¤‡ä¸Šæœ‰å†…ç½®çš„æµè½¬ç®¡ç†æœåŠ¡ï¼Œéƒ¨åˆ†è®¾å¤‡æ²¡æœ‰ã€‚**\n\n- å½“å‰ä»…æ‰‹æœºã€å¹³æ¿è®¾å¤‡æ”¯æŒæµè½¬ä»»åŠ¡ç®¡ç†æœåŠ¡ã€‚\n- å¦‚æœæ²¡æœ‰å†…ç½®çš„æµè½¬ä»»åŠ¡ç®¡ç†æœåŠ¡ï¼Œåˆ™éœ€è¦å¼€å‘è€…è‡ªè¡Œé€šè¿‡ DeviceManager å®ç°æµè½¬ä»»åŠ¡ç®¡ç†\n\n#### [è·¨ç«¯è¿ç§»æµç¨‹ï¼š](https://developer.harmonyos.com/cn/docs/documentation/doc-guides/hop-architecture-0000001143104837)\n\n![ç‚¹å‡»æ”¾å¤§](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20211101142614.png)\n\n> **è¯´æ˜**\n>\n> è·¨ç«¯è¿ç§»åï¼Œè®¾å¤‡Aä¸Šçš„åº”ç”¨éœ€è¦è‡ªè¡Œé€€å‡ºã€‚\n\n#### [å¤šç«¯ååŒæµç¨‹](https://developer.harmonyos.com/cn/docs/documentation/doc-guides/hop-architecture-0000001143104837)\n\n![ç‚¹å‡»æ”¾å¤§](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20211101142633.png)\n\n> **è¯´æ˜**\n>\n> è®¾å¤‡Aå’ŒBè¿›è¡Œå¤šç«¯ååŒåï¼Œè®¾å¤‡Aå’Œè®¾å¤‡Cé‡å¤å¦‚ä¸Šæµç¨‹ï¼Œå¯å®ç°è®¾å¤‡Aã€Bã€Cè¿›è¡Œå¤šç«¯ååŒï¼Œæ­¤æ—¶è®¾å¤‡Aæ˜¯ä¸­å¿ƒæ§åˆ¶ç‚¹ã€‚\n\n\n\n### è·¨ç«¯è¿ç§»å¼€å‘æµç¨‹\n\n#### æµç¨‹\n\næ•´ä½“æµç¨‹å¦‚ä¸‹ï¼š\n\n<img src=\"https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20211009142428.92713305432234037812857590541318:50521008090619:2800:FA3F702E046589CA52C8B1239687350203E8377D522BB15B8B25BF2F4F6BC475.png?needInitFileName=true?needInitFileName=true\" alt=\"img\" style=\"zoom:67%;\" />\n\n#### é™åˆ¶\n\n- æ¯ä¸ªåº”ç”¨æ³¨å†Œæµè½¬ä»»åŠ¡ç®¡ç†æœåŠ¡çš„`Ability`æ•°é‡ä¸Šé™ä¸º5ä¸ªï¼Œåç»­æ–°å¢æ³¨å†Œçš„Abilityä¼šå°†æœ€å¼€å§‹æ³¨å†Œçš„è¦†ç›–ã€‚\n- ä¸€ä¸ªåº”ç”¨å¯èƒ½åŒ…å«å¤šä¸ªFAï¼Œä»…éœ€è¦åœ¨æ”¯æŒè·¨ç«¯è¿ç§»çš„FAåŠå…¶æ‰€åŒ…å«çš„`AbilitySlice`ä¸­ï¼Œè°ƒç”¨æˆ–å®ç°ç›¸å…³æ¥å£ã€‚\n- è·¨ç«¯è¿ç§»ä¸æ”¯æŒä¸¤ä¸ªè®¾å¤‡ä¹‹é—´åˆ†åˆ«ç™»å½•ä¸åŒçš„å¸å·ï¼Œä¹Ÿå°±æ˜¯è¦æ±‚å¤šä¸ªè®¾å¤‡æ˜¯åŒå¸å·ã€‚\n- **è·¨ç«¯è¿ç§»ä¸æ”¯æŒå¯¹PAçš„è¿ç§»ï¼Œåªæ”¯æŒå¯¹FAçš„è¿ç§»**ã€‚\n- è·¨ç«¯è¿ç§»å®Œæˆæ—¶ï¼Œç³»ç»Ÿä¸ä¼šä¸»åŠ¨å…³é—­å‘èµ·è¿ç§»çš„FAï¼Œå¼€å‘è€…å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€è¦ï¼Œä¸»åŠ¨è°ƒç”¨`terminateAbility`æˆ–`stopAbility`å…³é—­FAï¼Œå¹¶è°ƒç”¨`updateConnectStatus()`æ›´æ–°è®¾å¤‡çš„è¿æ¥çŠ¶æ€ã€‚\n- é€šè¿‡`continueAbility`è¿›è¡Œè·¨ç«¯è¿ç§»è¿‡ç¨‹ä¸­ï¼Œè¿œç«¯FAé¦–å…ˆæ¥æ”¶åˆ°å‘èµ·ç«¯FAä¼ è¾“çš„æ•°æ®ï¼Œå†æ‰§è¡Œå¯åŠ¨ï¼Œå³`onRestoreData()`å‘ç”Ÿåœ¨`onStart()`ä¹‹å‰ã€‚\n- **è·¨ç«¯è¿ç§»çš„æ•°æ®å¤§å°é™åˆ¶200KBä»¥å†…ï¼Œå³`onSaveData`åªèƒ½ä¼ é€’200KBä»¥å†…çš„æ•°æ®ã€‚**\n- è¿ç§»ä¼ è¾“çš„æ•°æ®ï¼Œå½“å‰ä»…æ”¯æŒåŸºç¡€ç±»å‹æ•°æ®ä¼ é€’å’Œç³»ç»Ÿ`Sequenceable`å¯¹è±¡ï¼Œä¸æ”¯æŒè‡ªå®šä¹‰å¯¹è±¡åŠæ–‡ä»¶æ•°æ®ä¼ é€’ã€‚\n- FAæµè½¬è¿‡ç¨‹ä¸­ï¼Œåœ¨æµè½¬æœªå®Œæˆæ—¶å†æ¬¡è°ƒç”¨`continueAbility`å‘èµ·æµè½¬ï¼Œæ¥å£å°†ä¼šæŠ›å‡ºçŠ¶æ€å¼‚å¸¸ï¼Œåº”ç”¨éœ€è¦åŠ ä»¥é™åˆ¶å¤„ç†ã€‚\n- è·¨ç«¯è¿ç§»è¦æ±‚HarmonyOS 2.0ä»¥ä¸Šç‰ˆæœ¬æ‰èƒ½æ”¯æŒï¼Œæ³¨å†Œåˆ°æµè½¬ä»»åŠ¡ç®¡ç†æœåŠ¡æ—¶jsonParamsä¸­éœ€è¦å¢åŠ `{\"harmonyVersion\":\"2.0.0\"}`è¿‡æ»¤æ¡ä»¶ã€‚\n\n\n\n### å¤šç«¯ååŒå¼€å‘æµç¨‹\n\n#### æµç¨‹\n\nç›¸å¯¹è·¨ç«¯è¿ç§»ï¼Œå¤šäº† DeviceManager çš„å‚ä¸ï¼Œç”¨äºåˆå§‹åŒ–å’Œå…³é—­åˆ†å¸ƒå¼ç¯å¢ƒã€‚å¦å¤–ï¼Œè·¨ç«¯è¿ç§»åªæ¶‰åŠFAï¼Œè€Œå¤šç«¯ååŒéœ€è¦PAå‚ä¸ã€‚\n\n![img](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20211102112816.png)\n\n\n\nååŒå®é™…ä¸Šçš„æµç¨‹å°±æ˜¯ï¼Œé€šè¿‡startAbility å¯åŠ¨FAï¼ŒåŠPAï¼Œé€šè¿‡connectAbilityè¿æ¥åˆ°PAï¼Œç„¶åé€šè¿‡è¿œç¨‹PAæ¥è¿›è¡Œåä½œã€‚\n\n#### é™åˆ¶\n\n\n\n- æ¯ä¸ªåº”ç”¨æ³¨å†Œæµè½¬ä»»åŠ¡ç®¡ç†æœåŠ¡çš„Abilityæ•°é‡ä¸Šé™ä¸º5ä¸ªï¼Œåç»­æ–°å¢æ³¨å†Œçš„Abilityä¼šå°†æœ€å¼€å§‹æ³¨å†Œçš„è¦†ç›–ã€‚\n- **startAbilityã€connectAbilityä¸­è·¨è®¾å¤‡ä¼ é€’çš„intentæ•°æ®å¤§å°é™åˆ¶200KBä»¥å†…ã€‚**\n- ä¸æ”¯æŒä½¿ç”¨connectAbilityè§¦å‘è¿œç«¯PAçš„å…å®‰è£…ã€‚\n- **connectAbilityä¸­è·¨è®¾å¤‡ä¼ é€’çš„remoteObjectæ•°æ®å¤§å°é™åˆ¶200KBä»¥å†…ã€‚**\n- å¤šç«¯ååŒè¦æ±‚HarmonyOS 2.0ä»¥ä¸Šç‰ˆæœ¬æ‰èƒ½æ”¯æŒï¼Œæ³¨å†Œåˆ°æµè½¬ä»»åŠ¡ç®¡ç†æœåŠ¡æ—¶jsonParamsä¸­éœ€è¦å¢åŠ {\"harmonyVersion\":\"2.0.0\"}è¿‡æ»¤æ¡ä»¶ã€‚\n- stopAbilityä¸æ”¯æŒä¸¤ä¸ªè®¾å¤‡ä¹‹é—´åˆ†åˆ«ç™»å½•ä¸åŒçš„å¸å·ï¼Œä¹Ÿå°±æ˜¯è¦æ±‚å¤šä¸ªè®¾å¤‡æ˜¯åŒå¸å·ã€‚\n\n### ç¤ºä¾‹\n\nå‚è€ƒå®˜æ–¹ç¤ºä¾‹ï¼š\n\n* [ability/DistributedScheduler Â· HarmonyOS/harmonyos_app_samples - ç äº‘ - å¼€æºä¸­å›½ (gitee.com)](https://gitee.com/harmonyos/harmonyos_app_samples/tree/master/ability/DistributedScheduler)\n* [HarmonyOSåº”ç”¨å¼€å‘-æœåŠ¡å¼€å‘-ä¸“é¢˜-æµè½¬-HarmonyOSç«¯å‘èµ·å¤šç«¯ååŒ-å¤šç«¯ååŒå¼€å‘æŒ‡å¯¼](https://developer.harmonyos.com/cn/docs/documentation/doc-guides/hop-multi-device-collaboration-guidelines-0000001139737211#section27065313575)\n\n\n\n\n\n# å…¶ä»–\n\n\n## æ—¥å¿—è¾“å‡º\n\n### HiLog\n\n```java\n    static final HiLogLabel label = new HiLogLabel(HiLog.LOG_APP, MY_MODULE, \"MY_TAG\"); //MY_MODULE=0x00201\n    HiLog.warn(label, \"Failed to visit %{private}s, reason:%{public}d.\", url, errno);\n```\n\nè¾“å‡ºå¦‚ä¸‹ï¼š\n\n```shell\nResult: 05-26 11:01:06.870 1051 1051 W 00201/test: Failed to visit <private>, reason:503.\n```\n\n> æ³¨æ„ï¼š <private> éšè—äº†æœ¬è¯¥è¢«è¾“å‡ºçš„ url \n\n\n\n## å¯¹åº”æ¦‚å¿µ/ç±»\n\n* `LayoutBoost` -> `LayoutInflater`\n\n## å¸¸è§é—®é¢˜\n\n### éšè— ActionBar \n\nå°†å¦‚ä¸‹é…ç½®æ®µæ·»åŠ åˆ° module ä¸­ï¼Œæˆ–è€…æ·»åŠ åˆ° ability ä¸­ã€‚\n\n```json\n\t\"metaData\": {\n          \"customizeData\": [\n            {\n              \"name\": \"hwc-theme\",\n              \"value\": \"androidhwext:style/Theme.Emui.Light.NoTitleBar\"\n            }\n          ]\n    }\n```\n\n> æŒ‰ç†åº”è¯¥æä¾›ç›´æ¥å¯¹Abilityè®¾ç½®ä¸»é¢˜çš„é…ç½®æ–¹å¼ï¼Œä½†æ˜¯ä¸çŸ¥é“é…ç½®é¡¹ã€‚\n\n\n\n## HDC ä½¿ç”¨\n\nhdc è·¯å¾„ï¼š `$USER_HOME/Library/Huawei/sdk/toolchains/`\n\n* æŸ¥çœ‹å¸®åŠ©ï¼š `hdc help`\n\n  ä¸€èˆ¬ç”¨æ³•å¦‚ä¸‹ï¼š\n\n  ```shell\n  hdc [options] <command> [arguments]\n  ```\n\n* æŸ¥çœ‹è®¾å¤‡åˆ—è¡¨ï¼š `hdc list targets -v `\n\n* æŸ¥çœ‹æ—¥å¿—ï¼š hilog\n\n  ```\n  hdc hilog | grep com.hanlyjiang.ohosdemo\n  ```\n\n* æŸ¥çœ‹å¯è°ƒè¯•åº”ç”¨PIDåˆ—è¡¨ï¼š `hdc listpid`\n\n\n\n### ä½¿ç”¨æ‰‹æœºå†…çš„`android`å‘½ä»¤\n\nä½¿ç”¨ hdc shell è¿›å…¥æ‰‹æœºshellç¯å¢ƒï¼Œç„¶åå¯æ‰§è¡Œå¯¹åº”çš„androidå‘½ä»¤\n\n\n\nå¦‚ä¸‹ï¼Œé€šè¿‡`dumpsys activity services -p com.hanlyjiang.ohosdemo`å¯ä»¥çœ‹åˆ°å®é™…ä¸Š é¸¿è’™ä¸ºæˆ‘ä»¬çš„ `com.hanlyjiang.ohosdemo.pa.ServiceAbility` ç”Ÿæˆäº†ä¸€ä¸ªå¯¹åº”çš„shellServiceï¼ˆ`com.hanlyjiang.ohosdemo/.pa.ServiceAbilityShellService`ï¼‰\n\n```shell\n$ dumpsys activity services -p com.hanlyjiang.ohosdemo\nACTIVITY MANAGER SERVICES (dumpsys activity services)\n  User 0 active services:\n  * ServiceRecord{b2375c9 u0 com.hanlyjiang.ohosdemo/.pa.ServiceAbilityShellService}\n    intent={pkg=com.hanlyjiang.ohosdemo cmp=com.hanlyjiang.ohosdemo/.pa.ServiceAbilityShellService}\n    packageName=com.hanlyjiang.ohosdemo\n    processName=com.hanlyjiang.ohosdemo\n    baseDir=/data/app/com.hanlyjiang.ohosdemo-XmLCnshi-zSpv76TYXTvwA==/base.apk\n    dataDir=/data/user/0/com.hanlyjiang.ohosdemo\n    app=ProcessRecord{b340b59 7888:com.hanlyjiang.ohosdemo/u0a191}\n    createTime=-10m43s889ms startingBgTimeout=--\n    lastActivity=-10m43s889ms restartTime=-10m43s889ms createdFromFg=true\n    startRequested=true delayedStop=false stopIfKilled=true callStart=true lastStartId=1\n```",
      "data": {
        "title": "é¸¿è’™å¼€å‘åŸºç¡€çŸ¥è¯†",
        "date": "2021-11-30 10:13:11",
        "tags": [],
        "published": true,
        "hideInList": false,
        "feature": "https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20210729150026.11448964563455945776572720158002:50520728101546:2800:FB99718B0883EC644C7B007DADE0F73F9A35B89CB4A68390F037D3A25D19B8B5.png?needInitFileName=true?needInitFileName=true",
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "åŸºäºå®˜æ–¹æ–‡æ¡£æ•´ç†çš„é¸¿è’™å¼€å‘çš„åŸºç¡€çŸ¥è¯†",
      "fileName": "hong-meng-kai-fa-ru-men"
    },
    {
      "content": "\n\nä»githubä¸‹è½½ LiquidCrystal çš„åº“ï¼Œå®‰è£…åˆ°Arduino IDEï¼Œå¹¶ç‚¹äº®1602 LCDã€‚\n\n<!-- more -->\n\n\n\nå‡†å¤‡ä½¿ç”¨Arduino UNOç‚¹äº®ä¸€ä¸ªLCD1602ï¼Œå‘ç°ArduinoIDEï¼ˆæˆ‘ç”¨çš„2.0Betaç‰ˆæœ¬ï¼‰ä¸­é»˜è®¤æ²¡æœ‰å®‰è£… LiquidCrystal çš„åº“ï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨è¿›è¡Œå®‰è£…ã€‚\n\n## å®‰è£…\n\nç¬¬ä¸€ç§å®‰è£…æ–¹å¼æ˜¯ä»Arduino IDEçš„ Library Managerä¸­æœç´¢ğŸ”å¹¶å®‰è£…ã€‚å¦å¤–å°±æ˜¯æ‰‹åŠ¨å®‰è£…ï¼Œè¿™é‡Œæˆ‘ä»¬é‡‡å–æ‰‹åŠ¨å®‰è£…çš„æ–¹å¼ã€‚\n\n1. è®¿é—®å…¶githubä»“åº“ï¼ˆhttps://github.com/arduino-libraries/LiquidCrystalï¼‰ï¼Œä¸‹è½½ä¸ºzipåŒ…ï¼Œä¸‹è½½å®Œæ¯•åå°±æ˜¯ `LiquidCrystal-master.zip`\n\n2. æŒ‰å¦‚ä¸‹è·¯å¾„æ‰¾åˆ°æ·»åŠ  ZIP åº“çš„èœå•\n\n   <img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/image/202111300938313.png\" alt=\"image-20211130093814250\" style=\"zoom:50%;\" />\n\n3. é€‰æ‹©æˆ‘ä»¬çš„  `LiquidCrystal-master.zip` æ–‡ä»¶ï¼Œå®‰è£…å®Œæ¯•åé‡å¯ä¸€ä¸‹ Arduino IDEã€‚\n\n4. é‡æ–°æ‰“å¼€IDEï¼Œå³å¯çœ‹åˆ°ç¤ºä¾‹ä¸­å¤šäº†LiquidCrystal çš„ç¤ºä¾‹\n\n   <img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/image/202111300940469.png\" alt=\"image-20211130093952928\" style=\"zoom:50%;\" />\n\n## è¿è¡Œç¤ºä¾‹\n\nå¼€ä¸€ä¸ª Blink çš„ç¤ºä¾‹ï¼ŒæŒ‰å¦‚ä¸‹æ–¹å¼æ¥çº¿ã€‚\n\n![image-20211130094241742](https://gitee.com/hanlyjiang/image-repo/raw/master/image/202111300942772.png)\n\nè¿è¡Œä¹‹åæ•ˆæœï¼š\n\n*å¾…è¡¥å›¾ã€‚* å¯å‚è€ƒï¼š http://www.taichi-maker.com/homepage/reference-index/arduino-library-index/liquidcrystal-library/",
      "data": {
        "title": "Arduino LCDåº“å®‰è£…ä¸ä½¿ç”¨",
        "date": "2021-11-30 09:43:24",
        "tags": [
          "Arduino"
        ],
        "published": true,
        "hideInList": false,
        "feature": "https://gitee.com/hanlyjiang/image-repo/raw/master/image/202111300942772.png",
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "\n\nä»githubä¸‹è½½ LiquidCrystal çš„åº“ï¼Œå®‰è£…åˆ°Arduino IDEï¼Œå¹¶ç‚¹äº®1602 LCDã€‚",
      "fileName": "arduino-lcd-ku-an-zhuang-yu-shi-yong"
    },
    {
      "content": "\n<!-- more -->\n\n\nè¿™ä¸ªå¯¹äºå®‰å“å¼€å‘æ¥è¯´ï¼ŒGradleå¯ä»¥ä¸äº†è§£ï¼Œä½†æ˜¯åˆå¿…é¡»äº†è§£ã€‚\n\nè¯´ä¸éœ€è¦äº†è§£ï¼Œæ˜¯å› ä¸ºï¼š é€šè¿‡AndroidStudioå»ºç«‹å·¥ç¨‹çš„æ—¶å€™ï¼Œé»˜è®¤å°±åˆ›å»ºå¥½äº†Gradleçš„é¡¹ç›®ç»“æ„åŠå¯¹åº”çš„ä»»åŠ¡ï¼Œé€šè¿‡IDEæ¥æ·»åŠ æ¨¡å—çš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥è‡ªåŠ¨çš„æ·»åŠ Gradleçš„é…ç½®ã€‚\n\nè¯´éœ€è¦äº†è§£ï¼Œæ˜¯å› ä¸ºï¼šæœ‰æ—¶å€™ä¼šé‡åˆ°æ„å»ºé”™è¯¯ï¼Œè¿˜æœ‰æ—¶å€™éœ€è¦æ”¹ä¸€æ”¹æ„å»ºæµç¨‹çš„é»˜è®¤è¡Œä¸ºï¼Œå¦å¤–æœ‰äº›æ—¶å€™ï¼Œéœ€è¦è‡ªè¡Œæ‰©å±•ä¸€ä¸ªæ„å»ºä»»åŠ¡ã€‚\n\n\n\nGradleå­¦ä¹ çš„ä¸€ä¸ªéš¾ç‚¹åœ¨äºï¼Œå…¶å­¦ä¹ èµ„æ–™éå¸¸é›¶æ•£ï¼Œå°‘æœ‰æˆä½“ç³»çš„å­¦ä¹ èµ„æ–™ã€‚å½“ç„¶ï¼Œå®˜æ–¹æ–‡æ¡£æ˜¯å¾ˆæˆä½“ç³»çš„ï¼Œå®˜æ–¹æ–‡æ¡£ä¹Ÿæœ‰ä¸å¥½çš„åœ°æ–¹ï¼š\n\n1. çº¯è‹±æ–‡ï¼›\n2. ç‰ˆæœ¬æ›´æ–°ä¹‹åï¼Œæ–‡æ¡£ç»“æ„æœ‰å˜åŒ–ã€‚\n3. å®˜æ–¹æ–‡æ¡£å¯¹äºå®‰å“é¡¹ç›®çš„è¯´æ˜æ²¡æœ‰ï¼ˆå› ä¸ºandroidçš„æ’ä»¶æ˜¯googleè‡ªè¡Œæ‰©å±•çš„ï¼‰\n\n\n\nè¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œå‰æœŸgradleçš„è„šæœ¬éƒ½æ˜¯ä½¿ç”¨groovyæ¥ç¼–å†™ï¼Œæˆ‘ä»¬è¦å†™è„šæœ¬ï¼Œéœ€è¦å»å­¦ä¹ ä¸€é—¨æ–°çš„è¯­è¨€ï¼Œè™½ç„¶è¿™ä¸ªè¯­è¨€å’Œjavaæ¯”è¾ƒæ¥è¿‘ï¼Œä½†æ˜¯ç”±äºæ²¡ä»€ä¹ˆå…¶ä»–ç”¨é€”ï¼ŒåŠ ä¸Šéœ€è¦ç¼–å†™gradleè„šæœ¬çš„åœºæ™¯ä¹Ÿä¸æ˜¯é‚£ä¹ˆå¸¸è§ï¼Œå°±ä¼šè®©è§‰å¾—æœ‰ç‚¹ä¸å€¼å¾—æŠ•å…¥ï¼Œè¿™ä¸¤ä¸ªå› ç´ ç»“åˆèµ·æ¥ï¼Œä¼šåŠé€€å¾ˆå¤šå®‰å“å¼€å‘äººå‘˜ã€‚ç°åœ¨ï¼Œgradleå¯ä»¥ä½¿ç”¨kotlinæ¥ç¼–å†™å…¶dslè„šæœ¬ï¼Œå­¦ä¹ æˆæœ¬ä¼šé™ä½å¾ˆå¤šã€‚\n\n\n\nè§åˆ°å…¶wrapperçš„è®¾è®¡ä»¤æˆ‘å°è±¡æ·±åˆ»ï¼Œå¯¹æ¯”antåŠmavenéœ€è¦æ‰‹åŠ¨å»ä¸‹è½½ä¸€ä»½äºŒè¿›åˆ¶å‰¯æœ¬ï¼Œç„¶åé…ç½®åˆ°ç¯å¢ƒå˜é‡ä¸­ï¼Œè€Œä½ è·å–åˆ°åˆ«äººçš„gradleé¡¹ç›®ä¹‹åï¼Œç›´æ¥ä½¿ç”¨wrapperè„šæœ¬ï¼Œå°±å¯ä»¥æ‰§è¡Œgradleä»»åŠ¡ï¼Œwrapperè„šæœ¬ä¼šè‡ªåŠ¨å¸®åŠ©ä½ å»è·å–ä¸€ä»½gradleçš„äºŒè¿›åˆ¶å‰¯æœ¬ï¼Œå°±å¥½åƒä½ ç›´æ¥æ‰§è¡Œgradleçš„äºŒè¿›åˆ¶å‘½ä»¤ä¸€æ ·ã€‚\n\nå¦å¤–gradleä¹Ÿæä¾›äº†æ–¹ä¾¿çš„æ‰©å±•æœºåˆ¶ï¼Œèƒ½å¯¹æ„å»ºæµç¨‹è¿›è¡Œå®šåˆ¶ã€‚\n\n\n\næ¥ä¸‹æ¥ï¼Œæˆ‘å°†ä»å®‰å“å¼€å‘çš„è§†è§’ï¼Œå¯¹Gradleçš„ä½¿ç”¨åšä¸€ä¸ªæ•´ä½“çš„ä»‹ç»ã€‚å†…å®¹ä¸Šä¼šåŒ…æ‹¬Gradleçš„ä¸€äº›åŸºç¡€æ¦‚å¿µï¼Œä¸€äº›å¸¸è§çš„Gradleä»»åŠ¡ä»‹ç»ï¼ŒAndroidçš„å¸¸è§Gradleé…ç½®ä»‹ç»ï¼ŒåŒæ—¶ä¹Ÿä¼šä»‹ç»è‡ªå®šä¹‰Gradleä»»åŠ¡åŠGradleæ’ä»¶ã€‚",
      "data": {
        "title": "Gradleå­¦ä¹ æŒ‡å—-å‰è¨€",
        "date": "2021-10-07 22:07:09",
        "tags": [
          "Gradle",
          "Android"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "gradle-xue-xi-zhi-nan-qian-yan"
    },
    {
      "content": "é…ç½® android ä¸Šä¼ åˆ° maven ä¸­å¿ƒä»“åº“ï¼Œå‘ç°é…ç½®çš„ä»£ç æœ‰ç‚¹å¤šï¼Œè€Œä¸”å¦‚æœæœ‰å¤šä¸ªåº“æ¨¡å—éœ€è¦ä¸Šä¼ ï¼Œåˆ™éœ€è¦å¤åˆ¶ç²˜è´´ä¸å°‘é‡å¤çš„é…ç½®ä»£ç ï¼Œäºæ˜¯ç¼–å†™äº†ä¸€ä¸ª gradle æ’ä»¶ç”¨äºç®€åŒ–æå–è¿™ä¸ªé…ç½®è¿‡ç¨‹ï¼›\n\n<!-- more -->\n\n## æ’ä»¶ç”¨é€”åŠæ•ˆæœ\n\næœ¬æ’ä»¶ç”¨äºç®€åŒ–Androidåº“ä¸Šä¼ åˆ°Mavenä¸­å¿ƒä»“åº“çš„é…ç½®ï¼Œé¿å…æ¯ä¸ªprojectçš„gradleä¸­éƒ½æ”¾ç½®ä¸€ä»½é‡å¤è¾ƒå¤šçš„é…ç½®ï¼›\n\næ’ä»¶æœ‰å¦‚ä¸‹åŠŸèƒ½ï¼š\n1. ç®€åŒ– maven-publish æ’ä»¶çš„é…ç½®æµç¨‹ï¼›\n2. æ·»åŠ ä¸Šä¼ åˆ°Mavenä¸­å¿ƒä»“åº“çš„ publish ä»»åŠ¡ï¼›\n3. æ”¯æŒé…ç½®ä¸Šä¼ æ—¶æ˜¯å¦åŒ…å« javadoc åŠæºç ï¼›\n\n### ç›´æ¥ä½¿ç”¨maven-publishæ’ä»¶çš„é…ç½®ï¼š\n\n```kotlin\nimport org.gradle.api.publish.maven.MavenPom\n\nplugins {\n    id(\"com.android.library\")\n    id(\"signing\")\n    `maven-publish`\n}\n\nandroid {\n    defaultConfig {\n        versionName(\"1.0.0-SNAPSHOT\")\n    }\n}\n\ndependencies {\n   // \n}\n\ntasks.register(\"javadoc\", Javadoc::class.java) {\n    group = \"publishing\"\n    dependsOn(\"assemble\")\n    source = android.sourceSets[\"main\"].java.getSourceFiles()\n    classpath += project.files(android.bootClasspath + File.pathSeparator)\n    if (JavaVersion.current().isJava9Compatible) {\n        (options as StandardJavadocDocletOptions).addBooleanOption(\"html5\", true)\n    }\n    android.libraryVariants.forEach { libraryVariant ->\n        classpath += libraryVariant.javaCompileProvider.get().classpath\n    }\n    options.apply {\n        encoding(\"UTF-8\")\n        charset(\"UTF-8\")\n        isFailOnError = false\n\n        (this as StandardJavadocDocletOptions).apply {\n//            addStringOption(\"Xdoclint:none\")\n            links?.add(\"https://developer.android.google.cn/reference/\")\n            links?.add(\"http://docs.oracle.com/javase/8/docs/api/\")\n        }\n    }\n}\n\ntasks.register(\"jarSource\", Jar::class.java) {\n    group = \"publishing\"\n    from(android.sourceSets[\"main\"].java.srcDirs)\n    archiveClassifier.set(\"sources\")\n}\n\ntasks.register(\"jarJavadoc\", Jar::class.java) {\n    group = \"publishing\"\n    dependsOn(\"javadoc\")\n    val javadoc: Javadoc = tasks.getByName(\"javadoc\") as Javadoc\n    from(javadoc.destinationDir)\n    archiveClassifier.set(\"javadoc\")\n}\n\nfun getMyPom(): Action<in MavenPom> {\n    return Action<MavenPom> {\n        name.set(\"Android Common Utils Lib\")\n        description.set(\"Android Common Utils Library For HJ\")\n        url.set(\"https://github.com/hanlyjiang/lib_common_utils\")\n        licenses {\n            license {\n                name.set(\"The Apache License, Version 2.0\")\n                url.set(\"http://www.apache.org/licenses/LICENSE-2.0.txt\")\n            }\n        }\n        developers {\n            developer {\n                id.set(\"hanlyjiang\")\n                name.set(\"Hanly Jiang\")\n                email.set(\"hanlyjiang@outlook.com\")\n            }\n        }\n        scm {\n            connection.set(\"scm:git:git://github.com/hanlyjiang/lib_common_utils.git\")\n            developerConnection.set(\"scm:git:ssh://github.com/hanlyjiang/lib_common_utils.git\")\n            url.set(\"https://github.com/hanlyjiang/lib_common_utils\")\n        }\n    }\n}\n\n\nafterEvaluate {\n    publishing {\n        publications {\n            create<MavenPublication>(\"release\") {\n                from(components.getByName(\"release\"))\n                groupId = \"com.github.hanlyjiang\"\n                artifactId = \"android_common_utils\"\n                version = android.defaultConfig.versionName\n                pom(getMyPom())\n                // æ·»åŠ javadoc\n                artifact(tasks.getByName(\"jarJavadoc\") as Jar)\n                // æ·»åŠ source\n                artifact(tasks.getByName(\"jarSource\") as Jar)\n            }\n        }\n\n        repositories {\n            val ossrhCredentials = Action<PasswordCredentials> {\n                username = properties[\"ossrhUsername\"].toString()\n                password = properties[\"ossrhPassword\"].toString()\n            }\n            // sonarçš„ä»“åº“ï¼Œåœ°å€æ ¹æ®é¡¹ç›®çš„ç‰ˆæœ¬å·æ¥ç¡®å®šæ˜¯snapshotè¿˜æ˜¯æ­£å¼ä»“åº“\n            maven {\n                name = \"Sonartype\"\n\n                val releasesRepoUrl = uri(\"https://oss.sonatype.org/service/local/staging/deploy/maven2\")\n                val snapshotsRepoUrl = uri(\"https://oss.sonatype.org/content/repositories/snapshots/\")\n                url = if (android.defaultConfig.versionName.toString().endsWith(\"SNAPSHOT\")) snapshotsRepoUrl else releasesRepoUrl\n                credentials(ossrhCredentials)\n                // snapshotçš„åœ°å€ï¼š\n                // https://oss.sonatype.org/content/repositories/snapshots/com/github/hanlyjiang/android_common_utils/\n            }\n            // é¡¹ç›®æœ¬åœ°çš„ä»“åº“\n            maven {\n                name = \"ProjectLocal\"\n\n                val releasesRepoUrl = uri(layout.buildDirectory.dir(\"repos/releases\"))\n                val snapshotsRepoUrl = uri(layout.buildDirectory.dir(\"repos/snapshots\"))\n                url = if (android.defaultConfig.versionName.toString().endsWith(\"SNAPSHOT\")) snapshotsRepoUrl else releasesRepoUrl\n            }\n        }\n    }\n\n    signing {\n        sign(publishing.publications.getByName(\"release\"))\n    }\n\n}\n```\n\n### ä½¿ç”¨AndroidMavenPubPluginç®€åŒ–åçš„é…ç½®ï¼š\n\n```kotlin\nimport org.gradle.api.publish.maven.MavenPom\n\n\nplugins {\n    id(\"com.android.library\")\n    id(\"signing\")\n    `maven-publish`\n    // å¼•å…¥æˆ‘ä»¬æœ¬åœ°ä»“åº“ä¸­çš„gradleæ’ä»¶\n    id(\"com.github.hanlyjiang.android_maven_pub\") version (\"0.0.5\") apply (false)\n}\n\nandroid {\n    defaultConfig {\n        versionName(\"1.0.1-SNAPSHOT\")\n    }\n}\n\ndependencies {\n  // \n}\n\napply(plugin = \"com.github.hanlyjiang.android_maven_pub\")\n\nconfigure<io.hanlyjiang.gradle.android.AndroidMavenPubPluginExtension> {\n    groupId.set(\"com.github.hanlyjiang\")\n    artifactId.set(\"android-common-utils\")\n    projectLocalRepoPath.set(\"local-maven-repo\")\n    mavenPomAction.set(Action<MavenPom> {\n        name.set(\"Android Common Utils Lib\")\n        description.set(\"Android Common Utils Library For HJ\")\n        url.set(\"https://github.com/hanlyjiang/lib_common_utils\")\n        properties.set(\n            mapOf(\n                \"myProp\" to \"value\",\n                \"prop.with.dots\" to \"anotherValue\"\n            )\n        )\n        licenses {\n            license {\n                name.set(\"The Apache License, Version 2.0\")\n                url.set(\"http://www.apache.org/licenses/LICENSE-2.0.txt\")\n            }\n        }\n        developers {\n            developer {\n                id.set(\"hanlyjiang\")\n                name.set(\"Hanly Jiang\")\n                email.set(\"hanlyjiang@outlook.com\")\n            }\n        }\n        scm {\n            connection.set(\"scm:git:git://github.com/hanlyjiang/lib_common_utils.git\")\n            developerConnection.set(\"scm:git:ssh://github.com/hanlyjiang/lib_common_utils.git\")\n            url.set(\"https://github.com/hanlyjiang/lib_common_utils\")\n        }\n    })\n}\n```\n\n\n\n## ä½¿ç”¨æ­¥éª¤\n\n### å¼•å…¥æ’ä»¶\n\nåœ¨éœ€è¦ä½¿ç”¨çš„æ¨¡å—çš„buildè„šæœ¬ä¸­ï¼Œå¼•å…¥æˆ‘ä»¬çš„æ’ä»¶ï¼ŒåŒæ—¶å¼•å…¥ `maven-publish` æ’ä»¶å’Œ` signing` æ’ä»¶ã€‚\n\n#### kotlin.kts è„šæœ¬å†™æ³•\n\n```kotlin\nplugins {\n    id(\"com.android.library\")\n    \n    // å¼•å…¥signingæ’ä»¶\n    id(\"signing\")\n    // å¼•å…¥maven-publishæ’ä»¶\n    `maven-publish`\n    // å¼•å…¥ android_maven_pub æ’ä»¶ï¼Œæ³¨æ„è¿™é‡Œè®¾ç½® apply ä¸º falseï¼Œè¡¨ç¤ºå¼•å…¥ä½†æ˜¯ä¸åº”ç”¨ï¼Œæˆ‘ä»¬éœ€è¦æ”¾åœ¨androidé…ç½®æ®µå®šä¹‰ä¹‹åå†åº”ç”¨\n    id(\"com.github.hanlyjiang.android_maven_pub\") version (\"0.0.5\") apply (false)\n}\n```\n\n\n\n#### groovy çš„å†™æ³•\n\n```groovy\nplugins {\n    id 'com.android.library'\n    id 'signing'\n    id 'maven-publish'\n    id(\"com.github.hanlyjiang.android_maven_pub\") version(\"0.0.5\") apply(false)\n}\n```\n\n### é…ç½® gradle \n\nåœ¨å¼•å…¥  AndroidMavenPubPlugin æ’ä»¶ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ’ä»¶è¿›è¡Œé…ç½®ã€‚ å»ºè®®å°†è„šæœ¬è½¬æ¢ä¸º kotlin dsl çš„å†™æ³•ï¼Œèƒ½æœ‰å¯¹åº”çš„è‡ªåŠ¨æç¤ºï¼›\n\n#### kotlin dsl å†™æ³•\n\n```kotlin\nandroid {\n    \n}\n\n// éœ€è¦å…ˆåº”ç”¨æ’ä»¶ï¼Œåœ¨androidé…ç½®å®Œæˆä¹‹åï¼Œå»ºè®®æ”¾åœ¨è„šæœ¬æœ€ä¸‹æ–¹\napply(plugin = \"com.github.hanlyjiang.android_maven_pub\")\n\nconfigure<io.hanlyjiang.gradle.android.AndroidMavenPubPluginExtension> {\n    groupId.set(\"com.github.hanlyjiang\")\n    artifactId.set(\"android_common_utils\")\n    mavenPomAction.set(Action<MavenPom> {\n        name.set(\"Android Common Utils Lib\")\n        description.set(\"Android Common Utils Library For HJ\")\n        url.set(\"https://github.com/hanlyjiang/lib_common_utils\")\n        properties.set(\n            mapOf(\n                \"myProp\" to \"value\",\n                \"prop.with.dots\" to \"anotherValue\"\n            )\n        )\n        licenses {\n            license {\n                name.set(\"The Apache License, Version 2.0\")\n                url.set(\"http://www.apache.org/licenses/LICENSE-2.0.txt\")\n            }\n        }\n        developers {\n            developer {\n                id.set(\"hanlyjiang\")\n                name.set(\"Hanly Jiang\")\n                email.set(\"hanlyjiang@outlook.com\")\n            }\n        }\n        scm {\n            connection.set(\"scm:git:git://github.com/hanlyjiang/lib_common_utils.git\")\n            developerConnection.set(\"scm:git:ssh://github.com/hanlyjiang/lib_common_utils.git\")\n            url.set(\"https://github.com/hanlyjiang/lib_common_utils\")\n        }\n    })\n}\n```\n#### groovy è„šæœ¬å†™æ³•\n```groovy\napply plugin: \"com.github.hanlyjiang.android_maven_pub\"\n\nandroid_maven_pub {\n    groupId.set(\"com.github.hanlyjiang\")\n    artifactId.set(\"android-common-utils\")\n    mavenPomAction.set({ pom ->\n        pom.with {\n            name.set('HJ Android Plugin Framework')\n            description.set(\"A Android Plugin Framework\")\n            url.set(\"https://github.com/hanlyjiang/apf-library\")\n            licenses {\n                license {\n                    name = 'The Apache Software License, Version 2.0'\n                    url = 'http://www.apache.org/licenses/LICENSE-2.0.txt'\n                }\n            }\n            developers {\n                developer {\n                    id = 'hanlyjiang'\n                    name = 'hanly jiang'\n                    email = 'hanlyjiang@outlook.com'\n                }\n            }\n            scm {\n                connection = 'https://github.com/hanlyjiang/apf-library'\n                developerConnection = 'https://github.com/hanlyjiang/apf-library.git'\n                url = 'https://github.com/hanlyjiang/apf-library'\n            }\n        }\n    } as Action<MavenPom>)\n}\n\n```\n\n> âš ï¸**æ³¨æ„**ï¼š \n>\n> * å¯ä»¥çœ‹åˆ°æˆ‘ä»¬è¿™é‡Œå¹¶æ²¡æœ‰å®šä¹‰ç‰ˆæœ¬å·ï¼Œç‰ˆæœ¬å·ä» `android.defaultConfig.versionName` ä¸­å– ï¼›\n>\n> * åŒæ—¶ï¼Œå¦‚æœç‰ˆæœ¬å·ç»“å°¾ä¸º `-SNAPSHOT`ï¼Œåˆ™ä¼šå‘å¸ƒåˆ° snapshot ä»“åº“ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™å‘å¸ƒåˆ° release ä»“åº“ï¼›\n\n### mavenä»“åº“çš„å±æ€§æ–‡ä»¶é…ç½®\n\nä¸Šä¼ åˆ°maven centerä¸­å¿ƒä»“åº“éœ€è¦è¿›è¡Œä¸€äº›è´¦å·ç”³è¯·å’Œkeyçš„ç”Ÿæˆæ“ä½œï¼Œå¯ä»¥å‚è€ƒ[Jcenter åœæ­¢æœåŠ¡ï¼Œè¯´ä¸€è¯´æˆ‘ä»¬çš„è¿ç§»æ–¹æ¡ˆ - InfoQ å†™ä½œå¹³å°](https://xie.infoq.cn/article/e2345e367a139f37fc2fc0bbb) æ¥å®Œæˆï¼Œæˆ‘ä»¬éœ€è¦å°†æœ€åè·å–åˆ°çš„è®¤è¯ä¿¡æ¯ï¼š\n\næŒ‰å¦‚ä¸‹é…ç½®ï¼Œå°†å¯¹åº”çš„ value çš„å€¼æ›´æ”¹ä¸ºè‡ªå·±çš„è´¦å·åŠ key çš„å¯¹åº”å€¼ï¼Œç„¶åå¡«å…¥åˆ° ` ~/.gradle/gradle.properties` ä¸­å³å¯\n\n```properties\n# é…ç½®mavenä¸­å¿ƒä»“åº“è®¿é—®è´¦å·\nossrhUsername=sonatype jira è´¦å·çš„ç”¨æˆ·å\nossrhPassword=sonatype jira è´¦å·çš„å¯†ç \n\n# é…ç½®ç­¾åä¿¡æ¯\nsigning.keyId=å…¬é’¥ ID çš„å 8 ä½\nsigning.password=é’¥åŒ™ä¸²çš„å¯†ç \nsigning.secretKeyRingFile=å¯¼å‡ºçš„ gpg æ–‡ä»¶è·¯å¾„ å¦‚ï¼š /Users/hanlyjiang/.gnupg/secring.gpg \n```\n\n> âš ï¸æ³¨æ„ï¼š è¿™é‡Œçš„ key æ˜¯å›ºå®šçš„ï¼Œä¸è¦ä¿®æ”¹\n\n### æ‰§è¡Œä¸Šä¼ ä»»åŠ¡\n\nç»è¿‡ä¸Šé¢çš„é…ç½®ï¼Œæˆ‘ä»¬åŒæ­¥ä¸‹ gradle ï¼Œå¯¹åº”å¼•å…¥äº†æ’ä»¶çš„é¡¹ç›®ä¸­ä¼šç”Ÿæˆè‹¥å¹²ä»»åŠ¡ï¼š\n\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20210531175716679.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21vc3B1aXRv,size_16,color_FFFFFF,t_70)\n\n\nå…¶ä¸­ï¼š\n\n* `jarJavadoc`, `jarSource`,`javadoc` ä¸ºæˆ‘ä»¬ç”Ÿæˆçš„è¾…åŠ©ä»»åŠ¡\n* `publish` åŠ `generate` å¼€å¤´çš„ä¸º `mave-publish` æ’ä»¶ç”Ÿæˆçš„ä»»åŠ¡ï¼Œæˆ‘ä»¬æ‰§è¡Œ `publish` ç›¸å…³çš„ä»»åŠ¡å³å¯å‘å¸ƒ maven åº“ï¼›\n\n`publish ` ç›¸å…³çš„ä»»åŠ¡æœ‰å¦‚ä¸‹å‡ ä¸ªï¼š\n\n| Task Name                                         | Description                                                  |\n| ------------------------------------------------- | ------------------------------------------------------------ |\n| publish                                           | ç­‰äºæ‰§è¡Œäº†ä¸‹é¢çš„æ‰€æœ‰ä»»åŠ¡                                     |\n| publishAllPublicationsToProjectLocalRepository    | å°†ç”±æ­¤é¡¹ç›®äº§ç”Ÿçš„æ‰€æœ‰Mavenåº“å‘å¸ƒåˆ° ProjectLocal å­˜å‚¨åº“ã€‚ ProjectLocal å®šä¹‰ä¸ºå½“å‰é¡¹ç›®çš„ build ç›®å½•çš„ `mavenRepos` ç›®å½•ä¸­ï¼Œæœ‰ä¸¤ä¸ªå­ç›®å½• `snapshots`åŠ `release`ï¼Œ æ–¹ä¾¿æŸ¥çœ‹å°†è¦å‘å¸ƒçš„ç”Ÿæˆç‰©åŠè¿›è¡Œæœ¬åœ°æµ‹è¯•ï¼› |\n| publishAllPublicationsToSonartypeRepository       | å°†ç”±æ­¤é¡¹ç›®äº§ç”Ÿçš„æ‰€æœ‰ Maven åº“å‘å¸ƒåˆ° Sonartype å­˜å‚¨åº“ã€‚       |\n| publishReleasePublicationToMavenLocal             | å°†ç”±æ­¤é¡¹ç›®äº§ç”Ÿçš„åä¸º`release`çš„ Mavenåº“å‘å¸ƒåˆ°æœ¬æœº maven ç¼“å­˜åº“ã€‚ |\n| publishReleasePublicationToProjectLocalRepository | å°†ç”±æ­¤é¡¹ç›®äº§ç”Ÿçš„åä¸º`release`çš„ Mavenåº“å‘å¸ƒåˆ°æœ¬æœº ProjectLocal åº“ã€‚ |\n| publishReleasePublicationToSonartypeRepository    | å°†ç”±æ­¤é¡¹ç›®äº§ç”Ÿçš„åä¸º`release`çš„ Mavenåº“å‘å¸ƒåˆ°æœ¬æœº Sonartype åº“ã€‚ |\n| publishToMavenLocal                               | å°†ç”±æ­¤é¡¹ç›®äº§ç”Ÿçš„æ‰€æœ‰ Maven åº“å‘å¸ƒåˆ° æœ¬æœº maven ç¼“å­˜åº“ã€‚      |\n\n**è¯´æ˜ï¼š**\n\nä¸Šé¢çš„ä»»åŠ¡ç”± `maven-publish` çš„æ’ä»¶ç”Ÿæˆï¼Œè¯¥æ’ä»¶ç”Ÿæˆä»»åŠ¡çš„è§„åˆ™ä½¿ç”¨ Publications å’Œ Repo æ¥ç»„åˆå®ç°ï¼Œå…¶ä¸­ï¼š\n\n* publication æ˜¯æˆ‘ä»¬å®šä¹‰çš„å‘å¸ƒåº“ï¼›`android_maven_pub` æ’ä»¶ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸º`release` çš„é…ç½®ï¼›\n* repo æ˜¯æˆ‘ä»¬å®šä¹‰çš„ maven ä»“åº“çš„ä½ç½®ï¼Œ`android_maven_pub` å®šä¹‰äº†ä¸¤ä¸ªä»“åº“çš„ä½ç½®ï¼Œåˆ†åˆ«åä¸º ProjectLocal å’Œ Sonartype ï¼Œå¦å¤–`maven-publish`ä¼šç»™æˆ‘ä»¬åŠ ä¸Šä¸€ä¸ª MavenLocal çš„é…ç½®ï¼ˆæŒ‡å‘æœ¬æœº maven ä»“åº“ç¼“å­˜ç›®å½•ï¼‰\n  * å…¶ä¸­ ProjectLocal æŒ‡å‘å¼•å…¥äº†è¯¥æ’ä»¶çš„é¡¹ç›®ï¼ˆæ¨¡å—ï¼‰çš„ `build/repos` ç›®å½•\n  * `Sonartype` åˆ™é»˜è®¤æŒ‡å‘ maven ä¸­å¿ƒä»“åº“çš„åœ°å€ï¼Œå¯ä»¥é€šè¿‡é…ç½®æ¥æ›´æ”¹ï¼›\n\n## å¯é…ç½®é¡¹ç›®è¯´æ˜\n\n| é…ç½®å­—æ®µ             | è¯´æ˜                                                         | é»˜è®¤å€¼                                                       |\n| -------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |\n| groupId              | maven çš„ group idï¼Œéœ€è¦è®¾ç½®ä¸ºè‡ªå·±ç”³è¯·çš„                      | æ— é»˜è®¤å€¼-å¿…éœ€å¡«å†™                                            |\n| artifactId           | library çš„ id                                                | æ— é»˜è®¤å€¼-å¿…éœ€å¡«å†™                                            |\n| mavenPomAction       | ç”¨äºé…ç½® pom ä¿¡æ¯çš„å­—æ®µ                                      | æ— é»˜è®¤å€¼-å¿…éœ€å¡«å†™                                            |\n| fromAndroidPubName   | è¡¨ç¤ºå‘å¸ƒçš„ android çš„ aar çš„ç±»å‹ï¼Œ`release` æˆ– `debug`       | `release`                                                    |\n| releasesRepoUrl      | maven release ä»“åº“çš„ä¸Šä¼ åœ°å€                                 | `https://oss.sonatype.org/service/local/staging/deploy/maven2` |\n| snapshotsRepoUrl     | maven snapshots ä»“åº“çš„ä¸Šä¼ åœ°å€                               | `https://oss.sonatype.org/content/repositories/snapshots/`   |\n| includeSourceJar     | æ˜¯å¦ä¸Šä¼ æºç                                                  | `true`                                                       |\n| includeJavadocJar    | æ˜¯å¦ä¸Šä¼  javadoc                                             | `true`                                                       |\n| projectLocalRepoPath | æœ¬åœ°ä»“åº“çš„ç›®å½•ï¼Œç›¸å¯¹äºrootProjectçš„ç›®å½•ï¼Œå¦‚ï¼š`local-maven-repo` | é»˜è®¤ä½äºæ ¹é¡¹ç›®çš„ `build/mavenRepos` ç›®å½•ä¸­                   |\n\n\n## å¸¸è§é—®é¢˜\n\n### å‘å¸ƒåˆ° snapshot \n\næˆ‘ä»¬æ ¹æ®ç‰ˆæœ¬å·æ¥é€‰æ‹©å‘å¸ƒåˆ°çš„æ˜¯ snapshot è¿˜æ˜¯ release ä»“åº“ï¼Œç‰ˆæœ¬å·ä» `android->defaultConfig - versionName` ä¸­è¯»å–ï¼Œå¦‚ï¼š\n\n```kotlin\nandroid {\n    compileSdkVersion(30)\n    buildToolsVersion(\"30.0.3\")\n\n    defaultConfig {\n        minSdkVersion(22)\n        targetSdkVersion(30)\n        versionCode(1)\n        versionName(\"1.0.0-SNAPSHOT\")\n    }\n}\n```\n\n### å‘å¸ƒåˆ°æœ¬åœ°å¹¶è¿›è¡Œæµ‹è¯•\n\né¦–å…ˆæˆ‘ä»¬é€šè¿‡ `projectLocalRepoPath` æ¥æ”¹å˜ ProjectLocal ä»“åº“çš„ç›®å½•ï¼Œä¸‹é¢çš„ç¤ºä¾‹ä¸­å°†å…¶è®¾ç½®ä¸º rootProject çš„ local-maven-repo ç›®å½•ä¸­\n\n```kotlin\napply(plugin = \"com.github.hanlyjiang.android_maven_pub\")\n\nconfigure<io.hanlyjiang.gradle.android.AndroidMavenPubPluginExtension> {\n    groupId.set(\"com.github.hanlyjiang\")\n    artifactId.set(\"android-common-utils\")\n    projectLocalRepoPath.set(\"local-maven-repo\")\n\t// ...\n}\n```\n\næ¥ä¸‹æ¥æˆ‘ä»¬å®šä¹‰æœ¬åœ°çš„ Repo ï¼Œè§ä¸‹æ–¹åä¸º `ProjectLocal-Snapshots` åŠ `ProjectLocal-Release` çš„ä»“åº“ã€‚\n\n```kotlin\nallprojects {\n    repositories {\n        maven { setUrl(\"https://maven.aliyun.com/repository/jcenter\") }\n        maven { setUrl(\"https://maven.aliyun.com/repository/google\") }\n        maven { setUrl(\"https://maven.aliyun.com/repository/gradle-plugin\") }\n        maven { setUrl(\"https://maven.aliyun.com/repository/public\") }\n        // å®šä¹‰æœ¬åœ°repoè·¯å¾„\n        maven {\n            name = \"ProjectLocal-Snapshots\"\n            setUrl(File(rootProject.rootDir, \"local-maven-repo${File.separator}snapshots\"))\n        }\n        maven {\n            name = \"ProjectLocal-Release\"\n            setUrl(File(rootProject.rootDir, \"local-maven-repo${File.separator}release\"))\n        }\n        maven {\n            name = \"Sonatype-Snapshots\"\n            setUrl(\"https://oss.sonatype.org/content/repositories/snapshots\")\n//            setUrl(\"https://s01.oss.sonatype.org/content/repositories/snapshots\")\n            // snapshotå¯ä»¥ä¸ç”¨ç”¨æˆ·åå¯†ç \n            // æŸ¥çœ‹è‡ªå·±çš„snapshotç‰ˆæœ¬ï¼š https://oss.sonatype.org/content/repositories/snapshots/com/github/hanlyjiang/\n            credentials(PasswordCredentials::class.java) {\n                username = property(\"ossrhUsername\").toString()\n                password = property(\"ossrhPassword\").toString()\n            }\n        }\n        maven {\n            name = \"Sonatype-Staging\"\n            setUrl(\"https://oss.sonatype.org/service/local/staging/deploy/maven2/\")\n//            setUrl(\"https://s01.oss.sonatype.org/service/local/staging/deploy/maven2/\")\n            credentials(PasswordCredentials::class.java) {\n                username = property(\"ossrhUsername\").toString()\n                password = property(\"ossrhPassword\").toString()\n            }\n        }\n    }\n}\n```\n\n\n\n<!-- more -->\n",
      "data": {
        "title": "ç®€åŒ–Androidåº“ä¸Šä¼ åˆ°Mavenä»“åº“çš„gradleé…ç½®",
        "date": "2021-06-01 10:26:00",
        "tags": [
          "Gradle",
          "Android",
          "å·¥å…·"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "é…ç½® android ä¸Šä¼ åˆ° maven ä¸­å¿ƒä»“åº“ï¼Œå‘ç°é…ç½®çš„ä»£ç æœ‰ç‚¹å¤šï¼Œè€Œä¸”å¦‚æœæœ‰å¤šä¸ªåº“æ¨¡å—éœ€è¦ä¸Šä¼ ï¼Œåˆ™éœ€è¦å¤åˆ¶ç²˜è´´ä¸å°‘é‡å¤çš„é…ç½®ä»£ç ï¼Œäºæ˜¯ç¼–å†™äº†ä¸€ä¸ª gradle æ’ä»¶ç”¨äºç®€åŒ–æå–è¿™ä¸ªé…ç½®è¿‡ç¨‹ï¼›",
      "fileName": "jian-hua-android-ku-shang-chuan-dao-maven-cang-ku-de-gradle-pei-zhi"
    },
    {
      "content": "\n\næœ¬ç¯‡æ–‡ç« ä»‹ç»å¦‚ä½•åŸºäºGitlabæ¥é…ç½®ä¸€ä¸ªæœåŠ¡é›†ç¾¤çš„è‡ªåŠ¨æ„å»ºä¸éƒ¨ç½²æ›´æ–°ï¼Œå…¶ä¸­æœåŠ¡çš„æ›´æ–°åŸºäºdockeræ¥å®Œæˆï¼Œæœ¬æ–‡ä¸»è¦å…³æ³¨å¦‚ä½•å®Œæˆéƒ¨ç½²æ“ä½œï¼ŒåŠå¦‚ä½•å®Œæˆgitlabä¸Šciçš„é…ç½®ï¼›åœ¨å®Œæˆå•ä¸€çš„æœåŠ¡è‡ªåŠ¨éƒ¨ç½²æ›´æ–°åï¼Œæˆ‘ä»¬é€šè¿‡gitlabçš„includeåŠtriggeræœºåˆ¶æ¥ç®€åŒ–ç»Ÿä¸€éƒ¨ç½²æµç¨‹ï¼›\n<!-- more -->\n\n## å‰è¨€\n\næˆ‘ä»¬éœ€è¦å®ç°æœåŠ¡çš„è‡ªåŠ¨æ„å»ºåçš„è‡ªåŠ¨æ›´æ–°éƒ¨ç½²ï¼Œæ³¨æ„è¿™é‡Œæˆ‘ä»¬åªéœ€è¦èƒ½åšåˆ°æ›´æ–°éƒ¨ç½²çš„æœåŠ¡å³å¯ï¼ŒæœåŠ¡çš„åˆæ¬¡éƒ¨ç½²å±äºä½é¢‘æ“ä½œï¼Œä¸”å’ŒæœåŠ¡å™¨ç¯å¢ƒç›¸å…³ï¼Œéœ€è¦æ‰‹åŠ¨æ¥å®Œæˆï¼›æˆ‘ä»¬è¿™é‡Œå‡å®šæœºå™¨ä¸Šå·²ç»éƒ¨ç½²å¥½äº†æœåŠ¡ï¼›\n\n\n## å•ä¸€é¡¹ç›®çš„è‡ªåŠ¨éƒ¨ç½²çš„ç¤ºä¾‹\n\nè¿™é‡Œæˆ‘ä»¬é¦–å…ˆä»¥ä¸€ä¸ªspringbootçš„æœåŠ¡ä½œä¸ºç¤ºä¾‹ï¼Œå®ç°äº†æ•´ä¸ªè‡ªåŠ¨æ‰“åŒ…åŠéƒ¨ç½²æ›´æ–°çš„æµç¨‹ï¼›\n\n### æ•ˆæœ\n\n* æäº¤ä¹‹åï¼Œè‡ªåŠ¨æ„å»ºjarï¼Œå¹¶æ‰“åŒ…dockeré•œåƒ\n\n  ![image-20210526101018201](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210526101021.png)\n\n* æ„å»ºå®Œæˆåï¼Œé€šè¿‡gitlabç•Œé¢ï¼Œå¯ä»¥è§¦å‘éƒ¨ç½²ï¼Œå®Œæˆåå¯ä»¥è®¿é—®å¯¹åº”çš„ç¯å¢ƒï¼ˆè¯¦è§ä¸‹æ–¹è¯´æ˜ï¼‰\n\n\n\n### è§¦å‘éƒ¨ç½²æ­¥éª¤çš„æ–¹å¼\n\nè§¦å‘éƒ¨ç½²æœ‰å¤šä¸ªå…¥å£ï¼š\n\n1. æµæ°´çº¿åˆ—è¡¨å°¾éƒ¨çš„æ‰‹åŠ¨ä½œä¸šæŒ‰é’®\n\n   ![image-20210526101410284](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210526101412.png)\n\n2. æµæ°´çº¿åˆ—è¡¨ä¸­ï¼Œç‚¹å‡»å¯¹åº”çš„æ‰‹åŠ¨ä»»åŠ¡ï¼Œåœ¨å¼¹å‡ºæ¡†ä¸­ç‚¹å‡»è¿è¡Œ\n\n   ![image-20210526101518328](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210526101519.png)\n\n3. æµæ°´çº¿è¯¦æƒ…ä¸­ï¼Œç‚¹å‡»è§¦å‘éƒ¨ç½²\n\n   ![image-20210526101603210](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210526101604.png)\n\n4. å¯¹åº”æ‰‹åŠ¨ä½œä¸šçš„è¯¦æƒ…ä¸­ï¼Œç‚¹å‡»â€œè§¦å‘æ­¤æ‰‹åŠ¨æ“ä½œâ€\n\n   ![image-20210526101644456](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210526101646.png)\n\n5. ä½œä¸šåˆ—è¡¨ä¸­å¯¹åº”çš„éƒ¨ç½²ä½œä¸šçš„å°¾éƒ¨\n\n   ![image-20210526102728195](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210526102729.png)\n\n### è®¿é—®éƒ¨ç½²ç¯å¢ƒçš„æ–¹å¼\n\néƒ¨ç½²ä¹‹åï¼Œä¼šåœ¨gitlabä¸­ç”Ÿæˆä¸€ä¸ªç¯å¢ƒï¼Œåœ¨ç¯å¢ƒçš„ç›¸å…³ç•Œé¢å³å¯è®¿é—®å¯¹åº”çš„æœåŠ¡åœ°å€\n\n1. åœ¨é¡¹ç›®çš„â€œè¿ç»´-ç¯å¢ƒâ€å…¥å£å¯ä»¥æŸ¥çœ‹æ‰€æœ‰çš„ç¯å¢ƒ\n\n![image-20210526101756486](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210526101758.png)\n\n2. ç‚¹å‡»å¯¹åº”ç¯å¢ƒå°¾éƒ¨çš„é“¾æ¥å›¾æ ‡å³å¯è®¿é—®\n\n   ![image-20210526101900464](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210526101901.png)\n\n3. ä¹Ÿå¯ä»¥åœ¨å¯¹åº”çš„ç¯å¢ƒè¯¦æƒ…é¡µé¢ï¼Œç‚¹å‡»â€œæŸ¥çœ‹éƒ¨ç½²â€ ï¼ˆæ³¨æ„åœ¨éƒ¨ç½²ä½œä¸šçš„è¯¦æƒ…ä¸­ä¹Ÿå¯ä»¥æ‰¾åˆ°å¯¹åº”ç¯å¢ƒçš„å…¥å£å“¦-è§¦å‘éƒ¨ç½²æ­¥éª¤çš„æ–¹å¼çš„ç¬¬å››ä¸­æ–¹å¼çš„é™„å›¾ï¼‰\n\n   ![image-20210526101945707](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210526101946.png)\n\n### å®ç°æ–¹å¼\n\næˆ‘ä»¬æœ‰ä¸‰ä¸ªä»»åŠ¡ï¼š\n\n* æ„å»ºjar\n* æ„å»ºdockeré•œåƒ\n* éƒ¨ç½²æœåŠ¡ï¼ˆé€šè¿‡swarmï¼‰\n\nå…¶ä¸­æ„å»ºjarå’Œæ„å»ºdockeré•œåƒæ˜¯è‡ªåŠ¨å®Œæˆçš„ï¼Œéƒ¨ç½²æ­¥éª¤åˆ™éœ€è¦æ‰‹åŠ¨é€šè¿‡gitlabç•Œé¢è¿›è¡Œè§¦å‘ï¼›\n\n#### gitlab-ci.yml é…ç½®\n\n```yaml\nvariables:\n  #  é…ç½®ä»“åº“ç¯å¢ƒ\n  DOCKER_REGISTRY: zh-registry.geostar.com.cn\n  DOCKER_NAMESPACE: geopanel\n  DEPLOY_PATH: /GeoRoboxPro/GeoPanelWork/geopanel-deploy/deploy/\n  #  é…ç½®é•œåƒæœåŠ¡å\n  SERVICE_NAME: blockapi-token\n\nstages:\n  - test\n  - build\n  - build_image\n  - deploy\n\n# å¼•å…¥ä»£ç æ£€æŸ¥ä»»åŠ¡\n#include:\n#  local: ci/gitlab-ci-sonar.yml\n\nbuild:jar:\n  # éƒ¨åˆ†æ¨¡å—è‹¥ä¸ä½¿ç”¨1.8ç¼–è¯‘ä¼šæŠ¥é”™\n  image: maven:3.6.3-jdk-8\n  stage: build\n  script:\n    - mvn package\n    - mkdir _archiver\n    - cp target/*.jar _archiver/\n    - ls -lh _archiver/\n  artifacts:\n    name: \"dist-$CI_PROJECT_NAME-$CI_COMMIT_SHORT_SHA\"\n    paths:\n      - _archiver/*.jar\n    # ç”Ÿæˆçš„å½’æ¡£åŒ…æ¯”è¾ƒå¤§ï¼Œæˆ‘ä»¬åªä¿ç•™çŸ­æ—¶é—´\n    expire_in: 1 hours\n  tags:\n    - common-build\n  only:\n    - master\n    - web\n\nbuild:docker:\n  stage: build_image\n  script:\n    # ç™»å½•å…¬å¸çš„Harborï¼Œæ³¨æ„å¿…é¡»åœ¨ç¯å¢ƒå˜é‡é…ç½® HARBOR_PWD\n    - echo $HARBOR_PWD | docker login --username=$HARBOR_USER $DOCKER_REGISTRY --password-stdin\n    # å®šä¹‰é•œåƒTAG\n    - IMAGE_NAME=$DOCKER_REGISTRY/$DOCKER_NAMESPACE/$SERVICE_NAME:$CI_COMMIT_SHORT_SHA\n    - echo \"Docker build options $DOCKER_OPTIONS, set DOCKER_OPTIONS to --no-cache force rebuild all stage\"\n    - cp _archiver/*.jar docker/\n    # buildé•œåƒ\n    - JAR_FILE=`ls docker/ | grep -E *.jar`\n    - echo $JAR_FILE\n    - docker build $DOCKER_OPTIONS --build-arg JAR_FILE=$JAR_FILE -t $IMAGE_NAME ./docker/\n    # æ¨é€é•œåƒ\n    - docker push $IMAGE_NAME\n    - echo \"é•œåƒæ„å»ºå®Œæˆï¼š$IMAGE_NAME\"\n  tags:\n    - docker\n  only:\n    - master\n    - web\n\ndeploy:\n  stage: deploy\n  script:\n    - echo $HARBOR_PWD | docker login --username=$HARBOR_USER $DOCKER_REGISTRY --password-stdin\n    - cd $DEPLOY_PATH\n    - source deploy.sh\n    - update_service $DOCKER_NAMESPACE $SERVICE_NAME $DOCKER_REGISTRY/$DOCKER_NAMESPACE/$SERVICE_NAME:$CI_COMMIT_SHORT_SHA\n  environment:\n    name: test_env_deploy\n    url: $APP_URL/\n  when: manual\n  only:\n    - branches\n    - web\n  tags:\n    - deploy_blockapi\n\n```\n\næ³¨æ„ deploy ä»»åŠ¡ä¸­å®šä¹‰çš„ç¯å¢ƒé…ç½®ï¼š\n\n```yaml\n  environment:\n    name: test_env_deploy\n    url: $APP_URL/\n  when: manual\n```\n\n1. é€šè¿‡environmenté…ç½®ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨gitlabçš„ â€œè¿ç»´-ç¯å¢ƒâ€ ä¸­ç”Ÿæˆä¸€æ¡ç¯å¢ƒä¿¡æ¯ï¼Œä¸€ä¸ªç¯å¢ƒä¿¡æ¯å³å¯¹åº”ä¸€ä¸ªéƒ¨ç½²æœåŠ¡ï¼›\n\n   å®šä¹‰ç¯å¢ƒä¿¡æ¯ï¼Œéœ€è¦é…ç½®nameå’Œurlä¸¤ä¸ªå­—æ®µï¼Œå…¶ä¸­nameæ˜¯ç¯å¢ƒåç§°ï¼Œurlåˆ™åº”æŒ‡å‘æœåŠ¡çš„åœ°å€ï¼Œè¯¥urlå³æ˜¯æˆ‘ä»¬åœ¨gitlabç¯å¢ƒä¸­æŸ¥çœ‹éƒ¨ç½²æ—¶è·³è½¬çš„é¡µé¢ï¼›\n\n2. è¿™é‡Œçš„urlæˆ‘ä»¬é€šè¿‡å˜é‡æ¥è¿›è¡Œé…ç½®ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å†™æ­»ï¼›\n\n3. æ³¨æ„è¿™é‡Œçš„nameä¸èƒ½è®¾ç½®ä¸ºä¸­æ–‡ï¼›\n\n2. é€šè¿‡å°†when è®¾ç½®ä¸º manual ï¼Œå¯ä»¥å°†éƒ¨ç½²ä»»åŠ¡è®¾ç½®ä¸ºæ‰‹åŠ¨è§¦å‘çš„æ–¹å¼ï¼›\n\n## ä¼˜åŒ–æ”¹è¿›æ–¹æ¡ˆç ”ç©¶\n\n### æ”¹è¿›ç›®æ ‡\n\næˆ‘ä»¬çš„ä¸€ä¸ªé›†ç¾¤ä¹‹ä¸­æœ‰å¤šä¸ªæœåŠ¡å•å…ƒï¼Œæ¯ä¸ªæœåŠ¡å•å…ƒæäº¤ä»£ç æ›´æ–°ä¹‹åï¼Œéƒ½éœ€è¦è‡ªåŠ¨éƒ¨ç½²æ›´æ–°åˆ°å¯¹åº”çš„ç¯å¢ƒä¸­ã€‚æˆ‘ä»¬å¯ä»¥é€‰æ‹©å°†ä¸Šé¢å•ä¸ªé¡¹ç›®ä¸­çš„æµç¨‹åœ¨æ‰€æœ‰é¡¹ç›®ä¸­éƒ½å¤åˆ¶ä¸€éï¼Œä¸è¿‡ï¼š\n\n* é‡å¤å·¥ä½œè¾ƒå¤šï¼Œä¸€æ—¦éƒ¨ç½²è„šæœ¬å‘ç”Ÿå˜åŒ–ï¼Œæ¯ä¸ªé¡¹ç›®éƒ½éœ€è¦å•ç‹¬å˜åŒ–\n* æ¯ä¸ªé¡¹ç›®éƒ½éœ€è¦é…ç½®åˆ°éƒ¨ç½²æœåŠ¡å™¨çš„runner\n\næ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘å°†è¿™ä¸ªé‡å¤çš„æ­¥éª¤é›†ä¸­èµ·æ¥ã€‚\n\n> å®é™…ä¸Šï¼Œæ‰“åŒ…jarå’Œæ„å»ºé•œåƒçš„æµç¨‹æˆ‘ä»¬ä¹Ÿå¯ä»¥è€ƒè™‘ä¼˜åŒ–å¤ç”¨ï¼Œä¸è¿‡æˆ‘ä»¬è¿™é‡Œä¸»è¦ä¸“æ³¨äºéƒ¨ç½²çš„æ”¹è¿›ã€‚å½“æœåŠ¡è¢«æ‰“åŒ…æˆé•œåƒä¹‹åï¼Œéƒ¨ç½²çš„æµç¨‹åªå…³æ³¨äºé•œåƒï¼Œæ— éœ€é’ˆå¯¹ä¸åŒçš„æœåŠ¡è¿›è¡ŒåŒºåˆ†å¯¹å¾…ï¼Œæ˜¯éå¸¸é€‚åˆæå–ç»Ÿä¸€çš„ï¼›\n\n### ç°çŠ¶\n\nç»è¿‡ä¸Šé¢çš„æ­¥éª¤ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥å®ç°ä¸Šä¼ ä»£ç åè‡ªåŠ¨ç¼–è¯‘ï¼Œæ„å»ºé•œåƒï¼Œé€šè¿‡gitlabç•Œé¢å®ç°éƒ¨ç½²äº†ã€‚ä¸è¿‡é¡¹ç›®æ¯”è¾ƒå¤šæ—¶ï¼Œæˆ‘ä»¬æ¯ä¸ªéƒ½å¦‚æ­¤é…ç½®ï¼Œä¸€æ—¦éœ€è¦æ”¹åŠ¨ï¼Œä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘å°†è¿™äº›ä»»åŠ¡æå–æˆå…¬ç”¨çš„è„šæœ¬ï¼Œåœ¨é¡¹ç›®ä¸­è¿›è¡Œå¼•å…¥ã€‚\n\nç°åœ¨ï¼Œæˆ‘ä»¬å°è¯•å°†è¿™éƒ¨ç½²ä»»åŠ¡æå–æˆå…¬å…±çš„ã€‚\n\nå®é™…ä¸Šï¼Œä¸Šé¢çš„éƒ¨ç½²æµç¨‹ä¸­ï¼Œæˆ‘ä»¬å·²ç»éƒ¨ç½²æ›´æ–°çš„æµç¨‹åšäº†å°è£…ï¼Œå…·ä½“è„šæœ¬å¦‚ä¸‹ï¼Œåœ¨æ›´æ–°æœåŠ¡æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ `update_service` å‡½æ•°å³å¯å®ŒæˆæœåŠ¡çš„æ›´æ–°åŠæœ¬åœ°ymléƒ¨ç½²æ–‡ä»¶çš„ä¿®æ”¹ï¼›\n\n```shell\n# æ›´æ–°æœåŠ¡\nupdate_service geopanel blockapi-engine zh-registry.geostar.com.cn/geopanel/blockapi-engine:1aaa7ad9\n```\n\ndeploy.sh è„šæœ¬å†…å®¹ï¼šï¼ˆåªå…³æ³¨update_service çš„æµç¨‹å³å¯ï¼‰\n\n```shell\n#!/usr/bin/env bash\n#set -eo pipefail\n\nREGISTRY_ALIYUN=registry.cn-hangzhou.aliyuncs.com/hasura\nREGISTRY_HARBOR=zh-registry.geostar.com.cn/geopanel\n# éƒ¨ç½²æœåŠ¡\nSTACK_NAME=geopanel\n\nfunction getSedOption() {\n  if [ \"$(uname)\" = \"Darwin\" ]; then\n    echo \"-i .bak\"\n  else\n    echo \"-i.bak\"\n  fi\n}\n\nfunction logInfo() {\n  echo \"-->: $*\"\n}\n\nfunction logError() {\n  echo \"-->Error: $*\" >&2\n}\n\n# è®¾ç½®éƒ¨ç½²ç›®å½•\nif [ \"$0\" = \"-bash\" ]; then\n  DEPLOY_DIR=$PWD\nelse\n  DEPLOY_DIR=$(\n    cd $(dirname $0)\n    pwd\n  )\nfi\necho \"DEPLOY_DIR:$DEPLOY_DIR\"\n\n# ä½¿ç”¨é˜¿é‡Œäº‘çš„é•œåƒ\nfunction use_aliyun_images() {\n  sed \"$(getSedOption)\" \"s|$REGISTRY_HARBOR|$REGISTRY_ALIYUN|g\" $DEPLOY_DIR/*/*.yml\n}\n\n# ä½¿ç”¨å†…ç½‘ harbor é•œåƒ\nfunction use_harbor_images() {\n  sed \"$(getSedOption)\" \"s|$REGISTRY_ALIYUN|$REGISTRY_HARBOR|g\" $DEPLOY_DIR/*/*.yml\n}\n\n# éƒ¨ç½²å•ä¸ªè„šæœ¬æœåŠ¡\nfunction deploy() {\n  service=$1\n  stack_name=$2\n  if [ -z \"$service\" ]; then\n    echo \"ç”¨æ³•ï¼šdeploy {æœåŠ¡åç§°} [stackåç§°]\"\n    echo \"     {æœåŠ¡åç§°} - å¯ä¸º hasuraï¼Œkafkaï¼Œevent_track\"\n    return\n  fi\n  if [ -z \"$stack_name\" ]; then\n    stack_name=$STACK_NAME\n  fi\n  printf \"\\n%s\\n\" \"è·å–é•œåƒ: $service \"\n  grep \"image:\" \"$DEPLOY_DIR/$service/docker-compose.yml\" | sed 's/image://g' | xargs -I {} docker pull {}\n  printf \"\\n%s\\n\" \"å¯åŠ¨æœåŠ¡: $service \"\n  docker stack deploy -c \"$DEPLOY_DIR/$service/docker-compose.yml\" $stack_name\n  printf \"\\n\\n\"\n}\n\nfunction deploy_offline() {\n  service=$1\n  stack_name=$2\n  if [ -z \"$service\" ]; then\n    echo \"ç”¨æ³•ï¼šdeploy {æœåŠ¡åç§°} [stackåç§°]\"\n    echo \"     {æœåŠ¡åç§°} - å¯ä¸º hasuraï¼Œkafkaï¼Œevent_track\"\n    return\n  fi\n  if [ -z \"$stack_name\" ]; then\n    stack_name=$STACK_NAME\n  fi\n  printf \"\\n%s\\n\" \"å¯åŠ¨æœåŠ¡: $service \"\n  docker stack deploy -c \"$DEPLOY_DIR/$service/docker-compose.yml\" $STACK_NAME\n  printf \"\\n\\n\"\n}\n\n# å¯¼å‡ºä¸€ä¸ªè„šæœ¬ä¸­çš„é•œåƒ\nfunction export_images() {\n  service=$1\n  if [ -z \"$service\" ]; then\n    echo \"ç”¨æ³•ï¼šdeploy {æœåŠ¡åç§°}\"\n    echo \"     {æœåŠ¡åç§°} - å¯ä¸º hasuraï¼Œkafkaï¼Œevent_track\"\n    return\n  fi\n  printf \"\\n%s\\n\" \"å¯¼å‡ºé•œåƒ: $service \"\n  image_list=$(grep \"image:\" \"$DEPLOY_DIR/$service/docker-compose.yml\" | sed 's/image://g' | awk '{print $1}' | tr \"\\n\" \" \")\n  echo \"docker image save --output=$DEPLOY_DIR/$service.tar $image_list\"\n  docker image save --output=\"$DEPLOY_DIR/$service\".tar \"$image_list\"\n  printf \"\\n\\n\"\n}\n\n# éƒ¨ç½²æ‰€æœ‰æœåŠ¡\n# deploy_all [stack_name]\n# - stack_name ï¼š stack åç§°ï¼Œä¸ä¼ åˆ™ä¸º geopanel\nfunction deploy_all() {\n  stack_name=$1\n  if [ -z \"$stack_name\" ]; then\n    stack_name=$STACK_NAME\n  fi\n  deploy blockapi $stack_name\n  deploy kafka $stack_name\n  deploy \"gpl-datacollection\" $stack_name\n}\n\n# ä¸pullé•œåƒï¼Œéƒ¨ç½²æ‰€æœ‰æœåŠ¡\n# deploy_all_offline [stack_name]\n# - stack_name ï¼š stack åç§°ï¼Œä¸ä¼ åˆ™ä¸º geopanel\nfunction deploy_all_offline() {\n  stack_name=$1\n  if [ -z \"$stack_name\" ]; then\n    stack_name=$STACK_NAME\n  fi\n  deploy_offline blockapi $stack_name\n  deploy_offline kafka $stack_name\n  deploy_offline \"gpl-datacollection\" $stack_name\n}\n\nfunction pull_image() {\n  image=$1\n  if [ -z $image ]; then\n    logError \"imageå‚æ•°æœªæŒ‡å®š\"\n    return\n  fi\n  docker pull $image\n}\n\nfunction _usage_update_service() {\n  logInfo \"ç”¨æ³•ï¼š update_service {stack} {service} {image}\"\n}\n\n# æ›´æ–°æœåŠ¡ï¼Œç”¨æ³•å¦‚ä¸‹ï¼š\n# update_service {stack} {service} {image}\n# update_service geopanel blockapi-engine zh-registry.geostar.com.cn/geopanel/blockapi-engine:1aaa7ad9\n# æœ¬å‡½æ•°æŒ‰å¦‚ä¸‹æµç¨‹æ‰§è¡Œï¼š\n# 1. è·å–é•œåƒï¼›\n# 2. æ›´æ–°æœåŠ¡ï¼›å¦‚æ›´æ–°å¤±è´¥ï¼Œåˆ™å°è¯•å›æ»šæœåŠ¡ï¼›\n# 3. å¦‚æ›´æ–°æˆåŠŸï¼Œåˆ™ä¿®æ”¹æœ¬åœ°ymlæ–‡ä»¶ï¼›\nfunction update_service() {\n  # è¦æ›´æ–°çš„stack\n  stack=$1\n  # è¦æ›´æ–°çš„æœåŠ¡\n  service=$2\n  # æœåŠ¡çš„é•œåƒ\n  image=$3\n  if [ -z \"$stack\" ]; then\n    logError \"stack å‚æ•°ä¸èƒ½ä¸ºç©º\"\n    _usage_update_service\n    return 1\n  fi\n  if [ -z \"$service\" ]; then\n    logError \"service å‚æ•°ä¸èƒ½ä¸ºç©º\"\n    _usage_update_service\n    return 1\n  fi\n  if [ -z \"$image\" ]; then\n    logError \"image å‚æ•°ä¸èƒ½ä¸ºç©º\"\n    _usage_update_service\n    return 1\n  fi\n  logInfo \"è·å–é•œåƒï¼š$image\"\n  pull_image \"$image\"\n  if [ $? -eq 1 ]; then\n    logError \"é•œåƒè·å–å¤±è´¥\"\n    return 1\n  fi\n  service_name=\"${stack}_${service}\"\n  logInfo \"å¼€å§‹æ›´æ–°æœåŠ¡ï¼šdocker service update $service_name --image=$image\"\n  docker service update \"$service_name\" --image=\"$image\"\n  update_result=$?\n  logInfo \"å½“å‰æœåŠ¡çŠ¶æ€: \"\n  docker stack services $stack\n  # æ›´æ–°å¤±è´¥\n  if [ $update_result -eq 1 ]; then\n    logError \"æ›´æ–°å¤±è´¥ï¼Œç¡®å®šæ˜¯å¦éœ€è¦å›æ»šæœåŠ¡\"\n    docker service ls --format=\"{{.Image}}\" | grep -E \"^$image$\"\n    find_image=$?\n    if [ $find_image -eq 0 ]; then\n      logInfo \"å¼€å§‹å›æ»šæœåŠ¡ï¼š$service_name\"\n      docker service rollback \"$service_name\"\n      logInfo \"å›æ»šå®Œæˆï¼Œè¾“å‡ºæœåŠ¡çŠ¶æ€ï¼š(å¯æ‰‹åŠ¨ç¡®è®¤æœåŠ¡çŠ¶æ€)\"\n      docker service ls\n    else\n      logInfo \"æ— éœ€å›æ»š\"\n    fi\n    # ç›´æ¥é€€å‡º\n    logError \"æ›´æ–°å¤±è´¥ï¼Œå³å°†é€€å‡ºï¼Œè¯·æ‰‹åŠ¨æ£€æŸ¥æœåŠ¡é•œåƒæ˜¯å¦æ­£å¸¸\"\n    return 1\n  fi\n  # æ›´æ–°æˆåŠŸï¼Œå¼€å§‹æ›´æ–°æœ¬åœ°ymléƒ¨ç½²è„šæœ¬\n  logInfo \"å¼€å§‹æ›´æ–°æœ¬åœ°ymléƒ¨ç½²è„šæœ¬\"\n  update_service_yaml_config \"$stack\" \"$service\" \"$image\"\n}\n\n# æ›´æ–°æœ¬åœ°çš„ymlæ–‡ä»¶é…ç½®\nfunction update_service_yaml_config() {\n  # è¦æ›´æ–°çš„stack\n  stack=$1\n  # è¦æ›´æ–°çš„æœåŠ¡\n  service=$2\n  # æœåŠ¡çš„é•œåƒ\n  image=$3\n  if [ -z \"$stack\" ]; then\n    logError \"stack å‚æ•°ä¸èƒ½ä¸ºç©º\"\n    return 1\n  fi\n  if [ -z \"$service\" ]; then\n    logError \"service å‚æ•°ä¸èƒ½ä¸ºç©º\"\n    return 1\n  fi\n  if [ -z \"$image\" ]; then\n    logError \"image å‚æ•°ä¸èƒ½ä¸ºç©º\"\n    return 1\n  fi\n  service_name=\"${stack}_${service}\"\n\n  # æŸ¥æ‰¾éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶(æ ¹æ®æœåŠ¡åæŸ¥æ‰¾ï¼Œæ’é™¤armï¼‰\n  # -H è¾“å‡ºåŒ¹é…çš„æ–‡ä»¶è·¯å¾„\n  # -v è¿‡æ»¤æ‰ arm\n  # -print0 | xargs -0 ç”¨äºå¤„ç†æ–‡ä»¶åä¸­å¯èƒ½å­˜åœ¨çš„ç‰¹æ®Šå­—ç¬¦\n  # è¿™é‡Œ /b:/b çš„åŒ¹é…æ¨¡å¼ ç¡®ä¿æœ‰ç©ºæ ¼çš„æƒ…å†µä¸‹å°½å¯èƒ½çš„åŒ¹é…åˆ°service\n  # å®Œæˆåè¾“å‡ºç±»ä¼¼å¦‚ä¸‹ï¼š\n  # ./blockapi/docker-compose-20210325.yml:  blockapi-engine:\n  # ./blockapi/docker-compose.yml:  blockapi-engine:\n  # è·å–éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶åˆ—è¡¨\n  #   IFS=\" \" read -r -a file_list <<< find . -type f -name \"*.yml\" -print0 | xargs -0 -I {} grep -H \"$service *: *$\" {} | grep -v \"arm\" | awk -F: '{print $1}' | tr \"\\n\" \" \"\n#  file_list=($(find . -type f -name \"*.yml\" -print0 | xargs -0 -I {} grep -H \"$service *: *$\" {} | grep -v \"arm\" | awk -F: '{print $1}' | tr \"\\n\" \" \"))\n# ä¸Šé¢å˜é‡çš„å†™æ³•åœ¨gitlab-runnerä¸Šæœ‰é—®é¢˜\n#  for file in \"${file_list[@]}\"; do\n  for file in $(find . -type f -name \"*.yml\" -print0 | xargs -0 -I {} grep -H \"$service *: *$\" {} | grep -v \"arm\" | awk -F: '{print $1}' | tr \"\\n\" \" \"); do\n    logInfo å¼€å§‹ä¿®æ”¹æ–‡ä»¶:\"$file\"\n    # è·å–æ–‡ä»¶ä¸­çš„é•œåƒå…¨å \" *\" åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªç©ºæ ¼\n    # æ³¨æ„ï¼šè¿™é‡Œé€šè¿‡æœåŠ¡åç§°æ¥æŸ¥æ‰¾é•œåƒåç§°ï¼Œé€šè¿‡ grep -A 4 å¤šè¾“å‡ºå››è¡Œï¼Œç„¶ååœ¨è¿™å››è¡Œä¸­å¯»æ‰¾imageæ®µï¼Œä»è€Œè·å–æ–‡ä»¶ä¸­å¯¹åº”serviceçš„imageçš„å…¨å\n    raw_image=$(grep -A 4 \"$service *: *$\" \"$file\" | grep image | sed 's/.*image: *//g')\n    logInfo \"å¤‡ä»½æ–‡ä»¶: $file.bak\"\n    #    cp -f \"$file\" \"$file.bak\"\n    # å¼€å§‹ä¿®æ”¹æ–‡ä»¶\n    sed \"$(getSedOption)\" \"s|$raw_image|$image|g\" \"$file\"\n    if [ $? -eq 0 ]; then\n      confirm_ed_result=$(grep \"$image\" \"$file\")\n      if [ -n \"$confirm_ed_result\" ]; then\n        logInfo \"ä¿®æ”¹æˆåŠŸ\"\n        logInfo \"æœåŠ¡æ›´æ–°å®Œæˆ\"\n      else\n        logError \"æ–‡ä»¶ä¿®æ”¹å¤±è´¥\"\n      fi\n    else\n      logError \"æ–‡ä»¶ä¿®æ”¹å¤±è´¥\"\n    fi\n  done\n}\n\n# å¯¼å‡ºæ‰€æœ‰é•œåƒ\nfunction export_all_images() {\n  export_images blockapi\n  export_images kafka\n  export_images \"gpl-datacollection\"\n}\n\necho \"å¯¼å…¥éƒ¨ç½²è„šæœ¬æˆåŠŸ\"\n\n```\n\n### è°ƒæŸ¥\n\nè§‚å¯Ÿå¦‚ä¸‹ä¸€ä¸ªå…·ä½“çš„deployçš„jobï¼Œæˆ‘ä»¬å¯ä»¥æœ‰å¦‚ä¸‹æå–æ–¹å‘ï¼š\n\n1. å°†æ•´ä¸ªjobéƒ½æå–å‡ºå»ï¼›\n2. å°†scriptæ®µæå–å‡ºæ¥ï¼›\n3. å°†éƒ¨ç½²ä»»åŠ¡é›†ä¸­åˆ°ä¸€ä¸ªå•ç‹¬çš„éƒ¨ç½²é¡¹ç›®ï¼Œå„ä¸ªæœåŠ¡æ¨¡å—æ›´æ–°åè§¦å‘éƒ¨ç½²é¡¹ç›®è¿›è¡Œéƒ¨ç½²ï¼›\n\n```yaml\ndeploy:\n  stage: deploy\n  script:\n    - echo $HARBOR_PWD | docker login --username=$HARBOR_USER $DOCKER_REGISTRY --password-stdin\n    - cd $DEPLOY_PATH\n    #- sudo chmod 777 -R $DEPLOY_PATH   éœ€è¦è‡ªè¡Œä½¿ç”¨rootç”¨æˆ·æ·»åŠ æƒé™\n    - echo \"$SERVICE_NAME\"\n    - echo \"$DEPLOY_PATH\"\n    - echo \"$DOCKER_REGISTRY/$DOCKER_NAMESPACE/$SERVICE_NAME:$CI_COMMIT_SHORT_SHA\"\n    - source deploy.sh\n    - update_service $DOCKER_NAMESPACE $SERVICE_NAME $DOCKER_REGISTRY/$DOCKER_NAMESPACE/$SERVICE_NAME:$CI_COMMIT_SHORT_SHA\n  environment:\n    name: test_env_deploy\n    url: $APP_URL/\n  when: manual\n  only:\n    - branches\n    - web\n  tags:\n    - deploy_blockapi\n```\n\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¸¦ç€ä¸Šè¿°ä¸¤ä¸ªé—®é¢˜æ¥å¯»æ‰¾ç›¸å…³çš„æŠ€æœ¯æ”¯æŒ - å³ï¼šgitlabèƒ½å¸®åŠ©æˆ‘ä»¬åšåˆ°å“ªäº›åŠä»€ä¹ˆç¨‹åº¦ï¼Ÿ\n\nç»è¿‡ç®€å•çš„è°ƒæŸ¥æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œgitlabciçš„é…ç½®ä¸­ï¼Œæœ‰ä¸€ä¸ª`include` çš„é…ç½®å¯ä»¥å¼•å…¥å¤–éƒ¨çš„yamlï¼Œæˆ‘ä»¬è¯¦ç»†äº†è§£ä¸‹è¿™ä¸ªé…ç½®ï¼ˆ[Keyword reference for the .gitlab-ci.yml file | GitLab](https://docs.gitlab.com/ee/ci/yaml/README.html#include)ï¼‰\n\nè€Œæå–è„šæœ¬æ˜¯ä¸€ä¸ªæ¯”è¾ƒç¡®å®šå¯ä»¥å®ç°çš„äº‹æƒ…ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸äºˆè°ƒæŸ¥ï¼›\n\n#### **include**\n\n**ç”¨é€”ï¼š**\n\n1. åœ¨cié…ç½®ä¸­å¯¼å…¥å¤–éƒ¨çš„yamlé…ç½®ï¼›\n2. æ‹†åˆ†é•¿çš„é…ç½®ï¼Œæå‡å¯è¯»æ€§ï¼›\n3. æå–å…¬å…±çš„é…ç½®ï¼Œå‡å°‘é‡å¤é…ç½®ï¼›\n4. æ‹†åˆ†æ”¾ç½®åˆ°ä¸­å¿ƒä»“åº“ï¼Œåœ¨å…¶ä»–é¡¹ç›®ä¸­å¼•å…¥ï¼›\n\n**æ”¯æŒçš„æº**ï¼š\n\n| Keyword                                                      | Method                                      |\n| :----------------------------------------------------------- | :------------------------------------------ |\n| [`local`](https://docs.gitlab.com/ee/ci/yaml/README.html#includelocal) | æœ¬é¡¹ç›®ä¸­çš„æ–‡ä»¶                              |\n| [`file`](https://docs.gitlab.com/ee/ci/yaml/README.html#includefile) | å¼•å…¥å…¶ä»–é¡¹ç›®ä¸­çš„æ–‡ä»¶                        |\n| [`remote`](https://docs.gitlab.com/ee/ci/yaml/README.html#includeremote) | å¼•å…¥è¿œç¨‹çš„URLä¸­çš„æ–‡ä»¶ï¼ˆå¿…é¡»èƒ½è¢«å…¬å¼€è®¿é—®åˆ°ï¼‰ |\n| [`template`](https://docs.gitlab.com/ee/ci/yaml/README.html#includetemplate) | å¼•å…¥Gitlabæä¾›çš„æ¨¡æ¿æ–‡ä»¶                    |\n\nè¿™é‡Œæˆ‘ä»¬ä¸»è¦æŸ¥çœ‹`file`- å³å¦‚ä½•å¼•å…¥å…¶ä»–é¡¹ç›®ä¸­çš„æ–‡ä»¶ï¼›\n\n**åŸºæœ¬ç”¨æ³•ï¼š**ï¼ˆéœ€è¦ä½¿ç”¨projectæŒ‡å®šé¡¹ç›®ï¼‰\n\né¡¹ç›®çš„åœ°å€æ˜¯ç›¸å¯¹äºæ ¹ç›®å½•ï¼ˆ`/`ï¼‰\n\n```yaml\ninclude:\n  - project: 'my-group/my-project'\n    file: '/templates/.gitlab-ci-template.yml'\n```\n\n**æŒ‡å®šåˆ†æ”¯/Tag/æäº¤ï¼š**(é€šè¿‡refæŒ‡å®š)\n\n```yaml\ninclude:\n  - project: 'my-group/my-project'\n    ref: main\n    file: '/templates/.gitlab-ci-template.yml'\n\n  - project: 'my-group/my-project'\n    ref: v1.0.0\n    file: '/templates/.gitlab-ci-template.yml'\n\n  - project: 'my-group/my-project'\n    ref: 787123b47f14b552955ca2786bc9542ae66fee5b  # Git SHA\n    file: '/templates/.gitlab-ci-template.yml'\n```\n\n**åŒæ—¶å¼•å…¥å¤šä¸ªæ–‡ä»¶ï¼š**ï¼ˆfileä¸­ä½¿ç”¨æ•°ç»„è¯­æ³•ï¼‰\n\n```yaml\ninclude:\n  - project: 'my-group/my-project'\n    ref: main\n    file:\n      - '/templates/.builds.yml'\n      - '/templates/.tests.yml'\n```\n\n**åµŒå¥—å¼•å…¥ï¼š**\n\næ‰€æœ‰åµŒå¥—çš„includeséƒ½åœ¨å½“å‰ç›®æ ‡é¡¹ç›®çš„èŒƒå›´å†…æ‰§è¡Œï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨local (ç›¸å¯¹äºç›®æ ‡é¡¹ç›®), project, remote, æˆ–è€… template includesã€‚\n\n* å¯ä»¥æœ€å¤šæœ‰ 100 ä¸ª includesï¼›\n* ä¸èƒ½æœ‰é‡å¤çš„include\n\n* åœ¨[GitLab 12.4](https://gitlab.com/gitlab-org/gitlab/-/issues/28212) åŠåç»­ç‰ˆæœ¬ä¸­, è§£ææ‰€æœ‰æ–‡ä»¶çš„æ—¶é—´è¢«é™åˆ¶åœ¨30ç§’ä¹‹å†…ï¼Œæ‰€ä»¥å¯èƒ½éœ€è¦è€ƒè™‘æ–‡ä»¶çš„å¤æ‚åº¦ï¼›\n\n**æƒé™ï¼š**\n\næ‰§è¡Œäººéœ€è¦å…·æœ‰é¡¹ç›®çš„æƒé™ï¼›\n\nAll [nested includes](https://docs.gitlab.com/ee/ci/yaml/README.html#nested-includes) are executed only with the permission of the user, so itâ€™s possible to use project, remote or template includes.\n\n#### trigger\n\ngitlabå¯ä»¥ä½¿ç”¨triggeræ¥è§¦å‘å¤šé¡¹ç›®æ„å»ºï¼Œåœ¨gitlab-cié…ç½®ä¸­ï¼Œå¯ä»¥ä½¿ç”¨triggeræ¥å®šä¹‰ä¸€ä¸ªä¸‹æ¸¸æµæ°´çº¿çš„è§¦å‘å™¨ï¼Œå½“Gitlabå¯åŠ¨è¿™ä¸ªtriggerçš„ä»»åŠ¡æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªä¸‹æ¸¸æµæ°´çº¿ï¼›\n\nå¯¹æ¯”äºæ­£å¸¸çš„ä»»åŠ¡ï¼Œtriggerç±»å‹çš„ä»»åŠ¡åªæœ‰å°‘é‡å…³é”®å­—å¯ä»¥ä½¿ç”¨ï¼›\n\nGitlabä¸­å¯ä½¿ç”¨triggeråˆ›å»ºä¸¤ç§ç±»å‹çš„ä¸‹æ¸¸æµæ°´çº¿ï¼š\n\n1. å¤šé¡¹ç›®æµæ°´çº¿ï¼š è§¦å‘å…¶ä»–é¡¹ç›®çš„æµæ°´çº¿ï¼›\n2. å­æµæ°´çº¿ï¼š è§¦å‘å½“å‰é¡¹ç›®çš„æµæ°´çº¿ï¼›\n\n**å¤šé¡¹ç›®æµæ°´çº¿çš„è§¦å‘ä»»åŠ¡åŸºæœ¬å†™æ³•ï¼š**\n\n```yaml\nrspec:\n  stage: test\n  script: bundle exec rspec\n\nstaging:\n  stage: deploy\n  trigger: my/deployment\n```\n\n**å¤šé¡¹ç›®æµæ°´çº¿çš„è§¦å‘ä»»åŠ¡å¤æ‚å†™æ³•ï¼š**\n\n* é€šè¿‡branchæŒ‡å®šåˆ†æ”¯\n\n    ```yaml\n    rspec:\n      stage: test\n      script: bundle exec rspec\n\n    staging:\n      stage: deploy\n      trigger:\n        project: my/deployment\n        branch: stable\n    ```\n\n* é•œåƒä¸‹æµæµæ°´çº¿çš„çŠ¶æ€(é€šè¿‡è®¾ç½®`strategy: depend`,é»˜è®¤æƒ…å†µä¸‹ï¼Œè§¦å‘å™¨ä»»åŠ¡ä¼šè¢«æ ‡è®°ä¸ºæˆåŠŸï¼Œè®¾ç½®æ­¤æ ‡è®°åï¼Œåˆ™ä¼šç­‰å¾…ä¸‹æ¸¸æµæ°´çº¿æ‰§è¡Œå®Œæˆï¼Œç„¶åä½¿ç”¨ä¸‹æµæµæ°´çº¿çš„çŠ¶æ€æ¥æ ‡è®°è¯¥è§¦å‘å™¨ä»»åŠ¡çš„çŠ¶æ€)\n\n  ```yaml\n  trigger_job:\n  trigger:\n    project: my/project\n    strategy: depend\n  ```\n\n* åœ¨ä¸‹æ¸¸æµæ°´çº¿ä¸­ï¼Œä¹Ÿå¯ä»¥è·å–ä¸Šæ¸¸æµæ°´çº¿çš„çŠ¶æ€\n\n    ```shell\n    upstream_bridge:\n      stage: test\n      needs:\n        pipeline: other/project\n    ```\n\n**å­æµæ°´çº¿çš„å†™æ³•ï¼š**\n\n* æŒ‡å®šé¡¹ç›®ä¸­çš„YAMLæ–‡ä»¶çš„è·¯å¾„å³å¯åˆ›å»ºå­æµæ°´çº¿\n\n  ```shell\n  trigger_job:\n    trigger:\n      include: path/to/child-pipeline.yml\n  ```\n\n* åŒæ ·çš„ï¼Œä¹Ÿå¯ä»¥è®¾ç½®è·å–ä¸‹æ¸¸çŠ¶æ€\n\n  ```yaml\n  trigger_job:\n    trigger:\n      include:\n        - local: path/to/child-pipeline.yml\n      strategy: depend\n  ```\n\n* å¯ä»¥ä½¿ç”¨å…¶ä»–é¡¹ç›®ä¸­çš„YAMLæ–‡ä»¶æ¥å®šä¹‰å­æµæ°´çº¿\n\n  ```yaml\n  child-pipeline:\n    trigger:\n      include:\n        - project: 'my-group/my-pipeline-library'\n          ref: 'main'\n          file: '/path/to/child-pipeline.yml'\n  ```\n\n* å¯ä»¥ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„é…ç½®æ¥ç”Ÿæˆå­æµæ°´çº¿(å‚è€ƒï¼š[Parent-child pipelines | GitLab](https://docs.gitlab.com/ee/ci/parent_child_pipelines.html#dynamic-child-pipelines))\n\n  ```yaml\n  generate-config:\n    stage: build\n    script: generate-ci-config > generated-config.yml\n    artifacts:\n      paths:\n        - generated-config.yml\n  \n  child-pipeline:\n    stage: test\n    trigger:\n      include:\n        - artifact: generated-config.yml\n          job: generate-config\n  ```\n\n### æ•´ä½“æ–¹æ¡ˆ\n\né€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°\n\n* gitlabæ”¯æŒé€šè¿‡`include`æ¥å¼•å…¥å¤–éƒ¨çš„è„šæœ¬ï¼Œè„šæœ¬å¯ä»¥æ¥è‡ªäºæœ¬é¡¹ç›®ï¼Œä¹Ÿå¯ä»¥æ¥è‡ªäºå…¶ä»–é¡¹ç›®ï¼›\n* é€šè¿‡`trigger`å¯ä»¥è§¦å‘å…¶ä»–é¡¹ç›®çš„æµæ°´çº¿æˆ–è€…åœ¨æœ¬é¡¹ç›®ä¸­ç”Ÿæˆä¸€ä¸ªå­æµæ°´çº¿ï¼Œå¯ä»¥é€‰æ‹©è·Ÿè¸ªå­æµæ°´çº¿çš„æ‰§è¡ŒçŠ¶æ€ï¼›\n\nç»è¿‡å¦‚ä¸Šåˆ†æï¼Œæˆ‘ä»¬å†³å®šä½¿ç”¨å¦‚ä¸‹æ–¹æ¡ˆå¯¹ç°æœ‰éƒ¨ç½²éœ€æ±‚è¿›è¡Œå®æ–½ï¼š\n\n\n<svg width=\"982px\" height=\"690px\" viewBox=\"0 0 982 690\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n    <g id=\"ğŸ¶-GeoPaneléƒ¨ç½²ç­–ç•¥\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n        <g id=\"PPT\" transform=\"translate(-417.000000, -233.000000)\">\n            <g id=\"GeoPanel\" transform=\"translate(863.000000, 481.000000)\">\n                <g id=\"æ¶æ„å›¾/æ ‡é¢˜/å¸¦æ æ¡†/åœ†è§’\">\n                    <g id=\"åˆ†ç»„\">\n                        <rect id=\"è¾¹æ¡†æ \" stroke=\"#FF9500\" x=\"0.5\" y=\"0.5\" width=\"226\" height=\"155\" rx=\"6\"></rect>\n                        <path d=\"M6,0 L221,0 C224.313708,-1.44363618e-14 227,2.6862915 227,6 L227,32 L227,32 L0,32 L0,6 C4.82366169e-16,2.6862915 2.6862915,1.4968968e-15 6,0 Z\" id=\"æ ‡é¢˜æ \" fill=\"#FF9500\"></path>\n                    </g>\n                    <text id=\"æ ‡é¢˜\" font-family=\"PingFangSC-Regular, PingFang SC\" font-size=\"18\" font-weight=\"normal\" letter-spacing=\"0.107999999\" fill=\"#FFFFFF\">\n                        <tspan x=\"35.5778135\" y=\"22\">GeoPaneléƒ¨ç½²ä»“åº“</tspan>\n                    </text>\n                </g>\n                <g id=\"æ¶æ„å›¾/æ ‡é¢˜/çº¯æ ‡é¢˜/ç›´è§’å¤‡ä»½-2\" transform=\"translate(42.000000, 78.000000)\">\n                    <rect id=\"æ ‡é¢˜æ¡†\" fill=\"#34C759\" x=\"0\" y=\"0\" width=\"142\" height=\"31\"></rect>\n                    <text id=\"æ ‡é¢˜\" font-family=\"NotoSansCJKsc-Medium, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"400\" letter-spacing=\"0.153999999\" fill=\"#FFFFFF\">\n                        <tspan x=\"43.0598756\" y=\"21.5\">éƒ¨ç½²æœåŠ¡</tspan>\n                    </text>\n                </g>\n            </g>\n            <g id=\"TokenManager\" transform=\"translate(417.000000, 233.000000)\">\n                <g id=\"æ¶æ„å›¾/æ ‡é¢˜/å¸¦æ æ¡†/åœ†è§’\">\n                    <g id=\"åˆ†ç»„\">\n                        <rect id=\"è¾¹æ¡†æ \" stroke=\"#FF9500\" x=\"0.5\" y=\"0.5\" width=\"260\" height=\"149\" rx=\"6\"></rect>\n                        <path d=\"M6,0 L255,0 C258.313708,-6.08718376e-16 261,2.6862915 261,6 L261,32 L261,32 L0,32 L0,6 C-4.05812251e-16,2.6862915 2.6862915,6.08718376e-16 6,0 Z\" id=\"æ ‡é¢˜æ \" fill=\"#FF9500\"></path>\n                    </g>\n                    <text id=\"æ ‡é¢˜\" font-family=\"PingFangSC-Regular, PingFang SC\" font-size=\"18\" font-weight=\"normal\" letter-spacing=\"0.107999999\" fill=\"#FFFFFF\">\n                        <tspan x=\"66.0686269\" y=\"22\">TokenManager</tspan>\n                    </text>\n                </g>\n                <g id=\"æ¶æ„å›¾/æ ‡é¢˜/çº¯æ ‡é¢˜/ç›´è§’\" transform=\"translate(34.000000, 52.000000)\">\n                    <rect id=\"æ ‡é¢˜æ¡†\" fill=\"#34C759\" x=\"0\" y=\"0\" width=\"193\" height=\"31\"></rect>\n                    <text id=\"æ ‡é¢˜\" font-family=\"NotoSansCJKsc-Medium, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"400\" letter-spacing=\"0.153999999\" fill=\"#FFFFFF\">\n                        <tspan x=\"69.826\" y=\"21.5\">æ„å»ºJAR</tspan>\n                    </text>\n                </g>\n                <g id=\"æ¶æ„å›¾/æ ‡é¢˜/çº¯æ ‡é¢˜/ç›´è§’å¤‡ä»½\" transform=\"translate(34.000000, 99.000000)\">\n                    <rect id=\"æ ‡é¢˜æ¡†\" fill=\"#34C759\" x=\"0\" y=\"0\" width=\"193\" height=\"31\"></rect>\n                    <text id=\"æ ‡é¢˜\" font-family=\"NotoSansCJKsc-Medium, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"400\" letter-spacing=\"0.153999999\" fill=\"#FFFFFF\">\n                        <tspan x=\"44.745\" y=\"21.5\">æ‰“åŒ…Dockeré•œåƒ</tspan>\n                    </text>\n                </g>\n                <path id=\"ç›´çº¿\" d=\"M131,82 L131,90 L135,90 L130.5,99 L126,90 L130,90 L130,82 L131,82 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            </g>\n            <g id=\"RESTAPI\" transform=\"translate(417.000000, 413.000000)\">\n                <g id=\"æ¶æ„å›¾/æ ‡é¢˜/å¸¦æ æ¡†/åœ†è§’\">\n                    <g id=\"åˆ†ç»„\">\n                        <rect id=\"è¾¹æ¡†æ \" stroke=\"#FF9500\" x=\"0.5\" y=\"0.5\" width=\"260\" height=\"149\" rx=\"6\"></rect>\n                        <path d=\"M6,0 L255,0 C258.313708,-6.08718376e-16 261,2.6862915 261,6 L261,32 L261,32 L0,32 L0,6 C-4.05812251e-16,2.6862915 2.6862915,6.08718376e-16 6,0 Z\" id=\"æ ‡é¢˜æ \" fill=\"#FF9500\"></path>\n                    </g>\n                    <text id=\"æ ‡é¢˜\" font-family=\"PingFangSC-Regular, PingFang SC\" font-size=\"18\" font-weight=\"normal\" letter-spacing=\"0.107999999\" fill=\"#FFFFFF\">\n                        <tspan x=\"95.9576269\" y=\"22\">RestAPI</tspan>\n                    </text>\n                </g>\n                <g id=\"æ¶æ„å›¾/æ ‡é¢˜/çº¯æ ‡é¢˜/ç›´è§’\" transform=\"translate(34.000000, 52.000000)\">\n                    <rect id=\"æ ‡é¢˜æ¡†\" fill=\"#34C759\" x=\"0\" y=\"0\" width=\"193\" height=\"31\"></rect>\n                    <text id=\"æ ‡é¢˜\" font-family=\"NotoSansCJKsc-Medium, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"400\" letter-spacing=\"0.153999999\" fill=\"#FFFFFF\">\n                        <tspan x=\"69.826\" y=\"21.5\">æ„å»ºJAR</tspan>\n                    </text>\n                </g>\n                <g id=\"æ¶æ„å›¾/æ ‡é¢˜/çº¯æ ‡é¢˜/ç›´è§’å¤‡ä»½\" transform=\"translate(34.000000, 99.000000)\">\n                    <rect id=\"æ ‡é¢˜æ¡†\" fill=\"#34C759\" x=\"0\" y=\"0\" width=\"193\" height=\"31\"></rect>\n                    <text id=\"æ ‡é¢˜\" font-family=\"NotoSansCJKsc-Medium, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"400\" letter-spacing=\"0.153999999\" fill=\"#FFFFFF\">\n                        <tspan x=\"44.745\" y=\"21.5\">æ‰“åŒ…Dockeré•œåƒ</tspan>\n                    </text>\n                </g>\n                <path id=\"ç›´çº¿\" d=\"M131,82 L131,90 L135,90 L130.5,99 L126,90 L130,90 L130,82 L131,82 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            </g>\n            <g id=\"å—æ•°æ®API\" transform=\"translate(417.000000, 593.000000)\">\n                <g id=\"æ¶æ„å›¾/æ ‡é¢˜/å¸¦æ æ¡†/åœ†è§’\">\n                    <g id=\"åˆ†ç»„\">\n                        <rect id=\"è¾¹æ¡†æ \" stroke=\"#FF9500\" x=\"0.5\" y=\"0.5\" width=\"260\" height=\"149\" rx=\"6\"></rect>\n                        <path d=\"M6,0 L255,0 C258.313708,-6.08718376e-16 261,2.6862915 261,6 L261,32 L261,32 L0,32 L0,6 C-4.05812251e-16,2.6862915 2.6862915,6.08718376e-16 6,0 Z\" id=\"æ ‡é¢˜æ \" fill=\"#FF9500\"></path>\n                    </g>\n                    <text id=\"æ ‡é¢˜\" font-family=\"PingFangSC-Regular, PingFang SC\" font-size=\"18\" font-weight=\"normal\" letter-spacing=\"0.107999999\" fill=\"#FFFFFF\">\n                        <tspan x=\"69.7226269\" y=\"22\">å—æ•°æ®APIå¼•æ“</tspan>\n                    </text>\n                </g>\n                <g id=\"æ¶æ„å›¾/æ ‡é¢˜/çº¯æ ‡é¢˜/ç›´è§’\" transform=\"translate(34.000000, 52.000000)\">\n                    <rect id=\"æ ‡é¢˜æ¡†\" fill=\"#34C759\" x=\"0\" y=\"0\" width=\"193\" height=\"31\"></rect>\n                    <text id=\"æ ‡é¢˜\" font-family=\"NotoSansCJKsc-Medium, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"400\" letter-spacing=\"0.153999999\" fill=\"#FFFFFF\">\n                        <tspan x=\"82.846\" y=\"21.5\">æ„å»º</tspan>\n                    </text>\n                </g>\n                <g id=\"æ¶æ„å›¾/æ ‡é¢˜/çº¯æ ‡é¢˜/ç›´è§’å¤‡ä»½\" transform=\"translate(34.000000, 99.000000)\">\n                    <rect id=\"æ ‡é¢˜æ¡†\" fill=\"#34C759\" x=\"0\" y=\"0\" width=\"193\" height=\"31\"></rect>\n                    <text id=\"æ ‡é¢˜\" font-family=\"NotoSansCJKsc-Medium, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"400\" letter-spacing=\"0.153999999\" fill=\"#FFFFFF\">\n                        <tspan x=\"44.745\" y=\"21.5\">æ‰“åŒ…Dockeré•œåƒ</tspan>\n                    </text>\n                </g>\n                <path id=\"ç›´çº¿\" d=\"M131,82 L131,90 L135,90 L130.5,99 L126,90 L130,90 L130,82 L131,82 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            </g>\n            <g id=\"å…¶ä»–æœåŠ¡\" transform=\"translate(417.000000, 773.000000)\">\n                <g id=\"æ¶æ„å›¾/æ ‡é¢˜/å¸¦æ æ¡†/åœ†è§’\">\n                    <g id=\"åˆ†ç»„\">\n                        <rect id=\"è¾¹æ¡†æ \" stroke=\"#FF9500\" x=\"0.5\" y=\"0.5\" width=\"260\" height=\"149\" rx=\"6\"></rect>\n                        <path d=\"M6,0 L255,0 C258.313708,-6.08718376e-16 261,2.6862915 261,6 L261,32 L261,32 L0,32 L0,6 C-4.05812251e-16,2.6862915 2.6862915,6.08718376e-16 6,0 Z\" id=\"æ ‡é¢˜æ \" fill=\"#FF9500\"></path>\n                    </g>\n                    <text id=\"æ ‡é¢˜\" font-family=\"PingFangSC-Regular, PingFang SC\" font-size=\"18\" font-weight=\"normal\" letter-spacing=\"0.107999999\" fill=\"#FFFFFF\">\n                        <tspan x=\"83.7086269\" y=\"22\">å…¶ä»–æœåŠ¡â€¦</tspan>\n                    </text>\n                </g>\n                <g id=\"æ¶æ„å›¾/æ ‡é¢˜/çº¯æ ‡é¢˜/ç›´è§’\" transform=\"translate(34.000000, 52.000000)\">\n                    <rect id=\"æ ‡é¢˜æ¡†\" fill=\"#34C759\" x=\"0\" y=\"0\" width=\"193\" height=\"31\"></rect>\n                    <text id=\"æ ‡é¢˜\" font-family=\"NotoSansCJKsc-Medium, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"400\" letter-spacing=\"0.153999999\" fill=\"#FFFFFF\">\n                        <tspan x=\"82.846\" y=\"21.5\">æ„å»º</tspan>\n                    </text>\n                </g>\n                <g id=\"æ¶æ„å›¾/æ ‡é¢˜/çº¯æ ‡é¢˜/ç›´è§’å¤‡ä»½\" transform=\"translate(34.000000, 99.000000)\">\n                    <rect id=\"æ ‡é¢˜æ¡†\" fill=\"#34C759\" x=\"0\" y=\"0\" width=\"193\" height=\"31\"></rect>\n                    <text id=\"æ ‡é¢˜\" font-family=\"NotoSansCJKsc-Medium, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"400\" letter-spacing=\"0.153999999\" fill=\"#FFFFFF\">\n                        <tspan x=\"44.745\" y=\"21.5\">æ‰“åŒ…Dockeré•œåƒ</tspan>\n                    </text>\n                </g>\n                <path id=\"ç›´çº¿\" d=\"M131,82 L131,90 L135,90 L130.5,99 L126,90 L130,90 L130,82 L131,82 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            </g>\n            <path id=\"ç›´çº¿-2\" d=\"M792.124777,345 L792.124,566.999 L845,566.999 L845,559 L864,568.5 L845,578 L845,569.999 L789.124777,570 L789.124,347.999 L642,348 L642,345 L792.124777,345 Z\" fill=\"#AFAFAF\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-3\" d=\"M676.006644,509.993385 L677.50663,510.000015 L790.631407,510.500015 L792.124777,510.506615 L792.124,567 L845,567 L845,559 L864,568.5 L845,578 L845,570 L789.124777,570 L789.124,513.492 L677.49337,512.999985 L675.993385,512.993356 L676.006644,509.993385 Z\" fill=\"#AFAFAF\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-4\" d=\"M845,559 L864,568.5 L845,578 L845,570 L792.301,570 L792.301081,707 L642,707 L642,704 L789.301,704 L789.301081,567 L845,567 L845,559 Z\" fill=\"#AFAFAF\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-5\" d=\"M845,559 L864,568.5 L845,578 L845,570 L792.301,570 L792.301081,889 L642,889 L642,886 L789.301,886 L789.301081,567 L845,567 L845,559 Z\" fill=\"#AFAFAF\" fill-rule=\"nonzero\"></path>\n            <text id=\"è§¦å‘\" font-family=\"PingFangSC-Regular, PingFang SC\" font-size=\"18\" font-weight=\"normal\" letter-spacing=\"0.6264844\" fill=\"#6272A4\">\n                <tspan x=\"710\" y=\"340\">è§¦å‘</tspan>\n            </text>\n            <text id=\"è§¦å‘å¤‡ä»½\" font-family=\"PingFangSC-Regular, PingFang SC\" font-size=\"18\" font-weight=\"normal\" letter-spacing=\"0.6264844\" fill=\"#6272A4\">\n                <tspan x=\"710\" y=\"506\">è§¦å‘</tspan>\n            </text>\n            <text id=\"è§¦å‘å¤‡ä»½-2\" font-family=\"PingFangSC-Regular, PingFang SC\" font-size=\"18\" font-weight=\"normal\" letter-spacing=\"0.6264844\" fill=\"#6272A4\">\n                <tspan x=\"710\" y=\"700\">è§¦å‘</tspan>\n            </text>\n            <text id=\"è§¦å‘å¤‡ä»½-3\" font-family=\"PingFangSC-Regular, PingFang SC\" font-size=\"18\" font-weight=\"normal\" letter-spacing=\"0.6264844\" fill=\"#6272A4\">\n                <tspan x=\"710\" y=\"882\">è§¦å‘</tspan>\n            </text>\n            <g id=\"éƒ¨ç½²æœºå™¨\" transform=\"translate(1195.000000, 463.000000)\">\n                <g id=\"æ¶æ„å›¾/æ ‡é¢˜/çº¯æ ‡é¢˜/ç›´è§’å¤‡ä»½-2\">\n                    <rect id=\"æ ‡é¢˜æ¡†\" fill=\"#AF52DE\" x=\"0\" y=\"0\" width=\"193\" height=\"31\"></rect>\n                    <text id=\"æ ‡é¢˜\" font-family=\"NotoSansCJKsc-Medium, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"400\" letter-spacing=\"0.153999999\" fill=\"#FFFFFF\">\n                        <tspan x=\"67.649\" y=\"21.5\">postgres</tspan>\n                    </text>\n                </g>\n                <g id=\"æ¶æ„å›¾/æ ‡é¢˜/çº¯æ ‡é¢˜/ç›´è§’å¤‡ä»½-3\" transform=\"translate(0.000000, 46.000000)\">\n                    <rect id=\"æ ‡é¢˜æ¡†\" fill=\"#AF52DE\" x=\"0\" y=\"0\" width=\"193\" height=\"31\"></rect>\n                    <text id=\"æ ‡é¢˜\" font-family=\"NotoSansCJKsc-Medium, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"400\" letter-spacing=\"0.153999999\" fill=\"#FFFFFF\">\n                        <tspan x=\"80.095\" y=\"21.5\">redis</tspan>\n                    </text>\n                </g>\n                <g id=\"æ¶æ„å›¾/æ ‡é¢˜/çº¯æ ‡é¢˜/ç›´è§’å¤‡ä»½-4\" transform=\"translate(0.000000, 92.000000)\">\n                    <rect id=\"æ ‡é¢˜æ¡†\" fill=\"#AF52DE\" x=\"0\" y=\"0\" width=\"193\" height=\"31\"></rect>\n                    <text id=\"æ ‡é¢˜\" font-family=\"NotoSansCJKsc-Medium, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"400\" letter-spacing=\"0.153999999\" fill=\"#FFFFFF\">\n                        <tspan x=\"41.847\" y=\"21.5\">blockapi-engine</tspan>\n                    </text>\n                </g>\n                <g id=\"æ¶æ„å›¾/æ ‡é¢˜/çº¯æ ‡é¢˜/ç›´è§’å¤‡ä»½-5\" transform=\"translate(0.000000, 138.000000)\">\n                    <rect id=\"æ ‡é¢˜æ¡†\" fill=\"#AF52DE\" x=\"0\" y=\"0\" width=\"193\" height=\"31\"></rect>\n                    <text id=\"æ ‡é¢˜\" font-family=\"NotoSansCJKsc-Medium, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"400\" letter-spacing=\"0.153999999\" fill=\"#FFFFFF\">\n                        <tspan x=\"45.69\" y=\"21.5\">blockapi-token</tspan>\n                    </text>\n                </g>\n                <g id=\"æ¶æ„å›¾/æ ‡é¢˜/çº¯æ ‡é¢˜/ç›´è§’å¤‡ä»½-6\" transform=\"translate(0.000000, 184.000000)\">\n                    <rect id=\"æ ‡é¢˜æ¡†\" fill=\"#AF52DE\" x=\"0\" y=\"0\" width=\"193\" height=\"31\"></rect>\n                    <text id=\"æ ‡é¢˜\" font-family=\"NotoSansCJKsc-Medium, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"400\" letter-spacing=\"0.153999999\" fill=\"#FFFFFF\">\n                        <tspan x=\"41.476\" y=\"21.5\">blockapi-restapi</tspan>\n                    </text>\n                </g>\n                <g id=\"æ¶æ„å›¾/æ ‡é¢˜/çº¯æ ‡é¢˜/ç›´è§’å¤‡ä»½-7\" transform=\"translate(0.000000, 228.000000)\">\n                    <rect id=\"æ ‡é¢˜æ¡†\" fill=\"#AF52DE\" x=\"0\" y=\"0\" width=\"193\" height=\"31\"></rect>\n                    <text id=\"æ ‡é¢˜\" font-family=\"NotoSansCJKsc-Medium, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"400\" letter-spacing=\"0.153999999\" fill=\"#FFFFFF\">\n                        <tspan x=\"89.048\" y=\"21.5\">â€¦</tspan>\n                    </text>\n                </g>\n            </g>\n            <path id=\"ç›´çº¿-6\" d=\"M1161,565 L1180,574.5 L1161,584 L1161,576 L1089,576 L1089,573 L1161,573 L1161,565 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <text id=\"deploy\" font-family=\"PingFangSC-Regular, PingFang SC\" font-size=\"18\" font-weight=\"normal\" letter-spacing=\"0.6264844\" fill=\"#6272A4\">\n                <tspan x=\"1104\" y=\"562\">deploy</tspan>\n            </text>\n            <g id=\"æ¶æ„å›¾/æ ‡é¢˜/å¸¦æ æ¡†/åœ†è§’\" transform=\"translate(1179.000000, 418.500000)\">\n                <g id=\"åˆ†ç»„\">\n                    <rect id=\"è¾¹æ¡†æ \" stroke=\"#FF9500\" x=\"0.5\" y=\"0.5\" width=\"219\" height=\"318\" rx=\"6\"></rect>\n                    <path d=\"M6,0 L214,0 C217.313708,-6.08718376e-16 220,2.6862915 220,6 L220,32 L220,32 L0,32 L0,6 C-4.05812251e-16,2.6862915 2.6862915,6.08718376e-16 6,0 Z\" id=\"æ ‡é¢˜æ \" fill=\"#FF9500\"></path>\n                </g>\n                <text id=\"æ ‡é¢˜\" font-family=\"PingFangSC-Regular, PingFang SC\" font-size=\"18\" font-weight=\"normal\" letter-spacing=\"0.107999999\" fill=\"#FFFFFF\">\n                    <tspan x=\"72.5016166\" y=\"22\">éƒ¨ç½²æœºå™¨</tspan>\n                </text>\n            </g>\n        </g>\n    </g>\n</svg>\n\n1. æ¯ä¸ªé¡¹ç›®åˆ†åˆ«å®šä¹‰è‡ªå·±çš„æ„å»ºå’Œé•œåƒæ‰“åŒ…ä»»åŠ¡ï¼›\n2. é•œåƒæ‰“åŒ…å®Œæˆåé€šè¿‡`trigger`æ¥è§¦å‘GeoPaneléƒ¨ç½²ä»“åº“çš„éƒ¨ç½²ä»»åŠ¡ï¼Œéœ€è¦ä¼ é€’è‡ªå·±çš„ä¿¡æ¯ç»™éƒ¨ç½²ä»“åº“ç”Ÿæˆçš„æµæ°´çº¿ï¼›\n3. è§¦å‘ä»»åŠ¡çš„å®šä¹‰æ–‡ä»¶æ”¾ç½®åˆ°GeoPaneléƒ¨ç½²ä»“åº“ä¸­ï¼Œåœ¨å„ä¸ªæœåŠ¡é¡¹ç›®ä¸­é€šè¿‡`include`æ¥å¼•å…¥ï¼›\n\n## ä¼˜åŒ–æ–¹æ¡ˆå®ç°\n\nå¦‚ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬å°†éƒ¨ç½²æ“ä½œé›†ä¸­åˆ°ä¸€ä¸ªå•ç‹¬é¡¹ç›®ä¸­ï¼Œè€Œåˆå„ä¸ªæœåŠ¡é¡¹ç›®è§¦å‘å…¶éƒ¨ç½²æµç¨‹ï¼Œè¿™é‡Œæˆ‘ä»¬å°†è¿™ä¸ªå•ç‹¬çš„ç”¨äºéƒ¨ç½²çš„é¡¹ç›®ç§°ä¸ºç‹¬ç«‹éƒ¨ç½²é¡¹ç›®ï¼Œå°†å…¶ä»–æœåŠ¡çš„é¡¹ç›®ç§°ä¹‹ä¸ºå­æœåŠ¡é¡¹ç›®ï¼›ä»¥ä¸‹åˆ†åˆ«è¯´æ˜ä¸Šè¿°æ–¹æ¡ˆä¸­ä¸¤ç§é¡¹ç›®ä¸­çš„é…ç½®æ–¹å¼ï¼›\n\n### å„å­æœåŠ¡é¡¹ç›®çš„é…ç½®\n\n#### gitlab-ci.ymlé…ç½®\n\næˆ‘ä»¬å°†éƒ¨ç½²ä»»åŠ¡æ›¿æ¢ä¸ºä¸€ä¸ªè§¦å‘ä»»åŠ¡ï¼Œå¹¶ä»ç‹¬ç«‹éƒ¨ç½²é¡¹ç›®ä¸­å¼•å…¥ä»»åŠ¡çš„é…ç½®\n\n```yaml\nstages:\n  - test\n  - build\n  - build_image\n  - auto-build-deploy\n\n# çœç•¥å…¶ä»–å®šä¹‰\n\n# å¼•å…¥è§¦å‘è‡ªåŠ¨ç¼–è¯‘éƒ¨ç½²ä»»åŠ¡é…ç½® \ninclude:\n  - project: 'dept-development/product-project/geopanel/geopanel-deploy'\n    # ref: master\n    file: '/ci/gitlab-ci-base.yml'\n```\n\nè¿™æ®µé…ç½®ä¼šä» `dept-development/product-project/geopanel/geopanel-deploy` é¡¹ç›®ä¸­å¯¼å…¥ `/ci/gitlab-ci-base.yml` çš„é…ç½®ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹ï¼š\n\n```yaml\n# å­æ¨¡å—ç”¨çš„å…¬ç”¨è§¦å‘é¡¹ç›®ï¼Œå¯ä»¥åœ¨å­æ¨¡å—æºç ä¸­ include\ntrigger:auto-build-deploy:\n  stage: auto-build-deploy\n  variables:\n    TRIGGER_CI_COMMIT_SHORT_SHA: $CI_COMMIT_SHORT_SHA\n    #  é…ç½®ä»“åº“ç¯å¢ƒ\n    # è‡ªå®šä¹‰å˜é‡å¿…é¡»é…ç½®åœ¨ä¸Šæ¸¸UIç•Œé¢\n    DOCKER_REGISTRY: $DOCKER_REGISTRY\n    DOCKER_NAMESPACE: $DOCKER_NAMESPACE\n    HARBOR_PWD: $HARBOR_PWD\n    HARBOR_USER: $HARBOR_USER\n    SERVICE_NAME: $SERVICE_NAME\n  trigger:\n    project: dept-development/product-project/geopanel/geopanel-deploy\n```\n\nåœ¨å­é¡¹ç›®ä¸­çš„cié…ç½®ä¸­`include`è¯¥æ–‡ä»¶æ—¶ï¼Œä¼šç”Ÿæˆä¸€ä¸ªè§¦å‘ä»»åŠ¡ï¼Œè¿™ä¸ªè§¦å‘ä»»åŠ¡ä¼šè§¦å‘`dept-development/product-project/geopanel/geopanel-deploy`è¿™ä¸ªé¡¹ç›®ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„ç‹¬ç«‹éƒ¨ç½²é¡¹ç›®ï¼›\n\nä¹Ÿå°±æ˜¯è¯´ä¼šè§¦å‘æˆ‘ä»¬ç‹¬ç«‹éƒ¨ç½²é¡¹ç›®ç”Ÿæˆä¸€ä¸ªæµæ°´çº¿ï¼Œæ­¤æ—¶æµæ°´çº¿è¯»å–çš„å°±æ˜¯æˆ‘ä»¬ç‹¬ç«‹éƒ¨ç½²é¡¹ç›®çš„`.gitlab-ci.yml` æ–‡ä»¶ï¼›\n\n####  web UIä¸­CI/CDå˜é‡é…ç½®\n\nä¸Šè¿°çš„è§¦å‘ä»»åŠ¡çš„é…ç½®ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†å‡ ä¸ªå˜é‡ï¼Œç”¨äºå‘éƒ¨ç½²é¡¹ç›®çš„æµæ°´çº¿è¯´æ˜æˆ‘ä»¬è‡ªèº«çš„ä¸€äº›ä¿¡æ¯\n\n```yaml\n    TRIGGER_CI_COMMIT_SHORT_SHA: $CI_COMMIT_SHORT_SHA\n    DOCKER_REGISTRY: $DOCKER_REGISTRY\n    DOCKER_NAMESPACE: $DOCKER_NAMESPACE\n    HARBOR_PWD: $HARBOR_PWD\n    HARBOR_USER: $HARBOR_USER\n    SERVICE_NAME: $SERVICE_NAME\n```\n\nå…¶ä¸­ï¼Œç”±æˆ‘ä»¬è‡ªè¡Œå®šä¹‰çš„å˜é‡ï¼ˆ`$DOCKER_REGISTRY`,`DOCKER_NAMESPACE`,`$HARBOR_PWD`,`$HARBOR_USER`,`$SERVICE_NAME`ï¼‰éœ€è¦åœ¨é¡¹ç›®/ç¾¤ç»„çš„CIçš„å˜é‡ä¸­è¿›è¡Œé…ç½®ï¼Œåœ¨è§£ææ­¤è§¦å‘ä»»åŠ¡æ—¶æ‰å¯ä»¥è¯»å–åˆ°ï¼›\n\n![image-20210526155206137](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210526155207.png)\n\n### ç‹¬ç«‹éƒ¨ç½²é¡¹ç›®çš„é…ç½®\n\n#### gitlab-ci.yml é…ç½®\n\n```yaml\nvariables:\n#  UIç•Œé¢é…ç½® DEPLOY_PATH\n  DEPLOY_PATH: /GeoRoboxPro/GeoPanelWork/geopanel-deploy/deploy/\n#  éƒ¨ç½²çš„stack\n  DOCKER_STACK: geopanel\n\ndeploy:\n  stage: deploy\n  script:\n    - echo $HARBOR_PWD | docker login --username=$HARBOR_USER $DOCKER_REGISTRY --password-stdin\n    - cd $DEPLOY_PATH\n    - source deploy.sh\n    - update_service $DOCKER_STACK $SERVICE_NAME $DOCKER_REGISTRY/$DOCKER_NAMESPACE/$SERVICE_NAME:$TRIGGER_CI_COMMIT_SHORT_SHA\n  environment:\n    name: test_env_deploy\n    url: $APP_URL/\n  when: manual\n  tags:\n    - deploy_blockapi\n```\n\n#### web UIä¸­CI/CDå˜é‡é…ç½®\n\nç°åœ¨ï¼Œæˆ‘ä»¬æœ‰äº›éƒ¨ç½²ç›¸å…³çš„å˜é‡éœ€è¦ä»å­æœåŠ¡é¡¹ç›®ä¸­æå–åˆ°å½“å‰ç‹¬ç«‹éƒ¨ç½²é¡¹ç›®ä¸­æ¥å®šä¹‰ï¼ŒåŒ…æ‹¬ï¼š`DEPLOY_PATH`,`DOCKER_STACK`,`APP_URL`ï¼Œå…¶ä¸­`DEPLOY_PATH`,`DOCKER_STACK`æˆ‘ä»¬åœ¨ymlä¸­æœ‰å®šä¹‰é»˜è®¤å€¼ï¼Œå¯ä»¥ä¸åœ¨UIç•Œé¢ä¸­è¿›è¡Œå®šä¹‰ï¼Œåªéœ€è¦åœ¨UIç•Œé¢ä¸­å®šä¹‰APP_URLå³å¯ï¼›\n\n### è¿è¡Œæ•ˆæœè¯´æ˜\n\n1. æ¯æ¬¡å­æœåŠ¡é¡¹ç›®ä¸­æäº¤ä»£ç ï¼Œä¸”æ»¡è¶³cié…ç½®ä¸­å®šä¹‰çš„æ¡ä»¶æ—¶ï¼Œå³ä¼šç”Ÿæˆä¸€ä¸ªè§¦å‘ä»»åŠ¡ï¼Œæ‰§è¡Œå®Œå‰æœŸé˜¶æ®µçš„ä»»åŠ¡åï¼Œå½“æ‰§è¡Œè§¦å‘ä»»åŠ¡æ—¶ï¼Œå°±ä¼šè§¦å‘æˆ‘ä»¬çš„ç‹¬ç«‹ä»“åº“çš„éƒ¨ç½²ä»»åŠ¡ã€‚å…·ä½“ç•Œé¢å¦‚ä¸‹å›¾æ‰€ç¤ºï¼›\n\n![image-20210526155719096](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210526155720.png)\n\n2. ç‚¹å‡»ä¸‹æ¸¸ä»»åŠ¡å³å¯è·³è½¬åˆ°æˆ‘ä»¬çš„ç‹¬ç«‹éƒ¨ç½²ä»“åº“ä¸­å¯¹åº”çš„æµæ°´çº¿ä¸­ï¼›\n\n![image-20210526155942216](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210526155943.png)\n\n3. ç‚¹å‡»deployä»»åŠ¡çš„è¿è¡ŒæŒ‰é’®ï¼Œå³å¯è¿›è¡Œéƒ¨ç½²ï¼›\n\n4. éƒ¨ç½²å®Œæˆåï¼Œå¯åœ¨ç‹¬ç«‹éƒ¨ç½²ä»“åº“ä¸­ç”Ÿæˆä¸€ä¸ªéƒ¨ç½²ç¯å¢ƒï¼Œç‚¹å‡»å³å¯å‰å¾€ï¼›\n\n   ![image-20210526160146582](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210526160148.png)\n\n",
      "data": {
        "title": "GitlabæŒç»­é›†æˆä¸æŒç»­éƒ¨ç½²-å®ä¾‹",
        "date": "2021-05-26 16:12:17",
        "tags": [
          "Gitlab",
          "CICD"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "\n\næœ¬ç¯‡æ–‡ç« ä»‹ç»å¦‚ä½•åŸºäºGitlabæ¥é…ç½®ä¸€ä¸ªæœåŠ¡é›†ç¾¤çš„è‡ªåŠ¨æ„å»ºä¸éƒ¨ç½²æ›´æ–°ï¼Œå…¶ä¸­æœåŠ¡çš„æ›´æ–°åŸºäºdockeræ¥å®Œæˆï¼Œæœ¬æ–‡ä¸»è¦å…³æ³¨å¦‚ä½•å®Œæˆéƒ¨ç½²æ“ä½œï¼ŒåŠå¦‚ä½•å®Œæˆgitlabä¸Šciçš„é…ç½®ï¼›åœ¨å®Œæˆå•ä¸€çš„æœåŠ¡è‡ªåŠ¨éƒ¨ç½²æ›´æ–°åï¼Œæˆ‘ä»¬é€šè¿‡gitlabçš„includeåŠtriggeræœºåˆ¶æ¥ç®€åŒ–ç»Ÿä¸€éƒ¨ç½²æµç¨‹ï¼›",
      "fileName": "gitlab-chi-xu-ji-cheng-yu-chi-xu-bu-shu-shi-li"
    },
    {
      "content": "æœ¬æ–‡ä»‹ç»å¦‚ä½•å®‰å…¨çš„è¿ç§»Dockerçš„æ•°æ®ç›®å½•/var/lib/docker\n\n<!-- more -->\n\n\n## ä¸ºä»€ä¹ˆè¦è¿ç§»\n\n* è™šæ‹Ÿæœºåˆ›å»ºæ—¶ï¼Œä¸€èˆ¬åˆ†é…ä¸€ä¸ªæ¯”è¾ƒå°çš„ç³»ç»Ÿç›˜ï¼Œç„¶åæŒ‚è½½ä¸€ä¸ªå¤§å®¹é‡çš„æ•°æ®ç›˜ï¼Œdockeré»˜è®¤æƒ…å†µä¸‹æ•°æ®å­˜å‚¨åœ¨ç³»ç»Ÿç›˜(/var/lib/docker)ç›®å½•ï¼Œæ—¶é—´ä¸€ä¹…ï¼Œä¼šå æ»¡ç³»ç»Ÿç›˜ã€‚\n\n## è¿ç§»æ­¥éª¤\n\n1. **é¦–å…ˆéœ€è¦åœæ­¢dockeræœåŠ¡**\n```\nsystemctl stop docker\n```\n2. **é€šè¿‡å‘½ä»¤df -h å…ˆå»çœ‹ä¸‹ç£ç›˜å¤§æ¦‚çš„æƒ…å†µï¼Œæ‰¾ä¸€ä¸ªå¤§çš„ç©ºé—´**\n3. **åˆ›å»ºdockerçš„æ–°ç›®å½•ï¼Œæˆ‘è¿™è¾¹æ‰¾äº†data, æ‰€ä»¥æˆ‘è¿™è¾¹çš„æ–°ç›®å½•åœ°å€æ˜¯ /data/docker/lib/**\n```\n\n\nmkdir -p /data/docker/lib\n```\n>æ³¨ï¼šå‚æ•°-p ç¡®ä¿ç›®å½•åç§°å­˜åœ¨ï¼Œå¦‚æœç›®å½•ä¸å­˜åœ¨çš„å°±æ–°åˆ›å»ºä¸€ä¸ªã€‚\n4. **å¼€å§‹è¿ç§»**\n```\nrsync -avzP /var/lib/docker /data/docker/lib/\n```\n> å…ˆç¡®è®¤æ˜¯å¦å®‰è£…äº†rsync.\n\nå‚æ•°è§£é‡Šï¼š\n\n* -aï¼Œå½’æ¡£æ¨¡å¼ï¼Œè¡¨ç¤ºé€’å½’ä¼ è¾“å¹¶ä¿æŒæ–‡ä»¶å±æ€§ã€‚\n* -vï¼Œæ˜¾ç¤ºrsyncè¿‡ç¨‹ä¸­è¯¦ç»†ä¿¡æ¯ã€‚å¯ä»¥ä½¿ç”¨\"-vvvv\"è·å–æ›´è¯¦ç»†ä¿¡æ¯ã€‚\n* -Pï¼Œæ˜¾ç¤ºæ–‡ä»¶ä¼ è¾“çš„è¿›åº¦ä¿¡æ¯ã€‚(å®é™…ä¸Š\"-P\"=\"--partial --progress\"ï¼Œå…¶ä¸­çš„\"--progress\"æ‰æ˜¯æ˜¾ç¤ºè¿›åº¦ä¿¡æ¯çš„)ã€‚\n* -z,Â  Â ä¼ è¾“æ—¶è¿›è¡Œå‹ç¼©æé«˜æ•ˆç‡ã€‚\n5. **æŒ‡å®šæ–°çš„dockerç›®å½•**\n```\nvim /lib/systemd/system/docker.service\n```\nåœ¨ExecStartåŠ å…¥:\n```\nÂ --graph=/data/docker/lib/docker\n```\n6. **é‡å¯docker**\n```\nsudo systemctl daemon-reload\nsudoÂ systemctl restart docker\nsudoÂ systemctl enable docker # è¿è¡Œdockerè‡ªåŠ¨å¯åŠ¨ï¼Œè¿™é‡Œå¯ä»¥ä¸æ‰§è¡Œ\n```\n7. **å¯åŠ¨ä¹‹åç¡®è®¤docker æ²¡æœ‰é—®é¢˜ï¼Œç¡®è®¤ä¹‹å‰çš„å®¹å™¨å’Œé•œåƒéƒ½è¿˜åœ¨ï¼Œç„¶ååˆ é™¤æ—§çš„/var/lib/docker/ç›®å½•**\n\n\n\n## å‚è€ƒæ–‡ç« ï¼š\n\n* [https://www.cnblogs.com/insist-forever/p/11739207.html](https://www.cnblogs.com/insist-forever/p/11739207.html?fileGuid=qQhpHWDVq8HrH9kj)\n\n\n\n",
      "data": {
        "title": "Dockeræ•°æ®ç›®å½•(/var/lib/docker)è¿ç§»",
        "date": "2021-04-21 16:51:40",
        "tags": [
          "Docker"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "æœ¬æ–‡ä»‹ç»å¦‚ä½•å®‰å…¨çš„è¿ç§»Dockerçš„æ•°æ®ç›®å½•/var/lib/docker",
      "fileName": "Dockeræ•°æ®ç›®å½•è¿ç§»"
    },
    {
      "content": "\n\n\nä»‹ç»IDEAåŠAndroidStudioä¸­çš„å¯¼èˆªæŠ€å·§ï¼ŒåŒ…æ‹¬æ–‡ä»¶å¯¼èˆªï¼Œä»£ç å…ƒç´ ï¼ˆç±»ï¼Œæ–¹æ³•ï¼‰å¯¼èˆªï¼Œæ–‡æœ¬å¯¼èˆªç­‰ï¼Œè¿˜æœ‰ä¹¦ç­¾ç­‰çš„ä½¿ç”¨æ–¹æ³•ï¼›æé«˜ç¼–å†™ä»£ç åŠé˜…è¯»ä»£ç çš„æ•ˆç‡ï¼›\n\n<!-- more -->\n\n## æ’å…¥ç¬¦å¯¼èˆª\n\n* åé€€ï¼š==âŒ˜[==\n* å‰è¿›ï¼š==âŒ˜]==\n* æœ€åç¼–è¾‘ç‚¹ï¼š ==â‡§âŒ˜âŒ«==\n* å®šä½åˆ°å½“å‰çš„ç»“æŸæ‹¬å·ï¼š ==Ctrl+M== æˆ–è€… ==â†‘== , ==â†“==\n* æŸ¥çœ‹å…‰æ ‡æ‰€åœ¨ä½ç½®æ‰€å±çš„å…ƒç´ ï¼š==âŒƒâ‡§Q== ï¼ˆæ³¨æ„çœ‹ä¸‹å›¾çš„å·¦ä¸Šè§’æ˜¾ç¤ºäº†å½“å‰çš„ç±»ï¼‰\n  * <img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210410141823.png\" alt=\"image-20210410141822945\" style=\"zoom:50%;\" />\n* ç§»åŠ¨åˆ°å½“å‰å¼€å§‹æ‹¬å·å¯¹åº”çš„é—­åˆæ‹¬å·ï¼š ==Ctrl + M==\n* åœ¨ä»£ç å—ä¹‹é—´å¯¼èˆªï¼š ==âŒ¥â‡§âŒ˜[== ==âŒ¥â‡§âŒ˜]==\n\n## ç§»åŠ¨æ’å…¥ç¬¦\n\n* ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªæˆ–è€…ä¸Šä¸€ä¸ªå•è¯ï¼š ==âŒ¥â†’==ï¼Œ==âŒ¥â†==\n\n* ç§»åŠ¨åˆ°ä¸‹ä¸ªæ®µè½ï¼šï¼ˆä¸‹ä¸ªæ–¹æ³•ï¼‰ \n  1. ä½¿ç”¨ ==Shift+Command+A== è°ƒå‡ºActionæœç´¢å¼¹æ¡†ï¼›\n  2. æœç´¢ **Move Caret Forward a Paragraph** æˆ– **Move Caret Backward a Paragraph** \n\n## æŸ¥æ‰¾æœ€è¿‘çš„ä½ç½®\n\n* ä½¿ç”¨ ==â‡§âŒ˜E== å¯ä»¥æ‰“å¼€**æœ€è¿‘ä½ç½®**çš„å¼¹çª—ï¼Œä½¿ç”¨ä¸Šä¸‹å¥è¿›è¡Œå¯¼èˆª\n\n  <img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210410143034.png\" alt=\"image-20210410143034118\" style=\"zoom:50%;\" />\n\n* åœ¨æ‰“å¼€æ­¤å¼¹çª—æ—¶ï¼Œå†æ¬¡ä½¿ç”¨ ==â‡§âŒ˜E== å¯ä»¥é€‰ä¸­ **Show Changed Only**\n\n* å¯ç›´æ¥è¾“å…¥ä»¥æœç´¢ä»£ç ç‰‡æ®µ\n\n  <img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210410143308.png\" alt=\"image-20210410143308918\" style=\"zoom:50%;\" />\n\n* åˆ é™¤è®°å½•ï¼š æŒ‰ ==Delete== æˆ–è€… ==âŒ«==\n\n\n\n## ä½¿ç”¨ä¹¦ç­¾å¯¼èˆª\n\n* åˆ›å»ºåŒ¿åä¹¦ç­¾ï¼šå°†å…‰æ ‡æ”¾ç½®åˆ°éœ€è¦çš„ä»£ç è¡Œä¸Šï¼Œç„¶åæŒ‰ ï¼š ==F3==\n\n* åˆ›å»ºå¸¦åŠ©è®°ç¬¦çš„ä¹¦ç­¾ï¼š å°†å…‰æ ‡æ”¾ç½®åˆ°éœ€è¦çš„ä»£ç è¡Œä¸Šï¼Œç„¶åæŒ‰ ï¼š ==âŒ¥F3==ï¼Œä¹‹åå¯é€šè¿‡è¾“å…¥å­—æ¯æˆ–è€…æ•°å­—æ¥è®¾ç½®å¯¹åº”çš„åŠ©è®°ç¬¦å·ï¼›\n\n  <img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210410143644.png\" alt=\"image-20210410143644729\" style=\"zoom:50%;\" />\n\n* æ˜¾ç¤ºä¸Šä¸ªæˆ–ä¸‹ä¸ªä¹¦ç­¾ï¼š åœ¨ä¸»èœå•ä¸­é€‰æ‹© **Navigate | Bookmarks | Next Bookmark** æˆ– **Navigate | Bookmarks | Previous Bookmark**\n\n* æ‰“å¼€ä¹¦ç­¾å¯¹è¯æ¡†ï¼š ==âŒ˜F3== \n\n  * æ­¤å¯¹è¯æ¡†ä¹Ÿå¯ç”¨äºç®¡ç†ä¹¦ç­¾ï¼Œå¦‚åˆ é™¤ï¼Œæ’åºï¼Œé™„åŠ ç®€è¦æè¿°\n\n* åœ¨å·²æœ‰çš„**å­—æ¯åŠ©è®°ç¬¦ä¹¦ç­¾**ä¹‹é—´å¯¼èˆªï¼ˆé€šè¿‡å­—æ¯ï¼‰ï¼š æŒ‰ ==âŒ˜F3==ï¼Œ ç„¶åè¾“å…¥ä¸€ä¸ªå­—æ¯ï¼›\n\n* åœ¨å·²æœ‰çš„**æ•°å­—åŠ©è®°ç¬¦ä¹¦ç­¾**ä¹‹é—´å¯¼èˆªï¼ˆé€šè¿‡å­—æ¯ï¼‰ï¼š æŒ‰ ==^==ï¼Œ ç„¶åè¾“å…¥ä¸€ä¸ªæ•°å­—ï¼›\n\n* åˆ›å»ºçš„æ¯ä¸ªä¹¦ç­¾éƒ½ä¼šåœ¨*Favorites*==âŒ˜2==ï¼ˆ**View | Tool Windows | Favourites**ï¼‰çª—å£ä¸­åæ˜ å‡ºæ¥ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ä½¿ç”¨æ­¤çª—å£æ¥å¯¼èˆªã€‚\n\n  <img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210420114331.png\" alt=\"Favorites window\" style=\"zoom:67%;\" />\n\n## åœ¨å˜æ›´ä¹‹é—´å¯¼èˆª\n\nå¦‚æœç¼–è¾‘å—ç‰ˆæœ¬æ§åˆ¶çš„æ–‡ä»¶ï¼Œåˆ™IntelliJ IDEAæä¾›äº†å‡ ç§æ¥å›ç§»åŠ¨æ›´æ–°çš„æ–¹æ³•ã€‚å¯ä»¥ä½¿ç”¨å¯¼èˆªå‘½ä»¤ï¼Œé”®ç›˜å¿«æ·é”®å’Œæ›´æ”¹æ ‡è®°ã€‚ \n\n* ä½¿ç”¨ ==âŒƒâŒ¥â‡§â†“==/ ==âŒƒâŒ¥â‡§â†‘==\n* åœ¨ä¸»èœå•ä¸­é€‰æ‹©ï¼š **Navigate | Next / Previous Change**\n* ç‚¹å‡»ä¸€ä¸ª==å˜æ›´æ ‡è®°ï¼ˆchange markerï¼‰==ï¼Œç„¶åç‚¹å‡»  ![the Previous Change button](https://resources.jetbrains.com/help/img/idea/2021.1/icons.actions.previousOccurence.svg) æˆ– ![the Next Change button](https://resources.jetbrains.com/help/img/idea/2021.1/icons.actions.nextOccurence.svg)\n\n* å¯¼èˆªåˆ°æœ€åä¸€ä¸ªç¼–è¾‘çš„åœ°æ–¹ï¼š ==â‡§âŒ˜âŒ«== æˆ–ä»ä¸»èœå•é€‰æ‹© **Navigate | Last Edit Location**\n\n\n\n## æŸ¥çœ‹æœ€è¿‘ä¿®æ”¹\n\nä½¿ç”¨ **Recent Changes** å¼¹çª—æ¥æŸ¥çœ‹æœ€è¿‘å˜æ›´çš„æ–‡ä»¶åˆ—è¡¨ï¼Œä¹Ÿå¯æ’¤é”€ç›¸å…³ä¿®æ”¹ã€‚\n\n1. åœ¨ä¸»èœå•ä¸­é€‰æ‹© **View | Recent Changes** ==âŒ¥â‡§C==\n\n<img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210420114347.png\" alt=\"the Recent Changes popup\" style=\"zoom:67%;\" />\n\n2. åœ¨å¼¹å‡ºæ¡†ä¸­é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶åæŒ‰ä¸‹ ==â== æ‰“å¼€ä¸€ä¸ªå•ç‹¬çš„å¯¹è¯æ¡†ç”¨äºæ£€æŸ¥å˜æ›´ï¼›\n\n\n\n\n\n## å¯¼èˆªåˆ°å£°æ˜å’Œç±»å‹\n\n* å°†å…‰æ ‡æ”¾ç½®åœ¨è¦æŸ¥è¯¢çš„ç¬¦å·ä¸Šï¼ŒæŒ‰ï¼š ==âŒ˜B== (æŸ¥è¯¢ç”¨æ³•)\n* æŸ¥è¯¢ç±»å‹å®šä¹‰ï¼š ==â‡§âŒ˜B==\n\n\n\n## å¯¼èˆªåˆ°å®ç°ï¼ˆå®ç”¨ï¼‰\n\nå¯ä»¥ä½¿ç”¨ç¼–è¾‘å™¨ä¸­çš„è£…è®¢çº¿å›¾æ ‡æˆ–æŒ‰ç›¸åº”çš„å¿«æ·æ–¹å¼æ¥è·Ÿè¸ªç±»çš„å®ç°å’Œé‡å†™æ–¹æ³•ã€‚ \n\n* ç‚¹å‡» ![the Implemented method icon](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210421141808.svg)/ ![the Implementing method icon](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210421141815.svg), ![the Overridden method icon](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210421141820.svg)/ ![the Overriding method icon](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210421141824.svg) ç¼–è¾‘å™¨è£…è®¢çº¿ä¸­çš„å›¾æ ‡å¯ä»¥é€‰æ‹©çˆ¶ç±»æˆ–å­ç±»ã€‚ \n\n  <img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210420114328.png\" alt=\"Gutter icons\" style=\"zoom:67%;\" />\n\n* å¯¼èˆªåˆ°çˆ¶æ–¹æ³•ï¼š ==âŒ˜U==\n* å¯¼èˆªåˆ°å®ç°ï¼š==âŒ¥âŒ˜B==\n\n\n\n## æ˜¾ç¤ºå…„å¼Ÿå§å¦¹ï¼ˆsiblings ==sÉªblÉªÅ‹z==ï¼‰\n\nå¯åœ¨å•ç‹¬çš„å¼¹å‡ºæ¡†ä¸­æŸ¥çœ‹å®ç°æ–¹æ³•çš„é‚»å±…ç±»\n\n1. åœ¨ç¼–è¾‘å™¨ä¸­ï¼Œå°†å…‰æ ‡æ”¾ç½®åœ¨æ–¹æ³•åç§°ä¸Šï¼›\n2. åœ¨ä¸»èœå•ä¸­ï¼Œé€‰æ‹© **View | Show Siblings** \n3. IDEAä¼šæ‰“å¼€ä¸€ä¸ªå¼¹æ¡†ï¼Œå¯ä»¥åœ¨å…¶ä¸­æµè§ˆå®ç°ï¼Œå¯¼èˆªåˆ°æºç ï¼Œç¼–è¾‘æºç ï¼Œæˆ–è€…åœ¨Findå·¥å…·çª—å£åœ¨æ‰“å¼€åˆ—è¡¨ï¼›\n\n> ä¹Ÿå¯ä»¥åœ¨ActionæŸ¥è¯¢çª—å£ä¸­æœç´¢è¿›å…¥ğŸ˜¯\n\n\n\n## ä½¿ç”¨Select In å¼¹æ¡†\n\nåœ¨Projectå·¥å…·çª—å£åœ¨è‡ªåŠ¨å®šä½ä¸€ä¸ªç±»ã€‚\n\n1. å¦‚æœåœ¨ç¼–è¾‘å™¨ä¸­è¢«æ‰“å¼€äº†ï¼ŒæŒ‰ ==âŒ¥F1== ä»¥æ‰“å¼€ Select In å¼¹çª—ï¼›\n\n   <img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210420114318.png\" alt=\"Select in popup\" style=\"zoom:50%;\" />\n\n2. åœ¨å¼¹å‡ºæ¡†ä¸­ï¼Œé€‰æ‹© **Project View**ï¼Œç„¶åæŒ‰ ==â== å³å¯åœ¨Project å·¥å…·çª—å£ä¸­å®šä½ç±»ã€‚\n\n![image-20210421084613961](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210421084614.png)\n\n3. è¿˜æœ‰å…¶ä»–åŠŸèƒ½ï¼šå¯ä»¥åœ¨å¼¹å‡ºçª—å£ä¹‹åï¼ŒæŒ‰å¯¹åº”çš„æ•°å­—é”®è¿›è¡Œå¯¼èˆª\n   * æŸ¥çœ‹æ”¶è—\n   * æŸ¥çœ‹æ–‡ä»¶ç»“æ„\n   * å¯¼èˆªæ¡\n   * åœ¨æ–‡ä»¶ç®¡ç†å™¨ä¸­æŸ¥çœ‹æ–‡ä»¶\n   * é¡¹ç›®ç»“æ„\n\n## åœ¨Projectå·¥å…·çª—å£ä¸­å®šä½æ–‡ä»¶\n\nå¯ä»¥ä½¿ç”¨â€œ**Open Files with Single Click**â€ï¼ˆä»¥å‰ç§°ä¸ºâ€œè‡ªåŠ¨æ»šåŠ¨åˆ°æºä»£ç â€ï¼‰å’Œâ€œå§‹ç»ˆé€‰æ‹©æ‰“å¼€çš„æ–‡ä»¶â€ï¼ˆä»¥å‰ç§°ä¸ºâ€œ**Always Select Opened Files** â€ï¼‰æ“ä½œæ¥åœ¨â€œ**Project**â€å·¥å…·çª—å£ä¸­æ‰¾åˆ°æ–‡ä»¶ã€‚ \n\n1. åœ¨â€œ**Project**â€å·¥å…·çª—å£ä¸­ï¼Œå³é”®å•å‡»â€œ**Project**â€å·¥å…·æ ï¼Œç„¶åä»ä¸Šä¸‹æ–‡èœå•ä¸­é€‰æ‹©â€œ**Always Select Opened Files**â€ã€‚ ä¹‹åIDEAå°†è·Ÿè¸ªå½“å‰åœ¨æ´»åŠ¨ç¼–è¾‘å™¨é€‰é¡¹å¡ä¸­æ‰“å¼€çš„æ–‡ä»¶ï¼Œå¹¶è‡ªåŠ¨åœ¨â€œ**Project**â€å·¥å…·çª—å£ä¸­æ‰¾åˆ°å®ƒã€‚ \n\n   <img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210420114357.png\" alt=\"Context menu\" style=\"zoom:50%;\" />\n\n2. æ‚¨ä¹Ÿå¯ä»¥é€‰æ‹©â€œ**Open Files with Single Click**â€é€‰é¡¹ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“æ‚¨åœ¨â€œé¡¹ç›®â€è§†å›¾ä¸­å•å‡»æ–‡ä»¶æ—¶ï¼ŒIntelliJ IDEAå°†è‡ªåŠ¨åœ¨ç¼–è¾‘å™¨ä¸­å°†å…¶æ‰“å¼€ã€‚\n\n\n\n## åœ¨é”™è¯¯å’Œè­¦å‘Šä¹‹é—´å¯¼èˆª\n\n* è·³è½¬åˆ°ä¸‹ä¸€ä¸ªé—®é¢˜ï¼š==F2== ï¼ˆ**Navigate | Next  Highlighted Error**ï¼‰\n* è·³è½¬åˆ°ä¸Šä¸€ä¸ªé—®é¢˜ï¼š==â‡§F2== ï¼ˆ**Navigate | Previous Highlighted Error**ï¼‰\n\n* é…ç½®IntelliJ IDEAåœ¨ä»£ç é—®é¢˜ä¹‹é—´å¯¼èˆªçš„æ–¹å¼ï¼šå®ƒå¯ä»¥åœ¨æ‰€æœ‰ä»£ç é—®é¢˜ä¹‹é—´è·³è½¬ï¼Œä¹Ÿå¯ä»¥è·³è¿‡æ¬¡è¦é—®é¢˜ï¼Œå¹¶ä¸”ä»…åœ¨æ£€æµ‹åˆ°çš„é”™è¯¯ä¹‹é—´å¯¼èˆªã€‚ å³é”®å•å‡»æ»šåŠ¨æ¡åŒºåŸŸä¸­çš„ä»£ç åˆ†ææ ‡è®°ï¼Œç„¶åä»ä¸Šä¸‹æ–‡èœå•ä¸­é€‰æ‹©ä¸€ç§å¯ç”¨çš„å¯¼èˆªæ¨¡å¼ï¼š \n  * è¦ä½¿IntelliJ IDEAè·³è¿‡è­¦å‘Šï¼Œä¿¡æ¯å’Œå…¶ä»–æ¬¡è¦é—®é¢˜ï¼Œè¯·é€‰æ‹© **Go to high priority problems only**ï¼ˆä»…è½¬åˆ°é«˜ä¼˜å…ˆçº§é—®é¢˜ï¼‰ã€‚ \n  * è¦ä½¿IntelliJ IDEAåœ¨æ‰€æœ‰æ£€æµ‹åˆ°çš„ä»£ç é—®é¢˜ä¹‹é—´è·³è½¬ï¼Œè¯·é€‰æ‹©**Go to next problem**ï¼ˆè½¬åˆ°ä¸‹ä¸€ä¸ªé—®é¢˜ï¼‰ã€‚ \n\n\n\n## ä½¿ç”¨Structure View å¼¹çª—å®šä½ä»£ç å…ƒç´ \n\nå¯ä½¿ç”¨Structure View å¼¹çª—æ¥å®šä½å½“å‰æ–‡ä»¶ä¸­çš„å…ƒç´ ï¼›\n\n1. æ‰“å¼€StructureViewå¼¹çª—ï¼š ==âŒ˜F12== ï¼ˆä¹Ÿå¯ä»¥é€šè¿‡==âŒ¥F1== + ==3==æ¥æ‰“å¼€ï¼‰\n2. åœ¨å¼¹çª—ä¸­å®šä½åˆ°ä½ éœ€è¦çš„æ¡ç›®ï¼Œç„¶åæŒ‰ ==â== æ¥è¿”å›åˆ°ç¼–è¾‘å™¨çš„ç›¸åº”ä½ç½®ï¼›\n3. åœ¨å¼¹çª—ä¸­å¯ä»¥æ’åºæ–‡ä»¶ä¸­çš„å…ƒç´ ï¼Œç­›é€‰ä»¥æŸ¥çœ‹åŒ¿åç±»å’Œç»§æ‰¿ç±»æˆå‘˜ï¼›\n\n\n\n\n\n## é€šè¿‡æ–¹æ³•æµè§ˆ\n\n* æŒ‰ï¼š ==âŒƒâ†“== or ==âŒƒâ†‘== ï¼ˆå’Œmacå¿«æ·é”®å†²çªäº†ï¼‰\n* è¦åœ¨è§†è§‰ä¸Šåˆ†ç¦»ä»£ç ä¸­çš„æ–¹æ³•ï¼Œè¯·åœ¨â€œè®¾ç½®/é¦–é€‰é¡¹â€å¯¹è¯æ¡†âŒ˜ä¸­ï¼Œè½¬åˆ°â€œç¼–è¾‘å™¨â€ |â€œè®¾ç½®â€ã€‚ ä¸€èˆ¬| å¤–è§‚ï¼Œç„¶åé€‰æ‹©**Show method separators**ï¼ˆæ˜¾ç¤ºæ–¹æ³•åˆ†éš”ç¬¦ï¼‰é€‰é¡¹ã€‚\n\n* æ‰“å¼€**Structure** å·¥å…·çª—å£ï¼š==âŒ˜7==\n\n\n\n\n\n## ä½¿ç”¨é•œå¤´æ¨¡å¼\n\né•œå¤´æ¨¡å¼ä½¿æ‚¨æ— éœ€å®é™…æ»šåŠ¨å³å¯é¢„è§ˆä»£ç ã€‚ å½“æ‚¨å°†é¼ æ ‡æ‚¬åœåœ¨æ»šåŠ¨æ¡ä¸Šæ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹è¯¥æ¨¡å¼åœ¨ç¼–è¾‘å™¨ä¸­å¯ç”¨ã€‚ å°†é¼ æ ‡æ‚¬åœåœ¨è­¦å‘Šæˆ–é”™è¯¯æ¶ˆæ¯ä¸Šæ—¶ï¼Œæ­¤åŠŸèƒ½ç‰¹åˆ«æœ‰ç”¨ã€‚ \n\n<img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210420114404.png\" alt=\"Lens mode\" style=\"zoom:67%;\" />\n\n* è¦ç¦ç”¨é•œå¤´æ¨¡å¼ï¼Œè¯·å³é”®å•å‡»ä½äºç¼–è¾‘å™¨å³ä¾§çš„ä»£ç åˆ†ææ ‡è®°ï¼Œç„¶ååœ¨ä¸Šä¸‹æ–‡èœå•ä¸­æ¸…é™¤â€œåœ¨æ»šåŠ¨æ¡æ‚¬åœæ—¶æ˜¾ç¤ºä»£ç é•œå¤´â€å¤é€‰æ¡†ã€‚\n* æˆ–è€…ï¼Œåœ¨**Settings/Preferences**å¯¹è¯æ¡†==âŒ˜==ä¸­ï¼Œè½¬åˆ°**Editor | General | Appearance** å¹¶æ¸…é™¤ **Show code lens on the scrollbar hover** å¤é€‰æ¡†ã€‚\n\n\n\n## ä½¿ç”¨é¢åŒ…å±‘å¯¼èˆª\n\næ‚¨å¯ä»¥ä½¿ç”¨é¢åŒ…å±‘æµè§ˆæºä»£ç ï¼Œè¿™äº›é¢åŒ…å±‘æ˜¾ç¤ºå½“å‰æ‰“å¼€çš„æ–‡ä»¶ä¸­çš„ç±»ï¼Œå˜é‡ï¼Œå‡½æ•°ï¼Œæ–¹æ³•å’Œæ ‡è®°çš„åç§°ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯ç”¨é¢åŒ…å±‘å¹¶å°†å…¶æ˜¾ç¤ºåœ¨ç¼–è¾‘å™¨çš„åº•éƒ¨ã€‚\n\n* è¦æ›´æ”¹é¢åŒ…å±‘çš„ä½ç½®ï¼Œè¯·å³é”®å•å‡»ä¸€ä¸ªé¢åŒ…å±‘ï¼Œåœ¨ä¸Šä¸‹æ–‡èœå•ä¸­é€‰æ‹©**Breadcrumbs**å’Œä½ç½®é¦–é€‰é¡¹ã€‚\n* è¦ç¼–è¾‘é¢åŒ…å±‘è®¾ç½®ï¼Œè¯·åœ¨**Settings/Preferences**å¯¹è¯æ¡†==âŒ˜==ä¸­ï¼Œè½¬åˆ°**Editor | General | Breadcrumbs**ã€‚\n\n<img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210421085951.png\" alt=\"image-20210421085951907\" style=\"zoom:67%;\" />\n\n\n\n## é€šè¿‡å¯¼èˆªæ¡å¯¼èˆªåˆ°æ–‡ä»¶\n\nä½¿ç”¨å¯¼èˆªæ ä½œä¸ºæ–¹ä¾¿çš„å·¥å…·æ¥æŸ¥æ‰¾æ•´ä¸ªé¡¹ç›®ã€‚\n\n1. ä½¿ç”¨ ==âŒ˜â†‘==æ¥æ¿€æ´»å¯¼èˆªæ¡ï¼›\n2. ä½¿ç”¨æ–¹å‘é”®æˆ–è€…é¼ æ ‡æ¥å®šä½åˆ°æƒ³è¦çš„æ–‡ä»¶ï¼›\n3. åŒå‡»é€‰æ‹©çš„æ–‡ä»¶æˆ–è€…æŒ‰å›è½¦é”®æ¥åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€è¯¥æ–‡ä»¶ï¼›\n4. ä¹Ÿå¯ä»¥è¾“å…¥ä»¥ç­›é€‰/æœç´¢æ–‡ä»¶ï¼›\n5. ç‚¹å‡»å¯¼èˆªæ ä¸­çš„Javaç±»æˆ–è€…æ¥å£å¯ä»¥æŸ¥çœ‹å…¶æ–¹æ³•åˆ—è¡¨ï¼Œç‚¹å‡»å…¶ä¸­ä¸€ä¸ªæ–¹æ³•å¯åœ¨ç¼–è¾‘å™¨ä¸­å¿«é€Ÿè·³è½¬åˆ°å¯¹åº”çš„æ–¹æ³•ï¼›\n\n![image-20210421090027447](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210421090027.png)\n\n## æŸ¥æ‰¾æ–‡ä»¶è·¯å¾„\n\n1. åœ¨ç¼–è¾‘å™¨ä¸­ï¼ŒæŒ‰==âŒ¥âŒ˜F12== æˆ–è€…åœ¨ä¸Šä¸‹æ–‡èœå•ä¸­é€‰æ‹© **Open in | Finder**\n\n2. åœ¨ **Reveal in Finder** å¼¹çª—ä¸­ï¼Œé€‰æ‹©è¦æ‰“å¼€çš„æ–‡ä»¶æˆ–è€…ç›®å½•ï¼Œç„¶åæŒ‰ ==â==ï¼›\n\n   <img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210420114408.png\" alt=\"File path finder\" style=\"zoom: 50%;\" />\n\n> ä¹Ÿå¯ä»¥é€šè¿‡ ==âŒ˜F1== ï¼Œç„¶åæŒ‰==7==æ¥åœ¨Finderä¸­æ‰“å¼€æ­£åœ¨ç¼–è¾‘çš„æ–‡ä»¶\n\n## æŸ¥æ‰¾æœ€è¿‘çš„æ–‡ä»¶\n\nåœ¨**Recent Files**å¼¹çª—ä¸­æŸ¥æ‰¾æœ€è¿‘æˆ–è€…æœ€è¿‘ç¼–è¾‘çš„æ–‡ä»¶ï¼›\n\n1. æ‰“å¼€ **Recent Files**å¼¹çª—ï¼š ==âŒ˜E==\n\n   <img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210420114413.png\" alt=\"Recent files\" style=\"zoom:50%;\" />\n\n2. å†æ¬¡æŒ‰ ==âŒ˜E==æ¥æ¿€æ´» **Show changed only**å•é€‰æ¡†ï¼›\n\n3. å¯ä»¥è¾“å…¥æ–‡å­—ä»¥æœç´¢ï¼›\n\n<img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210421090237.png\" alt=\"image-20210421090237661\" style=\"zoom:76%;\" />\n\n> å·¦è¾¹å¯ä»¥å¯¼èˆªåˆ°å„ä¸ªå·¥å…·çª—å£ğŸ˜¯\n\n## æ–‡æœ¬åŒ¹é…å¯¼èˆªï¼ˆè‡ªè¡Œè¡¥å……ï¼‰ï¼ˆå®ç”¨ï¼‰\n\nå…‰æ ‡åœç•™åœ¨ä¸€ä¸ªæ–‡æœ¬ä¸Šæ—¶ï¼Œå¯ä»¥å¿«é€Ÿåœ¨æ‰€æœ‰å‡ºç°è¯¥æ–‡æœ¬çš„ä»£ç è¡Œä¹‹é—´å¯¼èˆªï¼š\n\n* å‘ä¸ŠæŸ¥æ‰¾ ==âŒƒâŒ¥â†‘==\n* å‘ä¸‹æŸ¥æ‰¾ ==âŒƒâŒ¥â†“==\n\n\n\n\n\n> å‚è€ƒï¼š [jetbrains-Source code navigation](https://www.jetbrains.com/help/idea/2021.1/navigating-through-the-source-code.html#find_cursor_edit)",
      "data": {
        "title": "IDEAä½¿ç”¨æŠ€å·§ä¹‹å¯¼èˆª",
        "date": "2021-04-21 14:12:14",
        "tags": [
          "å·¥å…·"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "\n\n\nä»‹ç»IDEAåŠAndroidStudioä¸­çš„å¯¼èˆªæŠ€å·§ï¼ŒåŒ…æ‹¬æ–‡ä»¶å¯¼èˆªï¼Œä»£ç å…ƒç´ ï¼ˆç±»ï¼Œæ–¹æ³•ï¼‰å¯¼èˆªï¼Œæ–‡æœ¬å¯¼èˆªç­‰ï¼Œè¿˜æœ‰ä¹¦ç­¾ç­‰çš„ä½¿ç”¨æ–¹æ³•ï¼›æé«˜ç¼–å†™ä»£ç åŠé˜…è¯»ä»£ç çš„æ•ˆç‡ï¼›",
      "fileName": "idea-shi-yong-ji-qiao-zhi-dao-hang"
    },
    {
      "content": "\n\n\næœ¬æ–‡åˆ†æbindServiceçš„æµç¨‹ï¼Œé¦–å…ˆæˆ‘ä»¬é€šè¿‡é˜…è¯»æºç è·å–ä¸€ä¸ªä¸»çº¿çš„è°ƒç”¨åœ°å›¾ï¼Œç„¶åæå‡ºè‹¥å¹²é—®é¢˜ï¼ŒåŒ…æ‹¬ï¼šAPPè¿›ç¨‹ä¸­å¦‚ä½•è·å–AMSï¼ŒAMSå¦‚ä½•å¯åŠ¨APP-serviceçš„è¿›ç¨‹ï¼ŒAMSä¸­å¦‚ä½•è·å–ApplicationThreadå¹¶ä¸ä¹‹é€šè®¯ï¼ŒServiceçš„å¯åŠ¨åŠç»‘å®šæµç¨‹ï¼›ç„¶åå†é€šè¿‡æºç ä¸€ä¸€è§£ç­”ã€‚æœ€åå†æ•´ä½“æ€»ç»“æ¢³ç†ä¸€ä¸‹æ•´ä½“æµç¨‹ï¼›\n\n<!-- more -->\n\n\n\n**é¢„å…ˆçŸ¥è¯†ï¼š**\n\n* Binderé€šä¿¡æœºåˆ¶\n\n## æ•´ä½“åˆ†æä¸æ€»ç»“\n\n### ä¸»çº¿åœ°å›¾ä¸é—®é¢˜æå‡º\n\næˆ‘ä»¬ä»bindServiceä¸€è·¯è·Ÿè¸ªï¼Œåˆæ­¥ç»˜åˆ¶äº†å¦‚ä¸‹çš„è°ƒç”¨åºåˆ—å›¾ï¼Œæˆ‘ä»¬å¯ä»¥ä»¥ä¸‹é¢çš„å›¾ä½œä¸ºä¸€ä¸ªä¸»çº¿åœ°å›¾ï¼Œé¿å…èµ°å¤±ï¼Œç„¶åæ ¹æ®å…·ä½“é—®é¢˜è¿›è¡Œç»†èŠ‚åˆ†æã€‚\n\n\n<svg width=\"812px\" height=\"553px\" viewBox=\"0 0 812 553\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n    <g id=\"Androidæºç åˆ†æ\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n        <g id=\"bindServiceæµç¨‹åˆ†æ-åŠ å…¥å¯åŠ¨æµç¨‹\" transform=\"translate(-94.000000, -222.000000)\">\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç \" transform=\"translate(125.000000, 273.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" stroke-width=\"0.870292887\" fill=\"#E4E4E4\" x=\"0.435146444\" y=\"0.435146444\" width=\"298.528768\" height=\"33.1297071\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"87.4814217\" y=\"14\">Context.bindService</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"33.3413714\" y=\"30.122449\">frameworks/base/core/java/android/content/Context.java</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½\" transform=\"translate(125.000000, 322.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" stroke-width=\"0.870292887\" fill=\"#E4E4E4\" x=\"0.435146444\" y=\"0.435146444\" width=\"298.528768\" height=\"33.1297071\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"73.439246\" y=\"14\">ContextImpl.bindService</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"32.0315806\" y=\"30.122449\">frameworks/base/core/java/android/app/ContextImpl.java</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-2\" transform=\"translate(125.000000, 373.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" stroke-width=\"0.870292887\" fill=\"#E4E4E4\" x=\"0.435146444\" y=\"0.435146444\" width=\"298.528768\" height=\"33.1297071\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"45.7569699\" y=\"14\">ContextImpl.bindServiceCommon</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"32.0315806\" y=\"30.122449\">frameworks/base/core/java/android/app/ContextImpl.java</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-3\" transform=\"translate(125.000000, 422.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" stroke-width=\"0.870292887\" fill=\"#E4E4E4\" x=\"0.435146444\" y=\"0.435146444\" width=\"298.528768\" height=\"33.1297071\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"35.1872627\" y=\"14\">IActivityManager.bindIsolatedService</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"80.4068108\" y=\"30.122449\">android/app/IActivityManager.java</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-4\" transform=\"translate(523.000000, 273.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"14.2367021\" y=\"14\">ActivityManagerService.bindIsolatedService</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"44.0851371\" y=\"30.122449\">com/android/server/am/ActivityManagerService.java</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-5\" transform=\"translate(523.000000, 322.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"45.2025933\" y=\"14\">ActiveServices.bindServiceLocked</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"62.0131706\" y=\"30.122449\">com/android/server/am/ActiveServices.java</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-16\" transform=\"translate(523.000000, 422.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"25.0439991\" y=\"14\">IApplicationThread.scheduleBindService</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"75.1632961\" y=\"30.122449\">android/app/IApplicationThread.java</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-17\" transform=\"translate(523.000000, 482.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFED99\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"102.802928\" y=\"14\">Binder.transact</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"136.553756\" y=\"30.122449\">binder</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-18\" transform=\"translate(440.000000, 273.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFED99\" x=\"0.5\" y=\"0.5\" width=\"63.3004695\" height=\"182\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"10.224946\" y=\"14\">Binder.</tspan>\n                    <tspan x=\"6.77075357\" y=\"32\">transact</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"19.0044607\" y=\"118.306122\">binder</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-18\" transform=\"translate(440.000000, 537.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFED99\" x=\"0.5\" y=\"0.5\" width=\"63.3004695\" height=\"182\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"10.224946\" y=\"14\">Binder.</tspan>\n                    <tspan x=\"6.77075357\" y=\"32\">transact</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"19.0044607\" y=\"118.306122\">binder</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-10\" transform=\"translate(522.000000, 537.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"27.1213883\" y=\"14\">ApplicationThread.scheduleBindService</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"28.0238818\" y=\"30.122449\">frameworks/base/core/java/android/app/ActivityThread.java</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-12\" transform=\"translate(522.000000, 587.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"43.344518\" y=\"14\">ActivityThread#handleBindService</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"28.0238818\" y=\"30.122449\">frameworks/base/core/java/android/app/ActivityThread.java</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-19\" transform=\"translate(522.000000, 637.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"63.1680494\" y=\"14\">IBinder = Service.onBinder()</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"104.313756\" y=\"30.122449\">è‡ªå®šä¹‰çš„Serviceå®ç°ç±»</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-20\" transform=\"translate(522.000000, 686.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"48.7055222\" y=\"14\">IActivityManager#publishService</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"80.4068108\" y=\"30.122449\">android/app/IActivityManager.java</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-21\" transform=\"translate(125.000000, 537.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"28.303246\" y=\"14\">ActivityManagerService#publishService</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"80.4068108\" y=\"30.122449\">android/app/IActivityManager.java</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-23\" transform=\"translate(125.000000, 587.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"34.5841498\" y=\"14\">ActiveServices#publishServiceLocked</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"62.0131706\" y=\"30.122449\">com/android/server/am/ActiveServices.java</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-51\" transform=\"translate(125.000000, 638.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"54.5477983\" y=\"14\">IServiceConnection#connected</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"148.202627\" y=\"30.122449\">-</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-8\" transform=\"translate(523.000000, 373.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"12.0131038\" y=\"14\">ActiveServices.requestServiceBindingLocked</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"62.0131706\" y=\"30.122449\">com/android/server/am/ActiveServices.java</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-13\" transform=\"translate(347.000000, 222.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" stroke-width=\"0.870292887\" fill=\"#E4E4E4\" x=\"0.435146444\" y=\"0.435146444\" width=\"74.4818198\" height=\"33.1297071\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"5.9181986\" y=\"14\">APP-client</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"20.8532948\" y=\"30.122449\">APPè¿›ç¨‹</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-14\" transform=\"translate(830.000000, 222.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"74.3521127\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"2.77470069\" y=\"14\">AMS-server</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"5.78852492\" y=\"30.122449\">system_process</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-14\" transform=\"translate(347.000000, 740.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"74.3521127\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"2.77470069\" y=\"14\">AMS-server</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"5.78852492\" y=\"30.122449\">system_process</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-15\" transform=\"translate(830.000000, 741.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"74.3521127\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"4.04184714\" y=\"14\">APP:server</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"5.24894333\" y=\"30.122449\">APP Serviceè¿›ç¨‹</tspan>\n                </text>\n            </g>\n            <path id=\"ç›´çº¿-16\" d=\"M811.41934,230.797071 C811.613811,230.797071 811.805612,230.843224 811.979552,230.931875 L811.979552,230.931875 L830.473932,240.357781 C831.092725,240.673158 831.343541,241.440147 831.034144,242.0709 C830.912931,242.318011 830.716358,242.518383 830.473932,242.641939 L830.473932,242.641939 L811.979552,252.067845 C811.360759,252.383221 810.608312,252.127558 810.298915,251.496806 C810.211945,251.319504 810.166667,251.123996 810.166667,250.925766 L810.166667,250.925766 L810.166,243.24 L423,243.240586 C422.038701,243.240586 421.259414,242.461299 421.259414,241.5 C421.259414,240.586766 421.962721,239.837798 422.857245,239.765184 L423,239.759414 L810.166,239.759 L810.166667,232.073954 C810.166667,231.412826 810.659593,230.869053 811.291261,230.803664 Z\" fill-opacity=\"0.56105479\" fill=\"#C9C9C9\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-16å¤‡ä»½-2\" d=\"M441.58066,746.797071 C442.272493,746.797071 442.833333,747.368751 442.833333,748.073954 L442.833333,748.073954 L442.833,755.759 L830,755.759414 C830.961299,755.759414 831.740586,756.538701 831.740586,757.5 C831.740586,758.413234 831.037279,759.162202 830.142755,759.234816 L830,759.240586 L442.833,759.24 L442.833333,766.925766 C442.833333,767.074439 442.807864,767.22158 442.758439,767.360657 L442.701085,767.496806 C442.391688,768.127558 441.639241,768.383221 441.020448,768.067845 L441.020448,768.067845 L422.526068,758.641939 C422.283642,758.518383 422.087069,758.318011 421.965856,758.0709 C421.656459,757.440147 421.907275,756.673158 422.526068,756.357781 L422.526068,756.357781 L441.020448,746.931875 C441.194388,746.843224 441.386189,746.797071 441.58066,746.797071 Z\" fill-opacity=\"0.56105479\" fill=\"#C9C9C9\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-16å¤‡ä»½\" d=\"M871.5,255.259414 C872.413234,255.259414 873.162202,255.962721 873.234816,256.857245 L873.240586,257 L873.24,721.166 L880.926046,721.166667 C881.587174,721.166667 882.130947,721.659593 882.196336,722.291261 L882.202929,722.41934 C882.202929,722.613811 882.156776,722.805612 882.068125,722.979552 L882.068125,722.979552 L872.642219,741.473932 C872.326842,742.092725 871.559853,742.343541 870.9291,742.034144 C870.681989,741.912931 870.481617,741.716358 870.358061,741.473932 L870.358061,741.473932 L860.932155,722.979552 C860.616779,722.360759 860.872442,721.608312 861.503194,721.298915 C861.680496,721.211945 861.876004,721.166667 862.074234,721.166667 L862.074234,721.166667 L869.759,721.166 L869.759414,257 C869.759414,256.038701 870.538701,255.259414 871.5,255.259414 Z\" fill-opacity=\"0.56105479\" fill=\"#C9C9C9\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿\" d=\"M272.935146,307.012222 L272.935,315.997 L276.675732,315.997076 L272.5,323.997076 L268.324268,315.997076 L272.064,315.997 L272.064854,307.012222 L272.935146,307.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-2\" d=\"M272.935146,356.012222 L272.935,364.997 L276.675732,364.997076 L272.5,372.997076 L268.324268,364.997076 L272.064,364.997 L272.064854,356.012222 L272.935146,356.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-3\" d=\"M272.935146,405.012222 L272.935,413.997 L276.675732,413.997076 L272.5,421.997076 L268.324268,413.997076 L272.064,413.997 L272.064854,405.012222 L272.935146,405.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-17\" d=\"M433.019444,433.324268 L441.019444,437.5 L433.019444,441.675732 L433.019,437.935 L423.989854,437.935146 L423.989854,437.064854 L433.019,437.064 L433.019444,433.324268 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-4\" d=\"M516.989899,284.324268 L524.989899,288.5 L516.989899,292.675732 L516.989,288.935 L505.019399,288.935146 L505.019399,288.064854 L516.989,288.064 L516.989899,284.324268 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-5\" d=\"M671.935146,307.012222 L671.935,315.997 L675.675732,315.997076 L671.5,323.997076 L667.324268,315.997076 L671.064,315.997 L671.064854,307.012222 L671.935146,307.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-6\" d=\"M671.935146,356.012222 L671.935,364.997 L675.675732,364.997076 L671.5,372.997076 L667.324268,364.997076 L671.064,364.997 L671.064854,356.012222 L671.935146,356.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-7\" d=\"M671.935146,405.012222 L671.935,413.997 L675.675732,413.997076 L671.5,421.997076 L667.324268,413.997076 L671.064,413.997 L671.064854,405.012222 L671.935146,405.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-8\" d=\"M671.935146,454.998187 L671.935,473.011 L675.675732,473.011111 L671.5,481.011111 L667.324268,473.011111 L671.064,473.011 L671.064854,454.998187 L671.935146,454.998187 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-9\" d=\"M671.935146,514.990779 L671.935,530.018 L675.675732,530.018519 L671.5,538.018519 L667.324268,530.018519 L671.064,530.018 L671.064854,514.990779 L671.935146,514.990779 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-10\" d=\"M671.935146,571.012222 L671.935,579.997 L675.675732,579.997076 L671.5,587.997076 L667.324268,579.997076 L671.064,579.997 L671.064854,571.012222 L671.935146,571.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-18\" d=\"M671.935146,621.012222 L671.935,629.997 L675.675732,629.997076 L671.5,637.997076 L667.324268,629.997076 L671.064,629.997 L671.064854,621.012222 L671.935146,621.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-11\" d=\"M671.935146,671.012222 L671.935,679.997 L675.675732,679.997076 L671.5,687.997076 L667.324268,679.997076 L671.064,679.997 L671.064854,671.012222 L671.935146,671.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-19\" d=\"M511.984127,699.324268 L511.984,703.064 L522.006575,703.064854 L522.006575,703.935146 L511.984,703.935 L511.984127,707.675732 L503.984127,703.5 L511.984127,699.324268 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-20\" d=\"M431.980556,550.324268 L431.98,554.064 L441.010146,554.064854 L441.010146,554.935146 L431.98,554.935 L431.980556,558.675732 L423.980556,554.5 L431.980556,550.324268 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-12\" d=\"M272.935146,571.012222 L272.935,579.997 L276.675732,579.997076 L272.5,587.997076 L268.324268,579.997076 L272.064,579.997 L272.064854,571.012222 L272.935146,571.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-12å¤‡ä»½\" d=\"M272.935146,621.012222 L272.935,629.997 L276.675732,629.997076 L272.5,637.997076 L268.324268,629.997076 L272.064,629.997 L272.064854,621.012222 L272.935146,621.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <g id=\"åºå·\" transform=\"translate(94.000000, 400.000000)\">\n                <circle id=\"æ¤­åœ†å½¢\" stroke=\"#888888\" stroke-width=\"1.3\" fill-opacity=\"0.5\" fill=\"#E4E4E4\" cx=\"13\" cy=\"13\" r=\"12.35\"></circle>\n                <text id=\"1\" font-family=\"NotoSansCJKsc-Black, Noto Sans CJK SC\" font-size=\"13\" font-weight=\"800\" letter-spacing=\"0.143000009\" fill=\"#020202\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"8.97\" y=\"17.6\">1</tspan>\n                </text>\n            </g>\n            <g id=\"åºå·å¤‡ä»½\" transform=\"translate(825.000000, 400.000000)\">\n                <circle id=\"æ¤­åœ†å½¢\" stroke=\"#888888\" stroke-width=\"1.3\" fill-opacity=\"0.5\" fill=\"#E4E4E4\" cx=\"13\" cy=\"13\" r=\"12.35\"></circle>\n                <text id=\"2\" font-family=\"NotoSansCJKsc-Black, Noto Sans CJK SC\" font-size=\"13\" font-weight=\"800\" letter-spacing=\"0.143000009\" fill=\"#020202\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"8.97\" y=\"17.6\">2</tspan>\n                </text>\n            </g>\n        </g>\n    </g>\n</svg>\n\n\n\nä»ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬æå‡ºå¦‚ä¸‹é—®é¢˜ï¼š\n\n1. bindServiceCommonåˆ°IActivityManagerçš„è°ƒç”¨ä¸­ï¼Œæ˜¯å¦‚ä½•è·å–åˆ°ActivityManagerServiceçš„ï¼Ÿ\n2. AMSä¸­å¦‚ä½•è·å–ApplicationThreadå¹¶ä¸ä¹‹é€šè®¯ï¼Ÿ\n   * ApplicatoinThreadçš„ç”¨é€”ï¼ŸApplicationThreadè¿è¡Œçš„è¿›ç¨‹æ˜¯å“ªä¸ªï¼Ÿ\n3. è¿›ç¨‹å¦‚ä½•å¯åŠ¨-å³AMSå¦‚ä½•åˆ›å»ºAPP:serverè¿›ç¨‹ï¼Ÿ\n4. Serviceå¦‚ä½•å¯åŠ¨ï¼Ÿ\n5. Serviceå¦‚ä½•ç»‘å®šï¼Ÿ\n   * ServiceConnection çš„å›è°ƒæ–¹æ³•ä½•æ—¶ä½¿ç”¨ï¼Ÿ\n\n### é—®é¢˜è§£ç­”æ±‡æ€»\n\næˆ‘ä»¬å°†ç›¸å…³é—®é¢˜çš„ç»“è®ºæå‰åˆ°æ­¤å°èŠ‚ï¼Œä¾¿äºåç»­ä»æ¯”è¾ƒæŠ½è±¡çš„å±‚æ¬¡ä¸Šæ¥è¿›è¡Œå¤ä¹ åŠé¢„è§ˆï¼›\n\n#### APPè¿›ç¨‹å¦‚ä½•è·å–AMSï¼Ÿ\n\n* APPè¿›ç¨‹ä¸­é€šè¿‡ `ServiceManager.getService(Context.ACTIVITY_SERVICE)` è·å–çš„ActivityManagerServiceçš„å®¢æˆ·ç«¯æ“ä½œä»£ç†å¯¹è±¡ï¼ˆProxyï¼‰ã€‚\n\n  > è¯¥å¯¹è±¡ä½äºAPPè¿›ç¨‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ­¤å¯¹è±¡ï¼ˆé€šè¿‡Binderè¿›ç¨‹é—´é€šä¿¡ï¼‰æ¥è¦æ±‚ï¼ˆä½äºsystem_processä¸­ï¼‰çš„ActivityManagerServiceè¿›è¡Œå¯¹åº”çš„æœåŠ¡æ“ä½œï¼› \n\n#### AMSå¦‚ä½•è·å–ApplicationThreadï¼Ÿ\n\n* APPè¿›ç¨‹åœ¨binderSericeæ—¶ï¼Œå°†è‡ªå·±è¿›ç¨‹ä¸­çš„ApplicationThreadå–å‡ºï¼Œé€šè¿‡Binderæœºåˆ¶ä¼ é€’ç»™AMSè¿›ç¨‹ï¼Œä¼ é€’è¿‡ç¨‹ä¸­ä¼šè½¬æ¢æˆä¸€ä¸ªProxyå¯¹è±¡ï¼›\n\n  ```java\n  ActivityManager.getService().bindIsolatedService(\n              mMainThread.getApplicationThread(), getActivityToken(), service,\n              service.resolveTypeIfNeeded(getContentResolver()),\n              sd, flags, instanceName, getOpPackageName(), user.getIdentifier());\n  ```\n\n#### æœåŠ¡å¦‚ä½•ç»‘å®šï¼ŸæœåŠ¡å¦‚ä½•å¯åŠ¨ï¼Ÿè¿›ç¨‹å¦‚ä½•å¯åŠ¨ï¼Ÿ\n\n* **è¿›ç¨‹å¯åŠ¨**ï¼š\n  * åœ¨ç‹¬ç«‹çš„è¿›ç¨‹ä¸­è¿è¡Œçš„æœåŠ¡éœ€è¦å…ˆå°†è¿›ç¨‹å¯åŠ¨ï¼Œè¿›ç¨‹çš„å¯åŠ¨æ˜¯é€šè¿‡APPè¿›ç¨‹ï¼Œè¯·æ±‚ç³»ç»Ÿè¿›ç¨‹ä¸­çš„AMSæ¥æ‰§è¡Œï¼Œé€šè¿‡AMSçš„`startProcessLocked`æ–¹æ³•å¯åŠ¨è¿›ç¨‹ï¼Œæœ€ç»ˆä¼šé€šè¿‡socketæ¥å£è¯·æ±‚zygoteè¿›ç¨‹æ¥å¯åŠ¨è¿›ç¨‹ã€‚\n  * åœ¨å¯åŠ¨æ—¶ä¼šæŒ‡å®šjavaçš„å…¥å£ç‚¹ä¸ºActivityThreadï¼Œå³è¿›ç¨‹å¯åŠ¨åä¼šè¿è¡ŒActivityThreadçš„mainæ–¹æ³•ï¼›\n  * AMSä¸­ä¼šè®°å½•å¯åŠ¨çš„è¿›ç¨‹è®°å½•ï¼ˆProcessRecordï¼‰ï¼Œå¯¹åº”çš„ProcessRecordä¸­ä¼šè®°å½•è¿›ç¨‹å¯¹åº”çš„ApplicationThreadï¼›\n* **æœåŠ¡å¯åŠ¨**ï¼š\n  * æœåŠ¡çš„å¯åŠ¨éœ€è¦è¯·æ±‚AMSæ¥å®Œæˆ\n  * å¯åŠ¨æ—¶éœ€è¦å…ˆé€šè¿‡PIDè·å–è¦å¯åŠ¨åˆ°çš„ProcessRecordï¼Œé€šè¿‡ProcessRecordä¸­è®°å½•çš„ApplicationThreadæ¥ä¸å¯¹åº”çš„è¿›ç¨‹é€šä¿¡ã€‚\n  * AMSé€šè¿‡ApplicationThreadæ¥é€šçŸ¥å¯¹åº”çš„è¿›ç¨‹åˆ›å»ºæœåŠ¡ï¼ŒApplicationThreadä½œä¸ºé€šä¿¡çš„æ¥å£ï¼Œå®é™…ä¸Šæœ€ç»ˆä¼šé€šè¿‡ActivityThreadçš„handleCreateServiceæ¥åˆ›å»ºæœåŠ¡çš„å®ä¾‹ï¼›\n  * æœåŠ¡åˆ›å»ºæ—¶ï¼Œæ˜¯åœ¨APPè¿›ç¨‹ï¼ˆå¯èƒ½æ˜¯ç‹¬ç«‹çš„è¿›ç¨‹ï¼‰ä¸­è¿›è¡Œçš„ï¼Œéœ€è¦é€šè¿‡ç±»åŠ è½½å™¨åŠ è½½å¯¹åº”çš„Serviceçš„ç±»ï¼ŒåŒæ—¶æ„é€ ç›¸åº”çš„ä¸Šä¸‹æ–‡åŠèµ„æºå¯¹è±¡ç­‰ï¼Œç„¶åæ„é€ å¯¹åº”çš„å®ä¾‹ï¼›\n  * æœåŠ¡åˆ›å»ºæˆåŠŸåï¼Œä¼šè®°å½•åˆ°ActivityThreadçš„ä¸€ä¸ªServiceåˆ—è¡¨ä¸­ï¼Œä»¥ä¾¿åç»­ç®¡ç†ï¼›\n* **æœåŠ¡ç»‘å®š**ï¼š\n  * æœåŠ¡ç»‘å®šå…ˆåœ¨APPè¿›ç¨‹ä¸­ï¼Œé€šè¿‡AMSä»£ç†å¯¹è±¡å‘èµ·è¯·æ±‚ï¼Œç”±AMSæ¥å®‰æ’bindï¼ˆ**ActivityManagerService.bindIsolatedService**ï¼‰;\n  * ç„¶åå…·ä½“çš„ç»‘å®šåŠ¨ä½œè¿˜æ˜¯é€šè¿‡IApplicationThreadå®‰æ’åˆ°APPçš„Serviceè¿›ç¨‹ä¸­ï¼Œæœ€ç»ˆæ‰§è¡Œçš„`ActivityThread#handleBindService`;\n  * åœ¨APPè¿›ç¨‹ä¸­ï¼Œä¼šå°†Serviceå–å‡ºï¼Œç„¶åè°ƒç”¨å…¶onBindæ–¹æ³•æ¥è·å–IBinderè¿œç¨‹æ“ä½œå¯¹è±¡ï¼›\n  * ä¹‹åå†é€šè¿‡AMSè°ƒç”¨ `ActivityManagerService#publishService` æ¥é€šçŸ¥ç»‘å®šæˆåŠŸçš„é€šçŸ¥åˆ°å¯¹åº”çš„éœ€è¦ç»‘å®šæœåŠ¡çš„APPè¿›ç¨‹ï¼›\n  * publishServiceä¸­ä¼šè°ƒç”¨ServiceConnectionçš„onServiceConnectedæ–¹æ³•é€šçŸ¥æœåŠ¡è¿æ¥äº†ï¼›\n\n### æ•´ä½“æµç¨‹æ€»ç»“\n\n#### é—®é¢˜\n\n## è¯¦ç»†åˆ†æè§£ç­”é—®é¢˜\n\n### APPè¿›ç¨‹ä¸­å¦‚ä½•è·å–AMSï¼Ÿ\n\n> è¯´æ˜ï¼š\n>\n> * ç¬¬ä¸€æ¬¡å…ˆé€é¡¹æŸ¥çœ‹å„ä¸ªå°èŠ‚ï¼Œæœ€åå†çœ‹æ­¤å¤„çš„æ€»ç»“ï¼›\n>\n> * åç»­ç›´æ¥æŸ¥çœ‹æ€»ç»“æ¥å¿«é€Ÿè·å–ç»“è®ºï¼›\n\n==æ€»ç»“ï¼š==\n\n* APPè¿›ç¨‹ä¸­é€šè¿‡ `ServiceManager.getService(Context.ACTIVITY_SERVICE)` è·å–çš„ActivityManagerServiceçš„å®¢æˆ·ç«¯æ“ä½œä»£ç†å¯¹è±¡ï¼ˆProxyï¼‰ã€‚\n* è¯¥å¯¹è±¡ä½äºAPPè¿›ç¨‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ­¤å¯¹è±¡ï¼ˆé€šè¿‡Binderè¿›ç¨‹é—´é€šä¿¡ï¼‰æ¥è¦æ±‚ï¼ˆä½äºsystem_processä¸­ï¼‰çš„ActivityManagerServiceè¿›è¡Œå¯¹åº”çš„æœåŠ¡æ“ä½œï¼› \n\nå…·ä½“æŸ¥çœ‹å¦‚ä¸‹ä»£ç ï¼š\n\n#### ContextImpl.bindServiceCommon\n\næˆ‘ä»¬çœ‹ `ContextImpl.bindServiceCommon` æ–¹æ³•çš„å®ç°ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯è°ƒç”¨äº† ActivityManager.getService() è·å–çš„ï¼›\n\n`frameworks/base/core/java/android/app/ContextImpl.java`: \n\n```java\nprivate boolean bindServiceCommon(Intent service, ServiceConnection conn, int flags,\n            String instanceName, Handler handler, Executor executor, UserHandle user) {\n        // Keep this in sync with DevicePolicyManager.bindDeviceAdminServiceAsUser.\n        IServiceConnection sd;\n        \n        if (executor != null) {\n            sd = mPackageInfo.getServiceDispatcher(conn, getOuterContext(), executor, flags);\n        } else {\n            sd = mPackageInfo.getServiceDispatcher(conn, getOuterContext(), handler, flags);\n        }\n\t    //\n        int res = ActivityManager.getService().bindIsolatedService(\n            mMainThread.getApplicationThread(), getActivityToken(), service,\n            service.resolveTypeIfNeeded(getContentResolver()),\n            sd, flags, instanceName, getOpPackageName(), user.getIdentifier());\n\n}\n```\n\n#### `ActivityManager.getService()`\n\nå¦‚ä¸‹ä»£ç ï¼ŒgetServiceå®é™…ä¸Šæ˜¯ä»ServiceManagerè·å–ä¸€ä¸ªActivityServiceçš„Binderè¿œç¨‹æœåŠ¡æ¥å£å¯¹è±¡ï¼Œå¹¶ä¸”è¿™ä¸ªä¼šè¢«è®¾ç½®ä¸ºå•ä¾‹æ¨¡å¼ï¼›\n\n`frameworks/base/core/java/android/app/ActivityManager.java`:\n\n```java\nprivate static final Singleton<IActivityManager> IActivityManagerSingleton =\n    new Singleton<IActivityManager>() {\n    @Override\n    protected IActivityManager create() {\n        // ç›´æ¥é€šè¿‡ ServiceManager.getService è·å–ä¸€ä¸ªIBinderå¯¹è±¡\n        final IBinder b = ServiceManager.getService(Context.ACTIVITY_SERVICE);\n        final IActivityManager am = IActivityManager.Stub.asInterface(b);\n        return am;\n    }\n};\n\npublic static IActivityManager getService() {\n    // ç›´æ¥ä»IActivityManagerSingletonè·å–å®ä¾‹\n    return IActivityManagerSingleton.get();\n}\n```\n\n### AMSå¦‚ä½•è·å–åˆ° ApplicatoinThreadï¼Ÿ\n\né¦–å…ˆï¼ŒAMSå®é™…ä¸Šä½äºç³»ç»Ÿè¿›ç¨‹ï¼ˆsystem_process)ï¼Œè€ŒApplicationThreadåˆ™ä½äºæˆ‘ä»¬çš„APPè¿›ç¨‹ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªè·¨è¿›ç¨‹çš„æ“ä½œå‘¢ï¼Ÿ\n\n* Serviceçš„åˆ›å»ºéœ€è¦ç»è¿‡ç³»ç»Ÿçš„ç®¡ç†ï¼Œæ¯”æ–¹è¯´é‰´æƒåŠå…¶ä»–ç®¡ç†éœ€è¦ï¼›\n* è€Œå¼€å‘è€…å®šä¹‰çš„Serviceçš„å®ä¾‹çš„åˆ›å»ºé€»è¾‘ä¹Ÿè¿˜æ˜¯éœ€è¦å¼€å‘è€…æ¥å®ç°ï¼ŒServiceå¯¹åº”çš„ç±»ä¹Ÿåº”è¯¥åªåŠ è½½åœ¨å¼€å‘è€…è‡ªå·±çš„è¿›ç¨‹ä¹‹ä¸­ï¼ŒServiceä½¿ç”¨æ–¹å®é™…ä¸Šè¿˜æ˜¯å¼€å‘è€…è‡ªå·±ï¼Œæ‰€ä»¥æœåŠ¡çš„çœŸå®å®ä¾‹çš„åˆ›å»ºè¿‡ç¨‹è¦åœ¨åº”ç”¨çš„è¿›ç¨‹ä¸­ï¼›\n\né‚£ä¹ˆï¼Œç³»ç»Ÿè¿›ç¨‹ï¼ˆä¸­çš„AMSï¼‰å¦‚ä½•è·å–ApplicationThreadå‘¢ï¼Ÿ\n\n#### ApplicationThreadçš„æ¥æºï¼Ÿ\n\næŸ¥çœ‹ **ContextImpl.bindServiceCommon** çš„ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œæ˜¯åœ¨è°ƒç”¨AMSçš„bindServiceæ–¹æ³•æ—¶ï¼Œå°†è‡ªå·±è¿›ç¨‹ä¸­çš„ApplicationThreadåŠActivityTokenå–å‡ºä¼ é€’ç»™äº†AMSæœåŠ¡ï¼›\n\n```java\n// frameworks/base/core/java/android/app/ContextImpl.java\nfinal @NonNull ActivityThread mMainThread;\nprivate final @Nullable IBinder mToken;\n\npublic IBinder getActivityToken() {\n    return mToken;\n}\n\nprivate boolean bindServiceCommon(Intent service, ServiceConnection conn, int flags,\n            String instanceName, Handler handler, Executor executor, UserHandle user) {\n        // Keep this in sync with DevicePolicyManager.bindDeviceAdminServiceAsUser.\n        IServiceConnection sd;\n        try {\n            service.prepareToLeaveProcess(this);\n            // è°ƒç”¨æ—¶ä¼ é€’äº†ApplicationThreadå’ŒIBinder\n            int res = ActivityManager.getService().bindIsolatedService(\n                mMainThread.getApplicationThread(), getActivityToken(), service,\n                service.resolveTypeIfNeeded(getContentResolver()),\n                sd, flags, instanceName, getOpPackageName(), user.getIdentifier());\n            if (res < 0) {\n                throw new SecurityException(\n                        \"Not allowed to bind to service \" + service);\n            }\n            return res != 0;\n        } catch (RemoteException e) {\n            throw e.rethrowFromSystemServer();\n        }\n    }\n```\n\nå®é™…ä¸Šï¼Œä¸Šé¢çš„`mMainThread.getApplicationThread()`å–å‡ºçš„æ˜¯æˆ‘ä»¬çš„APPè¿›ç¨‹ä¸­çš„ApplicationThreadçš„æœåŠ¡ç«¯å¯¹è±¡ï¼Œç„¶åç»è¿‡IActivityManagerè¿›è¡Œbinderä¼ è¾“ï¼ˆtransactï¼‰å‰ï¼Œä¼šå°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªProxyä»£ç†å¯¹è±¡ï¼Œç”¨äºåœ¨AMSä¸­è¯·æ±‚æˆ‘ä»¬è¿›ç¨‹çš„ApplicationThreadæ¥æä¾›æœåŠ¡ï¼› \n\n```java\n// android.app.IActivityManager.Stub#TRANSACTION_bindIsolatedService \ncase TRANSACTION_bindIsolatedService:\n        {\n          data.enforceInterface(descriptor);\n          android.app.IApplicationThread _arg0;\n          // è¿™é‡Œå°†IApplicationThreadçš„æœåŠ¡å¯¹è±¡è½¬æ¢æˆä¸€ä¸ªProxyä»£ç†å¯¹è±¡\n          _arg0 = android.app.IApplicationThread.Stub.asInterface(data.readStrongBinder());\n          android.os.IBinder _arg1;\n          _arg1 = data.readStrongBinder();\n          android.content.Intent _arg2;\n          if ((0!=data.readInt())) {\n            _arg2 = android.content.Intent.CREATOR.createFromParcel(data);\n          }\n          else {\n            _arg2 = null;\n          }\n          java.lang.String _arg3;\n          _arg3 = data.readString();\n          android.app.IServiceConnection _arg4;\n          // åŒç†ï¼Œè¿™é‡Œå°†IServiceConnectionçš„æœåŠ¡å¯¹è±¡ä¹Ÿè½¬æ¢æˆä¸€ä¸ªProxyä»£ç†å¯¹è±¡\n          _arg4 = android.app.IServiceConnection.Stub.asInterface(data.readStrongBinder());\n          int _arg5;\n          _arg5 = data.readInt();\n          java.lang.String _arg6;\n          _arg6 = data.readString();\n          java.lang.String _arg7;\n          _arg7 = data.readString();\n          int _arg8;\n          _arg8 = data.readInt();\n          int _result = this.bindIsolatedService(_arg0, _arg1, _arg2, _arg3, _arg4, _arg5, _arg6, _arg7, _arg8);\n          reply.writeNoException();\n          reply.writeInt(_result);\n          return true;\n        }\n        \n// android.app.IApplicationThread.Stub\n /** Local-side IPC implementation stub class. */\n  public static abstract class Stub extends android.os.Binder implements android.app.IApplicationThread\n  {\n    private static final java.lang.String DESCRIPTOR = \"android.app.IApplicationThread\";\n    /** Construct the stub at attach it to the interface. */\n    public Stub()\n    {\n      this.attachInterface(this, DESCRIPTOR);\n    }\n    /**\n     * Cast an IBinder object into an android.app.IApplicationThread interface,\n     * generating a proxy if needed.\n     */\n    public static android.app.IApplicationThread asInterface(android.os.IBinder obj)\n    {\n      if ((obj==null)) {\n        return null;\n      }\n      android.os.IInterface iin = obj.queryLocalInterface(DESCRIPTOR);\n      if (((iin!=null)&&(iin instanceof android.app.IApplicationThread))) {\n        return ((android.app.IApplicationThread)iin);\n      }\n      // è¿™é‡Œæ„é€ æˆäº†Proxy\n      return new android.app.IApplicationThread.Stub.Proxy(obj);\n    }\n  }\n```\n\n\n> è¿™é‡Œæˆ‘ä»¬æš‚ä¸è€ƒè™‘ApplicationThreadç”±ä½•å¤„è€Œæ¥ï¼Œæ¯ä¸ªè¿›ç¨‹ä¸­éƒ½å¯¹åº”ä¸€ä¸ªActivityThreadï¼ŒActivityThreadä¸­æœ‰ä¸€ä¸ªApplicationThreadå¯¹è±¡ã€‚\n\n#### ApplicationThreadåœ¨bindæµç¨‹ä¸­çš„ä½¿ç”¨\n\næˆ‘ä»¬å‘ç°ï¼Œæœ€ç»ˆæ˜¯ä½¿ç”¨ `ApplicationThread`çš„ `requestServiceBindingLocked` æ–¹æ³•æ¥ç»‘å®šæœåŠ¡çš„ã€‚ä¸è¿‡è¿™é‡Œä½¿ç”¨çš„æ—¶å€™æ˜¯ç»è¿‡äº†å‡ æ¬¡æˆå‘˜å˜é‡æ“ä½œç¬¦ï¼ˆ`r.app.thread.scheduleBindService`ï¼‰ï¼Œæˆ‘ä»¬å…ˆæ¢³ç†ä¸€ä¸‹ServiceRecordç±»åŒApplicationThreadçš„å…³ç³»ï¼›\n\n```java\n// frameworks/base/services/core/java/com/android/server/am/ActiveServices.java\n// com.android.server.am.ActiveServices#requestServiceBindingLocked\nprivate final boolean requestServiceBindingLocked(ServiceRecord r, IntentBindRecord i,\n            boolean execInFg, boolean rebind) throws TransactionTooLargeException {\n        if (r.app == null || r.app.thread == null) {\n            // If service is not currently running, can't yet bind.\n            return false;\n        }\n\t    // è°ƒç”¨ApplicationThreadçš„ç»‘å®šæ–¹æ³•æ¥è¿›è¡Œç»‘å®š\n        r.app.thread.scheduleBindService(r, i.intent.getIntent(), rebind,\n                                         r.app.getReportedProcState());\n        return true;\n    }\n\n// frameworks/base/services/core/java/com/android/server/am/ServiceRecord.java\nProcessRecord app;          // where this service is running or null.\n\n// frameworks/base/services/core/java/com/android/server/am/ProcessRecord.java\nIApplicationThread thread;  // the actual proc...  may be null only if\n                            // 'persistent' is true (in which case we\n                            // are in the process of launching the app)\n```\n\nå…¶ä¸­ `ServiceRecord.app` çš„ç±»å‹ä¸º `ProcessRecord` ï¼Œ`ServiceRecord.app.thread` çš„ç±»å‹ä¸º `IApplicationThread`ï¼Œæˆ‘ä»¬æ¢³ç†ä¸‹å¯¹åº”çš„å‡ ä¸ªç±»çš„å…³ç³»ï¼Œå¦‚ä¸‹å›¾ï¼š\n\n\n<svg width=\"772px\" height=\"493px\" viewBox=\"0 0 772 493\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n    <g id=\"Androidæºç åˆ†æ\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n        <g id=\"ServiceRecordç±»å›¾\" transform=\"translate(-31.000000, -33.000000)\">\n            <g id=\"UML/ç±»å›¾/ç±»æ¨¡å—\" transform=\"translate(32.000000, 34.000000)\">\n                <g id=\"åç§°\" transform=\"translate(-0.284133, 0.000000)\">\n                    <path d=\"M214.320588,-0.5 C215.563229,-0.5 216.688229,0.00367965644 217.502569,0.818019485 C218.316909,1.63235931 218.820588,2.75735931 218.820588,4 L218.820588,4 L218.820588,27.4753086 L-0.179411765,27.4753086 L-0.179411765,4 C-0.179411765,2.75735931 0.324267892,1.63235931 1.13860772,0.818019485 C1.95294755,0.00367965644 3.07794755,-0.5 4.32058824,-0.5 L4.32058824,-0.5 Z\" id=\"æ ‡é¢˜\" stroke=\"#979797\" fill=\"#F4F4F4\"></path>\n                    <text id=\"Class-Name\" font-family=\"NotoSansCJKsc-Medium, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"400\" letter-spacing=\"0.154000005\" fill=\"#020202\" fill-opacity=\"0.88378138\">\n                        <tspan x=\"60.4815882\" y=\"16\">ServiceRecord</tspan>\n                    </text>\n                </g>\n                <g id=\"å±æ€§\" transform=\"translate(0.036455, 26.975309)\">\n                    <rect stroke=\"#979797\" fill=\"#F6FFDF\" x=\"-0.5\" y=\"-0.5\" width=\"219\" height=\"45.0123457\"></rect>\n                    <text id=\"Properties\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"300\" letter-spacing=\"0.154000005\" fill=\"#020202\" fill-opacity=\"0.88378138\">\n                        <tspan x=\"6\" y=\"17\">app:ProcessRecord </tspan>\n                        <tspan x=\"6\" y=\"37\">isolatedProc: ProcessRecord</tspan>\n                    </text>\n                </g>\n                <g id=\"æ–¹æ³•\" transform=\"translate(0.036455, 70.987654)\">\n                    <path d=\"M218.5,-0.5 L218.5,40.0123457 C218.5,41.2549864 217.99632,42.3799864 217.181981,43.1943262 C216.367641,44.008666 215.242641,44.5123457 214,44.5123457 L214,44.5123457 L4,44.5123457 C2.75735931,44.5123457 1.63235931,44.008666 0.818019485,43.1943262 C0.00367965644,42.3799864 -0.5,41.2549864 -0.5,40.0123457 L-0.5,40.0123457 L-0.5,-0.5 L218.5,-0.5 Z\" stroke=\"#979797\" fill=\"#FFDFDF\"></path>\n                    <text id=\"Methods\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"300\" letter-spacing=\"0.154000005\" fill=\"#020202\" fill-opacity=\"0.88378138\">\n                        <tspan x=\"5\" y=\"16\">+ setProcess(ProcessRecord)</tspan>\n                    </text>\n                </g>\n            </g>\n            <g id=\"UML/ç±»å›¾/ç±»æ¨¡å—å¤‡ä»½-3\" transform=\"translate(310.000000, 34.000000)\">\n                <g id=\"åç§°\" transform=\"translate(-0.639952, 0.000000)\">\n                    <path d=\"M487.722059,-0.5 C488.9647,-0.5 490.0897,0.00367965644 490.904039,0.818019485 C491.718379,1.63235931 492.222059,2.75735931 492.222059,4 L492.222059,4 L492.222059,39.9074074 L0.222058824,39.9074074 L0.222058824,4 C0.222058824,2.75735931 0.72573848,1.63235931 1.54007831,0.818019485 C2.35441814,0.00367965644 3.47941814,-0.5 4.72205882,-0.5 L4.72205882,-0.5 Z\" id=\"æ ‡é¢˜\" stroke=\"#979797\" fill=\"#F4F4F4\"></path>\n                    <text id=\"Class-Name\" font-family=\"NotoSansCJKsc-Medium, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"400\" letter-spacing=\"0.154000005\" fill=\"#020202\" fill-opacity=\"0.88378138\">\n                        <tspan x=\"181.017059\" y=\"16\">IApplicationThread</tspan>\n                    </text>\n                </g>\n                <g id=\"å±æ€§\" transform=\"translate(0.082107, 39.407407)\">\n                    <rect stroke=\"#979797\" fill=\"#F6FFDF\" x=\"-0.5\" y=\"-0.5\" width=\"492\" height=\"65.2962963\"></rect>\n                    <text id=\"Properties\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"300\" letter-spacing=\"0.154000005\"></text>\n                </g>\n                <g id=\"æ–¹æ³•\" transform=\"translate(0.082107, 103.703704)\">\n                    <path d=\"M491.5,-0.5 L491.5,60.2962963 C491.5,61.538937 490.99632,62.663937 490.181981,63.4782768 C489.367641,64.2926166 488.242641,64.7962963 487,64.7962963 L487,64.7962963 L4,64.7962963 C2.75735931,64.7962963 1.63235931,64.2926166 0.818019485,63.4782768 C0.00367965644,62.663937 -0.5,61.538937 -0.5,60.2962963 L-0.5,60.2962963 L-0.5,-0.5 L491.5,-0.5 Z\" stroke=\"#979797\" fill=\"#FFDFDF\"></path>\n                    <text id=\"Methods\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"300\" letter-spacing=\"0.154000005\" fill=\"#020202\" fill-opacity=\"0.88378138\">\n                        <tspan x=\"5\" y=\"16\">+ scheduleBindService(IBinder, Intent, boolean rebind, int processState) </tspan>\n                        <tspan x=\"5\" y=\"36\">+ scheduleCreateService(IBinder, ServiceInfo info,â€¦ ) </tspan>\n                        <tspan x=\"5\" y=\"56\">+ bindApplication(â€¦)</tspan>\n                    </text>\n                </g>\n            </g>\n            <g id=\"UML/ç±»å›¾/ç±»æ¨¡å—å¤‡ä»½-4\" transform=\"translate(310.000000, 264.000000)\">\n                <g id=\"åç§°\" transform=\"translate(-0.311504, 0.000000)\">\n                    <path d=\"M235.351471,-0.5 C236.594111,-0.5 237.719111,0.00367965644 238.533451,0.818019485 C239.347791,1.63235931 239.851471,2.75735931 239.851471,4 L239.851471,4 L239.851471,25.3641975 L-0.148529412,25.3641975 L-0.148529412,4 C-0.148529412,2.75735931 0.355150245,1.63235931 1.16949007,0.818019485 C1.9838299,0.00367965644 3.1088299,-0.5 4.35147059,-0.5 L4.35147059,-0.5 Z\" id=\"æ ‡é¢˜\" stroke=\"#979797\" fill=\"#F4F4F4\"></path>\n                    <text id=\"Class-Name\" font-family=\"NotoSansCJKsc-Medium, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"400\" letter-spacing=\"0.154000005\" fill=\"#020202\" fill-opacity=\"0.88378138\">\n                        <tspan x=\"36.6004705\" y=\"16\">IApplicationThread.Stub</tspan>\n                    </text>\n                </g>\n                <g id=\"å±æ€§\" transform=\"translate(0.039967, 24.864198)\">\n                    <rect stroke=\"#979797\" fill=\"#F6FFDF\" x=\"-0.5\" y=\"-0.5\" width=\"240\" height=\"41.5679012\"></rect>\n                    <text id=\"Properties\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"300\" letter-spacing=\"0.154000005\"></text>\n                </g>\n                <g id=\"æ–¹æ³•\" transform=\"translate(0.039967, 65.432099)\">\n                    <path d=\"M239.5,-0.5 L239.5,36.5679012 C239.5,37.8105419 238.99632,38.9355419 238.181981,39.7498817 C237.367641,40.5642216 236.242641,41.0679012 235,41.0679012 L235,41.0679012 L4,41.0679012 C2.75735931,41.0679012 1.63235931,40.5642216 0.818019485,39.7498817 C0.00367965644,38.9355419 -0.5,37.8105419 -0.5,36.5679012 L-0.5,36.5679012 L-0.5,-0.5 L239.5,-0.5 Z\" stroke=\"#979797\" fill=\"#FFDFDF\"></path>\n                    <text id=\"Methods\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"300\" letter-spacing=\"0.154000005\"></text>\n                </g>\n            </g>\n            <g id=\"UML/ç±»å›¾/ç±»æ¨¡å—å¤‡ä»½-5\" transform=\"translate(310.000000, 419.000000)\">\n                <g id=\"åç§°\" transform=\"translate(-0.311504, 0.000000)\">\n                    <path d=\"M235.351471,-0.5 C236.594111,-0.5 237.719111,0.00367965644 238.533451,0.818019485 C239.347791,1.63235931 239.851471,2.75735931 239.851471,4 L239.851471,4 L239.851471,25.3641975 L-0.148529412,25.3641975 L-0.148529412,4 C-0.148529412,2.75735931 0.355150245,1.63235931 1.16949007,0.818019485 C1.9838299,0.00367965644 3.1088299,-0.5 4.35147059,-0.5 L4.35147059,-0.5 Z\" id=\"æ ‡é¢˜\" stroke=\"#979797\" fill=\"#F4F4F4\"></path>\n                    <text id=\"Class-Name\" font-family=\"NotoSansCJKsc-Medium, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"400\" letter-spacing=\"0.154000005\" fill=\"#020202\" fill-opacity=\"0.88378138\">\n                        <tspan x=\"56.8864705\" y=\"16\">ApplicationThread</tspan>\n                    </text>\n                </g>\n                <g id=\"å±æ€§\" transform=\"translate(0.039967, 24.864198)\">\n                    <rect stroke=\"#979797\" fill=\"#F6FFDF\" x=\"-0.5\" y=\"-0.5\" width=\"240\" height=\"41.5679012\"></rect>\n                    <text id=\"Properties\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"300\" letter-spacing=\"0.154000005\"></text>\n                </g>\n                <g id=\"æ–¹æ³•\" transform=\"translate(0.039967, 65.432099)\">\n                    <path d=\"M239.5,-0.5 L239.5,36.5679012 C239.5,37.8105419 238.99632,38.9355419 238.181981,39.7498817 C237.367641,40.5642216 236.242641,41.0679012 235,41.0679012 L235,41.0679012 L4,41.0679012 C2.75735931,41.0679012 1.63235931,40.5642216 0.818019485,39.7498817 C0.00367965644,38.9355419 -0.5,37.8105419 -0.5,36.5679012 L-0.5,36.5679012 L-0.5,-0.5 L239.5,-0.5 Z\" stroke=\"#979797\" fill=\"#FFDFDF\"></path>\n                    <text id=\"Methods\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"300\" letter-spacing=\"0.154000005\"></text>\n                </g>\n            </g>\n            <g id=\"UML/ç±»å›¾/ç±»æ¨¡å—å¤‡ä»½\" transform=\"translate(32.000000, 183.000000)\">\n                <g id=\"åç§°\" transform=\"translate(-0.284133, 0.000000)\">\n                    <path d=\"M214.320588,-0.5 C215.563229,-0.5 216.688229,0.00367965644 217.502569,0.818019485 C218.316909,1.63235931 218.820588,2.75735931 218.820588,4 L218.820588,4 L218.820588,27.4753086 L-0.179411765,27.4753086 L-0.179411765,4 C-0.179411765,2.75735931 0.324267892,1.63235931 1.13860772,0.818019485 C1.95294755,0.00367965644 3.07794755,-0.5 4.32058824,-0.5 L4.32058824,-0.5 Z\" id=\"æ ‡é¢˜\" stroke=\"#979797\" fill=\"#F4F4F4\"></path>\n                    <text id=\"Class-Name\" font-family=\"NotoSansCJKsc-Medium, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"400\" letter-spacing=\"0.154000005\" fill=\"#020202\" fill-opacity=\"0.88378138\">\n                        <tspan x=\"59.2005882\" y=\"16\">ProcessRecord</tspan>\n                    </text>\n                </g>\n                <g id=\"å±æ€§\" transform=\"translate(0.036455, 26.975309)\">\n                    <rect stroke=\"#979797\" fill=\"#F6FFDF\" x=\"-0.5\" y=\"-0.5\" width=\"219\" height=\"45.0123457\"></rect>\n                    <text id=\"Properties\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"300\" letter-spacing=\"0.154000005\" fill=\"#020202\" fill-opacity=\"0.88378138\">\n                        <tspan x=\"6\" y=\"17\">thread:IApplicationThread </tspan>\n                        <tspan x=\"6\" y=\"37\">pid: int</tspan>\n                    </text>\n                </g>\n                <g id=\"æ–¹æ³•\" transform=\"translate(0.036455, 70.987654)\">\n                    <path d=\"M218.5,-0.5 L218.5,40.0123457 C218.5,41.2549864 217.99632,42.3799864 217.181981,43.1943262 C216.367641,44.008666 215.242641,44.5123457 214,44.5123457 L214,44.5123457 L4,44.5123457 C2.75735931,44.5123457 1.63235931,44.008666 0.818019485,43.1943262 C0.00367965644,42.3799864 -0.5,41.2549864 -0.5,40.0123457 L-0.5,40.0123457 L-0.5,-0.5 L218.5,-0.5 Z\" stroke=\"#979797\" fill=\"#FFDFDF\"></path>\n                    <text id=\"Methods\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"300\" letter-spacing=\"0.154000005\"></text>\n                </g>\n            </g>\n            <g id=\"UML/ç±»å›¾/ç±»æ¨¡å—å¤‡ä»½-2\" transform=\"translate(32.000000, 332.000000)\">\n                <g id=\"åç§°\" transform=\"translate(-0.284133, 0.000000)\">\n                    <path d=\"M214.320588,-0.5 C215.563229,-0.5 216.688229,0.00367965644 217.502569,0.818019485 C218.316909,1.63235931 218.820588,2.75735931 218.820588,4 L218.820588,4 L218.820588,27.4753086 L-0.179411765,27.4753086 L-0.179411765,4 C-0.179411765,2.75735931 0.324267892,1.63235931 1.13860772,0.818019485 C1.95294755,0.00367965644 3.07794755,-0.5 4.32058824,-0.5 L4.32058824,-0.5 Z\" id=\"æ ‡é¢˜\" stroke=\"#979797\" fill=\"#F4F4F4\"></path>\n                    <text id=\"Class-Name\" font-family=\"NotoSansCJKsc-Medium, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"400\" letter-spacing=\"0.154000005\" fill=\"#020202\" fill-opacity=\"0.88378138\">\n                        <tspan x=\"59.6275882\" y=\"16\">ActivityThread</tspan>\n                    </text>\n                </g>\n                <g id=\"å±æ€§\" transform=\"translate(0.036455, 26.975309)\">\n                    <rect stroke=\"#979797\" fill=\"#F6FFDF\" x=\"-0.5\" y=\"-0.5\" width=\"219\" height=\"45.0123457\"></rect>\n                    <text id=\"Properties\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"300\" letter-spacing=\"0.154000005\" fill=\"#020202\" fill-opacity=\"0.88378138\">\n                        <tspan x=\"6\" y=\"17\">mAppThread:ApplicationThread</tspan>\n                    </text>\n                </g>\n                <g id=\"æ–¹æ³•\" transform=\"translate(0.036455, 70.987654)\">\n                    <path d=\"M218.5,-0.5 L218.5,40.0123457 C218.5,41.2549864 217.99632,42.3799864 217.181981,43.1943262 C216.367641,44.008666 215.242641,44.5123457 214,44.5123457 L214,44.5123457 L4,44.5123457 C2.75735931,44.5123457 1.63235931,44.008666 0.818019485,43.1943262 C0.00367965644,42.3799864 -0.5,41.2549864 -0.5,40.0123457 L-0.5,40.0123457 L-0.5,-0.5 L218.5,-0.5 Z\" stroke=\"#979797\" fill=\"#FFDFDF\"></path>\n                    <text id=\"Methods\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"300\" letter-spacing=\"0.154000005\"></text>\n                </g>\n            </g>\n            <g id=\"UML/ç±»å›¾/çº¿æ¡/èšåˆ\" transform=\"translate(132.000000, 149.000000)\">\n                <path id=\"ç›´çº¿-24\" d=\"M4.01066824,9.66098325 L5.01044532,9.68209681 L4.99988854,10.1819853 L4.65783637,26.3789701 L4.529,32.448 L8.22683349,26.1900249 L8.4811105,25.7595099 L9.34214059,26.2680639 L9.08786358,26.6985789 L4.41995827,34.6017846 L3.96791026,35.3671447 L3.54857702,34.5833825 L-0.781511421,26.4901549 L-1.01738637,26.0492887 L-0.135653962,25.5775388 L0.100220985,26.018405 L3.529,32.428 L3.65805929,26.3578565 L4.00011146,10.1608718 L4.01066824,9.66098325 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n                <path d=\"M4.5065476,0.824414956 L8.13197663,5.5 L4.5065476,10.175585 L0.998600008,5.5 L4.5065476,0.824414956 Z\" id=\"å¤šè¾¹å½¢\" stroke=\"#979797\"></path>\n            </g>\n            <g id=\"ç¼–ç»„\" transform=\"translate(277.500000, 162.500000)\" fill=\"#979797\">\n                <g id=\"UML/ç±»å›¾/çº¿æ¡/ç»„åˆ\" transform=\"translate(2.500000, 29.500000) rotate(-90.000000) translate(-2.500000, -29.500000) \">\n                    <path id=\"ç›´çº¿-24\" d=\"M2.00288144,9.84713507 L3.00286493,9.85288144 L2.99999174,10.3528732 L2.76527988,51.1974318 L2.73,57.282 L6.33087375,50.9672406 L6.57850452,50.5328687 L7.44724844,51.0281302 L7.19961767,51.4625022 L2.653721,59.4365114 L2.21348852,60.2087282 L1.78215985,59.431503 L-2.67179488,51.4057764 L-2.91441726,50.9685872 L-2.04003889,50.4833425 L-1.79741651,50.9205317 L1.73,57.276 L1.76529639,51.1916854 L2.00000826,10.3471268 L2.00288144,9.84713507 Z\" fill-rule=\"nonzero\"></path>\n                    <polygon id=\"å¤šè¾¹å½¢\" stroke=\"#979797\" points=\"2.46928974 0 6.73396667 5.5 2.46928974 11 -1.65719103 5.5\"></polygon>\n                </g>\n            </g>\n            <g id=\"ç¼–ç»„\" transform=\"translate(278.500000, 402.500000)\" fill=\"#979797\">\n                <g id=\"UML/ç±»å›¾/çº¿æ¡/ç»„åˆ\" transform=\"translate(2.500000, 29.500000) rotate(-90.000000) translate(-2.500000, -29.500000) \">\n                    <path id=\"ç›´çº¿-24\" d=\"M2.00288144,9.84713507 L3.00286493,9.85288144 L2.99999174,10.3528732 L2.76527988,51.1974318 L2.73,57.282 L6.33087375,50.9672406 L6.57850452,50.5328687 L7.44724844,51.0281302 L7.19961767,51.4625022 L2.653721,59.4365114 L2.21348852,60.2087282 L1.78215985,59.431503 L-2.67179488,51.4057764 L-2.91441726,50.9685872 L-2.04003889,50.4833425 L-1.79741651,50.9205317 L1.73,57.276 L1.76529639,51.1916854 L2.00000826,10.3471268 L2.00288144,9.84713507 Z\" fill-rule=\"nonzero\"></path>\n                    <polygon id=\"å¤šè¾¹å½¢\" stroke=\"#979797\" points=\"2.46928974 0 6.73396667 5.5 2.46928974 11 -1.65719103 5.5\"></polygon>\n                </g>\n            </g>\n            <g id=\"UML/ç±»å›¾/çº¿æ¡/å®ç°\" transform=\"translate(425.000000, 202.000000)\" stroke=\"#979797\">\n                <line x1=\"4.5\" y1=\"61.6653117\" x2=\"4.5\" y2=\"7.44579946\" id=\"ç›´çº¿-24\" stroke-linecap=\"square\" stroke-dasharray=\"2\"></line>\n                <path d=\"M4.5,0.218033989 L7.69098301,6.6 L1.30901699,6.6 L4.5,0.218033989 Z\" id=\"ä¸‰è§’å½¢\"></path>\n            </g>\n            <g id=\"UML/ç±»å›¾/çº¿æ¡/ç»§æ‰¿\" transform=\"translate(430.000000, 370.000000)\" stroke=\"#979797\">\n                <line x1=\"4.5\" y1=\"48.7469136\" x2=\"4.5\" y2=\"8\" id=\"ç›´çº¿-24\" stroke-linecap=\"square\"></line>\n                <path d=\"M4.5,1.11803399 L7.69098301,7.5 L1.30901699,7.5 L4.5,1.11803399 Z\" id=\"ä¸‰è§’å½¢\"></path>\n            </g>\n        </g>\n    </g>\n</svg>\n\n\nç°åœ¨æˆ‘ä»¬çœ‹ä¸‹ ServiceRecord æ˜¯ä½•æ—¶æ„é€ çš„ï¼Œé¦–å…ˆï¼Œæ ¹æ®æ–¹æ³•çš„è°ƒç”¨å±‚æ¬¡ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š\n\n* `ActiveServices.bindServiceLocked` æ–¹æ³•ä¸­ï¼Œå‚æ•°ä¸­æ²¡æœ‰ServiceRecordï¼Œæœ‰çš„æ˜¯IApplicationThreadåŠä¸€ä¸ªIBinderã€‚\n* `ActiveServices.requestServiceBindingLocked` æ–¹æ³•ä¸­ï¼Œåˆ™å˜æˆäº†ServiceRecordç±»å‹ã€‚\n\n![image-20210410215833909](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210410215833.png)\n\n> æç¤ºï¼šä¸Šè¿°è°ƒç”¨å±‚æ¬¡å¯ä»¥åœ¨IDEAä¸­é€‰ä¸­`ActiveServices.requestServiceBindingLocked`æ–¹æ³•ï¼Œç„¶åé€šè¿‡â€œ**Navigateï½œCall Hierarchy**â€ï¼ˆå¿«æ·é”®ä¸º==ctrl+opt+H==ï¼‰å¼¹å‡ºã€‚\n\n\n\næ‰€ä»¥ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸‹ `ActiveServices.bindServiceLocked` æ–¹æ³•å¦‚ä½•å°†`ApplicationThread`å­˜å…¥åˆ°`ServiceRecord`å¯¹è±¡ä¸­ã€‚\n\n##### ActiveServices.bindServiceLocked\n\n```java\n    int bindServiceLocked(IApplicationThread caller, IBinder token, Intent service,\n            String resolvedType, final IServiceConnection connection, int flags,\n            String instanceName, String callingPackage, final int userId)\n            throws TransactionTooLargeException {\n        final int callingPid = Binder.getCallingPid();\n        final int callingUid = Binder.getCallingUid();\n        // è¿™é‡Œè·å–äº† ProcessRecord\n        final ProcessRecord callerApp = mAm.getRecordForAppLocked(caller);\n\n        final boolean callerFg = callerApp.setSchedGroup != ProcessList.SCHED_GROUP_BACKGROUND;\n        final boolean isBindExternal = (flags & Context.BIND_EXTERNAL_SERVICE) != 0;\n        final boolean allowInstant = (flags & Context.BIND_ALLOW_INSTANT) != 0;\n\n        // å°†IApplicationThreadåŠIBinderæ”¾å…¥åˆ°ServiceRecordä¸­çš„è¿‡ç¨‹åœ¨retrieveServiceLockedä¸­\n        ServiceLookupResult res =\n            retrieveServiceLocked(service, instanceName, resolvedType, callingPackage,\n                    callingPid, callingUid, userId, true,\n                    callerFg, isBindExternal, allowInstant);\n        // æ­¤å¤„è·å–ServiceRecordï¼Œæ•…åœ¨ä¸Šé¢\n        ServiceRecord s = res.record;\n        if (s.app != null && b.intent.received) {\n            requestServiceBindingLocked(s, b.intent, callerFg, true);\n        } else if (!b.intent.requested) {\n            requestServiceBindingLocked(s, b.intent, callerFg, false);\n        }\n        return 1;\n    }\n```\n\nåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ServiceRecordæ˜¯é€šè¿‡`retrieveServiceLocked`æ–¹æ³•è·å–åˆ°çš„`ServiceLookupResult`è·å–åˆ°çš„ã€‚\n\n==ç²—ç•¥çœ‹äº†ä¸‹è¿™ä¸ª`retrieveServiceLocked`æ–¹æ³•ï¼Œå…¶ä¸­é€»è¾‘æ¯”è¾ƒå¤šï¼Œæˆ‘ä»¬è¿™é‡Œè½¬æ¢ä¸‹æ€è·¯ï¼Œç›´æ¥æŸ¥æ‰¾ `ServiceRecord.app` çš„èµ‹å€¼æ“ä½œ==ã€‚\n\n##### `ServiceRecord.app` çš„èµ‹å€¼\n\næˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ServiceRecord.appï¼ˆProcessRecordï¼‰çš„èµ‹å€¼æ“ä½œçš„è°ƒç”¨æ–¹æ³•ä¸ºï¼š`com.android.server.am.ActiveServices#realStartServiceLocked`\n\n```java\nprivate final void realStartServiceLocked(ServiceRecord r,\n            ProcessRecord app, boolean execInFg) throws RemoteException {\n        if (app.thread == null) {\n            throw new RemoteException();\n        }\n    \t// åœ¨æ­¤å¤„èµ‹å€¼\n        r.setProcess(app);\n\t    // ...\n}\n```\n\næŸ¥çœ‹ `realStartServiceLocked` çš„è°ƒç”¨åºåˆ—ï¼š\n\n<img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210410224824.png\" alt=\"image-20210410224824691\" style=\"zoom:50%;\" />\n\nä¹Ÿå°±æ˜¯åˆå›åˆ°äº†æˆ‘ä»¬çš„ `bindServiceLocked` æ–¹æ³•ï¼Œå…¶ä¸­æœ‰ä¸€æ®µé€»è¾‘æ˜¯ï¼Œå¦‚æœéœ€è¦åˆ›å»ºæœåŠ¡ï¼Œå°±æ‰§è¡Œ `bringUpServiceLocked` æ–¹æ³•ã€‚\n\n```java\n// com.android.server.am.ActiveServices#bindServiceLocked   \nint bindServiceLocked(IApplicationThread caller, IBinder token, Intent service,\n            String resolvedType, final IServiceConnection connection, int flags,\n            String instanceName, String callingPackage, final int userId)\n            throws TransactionTooLargeException {   \n        // ... \n\t\t\tif ((flags&Context.BIND_AUTO_CREATE) != 0) {\n                s.lastActivity = SystemClock.uptimeMillis();\n                if (bringUpServiceLocked(s, service.getFlags(), callerFg, false,\n                        permissionsReviewRequired) != null) {\n                    return 0;\n                }\n            }\n        // ... \n    }\n```\n\nä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ç»‘å®šæœåŠ¡çš„æ—¶å€™ï¼Œå¦‚æœæœåŠ¡æ²¡æœ‰åˆ›å»ºï¼Œå°±å…ˆä½¿ç”¨`bringUpServiceLocked`-`realStartServiceLocked` è¿›è¡Œåˆ›å»ºï¼Œåˆ›å»ºè¿‡ç¨‹ä¸­ä¼šå°†ServiceRecordä¸­çš„appèµ‹å€¼ï¼Œç„¶åå­˜å‚¨èµ·æ¥ï¼›\n\n> æç¤ºï¼šæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹IDEAæ“ä½œæ¥æŸ¥æ‰¾èµ‹å€¼æ“ä½œ\n>\n> 1. é€‰ä¸­æˆå‘˜ï¼ˆè¿™é‡Œæ˜¯ appï¼‰ï¼›\n>\n> 2. ==Ctrl+B== æˆ–è€… ==Command+é¼ æ ‡å•å‡»==ï¼Œå¼¹å‡ºä½¿ç”¨åˆ—è¡¨å¼¹çª—ï¼›\n>\n> 3. ç„¶ååœ¨å¼¹çª—ä¸­è®¾ç½®ä»…æŸ¥çœ‹writeè®¿é—®æ“ä½œçš„ï¼›ç„¶åæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„èµ‹å€¼ä»£ç è¡Œï¼›\n>\n>    <img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210410223230.png\" alt=\"image-20210410223230694\" style=\"zoom:50%;\" />\n>\n> 4. é€šè¿‡å‹¾é€‰å…¶ä¸­çš„æ–¹æ³•å›¾æ ‡ï¼Œæˆ‘ä»¬å¯ä»¥æ˜¾ç¤ºèµ‹å€¼çš„ä»£ç è¡Œæ‰€åœ¨çš„æ–¹æ³•ï¼ˆè¿™é‡Œæ˜¯setProcessï¼‰ï¼›\n>\n>    <img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210410223820.png\" alt=\"image-20210410223820657\" style=\"zoom:50%;\" />\n>\n> 5. ç„¶åæˆ‘ä»¬ç»§ç»­åœ¨æ–¹æ³•ä¸Šæ‰§è¡Œä¸Šè¿°æ“ä½œï¼Œå¯ä»¥è·å–åˆ°æ›´åŠ ä¸Šä¸€æ­¥çš„èµ‹å€¼è°ƒç”¨åœ¨å“ªï¼›\n>\n>    <img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210410224023.png\" alt=\"image-20210410224023641\" style=\"zoom:50%;\" />\n\n### æœåŠ¡å¦‚ä½•ç»‘å®šï¼ŸæœåŠ¡å¦‚ä½•å¯åŠ¨ï¼Ÿè¿›ç¨‹å¦‚ä½•å¯åŠ¨ï¼Ÿ\n\n1. **bringUpServiceLocked(ServiceRecord r,...)** ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºServiceRecordï¼Œå…¶ä¸­çš„appå±æ€§å¯å­˜å‚¨ä¸€ä¸ªè¿›ç¨‹è®°å½•ï¼› \n2. å¦‚ä¼ å…¥çš„ServiceRecordå‚æ•°ä¸­è¡¨æ˜æœåŠ¡å·²ç»å¯åŠ¨è¿‡ï¼Œ`r.app(ProcessRecord)` ä¸ä¸ºnullï¼Œä¸”`r.app.thread(IApplicationThread)`ä¹Ÿä¸ä¸ºnullï¼Œåˆ™ä¸åˆ›å»ºï¼Œç›´æ¥æ›´æ–°å‚æ•°ï¼›\n3. ç»“ä¸‹æ¥ï¼Œåˆ™åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼Œ1ï¼‰æœåŠ¡ä¸ºå£°æ˜å•ç‹¬çš„è¿›ç¨‹ï¼Œåˆ™å¯ç›´æ¥åœ¨å½“å‰è¿›ç¨‹ä¸­å¯åŠ¨ï¼›2ï¼‰æœåŠ¡å£°æ˜äº†å•ç‹¬çš„è¿›ç¨‹ï¼Œåˆ™éœ€è¦å…ˆå¯åŠ¨è¿›ç¨‹ï¼Œç„¶åå†å¯åŠ¨æœåŠ¡ï¼›\n4. **éå•ç‹¬è¿›ç¨‹**ï¼š\n   * è¿›ç¨‹è®°å½•è·å–ï¼šé€šè¿‡AMSç›´æ¥æŸ¥è¯¢ï¼Œå¹¶æœªåˆ›å»ºï¼Œå› ä¸ºè¿›ç¨‹å·²ç»å­˜åœ¨äº†ï¼Œå…·ä½“ä»£ç ä¸º `app = mAm.getProcessRecordLocked(procName, r.appInfo.uid, false)`\n   * æœåŠ¡å¯åŠ¨ï¼šä½¿ç”¨ `realStartServiceLocked(r, app, execInFg);` æ–¹æ³•å¯åŠ¨\n5. **å•ç‹¬è¿›ç¨‹**ï¼š\n   * è¿›ç¨‹è®°å½•è·å–ï¼š é€šè¿‡AMS.mAm.startProcessLocked æ–¹æ³•å¯åŠ¨ä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼› \n     * `app=mAm.startProcessLocked(procName, r.appInfo, true, intentFlags,\n                           hostingRecord, ZYGOTE_POLICY_FLAG_EMPTY, false, isolated, false)`\n   * æœåŠ¡å¯åŠ¨ï¼šæœªåœ¨æ­¤æ–¹æ³•ä¸­ç›´æ¥è°ƒç”¨ `realStartServiceLocked`\n\nè¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨**å•ç‹¬è¿›ç¨‹**çš„æœåŠ¡å¯åŠ¨æµç¨‹ä¸­ï¼Œå¹¶æ²¡æœ‰å³æ—¶è°ƒç”¨`realStartServiceLocked`æ¥å¯åŠ¨æœåŠ¡ï¼Œé‚£ä¹ˆè¿™é‡Œå°±åˆä¸ªé—®é¢˜ï¼Œç‹¬ç«‹è¿›ç¨‹æƒ…å†µä¸‹æœåŠ¡ä½•æ—¶å¯åŠ¨ï¼Ÿ\n\n6. **å•ç‹¬è¿›ç¨‹æœåŠ¡å¯åŠ¨ï¼š** å°†å¾…å¯åŠ¨çš„æœåŠ¡åŠ å…¥åˆ°`mPendingServices(ArrayList<ServiceRecord>)`ï¼Œåœ¨å¯åŠ¨è¿›ç¨‹åå†ä»æ­¤åˆ—è¡¨ä¸­è¯»å–éœ€è¦å¯åŠ¨çš„æœåŠ¡ï¼Œç„¶åå¯åŠ¨ï¼›\n\n\n\n**æ€»ç»“ï¼š** \n\n1. è¿›ç¨‹è®°å½•å¦‚ä½•è·å–ï¼Ÿ\n\n   * é€šè¿‡AMSçš„ `startProcessLocked` æ–¹æ³•åˆ›å»ºï¼ˆéç‹¬ç«‹è¿›ç¨‹çš„ä¹Ÿåº”è¯¥æ˜¯é€šè¿‡æ­¤æ–¹æ³•åˆ›å»ºï¼Œåªæ˜¯åˆ›å»ºæ—¶æœºä¸æ˜¯è¿™é‡Œï¼‰\n\n2. æœåŠ¡å¦‚ä½•å¯åŠ¨ï¼Ÿ\n\n   * é€šè¿‡ `realStartServiceLocked` æ–¹æ³•å¯åŠ¨ï¼ˆç‹¬ç«‹è¿›ç¨‹çš„åº”è¯¥ä¹Ÿæ˜¯æ­¤æ–¹æ³•å¯åŠ¨ï¼Œä¼šç­‰åˆ°è¿›ç¨‹å¯åŠ¨ä¹‹åå†å¯åŠ¨ï¼‰\n\n   * > `realStartServiceLocked` ä¸­é€šè¿‡ `IApplicationThread` æ‰§è¡Œ `scheduleCreateService` æ¥å¯åŠ¨æœåŠ¡ï¼Œæœ€ç»ˆè°ƒç”¨ `android.app.ActivityThread.ApplicationThread#scheduleCreateService`æ¥å¯åŠ¨ï¼›\n\n### è¿›ç¨‹åˆ›å»º\n\n> é—®é¢˜ï¼š\n>\n> 1. è¿›ç¨‹ä½•æ—¶åˆ›å»ºï¼Ÿ- å·²è§£å†³\n> 2. ApplicationThreadï¼ˆä»£ç†ï¼‰å¯¹è±¡ä½•æ—¶è®¾ç½®åˆ°ProcessRecordä¸­? - å·²è§£å†³\n> 3. ActivityThread#mainçš„å…¥å£ç‚¹ä¸­ï¼Œå¦‚ä½•è·å–ä¹‹å‰çš„ç»“æœï¼Ÿ - å·²è§£å†³\n\nä¸‹é¢ä¸ºåˆ›å»ºè¿›ç¨‹çš„è°ƒç”¨åºåˆ—ï¼Œæ³¨æ„å¦‚ä¸‹åºåˆ—ä¸­åªæ˜¯åˆ›å»ºäº†ä¸€ä¸ªProcessRecordçš„å¯¹è±¡ï¼Œå¯¹åº”äºLinuxä¸Šçš„è¿›ç¨‹åˆ›å»ºæˆ‘ä»¬å†èµ·æ–‡ç« è¿›è¡Œåˆ†æï¼Œå¯¹äºæˆ‘ä»¬çš„Serviceæ¥è¯´ï¼Œæ‹¿åˆ°ProcessRecordå¯¹è±¡å³å¯ä¾›æˆ‘ä»¬æ¥åˆ›å»ºæœåŠ¡ï¼›\n\n\n<svg width=\"684px\" height=\"748px\" viewBox=\"0 0 684 748\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n    <g id=\"Androidæºç åˆ†æ\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n        <g id=\"bindServiceæµç¨‹åˆ†æ-åŠ å…¥å¯åŠ¨æµç¨‹\" transform=\"translate(-923.000000, -331.000000)\">\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-25\" transform=\"translate(925.000000, 417.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"13.8711791\" y=\"14\">ActivityManagerService#startProcessLocked</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"44.0851371\" y=\"30.122449\">com/android/server/am/ActivityManagerService.java</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-37\" transform=\"translate(1254.000000, 417.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"13.8711791\" y=\"14\">ActivityManagerService#startProcessLocked</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"37.0705764\" y=\"30.122449\">startProcessLocked(hostingRecord, entryPoint) å¸¦å…¥å£ç‚¹</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-38\" transform=\"translate(1232.000000, 473.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"173.816901\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"11.1847185\" y=\"14\">ProcessList#startProcess</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"14.2951452\" y=\"30.122449\">å¸¦å…¥å£ç±» android.app.ActivityThread</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-49\" transform=\"translate(1423.000000, 473.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"182.859155\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"2.72977831\" y=\"14\">handleProcessStartedLocked</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"29.1292427\" y=\"30.122449\">è®°å½•ProcessRecordï¼ˆé€šè¿‡PIDï¼‰</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-39\" transform=\"translate(1254.000000, 529.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"22.2538402\" y=\"14\">android.os.ZygoteProcess#startViaZygote</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"76.586225\" y=\"30.122449\">å¸¦å…¥å£ç±» android.app.ActivityThread</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-40\" transform=\"translate(1254.000000, 585.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"11.0871121\" y=\"14\">ZygoteProcess#zygoteSendArgsAndGetResult</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"76.586225\" y=\"30.122449\">å¸¦å…¥å£ç±» android.app.ActivityThread</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-41\" transform=\"translate(1254.000000, 647.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFED99\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"129.589673\" y=\"14\">zygote</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"110.270911\" y=\"30.122449\">zygoteåˆ›å»ºæ–°çš„è¿›ç¨‹</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-42\" transform=\"translate(1254.000000, 703.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"80.8715473\" y=\"14\">ActivityThread#main()</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"101.306895\" y=\"30.122449\">è¿›ç¨‹åˆ›å»ºåæ‰§è¡Œå…¥å£å‡½æ•°</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-44\" transform=\"translate(1254.000000, 758.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"81.6756979\" y=\"14\">ActivityThread#attach</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"134.190911\" y=\"30.122449\">module</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-26\" transform=\"translate(925.000000, 477.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"46.9144594\" y=\"14\">ProcessList#startProcessLocked()</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"67.9050534\" y=\"30.122449\">com/android/server/am/ProcessList.java</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-11\" transform=\"translate(923.000000, 532.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"31.8488192\" y=\"14\">ProcessList#newProcessRecordLocked</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"67.9050534\" y=\"30.122449\">com/android/server/am/ProcessList.java</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-27\" transform=\"translate(923.000000, 582.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"31.8488192\" y=\"14\">ProcessList#newProcessRecordLocked</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"69.8066434\" y=\"30.122449\">new ProcessRecord(ams, info, proc, uid)</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-9\" transform=\"translate(923.000000, 368.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"32.543313\" y=\"14\">ActiveServices#bringUpServiceLocked</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"62.0131706\" y=\"30.122449\">com/android/server/am/ActiveServices.java</tspan>\n                </text>\n            </g>\n            <path id=\"ç›´çº¿-7å¤‡ä»½\" d=\"M1073.93515,400.012222 L1073.935,408.997 L1077.67573,408.997076 L1073.5,416.997076 L1069.32427,408.997076 L1073.064,408.997 L1073.06485,400.012222 L1073.93515,400.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-8å¤‡ä»½\" d=\"M1073.93515,449.998187 L1073.935,468.011 L1077.67573,468.011111 L1073.5,476.011111 L1069.32427,468.011111 L1073.064,468.011 L1073.06485,449.998187 L1073.93515,449.998187 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-9å¤‡ä»½\" d=\"M1073.93515,508.990779 L1073.935,524.018 L1077.67573,524.018519 L1073.5,532.018519 L1069.32427,524.018519 L1073.064,524.018 L1073.06485,508.990779 L1073.93515,508.990779 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-10å¤‡ä»½\" d=\"M1073.93515,565.012222 L1073.935,573.997 L1077.67573,573.997076 L1073.5,581.997076 L1069.32427,573.997076 L1073.064,573.997 L1073.06485,565.012222 L1073.93515,565.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <text id=\"åˆ›å»ºè¿›ç¨‹\" font-family=\"NotoSansCJKsc-Black, Noto Sans CJK SC\" font-size=\"18.2\" font-weight=\"800\" letter-spacing=\"0.200199999\" fill=\"#020202\" fill-opacity=\"0.88378138\">\n                <tspan x=\"1223.1996\" y=\"347\">åˆ›å»ºè¿›ç¨‹</tspan>\n            </text>\n            <line x1=\"1222.66\" y1=\"434.5\" x2=\"1254.34\" y2=\"434.5\" id=\"ç›´çº¿-23\" stroke=\"#979797\" stroke-width=\"1.3\" stroke-linecap=\"square\"></line>\n            <path id=\"ç›´çº¿-13\" d=\"M1353.15,450.007895 L1353.15,463.953 L1357.75,463.953216 L1352.5,474.953216 L1347.25,463.953216 L1351.85,463.953 L1351.85,450.007895 L1353.15,450.007895 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-14\" d=\"M1372.15,505.988889 L1372.15,517.972 L1376.75,517.972222 L1371.5,528.972222 L1366.25,517.972222 L1370.85,517.972 L1370.85,505.988889 L1372.15,505.988889 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-14å¤‡ä»½\" d=\"M1505.15,449.988889 L1505.15,461.972 L1509.75,461.972222 L1504.5,472.972222 L1499.25,461.972222 L1503.85,461.972 L1503.85,449.988889 L1505.15,449.988889 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-15\" d=\"M1403.15,562.988889 L1403.15,574.972 L1407.75,574.972222 L1402.5,585.972222 L1397.25,574.972222 L1401.85,574.972 L1401.85,562.988889 L1403.15,562.988889 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-24\" d=\"M1403.15,619.002174 L1403.15,637.958 L1407.75,637.958937 L1402.5,648.958937 L1397.25,637.958937 L1401.85,637.958 L1401.85,619.002174 L1403.15,619.002174 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <text id=\"socket\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"10.4\" font-weight=\"300\" letter-spacing=\"0.114399999\" fill=\"#020202\" fill-opacity=\"0.88378138\">\n                <tspan x=\"1406.4208\" y=\"634\">socket</tspan>\n            </text>\n            <path id=\"ç›´çº¿-25\" d=\"M1403.15,680.988889 L1403.15,692.972 L1407.75,692.972222 L1402.5,703.972222 L1397.25,692.972222 L1401.85,692.972 L1401.85,680.988889 L1403.15,680.988889 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <line x1=\"1572.5\" y1=\"503.649733\" x2=\"1572.5\" y2=\"988.350267\" id=\"ç›´çº¿-26\" stroke=\"#979797\" stroke-width=\"1.3\" stroke-linecap=\"square\" stroke-dasharray=\"3.9\"></line>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-45\" transform=\"translate(1254.000000, 816.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"39.6222753\" y=\"14\">IActivityManager#attachApplication</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"134.190911\" y=\"30.122449\">module</tspan>\n                </text>\n            </g>\n            <path id=\"ç›´çº¿-27\" d=\"M1403.15,735.988889 L1403.15,747.972 L1407.75,747.972222 L1402.5,758.972222 L1397.25,747.972222 L1401.85,747.972 L1401.85,735.988889 L1403.15,735.988889 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-28\" d=\"M1403.15,792 L1403.15,806.961 L1407.75,806.961111 L1402.5,817.961111 L1397.25,806.961111 L1401.85,806.961 L1401.85,792 L1403.15,792 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-46\" transform=\"translate(1254.000000, 929.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"19.2199992\" y=\"14\">ActivityManagerService#attachApplication</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"134.190911\" y=\"30.122449\">module</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-47\" transform=\"translate(1218.000000, 989.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"368.7277\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"32.5625946\" y=\"14\">ActivityManagerService#attachApplicationLocked</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"113.952385\" y=\"30.122449\">è·å–ä¹‹å‰ç¼“å­˜çš„ProcessRecord(app)</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-50\" transform=\"translate(1218.000000, 1045.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"368.7277\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"100.665624\" y=\"14\">ProcessRecord#makeActive</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"67.8834312\" y=\"30.122449\">app.makeActive(thread, mProcessStats) ; thread = _thread;</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-36\" transform=\"translate(1254.000000, 870.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFED99\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"124.320049\" y=\"14\">transact</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"136.553756\" y=\"30.122449\">binder</tspan>\n                </text>\n            </g>\n            <path id=\"ç›´çº¿-29\" d=\"M1403.15,848.997059 L1403.15,859.964 L1407.75,859.964052 L1402.5,870.964052 L1397.25,859.964052 L1401.85,859.964 L1401.85,848.997059 L1403.15,848.997059 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-30\" d=\"M1403.15,902.992857 L1403.15,918.968 L1407.75,918.968254 L1402.5,929.968254 L1397.25,918.968254 L1401.85,918.968 L1401.85,902.992857 L1403.15,902.992857 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-31\" d=\"M1403.15,962.992857 L1403.15,978.968 L1407.75,978.968254 L1402.5,989.968254 L1397.25,978.968254 L1401.85,978.968 L1401.85,962.992857 L1403.15,962.992857 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-32\" d=\"M1403.15,1022.98889 L1403.15,1034.972 L1407.75,1034.97222 L1402.5,1045.97222 L1397.25,1034.97222 L1401.85,1034.972 L1401.85,1022.98889 L1403.15,1022.98889 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n        </g>\n    </g>\n</svg>\n\n\n\n* è¿›ç¨‹åˆ›å»ºçš„æ‰§è¡Œä½äºAMSæ‰€åœ¨çš„ç³»ç»Ÿè¿›ç¨‹ä¹‹ä¸­ï¼›\n* ï¼ˆAMSè¿›ç¨‹ï¼‰é¦–å…ˆï¼Œæ„å»ºä¸€ä¸ªProcessRecordè®°å½•ï¼Œå¹¶å°†å…¶è®°å½•åˆ°AMSä¸­ï¼›\n* ï¼ˆAMSè¿›ç¨‹ï¼‰AMSé€šè¿‡socketé€šä¿¡ï¼Œé€šçŸ¥zygoteæ¥åˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼ŒåŒæ—¶æŒ‡å®šå…¥å£ç‚¹ä¸º `android.app.ActivityThread` ;\n* ï¼ˆAPPè¿›ç¨‹ï¼‰æ–°çš„è¿›ç¨‹å¯åŠ¨åï¼Œæ‰§è¡ŒActivityThreadä¸­çš„æ–¹æ³•ï¼Œé€šçŸ¥AMSæ¥æ‰§è¡ŒattachApplicationï¼›\n* ï¼ˆAMSè¿›ç¨‹ï¼‰AMSä¸­ï¼Œé€šè¿‡PIDè·å–ä¹‹å‰å­˜å‚¨çš„ProcessRecordï¼Œç„¶åå°†ApplicationThreadï¼ˆä»£ç†å¯¹è±¡ï¼‰èµ‹å€¼ç»™ProcessRecordçš„æˆå‘˜å˜é‡threadï¼›\n* æ”¯æŒå®Œæˆäº†å…³è”ï¼›\n\n#### æ„é€ ProcessRecordå®ä¾‹\n\n`com.android.server.am.ProcessList#startProcessLocked`ï¼Œç®€åŒ–ä¸‹æ¥å°±ä¸¤å¥ï¼š\n\n* æ„é€ ProcessRecordå¯¹è±¡ï¼š `app = newProcessRecordLocked(info, processName, isolated, isolatedUid, hostingRecord)`\n* å¯åŠ¨è¿›ç¨‹ï¼š`startProcessLocked(app, hostingRecord, zygotePolicyFlags, abiOverride)`\n\n```java\n// com.android.server.am.ProcessList#newProcessRecordLocked\n// frameworks/base/services/core/java/com/android/server/am/ProcessList.java\nfinal ProcessRecord startProcessLocked(String processName, ApplicationInfo info,\n            boolean knownToBeDead, int intentFlags, HostingRecord hostingRecord,\n            int zygotePolicyFlags, boolean allowWhileBooting, boolean isolated, int isolatedUid,\n            boolean keepIfLarge, String abiOverride, String entryPoint, String[] entryPointArgs,\n            Runnable crashHandler) {\n        long startTime = SystemClock.uptimeMillis();\n        ProcessRecord app;\n        if (app == null) {\n            // æ„é€ ProcessRecordå¯¹è±¡\n            app = newProcessRecordLocked(info, processName, isolated, isolatedUid, hostingRecord);\n            app.crashHandler = crashHandler;\n            app.isolatedEntryPoint = entryPoint;\n            app.isolatedEntryPointArgs = entryPointArgs;\n        } else {\n            // If this is a new package in the process, add the package to the list\n            app.addPackage(info.packageName, info.longVersionCode, mService.mProcessStats);\n        }\n\t    // å¯åŠ¨è¿›ç¨‹\n        final boolean success =\n                startProcessLocked(app, hostingRecord, zygotePolicyFlags, abiOverride);\n        checkSlow(startTime, \"startProcess: done starting proc!\");\n        return success ? app : null;\n    }\n```\n\n#### å¯åŠ¨è¿›ç¨‹ \n\n`startProcessLocked`: å¯åŠ¨äº†ä¸€ä¸ªè¿›ç¨‹ï¼Œå¹¶æŒ‡å®šäº†å…¥å£ç‚¹ä¸º ==android.app.ActivityThread==ï¼Œä¹Ÿå°±æ˜¯è¿›ç¨‹å¯åŠ¨åå°†ä¼šæ‰§è¡Œ ==android.app.ActivityThread==çš„mainæ–¹æ³•ã€‚\n\n```java\n// frameworks/base/services/core/java/com/android/server/am/ProcessList.java\n// com.android.server.am.ProcessList#startProcessLocked(com.android.server.am.ProcessRecord, com.android.server.am.HostingRecord, int, boolean, boolean, boolean, java.lang.String)\nboolean startProcessLocked(ProcessRecord app, HostingRecord hostingRecord,\n            int zygotePolicyFlags, boolean disableHiddenApiChecks, boolean disableTestApiChecks,\n            boolean mountExtStorageFull, String abiOverride) {\n        if (app.pendingStart) {\n            return true;\n        }\n        long startTime = SystemClock.uptimeMillis();\n        try {\n            try {\n                final int userId = UserHandle.getUserId(app.uid);\n                AppGlobals.getPackageManager().checkPackageStartable(app.info.packageName, userId);\n            } catch (RemoteException e) {\n                throw e.rethrowAsRuntimeException();\n            }\n\n            int uid = app.uid;\n            int[] gids = null;\n            // ... \n            \n            app.mountMode = mountExternal;\n            app.gids = gids;\n            app.setRequiredAbi(requiredAbi);\n            app.instructionSet = instructionSet;\n\n            final String seInfo = app.info.seInfo\n                    + (TextUtils.isEmpty(app.info.seInfoUser) ? \"\" : app.info.seInfoUser);\n            // Start the process.  It will either succeed and return a result containing\n            // the PID of the new process, or else throw a RuntimeException.\n            // æŒ‡å®šå…¥å£ç‚¹ä¸ºActivityThreadï¼Œå¯åŠ¨è¿›ç¨‹\n            final String entryPoint = \"android.app.ActivityThread\";\n            return startProcessLocked(hostingRecord, entryPoint, app, uid, gids,\n                    runtimeFlags, zygotePolicyFlags, mountExternal, seInfo, requiredAbi,\n                    instructionSet, invokeWith, startTime);\n        } catch (RuntimeException e) {\n            return false;\n        }\n    }\n\n\nboolean startProcessLocked(HostingRecord hostingRecord, String entryPoint, ProcessRecord app,\n            int uid, int[] gids, int runtimeFlags, int zygotePolicyFlags, int mountExternal,\n            String seInfo, String requiredAbi, String instructionSet, String invokeWith,\n            long startTime) {\n        app.pendingStart = true;\n        app.killedByAm = false;\n        app.removed = false;\n        app.killed = false;\n        final long startSeq = app.startSeq = ++mProcStartSeqCounter;\n        app.setStartParams(uid, hostingRecord, seInfo, startTime);\n        app.setUsingWrapper(invokeWith != null\n                || Zygote.getWrapProperty(app.processName) != null);\n        mPendingStarts.put(startSeq, app);\n\n        if (mService.mConstants.FLAG_PROCESS_START_ASYNC) {\n            return true;\n        } else {\n            try {\n                // å¯åŠ¨è¿›ç¨‹ï¼Œå¹¶ä¼ å…¥entrypoint\n                final Process.ProcessStartResult startResult = startProcess(hostingRecord,\n                        entryPoint, app,\n                        uid, gids, runtimeFlags, zygotePolicyFlags, mountExternal, seInfo,\n                        requiredAbi, instructionSet, invokeWith, startTime);\n                // åšå¯åŠ¨åçš„æ“ä½œ\n                handleProcessStartedLocked(app, startResult.pid, startResult.usingWrapper,\n                        startSeq, false);\n            } catch (RuntimeException e) {\n                \n            }\n            return app.pid > 0;\n        }\n    }\n```\n\nè¿™é‡Œæˆ‘ä»¬çœç•¥å…¶ä»–æ›´åŠ åº•å±‚çš„æ­¥éª¤çš„åˆ†æï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“åˆ°äº†è¿™é‡Œä¹‹åï¼Œä¼šå¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ï¼Œè¿›ç¨‹å¯åŠ¨åä¼šæ‰§è¡Œ ==android.app.ActivityThread#main== æ–¹æ³•ï¼›\n\n#### è®°å½•è¿›ç¨‹è®°å½•åˆ°AMS\n\n`ProcessList#handleProcessStartedLocked(com.android.server.am.ProcessRecord, int, boolean, long, boolean)`\n\n==è¿™ä¸ªåœ°æ–¹æœ‰ä¸ªå…³é”®çš„ä»£ç å°†ä¹‹å‰åˆ›å»ºçš„è¿›ç¨‹è®°å½•å­˜å‚¨åˆ°äº†AMSçš„è¿›ç¨‹è®°å½•è¡¨ä¸­ã€‚==\n\n```java\n// com.android.server.am.ProcessList#handleProcessStartedLocked(com.android.server.am.ProcessRecord, int, boolean, long, boolean)\n// frameworks/base/services/core/java/com/android/server/am/ProcessList.java\nActivityManagerService mService = null;\nboolean handleProcessStartedLocked(ProcessRecord app, int pid, boolean usingWrapper,\n            long expectedStartSeq, boolean procAttached) {\n    // å°†ProcessRecord å­˜å‚¨åˆ°AMSä¸­\n    mService.addPidLocked(app);\n}\n  \n// frameworks/base/services/core/java/com/android/server/am/ActivityManagerService.java\nvoid addPidLocked(ProcessRecord app) {\n    synchronized (mPidsSelfLocked) {\n        // å°†è¿›ç¨‹è®°å½•æ·»åŠ åˆ°ä¸€ä¸ªè®°å½•è¡¨ä¸­\n        mPidsSelfLocked.doAddInternal(app);\n    }\n    synchronized (sActiveProcessInfoSelfLocked) {\n        if (app.processInfo != null) {\n            sActiveProcessInfoSelfLocked.put(app.pid, app.processInfo);\n        } else {\n            sActiveProcessInfoSelfLocked.remove(app.pid);\n        }\n    }\n    mAtmInternal.onProcessMapped(app.pid, app.getWindowProcessController());\n}\n```\n```java\n// å®Œæ•´ä»£ç \n// com.android.server.am.ProcessList#handleProcessStartedLocked(com.android.server.am.ProcessRecord, int, boolean, long, boolean)\n// frameworks/base/services/core/java/com/android/server/am/ProcessList.java\nboolean handleProcessStartedLocked(ProcessRecord app, int pid, boolean usingWrapper,\n            long expectedStartSeq, boolean procAttached) {\n        mPendingStarts.remove(expectedStartSeq);\n        final String reason = isProcStartValidLocked(app, expectedStartSeq);\n        if (reason != null) {\n            Slog.w(TAG_PROCESSES, app + \" start not valid, killing pid=\" +\n                    pid\n                    + \", \" + reason);\n            app.pendingStart = false;\n            killProcessQuiet(pid);\n            Process.killProcessGroup(app.uid, app.pid);\n            noteAppKill(app, ApplicationExitInfo.REASON_OTHER,\n                    ApplicationExitInfo.SUBREASON_INVALID_START, reason);\n            return false;\n        }\n        mService.mBatteryStatsService.noteProcessStart(app.processName, app.info.uid);\n        checkSlow(app.startTime, \"startProcess: done updating battery stats\");\n\n        EventLog.writeEvent(EventLogTags.AM_PROC_START,\n                UserHandle.getUserId(app.startUid), pid, app.startUid,\n                app.processName, app.hostingRecord.getType(),\n                app.hostingRecord.getName() != null ? app.hostingRecord.getName() : \"\");\n\n        try {\n            AppGlobals.getPackageManager().logAppProcessStartIfNeeded(app.processName, app.uid,\n                    app.seInfo, app.info.sourceDir, pid);\n        } catch (RemoteException ex) {\n            // Ignore\n        }\n\n        Watchdog.getInstance().processStarted(app.processName, pid);\n\n        checkSlow(app.startTime, \"startProcess: building log message\");\n        StringBuilder buf = mStringBuilder;\n        buf.setLength(0);\n        buf.append(\"Start proc \");\n        buf.append(pid);\n        buf.append(':');\n        buf.append(app.processName);\n        buf.append('/');\n        UserHandle.formatUid(buf, app.startUid);\n        if (app.isolatedEntryPoint != null) {\n            buf.append(\" [\");\n            buf.append(app.isolatedEntryPoint);\n            buf.append(\"]\");\n        }\n        buf.append(\" for \");\n        buf.append(app.hostingRecord.getType());\n        if (app.hostingRecord.getName() != null) {\n            buf.append(\" \");\n            buf.append(app.hostingRecord.getName());\n        }\n        mService.reportUidInfoMessageLocked(TAG, buf.toString(), app.startUid);\n        app.setPid(pid);\n        app.setUsingWrapper(usingWrapper);\n        app.pendingStart = false;\n        checkSlow(app.startTime, \"startProcess: starting to update pids map\");\n        ProcessRecord oldApp;\n        synchronized (mService.mPidsSelfLocked) {\n            oldApp = mService.mPidsSelfLocked.get(pid);\n        }\n        // If there is already an app occupying that pid that hasn't been cleaned up\n        if (oldApp != null && !app.isolated) {\n            // Clean up anything relating to this pid first\n            Slog.wtf(TAG, \"handleProcessStartedLocked process:\" + app.processName\n                    + \" startSeq:\" + app.startSeq\n                    + \" pid:\" + pid\n                    + \" belongs to another existing app:\" + oldApp.processName\n                    + \" startSeq:\" + oldApp.startSeq);\n            mService.cleanUpApplicationRecordLocked(oldApp, false, false, -1,\n                    true /*replacingPid*/);\n        }\n    // æ³¨æ„è¿™é‡Œ \n        mService.addPidLocked(app);\n        synchronized (mService.mPidsSelfLocked) {\n            if (!procAttached) {\n                Message msg = mService.mHandler.obtainMessage(PROC_START_TIMEOUT_MSG);\n                msg.obj = app;\n                mService.mHandler.sendMessageDelayed(msg, usingWrapper\n                        ? PROC_START_TIMEOUT_WITH_WRAPPER : PROC_START_TIMEOUT);\n            }\n        }\n        checkSlow(app.startTime, \"startProcess: done updating pids map\");\n        return true;\n    }\n```\n\n#### å†™å…¥threadå€¼åˆ°ProcessRecord\n\nä»ä¸Šé¢çš„æµç¨‹ä¸­ï¼Œæˆ‘ä»¬å‘ç°æ„é€ å‡ºæ¥çš„ProcessRecordçš„threadï¼ˆApplicationThreadï¼‰æˆå‘˜å˜é‡è¿˜æ˜¯æ²¡æœ‰è¢«èµ‹å€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªthreadä½•æ—¶è¢«èµ‹å€¼å‘¢ï¼Ÿ\n\n> æŸ¥æ‰¾`ProcessRecord`ä¸­`thread`èµ‹å€¼çš„å…¥å£ï¼š\n>\n> 1. é€šè¿‡æŸ¥æ‰¾`thread`æˆå‘˜çš„èµ‹å€¼å†™å…¥æ–¹æ³•ï¼Œå¯ä»¥ç¡®å®šèµ·å§‹ç‚¹æ˜¯ï¼Œ`com.android.server.am.ProcessRecord#makeActive` ï¼Œæ¥ä¸‹æ¥æŸ¥çœ‹è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„åˆ—è¡¨ï¼š\n> 2. ![image-20210411172323572](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210411172323.png)\n>\n> 3. è¿™é‡Œæˆ‘ä»¬æ˜¾ç„¶é€‰æ‹© `com.android.server.am.ActivityManagerService#attachApplicationLocked`\n>\n> 4. `android.app.ActivityThread#attach`\n>\n> 5. è¿™é‡Œæˆ‘ä»¬é‡åˆ°ä¸¤ä¸ªé€‰æ‹©ï¼š\n>\n>    <img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210411172524.png\" alt=\"image-20210411172524831\" style=\"zoom:50%;\" />\n>\n> 6. æ˜¾ç„¶ï¼Œåº”è¯¥é€‰æ‹©ç¬¬äºŒä¸ªï¼š`android.app.ActivityThread#main`\n>\n> 7. è¿™é‡Œæˆ‘ä»¬å´æ— æ³•ç›´æ¥é€šè¿‡IDEAçš„è°ƒç”¨å±‚æ¬¡åŠŸèƒ½æ‰¾åˆ°ä»»ä½•è°ƒç”¨æ–¹æ³•ï¼Œè¯´æ˜å¯èƒ½æ˜¯é€šè¿‡åå°„æ¥è°ƒç”¨çš„ï¼Œæ‰€ä»¥ç›´æ¥é€šè¿‡å…¨å±€å­—ç¬¦ä¸²æœç´¢==android.app.ActivityThread==ï¼Œå¯ä»¥æ‰¾åˆ°åœ¨ `ProcessList.startProcessLocked` ä¸­è°ƒç”¨çš„ã€‚\n\né€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œè¿™é‡Œæˆ‘ä»¬ä»ActivityThreadçš„mainå‡½æ•°å¼€å§‹ã€‚\n\n#####  ActivityThread#main\n\n```java\n    public static void main(String[] args) {\n        Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, \"ActivityThreadMain\");\n\n        // Install selective syscall interception\n        AndroidOs.install();\n\n        // CloseGuard defaults to true and can be quite spammy.  We\n        // disable it here, but selectively enable it later (via\n        // StrictMode) on debug builds, but using DropBox, not logs.\n        CloseGuard.setEnabled(false);\n\n        Environment.initForCurrentUser();\n\n        // Make sure TrustedCertificateStore looks in the right place for CA certificates\n        final File configDir = Environment.getUserConfigDirectory(UserHandle.myUserId());\n        TrustedCertificateStore.setDefaultUserDirectory(configDir);\n\n        // Call per-process mainline module initialization.\n        initializeMainlineModules();\n\n        Process.setArgV0(\"<pre-initialized>\");\n\n        Looper.prepareMainLooper();\n\n        // Find the value for {@link #PROC_START_SEQ_IDENT} if provided on the command line.\n        // It will be in the format \"seq=114\"\n        long startSeq = 0;\n        if (args != null) {\n            for (int i = args.length - 1; i >= 0; --i) {\n                if (args[i] != null && args[i].startsWith(PROC_START_SEQ_IDENT)) {\n                    startSeq = Long.parseLong(\n                            args[i].substring(PROC_START_SEQ_IDENT.length()));\n                }\n            }\n        }\n        // ç›´æ¥æ„é€ ä¸€ä¸ªActivityThreadå¯¹è±¡\n        ActivityThread thread = new ActivityThread();\n        // æ‰§è¡Œattachæ–¹æ³•\n        thread.attach(false, startSeq);\n\n        if (sMainThreadHandler == null) {\n            sMainThreadHandler = thread.getHandler();\n        }\n\n        if (false) {\n            Looper.myLooper().setMessageLogging(new\n                    LogPrinter(Log.DEBUG, \"ActivityThread\"));\n        }\n\n        // End of event ActivityThreadMain.\n        Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);\n        Looper.loop();\n\n        throw new RuntimeException(\"Main thread loop unexpectedly exited\");\n    }\n```\n\n##### ActivityThread#attach\n\n```java\n private void attach(boolean system, long startSeq) {\n        sCurrentActivityThread = this;\n        mSystemThread = system;\n        if (!system) {\n            android.ddm.DdmHandleAppName.setAppName(\"<pre-initialized>\",\n                                                    UserHandle.myUserId());\n            // å°†å½“å‰ApplicationThreadçš„Binderå¯¹è±¡ä¿å­˜ä¸ºä¸€ä¸ªé™æ€æˆå‘˜\n            RuntimeInit.setApplicationObject(mAppThread.asBinder());\n            // è·å–AMS\n            final IActivityManager mgr = ActivityManager.getService();\n            try {\n                // é€šçŸ¥AMSæ¥ attachApplication\n                mgr.attachApplication(mAppThread, startSeq);\n            } catch (RemoteException ex) {\n                throw ex.rethrowFromSystemServer();\n            }\n        } else {\n            \n        }\n}\n```\n\n##### **ActivityManagerService#attachApplication** & attachApplicationLocked\n\n```java\n    @Override\n    public final void attachApplication(IApplicationThread thread, long startSeq) {\n        if (thread == null) {\n            throw new SecurityException(\"Invalid application interface\");\n        }\n        synchronized (this) {\n            int callingPid = Binder.getCallingPid();\n            final int callingUid = Binder.getCallingUid();\n            final long origId = Binder.clearCallingIdentity();\n            attachApplicationLocked(thread, callingPid, callingUid, startSeq);\n            Binder.restoreCallingIdentity(origId);\n        }\n    }\n\n```\nä¸Šé¢çš„æ–¹æ³•åªæ˜¯è°ƒç”¨äº† attachApplicationLockedï¼š\n\n==æœ‰ä¸ªå…³é”®çš„æ­¥éª¤æ˜¯ï¼Œä» AMSçš„è¿›ç¨‹è®°å½•è¡¨ä¸­æ ¹æ®PIDå–å‡ºä¸€ä¸ª ProcessRecord: `app = mPidsSelfLocked.get(pid)`==\n\n```java\nprivate boolean attachApplicationLocked(@NonNull IApplicationThread thread,\n            int pid, int callingUid, long startSeq) {\n        // Find the application record that is being attached...  either via\n        // the pid if we are running in multiple processes, or just pull the\n        // next app record if we are emulating process with anonymous threads.\n        ProcessRecord app;\n        long startTime = SystemClock.uptimeMillis();\n        long bindApplicationTimeMillis;\n        if (pid != MY_PID && pid >= 0) {\n            synchronized (mPidsSelfLocked) {\n                // ä»è¿›ç¨‹è®°å½•ä¸­è·å–\n                app = mPidsSelfLocked.get(pid);\n            }\n        }\n        // Make app active after binding application or client may be running requests (e.g\n        // starting activities) before it is ready.\n        // å…³è”threadåˆ°appï¼ˆProcessRecordï¼‰\n        app.makeActive(thread, mProcessStats);\n        return true;\n    }\n```\n\nç»è¿‡ä¸Šé¢çš„æ­¥éª¤ï¼Œå³å®Œæˆäº†ProcessRecordåˆ°è¿›ç¨‹çš„ApplicationThreadçš„å…³è”ã€‚\n\n### å¯åŠ¨æœåŠ¡\n\nä»AMSä¸­è°ƒç”¨ApplicationThreadçš„æ–¹æ³•æ¥åœ¨Serviceè‡ªå·±åº”è¯¥æ‰€å±çš„è¿›ç¨‹ä¸­åˆ›å»ºServiceå¯¹è±¡çš„å®ä¾‹ã€‚\n\n\n<svg width=\"723px\" height=\"508px\" viewBox=\"0 0 723 508\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n    <g id=\"Androidæºç åˆ†æ\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n        <g id=\"bindServiceæµç¨‹åˆ†æ-åŠ å…¥å¯åŠ¨æµç¨‹\" transform=\"translate(-1687.000000, -331.000000)\">\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-42\" transform=\"translate(2075.000000, 429.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"80.8715473\" y=\"14\">ActivityThread#main()</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"101.306895\" y=\"30.122449\">è¿›ç¨‹åˆ›å»ºåæ‰§è¡Œå…¥å£å‡½æ•°</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-57\" transform=\"translate(2075.000000, 370.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"96.4245514\" y=\"14\">ç‹¬ç«‹è¿›ç¨‹çš„Service</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"132.102208\" y=\"30.122449\">å¯åŠ¨è¿›ç¨‹</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-53\" transform=\"translate(2075.000000, 483.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"81.6756979\" y=\"14\">ActivityThread#attach</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"148.202627\" y=\"30.122449\">-</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-28\" transform=\"translate(1688.000000, 476.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"17.7639992\" y=\"14\">IApplicationThread#scheduleCreateService</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"75.1632961\" y=\"30.122449\">android/app/IApplicationThread.java</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-36\" transform=\"translate(1688.000000, 535.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFED99\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"124.320049\" y=\"14\">transact</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"136.553756\" y=\"30.122449\">binder</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-36\" transform=\"translate(1687.000000, 750.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFED99\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"124.320049\" y=\"14\">transact</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"136.553756\" y=\"30.122449\">binder</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-30\" transform=\"translate(1687.000000, 590.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"19.8413883\" y=\"14\">ApplicationThread#scheduleCreateService</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"84.8453045\" y=\"30.122449\">android/app/ActivityThread.java</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-31\" transform=\"translate(1687.000000, 641.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"37.6728192\" y=\"14\">ActivityThread#handleCreateService</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"84.8453045\" y=\"30.122449\">android/app/ActivityThread.java</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-33\" transform=\"translate(1688.000000, 695.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"26.5913799\" y=\"14\">IActivityManager#serviceDoneExecuting</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"84.8453045\" y=\"30.122449\">android/app/ActivityThread.java</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-34\" transform=\"translate(1687.000000, 805.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"6.18910375\" y=\"14\">ActivityManagerService#serviceDoneExecuting</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"84.8453045\" y=\"30.122449\">android/app/ActivityThread.java</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-9\" transform=\"translate(1688.000000, 373.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"32.543313\" y=\"14\">ActiveServices#bringUpServiceLocked</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"62.0131706\" y=\"30.122449\">com/android/server/am/ActiveServices.java</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-43\" transform=\"translate(1687.000000, 422.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"30.4598318\" y=\"14\">ActiveServices#realStartServiceLocked</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"62.0131706\" y=\"30.122449\">com/android/server/am/ActiveServices.java</tspan>\n                </text>\n            </g>\n            <path id=\"ç›´çº¿-7å¤‡ä»½-2\" d=\"M1837.93515,405.012222 L1837.935,413.997 L1841.67573,413.997076 L1837.5,421.997076 L1833.32427,413.997076 L1837.064,413.997 L1837.06485,405.012222 L1837.93515,405.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-8å¤‡ä»½-2\" d=\"M1836.93515,507.998187 L1836.935,526.011 L1840.67573,526.011111 L1836.5,534.011111 L1832.32427,526.011111 L1836.064,526.011 L1836.06485,507.998187 L1836.93515,507.998187 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-9å¤‡ä»½-2\" d=\"M1836.93515,567.990779 L1836.935,583.018 L1840.67573,583.018519 L1836.5,591.018519 L1832.32427,583.018519 L1836.064,583.018 L1836.06485,567.990779 L1836.93515,567.990779 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-10å¤‡ä»½-2\" d=\"M1836.93515,624.012222 L1836.935,632.997 L1840.67573,632.997076 L1836.5,640.997076 L1832.32427,632.997076 L1836.064,632.997 L1836.06485,624.012222 L1836.93515,624.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <text id=\"å¯åŠ¨æœåŠ¡\" font-family=\"NotoSansCJKsc-Black, Noto Sans CJK SC\" font-size=\"18.2\" font-weight=\"800\" letter-spacing=\"0.200199999\" fill=\"#020202\" fill-opacity=\"0.88378138\">\n                <tspan x=\"1802.1996\" y=\"347\">å¯åŠ¨æœåŠ¡</tspan>\n            </text>\n            <path id=\"ç›´çº¿-22\" d=\"M1836.15,674.997059 L1836.15,685.964 L1840.75,685.964052 L1835.5,696.964052 L1830.25,685.964052 L1834.85,685.964 L1834.85,674.997059 L1836.15,674.997059 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-22å¤‡ä»½\" d=\"M1836.15,728.997059 L1836.15,739.964 L1840.75,739.964052 L1835.5,750.964052 L1830.25,739.964052 L1834.85,739.964 L1834.85,728.997059 L1836.15,728.997059 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-22å¤‡ä»½-2\" d=\"M1836.15,783.997059 L1836.15,794.964 L1840.75,794.964052 L1835.5,805.964052 L1830.25,794.964052 L1834.85,794.964 L1834.85,783.997059 L1836.15,783.997059 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-54\" transform=\"translate(2075.000000, 542.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"39.6222753\" y=\"14\">IActivityManager#attachApplication</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"148.202627\" y=\"30.122449\">-</tspan>\n                </text>\n            </g>\n            <path id=\"ç›´çº¿-27å¤‡ä»½\" d=\"M2224.15,460.988889 L2224.15,472.972 L2228.75,472.972222 L2223.5,483.972222 L2218.25,472.972222 L2222.85,472.972 L2222.85,460.988889 L2224.15,460.988889 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-28å¤‡ä»½\" d=\"M2224.15,517 L2224.15,531.961 L2228.75,531.961111 L2223.5,542.961111 L2218.25,531.961111 L2222.85,531.961 L2222.85,517 L2224.15,517 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-55\" transform=\"translate(2075.000000, 655.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"19.2199992\" y=\"14\">ActivityManagerService#attachApplication</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"148.202627\" y=\"30.122449\">-</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-48\" transform=\"translate(2040.000000, 711.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"368.7277\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"32.5625946\" y=\"14\">ActivityManagerService#attachApplicationLocked</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"77.2564856\" y=\"30.122449\">è·å–ä¹‹å‰å­˜å‚¨çš„ mPendingServices - å¾…å¯åŠ¨çš„æœåŠ¡åˆ—è¡¨</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-36\" transform=\"translate(2075.000000, 595.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFED99\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"124.320049\" y=\"14\">transact</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"136.553756\" y=\"30.122449\">binder</tspan>\n                </text>\n            </g>\n            <path id=\"ç›´çº¿-29å¤‡ä»½\" d=\"M2224.15,573.997059 L2224.15,584.964 L2228.75,584.964052 L2223.5,595.964052 L2218.25,584.964052 L2222.85,584.964 L2222.85,573.997059 L2224.15,573.997059 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-30å¤‡ä»½\" d=\"M2224.15,628.992857 L2224.15,644.968 L2228.75,644.968254 L2223.5,655.968254 L2218.25,644.968254 L2222.85,644.968 L2222.85,628.992857 L2224.15,628.992857 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-33\" d=\"M1838.15,454.997059 L1838.15,465.964 L1842.75,465.964052 L1837.5,476.964052 L1832.25,465.964052 L1836.85,465.964 L1836.85,454.997059 L1838.15,454.997059 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-34\" d=\"M2224.15,688.997059 L2224.15,699.964 L2228.75,699.964052 L2223.5,710.964052 L2218.25,699.964052 L2222.85,699.964 L2222.85,688.997059 L2224.15,688.997059 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-35\" d=\"M1996.38889,444.25 L1985.38889,439 L1996.38889,433.75 L1996.388,438.35 L2024.46863,438.35 L2024.468,727.35 L2040.65,727.35 L2040.65,728.65 L2023.16863,728.65 L2023.168,439.65 L1996.388,439.65 L1996.38889,444.25 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-36\" d=\"M2224.15,403 L2224.15,417.961 L2228.75,417.961111 L2223.5,428.961111 L2218.25,417.961111 L2222.85,417.961 L2222.85,403 L2224.15,403 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n        </g>\n    </g>\n</svg>\n\n#### ActiveServices#bringUpServiceLocked\n\n```java\n// com.android.server.am.ActiveServices#bringUpServiceLocked\n// frameworks/base/services/core/java/com/android/server/am/ActiveServices.java\nprivate String bringUpServiceLocked(ServiceRecord r, int intentFlags, boolean execInFg,\n            boolean whileRestarting, boolean permissionsReviewRequired)\n            throws TransactionTooLargeException {\n        // å·²ç»å­˜åœ¨è¿›ç¨‹è®°å½•ï¼Œå¹¶ä¸”è¿›ç¨‹è®°å½•ä¸­çš„IApplicationThreadå·²ç»å­˜åœ¨ï¼Œåˆ™ä¸åˆ›å»ºæœåŠ¡ï¼Œä»…å‘é€å‚æ•°\n        if (r.app != null && r.app.thread != null) {\n            sendServiceArgsLocked(r, execInFg, false);\n            return null;\n        }\n        final boolean isolated = (r.serviceInfo.flags&ServiceInfo.FLAG_ISOLATED_PROCESS) != 0;\n        final String procName = r.processName;\n        HostingRecord hostingRecord = new HostingRecord(\"service\", r.instanceName);\n        ProcessRecord app;\n\t\t// éç‹¬ç«‹çš„è¿›ç¨‹ï¼Œåˆ™ç›´æ¥è·å–å½“å‰å¯åŠ¨è¿›ç¨‹çš„è¿›ç¨‹ä¿¡æ¯\n        if (!isolated) {\n            app = mAm.getProcessRecordLocked(procName, r.appInfo.uid, false);\n             if (app != null && app.thread != null) {\n                try {\n                    app.addPackage(r.appInfo.packageName, r.appInfo.longVersionCode, mAm.mProcessStats);\n                    // éç‹¬ç«‹è¿›ç¨‹ä¸­ï¼Œç›´æ¥å¯åŠ¨æœåŠ¡\n                    realStartServiceLocked(r, app, execInFg);\n                    // è°ƒç”¨å¯åŠ¨æ–¹æ³•åç›´æ¥è¿”å›\n                    return null;\n                } catch (TransactionTooLargeException e) {\n                    throw e;\n                } catch (RemoteException e) {\n                    Slog.w(TAG, \"Exception when starting service \" + r.shortInstanceName, e);\n                }\n\n                // If a dead object exception was thrown -- fall through to\n                // restart the application.\n            }\n        } else {\n            // ç‹¬ç«‹è¿›ç¨‹åˆ™å…ˆå°è¯•ä½¿ç”¨ä¹‹å‰ä¿å­˜çš„\n            app = r.isolatedProc;\n        }\n\n        // ä¹‹å‰æ²¡æœ‰å¯åŠ¨å¯¹åº”çš„è¿›ç¨‹ï¼Œåˆ™å¼€å§‹åˆ›å»ºï¼Œå¯åŠ¨äº†ï¼Œåˆ™æ— éœ€è¿›è¡Œèµ‹å€¼æ“ä½œï¼Œå› ä¸ºServiceRecordä¸­å·²ç»æœ‰äº†\n        if (app == null && !permissionsReviewRequired) {\n            if ((app=mAm.startProcessLocked(procName, r.appInfo, true, intentFlags,\n                    hostingRecord, ZYGOTE_POLICY_FLAG_EMPTY, false, isolated, false)) == null) {\n                String msg = \"Unable to launch app \"\n                        + r.appInfo.packageName + \"/\"\n                        + r.appInfo.uid + \" for service \"\n                        + r.intent.getIntent() + \": process is bad\";\n                Slog.w(TAG, msg);\n                bringDownServiceLocked(r);\n                // è¿›ç¨‹å¯åŠ¨å¤±è´¥ï¼Œè¿”å›é”™è¯¯æ¶ˆæ¯\n                return msg;\n            }\n            if (isolated) {\n                // ç‹¬ç«‹è¿›ç¨‹ï¼Œç¼“å­˜è¿›ç¨‹ä¿¡æ¯åˆ°ä¼ å…¥çš„ServiceRecordå‚æ•°ä¸­ï¼Œä»¥ä¾¿åç»­ç›´æ¥ä½¿ç”¨\n                r.isolatedProc = app;\n            }\n        }\n        // å°†æœåŠ¡è®°å½•åŠ å…¥çš„mPendingServicesä¸­ï¼Œç”±äºéç‹¬ç«‹è¿›ç¨‹åˆ›å»ºåå·²ç»ç›´æ¥è¿”å›ï¼Œæ‰€ä»¥è¿™é‡Œé€‚ç”¨äºç‹¬ç«‹è¿›ç¨‹çš„\n        if (!mPendingServices.contains(r)) {\n            mPendingServices.add(r);\n        }\n\t    // åˆ›å»ºæˆåŠŸæˆ–è€…ä¹‹å‰å·²ç»åˆäº†ç¼“å­˜ï¼Œåˆ™è¿”å›null\n        return null;\n    }\n```\n\n#### ç‹¬ç«‹è¿›ç¨‹ä½•æ—¶å¯åŠ¨æœåŠ¡ï¼Ÿ\n\n* ä¸€èˆ¬æ¥è¯´ï¼Œå°è£…è¾ƒå¥½çš„ä»£ç ä¼šä¿è¯å…¥å£ç»Ÿä¸€ï¼Œå¦‚æœéç‹¬ç«‹è¿›ç¨‹æƒ…å†µä¸‹æœåŠ¡çš„å¯åŠ¨ä½¿ç”¨çš„æ˜¯ `realStartServiceLocked` æ–¹æ³•æ¥å¯åŠ¨æœåŠ¡ï¼Œé‚£ä¹ˆç‹¬ç«‹è¿›ç¨‹æƒ…å†µä¸‹ï¼ŒæœåŠ¡çš„å¯åŠ¨ä¹Ÿåº”è¯¥ä½¿ç”¨æ­¤æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬æŸ¥çœ‹ `realStartServiceLocked` æ–¹æ³•çš„è°ƒç”¨å±‚æ¬¡ï¼Œå¦‚ä¸‹ï¼š\n\n  **å›¾ç‰‡ç‰ˆæœ¬:**\n\n  ![image-20210411112439961](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210411112440.png)\n\n  **è¯¦ç»†è°ƒç”¨åºåˆ—:**\n\n  * `ActiveServices.attachApplicationLocked`(ProcessRecord, String)  (com.android.server.am)\n    * ActivityManagerService.attachApplicationLocked(IApplicationThread, int, int, long)  (com.android.server.am)\n      * ActivityManagerService.attachApplication(IApplicationThread, long)  (com.android.server.am)\n  * `ActiveServices.bringUpServiceLocked`(ServiceRecord, int, boolean, boolean, boolean)  (com.android.server.am)\n    * ActiveServices.startServiceInnerLocked(ServiceMap, Intent, ServiceRecord, boolean, boolean)  (com.android.server.am)\n    * ActiveServices.bindServiceLocked(IApplicationThread, IBinder, Intent, String, IServiceConnection, int, String, ...)  (com.android.server.am)\n    * ActiveServices.performServiceRestartLocked(ServiceRecord)  (com.android.server.am)\n\n  ä¹Ÿå°±æ˜¯è°ƒç”¨äº† `ActiveServices.attachApplicationLocked` ,æœ€ç»ˆæ˜¯é€šè¿‡AMSçš„`ActivityManagerService.attachApplication`æ¥è§¦å‘çš„;ä¹Ÿå°±æ˜¯åªè¦æ‰¾åˆ°`mAm.startProcessLocked`åˆ°`ActivityManagerService.attachApplication`çš„è°ƒç”¨åºåˆ—å³å¯è¯æ˜æ­¤çŒœæƒ³;\n\n  æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å¦‚ä¸‹è°ƒç”¨åºåˆ—ï¼Œå³æœ€ç»ˆå®é™…ä¸Šæ˜¯ä»ActivityThreadçš„mainå‡½æ•°è¿›å…¥çš„ï¼Œæ‰€ä»¥åšå‡ºä»¥ä¸‹çŒœæƒ³ï¼š**è¿›ç¨‹å¯åŠ¨åï¼Œåˆ›å»ºActivityThreadæ—¶ï¼Œå¦‚æœæœ‰éœ€è¦åˆ›å»ºçš„æœåŠ¡ï¼Œå°±å¯åŠ¨æœåŠ¡ï¼›**\n\n  <img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210411114715.png\" alt=\"image-20210411114715216\" style=\"zoom:50%;\" />\n\n  æˆ‘ä»¬å†çœ‹`attachApplicationLocked` çš„é€»è¾‘ï¼Œå¯ä»¥å‘ç°ï¼Œä¼šæ£€æŸ¥`mPendingServices`ä¸­æ˜¯å¦æœ‰å¾…å¯åŠ¨çš„æœåŠ¡ï¼Œç„¶åé€ä¸€å¤„ç†ï¼Œå¦‚æœæœ‰éœ€è¦å¯åŠ¨çš„æœåŠ¡ï¼Œåˆ™ä¼šè°ƒç”¨`realStartServiceLocked(sr, proc, sr.createdFromFg)`æ¥å¯åŠ¨æœåŠ¡ã€‚\n\n  ```java\n  // com.android.server.am.ActiveServices#attachApplicationLocked\n  // frameworks/base/services/core/java/com/android/server/am/ActiveServices.java\n  boolean attachApplicationLocked(ProcessRecord proc, String processName)\n              throws RemoteException {\n          boolean didSomething = false;\n          // Collect any services that are waiting for this process to come up.\n          if (mPendingServices.size() > 0) {\n              ServiceRecord sr = null;\n              try {\n                  for (int i=0; i<mPendingServices.size(); i++) {\n                      sr = mPendingServices.get(i);\n                      // æ’é™¤éç‹¬ç«‹Service\n                      if (proc != sr.isolatedProc && (proc.uid != sr.appInfo.uid\n                              || !processName.equals(sr.processName))) {\n                          continue;\n                      }\n  \n                      mPendingServices.remove(i);\n                      i--;\n                      proc.addPackage(sr.appInfo.packageName, sr.appInfo.longVersionCode,\n                              mAm.mProcessStats);\n                      // å¯åŠ¨æœåŠ¡\n                      realStartServiceLocked(sr, proc, sr.createdFromFg);\n                  }\n              } catch (RemoteException e) {\n                  Slog.w(TAG, \"Exception in new application when starting service \"\n                          + sr.shortInstanceName, e);\n                  throw e;\n              }\n          }\n  }\n  ```\n\n#### ActivityThread#handleCreateService\n\nè¿™é‡Œæˆ‘ä»¬çœç•¥`bringUpServiceLocked`æ–¹æ³•åŠä¸‹æ–¹çš„å‡ ä¸ªä¸­é—´æ­¥éª¤ï¼Œç›´æ¥æŸ¥çœ‹`android.app.ActivityThread#handleCreateService`æ–¹æ³•ï¼š\n\n1. é€šè¿‡ClassLoaderåŠ è½½å¹¶å®ä¾‹åŒ–äº†å¯¹åº”çš„Serviceå¯¹è±¡ï¼›\n2. å°†Serviceå­˜å‚¨åˆ°ActivityThreadä¸­çš„ä¸€ä¸ªArrayMapä¸­ï¼›\n\n```java\n// android/app/ActivityThread.java\n// android.app.ActivityThread#handleCreateService\n\nfinal ArrayMap<IBinder, Service> mServices = new ArrayMap<>();\nprivate void handleCreateService(CreateServiceData data) {\n        // If we are getting ready to gc after going to the background, well\n        // we are back active so skip it.\n        unscheduleGcIdler();\n\n        LoadedApk packageInfo = getPackageInfoNoCheck(\n                data.info.applicationInfo, data.compatInfo);\n        Service service = null;\n        try {\n            if (localLOGV) Slog.v(TAG, \"Creating service \" + data.info.name);\n\n            ContextImpl context = ContextImpl.createAppContext(this, packageInfo);\n            Application app = packageInfo.makeApplication(false, mInstrumentation);\n            java.lang.ClassLoader cl = packageInfo.getClassLoader();\n            // åˆ›å»ºå¯¹åº”çš„Serviceå®ä¾‹\n            service = packageInfo.getAppFactory()\n                    .instantiateService(cl, data.info.name, data.intent);\n            // Service resources must be initialized with the same loaders as the application\n            // context.\n            context.getResources().addLoaders(\n                    app.getResources().getLoaders().toArray(new ResourcesLoader[0]));\n\n            context.setOuterContext(service);\n            service.attach(context, this, data.info.name, data.token, app,\n                    ActivityManager.getService());\n            service.onCreate();\n            mServices.put(data.token, service);\n            try {\n                ActivityManager.getService().serviceDoneExecuting(\n                        data.token, SERVICE_DONE_EXECUTING_ANON, 0, 0);\n            } catch (RemoteException e) {\n                throw e.rethrowFromSystemServer();\n            }\n        } catch (Exception e) {\n            if (!mInstrumentation.onException(service, e)) {\n                throw new RuntimeException(\n                    \"Unable to create service \" + data.info.name\n                    + \": \" + e.toString(), e);\n            }\n        }\n    }\n```\n\n### ç»‘å®šæœåŠ¡\n\n\n<svg width=\"698px\" height=\"447px\" viewBox=\"0 0 698 447\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n    <g id=\"Androidæºç åˆ†æ\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n        <g id=\"bindServiceæµç¨‹åˆ†æ-åŠ å…¥å¯åŠ¨æµç¨‹\" transform=\"translate(-125.000000, -273.000000)\">\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-4\" transform=\"translate(523.000000, 273.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"14.2367021\" y=\"14\">ActivityManagerService.bindIsolatedService</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"44.0851371\" y=\"30.122449\">com/android/server/am/ActivityManagerService.java</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-5\" transform=\"translate(523.000000, 322.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"45.2025933\" y=\"14\">ActiveServices.bindServiceLocked</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"62.0131706\" y=\"30.122449\">com/android/server/am/ActiveServices.java</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-16\" transform=\"translate(523.000000, 422.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"25.0439991\" y=\"14\">IApplicationThread.scheduleBindService</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"75.1632961\" y=\"30.122449\">android/app/IApplicationThread.java</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-17\" transform=\"translate(523.000000, 482.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFED99\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"102.802928\" y=\"14\">Binder.transact</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"136.553756\" y=\"30.122449\">binder</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-18\" transform=\"translate(440.000000, 537.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFED99\" x=\"0.5\" y=\"0.5\" width=\"63.3004695\" height=\"182\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"10.224946\" y=\"14\">Binder.</tspan>\n                    <tspan x=\"6.77075357\" y=\"32\">transact</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"19.0044607\" y=\"118.306122\">binder</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-10\" transform=\"translate(522.000000, 537.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"27.1213883\" y=\"14\">ApplicationThread.scheduleBindService</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"28.0238818\" y=\"30.122449\">frameworks/base/core/java/android/app/ActivityThread.java</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-12\" transform=\"translate(522.000000, 587.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"43.344518\" y=\"14\">ActivityThread#handleBindService</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"28.0238818\" y=\"30.122449\">frameworks/base/core/java/android/app/ActivityThread.java</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-19\" transform=\"translate(522.000000, 637.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"63.1680494\" y=\"14\">IBinder = Service.onBinder()</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"104.313756\" y=\"30.122449\">è‡ªå®šä¹‰çš„Serviceå®ç°ç±»</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-20\" transform=\"translate(522.000000, 686.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"48.7055222\" y=\"14\">IActivityManager#publishService</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"80.4068108\" y=\"30.122449\">android/app/IActivityManager.java</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-21\" transform=\"translate(125.000000, 537.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"28.303246\" y=\"14\">ActivityManagerService#publishService</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"80.4068108\" y=\"30.122449\">android/app/IActivityManager.java</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-23\" transform=\"translate(125.000000, 587.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"34.5841498\" y=\"14\">ActiveServices#publishServiceLocked</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"62.0131706\" y=\"30.122449\">com/android/server/am/ActiveServices.java</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-51\" transform=\"translate(125.000000, 638.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"54.5477983\" y=\"14\">IServiceConnection#connected</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"148.202627\" y=\"30.122449\">-</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-8\" transform=\"translate(523.000000, 373.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"12.0131038\" y=\"14\">ActiveServices.requestServiceBindingLocked</tspan>\n                </text>\n                <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"62.0131706\" y=\"30.122449\">com/android/server/am/ActiveServices.java</tspan>\n                </text>\n            </g>\n            <path id=\"ç›´çº¿-5\" d=\"M671.935146,307.012222 L671.935,315.997 L675.675732,315.997076 L671.5,323.997076 L667.324268,315.997076 L671.064,315.997 L671.064854,307.012222 L671.935146,307.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-6\" d=\"M671.935146,356.012222 L671.935,364.997 L675.675732,364.997076 L671.5,372.997076 L667.324268,364.997076 L671.064,364.997 L671.064854,356.012222 L671.935146,356.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-7\" d=\"M671.935146,405.012222 L671.935,413.997 L675.675732,413.997076 L671.5,421.997076 L667.324268,413.997076 L671.064,413.997 L671.064854,405.012222 L671.935146,405.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-8\" d=\"M671.935146,454.998187 L671.935,473.011 L675.675732,473.011111 L671.5,481.011111 L667.324268,473.011111 L671.064,473.011 L671.064854,454.998187 L671.935146,454.998187 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-9\" d=\"M671.935146,514.990779 L671.935,530.018 L675.675732,530.018519 L671.5,538.018519 L667.324268,530.018519 L671.064,530.018 L671.064854,514.990779 L671.935146,514.990779 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-10\" d=\"M671.935146,571.012222 L671.935,579.997 L675.675732,579.997076 L671.5,587.997076 L667.324268,579.997076 L671.064,579.997 L671.064854,571.012222 L671.935146,571.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-18\" d=\"M671.935146,621.012222 L671.935,629.997 L675.675732,629.997076 L671.5,637.997076 L667.324268,629.997076 L671.064,629.997 L671.064854,621.012222 L671.935146,621.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-11\" d=\"M671.935146,671.012222 L671.935,679.997 L675.675732,679.997076 L671.5,687.997076 L667.324268,679.997076 L671.064,679.997 L671.064854,671.012222 L671.935146,671.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-19\" d=\"M511.984127,699.324268 L511.984,703.064 L522.006575,703.064854 L522.006575,703.935146 L511.984,703.935 L511.984127,707.675732 L503.984127,703.5 L511.984127,699.324268 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-20\" d=\"M431.980556,550.324268 L431.98,554.064 L441.010146,554.064854 L441.010146,554.935146 L431.98,554.935 L431.980556,558.675732 L423.980556,554.5 L431.980556,550.324268 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-12\" d=\"M272.935146,571.012222 L272.935,579.997 L276.675732,579.997076 L272.5,587.997076 L268.324268,579.997076 L272.064,579.997 L272.064854,571.012222 L272.935146,571.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n            <path id=\"ç›´çº¿-12å¤‡ä»½\" d=\"M272.935146,621.012222 L272.935,629.997 L276.675732,629.997076 L272.5,637.997076 L268.324268,629.997076 L272.064,629.997 L272.064854,621.012222 L272.935146,621.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n        </g>\n    </g>\n</svg>\n\næˆ‘ä»¬çš„é—®é¢˜æ˜¯ï¼š\n\n1. ç»‘å®šæœåŠ¡æ—¶ï¼Œä¼ å…¥çš„ServiceConnectionå¯¹è±¡ï¼Œå¦‚ä½•è¢«è°ƒç”¨æ¥é€šçŸ¥ï¼Ÿ\n2. è¿˜åšäº†äº›ä»€ä¹ˆï¼Ÿ\n\n#### è¿æ¥å¯¹è±¡å»å“ªé‡Œäº†ï¼Ÿ\n\næŸ¥çœ‹`ContextImpl.bindServiceCommon`æ–¹æ³•å¯ä»¥çœ‹åˆ°ï¼Œä¼ å…¥äº†å‚æ•° `ServiceConnection conn`ï¼Œç„¶åæ–¹æ³•ä¸­è¿™ä¸ªconnæ”¾å…¥åˆ°äº†ä¸€ä¸ª `ServiceDispatcher` ä¸­.\n\n* IServiceConnection åŒ…å«ä¸¤ä¸ªæ¥å£ï¼š\n  * connected(): è¿æ¥åˆ°æœåŠ¡\n  * asBinder()ï¼š æœåŠ¡è½¬Binder\n* è¿™é‡Œä¼šå°†æˆ‘ä»¬è‡ªè¡Œç¼–å†™çš„ServiceConnectionå¯¹è±¡æ„é€ å‡ºä¸€ä¸ªServiceDispatcherå¯¹è±¡ï¼Œç„¶åå°†ServiceDispatcheræä¾›ä¸€ä¸ªIServiceconnectionæ¥å£ï¼ˆ`ServiceDispatcher$InnerConnection`ç±»ï¼‰ï¼Œç”¨äºæä¾›æœåŠ¡ï¼›\n* è¿™ä¸ª`ServiceDispatcher$InnerConnection`ç±»çš„connectæ–¹æ³•ä¼šè°ƒç”¨sdçš„connectæ–¹æ³•ï¼Œæœ€ç»ˆä¼šè°ƒç”¨æˆ‘ä»¬æä¾›çš„ServiceConnectionçš„å›è°ƒæ–¹æ³•ï¼š`mConnection.onServiceConnected(name, service)`\n\nä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨`sd.connect()`å°±å¯ä»¥è§¦å‘æˆ‘ä»¬çš„è¿æ¥å¯¹è±¡çš„`onServiceConnected`å›è°ƒæ–¹æ³•ï¼›\n\n```java\nfinal @NonNull LoadedApk mPackageInfo;\n\nprivate boolean bindServiceCommon(Intent service, ServiceConnection conn, int flags,\n            String instanceName, Handler handler, Executor executor, UserHandle user) {\n        // Keep this in sync with DevicePolicyManager.bindDeviceAdminServiceAsUser.\n\t    // è¿™ä¸ªIServiceConnection å®é™…ä¸Šå°±æ˜¯æŒæœ‰ServiceDispatcherçš„å¼±å¼•ç”¨å¯¹è±¡ï¼Œç„¶åå°†ServiceDispatcherçš„å°‘é‡æ–¹æ³•æš´éœ²å‡ºå»\n        IServiceConnection sd;\n        if (mPackageInfo != null) {\n            if (executor != null) {\n                // mPackageInfo æ˜¯ä¸€ä¸ª LoadedApk å¯¹è±¡\n                sd = mPackageInfo.getServiceDispatcher(conn, getOuterContext(), executor, flags);\n            } else {\n                sd = mPackageInfo.getServiceDispatcher(conn, getOuterContext(), handler, flags);\n            }\n        } else {\n            \n        }\n    \tint res = ActivityManager.getService().bindIsolatedService(\n                mMainThread.getApplicationThread(), getActivityToken(), service,\n                service.resolveTypeIfNeeded(getContentResolver()),\n\t            // è°ƒç”¨AMSçš„æœåŠ¡å¼è¿™é‡Œä¼ å…¥äº†sd\n                sd, flags, instanceName, getOpPackageName(), user.getIdentifier());\n        //... \n    }\n\n// com.android.server.am.ActiveServices#bindServiceLocked\nAppBindRecord b = s.retrieveAppBindingLocked(service, callerApp);\n            ConnectionRecord c = new ConnectionRecord(b, activity,\n                    connection, flags, clientLabel, clientIntent,\n                    callerApp.uid, callerApp.processName, callingPackage);\n            // æä¾› IBinder \n            IBinder binder = connection.asBinder();\n            s.addConnection(binder, c);\n            b.connections.add(c);\n```\n\nServiceDispatcherç±»ä½äº `android.app.LoadedApk.ServiceDispatcher`ï¼š\n\n```java\n// frameworks/base/core/java/android/app/LoadedApk.java\n\tpublic final IServiceConnection getServiceDispatcher(ServiceConnection c,\n            Context context, Executor executor, int flags) {\n        return getServiceDispatcherCommon(c, context, null, executor, flags);\n    }\n\n    private IServiceConnection getServiceDispatcherCommon(ServiceConnection c,\n            Context context, Handler handler, Executor executor, int flags) {\n        synchronized (mServices) {\n            LoadedApk.ServiceDispatcher sd = null;\n            ArrayMap<ServiceConnection, LoadedApk.ServiceDispatcher> map = mServices.get(context);\n            if (map != null) {\n                if (DEBUG) Slog.d(TAG, \"Returning existing dispatcher \" + sd + \" for conn \" + c);\n                sd = map.get(c);\n            }\n            if (sd == null) {\n                if (executor != null) {\n                    sd = new ServiceDispatcher(c, context, executor, flags);\n                } else {\n                    sd = new ServiceDispatcher(c, context, handler, flags);\n                }\n                if (DEBUG) Slog.d(TAG, \"Creating new dispatcher \" + sd + \" for conn \" + c);\n                if (map == null) {\n                    map = new ArrayMap<>();\n                    mServices.put(context, map);\n                }\n                map.put(c, sd);\n            } else {\n                sd.validate(context, handler, executor);\n            }\n            return sd.getIServiceConnection();\n        }\n    }\n\n\nstatic final class ServiceDispatcher {\n    private final ServiceDispatcher.InnerConnection mIServiceConnection;\n    @UnsupportedAppUsage\n    private final ServiceConnection mConnection;\n    @UnsupportedAppUsage(maxTargetSdk = Build.VERSION_CODES.P, trackingBug = 115609023)\n    private final Context mContext;\n    private final Handler mActivityThread;\n    private final Executor mActivityExecutor;\n    private final ServiceConnectionLeaked mLocation;\n    private final int mFlags;\n\n    private static class InnerConnection extends IServiceConnection.Stub {\n        @UnsupportedAppUsage\n        final WeakReference<LoadedApk.ServiceDispatcher> mDispatcher;\n\n        InnerConnection(LoadedApk.ServiceDispatcher sd) {\n            mDispatcher = new WeakReference<LoadedApk.ServiceDispatcher>(sd);\n        }\n\n        public void connected(ComponentName name, IBinder service, boolean dead)\n                throws RemoteException {\n            LoadedApk.ServiceDispatcher sd = mDispatcher.get();\n            if (sd != null) {\n                sd.connected(name, service, dead);\n            }\n        }\n    }\n\n    @UnsupportedAppUsage\n    ServiceDispatcher(ServiceConnection conn,\n                      Context context, Handler activityThread, int flags) {\n        mIServiceConnection = new InnerConnection(this);\n        mConnection = conn;\n        mContext = context;\n        mActivityThread = activityThread;\n        mActivityExecutor = null;\n        mLocation = new ServiceConnectionLeaked(null);\n        mLocation.fillInStackTrace();\n        mFlags = flags;\n    }\n\n    ServiceConnection getServiceConnection() {\n        return mConnection;\n    }\n\n    // SDä¸­æä¾›äº†connectedæ–¹æ³•\n    public void connected(ComponentName name, IBinder service, boolean dead) {\n        if (mActivityExecutor != null) {\n            mActivityExecutor.execute(new RunConnection(name, service, 0, dead));\n        } else if (mActivityThread != null) {\n            mActivityThread.post(new RunConnection(name, service, 0, dead));\n        } else {\n            doConnected(name, service, dead);\n        }\n    }\n\n    public void doConnected(ComponentName name, IBinder service, boolean dead) {\n        ServiceDispatcher.ConnectionInfo old;\n        ServiceDispatcher.ConnectionInfo info;\n\n        synchronized (this) {\n            if (mForgotten) {\n                // We unbound before receiving the connection; ignore\n                // any connection received.\n                return;\n            }\n            old = mActiveConnections.get(name);\n            if (old != null && old.binder == service) {\n                // Huh, already have this one.  Oh well!\n                return;\n            }\n\n            if (service != null) {\n                // A new service is being connected... set it all up.\n                info = new ConnectionInfo();\n                info.binder = service;\n                info.deathMonitor = new DeathMonitor(name, service);\n                try {\n                    service.linkToDeath(info.deathMonitor, 0);\n                    mActiveConnections.put(name, info);\n                } catch (RemoteException e) {\n                    // This service was dead before we got it...  just\n                    // don't do anything with it.\n                    mActiveConnections.remove(name);\n                    return;\n                }\n\n            } else {\n                // The named service is being disconnected... clean up.\n                mActiveConnections.remove(name);\n            }\n\n            if (old != null) {\n                old.binder.unlinkToDeath(old.deathMonitor, 0);\n            }\n        }\n\n        // If there was an old service, it is now disconnected.\n        if (old != null) {\n            mConnection.onServiceDisconnected(name);\n        }\n        if (dead) {\n            mConnection.onBindingDied(name);\n        }\n        // If there is a new viable service, it is now connected.\n        if (service != null) {\n            mConnection.onServiceConnected(name, service);\n        } else {\n            // The binding machinery worked, but the remote returned null from onBind().\n            mConnection.onNullBinding(name);\n        }\n    }\n\n}\n```\n\n#### IServiceConnectionè¯´æ˜\n\n>  æœåŠ¡ç»‘å®šæ—¶ï¼ŒIServiceConnectionçš„ç”¨é€”ï¼Ÿå¦‚ä½•å®ç°åœ¨APPçš„Activityè¿›ç¨‹ä¸­è°ƒç”¨ServiceConnectionçš„onServiceConnectedæ–¹æ³•ï¼Ÿ\n\n* IServiceConnectçš„æœåŠ¡ç«¯ä½äºAPPè¿›ç¨‹ä¸­ï¼Œåœ¨ContextImplçš„binderServiceCommonæ–¹æ³•ä¸­åˆå§‹åŒ–ï¼Œä¹Ÿå°±æ˜¯LoadApkç±»ä¸­çš„ServiceDispatcherç±»ã€‚\n* ä¼ é€’ç»™AMSçš„å®é™…ä¸Šæ˜¯ä¸€ä¸ªBinderçš„è¿œç¨‹ä»£ç†å¯¹è±¡ï¼›\n\n```java\n// android.app.IActivityManager.Stub#TRANSACTION_bindService\n// android/app/IActivityManager.java\ncase TRANSACTION_bindService:\n{\n          data.enforceInterface(descriptor);\n          android.app.IApplicationThread _arg0;\n          _arg0 = android.app.IApplicationThread.Stub.asInterface(data.readStrongBinder());\n          android.os.IBinder _arg1;\n          _arg1 = data.readStrongBinder();\n          android.content.Intent _arg2;\n          if ((0!=data.readInt())) {\n            _arg2 = android.content.Intent.CREATOR.createFromParcel(data);\n          }\n          else {\n            _arg2 = null;\n          }\n          java.lang.String _arg3;\n          _arg3 = data.readString();\n          android.app.IServiceConnection _arg4;\n    // è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œæ˜¯åœ¨è¿™ä¸ªåœ°æ–¹è§IServiceConnectionçš„æœåŠ¡ç«¯å¯¹è±¡è½¬æ¢æˆå®¢æˆ·ç«¯ä»£ç†å¯¹è±¡çš„\n          _arg4 = android.app.IServiceConnection.Stub.asInterface(data.readStrongBinder());\n          int _arg5;\n          _arg5 = data.readInt();\n          java.lang.String _arg6;\n          _arg6 = data.readString();\n          int _arg7;\n          _arg7 = data.readInt();\n          int _result = this.bindService(_arg0, _arg1, _arg2, _arg3, _arg4, _arg5, _arg6, _arg7);\n          reply.writeNoException();\n          reply.writeInt(_result);\n          return true;\n}\n    \n```\n\nasInterface ä¸­ï¼š `new android.app.IServiceConnection.Stub.Proxy(obj)` å³æ˜¯å°†Stubè½¬æ¢ä¸ºProxyå¯¹è±¡ï¼›\n\n```java\n  /** Local-side IPC implementation stub class. */\n  public static abstract class Stub extends android.os.Binder implements android.app.IServiceConnection\n  {\n    private static final java.lang.String DESCRIPTOR = \"android.app.IServiceConnection\";\n    /** Construct the stub at attach it to the interface. */\n    public Stub()\n    {\n      this.attachInterface(this, DESCRIPTOR);\n    }\n    /**\n     * Cast an IBinder object into an android.app.IServiceConnection interface,\n     * generating a proxy if needed.\n     */\n    public static android.app.IServiceConnection asInterface(android.os.IBinder obj)\n    {\n      if ((obj==null)) {\n        return null;\n      }\n      android.os.IInterface iin = obj.queryLocalInterface(DESCRIPTOR);\n      if (((iin!=null)&&(iin instanceof android.app.IServiceConnection))) {\n        return ((android.app.IServiceConnection)iin);\n      }\n      return new android.app.IServiceConnection.Stub.Proxy(obj);\n    }\n  }\n```\n\nä¹Ÿå°±æ˜¯è¯´ï¼ŒActivityManagerService.bindServiceæ–¹æ³•ä¸­çš„IServiceConnectionå‚æ•°å®é™…ä¸Šæ˜¯ä¸€ä¸ªProxyå¯¹è±¡ï¼›\n\n```java\n// è¿™é‡Œçš„Connectionæ˜¯ä¸€ä¸ªä»£ç†å¯¹è±¡\npublic int bindService(IApplicationThread caller, IBinder token, Intent service,\n            String resolvedType, IServiceConnection connection, int flags,\n            String callingPackage, int userId) throws TransactionTooLargeException {\n        return bindIsolatedService(caller, token, service, resolvedType, connection, flags,\n                null, callingPackage, userId);\n}\n```\n\n#### ActivityThread#handleBindService\n\nå®é™…ä¸Šå°±åšäº†ä¸¤ä»¶äº‹æƒ…\n\n```java\n// android.app.ActivityThread#handleBindService\n// frameworks/base/core/java/android/app/ActivityThread.java\nprivate void handleBindService(BindServiceData data) {\n        // è·å–ä¹‹å‰åˆ›å»ºçš„æœåŠ¡\n        Service s = mServices.get(data.token);\n        if (s != null) { // æ‰¾ä¸åˆ°ä¹‹å‰åˆ›å»ºçš„æœåŠ¡ï¼Œåˆ™ä»€ä¹ˆéƒ½ä¸åš\n            try {\n                data.intent.setExtrasClassLoader(s.getClassLoader());\n                data.intent.prepareToEnterProcess();\n                try {\n                    if (!data.rebind) {\n                        // è°ƒç”¨Serviceçš„onBindæ¥å£è·å–IBinderå¯¹è±¡\n                        IBinder binder = s.onBind(data.intent);\n                        // é€šçŸ¥AMSæ¥publicService\n                        ActivityManager.getService().publishService(\n                                data.token, data.intent, binder);\n                    } else {\n                        s.onRebind(data.intent);\n                        ActivityManager.getService().serviceDoneExecuting(\n                                data.token, SERVICE_DONE_EXECUTING_ANON, 0, 0);\n                    }\n                } catch (RemoteException ex) {\n                    throw ex.rethrowFromSystemServer();\n                }\n            } catch (Exception e) {\n            }\n        }\n    }\n```\n\n#### ActivityManagerService#publishService\n\n```java\n// com.android.server.am.ActivityManagerService#publishService\n// frameworks/base/services/core/java/com/android/server/am/ActivityManagerService.java\npublic void publishService(IBinder token, Intent intent, IBinder service) {\n        // Refuse possible leaked file descriptors\n        if (intent != null && intent.hasFileDescriptors() == true) {\n            throw new IllegalArgumentException(\"File descriptors passed in Intent\");\n        }\n\n        synchronized(this) {\n            if (!(token instanceof ServiceRecord)) {\n                throw new IllegalArgumentException(\"Invalid service token\");\n            }\n            // com.android.server.am.ActiveServices#publishServiceLocked\n            mServices.publishServiceLocked((ServiceRecord)token, intent, service);\n        }\n    }\n```\n\n#### ActiveServices#publishServiceLocked\n\nä¸‹é¢æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨publishServiceLockedæ–¹æ³•ä¸­ï¼Œå–å‡ºäº†ä¸€ä¸ªè¿æ¥è®°å½•åˆ—è¡¨ï¼Œç„¶åå¾ªç¯çš„è°ƒç”¨äº†å…¶ä¸­çš„IServiceConnectionçš„connectedæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ä¼šè°ƒç”¨åˆ°æˆ‘ä»¬è‡ªè¡Œå®šä¹‰çš„ServiceConnnectionå¯¹è±¡çš„connectedæ–¹æ³•ã€‚\n\nä¸è¿‡æˆ‘ä»¬æœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯è¿™ä¸ªConnectionRecordå¯¹è±¡æ˜¯ä½•æ—¶æ„é€ çš„ï¼Ÿ\n\n```java\n// com.android.server.am.ConnectionRecord\n// frameworks/base/services/core/java/com/android/server/am/ConnectionRecord.java\nfinal class ConnectionRecord {\n    final AppBindRecord binding;    // The application/service binding.\n    final ActivityServiceConnectionsHolder<ConnectionRecord> activity;  // If non-null, the owning activity.\n    final IServiceConnection conn;  // The client connection.\n}\n\n// com.android.server.am.ActiveServices#publishServiceLocked\n// frameworks/base/services/core/java/com/android/server/am/ActiveServices.java\nvoid publishServiceLocked(ServiceRecord r, Intent intent, IBinder service) {\n        final long origId = Binder.clearCallingIdentity();\n        try {\n            // å¦‚æœæœåŠ¡è®°å½•ä¸ºnullï¼Œå°±ä»€ä¹ˆéƒ½ä¸åš\n            if (r != null) {\n                Intent.FilterComparison filter\n                        = new Intent.FilterComparison(intent);\n                IntentBindRecord b = r.bindings.get(filter);\n                if (b != null && !b.received) {\n                    b.binder = service;\n                    b.requested = true;\n                    b.received = true;\n                    // å–å‡ºè¿æ¥è®°å½•ConnectionRecord\n                    ArrayMap<IBinder, ArrayList<ConnectionRecord>> connections = r.getConnections();\n                    for (int conni = connections.size() - 1; conni >= 0; conni--) {\n                        ArrayList<ConnectionRecord> clist = connections.valueAt(conni);\n                        for (int i = 0; i < clist.size(); i++) {\n                            ConnectionRecord c = clist.get(i);\n                            try {\n                                // è°ƒç”¨IServiceConnectionçš„connectedæ–¹æ³•\n                                c.conn.connected(r.name, service, false);\n                            } catch (Exception e) {\n                               \n                            }\n                        }\n                    }\n                }\n                serviceDoneExecutingLocked(r, mDestroyingServices.contains(r), false);\n            }\n        } finally {\n        }\n    }\n\n```\n\n#### æ„é€  ConnectionRecord - bindServiceLocked\n\nå®é™…ä¸Šè¿™ä¸ªæ„å»ºConnectRecordçš„è¿‡ç¨‹ä½äºbindServiceLockedæ–¹æ³•ä¸­ã€‚\n\n```java\nint bindServiceLocked(IApplicationThread caller, IBinder token, Intent service,\n                          String resolvedType, final IServiceConnection connection, int flags,\n                          String instanceName, String callingPackage, final int userId)\n            throws TransactionTooLargeException {\n        final int callingPid = Binder.getCallingPid();\n        final int callingUid = Binder.getCallingUid();\n\n        ActivityServiceConnectionsHolder<ConnectionRecord> activity = null;\n        if (token != null) {\n            activity = mAm.mAtmInternal.getServiceConnectionsHolder(token);\n            if (activity == null) {\n                Slog.w(TAG, \"Binding with unknown activity: \" + token);\n                return 0;\n            }\n        }\n        ServiceLookupResult res = retrieveServiceLocked(service, instanceName, resolvedType, callingPackage,\n                        callingPid, callingUid, userId, true,\n                        callerFg, isBindExternal, allowInstant);\n        ServiceRecord s = res.record;\n        try {\n            AppBindRecord b = s.retrieveAppBindingLocked(service, callerApp);\n            // æ„é€ è¿æ¥è®°å½•å¯¹è±¡\n            ConnectionRecord c = new ConnectionRecord(b, activity,\n                    connection, flags, clientLabel, clientIntent,\n                    callerApp.uid, callerApp.processName, callingPackage);\n\n            IBinder binder = connection.asBinder();\n            // æ·»åŠ åˆ°ServiceRecordå¯¹è±¡ä¸­\n            s.addConnection(binder, c);\n            b.connections.add(c);\n            if (activity != null) {\n                activity.addConnection(c);\n            }\n            b.client.connections.add(c);\n            c.startAssociationIfNeeded();\n        } finally {\n        }\n        return 1;\n    }\n```\n\n\n\n## éƒ¨åˆ†æ–¹æ³•çš„æºç \n\n### ContextImpl.`bindService`\n\n* `bindService` : (`frameworks/base/core/java/android/app/ContextImpl.java`)\n\n  ```java\n      @Override\n      public boolean bindService(Intent service, ServiceConnection conn, int flags) {\n          warnIfCallingFromSystemProcess();\n          return bindServiceCommon(service, conn, flags, null, mMainThread.getHandler(), null,\n                  getUser());\n      }\n  \n      @Override\n      public boolean bindService(\n              Intent service, int flags, Executor executor, ServiceConnection conn) {\n          warnIfCallingFromSystemProcess();\n          return bindServiceCommon(service, conn, flags, null, null, executor, getUser());\n      }\n  \n  ```\n\n### ContextImpl.bindServiceCommon\n\n* `bindServiceCommon`:  (`frameworks/base/core/java/android/app/ContextImpl.java`)\n\n  ```java\n  private boolean bindServiceCommon(Intent service, ServiceConnection conn, int flags,\n              String instanceName, Handler handler, Executor executor, UserHandle user) {\n          // Keep this in sync with DevicePolicyManager.bindDeviceAdminServiceAsUser.\n          IServiceConnection sd;\n          if (conn == null) {\n              throw new IllegalArgumentException(\"connection is null\");\n          }\n          if (handler != null && executor != null) {\n              throw new IllegalArgumentException(\"Handler and Executor both supplied\");\n          }\n          if (mPackageInfo != null) {\n              if (executor != null) {\n                  sd = mPackageInfo.getServiceDispatcher(conn, getOuterContext(), executor, flags);\n              } else {\n                  sd = mPackageInfo.getServiceDispatcher(conn, getOuterContext(), handler, flags);\n              }\n          } else {\n              throw new RuntimeException(\"Not supported in system context\");\n          }\n          validateServiceIntent(service);\n          try {\n              // WindowContextæ„é€ å‡½æ•°ä¸­çš„ WindowTokenClient\n              IBinder token = getActivityToken();\n              if (token == null && (flags&BIND_AUTO_CREATE) == 0 && mPackageInfo != null\n                      && mPackageInfo.getApplicationInfo().targetSdkVersion\n                      < android.os.Build.VERSION_CODES.ICE_CREAM_SANDWICH) {\n                  flags |= BIND_WAIVE_PRIORITY;\n              }\n              service.prepareToLeaveProcess(this);\n              int res = ActivityManager.getService().bindIsolatedService(\n                  mMainThread.getApplicationThread(), getActivityToken(), service,\n                  service.resolveTypeIfNeeded(getContentResolver()),\n                  sd, flags, instanceName, getOpPackageName(), user.getIdentifier());\n              if (res < 0) {\n                  throw new SecurityException(\n                          \"Not allowed to bind to service \" + service);\n              }\n              return res != 0;\n          } catch (RemoteException e) {\n              throw e.rethrowFromSystemServer();\n          }\n      }\n  ```\n\n### ActivityManagerService.bindIsolatedService\n\nä»è¿™é‡Œå¼€å§‹ï¼Œå®é™…ä¸Šä½äºAMSçš„Serverç«¯äº†ï¼Œå³æˆ‘ä»¬çš„Activityæ‰€åœ¨çš„è¿›ç¨‹å‘é€äº†ä¸€ä¸ªå¯åŠ¨æœåŠ¡çš„IPCè¯·æ±‚ç»™AMSï¼ˆsysmte_serverè¿›ç¨‹ä¸­ï¼‰ã€‚\n\n* ActivityManagerService.java : (frameworks/base/services/core/java/com/android/server/am/ActivityManagerService.java)\n\n  ```java\n  public int bindIsolatedService(IApplicationThread caller, IBinder token, Intent service,\n              String resolvedType, IServiceConnection connection, int flags, String instanceName,\n              String callingPackage, int userId) throws TransactionTooLargeException {\n  \t\t// .... \n          synchronized(this) {\n              // è°ƒç”¨Binderæ¥å£\n              return mServices.bindServiceLocked(caller, token, service,\n                      resolvedType, connection, flags, instanceName, callingPackage, userId);\n          }\n      }\n  ```\n\n![image-20210409144356311](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210409144356.png)\n\n### ActiveServices.bindServiceLocked\n\n*  `ActiveServices.bindServiceLocked`: (`frameworks/base/services/core/java/com/android/server/am/ActiveServices.java`)\n\n  * è¿™ä¸ªæ–¹æ³•æœ‰ç‚¹é•¿ï¼Œæˆ‘ä»¬æˆªå–é‡è¦éƒ¨åˆ†\n\n  ```java\n  ---\n  \n  title: 'Android bindServiceæµç¨‹'\n  date: 2021-04-12 10:18:50\n  tags: [Android,æºç åˆ†æ]\n  published: true\n  hideInList: false\n  feature: \n  isTop: false\n  ---\n  \n  \n  \n  æœ¬æ–‡åˆ†æbindServiceçš„æµç¨‹ï¼Œé¦–å…ˆæˆ‘ä»¬é€šè¿‡é˜…è¯»æºç è·å–ä¸€ä¸ªä¸»çº¿çš„è°ƒç”¨åœ°å›¾ï¼Œç„¶åæå‡ºè‹¥å¹²é—®é¢˜ï¼ŒåŒ…æ‹¬ï¼šAPPè¿›ç¨‹ä¸­å¦‚ä½•è·å–AMSï¼ŒAMSå¦‚ä½•å¯åŠ¨APP-serviceçš„è¿›ç¨‹ï¼ŒAMSä¸­å¦‚ä½•è·å–ApplicationThreadå¹¶ä¸ä¹‹é€šè®¯ï¼ŒServiceçš„å¯åŠ¨åŠç»‘å®šæµç¨‹ï¼›ç„¶åå†é€šè¿‡æºç ä¸€ä¸€è§£ç­”ã€‚æœ€åå†æ•´ä½“æ€»ç»“æ¢³ç†ä¸€ä¸‹æ•´ä½“æµç¨‹ï¼›\n  \n  <!-- more -->\n  \n  \n  \n  **é¢„å…ˆçŸ¥è¯†ï¼š**\n  \n  * Binderé€šä¿¡æœºåˆ¶\n  \n  ## æ•´ä½“åˆ†æä¸æ€»ç»“\n  \n  ### ä¸»çº¿åœ°å›¾ä¸é—®é¢˜æå‡º\n  \n  æˆ‘ä»¬ä»bindServiceä¸€è·¯è·Ÿè¸ªï¼Œåˆæ­¥ç»˜åˆ¶äº†å¦‚ä¸‹çš„è°ƒç”¨åºåˆ—å›¾ï¼Œæˆ‘ä»¬å¯ä»¥ä»¥ä¸‹é¢çš„å›¾ä½œä¸ºä¸€ä¸ªä¸»çº¿åœ°å›¾ï¼Œé¿å…èµ°å¤±ï¼Œç„¶åæ ¹æ®å…·ä½“é—®é¢˜è¿›è¡Œç»†èŠ‚åˆ†æã€‚\n  \n  \n  <svg width=\"812px\" height=\"553px\" viewBox=\"0 0 812 553\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n      <g id=\"Androidæºç åˆ†æ\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n          <g id=\"bindServiceæµç¨‹åˆ†æ-åŠ å…¥å¯åŠ¨æµç¨‹\" transform=\"translate(-94.000000, -222.000000)\">\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç \" transform=\"translate(125.000000, 273.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" stroke-width=\"0.870292887\" fill=\"#E4E4E4\" x=\"0.435146444\" y=\"0.435146444\" width=\"298.528768\" height=\"33.1297071\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"87.4814217\" y=\"14\">Context.bindService</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"33.3413714\" y=\"30.122449\">frameworks/base/core/java/android/content/Context.java</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½\" transform=\"translate(125.000000, 322.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" stroke-width=\"0.870292887\" fill=\"#E4E4E4\" x=\"0.435146444\" y=\"0.435146444\" width=\"298.528768\" height=\"33.1297071\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"73.439246\" y=\"14\">ContextImpl.bindService</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"32.0315806\" y=\"30.122449\">frameworks/base/core/java/android/app/ContextImpl.java</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-2\" transform=\"translate(125.000000, 373.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" stroke-width=\"0.870292887\" fill=\"#E4E4E4\" x=\"0.435146444\" y=\"0.435146444\" width=\"298.528768\" height=\"33.1297071\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"45.7569699\" y=\"14\">ContextImpl.bindServiceCommon</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"32.0315806\" y=\"30.122449\">frameworks/base/core/java/android/app/ContextImpl.java</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-3\" transform=\"translate(125.000000, 422.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" stroke-width=\"0.870292887\" fill=\"#E4E4E4\" x=\"0.435146444\" y=\"0.435146444\" width=\"298.528768\" height=\"33.1297071\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"35.1872627\" y=\"14\">IActivityManager.bindIsolatedService</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"80.4068108\" y=\"30.122449\">android/app/IActivityManager.java</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-4\" transform=\"translate(523.000000, 273.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"14.2367021\" y=\"14\">ActivityManagerService.bindIsolatedService</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"44.0851371\" y=\"30.122449\">com/android/server/am/ActivityManagerService.java</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-5\" transform=\"translate(523.000000, 322.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"45.2025933\" y=\"14\">ActiveServices.bindServiceLocked</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"62.0131706\" y=\"30.122449\">com/android/server/am/ActiveServices.java</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-16\" transform=\"translate(523.000000, 422.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"25.0439991\" y=\"14\">IApplicationThread.scheduleBindService</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"75.1632961\" y=\"30.122449\">android/app/IApplicationThread.java</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-17\" transform=\"translate(523.000000, 482.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFED99\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"102.802928\" y=\"14\">Binder.transact</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"136.553756\" y=\"30.122449\">binder</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-18\" transform=\"translate(440.000000, 273.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFED99\" x=\"0.5\" y=\"0.5\" width=\"63.3004695\" height=\"182\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"10.224946\" y=\"14\">Binder.</tspan>\n                      <tspan x=\"6.77075357\" y=\"32\">transact</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"19.0044607\" y=\"118.306122\">binder</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-18\" transform=\"translate(440.000000, 537.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFED99\" x=\"0.5\" y=\"0.5\" width=\"63.3004695\" height=\"182\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"10.224946\" y=\"14\">Binder.</tspan>\n                      <tspan x=\"6.77075357\" y=\"32\">transact</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"19.0044607\" y=\"118.306122\">binder</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-10\" transform=\"translate(522.000000, 537.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"27.1213883\" y=\"14\">ApplicationThread.scheduleBindService</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"28.0238818\" y=\"30.122449\">frameworks/base/core/java/android/app/ActivityThread.java</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-12\" transform=\"translate(522.000000, 587.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"43.344518\" y=\"14\">ActivityThread#handleBindService</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"28.0238818\" y=\"30.122449\">frameworks/base/core/java/android/app/ActivityThread.java</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-19\" transform=\"translate(522.000000, 637.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"63.1680494\" y=\"14\">IBinder = Service.onBinder()</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"104.313756\" y=\"30.122449\">è‡ªå®šä¹‰çš„Serviceå®ç°ç±»</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-20\" transform=\"translate(522.000000, 686.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"48.7055222\" y=\"14\">IActivityManager#publishService</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"80.4068108\" y=\"30.122449\">android/app/IActivityManager.java</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-21\" transform=\"translate(125.000000, 537.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"28.303246\" y=\"14\">ActivityManagerService#publishService</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"80.4068108\" y=\"30.122449\">android/app/IActivityManager.java</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-23\" transform=\"translate(125.000000, 587.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"34.5841498\" y=\"14\">ActiveServices#publishServiceLocked</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"62.0131706\" y=\"30.122449\">com/android/server/am/ActiveServices.java</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-51\" transform=\"translate(125.000000, 638.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"54.5477983\" y=\"14\">IServiceConnection#connected</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"148.202627\" y=\"30.122449\">-</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-8\" transform=\"translate(523.000000, 373.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"12.0131038\" y=\"14\">ActiveServices.requestServiceBindingLocked</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"62.0131706\" y=\"30.122449\">com/android/server/am/ActiveServices.java</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-13\" transform=\"translate(347.000000, 222.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" stroke-width=\"0.870292887\" fill=\"#E4E4E4\" x=\"0.435146444\" y=\"0.435146444\" width=\"74.4818198\" height=\"33.1297071\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"5.9181986\" y=\"14\">APP-client</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"20.8532948\" y=\"30.122449\">APPè¿›ç¨‹</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-14\" transform=\"translate(830.000000, 222.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"74.3521127\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"2.77470069\" y=\"14\">AMS-server</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"5.78852492\" y=\"30.122449\">system_process</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-14\" transform=\"translate(347.000000, 740.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"74.3521127\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"2.77470069\" y=\"14\">AMS-server</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"5.78852492\" y=\"30.122449\">system_process</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-15\" transform=\"translate(830.000000, 741.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"74.3521127\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"4.04184714\" y=\"14\">APP:server</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"5.24894333\" y=\"30.122449\">APP Serviceè¿›ç¨‹</tspan>\n                  </text>\n              </g>\n              <path id=\"ç›´çº¿-16\" d=\"M811.41934,230.797071 C811.613811,230.797071 811.805612,230.843224 811.979552,230.931875 L811.979552,230.931875 L830.473932,240.357781 C831.092725,240.673158 831.343541,241.440147 831.034144,242.0709 C830.912931,242.318011 830.716358,242.518383 830.473932,242.641939 L830.473932,242.641939 L811.979552,252.067845 C811.360759,252.383221 810.608312,252.127558 810.298915,251.496806 C810.211945,251.319504 810.166667,251.123996 810.166667,250.925766 L810.166667,250.925766 L810.166,243.24 L423,243.240586 C422.038701,243.240586 421.259414,242.461299 421.259414,241.5 C421.259414,240.586766 421.962721,239.837798 422.857245,239.765184 L423,239.759414 L810.166,239.759 L810.166667,232.073954 C810.166667,231.412826 810.659593,230.869053 811.291261,230.803664 Z\" fill-opacity=\"0.56105479\" fill=\"#C9C9C9\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-16å¤‡ä»½-2\" d=\"M441.58066,746.797071 C442.272493,746.797071 442.833333,747.368751 442.833333,748.073954 L442.833333,748.073954 L442.833,755.759 L830,755.759414 C830.961299,755.759414 831.740586,756.538701 831.740586,757.5 C831.740586,758.413234 831.037279,759.162202 830.142755,759.234816 L830,759.240586 L442.833,759.24 L442.833333,766.925766 C442.833333,767.074439 442.807864,767.22158 442.758439,767.360657 L442.701085,767.496806 C442.391688,768.127558 441.639241,768.383221 441.020448,768.067845 L441.020448,768.067845 L422.526068,758.641939 C422.283642,758.518383 422.087069,758.318011 421.965856,758.0709 C421.656459,757.440147 421.907275,756.673158 422.526068,756.357781 L422.526068,756.357781 L441.020448,746.931875 C441.194388,746.843224 441.386189,746.797071 441.58066,746.797071 Z\" fill-opacity=\"0.56105479\" fill=\"#C9C9C9\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-16å¤‡ä»½\" d=\"M871.5,255.259414 C872.413234,255.259414 873.162202,255.962721 873.234816,256.857245 L873.240586,257 L873.24,721.166 L880.926046,721.166667 C881.587174,721.166667 882.130947,721.659593 882.196336,722.291261 L882.202929,722.41934 C882.202929,722.613811 882.156776,722.805612 882.068125,722.979552 L882.068125,722.979552 L872.642219,741.473932 C872.326842,742.092725 871.559853,742.343541 870.9291,742.034144 C870.681989,741.912931 870.481617,741.716358 870.358061,741.473932 L870.358061,741.473932 L860.932155,722.979552 C860.616779,722.360759 860.872442,721.608312 861.503194,721.298915 C861.680496,721.211945 861.876004,721.166667 862.074234,721.166667 L862.074234,721.166667 L869.759,721.166 L869.759414,257 C869.759414,256.038701 870.538701,255.259414 871.5,255.259414 Z\" fill-opacity=\"0.56105479\" fill=\"#C9C9C9\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿\" d=\"M272.935146,307.012222 L272.935,315.997 L276.675732,315.997076 L272.5,323.997076 L268.324268,315.997076 L272.064,315.997 L272.064854,307.012222 L272.935146,307.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-2\" d=\"M272.935146,356.012222 L272.935,364.997 L276.675732,364.997076 L272.5,372.997076 L268.324268,364.997076 L272.064,364.997 L272.064854,356.012222 L272.935146,356.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-3\" d=\"M272.935146,405.012222 L272.935,413.997 L276.675732,413.997076 L272.5,421.997076 L268.324268,413.997076 L272.064,413.997 L272.064854,405.012222 L272.935146,405.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-17\" d=\"M433.019444,433.324268 L441.019444,437.5 L433.019444,441.675732 L433.019,437.935 L423.989854,437.935146 L423.989854,437.064854 L433.019,437.064 L433.019444,433.324268 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-4\" d=\"M516.989899,284.324268 L524.989899,288.5 L516.989899,292.675732 L516.989,288.935 L505.019399,288.935146 L505.019399,288.064854 L516.989,288.064 L516.989899,284.324268 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-5\" d=\"M671.935146,307.012222 L671.935,315.997 L675.675732,315.997076 L671.5,323.997076 L667.324268,315.997076 L671.064,315.997 L671.064854,307.012222 L671.935146,307.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-6\" d=\"M671.935146,356.012222 L671.935,364.997 L675.675732,364.997076 L671.5,372.997076 L667.324268,364.997076 L671.064,364.997 L671.064854,356.012222 L671.935146,356.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-7\" d=\"M671.935146,405.012222 L671.935,413.997 L675.675732,413.997076 L671.5,421.997076 L667.324268,413.997076 L671.064,413.997 L671.064854,405.012222 L671.935146,405.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-8\" d=\"M671.935146,454.998187 L671.935,473.011 L675.675732,473.011111 L671.5,481.011111 L667.324268,473.011111 L671.064,473.011 L671.064854,454.998187 L671.935146,454.998187 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-9\" d=\"M671.935146,514.990779 L671.935,530.018 L675.675732,530.018519 L671.5,538.018519 L667.324268,530.018519 L671.064,530.018 L671.064854,514.990779 L671.935146,514.990779 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-10\" d=\"M671.935146,571.012222 L671.935,579.997 L675.675732,579.997076 L671.5,587.997076 L667.324268,579.997076 L671.064,579.997 L671.064854,571.012222 L671.935146,571.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-18\" d=\"M671.935146,621.012222 L671.935,629.997 L675.675732,629.997076 L671.5,637.997076 L667.324268,629.997076 L671.064,629.997 L671.064854,621.012222 L671.935146,621.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-11\" d=\"M671.935146,671.012222 L671.935,679.997 L675.675732,679.997076 L671.5,687.997076 L667.324268,679.997076 L671.064,679.997 L671.064854,671.012222 L671.935146,671.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-19\" d=\"M511.984127,699.324268 L511.984,703.064 L522.006575,703.064854 L522.006575,703.935146 L511.984,703.935 L511.984127,707.675732 L503.984127,703.5 L511.984127,699.324268 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-20\" d=\"M431.980556,550.324268 L431.98,554.064 L441.010146,554.064854 L441.010146,554.935146 L431.98,554.935 L431.980556,558.675732 L423.980556,554.5 L431.980556,550.324268 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-12\" d=\"M272.935146,571.012222 L272.935,579.997 L276.675732,579.997076 L272.5,587.997076 L268.324268,579.997076 L272.064,579.997 L272.064854,571.012222 L272.935146,571.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-12å¤‡ä»½\" d=\"M272.935146,621.012222 L272.935,629.997 L276.675732,629.997076 L272.5,637.997076 L268.324268,629.997076 L272.064,629.997 L272.064854,621.012222 L272.935146,621.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <g id=\"åºå·\" transform=\"translate(94.000000, 400.000000)\">\n                  <circle id=\"æ¤­åœ†å½¢\" stroke=\"#888888\" stroke-width=\"1.3\" fill-opacity=\"0.5\" fill=\"#E4E4E4\" cx=\"13\" cy=\"13\" r=\"12.35\"></circle>\n                  <text id=\"1\" font-family=\"NotoSansCJKsc-Black, Noto Sans CJK SC\" font-size=\"13\" font-weight=\"800\" letter-spacing=\"0.143000009\" fill=\"#020202\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"8.97\" y=\"17.6\">1</tspan>\n                  </text>\n              </g>\n              <g id=\"åºå·å¤‡ä»½\" transform=\"translate(825.000000, 400.000000)\">\n                  <circle id=\"æ¤­åœ†å½¢\" stroke=\"#888888\" stroke-width=\"1.3\" fill-opacity=\"0.5\" fill=\"#E4E4E4\" cx=\"13\" cy=\"13\" r=\"12.35\"></circle>\n                  <text id=\"2\" font-family=\"NotoSansCJKsc-Black, Noto Sans CJK SC\" font-size=\"13\" font-weight=\"800\" letter-spacing=\"0.143000009\" fill=\"#020202\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"8.97\" y=\"17.6\">2</tspan>\n                  </text>\n              </g>\n          </g>\n      </g>\n  </svg>\n  \n  \n  \n  ä»ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬æå‡ºå¦‚ä¸‹é—®é¢˜ï¼š\n  \n  1. bindServiceCommonåˆ°IActivityManagerçš„è°ƒç”¨ä¸­ï¼Œæ˜¯å¦‚ä½•è·å–åˆ°ActivityManagerServiceçš„ï¼Ÿ\n  2. AMSä¸­å¦‚ä½•è·å–ApplicationThreadå¹¶ä¸ä¹‹é€šè®¯ï¼Ÿ\n     * ApplicatoinThreadçš„ç”¨é€”ï¼ŸApplicationThreadè¿è¡Œçš„è¿›ç¨‹æ˜¯å“ªä¸ªï¼Ÿ\n  3. è¿›ç¨‹å¦‚ä½•å¯åŠ¨-å³AMSå¦‚ä½•åˆ›å»ºAPP:serverè¿›ç¨‹ï¼Ÿ\n  4. Serviceå¦‚ä½•å¯åŠ¨ï¼Ÿ\n  5. Serviceå¦‚ä½•ç»‘å®šï¼Ÿ\n     * ServiceConnection çš„å›è°ƒæ–¹æ³•ä½•æ—¶ä½¿ç”¨ï¼Ÿ\n  \n  ### é—®é¢˜è§£ç­”æ±‡æ€»\n  \n  æˆ‘ä»¬å°†ç›¸å…³é—®é¢˜çš„ç»“è®ºæå‰åˆ°æ­¤å°èŠ‚ï¼Œä¾¿äºåç»­ä»æ¯”è¾ƒæŠ½è±¡çš„å±‚æ¬¡ä¸Šæ¥è¿›è¡Œå¤ä¹ åŠé¢„è§ˆï¼›\n  \n  #### APPè¿›ç¨‹å¦‚ä½•è·å–AMSï¼Ÿ\n  \n  * APPè¿›ç¨‹ä¸­é€šè¿‡ `ServiceManager.getService(Context.ACTIVITY_SERVICE)` è·å–çš„ActivityManagerServiceçš„å®¢æˆ·ç«¯æ“ä½œä»£ç†å¯¹è±¡ï¼ˆProxyï¼‰ã€‚\n  \n    > è¯¥å¯¹è±¡ä½äºAPPè¿›ç¨‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ­¤å¯¹è±¡ï¼ˆé€šè¿‡Binderè¿›ç¨‹é—´é€šä¿¡ï¼‰æ¥è¦æ±‚ï¼ˆä½äºsystem_processä¸­ï¼‰çš„ActivityManagerServiceè¿›è¡Œå¯¹åº”çš„æœåŠ¡æ“ä½œï¼› \n  \n  #### AMSå¦‚ä½•è·å–ApplicationThreadï¼Ÿ\n  \n  * APPè¿›ç¨‹åœ¨binderSericeæ—¶ï¼Œå°†è‡ªå·±è¿›ç¨‹ä¸­çš„ApplicationThreadå–å‡ºï¼Œé€šè¿‡Binderæœºåˆ¶ä¼ é€’ç»™AMSè¿›ç¨‹ï¼Œä¼ é€’è¿‡ç¨‹ä¸­ä¼šè½¬æ¢æˆä¸€ä¸ªProxyå¯¹è±¡ï¼›\n  \n    ```java\n    ActivityManager.getService().bindIsolatedService(\n                mMainThread.getApplicationThread(), getActivityToken(), service,\n                service.resolveTypeIfNeeded(getContentResolver()),\n                sd, flags, instanceName, getOpPackageName(), user.getIdentifier());\n    ```\n  \n  #### æœåŠ¡å¦‚ä½•ç»‘å®šï¼ŸæœåŠ¡å¦‚ä½•å¯åŠ¨ï¼Ÿè¿›ç¨‹å¦‚ä½•å¯åŠ¨ï¼Ÿ\n  \n  * **è¿›ç¨‹å¯åŠ¨**ï¼š\n    * åœ¨ç‹¬ç«‹çš„è¿›ç¨‹ä¸­è¿è¡Œçš„æœåŠ¡éœ€è¦å…ˆå°†è¿›ç¨‹å¯åŠ¨ï¼Œè¿›ç¨‹çš„å¯åŠ¨æ˜¯é€šè¿‡APPè¿›ç¨‹ï¼Œè¯·æ±‚ç³»ç»Ÿè¿›ç¨‹ä¸­çš„AMSæ¥æ‰§è¡Œï¼Œé€šè¿‡AMSçš„`startProcessLocked`æ–¹æ³•å¯åŠ¨è¿›ç¨‹ï¼Œæœ€ç»ˆä¼šé€šè¿‡socketæ¥å£è¯·æ±‚zygoteè¿›ç¨‹æ¥å¯åŠ¨è¿›ç¨‹ã€‚\n    * åœ¨å¯åŠ¨æ—¶ä¼šæŒ‡å®šjavaçš„å…¥å£ç‚¹ä¸ºActivityThreadï¼Œå³è¿›ç¨‹å¯åŠ¨åä¼šè¿è¡ŒActivityThreadçš„mainæ–¹æ³•ï¼›\n    * AMSä¸­ä¼šè®°å½•å¯åŠ¨çš„è¿›ç¨‹è®°å½•ï¼ˆProcessRecordï¼‰ï¼Œå¯¹åº”çš„ProcessRecordä¸­ä¼šè®°å½•è¿›ç¨‹å¯¹åº”çš„ApplicationThreadï¼›\n  * **æœåŠ¡å¯åŠ¨**ï¼š\n    * æœåŠ¡çš„å¯åŠ¨éœ€è¦è¯·æ±‚AMSæ¥å®Œæˆ\n    * å¯åŠ¨æ—¶éœ€è¦å…ˆé€šè¿‡PIDè·å–è¦å¯åŠ¨åˆ°çš„ProcessRecordï¼Œé€šè¿‡ProcessRecordä¸­è®°å½•çš„ApplicationThreadæ¥ä¸å¯¹åº”çš„è¿›ç¨‹é€šä¿¡ã€‚\n    * AMSé€šè¿‡ApplicationThreadæ¥é€šçŸ¥å¯¹åº”çš„è¿›ç¨‹åˆ›å»ºæœåŠ¡ï¼ŒApplicationThreadä½œä¸ºé€šä¿¡çš„æ¥å£ï¼Œå®é™…ä¸Šæœ€ç»ˆä¼šé€šè¿‡ActivityThreadçš„handleCreateServiceæ¥åˆ›å»ºæœåŠ¡çš„å®ä¾‹ï¼›\n    * æœåŠ¡åˆ›å»ºæ—¶ï¼Œæ˜¯åœ¨APPè¿›ç¨‹ï¼ˆå¯èƒ½æ˜¯ç‹¬ç«‹çš„è¿›ç¨‹ï¼‰ä¸­è¿›è¡Œçš„ï¼Œéœ€è¦é€šè¿‡ç±»åŠ è½½å™¨åŠ è½½å¯¹åº”çš„Serviceçš„ç±»ï¼ŒåŒæ—¶æ„é€ ç›¸åº”çš„ä¸Šä¸‹æ–‡åŠèµ„æºå¯¹è±¡ç­‰ï¼Œç„¶åæ„é€ å¯¹åº”çš„å®ä¾‹ï¼›\n    * æœåŠ¡åˆ›å»ºæˆåŠŸåï¼Œä¼šè®°å½•åˆ°ActivityThreadçš„ä¸€ä¸ªServiceåˆ—è¡¨ä¸­ï¼Œä»¥ä¾¿åç»­ç®¡ç†ï¼›\n  * **æœåŠ¡ç»‘å®š**ï¼š\n    * æœåŠ¡ç»‘å®šå…ˆåœ¨APPè¿›ç¨‹ä¸­ï¼Œé€šè¿‡AMSä»£ç†å¯¹è±¡å‘èµ·è¯·æ±‚ï¼Œç”±AMSæ¥å®‰æ’bindï¼ˆ**ActivityManagerService.bindIsolatedService**ï¼‰;\n    * ç„¶åå…·ä½“çš„ç»‘å®šåŠ¨ä½œè¿˜æ˜¯é€šè¿‡IApplicationThreadå®‰æ’åˆ°APPçš„Serviceè¿›ç¨‹ä¸­ï¼Œæœ€ç»ˆæ‰§è¡Œçš„`ActivityThread#handleBindService`;\n    * åœ¨APPè¿›ç¨‹ä¸­ï¼Œä¼šå°†Serviceå–å‡ºï¼Œç„¶åè°ƒç”¨å…¶onBindæ–¹æ³•æ¥è·å–IBinderè¿œç¨‹æ“ä½œå¯¹è±¡ï¼›\n    * ä¹‹åå†é€šè¿‡AMSè°ƒç”¨ `ActivityManagerService#publishService` æ¥é€šçŸ¥ç»‘å®šæˆåŠŸçš„é€šçŸ¥åˆ°å¯¹åº”çš„éœ€è¦ç»‘å®šæœåŠ¡çš„APPè¿›ç¨‹ï¼›\n    * publishServiceä¸­ä¼šè°ƒç”¨ServiceConnectionçš„onServiceConnectedæ–¹æ³•é€šçŸ¥æœåŠ¡è¿æ¥äº†ï¼›\n  \n  ### æ•´ä½“æµç¨‹æ€»ç»“\n  \n  > å¾…è¡¥å……\n  \n  ## è¯¦ç»†åˆ†æè§£ç­”é—®é¢˜\n  \n  ### APPè¿›ç¨‹ä¸­å¦‚ä½•è·å–AMSï¼Ÿ\n  \n  > è¯´æ˜ï¼š\n  >\n  > * ç¬¬ä¸€æ¬¡å…ˆé€é¡¹æŸ¥çœ‹å„ä¸ªå°èŠ‚ï¼Œæœ€åå†çœ‹æ­¤å¤„çš„æ€»ç»“ï¼›\n  >\n  > * åç»­ç›´æ¥æŸ¥çœ‹æ€»ç»“æ¥å¿«é€Ÿè·å–ç»“è®ºï¼›\n  \n  ==æ€»ç»“ï¼š==\n  \n  * APPè¿›ç¨‹ä¸­é€šè¿‡ `ServiceManager.getService(Context.ACTIVITY_SERVICE)` è·å–çš„`ActivityManagerService`çš„å®¢æˆ·ç«¯æ“ä½œä»£ç†å¯¹è±¡ï¼ˆProxyï¼‰ã€‚\n  * è¯¥å¯¹è±¡ä½äºAPPè¿›ç¨‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ­¤å¯¹è±¡ï¼ˆé€šè¿‡Binderè¿›ç¨‹é—´é€šä¿¡ï¼‰æ¥è¦æ±‚ï¼ˆä½äº`system_process`ä¸­ï¼‰çš„`ActivityManagerService`è¿›è¡Œå¯¹åº”çš„æœåŠ¡æ“ä½œï¼› \n  \n  å…·ä½“æŸ¥çœ‹å¦‚ä¸‹ä»£ç ï¼š\n  \n  #### ContextImpl.bindServiceCommon\n  \n  æˆ‘ä»¬çœ‹ `ContextImpl.bindServiceCommon` æ–¹æ³•çš„å®ç°ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯è°ƒç”¨äº† `ActivityManager.getService()` è·å–çš„ï¼›\n  \n  `frameworks/base/core/java/android/app/ContextImpl.java`: \n  \n  â€‹```java\n  private boolean bindServiceCommon(Intent service, ServiceConnection conn, int flags,\n              String instanceName, Handler handler, Executor executor, UserHandle user) {\n          // Keep this in sync with DevicePolicyManager.bindDeviceAdminServiceAsUser.\n          IServiceConnection sd;\n          \n          if (executor != null) {\n              sd = mPackageInfo.getServiceDispatcher(conn, getOuterContext(), executor, flags);\n          } else {\n              sd = mPackageInfo.getServiceDispatcher(conn, getOuterContext(), handler, flags);\n          }\n  \t    //\n          int res = ActivityManager.getService().bindIsolatedService(\n              mMainThread.getApplicationThread(), getActivityToken(), service,\n              service.resolveTypeIfNeeded(getContentResolver()),\n              sd, flags, instanceName, getOpPackageName(), user.getIdentifier());\n  \n  }\n  â€‹```\n  \n  #### `ActivityManager.getService()`\n  \n  å¦‚ä¸‹ä»£ç ï¼ŒgetServiceå®é™…ä¸Šæ˜¯ä»ServiceManagerè·å–ä¸€ä¸ªActivityServiceçš„Binderè¿œç¨‹æœåŠ¡æ¥å£å¯¹è±¡ï¼Œå¹¶ä¸”è¿™ä¸ªä¼šè¢«è®¾ç½®ä¸ºå•ä¾‹æ¨¡å¼ï¼›\n  \n  `frameworks/base/core/java/android/app/ActivityManager.java`:\n  \n  â€‹```java\n  private static final Singleton<IActivityManager> IActivityManagerSingleton =\n      new Singleton<IActivityManager>() {\n      @Override\n      protected IActivityManager create() {\n          // ç›´æ¥é€šè¿‡ ServiceManager.getService è·å–ä¸€ä¸ªIBinderå¯¹è±¡\n          final IBinder b = ServiceManager.getService(Context.ACTIVITY_SERVICE);\n          final IActivityManager am = IActivityManager.Stub.asInterface(b);\n          return am;\n      }\n  };\n  \n  public static IActivityManager getService() {\n      // ç›´æ¥ä»IActivityManagerSingletonè·å–å®ä¾‹\n      return IActivityManagerSingleton.get();\n  }\n  â€‹```\n  \n  ### AMSå¦‚ä½•è·å–åˆ° ApplicatoinThreadï¼Ÿ\n  \n  é¦–å…ˆï¼ŒAMSå®é™…ä¸Šä½äºç³»ç»Ÿè¿›ç¨‹ï¼ˆsystem_process)ï¼Œè€ŒApplicationThreadåˆ™ä½äºæˆ‘ä»¬çš„APPè¿›ç¨‹ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªè·¨è¿›ç¨‹çš„æ“ä½œå‘¢ï¼Ÿ\n  \n  * Serviceçš„åˆ›å»ºéœ€è¦ç»è¿‡ç³»ç»Ÿçš„ç®¡ç†ï¼Œæ¯”æ–¹è¯´é‰´æƒåŠå…¶ä»–ç®¡ç†éœ€è¦ï¼›\n  * è€Œå¼€å‘è€…å®šä¹‰çš„Serviceçš„å®ä¾‹çš„åˆ›å»ºé€»è¾‘ä¹Ÿè¿˜æ˜¯éœ€è¦å¼€å‘è€…æ¥å®ç°ï¼ŒServiceå¯¹åº”çš„ç±»ä¹Ÿåº”è¯¥åªåŠ è½½åœ¨å¼€å‘è€…è‡ªå·±çš„è¿›ç¨‹ä¹‹ä¸­ï¼ŒServiceä½¿ç”¨æ–¹å®é™…ä¸Šè¿˜æ˜¯å¼€å‘è€…è‡ªå·±ï¼Œæ‰€ä»¥æœåŠ¡çš„çœŸå®å®ä¾‹çš„åˆ›å»ºè¿‡ç¨‹è¦åœ¨åº”ç”¨çš„è¿›ç¨‹ä¸­ï¼›\n  \n  é‚£ä¹ˆï¼Œç³»ç»Ÿè¿›ç¨‹ï¼ˆä¸­çš„AMSï¼‰å¦‚ä½•è·å–ApplicationThreadå‘¢ï¼Ÿ\n  \n  #### ApplicationThreadçš„æ¥æºï¼Ÿ\n  \n  æŸ¥çœ‹ **ContextImpl.bindServiceCommon** çš„ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œæ˜¯åœ¨è°ƒç”¨AMSçš„bindServiceæ–¹æ³•æ—¶ï¼Œå°†è‡ªå·±è¿›ç¨‹ä¸­çš„`ApplicationThread`åŠ`ActivityToken`å–å‡ºä¼ é€’ç»™äº†AMSæœåŠ¡ï¼›\n  \n  â€‹```java\n  // frameworks/base/core/java/android/app/ContextImpl.java\n  final @NonNull ActivityThread mMainThread;\n  private final @Nullable IBinder mToken;\n  \n  public IBinder getActivityToken() {\n      return mToken;\n  }\n  \n  private boolean bindServiceCommon(Intent service, ServiceConnection conn, int flags,\n              String instanceName, Handler handler, Executor executor, UserHandle user) {\n          // Keep this in sync with DevicePolicyManager.bindDeviceAdminServiceAsUser.\n          IServiceConnection sd;\n          try {\n              service.prepareToLeaveProcess(this);\n              // è°ƒç”¨æ—¶ä¼ é€’äº†ApplicationThreadå’ŒIBinder\n              int res = ActivityManager.getService().bindIsolatedService(\n                  mMainThread.getApplicationThread(), getActivityToken(), service,\n                  service.resolveTypeIfNeeded(getContentResolver()),\n                  sd, flags, instanceName, getOpPackageName(), user.getIdentifier());\n              if (res < 0) {\n                  throw new SecurityException(\n                          \"Not allowed to bind to service \" + service);\n              }\n              return res != 0;\n          } catch (RemoteException e) {\n              throw e.rethrowFromSystemServer();\n          }\n      }\n  â€‹```\n  \n  å®é™…ä¸Šï¼Œä¸Šé¢çš„`mMainThread.getApplicationThread()`å–å‡ºçš„æ˜¯æˆ‘ä»¬çš„APPè¿›ç¨‹ä¸­çš„ApplicationThreadçš„æœåŠ¡ç«¯å¯¹è±¡ï¼Œç„¶åç»è¿‡IActivityManagerè¿›è¡Œbinderä¼ è¾“ï¼ˆtransactï¼‰å‰ï¼Œä¼šå°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªProxyä»£ç†å¯¹è±¡ï¼Œç”¨äºåœ¨AMSä¸­è¯·æ±‚æˆ‘ä»¬è¿›ç¨‹çš„ApplicationThreadæ¥æä¾›æœåŠ¡ï¼› \n  \n  â€‹```java\n  // android.app.IActivityManager.Stub#TRANSACTION_bindIsolatedService \n  case TRANSACTION_bindIsolatedService:\n          {\n            data.enforceInterface(descriptor);\n            android.app.IApplicationThread _arg0;\n            // è¿™é‡Œå°†IApplicationThreadçš„æœåŠ¡å¯¹è±¡è½¬æ¢æˆä¸€ä¸ªProxyä»£ç†å¯¹è±¡\n            _arg0 = android.app.IApplicationThread.Stub.asInterface(data.readStrongBinder());\n            android.os.IBinder _arg1;\n            _arg1 = data.readStrongBinder();\n            android.content.Intent _arg2;\n            if ((0!=data.readInt())) {\n              _arg2 = android.content.Intent.CREATOR.createFromParcel(data);\n            }\n            else {\n              _arg2 = null;\n            }\n            java.lang.String _arg3;\n            _arg3 = data.readString();\n            android.app.IServiceConnection _arg4;\n            // åŒç†ï¼Œè¿™é‡Œå°†IServiceConnectionçš„æœåŠ¡å¯¹è±¡ä¹Ÿè½¬æ¢æˆä¸€ä¸ªProxyä»£ç†å¯¹è±¡\n            _arg4 = android.app.IServiceConnection.Stub.asInterface(data.readStrongBinder());\n            int _arg5;\n            _arg5 = data.readInt();\n            java.lang.String _arg6;\n            _arg6 = data.readString();\n            java.lang.String _arg7;\n            _arg7 = data.readString();\n            int _arg8;\n            _arg8 = data.readInt();\n            int _result = this.bindIsolatedService(_arg0, _arg1, _arg2, _arg3, _arg4, _arg5, _arg6, _arg7, _arg8);\n            reply.writeNoException();\n            reply.writeInt(_result);\n            return true;\n          }\n          \n  // android.app.IApplicationThread.Stub\n   /** Local-side IPC implementation stub class. */\n    public static abstract class Stub extends android.os.Binder implements android.app.IApplicationThread\n    {\n      private static final java.lang.String DESCRIPTOR = \"android.app.IApplicationThread\";\n      /** Construct the stub at attach it to the interface. */\n      public Stub()\n      {\n        this.attachInterface(this, DESCRIPTOR);\n      }\n      /**\n       * Cast an IBinder object into an android.app.IApplicationThread interface,\n       * generating a proxy if needed.\n       */\n      public static android.app.IApplicationThread asInterface(android.os.IBinder obj)\n      {\n        if ((obj==null)) {\n          return null;\n        }\n        android.os.IInterface iin = obj.queryLocalInterface(DESCRIPTOR);\n        if (((iin!=null)&&(iin instanceof android.app.IApplicationThread))) {\n          return ((android.app.IApplicationThread)iin);\n        }\n        // è¿™é‡Œæ„é€ æˆäº†Proxy\n        return new android.app.IApplicationThread.Stub.Proxy(obj);\n      }\n    }\n  â€‹```\n  \n  \n  > è¿™é‡Œæˆ‘ä»¬æš‚ä¸è€ƒè™‘ApplicationThreadç”±ä½•å¤„è€Œæ¥ï¼Œæ¯ä¸ªè¿›ç¨‹ä¸­éƒ½å¯¹åº”ä¸€ä¸ªActivityThreadï¼ŒActivityThreadä¸­æœ‰ä¸€ä¸ªApplicationThreadå¯¹è±¡ã€‚\n  \n  #### ApplicationThreadåœ¨bindæµç¨‹ä¸­çš„ä½¿ç”¨\n  \n  æˆ‘ä»¬å‘ç°ï¼Œæœ€ç»ˆæ˜¯ä½¿ç”¨ `ApplicationThread`çš„ `requestServiceBindingLocked` æ–¹æ³•æ¥ç»‘å®šæœåŠ¡çš„ï¼ˆ`r.app.thread.scheduleBindService`ï¼‰ï¼Œæˆ‘ä»¬å…ˆæ¢³ç†ä¸€ä¸‹ServiceRecordç±»åŒApplicationThreadçš„å…³ç³»ï¼›\n  \n  â€‹```java\n  // frameworks/base/services/core/java/com/android/server/am/ActiveServices.java\n  // com.android.server.am.ActiveServices#requestServiceBindingLocked\n  private final boolean requestServiceBindingLocked(ServiceRecord r, IntentBindRecord i,\n              boolean execInFg, boolean rebind) throws TransactionTooLargeException {\n          if (r.app == null || r.app.thread == null) {\n              // If service is not currently running, can't yet bind.\n              return false;\n          }\n  \t    // è°ƒç”¨ApplicationThreadçš„ç»‘å®šæ–¹æ³•æ¥è¿›è¡Œç»‘å®š\n          r.app.thread.scheduleBindService(r, i.intent.getIntent(), rebind,\n                                           r.app.getReportedProcState());\n          return true;\n      }\n  \n  // frameworks/base/services/core/java/com/android/server/am/ServiceRecord.java\n  ProcessRecord app;          // where this service is running or null.\n  \n  // frameworks/base/services/core/java/com/android/server/am/ProcessRecord.java\n  IApplicationThread thread;  // the actual proc...  may be null only if\n                              // 'persistent' is true (in which case we\n                              // are in the process of launching the app)\n  â€‹```\n  \n  å…¶ä¸­ `ServiceRecord.app` çš„ç±»å‹ä¸º `ProcessRecord` ï¼Œ`ServiceRecord.app.thread` çš„ç±»å‹ä¸º `IApplicationThread`ï¼Œæˆ‘ä»¬æ¢³ç†ä¸‹å¯¹åº”çš„å‡ ä¸ªç±»çš„å…³ç³»ï¼Œå¦‚ä¸‹å›¾ï¼š\n  \n  \n  <svg width=\"730px\" height=\"473px\" viewBox=\"0 0 730 473\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n      <g id=\"Androidæºç åˆ†æ\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n          <g id=\"ServiceRecordç±»å›¾\" transform=\"translate(-38.000000, -20.000000)\">\n              <g id=\"ç±»\" transform=\"translate(41.000000, 22.000000)\">\n                  <g id=\"ç¼–ç»„\" transform=\"translate(0.663121, -1.869103)\">\n                      <path d=\"M182.673759,0.5 C183.364115,0.5 183.989115,0.779822031 184.441526,1.23223305 C184.893937,1.68464406 185.173759,2.30964406 185.173759,3 L185.173759,3 L185.173759,27.8255814 L0.5,27.8255814 L0.5,3 C0.5,2.30964406 0.779822031,1.68464406 1.23223305,1.23223305 C1.68464406,0.779822031 2.30964406,0.5 3,0.5 L3,0.5 Z\" id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#F2F2F2\"></path>\n                      <text id=\"ç±»å\" font-family=\"NotoSansCJKsc-Black, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"800\" letter-spacing=\"0.154000005\" fill=\"#020202\" fill-opacity=\"0.88378138\">\n                          <tspan x=\"41.574\" y=\"16.3255814\">ServiceRecord</tspan>\n                      </text>\n                  </g>\n                  <g id=\"å±æ€§\" transform=\"translate(0.663121, 22.288571)\">\n                      <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#E0E0E0\" x=\"0.5\" y=\"0.5\" width=\"184.756391\" height=\"46.2285714\"></rect>\n                      <text font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"12\" font-weight=\"300\" letter-spacing=\"0.132000005\" fill=\"#020202\" fill-opacity=\"0.88378138\">\n                          <tspan x=\"9.36631979\" y=\"14.7457143\">app:ProcessRecord </tspan>\n                          <tspan x=\"9.36631979\" y=\"32.7457143\">isolatedProc: ProcessRecord </tspan>\n                      </text>\n                  </g>\n                  <g id=\"æ–¹æ³•\" transform=\"translate(0.663121, 67.942857)\">\n                      <path d=\"M185.256391,0.5 L185.256391,43.2285714 C185.256391,44.1950697 184.86464,45.0700697 184.231264,45.7034452 C183.597889,46.3368206 182.722889,46.7285714 181.756391,46.7285714 L181.756391,46.7285714 L4,46.7285714 C3.03350169,46.7285714 2.15850169,46.3368206 1.52512627,45.7034452 C0.891750844,45.0700697 0.5,44.1950697 0.5,43.2285714 L0.5,43.2285714 L0.5,0.5 L185.256391,0.5 Z\" id=\"çŸ©å½¢å¤‡ä»½\" stroke=\"#979797\" fill=\"#E0E0E0\"></path>\n                      <text font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"12\" font-weight=\"300\" letter-spacing=\"0.132000005\" fill=\"#020202\" fill-opacity=\"0.88378138\">\n                          <tspan x=\"9.36631979\" y=\"15.74\">+ setProcess(ProcessRecord) </tspan>\n                      </text>\n                  </g>\n              </g>\n              <g id=\"ç±»å¤‡ä»½\" transform=\"translate(41.000000, 193.000000)\">\n                  <g id=\"ç¼–ç»„\" transform=\"translate(0.663121, -1.869103)\">\n                      <path d=\"M182.673759,0.5 C183.364115,0.5 183.989115,0.779822031 184.441526,1.23223305 C184.893937,1.68464406 185.173759,2.30964406 185.173759,3 L185.173759,3 L185.173759,27.8255814 L0.5,27.8255814 L0.5,3 C0.5,2.30964406 0.779822031,1.68464406 1.23223305,1.23223305 C1.68464406,0.779822031 2.30964406,0.5 3,0.5 L3,0.5 Z\" id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#F2F2F2\"></path>\n                      <text id=\"ç±»å\" font-family=\"NotoSansCJKsc-Black, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"800\" letter-spacing=\"0.154000005\" fill=\"#020202\" fill-opacity=\"0.88378138\">\n                          <tspan x=\"40.426\" y=\"16.3255814\">ProcessRecord</tspan>\n                      </text>\n                  </g>\n                  <g id=\"å±æ€§\" transform=\"translate(0.663121, 22.288571)\">\n                      <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#E0E0E0\" x=\"0.5\" y=\"0.5\" width=\"184.756391\" height=\"46.2285714\"></rect>\n                      <text font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"12\" font-weight=\"300\" letter-spacing=\"0.132000005\" fill=\"#020202\" fill-opacity=\"0.88378138\">\n                          <tspan x=\"9.36631979\" y=\"14.7457143\">thread:IApplicationThread </tspan>\n                          <tspan x=\"9.36631979\" y=\"32.7457143\">pid: int  </tspan>\n                      </text>\n                  </g>\n                  <g id=\"æ–¹æ³•\" transform=\"translate(0.663121, 67.942857)\">\n                      <path d=\"M185.256391,0.5 L185.256391,43.2285714 C185.256391,44.1950697 184.86464,45.0700697 184.231264,45.7034452 C183.597889,46.3368206 182.722889,46.7285714 181.756391,46.7285714 L181.756391,46.7285714 L4,46.7285714 C3.03350169,46.7285714 2.15850169,46.3368206 1.52512627,45.7034452 C0.891750844,45.0700697 0.5,44.1950697 0.5,43.2285714 L0.5,43.2285714 L0.5,0.5 L185.256391,0.5 Z\" id=\"çŸ©å½¢å¤‡ä»½\" stroke=\"#979797\" fill=\"#E0E0E0\"></path>\n                      <text font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"12\" font-weight=\"300\" letter-spacing=\"0.132000005\"></text>\n                  </g>\n              </g>\n              <g id=\"ç±»å¤‡ä»½-2\" transform=\"translate(326.000000, 84.000000)\">\n                  <g id=\"ç¼–ç»„\" transform=\"translate(1.570922, 0.886379)\">\n                      <path d=\"M436.858156,0.5 C437.548512,0.5 438.173512,0.779822031 438.625923,1.23223305 C439.078334,1.68464406 439.358156,2.30964406 439.358156,3 L439.358156,3 L439.358156,27.8255814 L0.5,27.8255814 L0.5,3 C0.5,2.30964406 0.779822031,1.68464406 1.23223305,1.23223305 C1.68464406,0.779822031 2.30964406,0.5 3,0.5 L3,0.5 Z\" id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#F2F2F2\"></path>\n                      <text id=\"ç±»å\" font-family=\"NotoSansCJKsc-Black, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"800\" letter-spacing=\"0.154000005\" fill=\"#020202\" fill-opacity=\"0.88378138\">\n                          <tspan x=\"152.123\" y=\"16.3255814\">IApplicationThread</tspan>\n                      </text>\n                  </g>\n                  <g id=\"å±æ€§\" transform=\"translate(1.570922, 27.284286)\">\n                      <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#E0E0E0\" x=\"0.5\" y=\"0.5\" width=\"439.05391\" height=\"56.8142857\"></rect>\n                      <text font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"12\" font-weight=\"300\" letter-spacing=\"0.132000005\" fill=\"#020202\" fill-opacity=\"0.88378138\">\n                          <tspan x=\"22.1886613\" y=\"14.9128571\">thread:IApplicationThread </tspan>\n                          <tspan x=\"22.1886613\" y=\"32.9128571\">pid: int  </tspan>\n                      </text>\n                  </g>\n                  <g id=\"æ–¹æ³•\" transform=\"translate(1.570922, 83.171429)\">\n                      <path d=\"M439.55391,0.5 L439.55391,53.8142857 C439.55391,54.780784 439.162159,55.655784 438.528783,56.2891594 C437.895408,56.9225349 437.020408,57.3142857 436.05391,57.3142857 L436.05391,57.3142857 L4,57.3142857 C3.03350169,57.3142857 2.15850169,56.9225349 1.52512627,56.2891594 C0.891750844,55.655784 0.5,54.780784 0.5,53.8142857 L0.5,53.8142857 L0.5,0.5 L439.55391,0.5 Z\" id=\"çŸ©å½¢å¤‡ä»½\" stroke=\"#979797\" fill=\"#E0E0E0\"></path>\n                      <text font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"12\" font-weight=\"300\" letter-spacing=\"0.132000005\" fill=\"#020202\" fill-opacity=\"0.88378138\">\n                          <tspan x=\"22.1886613\" y=\"16.13\">+ scheduleBindService(IBinder, Intent, boolean rebind, int processState)</tspan>\n                          <tspan x=\"22.1886613\" y=\"34.13\">+ scheduleCreateService(IBinder, ServiceInfo info,â€¦ )</tspan>\n                          <tspan x=\"22.1886613\" y=\"52.13\">+ bindApplication(â€¦)</tspan>\n                      </text>\n                  </g>\n              </g>\n              <g id=\"IApplicationThread.Stub\" transform=\"translate(326.000000, 402.000000)\">\n                  <g id=\"ç¼–ç»„\" transform=\"translate(0.946809, -4.518605)\">\n                      <path d=\"M262.106383,0.5 C262.796739,0.5 263.421739,0.779822031 263.87415,1.23223305 C264.326561,1.68464406 264.606383,2.30964406 264.606383,3 L264.606383,3 L264.606383,27.8255814 L0.5,27.8255814 L0.5,3 C0.5,2.30964406 0.779822031,1.68464406 1.23223305,1.23223305 C1.68464406,0.779822031 2.30964406,0.5 3,0.5 L3,0.5 Z\" id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#F2F2F2\"></path>\n                      <text id=\"ç±»å\" font-family=\"NotoSansCJKsc-Black, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"800\" letter-spacing=\"0.154000005\" fill=\"#020202\" fill-opacity=\"0.88378138\">\n                          <tspan x=\"66.65\" y=\"16.3255814\">ApplicationThread</tspan>\n                      </text>\n                  </g>\n                  <g id=\"å±æ€§\" transform=\"translate(0.946809, 17.485000)\">\n                      <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#E0E0E0\" x=\"0.5\" y=\"0.5\" width=\"264.224365\" height=\"36.05\"></rect>\n                      <text font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"12\" font-weight=\"300\" letter-spacing=\"0.132000005\"></text>\n                  </g>\n                  <g id=\"æ–¹æ³•\" transform=\"translate(0.946809, 53.300000)\">\n                      <path d=\"M264.724365,0.5 L264.724365,33.05 C264.724365,34.0164983 264.332615,34.8914983 263.699239,35.5248737 C263.065864,36.1582492 262.190864,36.55 261.224365,36.55 L261.224365,36.55 L4,36.55 C3.03350169,36.55 2.15850169,36.1582492 1.52512627,35.5248737 C0.891750844,34.8914983 0.5,34.0164983 0.5,33.05 L0.5,33.05 L0.5,0.5 L264.724365,0.5 Z\" id=\"çŸ©å½¢å¤‡ä»½\" stroke=\"#979797\" fill=\"#E0E0E0\"></path>\n                      <text font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"12\" font-weight=\"300\" letter-spacing=\"0.132000005\"></text>\n                  </g>\n              </g>\n              <g id=\"IApplicationThread.Stubå¤‡ä»½-2\" transform=\"translate(38.000000, 375.000000)\">\n                  <g id=\"ç¼–ç»„\" transform=\"translate(0.673759, -4.518605)\">\n                      <path d=\"M185.652482,0.5 C186.342838,0.5 186.967838,0.779822031 187.420249,1.23223305 C187.87266,1.68464406 188.152482,2.30964406 188.152482,3 L188.152482,3 L188.152482,27.8255814 L0.5,27.8255814 L0.5,3 C0.5,2.30964406 0.779822031,1.68464406 1.23223305,1.23223305 C1.68464406,0.779822031 2.30964406,0.5 3,0.5 L3,0.5 Z\" id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#F2F2F2\"></path>\n                      <text id=\"ç±»å\" font-family=\"NotoSansCJKsc-Black, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"800\" letter-spacing=\"0.154000005\" fill=\"#020202\" fill-opacity=\"0.88378138\">\n                          <tspan x=\"41.408\" y=\"16.3255814\">ActivityThread</tspan>\n                      </text>\n                  </g>\n                  <g id=\"å±æ€§\" transform=\"translate(0.673759, 17.485000)\">\n                      <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#E0E0E0\" x=\"0.5\" y=\"0.5\" width=\"187.73644\" height=\"36.05\"></rect>\n                      <text font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"12\" font-weight=\"300\" letter-spacing=\"0.132000005\" fill=\"#020202\" fill-opacity=\"0.88378138\">\n                          <tspan x=\"9.5165816\" y=\"14.585\">mAppThread:ApplicationThread </tspan>\n                      </text>\n                  </g>\n                  <g id=\"æ–¹æ³•\" transform=\"translate(0.673759, 53.300000)\">\n                      <path d=\"M188.23644,0.5 L188.23644,33.05 C188.23644,34.0164983 187.844689,34.8914983 187.211313,35.5248737 C186.577938,36.1582492 185.702938,36.55 184.73644,36.55 L184.73644,36.55 L4,36.55 C3.03350169,36.55 2.15850169,36.1582492 1.52512627,35.5248737 C0.891750844,34.8914983 0.5,34.0164983 0.5,33.05 L0.5,33.05 L0.5,0.5 L188.23644,0.5 Z\" id=\"çŸ©å½¢å¤‡ä»½\" stroke=\"#979797\" fill=\"#E0E0E0\"></path>\n                      <text font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"12\" font-weight=\"300\" letter-spacing=\"0.132000005\"></text>\n                  </g>\n              </g>\n              <g id=\"IApplicationThread.Stubå¤‡ä»½\" transform=\"translate(326.000000, 268.000000)\">\n                  <g id=\"ç¼–ç»„\" transform=\"translate(0.946809, -4.094684)\">\n                      <path d=\"M262.106383,0.5 C262.796739,0.5 263.421739,0.779822031 263.87415,1.23223305 C264.326561,1.68464406 264.606383,2.30964406 264.606383,3 L264.606383,3 L264.606383,27.8255814 L0.5,27.8255814 L0.5,3 C0.5,2.30964406 0.779822031,1.68464406 1.23223305,1.23223305 C1.68464406,0.779822031 2.30964406,0.5 3,0.5 L3,0.5 Z\" id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#F2F2F2\"></path>\n                      <text id=\"ç±»å\" font-family=\"NotoSansCJKsc-Black, Noto Sans CJK SC\" font-size=\"14\" font-weight=\"800\" letter-spacing=\"0.154000005\" fill=\"#020202\" fill-opacity=\"0.88378138\">\n                          <tspan x=\"44.7399999\" y=\"16.3255814\">IApplicationThread.Stub</tspan>\n                      </text>\n                  </g>\n                  <g id=\"å±æ€§\" transform=\"translate(0.946809, 18.253571)\">\n                      <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#E0E0E0\" x=\"0.5\" y=\"0.5\" width=\"264.224365\" height=\"37.6785714\"></rect>\n                      <text font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"12\" font-weight=\"300\" letter-spacing=\"0.132000005\"></text>\n                  </g>\n                  <g id=\"æ–¹æ³•\" transform=\"translate(0.946809, 55.642857)\">\n                      <path d=\"M264.724365,0.5 L264.724365,34.6785714 C264.724365,35.6450697 264.332615,36.5200697 263.699239,37.1534452 C263.065864,37.7868206 262.190864,38.1785714 261.224365,38.1785714 L261.224365,38.1785714 L4,38.1785714 C3.03350169,38.1785714 2.15850169,37.7868206 1.52512627,37.1534452 C0.891750844,36.5200697 0.5,35.6450697 0.5,34.6785714 L0.5,34.6785714 L0.5,0.5 L264.724365,0.5 Z\" id=\"çŸ©å½¢å¤‡ä»½\" stroke=\"#979797\" fill=\"#E0E0E0\"></path>\n                      <text font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"12\" font-weight=\"300\" letter-spacing=\"0.132000005\"></text>\n                  </g>\n              </g>\n              <g id=\"UML/çº¿æ¡/å®ç°\" transform=\"translate(455.000000, 225.500000)\" stroke=\"#979797\">\n                  <line x1=\"2.5\" y1=\"38.8055556\" x2=\"2.5\" y2=\"7.30555556\" id=\"ç›´çº¿-24\" stroke-linecap=\"square\" stroke-dasharray=\"2\"></line>\n                  <path d=\"M2.5,-0.931966011 L5.69098301,5.45 L-0.690983006,5.45 L2.5,-0.931966011 Z\" id=\"ä¸‰è§’å½¢\"></path>\n              </g>\n              <g id=\"UML/çº¿æ¡/å®ç°\" transform=\"translate(455.000000, 363.000000)\" stroke=\"#979797\">\n                  <line x1=\"4.5\" y1=\"34.8333333\" x2=\"4.5\" y2=\"8\" id=\"ç›´çº¿-24\" stroke-linecap=\"square\"></line>\n                  <path d=\"M4.5,1.11803399 L7.69098301,7.5 L1.30901699,7.5 L4.5,1.11803399 Z\" id=\"ä¸‰è§’å½¢\"></path>\n              </g>\n              <g id=\"UML/çº¿æ¡/èšåˆ\" transform=\"translate(128.000000, 138.000000)\">\n                  <path id=\"ç›´çº¿-24\" d=\"M6.50883555,9.81274647 L7.5086821,9.83026412 L7.49992328,10.3301874 L6.85324563,47.2403042 L6.746,53.315 L10.4214873,47.041539 L10.6742143,46.6101122 L11.5370678,47.1155662 L11.2843409,47.546993 L6.64489019,55.466936 L6.19559777,56.2339169 L5.77344839,55.451668 L1.41428008,47.3740662 L1.17682105,46.9340512 L2.05685107,46.4591331 L2.2943101,46.8991481 L5.747,53.297 L5.85339907,47.2227865 L6.50007672,10.3126697 L6.50883555,9.81274647 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n                  <path d=\"M7.04493542,0.824414956 L10.6703645,5.5 L7.04493542,10.175585 L3.53698783,5.5 L7.04493542,0.824414956 Z\" id=\"å¤šè¾¹å½¢\" stroke=\"#979797\"></path>\n              </g>\n              <g id=\"ç¼–ç»„\" transform=\"translate(272.810486, 148.720337)\" fill=\"#979797\">\n                  <g id=\"UML/çº¿æ¡/ç»„åˆ\" transform=\"translate(4.500000, 49.000000) rotate(-90.000000) translate(-4.500000, -49.000000) \">\n                      <path id=\"ç›´çº¿-24\" d=\"M4.00288801,10.1257 L5.00287142,10.1314594 L4.99999171,10.6314511 L4.54315542,89.9498322 L4.507,96.035 L8.10875237,89.7196752 L8.35638881,89.2853065 L9.22512627,89.7805794 L8.97748982,90.2149481 L4.43148901,98.188898 L3.99124645,98.9611091 L3.55992793,98.1838782 L-0.893921989,90.1580935 L-1.13653865,89.7209011 L-0.262153947,89.2356678 L-0.0195372819,89.6728601 L3.507,96.027 L3.54317201,89.9440727 L4.00000829,10.6256917 L4.00288801,10.1257 Z\" fill-rule=\"nonzero\"></path>\n                      <polygon id=\"å¤šè¾¹å½¢\" stroke=\"#979797\" points=\"4.5 0 8.76467693 5.5 4.5 11 0.373519229 5.5\"></polygon>\n                  </g>\n              </g>\n              <g id=\"ç¼–ç»„\" transform=\"translate(272.810486, 366.720337)\" fill=\"#979797\">\n                  <g id=\"UML/çº¿æ¡/ç»„åˆ\" transform=\"translate(4.500000, 49.000000) rotate(-90.000000) translate(-4.500000, -49.000000) \">\n                      <path id=\"ç›´çº¿-24\" d=\"M4.00288801,10.1257 L5.00287142,10.1314594 L4.99999171,10.6314511 L4.54315542,89.9498322 L4.507,96.035 L8.10875237,89.7196752 L8.35638881,89.2853065 L9.22512627,89.7805794 L8.97748982,90.2149481 L4.43148901,98.188898 L3.99124645,98.9611091 L3.55992793,98.1838782 L-0.893921989,90.1580935 L-1.13653865,89.7209011 L-0.262153947,89.2356678 L-0.0195372819,89.6728601 L3.507,96.027 L3.54317201,89.9440727 L4.00000829,10.6256917 L4.00288801,10.1257 Z\" fill-rule=\"nonzero\"></path>\n                      <polygon id=\"å¤šè¾¹å½¢\" stroke=\"#979797\" points=\"4.5 0 8.76467693 5.5 4.5 11 0.373519229 5.5\"></polygon>\n                  </g>\n              </g>\n          </g>\n      </g>\n  </svg>\n  \n  ç°åœ¨æˆ‘ä»¬çœ‹ä¸‹ ServiceRecord æ˜¯ä½•æ—¶æ„é€ çš„ï¼Œé¦–å…ˆï¼Œæ ¹æ®æ–¹æ³•çš„è°ƒç”¨å±‚æ¬¡ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š\n  \n  * `ActiveServices.bindServiceLocked` æ–¹æ³•ä¸­ï¼Œå‚æ•°ä¸­æ²¡æœ‰ServiceRecordï¼Œæœ‰çš„æ˜¯IApplicationThreadåŠä¸€ä¸ªIBinderã€‚\n  * `ActiveServices.requestServiceBindingLocked` æ–¹æ³•ä¸­ï¼Œåˆ™å˜æˆäº†ServiceRecordç±»å‹ã€‚\n  \n  ![image-20210410215833909](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210410215833.png)\n  \n  > æç¤ºï¼šä¸Šè¿°è°ƒç”¨å±‚æ¬¡å¯ä»¥åœ¨IDEAä¸­é€‰ä¸­`ActiveServices.requestServiceBindingLocked`æ–¹æ³•ï¼Œç„¶åé€šè¿‡â€œ**Navigateï½œCall Hierarchy**â€ï¼ˆå¿«æ·é”®ä¸º==ctrl+opt+H==ï¼‰å¼¹å‡ºã€‚\n  \n  \n  \n  æ‰€ä»¥ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸‹ `ActiveServices.bindServiceLocked` æ–¹æ³•å¦‚ä½•å°†`ApplicationThread`å­˜å…¥åˆ°`ServiceRecord`å¯¹è±¡ä¸­ã€‚\n  \n  ##### ActiveServices.bindServiceLocked\n  \n  â€‹```java\n      int bindServiceLocked(IApplicationThread caller, IBinder token, Intent service,\n              String resolvedType, final IServiceConnection connection, int flags,\n              String instanceName, String callingPackage, final int userId)\n              throws TransactionTooLargeException {\n          final int callingPid = Binder.getCallingPid();\n          final int callingUid = Binder.getCallingUid();\n          // è¿™é‡Œè·å–äº† ProcessRecord\n          final ProcessRecord callerApp = mAm.getRecordForAppLocked(caller);\n  \n          final boolean callerFg = callerApp.setSchedGroup != ProcessList.SCHED_GROUP_BACKGROUND;\n          final boolean isBindExternal = (flags & Context.BIND_EXTERNAL_SERVICE) != 0;\n          final boolean allowInstant = (flags & Context.BIND_ALLOW_INSTANT) != 0;\n  \n          // å°†IApplicationThreadåŠIBinderæ”¾å…¥åˆ°ServiceRecordä¸­çš„è¿‡ç¨‹åœ¨retrieveServiceLockedä¸­\n          ServiceLookupResult res =\n              retrieveServiceLocked(service, instanceName, resolvedType, callingPackage,\n                      callingPid, callingUid, userId, true,\n                      callerFg, isBindExternal, allowInstant);\n          // æ­¤å¤„è·å–ServiceRecordï¼Œæ•…åœ¨ä¸Šé¢\n          ServiceRecord s = res.record;\n          if (s.app != null && b.intent.received) {\n              requestServiceBindingLocked(s, b.intent, callerFg, true);\n          } else if (!b.intent.requested) {\n              requestServiceBindingLocked(s, b.intent, callerFg, false);\n          }\n          return 1;\n      }\n  â€‹```\n  \n  åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ServiceRecordæ˜¯é€šè¿‡`retrieveServiceLocked`æ–¹æ³•è·å–åˆ°çš„`ServiceLookupResult`è·å–åˆ°çš„ã€‚\n  \n  ==ç²—ç•¥çœ‹äº†ä¸‹è¿™ä¸ª`retrieveServiceLocked`æ–¹æ³•ï¼Œå…¶ä¸­é€»è¾‘æ¯”è¾ƒå¤šï¼Œæˆ‘ä»¬è¿™é‡Œè½¬æ¢ä¸‹æ€è·¯ï¼Œç›´æ¥æŸ¥æ‰¾ `ServiceRecord.app` çš„èµ‹å€¼æ“ä½œ==ã€‚\n  \n  ##### `ServiceRecord.app` çš„èµ‹å€¼\n  \n  æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ServiceRecord.appï¼ˆProcessRecordï¼‰çš„èµ‹å€¼æ“ä½œçš„è°ƒç”¨æ–¹æ³•ä¸ºï¼š`com.android.server.am.ActiveServices#realStartServiceLocked`\n  \n  â€‹```java\n  private final void realStartServiceLocked(ServiceRecord r,\n              ProcessRecord app, boolean execInFg) throws RemoteException {\n          if (app.thread == null) {\n              throw new RemoteException();\n          }\n      \t// åœ¨æ­¤å¤„èµ‹å€¼\n          r.setProcess(app);\n  \t    // ...\n  }\n  â€‹```\n  \n  æŸ¥çœ‹ `realStartServiceLocked` çš„è°ƒç”¨åºåˆ—ï¼š\n  \n  <img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210410224824.png\" alt=\"image-20210410224824691\" style=\"zoom:50%;\" />\n  \n  ä¹Ÿå°±æ˜¯åˆå›åˆ°äº†æˆ‘ä»¬çš„ `bindServiceLocked` æ–¹æ³•ï¼Œå…¶ä¸­æœ‰ä¸€æ®µé€»è¾‘æ˜¯ï¼Œå¦‚æœéœ€è¦åˆ›å»ºæœåŠ¡ï¼Œå°±æ‰§è¡Œ `bringUpServiceLocked` æ–¹æ³•ã€‚\n  \n  â€‹```java\n  // com.android.server.am.ActiveServices#bindServiceLocked   \n  int bindServiceLocked(IApplicationThread caller, IBinder token, Intent service,\n              String resolvedType, final IServiceConnection connection, int flags,\n              String instanceName, String callingPackage, final int userId)\n              throws TransactionTooLargeException {   \n          // ... \n  \t\t\tif ((flags&Context.BIND_AUTO_CREATE) != 0) {\n                  s.lastActivity = SystemClock.uptimeMillis();\n                  if (bringUpServiceLocked(s, service.getFlags(), callerFg, false,\n                          permissionsReviewRequired) != null) {\n                      return 0;\n                  }\n              }\n          // ... \n      }\n  â€‹```\n  \n  ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ç»‘å®šæœåŠ¡çš„æ—¶å€™ï¼Œå¦‚æœæœåŠ¡æ²¡æœ‰åˆ›å»ºï¼Œå°±å…ˆä½¿ç”¨`bringUpServiceLocked`-`realStartServiceLocked` è¿›è¡Œåˆ›å»ºï¼Œåˆ›å»ºè¿‡ç¨‹ä¸­ä¼šå°†ServiceRecordä¸­çš„appèµ‹å€¼ï¼Œç„¶åå­˜å‚¨èµ·æ¥ï¼›\n  \n  > æç¤ºï¼šæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹IDEAæ“ä½œæ¥æŸ¥æ‰¾èµ‹å€¼æ“ä½œ\n  >\n  > 1. é€‰ä¸­æˆå‘˜ï¼ˆè¿™é‡Œæ˜¯ appï¼‰ï¼›\n  >\n  > 2. ==Ctrl+B== æˆ–è€… ==Command+é¼ æ ‡å•å‡»==ï¼Œå¼¹å‡ºä½¿ç”¨åˆ—è¡¨å¼¹çª—ï¼›\n  >\n  > 3. ç„¶ååœ¨å¼¹çª—ä¸­è®¾ç½®ä»…æŸ¥çœ‹writeè®¿é—®æ“ä½œçš„ï¼›ç„¶åæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„èµ‹å€¼ä»£ç è¡Œï¼›\n  >\n  >    <img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210410223230.png\" alt=\"image-20210410223230694\" style=\"zoom:50%;\" />\n  >\n  > 4. é€šè¿‡å‹¾é€‰å…¶ä¸­çš„æ–¹æ³•å›¾æ ‡ï¼Œæˆ‘ä»¬å¯ä»¥æ˜¾ç¤ºèµ‹å€¼çš„ä»£ç è¡Œæ‰€åœ¨çš„æ–¹æ³•ï¼ˆè¿™é‡Œæ˜¯setProcessï¼‰ï¼›\n  >\n  >    <img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210410223820.png\" alt=\"image-20210410223820657\" style=\"zoom:50%;\" />\n  >\n  > 5. ç„¶åæˆ‘ä»¬ç»§ç»­åœ¨æ–¹æ³•ä¸Šæ‰§è¡Œä¸Šè¿°æ“ä½œï¼Œå¯ä»¥è·å–åˆ°æ›´åŠ ä¸Šä¸€æ­¥çš„èµ‹å€¼è°ƒç”¨åœ¨å“ªï¼›\n  >\n  >    <img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210410224023.png\" alt=\"image-20210410224023641\" style=\"zoom:50%;\" />\n  \n  ### æœåŠ¡å¦‚ä½•ç»‘å®šï¼ŸæœåŠ¡å¦‚ä½•å¯åŠ¨ï¼Ÿè¿›ç¨‹å¦‚ä½•å¯åŠ¨ï¼Ÿ\n  \n  1. **bringUpServiceLocked(ServiceRecord r,...)** ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºServiceRecordï¼Œå…¶ä¸­çš„appå±æ€§å¯å­˜å‚¨ä¸€ä¸ªè¿›ç¨‹è®°å½•ï¼› \n  2. å¦‚ä¼ å…¥çš„ServiceRecordå‚æ•°ä¸­è¡¨æ˜æœåŠ¡å·²ç»å¯åŠ¨è¿‡ï¼Œ`r.app(ProcessRecord)` ä¸ä¸ºnullï¼Œä¸”`r.app.thread(IApplicationThread)`ä¹Ÿä¸ä¸ºnullï¼Œåˆ™ä¸åˆ›å»ºï¼Œç›´æ¥æ›´æ–°å‚æ•°ï¼›\n  3. ç»“ä¸‹æ¥ï¼Œåˆ™åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼Œ1ï¼‰æœåŠ¡ä¸ºå£°æ˜å•ç‹¬çš„è¿›ç¨‹ï¼Œåˆ™å¯ç›´æ¥åœ¨å½“å‰è¿›ç¨‹ä¸­å¯åŠ¨ï¼›2ï¼‰æœåŠ¡å£°æ˜äº†å•ç‹¬çš„è¿›ç¨‹ï¼Œåˆ™éœ€è¦å…ˆå¯åŠ¨è¿›ç¨‹ï¼Œç„¶åå†å¯åŠ¨æœåŠ¡ï¼›\n  4. **éå•ç‹¬è¿›ç¨‹**ï¼š\n     * è¿›ç¨‹è®°å½•è·å–ï¼šé€šè¿‡AMSç›´æ¥æŸ¥è¯¢ï¼Œå¹¶æœªåˆ›å»ºï¼Œå› ä¸ºè¿›ç¨‹å·²ç»å­˜åœ¨äº†ï¼Œå…·ä½“ä»£ç ä¸º `app = mAm.getProcessRecordLocked(procName, r.appInfo.uid, false)`\n     * æœåŠ¡å¯åŠ¨ï¼šä½¿ç”¨ `realStartServiceLocked(r, app, execInFg);` æ–¹æ³•å¯åŠ¨\n  5. **å•ç‹¬è¿›ç¨‹**ï¼š\n     * è¿›ç¨‹è®°å½•è·å–ï¼š é€šè¿‡AMS.mAm.startProcessLocked æ–¹æ³•å¯åŠ¨ä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼› \n       * `app=mAm.startProcessLocked(procName, r.appInfo, true, intentFlags,\n                             hostingRecord, ZYGOTE_POLICY_FLAG_EMPTY, false, isolated, false)`\n     * æœåŠ¡å¯åŠ¨ï¼šæœªåœ¨æ­¤æ–¹æ³•ä¸­ç›´æ¥è°ƒç”¨ `realStartServiceLocked`\n  \n  è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨**å•ç‹¬è¿›ç¨‹**çš„æœåŠ¡å¯åŠ¨æµç¨‹ä¸­ï¼Œå¹¶æ²¡æœ‰å³æ—¶è°ƒç”¨`realStartServiceLocked`æ¥å¯åŠ¨æœåŠ¡ï¼Œé‚£ä¹ˆè¿™é‡Œå°±åˆä¸ªé—®é¢˜ï¼Œç‹¬ç«‹è¿›ç¨‹æƒ…å†µä¸‹æœåŠ¡ä½•æ—¶å¯åŠ¨ï¼Ÿ\n  \n  6. **å•ç‹¬è¿›ç¨‹æœåŠ¡å¯åŠ¨ï¼š** å°†å¾…å¯åŠ¨çš„æœåŠ¡åŠ å…¥åˆ°`mPendingServices(ArrayList<ServiceRecord>)`ï¼Œåœ¨å¯åŠ¨è¿›ç¨‹åå†ä»æ­¤åˆ—è¡¨ä¸­è¯»å–éœ€è¦å¯åŠ¨çš„æœåŠ¡ï¼Œç„¶åå¯åŠ¨ï¼›\n  \n  \n  \n  **æ€»ç»“ï¼š** \n  \n  1. è¿›ç¨‹è®°å½•å¦‚ä½•è·å–ï¼Ÿ\n  \n     * é€šè¿‡AMSçš„ `startProcessLocked` æ–¹æ³•åˆ›å»ºï¼ˆéç‹¬ç«‹è¿›ç¨‹çš„ä¹Ÿåº”è¯¥æ˜¯é€šè¿‡æ­¤æ–¹æ³•åˆ›å»ºï¼Œåªæ˜¯åˆ›å»ºæ—¶æœºä¸æ˜¯è¿™é‡Œï¼‰\n  \n  2. æœåŠ¡å¦‚ä½•å¯åŠ¨ï¼Ÿ\n  \n     * é€šè¿‡ `realStartServiceLocked` æ–¹æ³•å¯åŠ¨ï¼ˆç‹¬ç«‹è¿›ç¨‹çš„åº”è¯¥ä¹Ÿæ˜¯æ­¤æ–¹æ³•å¯åŠ¨ï¼Œä¼šç­‰åˆ°è¿›ç¨‹å¯åŠ¨ä¹‹åå†å¯åŠ¨ï¼‰\n  \n     * > `realStartServiceLocked` ä¸­é€šè¿‡ `IApplicationThread` æ‰§è¡Œ `scheduleCreateService` æ¥å¯åŠ¨æœåŠ¡ï¼Œæœ€ç»ˆè°ƒç”¨ `android.app.ActivityThread.ApplicationThread#scheduleCreateService`æ¥å¯åŠ¨ï¼›\n  \n  ### è¿›ç¨‹åˆ›å»º\n  \n  > é—®é¢˜ï¼š\n  >\n  > 1. è¿›ç¨‹ä½•æ—¶åˆ›å»ºï¼Ÿ- å·²è§£å†³\n  > 2. ApplicationThreadï¼ˆä»£ç†ï¼‰å¯¹è±¡ä½•æ—¶è®¾ç½®åˆ°ProcessRecordä¸­? - å·²è§£å†³\n  > 3. ActivityThread#mainçš„å…¥å£ç‚¹ä¸­ï¼Œå¦‚ä½•è·å–ä¹‹å‰çš„ç»“æœï¼Ÿ - å·²è§£å†³\n  \n  ä¸‹é¢ä¸ºåˆ›å»ºè¿›ç¨‹çš„è°ƒç”¨åºåˆ—ï¼Œæ³¨æ„å¦‚ä¸‹åºåˆ—ä¸­åªæ˜¯åˆ›å»ºäº†ä¸€ä¸ªProcessRecordçš„å¯¹è±¡ï¼Œå¯¹åº”äºLinuxä¸Šçš„è¿›ç¨‹åˆ›å»ºæˆ‘ä»¬å†èµ·æ–‡ç« è¿›è¡Œåˆ†æï¼Œå¯¹äºæˆ‘ä»¬çš„Serviceæ¥è¯´ï¼Œæ‹¿åˆ°ProcessRecordå¯¹è±¡å³å¯ä¾›æˆ‘ä»¬æ¥åˆ›å»ºæœåŠ¡ï¼›\n  \n  \n  <svg width=\"684px\" height=\"748px\" viewBox=\"0 0 684 748\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n      <g id=\"Androidæºç åˆ†æ\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n          <g id=\"bindServiceæµç¨‹åˆ†æ-åŠ å…¥å¯åŠ¨æµç¨‹\" transform=\"translate(-923.000000, -331.000000)\">\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-25\" transform=\"translate(925.000000, 417.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"13.8711791\" y=\"14\">ActivityManagerService#startProcessLocked</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"44.0851371\" y=\"30.122449\">com/android/server/am/ActivityManagerService.java</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-37\" transform=\"translate(1254.000000, 417.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"13.8711791\" y=\"14\">ActivityManagerService#startProcessLocked</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"37.0705764\" y=\"30.122449\">startProcessLocked(hostingRecord, entryPoint) å¸¦å…¥å£ç‚¹</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-38\" transform=\"translate(1232.000000, 473.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"173.816901\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"11.1847185\" y=\"14\">ProcessList#startProcess</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"14.2951452\" y=\"30.122449\">å¸¦å…¥å£ç±» android.app.ActivityThread</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-49\" transform=\"translate(1423.000000, 473.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"182.859155\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"2.72977831\" y=\"14\">handleProcessStartedLocked</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"29.1292427\" y=\"30.122449\">è®°å½•ProcessRecordï¼ˆé€šè¿‡PIDï¼‰</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-39\" transform=\"translate(1254.000000, 529.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"22.2538402\" y=\"14\">android.os.ZygoteProcess#startViaZygote</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"76.586225\" y=\"30.122449\">å¸¦å…¥å£ç±» android.app.ActivityThread</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-40\" transform=\"translate(1254.000000, 585.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"11.0871121\" y=\"14\">ZygoteProcess#zygoteSendArgsAndGetResult</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"76.586225\" y=\"30.122449\">å¸¦å…¥å£ç±» android.app.ActivityThread</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-41\" transform=\"translate(1254.000000, 647.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFED99\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"129.589673\" y=\"14\">zygote</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"110.270911\" y=\"30.122449\">zygoteåˆ›å»ºæ–°çš„è¿›ç¨‹</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-42\" transform=\"translate(1254.000000, 703.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"80.8715473\" y=\"14\">ActivityThread#main()</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"101.306895\" y=\"30.122449\">è¿›ç¨‹åˆ›å»ºåæ‰§è¡Œå…¥å£å‡½æ•°</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-44\" transform=\"translate(1254.000000, 758.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"81.6756979\" y=\"14\">ActivityThread#attach</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"134.190911\" y=\"30.122449\">module</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-26\" transform=\"translate(925.000000, 477.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"46.9144594\" y=\"14\">ProcessList#startProcessLocked()</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"67.9050534\" y=\"30.122449\">com/android/server/am/ProcessList.java</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-11\" transform=\"translate(923.000000, 532.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"31.8488192\" y=\"14\">ProcessList#newProcessRecordLocked</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"67.9050534\" y=\"30.122449\">com/android/server/am/ProcessList.java</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-27\" transform=\"translate(923.000000, 582.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"31.8488192\" y=\"14\">ProcessList#newProcessRecordLocked</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"69.8066434\" y=\"30.122449\">new ProcessRecord(ams, info, proc, uid)</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-9\" transform=\"translate(923.000000, 368.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"32.543313\" y=\"14\">ActiveServices#bringUpServiceLocked</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"62.0131706\" y=\"30.122449\">com/android/server/am/ActiveServices.java</tspan>\n                  </text>\n              </g>\n              <path id=\"ç›´çº¿-7å¤‡ä»½\" d=\"M1073.93515,400.012222 L1073.935,408.997 L1077.67573,408.997076 L1073.5,416.997076 L1069.32427,408.997076 L1073.064,408.997 L1073.06485,400.012222 L1073.93515,400.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-8å¤‡ä»½\" d=\"M1073.93515,449.998187 L1073.935,468.011 L1077.67573,468.011111 L1073.5,476.011111 L1069.32427,468.011111 L1073.064,468.011 L1073.06485,449.998187 L1073.93515,449.998187 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-9å¤‡ä»½\" d=\"M1073.93515,508.990779 L1073.935,524.018 L1077.67573,524.018519 L1073.5,532.018519 L1069.32427,524.018519 L1073.064,524.018 L1073.06485,508.990779 L1073.93515,508.990779 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-10å¤‡ä»½\" d=\"M1073.93515,565.012222 L1073.935,573.997 L1077.67573,573.997076 L1073.5,581.997076 L1069.32427,573.997076 L1073.064,573.997 L1073.06485,565.012222 L1073.93515,565.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <text id=\"åˆ›å»ºè¿›ç¨‹\" font-family=\"NotoSansCJKsc-Black, Noto Sans CJK SC\" font-size=\"18.2\" font-weight=\"800\" letter-spacing=\"0.200199999\" fill=\"#020202\" fill-opacity=\"0.88378138\">\n                  <tspan x=\"1223.1996\" y=\"347\">åˆ›å»ºè¿›ç¨‹</tspan>\n              </text>\n              <line x1=\"1222.66\" y1=\"434.5\" x2=\"1254.34\" y2=\"434.5\" id=\"ç›´çº¿-23\" stroke=\"#979797\" stroke-width=\"1.3\" stroke-linecap=\"square\"></line>\n              <path id=\"ç›´çº¿-13\" d=\"M1353.15,450.007895 L1353.15,463.953 L1357.75,463.953216 L1352.5,474.953216 L1347.25,463.953216 L1351.85,463.953 L1351.85,450.007895 L1353.15,450.007895 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-14\" d=\"M1372.15,505.988889 L1372.15,517.972 L1376.75,517.972222 L1371.5,528.972222 L1366.25,517.972222 L1370.85,517.972 L1370.85,505.988889 L1372.15,505.988889 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-14å¤‡ä»½\" d=\"M1505.15,449.988889 L1505.15,461.972 L1509.75,461.972222 L1504.5,472.972222 L1499.25,461.972222 L1503.85,461.972 L1503.85,449.988889 L1505.15,449.988889 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-15\" d=\"M1403.15,562.988889 L1403.15,574.972 L1407.75,574.972222 L1402.5,585.972222 L1397.25,574.972222 L1401.85,574.972 L1401.85,562.988889 L1403.15,562.988889 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-24\" d=\"M1403.15,619.002174 L1403.15,637.958 L1407.75,637.958937 L1402.5,648.958937 L1397.25,637.958937 L1401.85,637.958 L1401.85,619.002174 L1403.15,619.002174 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <text id=\"socket\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"10.4\" font-weight=\"300\" letter-spacing=\"0.114399999\" fill=\"#020202\" fill-opacity=\"0.88378138\">\n                  <tspan x=\"1406.4208\" y=\"634\">socket</tspan>\n              </text>\n              <path id=\"ç›´çº¿-25\" d=\"M1403.15,680.988889 L1403.15,692.972 L1407.75,692.972222 L1402.5,703.972222 L1397.25,692.972222 L1401.85,692.972 L1401.85,680.988889 L1403.15,680.988889 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <line x1=\"1572.5\" y1=\"503.649733\" x2=\"1572.5\" y2=\"988.350267\" id=\"ç›´çº¿-26\" stroke=\"#979797\" stroke-width=\"1.3\" stroke-linecap=\"square\" stroke-dasharray=\"3.9\"></line>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-45\" transform=\"translate(1254.000000, 816.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"39.6222753\" y=\"14\">IActivityManager#attachApplication</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"134.190911\" y=\"30.122449\">module</tspan>\n                  </text>\n              </g>\n              <path id=\"ç›´çº¿-27\" d=\"M1403.15,735.988889 L1403.15,747.972 L1407.75,747.972222 L1402.5,758.972222 L1397.25,747.972222 L1401.85,747.972 L1401.85,735.988889 L1403.15,735.988889 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-28\" d=\"M1403.15,792 L1403.15,806.961 L1407.75,806.961111 L1402.5,817.961111 L1397.25,806.961111 L1401.85,806.961 L1401.85,792 L1403.15,792 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-46\" transform=\"translate(1254.000000, 929.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"19.2199992\" y=\"14\">ActivityManagerService#attachApplication</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"134.190911\" y=\"30.122449\">module</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-47\" transform=\"translate(1218.000000, 989.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"368.7277\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"32.5625946\" y=\"14\">ActivityManagerService#attachApplicationLocked</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"113.952385\" y=\"30.122449\">è·å–ä¹‹å‰ç¼“å­˜çš„ProcessRecord(app)</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-50\" transform=\"translate(1218.000000, 1045.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"368.7277\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"100.665624\" y=\"14\">ProcessRecord#makeActive</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"67.8834312\" y=\"30.122449\">app.makeActive(thread, mProcessStats) ; thread = _thread;</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-36\" transform=\"translate(1254.000000, 870.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFED99\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"124.320049\" y=\"14\">transact</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"136.553756\" y=\"30.122449\">binder</tspan>\n                  </text>\n              </g>\n              <path id=\"ç›´çº¿-29\" d=\"M1403.15,848.997059 L1403.15,859.964 L1407.75,859.964052 L1402.5,870.964052 L1397.25,859.964052 L1401.85,859.964 L1401.85,848.997059 L1403.15,848.997059 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-30\" d=\"M1403.15,902.992857 L1403.15,918.968 L1407.75,918.968254 L1402.5,929.968254 L1397.25,918.968254 L1401.85,918.968 L1401.85,902.992857 L1403.15,902.992857 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-31\" d=\"M1403.15,962.992857 L1403.15,978.968 L1407.75,978.968254 L1402.5,989.968254 L1397.25,978.968254 L1401.85,978.968 L1401.85,962.992857 L1403.15,962.992857 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-32\" d=\"M1403.15,1022.98889 L1403.15,1034.972 L1407.75,1034.97222 L1402.5,1045.97222 L1397.25,1034.97222 L1401.85,1034.972 L1401.85,1022.98889 L1403.15,1022.98889 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n          </g>\n      </g>\n  </svg>\n  \n  \n  \n  * è¿›ç¨‹åˆ›å»ºçš„æ‰§è¡Œä½äºAMSæ‰€åœ¨çš„ç³»ç»Ÿè¿›ç¨‹ä¹‹ä¸­ï¼›\n  * ï¼ˆAMSè¿›ç¨‹ï¼‰é¦–å…ˆï¼Œæ„å»ºä¸€ä¸ªProcessRecordè®°å½•ï¼Œå¹¶å°†å…¶è®°å½•åˆ°AMSä¸­ï¼›\n  * ï¼ˆAMSè¿›ç¨‹ï¼‰AMSé€šè¿‡socketé€šä¿¡ï¼Œé€šçŸ¥zygoteæ¥åˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼ŒåŒæ—¶æŒ‡å®šå…¥å£ç‚¹ä¸º `android.app.ActivityThread` ;\n  * ï¼ˆAPPè¿›ç¨‹ï¼‰æ–°çš„è¿›ç¨‹å¯åŠ¨åï¼Œæ‰§è¡ŒActivityThreadä¸­çš„æ–¹æ³•ï¼Œé€šçŸ¥AMSæ¥æ‰§è¡ŒattachApplicationï¼›\n  * ï¼ˆAMSè¿›ç¨‹ï¼‰AMSä¸­ï¼Œé€šè¿‡PIDè·å–ä¹‹å‰å­˜å‚¨çš„ProcessRecordï¼Œç„¶åå°†ApplicationThreadï¼ˆä»£ç†å¯¹è±¡ï¼‰èµ‹å€¼ç»™ProcessRecordçš„æˆå‘˜å˜é‡threadï¼›\n  * æ”¯æŒå®Œæˆäº†å…³è”ï¼›\n  \n  #### æ„é€ ProcessRecordå®ä¾‹\n  \n  `com.android.server.am.ProcessList#startProcessLocked`ï¼Œç®€åŒ–ä¸‹æ¥å°±ä¸¤å¥ï¼š\n  \n  * æ„é€ ProcessRecordå¯¹è±¡ï¼š `app = newProcessRecordLocked(info, processName, isolated, isolatedUid, hostingRecord)`\n  * å¯åŠ¨è¿›ç¨‹ï¼š`startProcessLocked(app, hostingRecord, zygotePolicyFlags, abiOverride)`\n  \n  â€‹```java\n  // com.android.server.am.ProcessList#newProcessRecordLocked\n  // frameworks/base/services/core/java/com/android/server/am/ProcessList.java\n  final ProcessRecord startProcessLocked(String processName, ApplicationInfo info,\n              boolean knownToBeDead, int intentFlags, HostingRecord hostingRecord,\n              int zygotePolicyFlags, boolean allowWhileBooting, boolean isolated, int isolatedUid,\n              boolean keepIfLarge, String abiOverride, String entryPoint, String[] entryPointArgs,\n              Runnable crashHandler) {\n          long startTime = SystemClock.uptimeMillis();\n          ProcessRecord app;\n          if (app == null) {\n              // æ„é€ ProcessRecordå¯¹è±¡\n              app = newProcessRecordLocked(info, processName, isolated, isolatedUid, hostingRecord);\n              app.crashHandler = crashHandler;\n              app.isolatedEntryPoint = entryPoint;\n              app.isolatedEntryPointArgs = entryPointArgs;\n          } else {\n              // If this is a new package in the process, add the package to the list\n              app.addPackage(info.packageName, info.longVersionCode, mService.mProcessStats);\n          }\n  \t    // å¯åŠ¨è¿›ç¨‹\n          final boolean success =\n                  startProcessLocked(app, hostingRecord, zygotePolicyFlags, abiOverride);\n          checkSlow(startTime, \"startProcess: done starting proc!\");\n          return success ? app : null;\n      }\n  â€‹```\n  \n  #### å¯åŠ¨è¿›ç¨‹ \n  \n  `startProcessLocked`: å¯åŠ¨äº†ä¸€ä¸ªè¿›ç¨‹ï¼Œå¹¶æŒ‡å®šäº†å…¥å£ç‚¹ä¸º ==android.app.ActivityThread==ï¼Œä¹Ÿå°±æ˜¯è¿›ç¨‹å¯åŠ¨åå°†ä¼šæ‰§è¡Œ ==android.app.ActivityThread==çš„mainæ–¹æ³•ã€‚\n  \n  â€‹```java\n  // frameworks/base/services/core/java/com/android/server/am/ProcessList.java\n  // com.android.server.am.ProcessList#startProcessLocked(com.android.server.am.ProcessRecord, com.android.server.am.HostingRecord, int, boolean, boolean, boolean, java.lang.String)\n  boolean startProcessLocked(ProcessRecord app, HostingRecord hostingRecord,\n              int zygotePolicyFlags, boolean disableHiddenApiChecks, boolean disableTestApiChecks,\n              boolean mountExtStorageFull, String abiOverride) {\n          if (app.pendingStart) {\n              return true;\n          }\n          long startTime = SystemClock.uptimeMillis();\n          try {\n              try {\n                  final int userId = UserHandle.getUserId(app.uid);\n                  AppGlobals.getPackageManager().checkPackageStartable(app.info.packageName, userId);\n              } catch (RemoteException e) {\n                  throw e.rethrowAsRuntimeException();\n              }\n  \n              int uid = app.uid;\n              int[] gids = null;\n              // ... \n              \n              app.mountMode = mountExternal;\n              app.gids = gids;\n              app.setRequiredAbi(requiredAbi);\n              app.instructionSet = instructionSet;\n  \n              final String seInfo = app.info.seInfo\n                      + (TextUtils.isEmpty(app.info.seInfoUser) ? \"\" : app.info.seInfoUser);\n              // Start the process.  It will either succeed and return a result containing\n              // the PID of the new process, or else throw a RuntimeException.\n              // æŒ‡å®šå…¥å£ç‚¹ä¸ºActivityThreadï¼Œå¯åŠ¨è¿›ç¨‹\n              final String entryPoint = \"android.app.ActivityThread\";\n              return startProcessLocked(hostingRecord, entryPoint, app, uid, gids,\n                      runtimeFlags, zygotePolicyFlags, mountExternal, seInfo, requiredAbi,\n                      instructionSet, invokeWith, startTime);\n          } catch (RuntimeException e) {\n              return false;\n          }\n      }\n  \n  \n  boolean startProcessLocked(HostingRecord hostingRecord, String entryPoint, ProcessRecord app,\n              int uid, int[] gids, int runtimeFlags, int zygotePolicyFlags, int mountExternal,\n              String seInfo, String requiredAbi, String instructionSet, String invokeWith,\n              long startTime) {\n          app.pendingStart = true;\n          app.killedByAm = false;\n          app.removed = false;\n          app.killed = false;\n          final long startSeq = app.startSeq = ++mProcStartSeqCounter;\n          app.setStartParams(uid, hostingRecord, seInfo, startTime);\n          app.setUsingWrapper(invokeWith != null\n                  || Zygote.getWrapProperty(app.processName) != null);\n          mPendingStarts.put(startSeq, app);\n  \n          if (mService.mConstants.FLAG_PROCESS_START_ASYNC) {\n              return true;\n          } else {\n              try {\n                  // å¯åŠ¨è¿›ç¨‹ï¼Œå¹¶ä¼ å…¥entrypoint\n                  final Process.ProcessStartResult startResult = startProcess(hostingRecord,\n                          entryPoint, app,\n                          uid, gids, runtimeFlags, zygotePolicyFlags, mountExternal, seInfo,\n                          requiredAbi, instructionSet, invokeWith, startTime);\n                  // åšå¯åŠ¨åçš„æ“ä½œ\n                  handleProcessStartedLocked(app, startResult.pid, startResult.usingWrapper,\n                          startSeq, false);\n              } catch (RuntimeException e) {\n                  \n              }\n              return app.pid > 0;\n          }\n      }\n  â€‹```\n  \n  è¿™é‡Œæˆ‘ä»¬çœç•¥å…¶ä»–æ›´åŠ åº•å±‚çš„æ­¥éª¤çš„åˆ†æï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“åˆ°äº†è¿™é‡Œä¹‹åï¼Œä¼šå¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ï¼Œè¿›ç¨‹å¯åŠ¨åä¼šæ‰§è¡Œ ==android.app.ActivityThread#main== æ–¹æ³•ï¼›\n  \n  #### è®°å½•è¿›ç¨‹è®°å½•åˆ°AMS\n  \n  `ProcessList#handleProcessStartedLocked(com.android.server.am.ProcessRecord, int, boolean, long, boolean)`\n  \n  ==è¿™ä¸ªåœ°æ–¹æœ‰ä¸ªå…³é”®çš„ä»£ç å°†ä¹‹å‰åˆ›å»ºçš„è¿›ç¨‹è®°å½•å­˜å‚¨åˆ°äº†AMSçš„è¿›ç¨‹è®°å½•è¡¨ä¸­ã€‚==\n  \n  â€‹```java\n  // com.android.server.am.ProcessList#handleProcessStartedLocked(com.android.server.am.ProcessRecord, int, boolean, long, boolean)\n  // frameworks/base/services/core/java/com/android/server/am/ProcessList.java\n  ActivityManagerService mService = null;\n  boolean handleProcessStartedLocked(ProcessRecord app, int pid, boolean usingWrapper,\n              long expectedStartSeq, boolean procAttached) {\n      // å°†ProcessRecord å­˜å‚¨åˆ°AMSä¸­\n      mService.addPidLocked(app);\n  }\n    \n  // frameworks/base/services/core/java/com/android/server/am/ActivityManagerService.java\n  void addPidLocked(ProcessRecord app) {\n      synchronized (mPidsSelfLocked) {\n          // å°†è¿›ç¨‹è®°å½•æ·»åŠ åˆ°ä¸€ä¸ªè®°å½•è¡¨ä¸­\n          mPidsSelfLocked.doAddInternal(app);\n      }\n      synchronized (sActiveProcessInfoSelfLocked) {\n          if (app.processInfo != null) {\n              sActiveProcessInfoSelfLocked.put(app.pid, app.processInfo);\n          } else {\n              sActiveProcessInfoSelfLocked.remove(app.pid);\n          }\n      }\n      mAtmInternal.onProcessMapped(app.pid, app.getWindowProcessController());\n  }\n  â€‹```\n  â€‹```java\n  // å®Œæ•´ä»£ç \n  // com.android.server.am.ProcessList#handleProcessStartedLocked(com.android.server.am.ProcessRecord, int, boolean, long, boolean)\n  // frameworks/base/services/core/java/com/android/server/am/ProcessList.java\n  boolean handleProcessStartedLocked(ProcessRecord app, int pid, boolean usingWrapper,\n              long expectedStartSeq, boolean procAttached) {\n          mPendingStarts.remove(expectedStartSeq);\n          final String reason = isProcStartValidLocked(app, expectedStartSeq);\n          if (reason != null) {\n              Slog.w(TAG_PROCESSES, app + \" start not valid, killing pid=\" +\n                      pid\n                      + \", \" + reason);\n              app.pendingStart = false;\n              killProcessQuiet(pid);\n              Process.killProcessGroup(app.uid, app.pid);\n              noteAppKill(app, ApplicationExitInfo.REASON_OTHER,\n                      ApplicationExitInfo.SUBREASON_INVALID_START, reason);\n              return false;\n          }\n          mService.mBatteryStatsService.noteProcessStart(app.processName, app.info.uid);\n          checkSlow(app.startTime, \"startProcess: done updating battery stats\");\n  \n          EventLog.writeEvent(EventLogTags.AM_PROC_START,\n                  UserHandle.getUserId(app.startUid), pid, app.startUid,\n                  app.processName, app.hostingRecord.getType(),\n                  app.hostingRecord.getName() != null ? app.hostingRecord.getName() : \"\");\n  \n          try {\n              AppGlobals.getPackageManager().logAppProcessStartIfNeeded(app.processName, app.uid,\n                      app.seInfo, app.info.sourceDir, pid);\n          } catch (RemoteException ex) {\n              // Ignore\n          }\n  \n          Watchdog.getInstance().processStarted(app.processName, pid);\n  \n          checkSlow(app.startTime, \"startProcess: building log message\");\n          StringBuilder buf = mStringBuilder;\n          buf.setLength(0);\n          buf.append(\"Start proc \");\n          buf.append(pid);\n          buf.append(':');\n          buf.append(app.processName);\n          buf.append('/');\n          UserHandle.formatUid(buf, app.startUid);\n          if (app.isolatedEntryPoint != null) {\n              buf.append(\" [\");\n              buf.append(app.isolatedEntryPoint);\n              buf.append(\"]\");\n          }\n          buf.append(\" for \");\n          buf.append(app.hostingRecord.getType());\n          if (app.hostingRecord.getName() != null) {\n              buf.append(\" \");\n              buf.append(app.hostingRecord.getName());\n          }\n          mService.reportUidInfoMessageLocked(TAG, buf.toString(), app.startUid);\n          app.setPid(pid);\n          app.setUsingWrapper(usingWrapper);\n          app.pendingStart = false;\n          checkSlow(app.startTime, \"startProcess: starting to update pids map\");\n          ProcessRecord oldApp;\n          synchronized (mService.mPidsSelfLocked) {\n              oldApp = mService.mPidsSelfLocked.get(pid);\n          }\n          // If there is already an app occupying that pid that hasn't been cleaned up\n          if (oldApp != null && !app.isolated) {\n              // Clean up anything relating to this pid first\n              Slog.wtf(TAG, \"handleProcessStartedLocked process:\" + app.processName\n                      + \" startSeq:\" + app.startSeq\n                      + \" pid:\" + pid\n                      + \" belongs to another existing app:\" + oldApp.processName\n                      + \" startSeq:\" + oldApp.startSeq);\n              mService.cleanUpApplicationRecordLocked(oldApp, false, false, -1,\n                      true /*replacingPid*/);\n          }\n      // æ³¨æ„è¿™é‡Œ \n          mService.addPidLocked(app);\n          synchronized (mService.mPidsSelfLocked) {\n              if (!procAttached) {\n                  Message msg = mService.mHandler.obtainMessage(PROC_START_TIMEOUT_MSG);\n                  msg.obj = app;\n                  mService.mHandler.sendMessageDelayed(msg, usingWrapper\n                          ? PROC_START_TIMEOUT_WITH_WRAPPER : PROC_START_TIMEOUT);\n              }\n          }\n          checkSlow(app.startTime, \"startProcess: done updating pids map\");\n          return true;\n      }\n  â€‹```\n  \n  #### å†™å…¥threadå€¼åˆ°ProcessRecord\n  \n  ä»ä¸Šé¢çš„æµç¨‹ä¸­ï¼Œæˆ‘ä»¬å‘ç°æ„é€ å‡ºæ¥çš„ProcessRecordçš„threadï¼ˆApplicationThreadï¼‰æˆå‘˜å˜é‡è¿˜æ˜¯æ²¡æœ‰è¢«èµ‹å€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªthreadä½•æ—¶è¢«èµ‹å€¼å‘¢ï¼Ÿ\n  \n  > æŸ¥æ‰¾`ProcessRecord`ä¸­`thread`èµ‹å€¼çš„å…¥å£ï¼š\n  >\n  > 1. é€šè¿‡æŸ¥æ‰¾`thread`æˆå‘˜çš„èµ‹å€¼å†™å…¥æ–¹æ³•ï¼Œå¯ä»¥ç¡®å®šèµ·å§‹ç‚¹æ˜¯ï¼Œ`com.android.server.am.ProcessRecord#makeActive` ï¼Œæ¥ä¸‹æ¥æŸ¥çœ‹è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„åˆ—è¡¨ï¼š\n  > 2. ![image-20210411172323572](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210411172323.png)\n  >\n  > 3. è¿™é‡Œæˆ‘ä»¬æ˜¾ç„¶é€‰æ‹© `com.android.server.am.ActivityManagerService#attachApplicationLocked`\n  >\n  > 4. `android.app.ActivityThread#attach`\n  >\n  > 5. è¿™é‡Œæˆ‘ä»¬é‡åˆ°ä¸¤ä¸ªé€‰æ‹©ï¼š\n  >\n  >    <img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210411172524.png\" alt=\"image-20210411172524831\" style=\"zoom:50%;\" />\n  >\n  > 6. æ˜¾ç„¶ï¼Œåº”è¯¥é€‰æ‹©ç¬¬äºŒä¸ªï¼š`android.app.ActivityThread#main`\n  >\n  > 7. è¿™é‡Œæˆ‘ä»¬å´æ— æ³•ç›´æ¥é€šè¿‡IDEAçš„è°ƒç”¨å±‚æ¬¡åŠŸèƒ½æ‰¾åˆ°ä»»ä½•è°ƒç”¨æ–¹æ³•ï¼Œè¯´æ˜å¯èƒ½æ˜¯é€šè¿‡åå°„æ¥è°ƒç”¨çš„ï¼Œæ‰€ä»¥ç›´æ¥é€šè¿‡å…¨å±€å­—ç¬¦ä¸²æœç´¢==android.app.ActivityThread==ï¼Œå¯ä»¥æ‰¾åˆ°åœ¨ `ProcessList.startProcessLocked` ä¸­è°ƒç”¨çš„ã€‚\n  \n  é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œè¿™é‡Œæˆ‘ä»¬ä»ActivityThreadçš„mainå‡½æ•°å¼€å§‹ã€‚\n  \n  #####  ActivityThread#main\n  \n  â€‹```java\n      public static void main(String[] args) {\n          Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, \"ActivityThreadMain\");\n  \n          // Install selective syscall interception\n          AndroidOs.install();\n  \n          // CloseGuard defaults to true and can be quite spammy.  We\n          // disable it here, but selectively enable it later (via\n          // StrictMode) on debug builds, but using DropBox, not logs.\n          CloseGuard.setEnabled(false);\n  \n          Environment.initForCurrentUser();\n  \n          // Make sure TrustedCertificateStore looks in the right place for CA certificates\n          final File configDir = Environment.getUserConfigDirectory(UserHandle.myUserId());\n          TrustedCertificateStore.setDefaultUserDirectory(configDir);\n  \n          // Call per-process mainline module initialization.\n          initializeMainlineModules();\n  \n          Process.setArgV0(\"<pre-initialized>\");\n  \n          Looper.prepareMainLooper();\n  \n          // Find the value for {@link #PROC_START_SEQ_IDENT} if provided on the command line.\n          // It will be in the format \"seq=114\"\n          long startSeq = 0;\n          if (args != null) {\n              for (int i = args.length - 1; i >= 0; --i) {\n                  if (args[i] != null && args[i].startsWith(PROC_START_SEQ_IDENT)) {\n                      startSeq = Long.parseLong(\n                              args[i].substring(PROC_START_SEQ_IDENT.length()));\n                  }\n              }\n          }\n          // ç›´æ¥æ„é€ ä¸€ä¸ªActivityThreadå¯¹è±¡\n          ActivityThread thread = new ActivityThread();\n          // æ‰§è¡Œattachæ–¹æ³•\n          thread.attach(false, startSeq);\n  \n          if (sMainThreadHandler == null) {\n              sMainThreadHandler = thread.getHandler();\n          }\n  \n          if (false) {\n              Looper.myLooper().setMessageLogging(new\n                      LogPrinter(Log.DEBUG, \"ActivityThread\"));\n          }\n  \n          // End of event ActivityThreadMain.\n          Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);\n          Looper.loop();\n  \n          throw new RuntimeException(\"Main thread loop unexpectedly exited\");\n      }\n  â€‹```\n  \n  ##### ActivityThread#attach\n  \n  â€‹```java\n   private void attach(boolean system, long startSeq) {\n          sCurrentActivityThread = this;\n          mSystemThread = system;\n          if (!system) {\n              android.ddm.DdmHandleAppName.setAppName(\"<pre-initialized>\",\n                                                      UserHandle.myUserId());\n              // å°†å½“å‰ApplicationThreadçš„Binderå¯¹è±¡ä¿å­˜ä¸ºä¸€ä¸ªé™æ€æˆå‘˜\n              RuntimeInit.setApplicationObject(mAppThread.asBinder());\n              // è·å–AMS\n              final IActivityManager mgr = ActivityManager.getService();\n              try {\n                  // é€šçŸ¥AMSæ¥ attachApplication\n                  mgr.attachApplication(mAppThread, startSeq);\n              } catch (RemoteException ex) {\n                  throw ex.rethrowFromSystemServer();\n              }\n          } else {\n              \n          }\n  }\n  â€‹```\n  \n  ##### **ActivityManagerService#attachApplication** & attachApplicationLocked\n  \n  â€‹```java\n      @Override\n      public final void attachApplication(IApplicationThread thread, long startSeq) {\n          if (thread == null) {\n              throw new SecurityException(\"Invalid application interface\");\n          }\n          synchronized (this) {\n              int callingPid = Binder.getCallingPid();\n              final int callingUid = Binder.getCallingUid();\n              final long origId = Binder.clearCallingIdentity();\n              attachApplicationLocked(thread, callingPid, callingUid, startSeq);\n              Binder.restoreCallingIdentity(origId);\n          }\n      }\n  \n  â€‹```\n  ä¸Šé¢çš„æ–¹æ³•åªæ˜¯è°ƒç”¨äº† attachApplicationLockedï¼š\n  \n  ==æœ‰ä¸ªå…³é”®çš„æ­¥éª¤æ˜¯ï¼Œä» AMSçš„è¿›ç¨‹è®°å½•è¡¨ä¸­æ ¹æ®PIDå–å‡ºä¸€ä¸ª ProcessRecord: `app = mPidsSelfLocked.get(pid)`==\n  \n  â€‹```java\n  private boolean attachApplicationLocked(@NonNull IApplicationThread thread,\n              int pid, int callingUid, long startSeq) {\n          // Find the application record that is being attached...  either via\n          // the pid if we are running in multiple processes, or just pull the\n          // next app record if we are emulating process with anonymous threads.\n          ProcessRecord app;\n          long startTime = SystemClock.uptimeMillis();\n          long bindApplicationTimeMillis;\n          if (pid != MY_PID && pid >= 0) {\n              synchronized (mPidsSelfLocked) {\n                  // ä»è¿›ç¨‹è®°å½•ä¸­è·å–\n                  app = mPidsSelfLocked.get(pid);\n              }\n          }\n          // Make app active after binding application or client may be running requests (e.g\n          // starting activities) before it is ready.\n          // å…³è”threadåˆ°appï¼ˆProcessRecordï¼‰\n          app.makeActive(thread, mProcessStats);\n          return true;\n      }\n  â€‹```\n  \n  ç»è¿‡ä¸Šé¢çš„æ­¥éª¤ï¼Œå³å®Œæˆäº†ProcessRecordåˆ°è¿›ç¨‹çš„ApplicationThreadçš„å…³è”ã€‚\n  \n  ### å¯åŠ¨æœåŠ¡\n  \n  ä»AMSä¸­è°ƒç”¨ApplicationThreadçš„æ–¹æ³•æ¥åœ¨Serviceè‡ªå·±åº”è¯¥æ‰€å±çš„è¿›ç¨‹ä¸­åˆ›å»ºServiceå¯¹è±¡çš„å®ä¾‹ã€‚\n  \n  \n  <svg width=\"723px\" height=\"508px\" viewBox=\"0 0 723 508\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n      <g id=\"Androidæºç åˆ†æ\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n          <g id=\"bindServiceæµç¨‹åˆ†æ-åŠ å…¥å¯åŠ¨æµç¨‹\" transform=\"translate(-1687.000000, -331.000000)\">\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-42\" transform=\"translate(2075.000000, 429.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"80.8715473\" y=\"14\">ActivityThread#main()</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"101.306895\" y=\"30.122449\">è¿›ç¨‹åˆ›å»ºåæ‰§è¡Œå…¥å£å‡½æ•°</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-57\" transform=\"translate(2075.000000, 370.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"96.4245514\" y=\"14\">ç‹¬ç«‹è¿›ç¨‹çš„Service</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"132.102208\" y=\"30.122449\">å¯åŠ¨è¿›ç¨‹</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-53\" transform=\"translate(2075.000000, 483.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"81.6756979\" y=\"14\">ActivityThread#attach</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"148.202627\" y=\"30.122449\">-</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-28\" transform=\"translate(1688.000000, 476.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"17.7639992\" y=\"14\">IApplicationThread#scheduleCreateService</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"75.1632961\" y=\"30.122449\">android/app/IApplicationThread.java</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-36\" transform=\"translate(1688.000000, 535.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFED99\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"124.320049\" y=\"14\">transact</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"136.553756\" y=\"30.122449\">binder</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-36\" transform=\"translate(1687.000000, 750.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFED99\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"124.320049\" y=\"14\">transact</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"136.553756\" y=\"30.122449\">binder</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-30\" transform=\"translate(1687.000000, 590.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"19.8413883\" y=\"14\">ApplicationThread#scheduleCreateService</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"84.8453045\" y=\"30.122449\">android/app/ActivityThread.java</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-31\" transform=\"translate(1687.000000, 641.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"37.6728192\" y=\"14\">ActivityThread#handleCreateService</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"84.8453045\" y=\"30.122449\">android/app/ActivityThread.java</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-33\" transform=\"translate(1688.000000, 695.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"26.5913799\" y=\"14\">IActivityManager#serviceDoneExecuting</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"84.8453045\" y=\"30.122449\">android/app/ActivityThread.java</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-34\" transform=\"translate(1687.000000, 805.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"6.18910375\" y=\"14\">ActivityManagerService#serviceDoneExecuting</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"84.8453045\" y=\"30.122449\">android/app/ActivityThread.java</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-9\" transform=\"translate(1688.000000, 373.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"32.543313\" y=\"14\">ActiveServices#bringUpServiceLocked</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"62.0131706\" y=\"30.122449\">com/android/server/am/ActiveServices.java</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-43\" transform=\"translate(1687.000000, 422.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"30.4598318\" y=\"14\">ActiveServices#realStartServiceLocked</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"62.0131706\" y=\"30.122449\">com/android/server/am/ActiveServices.java</tspan>\n                  </text>\n              </g>\n              <path id=\"ç›´çº¿-7å¤‡ä»½-2\" d=\"M1837.93515,405.012222 L1837.935,413.997 L1841.67573,413.997076 L1837.5,421.997076 L1833.32427,413.997076 L1837.064,413.997 L1837.06485,405.012222 L1837.93515,405.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-8å¤‡ä»½-2\" d=\"M1836.93515,507.998187 L1836.935,526.011 L1840.67573,526.011111 L1836.5,534.011111 L1832.32427,526.011111 L1836.064,526.011 L1836.06485,507.998187 L1836.93515,507.998187 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-9å¤‡ä»½-2\" d=\"M1836.93515,567.990779 L1836.935,583.018 L1840.67573,583.018519 L1836.5,591.018519 L1832.32427,583.018519 L1836.064,583.018 L1836.06485,567.990779 L1836.93515,567.990779 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-10å¤‡ä»½-2\" d=\"M1836.93515,624.012222 L1836.935,632.997 L1840.67573,632.997076 L1836.5,640.997076 L1832.32427,632.997076 L1836.064,632.997 L1836.06485,624.012222 L1836.93515,624.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <text id=\"å¯åŠ¨æœåŠ¡\" font-family=\"NotoSansCJKsc-Black, Noto Sans CJK SC\" font-size=\"18.2\" font-weight=\"800\" letter-spacing=\"0.200199999\" fill=\"#020202\" fill-opacity=\"0.88378138\">\n                  <tspan x=\"1802.1996\" y=\"347\">å¯åŠ¨æœåŠ¡</tspan>\n              </text>\n              <path id=\"ç›´çº¿-22\" d=\"M1836.15,674.997059 L1836.15,685.964 L1840.75,685.964052 L1835.5,696.964052 L1830.25,685.964052 L1834.85,685.964 L1834.85,674.997059 L1836.15,674.997059 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-22å¤‡ä»½\" d=\"M1836.15,728.997059 L1836.15,739.964 L1840.75,739.964052 L1835.5,750.964052 L1830.25,739.964052 L1834.85,739.964 L1834.85,728.997059 L1836.15,728.997059 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-22å¤‡ä»½-2\" d=\"M1836.15,783.997059 L1836.15,794.964 L1840.75,794.964052 L1835.5,805.964052 L1830.25,794.964052 L1834.85,794.964 L1834.85,783.997059 L1836.15,783.997059 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-54\" transform=\"translate(2075.000000, 542.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"39.6222753\" y=\"14\">IActivityManager#attachApplication</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"148.202627\" y=\"30.122449\">-</tspan>\n                  </text>\n              </g>\n              <path id=\"ç›´çº¿-27å¤‡ä»½\" d=\"M2224.15,460.988889 L2224.15,472.972 L2228.75,472.972222 L2223.5,483.972222 L2218.25,472.972222 L2222.85,472.972 L2222.85,460.988889 L2224.15,460.988889 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-28å¤‡ä»½\" d=\"M2224.15,517 L2224.15,531.961 L2228.75,531.961111 L2223.5,542.961111 L2218.25,531.961111 L2222.85,531.961 L2222.85,517 L2224.15,517 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-55\" transform=\"translate(2075.000000, 655.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"19.2199992\" y=\"14\">ActivityManagerService#attachApplication</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"148.202627\" y=\"30.122449\">-</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-48\" transform=\"translate(2040.000000, 711.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"368.7277\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"32.5625946\" y=\"14\">ActivityManagerService#attachApplicationLocked</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"77.2564856\" y=\"30.122449\">è·å–ä¹‹å‰å­˜å‚¨çš„ mPendingServices - å¾…å¯åŠ¨çš„æœåŠ¡åˆ—è¡¨</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-36\" transform=\"translate(2075.000000, 595.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFED99\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"124.320049\" y=\"14\">transact</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"136.553756\" y=\"30.122449\">binder</tspan>\n                  </text>\n              </g>\n              <path id=\"ç›´çº¿-29å¤‡ä»½\" d=\"M2224.15,573.997059 L2224.15,584.964 L2228.75,584.964052 L2223.5,595.964052 L2218.25,584.964052 L2222.85,584.964 L2222.85,573.997059 L2224.15,573.997059 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-30å¤‡ä»½\" d=\"M2224.15,628.992857 L2224.15,644.968 L2228.75,644.968254 L2223.5,655.968254 L2218.25,644.968254 L2222.85,644.968 L2222.85,628.992857 L2224.15,628.992857 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-33\" d=\"M1838.15,454.997059 L1838.15,465.964 L1842.75,465.964052 L1837.5,476.964052 L1832.25,465.964052 L1836.85,465.964 L1836.85,454.997059 L1838.15,454.997059 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-34\" d=\"M2224.15,688.997059 L2224.15,699.964 L2228.75,699.964052 L2223.5,710.964052 L2218.25,699.964052 L2222.85,699.964 L2222.85,688.997059 L2224.15,688.997059 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-35\" d=\"M1996.38889,444.25 L1985.38889,439 L1996.38889,433.75 L1996.388,438.35 L2024.46863,438.35 L2024.468,727.35 L2040.65,727.35 L2040.65,728.65 L2023.16863,728.65 L2023.168,439.65 L1996.388,439.65 L1996.38889,444.25 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-36\" d=\"M2224.15,403 L2224.15,417.961 L2228.75,417.961111 L2223.5,428.961111 L2218.25,417.961111 L2222.85,417.961 L2222.85,403 L2224.15,403 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n          </g>\n      </g>\n  </svg>\n  \n  #### ActiveServices#bringUpServiceLocked\n  \n  â€‹```java\n  // com.android.server.am.ActiveServices#bringUpServiceLocked\n  // frameworks/base/services/core/java/com/android/server/am/ActiveServices.java\n  private String bringUpServiceLocked(ServiceRecord r, int intentFlags, boolean execInFg,\n              boolean whileRestarting, boolean permissionsReviewRequired)\n              throws TransactionTooLargeException {\n          // å·²ç»å­˜åœ¨è¿›ç¨‹è®°å½•ï¼Œå¹¶ä¸”è¿›ç¨‹è®°å½•ä¸­çš„IApplicationThreadå·²ç»å­˜åœ¨ï¼Œåˆ™ä¸åˆ›å»ºæœåŠ¡ï¼Œä»…å‘é€å‚æ•°\n          if (r.app != null && r.app.thread != null) {\n              sendServiceArgsLocked(r, execInFg, false);\n              return null;\n          }\n          final boolean isolated = (r.serviceInfo.flags&ServiceInfo.FLAG_ISOLATED_PROCESS) != 0;\n          final String procName = r.processName;\n          HostingRecord hostingRecord = new HostingRecord(\"service\", r.instanceName);\n          ProcessRecord app;\n  \t\t// éç‹¬ç«‹çš„è¿›ç¨‹ï¼Œåˆ™ç›´æ¥è·å–å½“å‰å¯åŠ¨è¿›ç¨‹çš„è¿›ç¨‹ä¿¡æ¯\n          if (!isolated) {\n              app = mAm.getProcessRecordLocked(procName, r.appInfo.uid, false);\n               if (app != null && app.thread != null) {\n                  try {\n                      app.addPackage(r.appInfo.packageName, r.appInfo.longVersionCode, mAm.mProcessStats);\n                      // éç‹¬ç«‹è¿›ç¨‹ä¸­ï¼Œç›´æ¥å¯åŠ¨æœåŠ¡\n                      realStartServiceLocked(r, app, execInFg);\n                      // è°ƒç”¨å¯åŠ¨æ–¹æ³•åç›´æ¥è¿”å›\n                      return null;\n                  } catch (TransactionTooLargeException e) {\n                      throw e;\n                  } catch (RemoteException e) {\n                      Slog.w(TAG, \"Exception when starting service \" + r.shortInstanceName, e);\n                  }\n  \n                  // If a dead object exception was thrown -- fall through to\n                  // restart the application.\n              }\n          } else {\n              // ç‹¬ç«‹è¿›ç¨‹åˆ™å…ˆå°è¯•ä½¿ç”¨ä¹‹å‰ä¿å­˜çš„\n              app = r.isolatedProc;\n          }\n  \n          // ä¹‹å‰æ²¡æœ‰å¯åŠ¨å¯¹åº”çš„è¿›ç¨‹ï¼Œåˆ™å¼€å§‹åˆ›å»ºï¼Œå¯åŠ¨äº†ï¼Œåˆ™æ— éœ€è¿›è¡Œèµ‹å€¼æ“ä½œï¼Œå› ä¸ºServiceRecordä¸­å·²ç»æœ‰äº†\n          if (app == null && !permissionsReviewRequired) {\n              if ((app=mAm.startProcessLocked(procName, r.appInfo, true, intentFlags,\n                      hostingRecord, ZYGOTE_POLICY_FLAG_EMPTY, false, isolated, false)) == null) {\n                  String msg = \"Unable to launch app \"\n                          + r.appInfo.packageName + \"/\"\n                          + r.appInfo.uid + \" for service \"\n                          + r.intent.getIntent() + \": process is bad\";\n                  Slog.w(TAG, msg);\n                  bringDownServiceLocked(r);\n                  // è¿›ç¨‹å¯åŠ¨å¤±è´¥ï¼Œè¿”å›é”™è¯¯æ¶ˆæ¯\n                  return msg;\n              }\n              if (isolated) {\n                  // ç‹¬ç«‹è¿›ç¨‹ï¼Œç¼“å­˜è¿›ç¨‹ä¿¡æ¯åˆ°ä¼ å…¥çš„ServiceRecordå‚æ•°ä¸­ï¼Œä»¥ä¾¿åç»­ç›´æ¥ä½¿ç”¨\n                  r.isolatedProc = app;\n              }\n          }\n          // å°†æœåŠ¡è®°å½•åŠ å…¥çš„mPendingServicesä¸­ï¼Œç”±äºéç‹¬ç«‹è¿›ç¨‹åˆ›å»ºåå·²ç»ç›´æ¥è¿”å›ï¼Œæ‰€ä»¥è¿™é‡Œé€‚ç”¨äºç‹¬ç«‹è¿›ç¨‹çš„\n          if (!mPendingServices.contains(r)) {\n              mPendingServices.add(r);\n          }\n  \t    // åˆ›å»ºæˆåŠŸæˆ–è€…ä¹‹å‰å·²ç»åˆäº†ç¼“å­˜ï¼Œåˆ™è¿”å›null\n          return null;\n      }\n  â€‹```\n  \n  #### ç‹¬ç«‹è¿›ç¨‹ä½•æ—¶å¯åŠ¨æœåŠ¡ï¼Ÿ\n  \n  * ä¸€èˆ¬æ¥è¯´ï¼Œå°è£…è¾ƒå¥½çš„ä»£ç ä¼šä¿è¯å…¥å£ç»Ÿä¸€ï¼Œå¦‚æœéç‹¬ç«‹è¿›ç¨‹æƒ…å†µä¸‹æœåŠ¡çš„å¯åŠ¨ä½¿ç”¨çš„æ˜¯ `realStartServiceLocked` æ–¹æ³•æ¥å¯åŠ¨æœåŠ¡ï¼Œé‚£ä¹ˆç‹¬ç«‹è¿›ç¨‹æƒ…å†µä¸‹ï¼ŒæœåŠ¡çš„å¯åŠ¨ä¹Ÿåº”è¯¥ä½¿ç”¨æ­¤æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬æŸ¥çœ‹ `realStartServiceLocked` æ–¹æ³•çš„è°ƒç”¨å±‚æ¬¡ï¼Œå¦‚ä¸‹ï¼š\n  \n    **å›¾ç‰‡ç‰ˆæœ¬:**\n  \n    ![image-20210411112439961](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210411112440.png)\n  \n    **è¯¦ç»†è°ƒç”¨åºåˆ—:**\n  \n    * `ActiveServices.attachApplicationLocked`(ProcessRecord, String)  (com.android.server.am)\n      * ActivityManagerService.attachApplicationLocked(IApplicationThread, int, int, long)  (com.android.server.am)\n        * ActivityManagerService.attachApplication(IApplicationThread, long)  (com.android.server.am)\n    * `ActiveServices.bringUpServiceLocked`(ServiceRecord, int, boolean, boolean, boolean)  (com.android.server.am)\n      * ActiveServices.startServiceInnerLocked(ServiceMap, Intent, ServiceRecord, boolean, boolean)  (com.android.server.am)\n      * ActiveServices.bindServiceLocked(IApplicationThread, IBinder, Intent, String, IServiceConnection, int, String, ...)  (com.android.server.am)\n      * ActiveServices.performServiceRestartLocked(ServiceRecord)  (com.android.server.am)\n  \n    ä¹Ÿå°±æ˜¯è°ƒç”¨äº† `ActiveServices.attachApplicationLocked` ,æœ€ç»ˆæ˜¯é€šè¿‡AMSçš„`ActivityManagerService.attachApplication`æ¥è§¦å‘çš„;ä¹Ÿå°±æ˜¯åªè¦æ‰¾åˆ°`mAm.startProcessLocked`åˆ°`ActivityManagerService.attachApplication`çš„è°ƒç”¨åºåˆ—å³å¯è¯æ˜æ­¤çŒœæƒ³;\n  \n    æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å¦‚ä¸‹è°ƒç”¨åºåˆ—ï¼Œå³æœ€ç»ˆå®é™…ä¸Šæ˜¯ä»ActivityThreadçš„mainå‡½æ•°è¿›å…¥çš„ï¼Œæ‰€ä»¥åšå‡ºä»¥ä¸‹çŒœæƒ³ï¼š**è¿›ç¨‹å¯åŠ¨åï¼Œåˆ›å»ºActivityThreadæ—¶ï¼Œå¦‚æœæœ‰éœ€è¦åˆ›å»ºçš„æœåŠ¡ï¼Œå°±å¯åŠ¨æœåŠ¡ï¼›**\n  \n    <img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210411114715.png\" alt=\"image-20210411114715216\" style=\"zoom:50%;\" />\n  \n    æˆ‘ä»¬å†çœ‹`attachApplicationLocked` çš„é€»è¾‘ï¼Œå¯ä»¥å‘ç°ï¼Œä¼šæ£€æŸ¥`mPendingServices`ä¸­æ˜¯å¦æœ‰å¾…å¯åŠ¨çš„æœåŠ¡ï¼Œç„¶åé€ä¸€å¤„ç†ï¼Œå¦‚æœæœ‰éœ€è¦å¯åŠ¨çš„æœåŠ¡ï¼Œåˆ™ä¼šè°ƒç”¨`realStartServiceLocked(sr, proc, sr.createdFromFg)`æ¥å¯åŠ¨æœåŠ¡ã€‚\n  \n    ```java\n    // com.android.server.am.ActiveServices#attachApplicationLocked\n    // frameworks/base/services/core/java/com/android/server/am/ActiveServices.java\n    boolean attachApplicationLocked(ProcessRecord proc, String processName)\n                throws RemoteException {\n            boolean didSomething = false;\n            // Collect any services that are waiting for this process to come up.\n            if (mPendingServices.size() > 0) {\n                ServiceRecord sr = null;\n                try {\n                    for (int i=0; i<mPendingServices.size(); i++) {\n                        sr = mPendingServices.get(i);\n                        // æ’é™¤éç‹¬ç«‹Service\n                        if (proc != sr.isolatedProc && (proc.uid != sr.appInfo.uid\n                                || !processName.equals(sr.processName))) {\n                            continue;\n                        }\n    \n                        mPendingServices.remove(i);\n                        i--;\n                        proc.addPackage(sr.appInfo.packageName, sr.appInfo.longVersionCode,\n                                mAm.mProcessStats);\n                        // å¯åŠ¨æœåŠ¡\n                        realStartServiceLocked(sr, proc, sr.createdFromFg);\n                    }\n                } catch (RemoteException e) {\n                    Slog.w(TAG, \"Exception in new application when starting service \"\n                            + sr.shortInstanceName, e);\n                    throw e;\n                }\n            }\n    }\n    ```\n  \n  #### ActivityThread#handleCreateService\n  \n  è¿™é‡Œæˆ‘ä»¬çœç•¥`bringUpServiceLocked`æ–¹æ³•åŠä¸‹æ–¹çš„å‡ ä¸ªä¸­é—´æ­¥éª¤ï¼Œç›´æ¥æŸ¥çœ‹`android.app.ActivityThread#handleCreateService`æ–¹æ³•ï¼š\n  \n  1. é€šè¿‡ClassLoaderåŠ è½½å¹¶å®ä¾‹åŒ–äº†å¯¹åº”çš„Serviceå¯¹è±¡ï¼›\n  2. å°†Serviceå­˜å‚¨åˆ°ActivityThreadä¸­çš„ä¸€ä¸ªArrayMapä¸­ï¼›\n  \n  â€‹```java\n  // android/app/ActivityThread.java\n  // android.app.ActivityThread#handleCreateService\n  \n  final ArrayMap<IBinder, Service> mServices = new ArrayMap<>();\n  private void handleCreateService(CreateServiceData data) {\n          // If we are getting ready to gc after going to the background, well\n          // we are back active so skip it.\n          unscheduleGcIdler();\n  \n          LoadedApk packageInfo = getPackageInfoNoCheck(\n                  data.info.applicationInfo, data.compatInfo);\n          Service service = null;\n          try {\n              if (localLOGV) Slog.v(TAG, \"Creating service \" + data.info.name);\n  \n              ContextImpl context = ContextImpl.createAppContext(this, packageInfo);\n              Application app = packageInfo.makeApplication(false, mInstrumentation);\n              java.lang.ClassLoader cl = packageInfo.getClassLoader();\n              // åˆ›å»ºå¯¹åº”çš„Serviceå®ä¾‹\n              service = packageInfo.getAppFactory()\n                      .instantiateService(cl, data.info.name, data.intent);\n              // Service resources must be initialized with the same loaders as the application\n              // context.\n              context.getResources().addLoaders(\n                      app.getResources().getLoaders().toArray(new ResourcesLoader[0]));\n  \n              context.setOuterContext(service);\n              service.attach(context, this, data.info.name, data.token, app,\n                      ActivityManager.getService());\n              service.onCreate();\n              mServices.put(data.token, service);\n              try {\n                  ActivityManager.getService().serviceDoneExecuting(\n                          data.token, SERVICE_DONE_EXECUTING_ANON, 0, 0);\n              } catch (RemoteException e) {\n                  throw e.rethrowFromSystemServer();\n              }\n          } catch (Exception e) {\n              if (!mInstrumentation.onException(service, e)) {\n                  throw new RuntimeException(\n                      \"Unable to create service \" + data.info.name\n                      + \": \" + e.toString(), e);\n              }\n          }\n      }\n  â€‹```\n  \n  ### ç»‘å®šæœåŠ¡\n  \n  \n  <svg width=\"698px\" height=\"447px\" viewBox=\"0 0 698 447\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n      <g id=\"Androidæºç åˆ†æ\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n          <g id=\"bindServiceæµç¨‹åˆ†æ-åŠ å…¥å¯åŠ¨æµç¨‹\" transform=\"translate(-125.000000, -273.000000)\">\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-4\" transform=\"translate(523.000000, 273.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"14.2367021\" y=\"14\">ActivityManagerService.bindIsolatedService</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"44.0851371\" y=\"30.122449\">com/android/server/am/ActivityManagerService.java</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-5\" transform=\"translate(523.000000, 322.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"45.2025933\" y=\"14\">ActiveServices.bindServiceLocked</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"62.0131706\" y=\"30.122449\">com/android/server/am/ActiveServices.java</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-16\" transform=\"translate(523.000000, 422.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"25.0439991\" y=\"14\">IApplicationThread.scheduleBindService</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"75.1632961\" y=\"30.122449\">android/app/IApplicationThread.java</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-17\" transform=\"translate(523.000000, 482.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFED99\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"102.802928\" y=\"14\">Binder.transact</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"136.553756\" y=\"30.122449\">binder</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-18\" transform=\"translate(440.000000, 537.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFED99\" x=\"0.5\" y=\"0.5\" width=\"63.3004695\" height=\"182\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"10.224946\" y=\"14\">Binder.</tspan>\n                      <tspan x=\"6.77075357\" y=\"32\">transact</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"19.0044607\" y=\"118.306122\">binder</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-10\" transform=\"translate(522.000000, 537.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"27.1213883\" y=\"14\">ApplicationThread.scheduleBindService</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"28.0238818\" y=\"30.122449\">frameworks/base/core/java/android/app/ActivityThread.java</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-12\" transform=\"translate(522.000000, 587.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"43.344518\" y=\"14\">ActivityThread#handleBindService</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"28.0238818\" y=\"30.122449\">frameworks/base/core/java/android/app/ActivityThread.java</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-19\" transform=\"translate(522.000000, 637.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"63.1680494\" y=\"14\">IBinder = Service.onBinder()</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"104.313756\" y=\"30.122449\">è‡ªå®šä¹‰çš„Serviceå®ç°ç±»</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-20\" transform=\"translate(522.000000, 686.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#FFBBA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"48.7055222\" y=\"14\">IActivityManager#publishService</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"80.4068108\" y=\"30.122449\">android/app/IActivityManager.java</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-21\" transform=\"translate(125.000000, 537.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"28.303246\" y=\"14\">ActivityManagerService#publishService</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"80.4068108\" y=\"30.122449\">android/app/IActivityManager.java</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-23\" transform=\"translate(125.000000, 587.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"34.5841498\" y=\"14\">ActiveServices#publishServiceLocked</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"62.0131706\" y=\"30.122449\">com/android/server/am/ActiveServices.java</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-51\" transform=\"translate(125.000000, 638.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"54.5477983\" y=\"14\">IServiceConnection#connected</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"148.202627\" y=\"30.122449\">-</tspan>\n                  </text>\n              </g>\n              <g id=\"æ¶æ„å›¾/æ¨¡å—-æºç å¤‡ä»½-8\" transform=\"translate(523.000000, 373.000000)\">\n                  <rect id=\"çŸ©å½¢\" stroke=\"#979797\" fill=\"#D5FFA2\" x=\"0.5\" y=\"0.5\" width=\"298.399061\" height=\"33\" rx=\"6.9623431\"></rect>\n                  <text id=\"æ–¹æ³•è¿‡ç¨‹\" font-family=\"NotoSansCJKsc-Bold, Noto Sans CJK SC\" font-size=\"12.1841004\" font-weight=\"bold\" letter-spacing=\"0.134025104\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"12.0131038\" y=\"14\">ActiveServices.requestServiceBindingLocked</tspan>\n                  </text>\n                  <text id=\"ä»£ç åœ°å€\" font-family=\"NotoSansCJKsc-Light, Noto Sans CJK SC\" font-size=\"8.70292887\" font-weight=\"300\" letter-spacing=\"0.0957322235\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                      <tspan x=\"62.0131706\" y=\"30.122449\">com/android/server/am/ActiveServices.java</tspan>\n                  </text>\n              </g>\n              <path id=\"ç›´çº¿-5\" d=\"M671.935146,307.012222 L671.935,315.997 L675.675732,315.997076 L671.5,323.997076 L667.324268,315.997076 L671.064,315.997 L671.064854,307.012222 L671.935146,307.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-6\" d=\"M671.935146,356.012222 L671.935,364.997 L675.675732,364.997076 L671.5,372.997076 L667.324268,364.997076 L671.064,364.997 L671.064854,356.012222 L671.935146,356.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-7\" d=\"M671.935146,405.012222 L671.935,413.997 L675.675732,413.997076 L671.5,421.997076 L667.324268,413.997076 L671.064,413.997 L671.064854,405.012222 L671.935146,405.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-8\" d=\"M671.935146,454.998187 L671.935,473.011 L675.675732,473.011111 L671.5,481.011111 L667.324268,473.011111 L671.064,473.011 L671.064854,454.998187 L671.935146,454.998187 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-9\" d=\"M671.935146,514.990779 L671.935,530.018 L675.675732,530.018519 L671.5,538.018519 L667.324268,530.018519 L671.064,530.018 L671.064854,514.990779 L671.935146,514.990779 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-10\" d=\"M671.935146,571.012222 L671.935,579.997 L675.675732,579.997076 L671.5,587.997076 L667.324268,579.997076 L671.064,579.997 L671.064854,571.012222 L671.935146,571.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-18\" d=\"M671.935146,621.012222 L671.935,629.997 L675.675732,629.997076 L671.5,637.997076 L667.324268,629.997076 L671.064,629.997 L671.064854,621.012222 L671.935146,621.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-11\" d=\"M671.935146,671.012222 L671.935,679.997 L675.675732,679.997076 L671.5,687.997076 L667.324268,679.997076 L671.064,679.997 L671.064854,671.012222 L671.935146,671.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-19\" d=\"M511.984127,699.324268 L511.984,703.064 L522.006575,703.064854 L522.006575,703.935146 L511.984,703.935 L511.984127,707.675732 L503.984127,703.5 L511.984127,699.324268 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-20\" d=\"M431.980556,550.324268 L431.98,554.064 L441.010146,554.064854 L441.010146,554.935146 L431.98,554.935 L431.980556,558.675732 L423.980556,554.5 L431.980556,550.324268 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-12\" d=\"M272.935146,571.012222 L272.935,579.997 L276.675732,579.997076 L272.5,587.997076 L268.324268,579.997076 L272.064,579.997 L272.064854,571.012222 L272.935146,571.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n              <path id=\"ç›´çº¿-12å¤‡ä»½\" d=\"M272.935146,621.012222 L272.935,629.997 L276.675732,629.997076 L272.5,637.997076 L268.324268,629.997076 L272.064,629.997 L272.064854,621.012222 L272.935146,621.012222 Z\" fill=\"#979797\" fill-rule=\"nonzero\"></path>\n          </g>\n      </g>\n  </svg>\n  \n  æˆ‘ä»¬çš„é—®é¢˜æ˜¯ï¼š\n  \n  1. ç»‘å®šæœåŠ¡æ—¶ï¼Œä¼ å…¥çš„ServiceConnectionå¯¹è±¡ï¼Œå¦‚ä½•è¢«è°ƒç”¨æ¥é€šçŸ¥ï¼Ÿ\n  2. è¿˜åšäº†äº›ä»€ä¹ˆï¼Ÿ\n  \n  #### è¿æ¥å¯¹è±¡å»å“ªé‡Œäº†ï¼Ÿ\n  \n  æŸ¥çœ‹`ContextImpl.bindServiceCommon`æ–¹æ³•å¯ä»¥çœ‹åˆ°ï¼Œä¼ å…¥äº†å‚æ•° `ServiceConnection conn`ï¼Œç„¶åæ–¹æ³•ä¸­è¿™ä¸ªconnæ”¾å…¥åˆ°äº†ä¸€ä¸ª `ServiceDispatcher` ä¸­.\n  \n  * IServiceConnection åŒ…å«ä¸¤ä¸ªæ¥å£ï¼š\n    * connected(): è¿æ¥åˆ°æœåŠ¡\n    * asBinder()ï¼š æœåŠ¡è½¬Binder\n  * è¿™é‡Œä¼šå°†æˆ‘ä»¬è‡ªè¡Œç¼–å†™çš„ServiceConnectionå¯¹è±¡æ„é€ å‡ºä¸€ä¸ªServiceDispatcherå¯¹è±¡ï¼Œç„¶åå°†ServiceDispatcheræä¾›ä¸€ä¸ªIServiceconnectionæ¥å£ï¼ˆ`ServiceDispatcher$InnerConnection`ç±»ï¼‰ï¼Œç”¨äºæä¾›æœåŠ¡ï¼›\n  * è¿™ä¸ª`ServiceDispatcher$InnerConnection`ç±»çš„connectæ–¹æ³•ä¼šè°ƒç”¨sdçš„connectæ–¹æ³•ï¼Œæœ€ç»ˆä¼šè°ƒç”¨æˆ‘ä»¬æä¾›çš„ServiceConnectionçš„å›è°ƒæ–¹æ³•ï¼š`mConnection.onServiceConnected(name, service)`\n  \n  ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨`sd.connect()`å°±å¯ä»¥è§¦å‘æˆ‘ä»¬çš„è¿æ¥å¯¹è±¡çš„`onServiceConnected`å›è°ƒæ–¹æ³•ï¼›\n  \n  â€‹```java\n  final @NonNull LoadedApk mPackageInfo;\n  \n  private boolean bindServiceCommon(Intent service, ServiceConnection conn, int flags,\n              String instanceName, Handler handler, Executor executor, UserHandle user) {\n          // Keep this in sync with DevicePolicyManager.bindDeviceAdminServiceAsUser.\n  \t    // è¿™ä¸ªIServiceConnection å®é™…ä¸Šå°±æ˜¯æŒæœ‰ServiceDispatcherçš„å¼±å¼•ç”¨å¯¹è±¡ï¼Œç„¶åå°†ServiceDispatcherçš„å°‘é‡æ–¹æ³•æš´éœ²å‡ºå»\n          IServiceConnection sd;\n          if (mPackageInfo != null) {\n              if (executor != null) {\n                  // mPackageInfo æ˜¯ä¸€ä¸ª LoadedApk å¯¹è±¡\n                  sd = mPackageInfo.getServiceDispatcher(conn, getOuterContext(), executor, flags);\n              } else {\n                  sd = mPackageInfo.getServiceDispatcher(conn, getOuterContext(), handler, flags);\n              }\n          } else {\n              \n          }\n      \tint res = ActivityManager.getService().bindIsolatedService(\n                  mMainThread.getApplicationThread(), getActivityToken(), service,\n                  service.resolveTypeIfNeeded(getContentResolver()),\n  \t            // è°ƒç”¨AMSçš„æœåŠ¡å¼è¿™é‡Œä¼ å…¥äº†sd\n                  sd, flags, instanceName, getOpPackageName(), user.getIdentifier());\n          //... \n      }\n  \n  // com.android.server.am.ActiveServices#bindServiceLocked\n  AppBindRecord b = s.retrieveAppBindingLocked(service, callerApp);\n              ConnectionRecord c = new ConnectionRecord(b, activity,\n                      connection, flags, clientLabel, clientIntent,\n                      callerApp.uid, callerApp.processName, callingPackage);\n              // æä¾› IBinder \n              IBinder binder = connection.asBinder();\n              s.addConnection(binder, c);\n              b.connections.add(c);\n  â€‹```\n  \n  ServiceDispatcherç±»ä½äº `android.app.LoadedApk.ServiceDispatcher`ï¼š\n  \n  â€‹```java\n  // frameworks/base/core/java/android/app/LoadedApk.java\n  \tpublic final IServiceConnection getServiceDispatcher(ServiceConnection c,\n              Context context, Executor executor, int flags) {\n          return getServiceDispatcherCommon(c, context, null, executor, flags);\n      }\n  \n      private IServiceConnection getServiceDispatcherCommon(ServiceConnection c,\n              Context context, Handler handler, Executor executor, int flags) {\n          synchronized (mServices) {\n              LoadedApk.ServiceDispatcher sd = null;\n              ArrayMap<ServiceConnection, LoadedApk.ServiceDispatcher> map = mServices.get(context);\n              if (map != null) {\n                  if (DEBUG) Slog.d(TAG, \"Returning existing dispatcher \" + sd + \" for conn \" + c);\n                  sd = map.get(c);\n              }\n              if (sd == null) {\n                  if (executor != null) {\n                      sd = new ServiceDispatcher(c, context, executor, flags);\n                  } else {\n                      sd = new ServiceDispatcher(c, context, handler, flags);\n                  }\n                  if (DEBUG) Slog.d(TAG, \"Creating new dispatcher \" + sd + \" for conn \" + c);\n                  if (map == null) {\n                      map = new ArrayMap<>();\n                      mServices.put(context, map);\n                  }\n                  map.put(c, sd);\n              } else {\n                  sd.validate(context, handler, executor);\n              }\n              return sd.getIServiceConnection();\n          }\n      }\n  \n  \n  static final class ServiceDispatcher {\n      private final ServiceDispatcher.InnerConnection mIServiceConnection;\n      @UnsupportedAppUsage\n      private final ServiceConnection mConnection;\n      @UnsupportedAppUsage(maxTargetSdk = Build.VERSION_CODES.P, trackingBug = 115609023)\n      private final Context mContext;\n      private final Handler mActivityThread;\n      private final Executor mActivityExecutor;\n      private final ServiceConnectionLeaked mLocation;\n      private final int mFlags;\n  \n      private static class InnerConnection extends IServiceConnection.Stub {\n          @UnsupportedAppUsage\n          final WeakReference<LoadedApk.ServiceDispatcher> mDispatcher;\n  \n          InnerConnection(LoadedApk.ServiceDispatcher sd) {\n              mDispatcher = new WeakReference<LoadedApk.ServiceDispatcher>(sd);\n          }\n  \n          public void connected(ComponentName name, IBinder service, boolean dead)\n                  throws RemoteException {\n              LoadedApk.ServiceDispatcher sd = mDispatcher.get();\n              if (sd != null) {\n                  sd.connected(name, service, dead);\n              }\n          }\n      }\n  \n      @UnsupportedAppUsage\n      ServiceDispatcher(ServiceConnection conn,\n                        Context context, Handler activityThread, int flags) {\n          mIServiceConnection = new InnerConnection(this);\n          mConnection = conn;\n          mContext = context;\n          mActivityThread = activityThread;\n          mActivityExecutor = null;\n          mLocation = new ServiceConnectionLeaked(null);\n          mLocation.fillInStackTrace();\n          mFlags = flags;\n      }\n  \n      ServiceConnection getServiceConnection() {\n          return mConnection;\n      }\n  \n      // SDä¸­æä¾›äº†connectedæ–¹æ³•\n      public void connected(ComponentName name, IBinder service, boolean dead) {\n          if (mActivityExecutor != null) {\n              mActivityExecutor.execute(new RunConnection(name, service, 0, dead));\n          } else if (mActivityThread != null) {\n              mActivityThread.post(new RunConnection(name, service, 0, dead));\n          } else {\n              doConnected(name, service, dead);\n          }\n      }\n  \n      public void doConnected(ComponentName name, IBinder service, boolean dead) {\n          ServiceDispatcher.ConnectionInfo old;\n          ServiceDispatcher.ConnectionInfo info;\n  \n          synchronized (this) {\n              if (mForgotten) {\n                  // We unbound before receiving the connection; ignore\n                  // any connection received.\n                  return;\n              }\n              old = mActiveConnections.get(name);\n              if (old != null && old.binder == service) {\n                  // Huh, already have this one.  Oh well!\n                  return;\n              }\n  \n              if (service != null) {\n                  // A new service is being connected... set it all up.\n                  info = new ConnectionInfo();\n                  info.binder = service;\n                  info.deathMonitor = new DeathMonitor(name, service);\n                  try {\n                      service.linkToDeath(info.deathMonitor, 0);\n                      mActiveConnections.put(name, info);\n                  } catch (RemoteException e) {\n                      // This service was dead before we got it...  just\n                      // don't do anything with it.\n                      mActiveConnections.remove(name);\n                      return;\n                  }\n  \n              } else {\n                  // The named service is being disconnected... clean up.\n                  mActiveConnections.remove(name);\n              }\n  \n              if (old != null) {\n                  old.binder.unlinkToDeath(old.deathMonitor, 0);\n              }\n          }\n  \n          // If there was an old service, it is now disconnected.\n          if (old != null) {\n              mConnection.onServiceDisconnected(name);\n          }\n          if (dead) {\n              mConnection.onBindingDied(name);\n          }\n          // If there is a new viable service, it is now connected.\n          if (service != null) {\n              mConnection.onServiceConnected(name, service);\n          } else {\n              // The binding machinery worked, but the remote returned null from onBind().\n              mConnection.onNullBinding(name);\n          }\n      }\n  \n  }\n  â€‹```\n  \n  #### IServiceConnectionè¯´æ˜\n  \n  >  æœåŠ¡ç»‘å®šæ—¶ï¼ŒIServiceConnectionçš„ç”¨é€”ï¼Ÿå¦‚ä½•å®ç°åœ¨APPçš„Activityè¿›ç¨‹ä¸­è°ƒç”¨ServiceConnectionçš„onServiceConnectedæ–¹æ³•ï¼Ÿ\n  \n  * IServiceConnectçš„æœåŠ¡ç«¯ä½äºAPPè¿›ç¨‹ä¸­ï¼Œåœ¨ContextImplçš„binderServiceCommonæ–¹æ³•ä¸­åˆå§‹åŒ–ï¼Œä¹Ÿå°±æ˜¯LoadApkç±»ä¸­çš„ServiceDispatcherç±»ã€‚\n  * ä¼ é€’ç»™AMSçš„å®é™…ä¸Šæ˜¯ä¸€ä¸ªBinderçš„è¿œç¨‹ä»£ç†å¯¹è±¡ï¼›\n  \n  â€‹```java\n  // android.app.IActivityManager.Stub#TRANSACTION_bindService\n  // android/app/IActivityManager.java\n  case TRANSACTION_bindService:\n  {\n            data.enforceInterface(descriptor);\n            android.app.IApplicationThread _arg0;\n            _arg0 = android.app.IApplicationThread.Stub.asInterface(data.readStrongBinder());\n            android.os.IBinder _arg1;\n            _arg1 = data.readStrongBinder();\n            android.content.Intent _arg2;\n            if ((0!=data.readInt())) {\n              _arg2 = android.content.Intent.CREATOR.createFromParcel(data);\n            }\n            else {\n              _arg2 = null;\n            }\n            java.lang.String _arg3;\n            _arg3 = data.readString();\n            android.app.IServiceConnection _arg4;\n      // è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œæ˜¯åœ¨è¿™ä¸ªåœ°æ–¹è§IServiceConnectionçš„æœåŠ¡ç«¯å¯¹è±¡è½¬æ¢æˆå®¢æˆ·ç«¯ä»£ç†å¯¹è±¡çš„\n            _arg4 = android.app.IServiceConnection.Stub.asInterface(data.readStrongBinder());\n            int _arg5;\n            _arg5 = data.readInt();\n            java.lang.String _arg6;\n            _arg6 = data.readString();\n            int _arg7;\n            _arg7 = data.readInt();\n            int _result = this.bindService(_arg0, _arg1, _arg2, _arg3, _arg4, _arg5, _arg6, _arg7);\n            reply.writeNoException();\n            reply.writeInt(_result);\n            return true;\n  }\n      \n  â€‹```\n  \n  asInterface ä¸­ï¼š `new android.app.IServiceConnection.Stub.Proxy(obj)` å³æ˜¯å°†Stubè½¬æ¢ä¸ºProxyå¯¹è±¡ï¼›\n  \n  â€‹```java\n    /** Local-side IPC implementation stub class. */\n    public static abstract class Stub extends android.os.Binder implements android.app.IServiceConnection\n    {\n      private static final java.lang.String DESCRIPTOR = \"android.app.IServiceConnection\";\n      /** Construct the stub at attach it to the interface. */\n      public Stub()\n      {\n        this.attachInterface(this, DESCRIPTOR);\n      }\n      /**\n       * Cast an IBinder object into an android.app.IServiceConnection interface,\n       * generating a proxy if needed.\n       */\n      public static android.app.IServiceConnection asInterface(android.os.IBinder obj)\n      {\n        if ((obj==null)) {\n          return null;\n        }\n        android.os.IInterface iin = obj.queryLocalInterface(DESCRIPTOR);\n        if (((iin!=null)&&(iin instanceof android.app.IServiceConnection))) {\n          return ((android.app.IServiceConnection)iin);\n        }\n        return new android.app.IServiceConnection.Stub.Proxy(obj);\n      }\n    }\n  â€‹```\n  \n  ä¹Ÿå°±æ˜¯è¯´ï¼ŒActivityManagerService.bindServiceæ–¹æ³•ä¸­çš„IServiceConnectionå‚æ•°å®é™…ä¸Šæ˜¯ä¸€ä¸ªProxyå¯¹è±¡ï¼›\n  \n  â€‹```java\n  // è¿™é‡Œçš„Connectionæ˜¯ä¸€ä¸ªä»£ç†å¯¹è±¡\n  public int bindService(IApplicationThread caller, IBinder token, Intent service,\n              String resolvedType, IServiceConnection connection, int flags,\n              String callingPackage, int userId) throws TransactionTooLargeException {\n          return bindIsolatedService(caller, token, service, resolvedType, connection, flags,\n                  null, callingPackage, userId);\n  }\n  â€‹```\n  \n  #### ActivityThread#handleBindService\n  \n  å®é™…ä¸Šå°±åšäº†ä¸¤ä»¶äº‹æƒ…\n  \n  â€‹```java\n  // android.app.ActivityThread#handleBindService\n  // frameworks/base/core/java/android/app/ActivityThread.java\n  private void handleBindService(BindServiceData data) {\n          // è·å–ä¹‹å‰åˆ›å»ºçš„æœåŠ¡\n          Service s = mServices.get(data.token);\n          if (s != null) { // æ‰¾ä¸åˆ°ä¹‹å‰åˆ›å»ºçš„æœåŠ¡ï¼Œåˆ™ä»€ä¹ˆéƒ½ä¸åš\n              try {\n                  data.intent.setExtrasClassLoader(s.getClassLoader());\n                  data.intent.prepareToEnterProcess();\n                  try {\n                      if (!data.rebind) {\n                          // è°ƒç”¨Serviceçš„onBindæ¥å£è·å–IBinderå¯¹è±¡\n                          IBinder binder = s.onBind(data.intent);\n                          // é€šçŸ¥AMSæ¥publicService\n                          ActivityManager.getService().publishService(\n                                  data.token, data.intent, binder);\n                      } else {\n                          s.onRebind(data.intent);\n                          ActivityManager.getService().serviceDoneExecuting(\n                                  data.token, SERVICE_DONE_EXECUTING_ANON, 0, 0);\n                      }\n                  } catch (RemoteException ex) {\n                      throw ex.rethrowFromSystemServer();\n                  }\n              } catch (Exception e) {\n              }\n          }\n      }\n  â€‹```\n  \n  #### ActivityManagerService#publishService\n  \n  â€‹```java\n  // com.android.server.am.ActivityManagerService#publishService\n  // frameworks/base/services/core/java/com/android/server/am/ActivityManagerService.java\n  public void publishService(IBinder token, Intent intent, IBinder service) {\n          // Refuse possible leaked file descriptors\n          if (intent != null && intent.hasFileDescriptors() == true) {\n              throw new IllegalArgumentException(\"File descriptors passed in Intent\");\n          }\n  \n          synchronized(this) {\n              if (!(token instanceof ServiceRecord)) {\n                  throw new IllegalArgumentException(\"Invalid service token\");\n              }\n              // com.android.server.am.ActiveServices#publishServiceLocked\n              mServices.publishServiceLocked((ServiceRecord)token, intent, service);\n          }\n      }\n  â€‹```\n  \n  #### ActiveServices#publishServiceLocked\n  \n  ä¸‹é¢æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨publishServiceLockedæ–¹æ³•ä¸­ï¼Œå–å‡ºäº†ä¸€ä¸ªè¿æ¥è®°å½•åˆ—è¡¨ï¼Œç„¶åå¾ªç¯çš„è°ƒç”¨äº†å…¶ä¸­çš„IServiceConnectionçš„connectedæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ä¼šè°ƒç”¨åˆ°æˆ‘ä»¬è‡ªè¡Œå®šä¹‰çš„ServiceConnnectionå¯¹è±¡çš„connectedæ–¹æ³•ã€‚\n  \n  ä¸è¿‡æˆ‘ä»¬æœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯è¿™ä¸ªConnectionRecordå¯¹è±¡æ˜¯ä½•æ—¶æ„é€ çš„ï¼Ÿ\n  \n  â€‹```java\n  // com.android.server.am.ConnectionRecord\n  // frameworks/base/services/core/java/com/android/server/am/ConnectionRecord.java\n  final class ConnectionRecord {\n      final AppBindRecord binding;    // The application/service binding.\n      final ActivityServiceConnectionsHolder<ConnectionRecord> activity;  // If non-null, the owning activity.\n      final IServiceConnection conn;  // The client connection.\n  }\n  \n  // com.android.server.am.ActiveServices#publishServiceLocked\n  // frameworks/base/services/core/java/com/android/server/am/ActiveServices.java\n  void publishServiceLocked(ServiceRecord r, Intent intent, IBinder service) {\n          final long origId = Binder.clearCallingIdentity();\n          try {\n              // å¦‚æœæœåŠ¡è®°å½•ä¸ºnullï¼Œå°±ä»€ä¹ˆéƒ½ä¸åš\n              if (r != null) {\n                  Intent.FilterComparison filter\n                          = new Intent.FilterComparison(intent);\n                  IntentBindRecord b = r.bindings.get(filter);\n                  if (b != null && !b.received) {\n                      b.binder = service;\n                      b.requested = true;\n                      b.received = true;\n                      // å–å‡ºè¿æ¥è®°å½•ConnectionRecord\n                      ArrayMap<IBinder, ArrayList<ConnectionRecord>> connections = r.getConnections();\n                      for (int conni = connections.size() - 1; conni >= 0; conni--) {\n                          ArrayList<ConnectionRecord> clist = connections.valueAt(conni);\n                          for (int i = 0; i < clist.size(); i++) {\n                              ConnectionRecord c = clist.get(i);\n                              try {\n                                  // è°ƒç”¨IServiceConnectionçš„connectedæ–¹æ³•\n                                  c.conn.connected(r.name, service, false);\n                              } catch (Exception e) {\n                                 \n                              }\n                          }\n                      }\n                  }\n                  serviceDoneExecutingLocked(r, mDestroyingServices.contains(r), false);\n              }\n          } finally {\n          }\n      }\n  \n  â€‹```\n  \n  #### æ„é€  ConnectionRecord - bindServiceLocked\n  \n  å®é™…ä¸Šè¿™ä¸ªæ„å»ºConnectRecordçš„è¿‡ç¨‹ä½äºbindServiceLockedæ–¹æ³•ä¸­ã€‚\n  \n  â€‹```java\n  int bindServiceLocked(IApplicationThread caller, IBinder token, Intent service,\n                            String resolvedType, final IServiceConnection connection, int flags,\n                            String instanceName, String callingPackage, final int userId)\n              throws TransactionTooLargeException {\n          final int callingPid = Binder.getCallingPid();\n          final int callingUid = Binder.getCallingUid();\n  \n          ActivityServiceConnectionsHolder<ConnectionRecord> activity = null;\n          if (token != null) {\n              activity = mAm.mAtmInternal.getServiceConnectionsHolder(token);\n              if (activity == null) {\n                  Slog.w(TAG, \"Binding with unknown activity: \" + token);\n                  return 0;\n              }\n          }\n          ServiceLookupResult res = retrieveServiceLocked(service, instanceName, resolvedType, callingPackage,\n                          callingPid, callingUid, userId, true,\n                          callerFg, isBindExternal, allowInstant);\n          ServiceRecord s = res.record;\n          try {\n              AppBindRecord b = s.retrieveAppBindingLocked(service, callerApp);\n              // æ„é€ è¿æ¥è®°å½•å¯¹è±¡\n              ConnectionRecord c = new ConnectionRecord(b, activity,\n                      connection, flags, clientLabel, clientIntent,\n                      callerApp.uid, callerApp.processName, callingPackage);\n  \n              IBinder binder = connection.asBinder();\n              // æ·»åŠ åˆ°ServiceRecordå¯¹è±¡ä¸­\n              s.addConnection(binder, c);\n              b.connections.add(c);\n              if (activity != null) {\n                  activity.addConnection(c);\n              }\n              b.client.connections.add(c);\n              c.startAssociationIfNeeded();\n          } finally {\n          }\n          return 1;\n      }\n  â€‹```\n  \n  \n  \n  ## éƒ¨åˆ†æ–¹æ³•çš„æºç \n  \n  ### ContextImpl.`bindService`\n  \n  * `bindService` : (`frameworks/base/core/java/android/app/ContextImpl.java`)\n  \n    ```java\n        @Override\n        public boolean bindService(Intent service, ServiceConnection conn, int flags) {\n            warnIfCallingFromSystemProcess();\n            return bindServiceCommon(service, conn, flags, null, mMainThread.getHandler(), null,\n                    getUser());\n        }\n    \n        @Override\n        public boolean bindService(\n                Intent service, int flags, Executor executor, ServiceConnection conn) {\n            warnIfCallingFromSystemProcess();\n            return bindServiceCommon(service, conn, flags, null, null, executor, getUser());\n        }\n    \n    ```\n  \n  ### ContextImpl.bindServiceCommon\n  \n  * `bindServiceCommon`:  (`frameworks/base/core/java/android/app/ContextImpl.java`)\n  \n    ```java\n    private boolean bindServiceCommon(Intent service, ServiceConnection conn, int flags,\n                String instanceName, Handler handler, Executor executor, UserHandle user) {\n            // Keep this in sync with DevicePolicyManager.bindDeviceAdminServiceAsUser.\n            IServiceConnection sd;\n            if (conn == null) {\n                throw new IllegalArgumentException(\"connection is null\");\n            }\n            if (handler != null && executor != null) {\n                throw new IllegalArgumentException(\"Handler and Executor both supplied\");\n            }\n            if (mPackageInfo != null) {\n                if (executor != null) {\n                    sd = mPackageInfo.getServiceDispatcher(conn, getOuterContext(), executor, flags);\n                } else {\n                    sd = mPackageInfo.getServiceDispatcher(conn, getOuterContext(), handler, flags);\n                }\n            } else {\n                throw new RuntimeException(\"Not supported in system context\");\n            }\n            validateServiceIntent(service);\n            try {\n                // WindowContextæ„é€ å‡½æ•°ä¸­çš„ WindowTokenClient\n                IBinder token = getActivityToken();\n                if (token == null && (flags&BIND_AUTO_CREATE) == 0 && mPackageInfo != null\n                        && mPackageInfo.getApplicationInfo().targetSdkVersion\n                        < android.os.Build.VERSION_CODES.ICE_CREAM_SANDWICH) {\n                    flags |= BIND_WAIVE_PRIORITY;\n                }\n                service.prepareToLeaveProcess(this);\n                int res = ActivityManager.getService().bindIsolatedService(\n                    mMainThread.getApplicationThread(), getActivityToken(), service,\n                    service.resolveTypeIfNeeded(getContentResolver()),\n                    sd, flags, instanceName, getOpPackageName(), user.getIdentifier());\n                if (res < 0) {\n                    throw new SecurityException(\n                            \"Not allowed to bind to service \" + service);\n                }\n                return res != 0;\n            } catch (RemoteException e) {\n                throw e.rethrowFromSystemServer();\n            }\n        }\n    ```\n  \n  ### ActivityManagerService.bindIsolatedService\n  \n  ä»è¿™é‡Œå¼€å§‹ï¼Œå®é™…ä¸Šä½äºAMSçš„Serverç«¯äº†ï¼Œå³æˆ‘ä»¬çš„Activityæ‰€åœ¨çš„è¿›ç¨‹å‘é€äº†ä¸€ä¸ªå¯åŠ¨æœåŠ¡çš„IPCè¯·æ±‚ç»™AMSï¼ˆsysmte_serverè¿›ç¨‹ä¸­ï¼‰ã€‚\n  \n  * ActivityManagerService.java : (frameworks/base/services/core/java/com/android/server/am/ActivityManagerService.java)\n  \n    ```java\n    public int bindIsolatedService(IApplicationThread caller, IBinder token, Intent service,\n                String resolvedType, IServiceConnection connection, int flags, String instanceName,\n                String callingPackage, int userId) throws TransactionTooLargeException {\n    \t\t// .... \n            synchronized(this) {\n                // è°ƒç”¨Binderæ¥å£\n                return mServices.bindServiceLocked(caller, token, service,\n                        resolvedType, connection, flags, instanceName, callingPackage, userId);\n            }\n        }\n    ```\n  \n  ![image-20210409144356311](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210409144356.png)\n  \n  ### ActiveServices.bindServiceLocked\n  \n  *  `ActiveServices.bindServiceLocked`: (`frameworks/base/services/core/java/com/android/server/am/ActiveServices.java`)\n  \n    * è¿™ä¸ªæ–¹æ³•æœ‰ç‚¹é•¿ï¼Œæˆ‘ä»¬æˆªå–é‡è¦éƒ¨åˆ†\n  \n    ```java\n    int bindServiceLocked(IApplicationThread caller, IBinder token, Intent service,\n                String resolvedType, final IServiceConnection connection, int flags,\n                String instanceName, String callingPackage, final int userId)\n                throws TransactionTooLargeException {\n        // è·å–è°ƒç”¨æ–¹çš„æƒé™\n            final int callingPid = Binder.getCallingPid();\n            final int callingUid = Binder.getCallingUid();\n            final ProcessRecord callerApp = mAm.getRecordForAppLocked(caller);\n            if (callerApp == null) {\n                throw new SecurityException(\n                        \"Unable to find app for caller \" + caller\n                        + \" (pid=\" + callingPid\n                        + \") when binding service \" + service);\n            }\n    \n            ActivityServiceConnectionsHolder<ConnectionRecord> activity = null;\n            if (token != null) {\n                activity = mAm.mAtmInternal.getServiceConnectionsHolder(token);\n                if (activity == null) {\n                    Slog.w(TAG, \"Binding with unknown activity: \" + token);\n                    return 0;\n                }\n            }\n    \n            int clientLabel = 0;\n            PendingIntent clientIntent = null;\n            final boolean isCallerSystem = callerApp.info.uid == Process.SYSTEM_UID;\n           \n    \n            final boolean callerFg = callerApp.setSchedGroup != ProcessList.SCHED_GROUP_BACKGROUND;\n            final boolean isBindExternal = (flags & Context.BIND_EXTERNAL_SERVICE) != 0;\n            final boolean allowInstant = (flags & Context.BIND_ALLOW_INSTANT) != 0;\n    \n            ServiceLookupResult res =\n                retrieveServiceLocked(service, instanceName, resolvedType, callingPackage,\n                        callingPid, callingUid, userId, true,\n                        callerFg, isBindExternal, allowInstant);\n            if (res == null) {\n                return 0;\n            }\n            if (res.record == null) {\n                return -1;\n            }\n            ServiceRecord s = res.record;\n    \n            try {\n                if (unscheduleServiceRestartLocked(s, callerApp.info.uid, false)) {\n                    if (DEBUG_SERVICE) Slog.v(TAG_SERVICE, \"BIND SERVICE WHILE RESTART PENDING: \"\n                            + s);\n                }\n    \n                if ((flags&Context.BIND_AUTO_CREATE) != 0) {\n                    s.lastActivity = SystemClock.uptimeMillis();\n                    if (!s.hasAutoCreateConnections()) {\n                        // This is the first binding, let the tracker know.\n                        ServiceState stracker = s.getTracker();\n                        if (stracker != null) {\n                            stracker.setBound(true, mAm.mProcessStats.getMemFactorLocked(),\n                                    s.lastActivity);\n                        }\n                    }\n                }\n    \n                if ((flags & Context.BIND_RESTRICT_ASSOCIATIONS) != 0) {\n                    mAm.requireAllowedAssociationsLocked(s.appInfo.packageName);\n                }\n    \n                mAm.startAssociationLocked(callerApp.uid, callerApp.processName,\n                        callerApp.getCurProcState(), s.appInfo.uid, s.appInfo.longVersionCode,\n                        s.instanceName, s.processName);\n                // Once the apps have become associated, if one of them is caller is ephemeral\n                // the target app should now be able to see the calling app\n                mAm.grantImplicitAccess(callerApp.userId, service,\n                        callerApp.uid, UserHandle.getAppId(s.appInfo.uid));\n    \n                AppBindRecord b = s.retrieveAppBindingLocked(service, callerApp);\n                ConnectionRecord c = new ConnectionRecord(b, activity,\n                        connection, flags, clientLabel, clientIntent,\n                        callerApp.uid, callerApp.processName, callingPackage);\n    \n                IBinder binder = connection.asBinder();\n                s.addConnection(binder, c);\n                b.connections.add(c);\n                if (activity != null) {\n                    activity.addConnection(c);\n                }\n                b.client.connections.add(c);\n                if (s.app != null) {\n                    updateServiceClientActivitiesLocked(s.app, c, true);\n                }\n                ArrayList<ConnectionRecord> clist = mServiceConnections.get(binder);\n                if (clist == null) {\n                    clist = new ArrayList<>();\n                    mServiceConnections.put(binder, clist);\n                }\n                clist.add(c);\n    \n                if ((flags&Context.BIND_AUTO_CREATE) != 0) {\n                    s.lastActivity = SystemClock.uptimeMillis();\n                    if (bringUpServiceLocked(s, service.getFlags(), callerFg, false,\n                            permissionsReviewRequired) != null) {\n                        return 0;\n                    }\n                }\n    \n                if (s.app != null && b.intent.received) {\n                    // Service is already running, so we can immediately\n                    // publish the connection.\n                    try {\n                        c.conn.connected(s.name, b.intent.binder, false);\n                    } catch (Exception e) {\n                        Slog.w(TAG, \"Failure sending service \" + s.shortInstanceName\n                                + \" to connection \" + c.conn.asBinder()\n                                + \" (in \" + c.binding.client.processName + \")\", e);\n                    }\n                } else if (!b.intent.requested) {\n                    requestServiceBindingLocked(s, b.intent, callerFg, false);\n                }\n            } finally {\n            }\n            return 1;\n        }\n    ```\n    \n    ### ActiveServices.realStartServiceLocked\n  â€‹```java\n   /**\n       * Note the name of this method should not be confused with the started services concept.\n       * The \"start\" here means bring up the instance in the client, and this method is called\n       * from bindService() as well.\n       */\n      private final void realStartServiceLocked(ServiceRecord r,\n              ProcessRecord app, boolean execInFg) throws RemoteException {\n          if (app.thread == null) {\n              throw new RemoteException();\n          }\n          r.setProcess(app);\n          r.restartTime = r.lastActivity = SystemClock.uptimeMillis();\n  \t\t// åˆ›å»ºæœåŠ¡\n          final boolean newService = app.startService(r);\n          bumpServiceExecutingLocked(r, execInFg, \"create\");\n          mAm.updateLruProcessLocked(app, false, null);\n          updateServiceForegroundLocked(r.app, /* oomAdj= */ false);\n          mAm.updateOomAdjLocked(app, OomAdjuster.OOM_ADJ_REASON_START_SERVICE);\n  \n          boolean created = false;\n          try {\n              app.forceProcessStateUpTo(ActivityManager.PROCESS_STATE_SERVICE);\n              // åˆ›å»ºæœåŠ¡\n              app.thread.scheduleCreateService(r, r.serviceInfo,\n                      mAm.compatibilityInfoForPackage(r.serviceInfo.applicationInfo),\n                      app.getReportedProcState());\n              r.postNotification();\n              created = true;\n          } catch (DeadObjectException e) {\n              Slog.w(TAG, \"Application dead when creating service \" + r);\n              mAm.appDiedLocked(app, \"Died when creating service\");\n              throw e;\n          } finally {\n              // \n          }\n  \n          // ç»‘å®šæœåŠ¡\n          requestServiceBindingsLocked(r, execInFg);\n  \n          updateServiceClientActivitiesLocked(app, null, true);\n  \n          if (newService && created) {\n              app.addBoundClientUidsOfNewService(r);\n          }\n  \n          // If the service is in the started state, and there are no\n          // pending arguments, then fake up one so its onStartCommand() will\n          // be called.\n          if (r.startRequested && r.callStart && r.pendingStarts.size() == 0) {\n              r.pendingStarts.add(new ServiceRecord.StartItem(r, false, r.makeNextStartId(),\n                      null, null, 0));\n          }\n          sendServiceArgsLocked(r, execInFg, true);\n      }\n  â€‹```\n  ```\n  \n  ### ActiveServices.realStartServiceLocked\n```java\n /**\n     * Note the name of this method should not be confused with the started services concept.\n     * The \"start\" here means bring up the instance in the client, and this method is called\n     * from bindService() as well.\n     */\n    private final void realStartServiceLocked(ServiceRecord r,\n            ProcessRecord app, boolean execInFg) throws RemoteException {\n        if (app.thread == null) {\n            throw new RemoteException();\n        }\n        r.setProcess(app);\n        r.restartTime = r.lastActivity = SystemClock.uptimeMillis();\n\t\t// åˆ›å»ºæœåŠ¡\n        final boolean newService = app.startService(r);\n        bumpServiceExecutingLocked(r, execInFg, \"create\");\n        mAm.updateLruProcessLocked(app, false, null);\n        updateServiceForegroundLocked(r.app, /* oomAdj= */ false);\n        mAm.updateOomAdjLocked(app, OomAdjuster.OOM_ADJ_REASON_START_SERVICE);\n\n        boolean created = false;\n        try {\n            app.forceProcessStateUpTo(ActivityManager.PROCESS_STATE_SERVICE);\n            // åˆ›å»ºæœåŠ¡\n            app.thread.scheduleCreateService(r, r.serviceInfo,\n                    mAm.compatibilityInfoForPackage(r.serviceInfo.applicationInfo),\n                    app.getReportedProcState());\n            r.postNotification();\n            created = true;\n        } catch (DeadObjectException e) {\n            Slog.w(TAG, \"Application dead when creating service \" + r);\n            mAm.appDiedLocked(app, \"Died when creating service\");\n            throw e;\n        } finally {\n            // \n        }\n\n        // ç»‘å®šæœåŠ¡\n        requestServiceBindingsLocked(r, execInFg);\n\n        updateServiceClientActivitiesLocked(app, null, true);\n\n        if (newService && created) {\n            app.addBoundClientUidsOfNewService(r);\n        }\n\n        // If the service is in the started state, and there are no\n        // pending arguments, then fake up one so its onStartCommand() will\n        // be called.\n        if (r.startRequested && r.callStart && r.pendingStarts.size() == 0) {\n            r.pendingStarts.add(new ServiceRecord.StartItem(r, false, r.makeNextStartId(),\n                    null, null, 0));\n        }\n        sendServiceArgsLocked(r, execInFg, true);\n    }\n```",
      "data": {
        "title": "Android bindServiceæµç¨‹",
        "date": "2021-04-12 10:18:50",
        "tags": [
          "Android",
          "æºç åˆ†æ"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "\n\n\næœ¬æ–‡åˆ†æbindServiceçš„æµç¨‹ï¼Œé¦–å…ˆæˆ‘ä»¬é€šè¿‡é˜…è¯»æºç è·å–ä¸€ä¸ªä¸»çº¿çš„è°ƒç”¨åœ°å›¾ï¼Œç„¶åæå‡ºè‹¥å¹²é—®é¢˜ï¼ŒåŒ…æ‹¬ï¼šAPPè¿›ç¨‹ä¸­å¦‚ä½•è·å–AMSï¼ŒAMSå¦‚ä½•å¯åŠ¨APP-serviceçš„è¿›ç¨‹ï¼ŒAMSä¸­å¦‚ä½•è·å–ApplicationThreadå¹¶ä¸ä¹‹é€šè®¯ï¼ŒServiceçš„å¯åŠ¨åŠç»‘å®šæµç¨‹ï¼›ç„¶åå†é€šè¿‡æºç ä¸€ä¸€è§£ç­”ã€‚æœ€åå†æ•´ä½“æ€»ç»“æ¢³ç†ä¸€ä¸‹æ•´ä½“æµç¨‹ï¼›",
      "fileName": "androidbindservice-liu-cheng-fen-xi"
    },
    {
      "content": "# Gitlab&æŒç»­é›†æˆ&æ•ˆç‡å·¥å…·\n\n```mermaid\ngraph \nGitlab[Gitlab&æŒç»­é›†æˆ&æ•ˆç‡å·¥å…·]\nGitlab --> æœåŠ¡ç»´æŠ¤\nGitlab --> Gitlab&Sonarä½¿ç”¨é—®é¢˜è§£ç­”ä¸è§£å†³\nGitlab --> CI[åŸºäºGitlab CIçš„è‡ªåŠ¨åŒ–æµç¨‹]\n```\n\n## æœåŠ¡ç»´æŠ¤\n\nç›®å‰æœ‰3ä¸ªæœåŠ¡å™¨éœ€è¦ç»´æŠ¤ï¼Œä¸Šé¢æœ‰éƒ¨ç½²è‹¥å¹²æœåŠ¡ï¼š\n\n```mermaid\ngraph \n205[172.17.0.205]\n206[172.17.0.206]\n208[172.17.0.208]\n\n205 --> gitlab\n206 --> sonarqube\n206 --> mattermost\n208 --> yapi\n208 --> confluence\n208 --> gitlab-runner\n208 --> ç§»åŠ¨ä¸­å¿ƒH5ç«™ç‚¹\n```\n\næœåŠ¡çš„è¿æ¥æ–¹å¼åŠéƒ¨ç½²çš„æœåŠ¡å¯ä»¥å‚è€ƒæ–‡æ¡£ï¼š [ã€ŠGitlab-SonarQubeæœåŠ¡ä¿¡æ¯æ±‡æ€»ã€‹](https://shimo.im/docs/REkKVZppmPcjFQqx/)ï¼Œ è¯¥æ–‡æ¡£è®°å½•äº†æœåŠ¡å™¨çš„sshè¿œç¨‹çš„æ–¹å¼ï¼Œå„æœåŠ¡çš„éƒ¨ç½²å¯åŠ¨æ–¹å¼ï¼Œéƒ¨ç½²çš„ç›®å½•ï¼›\n\nä»¥ä¸‹ç®€è¦è¯´æ˜å„ä¸ªæœåŠ¡çš„ç»´æŠ¤æ–¹å¼åŠå¯èƒ½é‡åˆ°çš„é—®é¢˜ã€‚\n\n### gitlabï¼ˆ205ï¼‰\n\n* éƒ¨ç½²ç›®å½•ï¼š `/data/gitlab/`\n\nteambitionçš„thoughtsä¸Šè®°å½•äº†éƒ¨åˆ†ä½¿ç”¨è¿‡ç¨‹ä¸­å¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼Œå¯ä»¥è®¿é—®[tbçš„æ­¤æ–‡æ¡£ç›®å½•](https://thoughts.teambition.com/workspaces/5e8da16aaf7af5001a4c7222/folders/5ee970c5b7ad5400012b51ac) è¿›è¡ŒæŸ¥é˜…ï¼›\n\nè¿™é‡Œæˆ‘ä»¬é‡ç‚¹å¼ºè°ƒä¸‹gitlabçš„é‡å¯å¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼Œ**ä½¿ç”¨è¿‡ç¨‹ä¸­å‘ç°ï¼Œåœ¨gitlabé‡å¯æ—¶ï¼Œå¦‚æœæœ‰gitlab-runnerä¸åœçš„å‘gitlabæœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œåˆ™æœ‰å¯èƒ½å¯¼è‡´gitlabæ— æ³•å¯åŠ¨ï¼Œæ•…æˆ‘ä»¬é‡‡å–gitlabå¯åŠ¨è¿‡ç¨‹ä¸­ä¸è¿æ¥ç½‘ç»œï¼Œå¯åŠ¨å®Œæˆåå†è¿æ¥ç½‘ç»œçš„æ–¹å¼å¯åŠ¨gitlab**è¯¦ç»†å¯å‚è€ƒ[tbä¸Šçš„æ­¤æ–‡ç« ](https://thoughts.teambition.com/workspaces/5e8da16aaf7af5001a4c7222/docs/5f4c5eaf77f66f00010659ae)ã€‚\n\n\n\n### sonarqube ï¼ˆ206ï¼‰\n\n* éƒ¨ç½²ç›®å½•ï¼š`/data/_data/sonarqube`\n\nä¸€èˆ¬åªéœ€è¦å¯åŠ¨åŠé‡å¯ï¼Œå¯å‚è€ƒ   [ã€ŠGitlab-SonarQubeæœåŠ¡ä¿¡æ¯æ±‡æ€»ã€‹](https://shimo.im/docs/REkKVZppmPcjFQqx/) çš„ç›¸å…³å°èŠ‚ï¼Œä¸»è¦å‘½ä»¤å¦‚ä¸‹ï¼š\n\n```shell\n# éƒ¨ç½²    \ndocker stack deploy -c docker-compose.yml sonarqube\n\n# åœæ­¢ \ndocker stack down sonarqube\n\n# é‡æ–°å¯åŠ¨\ndocker stack up sonarqube -c docker-compose.yml\n```\n\n### yapiï¼ˆ208ï¼‰\n\n* éƒ¨ç½²ç›®å½•ï¼š `/data/yapi-docker-deploy` \n\n```shell\n# å¯åŠ¨å‘½ä»¤\ndocker stack deploy -c docker-compose.yml yapi\n# å…¶ä»–ç»´æŠ¤å‘½ä»¤åŸºäºyapiçš„stackæ‰§è¡Œå³å¯\n```\n\n### mattermostç›¸å…³ï¼ˆ206ï¼‰\n\nmattermostç›¸å…³è¯·è”ç³»æ®µæ˜¥å…ˆ\n\n\n\n### gitlab-runnerï¼ˆ208ï¼‰\n\n208ä¸Šçš„gitlab-runnerä½œä¸ºéƒ¨é—¨çš„å…¬ç”¨runnerï¼Œæ‰§è¡Œå„ç§é€šç”¨ä»»åŠ¡ã€‚\n\n\n\næˆ‘ä»¬åœ¨208ä¸Šæ³¨å†Œå¯åŠ¨äº†ä¸¤ä¸ªrunnerï¼Œä¸€ä¸ªä½¿ç”¨dockeræ–¹å¼è¿è¡Œï¼Œä¸€ä¸ªä½¿ç”¨äºŒè¿›åˆ¶æ–¹å¼ç›´æ¥è¿è¡Œåœ¨ä¸»æœºä¸Šï¼Œä½¿ç”¨çš„æ—¶å€™éœ€è¦æ³¨æ„åŒºåˆ†ï¼›\n\n#### dockeræ–¹å¼è¿è¡Œçš„runner\n\n* ä½¿ç”¨dockeræ–¹å¼è¿è¡Œçš„runnerä½¿ç”¨geostarç”¨æˆ·è¿è¡Œï¼Œç”¨äºæ‰§è¡Œé€šç”¨ä»»åŠ¡ï¼Œä½¿ç”¨dockerä½œä¸ºæ‰§è¡Œå™¨ã€‚\n* ç›¸å…³ç»´æŠ¤æ“ä½œç›´æ¥å¯¹å®¹å™¨è¿›è¡Œå³å¯ï¼š\n  * é‡å¯ï¼š`docker restart gitlab-runner`\n  * æ‰©å±•äº†å‘½ä»¤åˆ«åï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨geostarç”¨æˆ·åœ¨ä¸»æœºä¸Šç›´æ¥æ‰§è¡Œ gitlab-runnerå‘½ä»¤æ—¶ï¼Œå®é™…ä¸Šæ—¶æ‰§è¡Œ `docker exec -it gitlab-runner [å‘½ä»¤]` \n  * æ‰§è¡Œå‘½ä»¤ï¼š`docker exec -it gitlab-runner bash`\n\n#### äºŒè¿›åˆ¶è¿è¡Œçš„runner\n\n* ä½¿ç”¨äºŒè¿›åˆ¶è¿è¡Œçš„runnerä½¿ç”¨rootç”¨æˆ·è¿è¡Œï¼Œä½¿ç”¨shellä½œä¸ºæ‰§è¡Œå™¨ï¼Œç”¨äºæ‰§è¡Œéœ€è¦ç›´æ¥æ“ä½œä¸»æœºçš„å‘½ä»¤ï¼Œå¦‚æ‰“åŒ…dockeré•œåƒã€‚\n* ç›¸å…³ç»´æŠ¤æ“ä½œéœ€è¦ä½¿ç”¨rootç”¨æˆ·å®Œæˆï¼ˆé€šè¿‡ /usr/bin/gitlab-runner å‘½ä»¤ï¼‰\n  * å¦‚ï¼ŒæŸ¥çœ‹çŠ¶æ€ï¼š`sudo /usr/bin/gitlab-runner status`\n\n## Gitlab&Sonarä½¿ç”¨é—®é¢˜è§£ç­”ä¸è§£å†³\n\nsonarqubeçš„å¯åŠ¨é‡å¯è¯·å‚è€ƒ [ã€ŠGitlab-SonarQubeæœåŠ¡ä¿¡æ¯æ±‡æ€»ã€‹](https://shimo.im/docs/REkKVZppmPcjFQqx/) ä¸­çš„sonarçš„éƒ¨ç½²æ–¹å¼ã€‚\n\n## åŸºäºGitlab CIçš„è‡ªåŠ¨åŒ–æµç¨‹ç›¸å…³\n\nè¿™é‡Œä¸‹é¢å¦å¤–å¯åŠ¨ä¸€ä¸ªç« èŠ‚è¯´æ˜\n\n\n\n# Gitlabç›¸å…³-Gitlabå®‰è£…åŠé…ç½®\n\n## å®‰è£…\n\næˆ‘ä»¬ä½¿ç”¨dockeræ¥å®‰è£…Gitlabï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å³å¯å®‰è£…è¿è¡Œï¼Œå®Œæˆåä½¿ç”¨\n\n```shell\nexport GITLAB_DATA=/data/gitlab\n# è®¾ç½®ä¸»æœºçš„ipåŸŸå\nexport HOST_IP=192.168.43.62\nmkdir $GITLAB_DATA/config $GITLAB_DATA/logs $GITLAB_DATA/data\ndocker run --detach \\\n        --hostname $HOST_IP \\\n        --publish 443:443 --publish 80:80 --publish 22:22 \\\n        --name gitlab \\\n        --restart always \\\n        --volume $GITLAB_DATA/config:/etc/gitlab \\\n        --volume $GITLAB_DATA/logs:/var/log/gitlab \\\n        --volume $GITLAB_DATA/data:/var/opt/gitlab \\\n        gitlab/gitlab-ce:13.9.1-ce.0\n```\n\n> * æ•°æ®å…¨éƒ¨æŒ‚è½½åœ¨å¤–éƒ¨ç›®å½• GITLAB_DATA ä¸­\n> * `--hostname 192.168.43.62` : æŒ‡å®šå½“å‰æœåŠ¡çš„IPæˆ–è€…åŸŸåï¼Œåç»­å°†ä¼šæ˜¾ç¤ºä¸ºgitlabä»£ç ä»“åº“çš„å…‹éš†åœ°å€\n> * `--restart always` : è®¾ç½®æœåŠ¡è‡ªåŠ¨é‡å¯\n\n> æŸ¥çœ‹gitlabçš„å¯ç”¨ç‰ˆæœ¬ï¼š \n>\n> * [dockerhub/gitlab-ce](dockerhub/gitlab-ce)\n> * [gitlab release page](https://about.gitlab.com/releases/categories/releases/)\n\n### **æŸ¥çœ‹å¯åŠ¨çŠ¶æ€**\n\nå¯åŠ¨æœŸé—´å¯ä»¥ä½¿ç”¨ `docker ps` æŸ¥çœ‹çŠ¶æ€ï¼Œå¦‚STATUSä¸­æ˜¾ç¤ºä¸º`starting`åˆ™è¡¨ç¤ºæœåŠ¡è¿˜åœ¨å¯åŠ¨ä¸­ï¼Œå¦‚æ˜¾ç¤ºä¸º`healthy`åˆ™è¡¨ç¤ºæœåŠ¡å·²æ­£å¸¸å¯åŠ¨ï¼Œå³å¯è®¿é—® http://192.168.43.62 è®¿é—®Gitlabçš„webåœ°å€ã€‚\n\n```shell\nCONTAINER ID        IMAGE                          COMMAND             CREATED             STATUS                 PORTS                                                          NAMES\n79b432f0f601        gitlab/gitlab-ce:13.0.6-ce.0   \"/assets/wrapper\"   2 months ago        Up 2 weeks (healthy)   0.0.0.0:22->22/tcp, 0.0.0.0:80->80/tcp, 0.0.0.0:443->443/tcp   gitlab\n```\n\nä¹Ÿå¯ä½¿ç”¨ `docker logs -f gitlab` æ¥æŸ¥çœ‹gitlabçš„æœåŠ¡å¯åŠ¨æ—¥å¿—\n\n### è®¾ç½®rootç®¡ç†å‘˜ç”¨æˆ·å¯†ç \n\né¦–æ¬¡æ‰“å¼€é¡µé¢åä¼šæç¤ºè®¾ç½®rootç”¨æˆ·çš„å¯†ç ï¼Œè®¾ç½®ååŠ¡å¿…è®°å½•å¥½ç”¨æˆ·å¯†ç ï¼Œåç»­å°†ä½¿ç”¨æ­¤ç”¨æˆ·å¯¹Gitlabè¿›è¡Œç®¡ç†\n\n<img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210302163607.png\" alt=\"image-20210302163607120\" style=\"zoom:50%;\" />\n\n## é…ç½®LDAP\n\næœåŠ¡å¯åŠ¨æ­£å¸¸åï¼Œ`$GITLAB_DATA/config` æ–‡ä»¶å¤¹ä¸­å³ç”Ÿæˆäº†gitlabçš„é…ç½®æ–‡ä»¶ï¼Œå¯ç¼–è¾‘`$GITLAB_DATA/config/gitlab.rb` ï¼ˆå¯¹åº”å®¹å™¨å†…éƒ¨ `/etc/gitlab/gitlab.rb` ï¼‰æ–‡ä»¶æ¥ä¿®æ”¹gitlabé…ç½®ä»¥ä½¿ç”¨LDAP\n\n```shell\nvim /etc/gitlab/gitlab.rb\n```\n\né€šè¿‡`?` æœç´¢`LDAP`ï¼Œæ‰¾åˆ°å¦‚ä¸‹é…ç½®ç«¯ï¼ŒæŒ‰å¦‚ä¸‹æ–¹å¼è¿›è¡Œä¿®æ”¹ï¼š\n\n```ruby\n### LDAP Settings\n###! Docs: https://docs.gitlab.com/omnibus/settings/ldap.html\n###! **Be careful not to break the indentation in the ldap_servers block. It is\n###!   in yaml format and the spaces must be retained. Using tabs will not work.**\n\ngitlab_rails['ldap_enabled'] = true\n\ngitlab_rails['ldap_servers'] = YAML.load <<-'EOS'\n   main:\n     label: 'åŸŸè´¦å·'\n     host: '172.17.0.3'\n     port: 389\n     uid: 'sAMAccountName'\n     bind_dn: 'CN=æ™ºæ…§åŸå¸‚Mattermostç³»ç»Ÿ,OU=é‚®ç®±ç”¨æˆ·,DC=geostar,DC=com,DC=cn'\n     password: '3uQ5V2LDgG'\n     encryption: 'plain' # \"start_tls\" or \"simple_tls\" or \"plain\"\n     verify_certificates: false\n     smartcard_auth: false\n     active_directory: true\n     allow_username_or_email_login: false # æ˜¯å¦å…è®¸ä»¥ç”¨æˆ·åç™»å½•ï¼ˆé‚®ç®±ä¹Ÿä¼šå–ç”¨æˆ·åæ¥ä¸¥é‡ï¼‰\n     lowercase_usernames: false\n     block_auto_created_users: false\n     base: 'OU=æ­¦å¤§å‰å¥¥-åŸŸç”¨æˆ·,DC=geostar,DC=com,DC=cn'\n     user_filter: ''\nEOS\n```\n\n> é…ç½®ä¿®æ”¹è¯´æ˜ï¼š\n>\n> * `ldap_enabled` éœ€è¦è®¾ç½®ä¸ºtrue\n> * `ldap_servers` é…ç½®ADåŸŸç›¸å…³ä¿¡æ¯\n>   * labelï¼š éšä¾¿å–ï¼Œä¼šæ˜¾ç¤ºåœ¨gitlabçš„ç™»å½•é¡µé¢\n>   * hostï¼š åŸŸæ§åˆ¶æœåŠ¡å™¨ä¸»æœºåœ°å€\n>   * portï¼š åŸŸæ§åˆ¶å™¨æœåŠ¡ç«¯å£\n>   * uidï¼š  å°†åŸŸç”¨æˆ·ä¿¡æ¯ä¸­çš„å“ªä¸ªå­—æ®µä½œä¸ºgitlabä¸Šçš„ç™»å½•æ ‡è¯†ï¼ˆä¸€èˆ¬éƒ½æ˜¯sAMAccountNameï¼‰\n>   * bind_dnï¼š ç”¨äºè®¿é—®åŸŸæ§åˆ¶æœåŠ¡å™¨çš„ç”¨æˆ·è´¦å·ï¼Œç”¨æˆ·è´¦å·çš„æ ¼å¼éœ€è¦ä½¿ç”¨`CN=xxx,OU=XXX,DC=XXXX` ç±»ä¼¼çš„æ ¼å¼\n>   * passwordï¼š å¯¹åº”çš„base_dnè´¦å·çš„å¯†ç \n>   * baseï¼š ç”¨äºç™»å½•æ—¶ï¼Œä¼šå»baseæ‰€å®šä¹‰çš„ç»„é‡Œé¢å»æ£€ç´¢ç”¨æˆ·æ˜¯å¦å­˜åœ¨ï¼Œå¦‚ç”¨æˆ·åœ¨è¿™ä¸ªèŒƒå›´å†…ï¼Œæ‰å¯ä»¥ç™»å½•ï¼›å¦‚åŠç”¨äºå…¬å¸ä¸€ä¸ªéƒ¨é—¨çš„ç™»å½•ï¼Œå¯å°†baseå€¼é…ç½®åˆ°éƒ¨é—¨çº§åˆ«ï¼Œåˆ™å…¶ä»–éƒ¨åˆ†æ— æ³•ä»¥åŸŸè´¦å·è¿›è¡Œç™»å½•ï¼›\n>\n> æç¤ºï¼š å¦‚æ— æ³•ç¡®è®¤ uidï¼Œbind_dnï¼Œbase ç­‰çš„å€¼ï¼Œå¯ä»¥å’¨è¯¢ä¿¡æ¯ä¸­å¿ƒæˆ–è€…ä½¿ç”¨ADåŸŸè®¿é—®æŸ¥çœ‹è½¯ä»¶ï¼ˆå¦‚ï¼š[Apache Directory](http://directory.apache.org/)ï¼‰è¿æ¥åˆ°åŸŸè´¦å·æ§åˆ¶å™¨æœåŠ¡åï¼Œé€šè¿‡å›¾å½¢ç•Œé¢æŸ¥çœ‹å¯¹åº”ä¿¡æ¯ï¼›\n\nä¿®æ”¹å®Œæ¯•åéœ€è¦ä¿å­˜æ–‡ä»¶åé‡å¯gitlabæœåŠ¡ï¼Œå¯¹äºdockerå¯åŠ¨çš„gitlabæ¥è¯´ï¼Œå¯æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤é‡å¯æœåŠ¡ï¼š\n\n```shell\n# å…¶ä¸­gitlabä¸ºæˆ‘ä»¬ä½¿ç”¨docker run å‘½ä»¤æ—¶é€šè¿‡--nameé€‰é¡¹æŒ‡å®šçš„å®¹å™¨åç§°\ndocker restart gitlab \n```\n\nå¾…gitlabé‡å¯å®Œæ¯•åï¼Œç™»å½•ç•Œé¢å³å‡ºç°åŸŸè´¦å·ç™»å½•çš„tabå…¥å£ï¼Œç‚¹å‡»åŸŸè´¦å·tabå³å¯ä½¿ç”¨åŸŸè´¦å·è¿›è¡Œç™»å½•\n\n<img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210302161215.png\" alt=\"image-20210302161215567\" style=\"zoom:50%;\" />\n\n## é…ç½®é‚®ç®±é€šçŸ¥\n\nå…¬å¸é‚®ç®±æœåŠ¡å™¨é…ç½®ï¼š\n\næˆ‘ä»¬ä½¿ç”¨å‘ä¿¡æ¯ä¸­å¿ƒç”³è¯·çš„å…¬å…±çš„mattermosté‚®ç®±è´¦å·ã€‚\n\n```ruby\ngitlab_rails['smtp_enable'] = true\ngitlab_rails['smtp_address'] = \"mail.geostar.com.cn\"\ngitlab_rails['smtp_port'] = 25\ngitlab_rails['smtp_user_name'] = \"zh-mattermost@geostar.com.cn\"\ngitlab_rails['smtp_password'] = \"3uQ5V2LDgG\"\ngitlab_rails['smtp_domain'] = \"geostar.com.cn\"\ngitlab_rails['smtp_authentication'] = \"login\"\ngitlab_rails['smtp_enable_starttls_auto'] = true\ngitlab_rails['smtp_tls'] = false\n```\n\n163é‚®ç®±é…ç½®ç¤ºä¾‹ï¼šï¼ˆéœ€åœ¨163é‚®ç®±ä¸­å¼€å¯SMTPæœåŠ¡ï¼Œå¯å‚è€ƒï¼š [CSDN-å¦‚ä½•ä½¿ç”¨163çš„SMTPæœåŠ¡å‘é‚®ä»¶ï¼Ÿ](https://blog.csdn.net/liuyuinsdu/article/details/113878840)ï¼‰\n\n```ruby\ngitlab_rails['smtp_enable'] = true\ngitlab_rails['smtp_address'] = \"smtp.163.com\"\ngitlab_rails['smtp_port'] = 25\ngitlab_rails['smtp_user_name'] = \"colorless@163.com\"\ngitlab_rails['smtp_password'] = \"å¯†ç \"\ngitlab_rails['smtp_domain'] = \"163.com\"\ngitlab_rails['smtp_authentication'] = \"login\"\ngitlab_rails['smtp_enable_starttls_auto'] = true\ngitlab_rails['smtp_tls'] = false\n```\n\n\n\n## å…³é—­åŠç®¡ç†å‘˜é…ç½®\n\n### èµ‹äºˆæŒ‡å®šåŸŸè´¦å·ç®¡ç†å‘˜æƒé™\n\nåœ¨é…ç½®äº†åŸŸè´¦å·ç™»å½•ä¹‹åï¼Œå…ˆè®©éœ€è¦è®¾ç½®ä¸ºç®¡ç†å‘˜çš„è´¦å·ä½¿ç”¨åŸŸè´¦å·ç™»å½•ä¸€æ¬¡gitlabï¼Œç™»å½•ågitlabå³ä¼šä¸ºè¯¥ç”¨æˆ·åˆ›å»ºå…³è”çš„gitlabè´¦å·ã€‚\n\nç„¶åä½¿ç”¨rootç”¨æˆ·ç™»å½•ï¼Œè¿›å…¥\n\n<img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210302164307.png\" alt=\"image-20210302164306980\" style=\"zoom:50%;\" />\n\nå°†ç”¨æˆ·çš„è®¿é—®ç±»å‹åˆ‡æ¢ä¸ºç®¡ç†å‘˜ï¼š\n\n<img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210302164354.png\" alt=\"image-20210302164354791\" style=\"zoom:50%;\" />\n\n### å…³é—­ç”¨æˆ·æ³¨å†Œ\n\nåœ¨é…ç½®äº†åŸŸè´¦å·ç™»å½•ä¹‹åï¼Œå¯ä»¥å…³é—­ç”¨æˆ·æ³¨å†Œï¼Œå³åªå…è®¸æ‹¥æœ‰åŸŸè´¦å·çš„äººå‘˜è¿›è¡Œç™»å½•ï¼›\n\n<img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210302164139.png\" alt=\"image-20210302164139380\" style=\"zoom:67%;\" />\n\n\n\n# Gitlabç›¸å…³-å®‰è£…å¹¶æ³¨å†ŒGitlab-Runner \n\n## å®‰è£…Gitlab-Runner\n\ngitlab-runnerå¯ä»¥ä½¿ç”¨dockeræ–¹å¼è¿è¡Œï¼Œä¹Ÿå¯ä»¥åœ¨ä¸»æœºä¸Šè¿è¡Œå…¶äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¯æŒ‰å¦‚ä¸‹æ–¹å¼è¿›è¡Œé€‰æ‹©ï¼š\n\n* æ‰§è¡Œé€šç”¨çš„æ„å»ºæµ‹è¯•ä»»åŠ¡åŠä¸ä¸éœ€è¦ç›´æ¥è®¿é—®ä¸»æœºç›®å½•çš„ï¼Œä»¥dockeræ–¹å¼å®‰è£…ï¼›\n* æ‰§è¡Œéƒ¨ç½²ç±»ä»»åŠ¡æˆ–éœ€è¦ç›´æ¥è®¿é—®ä¸»æœºç›®å½•çš„ï¼Œä»¥äºŒè¿›åˆ¶æ–¹å¼å®‰è£…ï¼›\n\nä»¥ä¸‹åˆ†åˆ«ä»‹ç»ä¸Šè¿°ä¸¤ç§å®‰è£…æ–¹å¼ã€‚\n\n\n\n### ä½¿ç”¨dockerå®‰è£…gitlab-runner\n\nä½¿ç”¨dockeræ–¹å¼å®‰è£…çš„ï¼Œéœ€å…ˆåœ¨ä¸»æœºä¸Šå®‰è£…dockerç¯å¢ƒï¼Œå¯å‚è€ƒ Docker å®˜æ–¹å®‰è£…æ–‡æ¡£ã€‚ä»¥ä¸‹æ“ä½œå‡è®¾ä¸»æœºä¸Šå·²æ­£ç¡®å®‰è£…å¹¶é…ç½®äº†dockerè¿è¡Œç¯å¢ƒï¼›\n\n>æç¤ºï¼šå¯ä»¥ä½¿ç”¨åŸºäºalpineçš„é•œåƒæ¥å‡å°å¤§å°\n\n```shell\n# å»ºç«‹é…ç½®æŒ‚è½½ç›®å½•\nmkdir -p /data/gitlab-runner/config\n# å»ºç«‹æ„å»ºç›®å½•æŒ‚è½½ç›®å½•\nmkdir -p /data/gitlab-runner/home\n# æ³¨æ„ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†åŸºäºalpineçš„é•œåƒæ¥å‡å°å¤§å°ï¼›ä½¿ç”¨ --restart æ ‡è¯†æ¥è‡ªåŠ¨é‡å¯\ndocker run -d --name gitlab-runner --restart always \\\n  -v /data/gitlab-runner/config:/etc/gitlab-runner \\\n  -v /data/gitlab-runner/home:/home/gitlab-runner \\\n  -v /var/run/docker.sock:/var/run/docker.sock \\\n  gitlab/gitlab-runner:alpine\n  \n# é€šè¿‡ä»¥ä¸‹å‘½ä»¤è®¾ç½®dockerå¼€æœºè‡ªå¯\nsudoÂ systemctl enable docker\n```\n\n### dockerå®‰è£…çš„gitlab-runnerå¸¸ç”¨æ“ä½œ\n\n#### è¿è¡Œå‘½ä»¤\n\nä½¿ç”¨å·²æœ‰å®¹å™¨\n\n```shell\n# å®¹å™¨å·²ç»è¿è¡Œçš„æƒ…å†µä¸‹\n# 1. äº¤äº’å¼æ‰§è¡Œï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œç„¶åè¾“å…¥å‘½ä»¤\ndocker exec -it gitlab-runner /bin/bash\n# ç„¶åæ‰§è¡Œå‘½ä»¤\ngitlab-runer --help\n# 2. å•æ¬¡æ‰§è¡Œ\ndocker exec gitlab-runner gitlab-runner --help\n```\n\nä½¿ç”¨ä¸´æ—¶çš„ï¼š\n\n```shell\ndocker run --rm -t -i gitlab/gitlab-runner:alpine --help\n# -it ä½¿ç”¨äº¤äº’å¼ç»ˆç«¯\n# --rm è‡ªåŠ¨åˆ é™¤\n```\n\n#### é‡å¯gitlab-runner\n\n```\ndocker restart gitlab-runner\n```\n\n#### å‡çº§ç‰ˆæœ¬\n\n```shell\n# è·å–æœ€æ–°\ndocker pull gitlab/gitlab-runner:alpine\ndocker stop gitlab-runner && docker rm gitlab-runner\ndocker run -d --name gitlab-runner --restart always \\\n  -v /var/run/docker.sock:/var/run/docker.sock \\\n  -v /data/gitlab-runner/config:/etc/gitlab-runner \\\n  -v /data/gitlab-runner/home:/home/gitlab-runner \\\n  gitlab/gitlab-runner:alpine\n```\n\n#### æŸ¥çœ‹æ—¥å¿—\n\n```shell\ndocker logs gitlab-runner\n```\n\n#### é…ç½® gitlab-runner åˆ«å\n\nåœ¨ `~/.bash_profile` æˆ– `~/.bashrc` æ–‡ä»¶ä¸­åŠ å…¥å¦‚ä¸‹å‡½æ•°é…ç½®ï¼Œåç»­è¿è¡Œ gitlab-runner å‘½ä»¤æ—¶å³å¯çœå»docker exec å‘½ä»¤\n\n```shell\n# æ·»åŠ  gitlab-runner ç›´æ¥æ‰§è¡Œåˆ°å®¹å™¨\nfunction gitlab-runner(){\n    docker exec -it gitlab-runner gitlab-runner $@\n}\n```\n\n\n\n### ä½¿ç”¨äºŒè¿›åˆ¶åŒ…å®‰è£…è¿è¡Œgitlab-runner\n\n#### è·å–å®‰è£…åŒ…å®‰è£…å¹¶è¿è¡Œ\n\n* Centos or RedHat ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å®‰è£…ï¼š\n\n  ```shell\n  ARCH=$(arch)\n  \n  curl -LJO \"https://gitlab-runner-downloads.s3.amazonaws.com/latest/rpm/gitlab-runner$ARCH.rpm\"\n  \n  rpm -i gitlab-runner_$ARCH.rpm\n  ```\n\n* Debian or Ubuntu ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å®‰è£…\n\n  ```shell\n  ARCH=$(arch)\n  \n  curl -LJO \"https://gitlab-runner-downloads.s3.amazonaws.com/latest/deb/gitlab-runner_$ARCH.deb\"\n  \n  dpkg -i gitlab-runner_$ARCH.deb\n  ```\n\n* Windows å®‰è£…\n\n  è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š https://docs.gitlab.com/runner/install/windows.html#installation\n\n* æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸï¼Œå¦‚èƒ½æˆåŠŸè¾“å‡ºgitlab-runnerçš„ç”¨æ³•ä¿¡æ¯ï¼Œåˆ™è¡¨ç¤ºå®‰è£…æˆåŠŸ\n\n  ```\n  gitlab-runner --help\n  ```\n\n* æµ‹è¯•æ˜¯å¦æˆåŠŸå¯åŠ¨\n\n  ```\n  gitlab-runner status\n  # å¦‚è¾“å‡º Service is runningï¼Œåˆ™è¡¨ç¤ºæˆåŠŸå¯åŠ¨äº†\n  ```\n\n  > é€šè¿‡dockeræ–¹å¼è¿è¡Œçš„runneråœ¨è¿è¡Œ `gitlab-runner status`æ—¶ä¼šè¾“å‡º `not running`ï¼Œè¿™å¯¹äºdockeræ–¹å¼è¿è¡Œçš„runneræ˜¯æ­£å¸¸çš„ï¼Œåªæœ‰ç›´æ¥è¿è¡Œäºä¸»æœºä¸Šçš„runneréœ€è¦å¯åŠ¨å¯¹åº”çš„æœåŠ¡ï¼›\n\n#### å®‰è£…å¹¶æ›´æ–°Gitç‰ˆæœ¬\n\nGitlab-CI ä»»åŠ¡åœ¨ runner æœºå™¨ä¸Šæ‰§è¡Œï¼Œä¼šå…ˆé€šè¿‡gitè·å–å¯¹åº”ä»“åº“çš„æœ€æ–°ä»£ç ï¼Œè¿™ä¸ªè·å–ä»£ç çš„æ“ä½œæ˜¯é€šè¿‡gitæ¥å®Œæˆçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å®‰è£…gitå·¥å…·ï¼›\n\n* **å®‰è£…Git**\n\n  ```shell\n  sudo yum install -y git\n   # æŸ¥çœ‹ç‰ˆæœ¬\n  git --version\n  # centos7 ä¸Šä¸º 1.8.xï¼Œæ— æ³•æ»¡è¶³gitlabè¦æ±‚\n  ```\n\n* **å‡çº§Gitç‰ˆæœ¬**\n\n  æŸäº›linuxå‘å‹ç‰ˆä¸Šgitç‰ˆæœ¬è¿‡ä½ï¼Œåœ¨æ‰§è¡Œæµæ°´çº¿æ—¶ä¼šå¤±è´¥ï¼Œéœ€è¦å‡çº§gitç‰ˆæœ¬ï¼Œå¯æŒ‰å¦‚ä¸‹æ–¹å¼ä»æºç å®‰è£…æœ€æ–°gitç‰ˆæœ¬ï¼›\n\n  * ä¸‹è½½git v2.27.0æºç \n\n    ```shell\n    ## ä»¥ä¸‹ä¸‹è½½æ–¹å¼ä»»é€‰å…¶ä¸€\n    # å¯é€‰ä¸‹è½½æ–¹å¼1 - ä»gitee å…‹éš†\n    git clone -b v2.27.0 https://gitee.com/hanlyjiang/git.git git-2.27.0\n    cd git-2.27.0 && git checkout -b tag-v2.27.0 v2.27.0\n    \n    # å¯é€‰ä¸‹è½½æ–¹å¼2 - ä»githubç›´æ¥ä¸‹è½½åŒ…\n    curl -LJO https://github.com/git/git/archive/v2.27.0.tar.gz\n    tar -xvf git-2.27.0.tar.gz \n    cd git-2.27.0\n    ```\n\n  * ç¼–è¯‘å®‰è£…\n\n    ```shell\n    # å®‰è£…ç¼–è¯‘ä¾èµ–åº“\n    sudo yum install  -y autoconf gcc openssh zlib-devel\n    \n    # ç¼–è¯‘å¹¶å®‰è£…\n    make configure ;# as yourself\n    ./configure --prefix=/usr ;# as yourself\n    make -j8 all ;# as yourself\n    sudo make install ;# as root\n    \n    # ç¡®è®¤ç‰ˆæœ¬ï¼š\n    git --version\n    # git version 2.27.0\n    ```\n\n#### å°†gitlab-runnerç”¨æˆ·æ·»åŠ åˆ°dockerç”¨æˆ·ç»„ï¼ˆå¯é€‰ï¼‰\n\nå¦‚éœ€è¦åœ¨è¯¥gitlab-runnerçš„CIè„šæœ¬ä¸­è¿è¡Œdockerå‘½ä»¤ï¼Œè¿™éœ€è¦å°† gitlab-runnerç”¨æˆ·æ·»åŠ åˆ°dockerçš„ç”¨æˆ·ç»„ï¼Œå¯æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š\n\n```shell\nsudo usermod -a -G docker gitlab-runner\n\n# éªŒè¯æƒé™\nsudo -u gitlab-runner -H docker info\n```\n\n#### ä¿®æ”¹ gitlab-runner æ„å»ºç›®å½•\n\nå¦‚åœ¨æ‰§è¡Œciä»»åŠ¡æ—¶ï¼Œæ‹‰å–ä»£ç æ—¶æŠ¥buildç›®å½•æƒé™é—®é¢˜ï¼Œå¯å°è¯•æŒ‰å¦‚ä¸‹æ–¹å¼ä¿®æ”¹æŒ‡å®šrunnerçš„æ„å»ºç›®å½•\n\n1. æŸ¥æ‰¾é…ç½®æ–‡ä»¶è·¯å¾„\n\n   ``` shell\n   gitlab-runner list \n   # å…¶ä¸­ConfigFileçš„å€¼å°±æ˜¯å¯¹åº”çš„é…ç½®æ–‡ä»¶ï¼Œå¦‚ï¼š\n   # ConfigFile=/etc/gitlab-runner/config.toml\n   ```\n\n2. ä¿®æ”¹ `builds_dir` æŒ‡å‘\n\n   æ‰¾å¯¹è¯¥ä»»åŠ¡å¯¹åº”çš„`[[runner]]` é…ç½®æ®µï¼Œå¹¶åœ¨è¯¥é…ç½®ä¸­æ·»åŠ  `builds_dir` æŒ‡å‘æ–°çš„å…·æœ‰æƒé™çš„ç›®å½•ï¼Œç„¶åé‡å¯å¯åŠ¨gitlab-runnerå³å¯ï¼›\n\n   ```yaml\n   [[runners]]\n     name = \"blockdataapi-engine\"\n     url = \"http://172.17.0.205/\"\n     token = \"Y-6zdV9zzi8xsY1rygbn\"\n     executor = \"shell\"\n     builds_dir = \"/data/gitlab-runner/builds\"\n     [runners.custom_build_dir]\n     [runners.cache]\n       [runners.cache.s3]\n       [runners.cache.gcs]\n   ```\n\n\n\n## æ³¨å†Œ Runner åˆ° Gitlab\n\nè¿™é‡Œæˆ‘ä»¬å°†runneræ³¨å†Œä¸ºç¾¤ç»„çš„Runnerï¼Œç¾¤ç»„runnerå¯ä»¥åœ¨ç¾¤ç»„ä¸­å…±äº«ï¼Œæ‰€æœ‰å­ç¾¤ç»„å’Œé¡¹ç›®éƒ½å¯ä»¥ä½¿ç”¨è¯¥Runnerã€‚ä¹Ÿå¯ä»¥å°†Runneræ³¨å†Œåˆ°æŒ‡å®šé¡¹ç›®ä»“åº“ä¸Šï¼Œæ“ä½œä¸Šåªæœ‰è·å–gitlab-runneræ³¨å†Œä¿¡æ¯æ—¶ä¸ä¸€æ ·ï¼›\n\n### è·å–gitlab-runneræ³¨å†Œä¿¡æ¯\n\n> å¦‚éœ€æ³¨å†Œåˆ°å…·ä½“é¡¹ç›®ï¼Œåœ¨é¡¹ç›®çš„è®¾ç½®åœ¨è¿›å…¥å¯¹åº”çš„CI/CDè®¾ç½®å³å¯ï¼Œåç»­æ“ä½œæµç¨‹ä¸€è‡´ï¼›\n\nåœ¨ç¾¤ç»„çš„è®¾ç½®ä¸­æ‰“å¼€ CI/CD è®¾ç½®\n\n![å›¾ç‰‡](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210224180602.png!thumbnail)\n\nå±•å¼€ Runner æ ä½\n\n![å›¾ç‰‡](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210224180606.png!thumbnail)\n\nè¿™é‡Œæˆ‘ä»¬é€‰æ‹©é€šè¿‡æ‰‹åŠ¨è®¾ç½®group runnerçš„æ–¹å¼æ¥æ³¨å†Œï¼Œå¯ä»¥è·å–åˆ°ä»¥ä¸‹ä¿¡æ¯ï¼š\n\n![å›¾ç‰‡](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210224180610.png!thumbnail)\n\n### æ³¨å†Œrunner\n\nä»¥dockeræ–¹å¼è¿è¡Œçš„gitlab-runnerå¯æŒ‰å¦‚ä¸‹æ–¹å¼è¿›å…¥äº¤äº’ç¯å¢ƒï¼Œ**ç›´æ¥äºŒè¿›åˆ¶è¿è¡Œçš„æ— éœ€æ­¤æ“ä½œ**ï¼›\n\nåœ¨gitlab-runner çš„æœºå™¨ä¸Šæ‰§è¡Œæ³¨å†Œå‘½ä»¤ï¼Œå°†runneræ³¨å†Œåˆ°gitlabï¼Œä¸ºäº†æ–¹ä¾¿æ“ä½œï¼Œæˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›å…¥gitlab-runnerå®¹å™¨shellç¯å¢ƒï¼š\n\n```shell\ndocker exec -it gitlab-runner /bin/bash\n```\n\næ‰§è¡Œå®Œæˆåå‡ºç°å¦‚ä¸‹äº¤äº’çª—å£\n\n```shell\nbash-4.4#\n```\n\ndockeræ–¹å¼è¿è¡Œçš„runneréœ€åœ¨æ­¤bashä¸­æ‰§è¡Œå‘½ä»¤ï¼Œä¸»æœºä¹‹é—´è¿è¡Œçš„runnerç›´æ¥åœ¨shellä¸­æ‰§è¡Œå³å¯ã€‚\n\n### æ‰§è¡Œregisterå‘½ä»¤è¿›è¡Œæ³¨å†Œ\n\n```shell\ngitlab-runner register \n# urlï¼š\nhttp://172.17.0.205/\n# token\ncEJ611JDeCWSMyu7WXWi\n# description - ç”¨äºè¾¨è¯†è¯¥æ³¨å†Œæ‰€å±çš„ç¾¤ç»„æˆ–é¡¹ç›®ï¼Œå¯ä»¥è®¾ç½®ä¸ºæ–¹ä¾¿åŒºåˆ†çš„å­—ç¬¦ä¸²\nsonarqube-runner\n# ci-tag - æ ‡ç­¾ç”¨äºåç»­CIé…ç½®ä¸­é€‰æ‹©æ­¤æ‰§è¡Œå™¨ï¼ŒåæœŸå¯ä»¥é€šè¿‡gitlabç•Œé¢æ›´æ”¹\nsonarqube,common-build\n# executor - åç»­CIä»»åŠ¡çš„æ‰§è¡Œæ–¹å¼ï¼Œdockeræ–¹å¼è¿è¡Œçš„è¯·é€‰æ‹©docker\ndocker\n# default image - CIé…ç½®ä¸­æœªæŒ‡å®šé•œåƒæ—¶é»˜è®¤ä½¿ç”¨çš„é•œåƒ\nbusybox:1.31.1\n```\n\nä»¥ä¸‹ä¸ºä¸€ä¸ªæ³¨å†Œè¿‡ç¨‹çš„äº¤äº’ç¤ºä¾‹ï¼š\n\n```shell\nbash-4.4# gitlab-runner registerÂ \nRuntime platformÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  arch=amd64 os=linux pid=205 revision=05161b14 version=12.4.1\nRunning in system-mode.Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â \nÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â \nPlease enter the gitlab-ci coordinator URL (e.g. https://gitlab.com/):\nhttp://172.17.0.205/\nPlease enter the gitlab-ci token for this runner:\ncEJ611JDeCWSMyu7WXWi\nPlease enter the gitlab-ci description for this runner:\n[e0311b0ce34b]: sonarqube-runner\nPlease enter the gitlab-ci tags for this runner (comma separated):\nsonarqube,common-build\nRegistering runner... succeededÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â runner=cEJ611JD\nPlease enter the executor: virtualbox, docker+machine, docker-ssh+machine, custom, docker-ssh, parallels, kubernetes, docker, shell, ssh:\ndocker\nPlease enter the default Docker image (e.g. ruby:2.6):\nbusybox:1.31.1\nRunner registered successfully. Feel free to start it, but if it's running already the config should be automatically reloaded!\n```\n\n### æ³¨å†Œåç¡®è®¤\n\nå®Œæˆååœ¨åˆšæ‰çš„é¡µé¢å¯ä»¥çœ‹åˆ°ï¼›\n![å›¾ç‰‡](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210224180615.png)\n\n### å–æ¶ˆæ³¨å†Œ\n\nä½¿ç”¨ list å‘½ä»¤æŸ¥çœ‹å½“å‰æ³¨å†Œçš„tokenåŠurl\n\n```shell\ngitlab-runner list\n# è¾“å‡ºç±»ä¼¼\nRuntime platform                                    arch=amd64 os=linux pid=23 revision=05161b14 version=12.4.1\nListing configured runners                          ConfigFile=/etc/gitlab-runner/config.toml\nsonarqube-runner                                    Executor=docker Token=wNwxjEztRpKxYDyK1zVd URL=http://172.17.0.205/\n```\n\nä½¿ç”¨listå‘½ä»¤è¾“å‡ºçš„tokenæœºurlä½œä¸ºå‚æ•° ä½¿ç”¨unregisterå‘½ä»¤å–æ¶ˆæ³¨å†Œ\n\n```shell\ngitlab-runner unregister -t 7KM7ftthLAYeJdsB3Tbk -u http://172.17.0.205/\n```\n\n\n\n## äº†è§£æ›´å¤š\n\n* [DOCKER æ–¹å¼å®‰è£…gitlab-runner](https://docs.gitlab.com/runner/install/docker.html)\n* [Linuxå®‰è£…gitlab-runner-Gitlabå®˜æ–¹æ–‡æ¡£](https://docs.gitlab.com/runner/install/linux-manually.html)\n* [ä½¿ç”¨Dockerè¿è¡ŒGitlab-Runner-Gitlabå®˜æ–¹æ–‡æ¡£](https://docs.gitlab.com/runner/install/docker.html)\n* [æ³¨å†ŒRunner-Gitlabå®˜æ–¹æ–‡æ¡£](https://docs.gitlab.com/runner/register/index.html)\n* [Gitlab-Runner alpine Dockerfile](https://gitlab.com/gitlab-org/gitlab-runner/blob/master/dockerfiles/alpine/Dockerfile)\n* [Windowsä¸Šæ³¨å†ŒRunner](https://docs.gitlab.com/runner/install/windows.html)\n* [å¦‚ä½•åœ¨dockeræ‰§è¡Œå™¨ä¸­æ„å»ºDockeré•œåƒï¼Ÿ](http://github.com/help/ci/docker/using_docker_build.md)\n\n\n\n# Gitlabç›¸å…³-GitlabCI&CDè‡ªåŠ¨åŒ–\n\n**å¯å…ˆé˜…è¯»æ–‡æ¡£ï¼š** \n\n* Gitlab&Mattermost&Sonarqubeä»‹ç»-æ— æ‰¹æ³¨.pdfï¼ˆæœ¬åœ°æ–‡ä»¶ï¼‰\n* [Gitlabåä½œå·¥å…·ä½¿ç”¨æŒ‡å¼•](http://172.17.0.205/Public-Share/gitlab-usage)\n\n**å…³é”®ç‚¹æ€»ç»“ï¼š**\n\n* ä¸»è¦æ¦‚å¿µï¼šGitlabï¼Œgitlab-ci.ymlï¼Œrunnerï¼Œæµæ°´çº¿ï¼Œjob\n\n  * Gitlab æä¾›ä»£ç æ‰˜ç®¡ï¼Œæä¾›ci/cdèƒ½åŠ›\n  * Gitlab-CIä» é¡¹ç›®æºç ä¸­çš„gitlab-ci.ymlæ–‡ä»¶ä¸­è¯»å–CIæµç¨‹ï¼Œç„¶åæ‰§è¡Œï¼Œæˆ‘ä»¬åœ¨æ­¤æ–‡ä»¶ä¸­å®šä¹‰æµæ°´çº¿åŠä»»åŠ¡\n  * Runneræ˜¯ä¸€ä¸ªå…·ä½“çš„æœºå™¨ï¼Œç”¨äºæ‰§è¡Œä»»åŠ¡\n\n* Runneræ‰§è¡Œå™¨ï¼š\n\n  * shellï¼šæ‰§è¡Œä¸æœºå™¨ç›¸å…³çš„ä»»åŠ¡ï¼Œéœ€è¦ä½¿ç”¨ä¸»æœºå‘½ä»¤çš„ï¼Œå¦‚dockeræ‰“åŒ…ï¼Œéƒ¨ç½²\n  * dockerï¼š ä½¿ç”¨å®¹å™¨æ‰§è¡Œé€šç”¨çš„æ„å»ºä»»åŠ¡\n  * æ³¨å†Œæµç¨‹å‚è€ƒï¼š[ã€Š2019/11/19-GitlabRunneré…ç½®-å…±äº«ã€‹](https://shimo.im/docs/PVAPV289P6tmFVql/ )\n\n* Gitlab-cié…ç½®å‚è€ƒï¼š http://172.17.0.205/help/ci/yaml/README.md\n\n* Gitlab-cié‡è¦é…ç½® - **job**\n\n  * å®šä¹‰è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œä½¿ç”¨scriptå®šä¹‰å…·ä½“è¦æ‰§è¡Œçš„å‘½ä»¤\n\n* Gitlab-cié‡è¦æ¦‚å¿µ - é˜¶æ®µ - å®šä¹‰æ‰§è¡Œé¡ºåº\n\n  * é¡¶å±‚çš„stageå®šä¹‰æµæ°´çº¿çš„é˜¶æ®µï¼Œjobä¸‹çš„stageç¡®å®šè¯¥jobçš„å½’å±ï¼ŒæŒ‰é¡¶å±‚çš„stageå®šä¹‰çš„é¡ºåºæ‰§è¡Œjob\n\n* Gitlab-cié‡è¦æ¦‚å¿µ - **å˜é‡** - ç”¨äºå‚æ•°åŒ–æ„å»ºæµç¨‹ \n\n  * é¢„å®šä¹‰å˜é‡ï¼šhttp://172.17.0.205/help/ci/variables/predefined_variables.md\n  * Gitlab Webç•Œé¢é…ç½®å˜é‡ï¼Œæ”¯æŒåœ¨ç¾¤ç»„åŠé¡¹ç›®çº§åˆ«åˆ†åˆ«é…ç½®ï¼Œé¡¹ç›®çº§åˆ«çš„ä¼˜å…ˆçº§è¾ƒé«˜\n  * gitlab-ci.yml ä¸­é…ç½®å˜é‡ï¼Œymlä¸­é…ç½®çš„å˜é‡ä¼šè¢«webç•Œé¢ä¸­é…ç½®çš„è¦†ç›–\n\n* Gitlab-cié‡è¦é…ç½® - å½’æ¡£\n\n  * ç”¨äºå°†æˆæœå½’æ¡£ï¼Œå¯ä¾›ä¸‹è½½\n  * ç”¨äºå°†æˆæœåœ¨ä¸åŒçš„é˜¶æ®µçš„jobä¸­ä¼ é€’ï¼ˆGitlabè‡ªåŠ¨å®Œæˆï¼‰\n  * ä½¿ç”¨æ—¶æŒ‡å®šè¦å½’æ¡£çš„æ–‡ä»¶ç›¸å¯¹äºCI_PROJECT_DIRçš„è·¯å¾„å³å¯\n  * **ç‰¹åˆ«æ³¨æ„**è¦é™åˆ¶å½’æ¡£å¯ä»¥å­˜å‚¨çš„æ—¶é—´ï¼Œé¿å…æ— ç”¨çš„å½’æ¡£æ–‡ä»¶å æ®gitlabç£ç›˜ç©ºé—´\n\n* Gitlab-cié‡è¦é…ç½® - è§„åˆ™ï¼ˆonlyï¼Œexceptï¼Œruleï¼‰\n\n  * **only/expect**\n\n  * - æäº¤ç›¸å…³ï¼š\n\n    - - branches - æ‰€æœ‰åˆ†æ”¯\n      - tags - æ‰€æœ‰æ ‡ç­¾\n      - pushes - æ¨é€\n      - merge_requests - æèµ·åˆå¹¶è¯·æ±‚\n      - external_pull_requests - å¤–éƒ¨åˆå¹¶è¯·æ±‚ï¼ˆåŸºæœ¬ç”¨ä¸åˆ°ï¼‰\n\n  * - å…¶ä»–ï¼š\n\n    - - api - è°ƒç”¨gitlab apiè§¦å‘\n      - external - æœªäº†è§£\n      - pipelines - æœªäº†è§£\n      - **schedules** ï¼š å®šæ—¶å™¨ï¼ˆgitlabCI/CDè®¾ç½®é¡µé¢è®¾ç½®ï¼‰\n      - triggersï¼š- æœªäº†è§£\n      - **web**ï¼š ç•Œé¢æ‰‹åŠ¨è§¦å‘\n      - chat - ç”¨ä¸åˆ°\n\n  * rules\n\n    * å‚è€ƒä½¿ç”¨è§„åˆ™å®šä¹‰ http://172.17.0.205/help/ci/yaml/README.md#rules\n    * å‚è€ƒç¤ºä¾‹ [GeoSocialè‡ªåŠ¨éƒ¨ç½²](http://172.17.0.205/geosocial-pc/auto-build-deploy/front-auto-deploy/-/blob/master/.gitlab-ci.yml)\n\n\n\n**CI/CDé…ç½®ç¤ºä¾‹**\n\n* [VuePress Webé¡¹ç›®CIè‡ªåŠ¨æ„å»ºåŠéƒ¨ç½²](http://172.17.0.205/Development/Mobile/geopanel/h5-sdk-api-document/-/blob/master/.gitlab-ci.yml)\n* Android\n  * [Androidé¡¹ç›®CIè‡ªåŠ¨æ‰“åŒ…-æ´ªå±±ç®¡ç†é€š](http://172.17.0.205/Development/Mobile/support/cgt-sgt/hongshan-sgt/-/blob/master/.gitlab-ci.yml)\n  * [Androidé¡¹ç›®è‡ªåŠ¨æ‰“åŒ…-ç§»åŠ¨ä¸­å¿ƒAPP](http://172.17.0.205/GeoPanel/MobileCenter/geopanel-android/-/blob/geo-client-android/master/.gitlab-ci.yml)\n* springboot:\n  * [springboot gradleè‡ªåŠ¨æ‰“åŒ…-GeoRobox3.0-åå°](http://172.17.0.205/Development/Mobile/georobox_3_0/georobox-mobile-server/-/blob/master/.gitlab-ci.yml)\n  * [springboot-gradleæ‰“åŒ…ç¤ºä¾‹-è‡ªåŠ¨æ‰“åŒ…-å¤šç¯å¢ƒéƒ¨ç½²](http://172.17.0.205/Public-Share/gitlab-ci-examples/springboot-gradle/-/blob/gitlab-ci/.gitlab-ci.yml)\n* sonarä»£ç æ£€æŸ¥ï¼š\n  * [ä½¿ç”¨å¸®åŠ©-Sonaræ£€æŸ¥é€šç”¨æ¨¡æ¿é…ç½®](http://172.17.0.205/Public-Share/gitlab-usage/-/wikis/%E4%BD%BF%E7%94%A8Gitlab/%E4%BD%BF%E7%94%A8gitlab-ci%E8%BF%9B%E8%A1%8Csonar%E4%BB%A3%E7%A0%81%E6%A3%80%E6%9F%A5#331-%E9%80%9A%E7%94%A8%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE%E9%99%A4msbuild%E4%B9%8B%E5%A4%96%E7%9A%84%E9%A1%B9%E7%9B%AE)\n  * [C#ä»£ç æ£€æŸ¥ç¤ºä¾‹é¡¹ç›®](http://172.17.0.205/Public-Share/gitlab-ci-examples/donet-sonar-scanner-sample-project/-/blob/master/.gitlab-ci.yml)\n  * [ç§»åŠ¨ä¸­å¿ƒAndroidä»£ç æ£€æŸ¥](http://172.17.0.205/GeoPanel/MobileCenter/geopanel-android/-/blob/geo-client-android/master/.gitlab-ci.yml)\n\n# Gitlabç›¸å…³-ä½¿ç”¨æç¤º\n\n## CIè„šæœ¬ä¸­å˜é‡å«æœ‰ç‰¹æ®Šå­—ç¬¦æ—¶çš„å¤„ç†\n\nå¯¹äºå˜é‡ä¸­æœ‰`$`çš„ï¼Œå¯ä»¥ä½¿ç”¨ä¸¤ä¸ª `$` æ¥è¿›è¡Œè½¬ä¹‰ï¼Œå¦‚ï¼š\n\n```\nrobot$$gitlab\n```\n\n\n\n## å¦‚ä½•æ£€æŸ¥CIé…ç½®ï¼Ÿ\n\n> æ³¨æ„ï¼š CIè§„åˆ™çš„æ£€æŸ¥æ˜¯å’Œé¡¹ç›®ç›¸å…³çš„ï¼Œåªèƒ½åœ¨å¯¹åº”çš„é¡¹ç›®ä¸­è¿›è¡Œæ£€æŸ¥\n\næ£€æŸ¥CIé…ç½®æ˜¯å¦åˆè§„ï¼Œå¯åœ¨é¡¹ç›®çš„CI/CDç•Œé¢ï¼Œç‚¹å‡»`CIé…ç½®æ£€æŸ¥ï¼ˆCI lintï¼‰`ï¼Œç„¶åç²˜è´´è‡ªå·±çš„é…ç½®åˆ°è¾“å…¥æ¡†ä¸­æ‰§è¡Œæ£€æŸ¥\n\n<img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210331103427.png\" alt=\"image-20210331103427469\" style=\"zoom:50%;\" />\n\n\n\n## Docker Runnerçš„æ„å»ºåŠ é€Ÿï¼ˆé…ç½®æ•°æ®å·ï¼‰\n\nDockerçš„Runneréå¸¸é€‚åˆç”¨äºä½œä¸ºé€šç”¨çš„æ„å»ºæœºå™¨ï¼Œä»¥æ‰§è¡Œå„ç§ä¸åŒç±»å‹çš„è¯­è¨€åŠä¸åŒæ‰“åŒ…å·¥å…·çš„ç¼–è¯‘ä»»åŠ¡ï¼Œæ¯”æ–¹è¯´gradle,mavenï¼Œnpmç­‰ç­‰ã€‚\n\nä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬çš„é¡¹ç›®éƒ½ä¼šä½¿ç”¨å¾ˆå¤šç¬¬ä¸‰æ–¹çš„ä¾èµ–ï¼Œè€Œä¸”è¿™äº›ä¾èµ–åªæ˜¯åœ¨æ„å»ºéœ€è¦æ—¶ä»ç½‘ç»œä¸Šè·å–ï¼Œç„¶åæ„å»ºå·¥å…·ä¼šå°†è¿™äº›åŒ…ç¼“å­˜åœ¨æŸä¸ªç›®å½•ä¸­ï¼Œå¦‚ï¼š\n\n* gradle ä¸€èˆ¬æ”¾ç½®åœ¨ `~/.gradle` ç›®å½•ä¸­ï¼ŒåŒæ—¶ä¹Ÿä¼šå­˜å‚¨ gradle çš„å„ç§ç‰ˆæœ¬ï¼›\n* mvn ä¸€èˆ¬æ”¾ç½®äº `~/.m2` ç›®å½•ä¸­ï¼›\n\nä½¿ç”¨å®¹å™¨æ„å»ºæ—¶ï¼Œè¿™äº›ç¼“å­˜ç›®å½•éƒ½ä½äºå®¹å™¨å†…éƒ¨ï¼Œä¹Ÿå°±æ˜¯æ¯æ¬¡éƒ½éœ€è¦é‡æ–°ä¸‹è½½ï¼Œéå¸¸æµªè´¹æ—¶é—´ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦èƒ½è®©è¿™äº›ç›®å½•å¯ä»¥è‡ªåŠ¨æŒ‚è½½åˆ°æ‰§è¡Œçš„å®¹å™¨ä¸­ï¼Œgitlab-runneræä¾›äº†è¿™ç§èƒ½åŠ›ï¼Œå…·ä½“é…ç½®æ–¹å¼å‚è€ƒå¦‚ä¸‹ï¼š\n\n1. æ‰¾åˆ°gitlab-runnerçš„é…ç½®æ–‡ä»¶ï¼Œå¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥æ‰¾ï¼ŒæŸ¥çœ‹å…¶ä¸­çš„ConfigFileæŒ‡å‘çš„ç›®å½•\n\n   ```shell\n   $ sudo /usr/bin/gitlab-runner list\n   \n   Runtime platform                                    arch=amd64 os=linux pid=15738 revision=05161b14 version=12.4.1\n   Listing configured runners                          ConfigFile=/etc/gitlab-runner/config.toml\n   blockdataapi-engine                                 Executor=shell Token=Y-6zdV9zzi8xsY1rygbn URL=http://172.17.0.205/\n   äº§å“å¼€å‘éƒ¨                                               Executor=shell Token=vdxuftxm6EL_fVgAS7Td URL=http://172.17.0.205/\n   ç§»åŠ¨ä¸­å¿ƒ-éƒ¨ç½²                                             Executor=shell Token=zx2vFV3x4S19n5mJDjD_ URL=http://172.17.0.205/\n   localhost                                           Executor=shell Token=3xHHCWiysKqf4kWdnA_e URL=http://172.17.0.205/\n   ```\n\n   > æ³¨æ„ï¼šå¦‚æœæ˜¯é€šè¿‡gitlabè¿è¡Œçš„gitlab-runnerï¼Œåˆ™åœ¨æŒ‚è½½çš„configç›®å½•\n\n2. æ‰¾åˆ°å¯¹åº”çš„Runneré…ç½®æ®µï¼Œå¯é€šè¿‡nameè¿›è¡ŒåŒºåˆ†\n\n   ```yaml\n   [[runners]]\n     name = \"sonarqube-runner\"\n     url = \"http://172.17.0.205/\"\n     token = \"wNwxjEztRpKxYDyK1zVd\"\n     executor = \"docker\"\n     [runners.custom_build_dir]\n     [runners.docker]\n       tls_verify = false\n       image = \"busybox:1.31.1\"\n       privileged = false\n       disable_entrypoint_overwrite = false\n       oom_kill_disable = false\n       disable_cache = false\n       shm_size = 0\n     [runners.cache]\n       [runners.cache.s3]\n       [runners.cache.gcs]\n   ```\n\n3. åœ¨  `[runners.docker]` é…ç½®ä¸­æ·»åŠ `volumes`é…ç½®ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼Œå†™æ³•äºé€šè¿‡dockeræŒ‚è½½å‘½åå·ä¸€è‡´ \n\n   ```yaml\n   [[runners]]\n     name = \"sonarqube-runner\"\n     url = \"http://172.17.0.205/\"\n     token = \"wNwxjEztRpKxYDyK1zVd\"\n     executor = \"docker\"\n     [runners.custom_build_dir]\n     [runners.docker]\n       tls_verify = false\n       image = \"busybox:1.31.1\"\n       privileged = false\n       disable_entrypoint_overwrite = false\n       oom_kill_disable = false\n       disable_cache = false\n       volumes = [\"/cache\", \"maven:/root/.m2\", \"gradle_gradle:/home/gradle/.gradle\", \"nginx_static:/work/html\", \"android_build_tools:/android-sdk/build-tools\", \"android_platforms:/android-sdk/platforms\", \"android_extras:/android-sdk/extras\"]\n       shm_size = 0\n     [runners.cache]\n       [runners.cache.s3]\n       [runners.cache.gcs]\n   ```\n\n   > æç¤ºï¼šä¿®æ”¹åç›´æ¥ä¿å­˜ï¼Œæ— éœ€é‡æ–°å¯åŠ¨gitlab-runnerï¼Œä¸‹æ¬¡å¯¹åº”çš„ä»»åŠ¡è·‘åˆ°è¿™ä¸ªrunnerä¸Šæ—¶ï¼Œå³ä¼šè‡ªåŠ¨ç”Ÿæ•ˆ\n\n   > è¿™é‡Œè§£é‡Šä¸‹å‡ ä¸ªå·çš„é…ç½®ï¼š\n   >\n   > * `\"maven:/root/.m2\"`: ä¸€èˆ¬çš„mavençš„é•œåƒçš„ç¼“å­˜é…ç½®ç›®å½•åœ¨`/root/.m2` \n   > * `\"gradle_gradle:/home/gradle/.gradle\"`: ä¸€èˆ¬çš„gradleé•œåƒçš„ç¼“å­˜ç›®å½• `/home/gradle/.gradle`\n   > * `\"nginx_static:/work/html\"`: ä¸ºæˆ‘ä»¬é€šè¿‡dockerå¯åŠ¨çš„ä¸€ä¸ªnginxæœåŠ¡ï¼Œå¯åŠ¨æ—¶æŒ‚è½½äº† nginx_static åˆ°/work/htmlï¼Œåœ¨ciä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬å¯åœ¨å®¹å™¨ä¸­å°†webèµ„æºæ‹·è´åˆ°æ‰§è¡Œä»»åŠ¡çš„å®¹å™¨å†…éƒ¨çš„/work/htmlç›®å½•å³å¯å°†webèµ„æºå‘å¸ƒåˆ°è¯¥runnerä¸Šå¯åŠ¨çš„nginxæœåŠ¡ä¸­\n   > * å¦å¤–ä¸¤ä¸ªéƒ½æ˜¯è‡ªè¡Œæ„å»ºçš„androidæ„å»ºé•œåƒçš„ç¼“å­˜ç›®å½•ã€‚\n\n## ä½¿ç”¨cache-ç¼“å­˜åŠ é€Ÿæ„å»º\n\nå¯ä½¿ç”¨gitlabçš„cacheå…³é”®å­—ç¼“å­˜æ„å»ºçš„ä¾èµ–ä¸‹è½½æ–‡ä»¶\n\n```yaml\ncache:\n  key: \"$CI_COMMIT_REF_SLUG\"\n  paths:\n    - node_modules/\n\nstages:\n    - test\n    - build\n    - deploy\n\nbuild:\n  stage: build\n  image: node:11-alpine\n  script:\n    # - npm install --registry=https://registry.npm.taobao.org\n    - npm install \n    - npm run build:prod\n  artifacts:\n    expire_in: 1 hours\n    name: \"$CI_PROJECT_NAME--$CI_COMMIT_REF_NAME--$CI_COMMIT_SHORT_SHA--$CI_JOB_NAME--$CI_JOB_ID\"\n    paths:\n      - dist/\n  tags:\n    - common-build\n  only:\n    - branches\n    - web\n```\n\nä¹‹ååœ¨ä»»åŠ¡å¼€å§‹æ—¶ï¼Œä¼šåŠ è½½ç¼“å­˜ï¼š\n\n![image-20210401153959401](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210406143904.png)\n\nåœ¨ä»»åŠ¡å®Œæˆåï¼Œä¼šä¿å­˜ç¼“å­˜ï¼š\n\n![image-20210401154038947](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210401154039.png)\n\né…ç½®å‰åçš„æ„å»ºæ—¶é—´å·®è·å¦‚ä¸‹ï¼šï¼ˆç¬¬ä¸€æ¬¡éœ€è¦3åˆ†é’Ÿï¼Œç¬¬äºŒæ¬¡åªéœ€è¦1åˆ†é’Ÿï¼‰\n\n![image-20210401154401344](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210401154404.png)\n\n> å‚è€ƒï¼š \n>\n> * [Cache dependencies in GitLab CI/CD](https://docs.gitlab.com/ee/ci/caching/index.html)\n> * [gitlab-ci.yaml - cache](https://docs.gitlab.com/ee/ci/yaml/README.html#cache)\n\n\n\n\n\n# Gitlabç›¸å…³-å‡çº§è®°å½•ï¼ˆ12.10.0-13.0.6ï¼‰\n\nè€ƒè™‘åˆ°åç»­å¯èƒ½éœ€è¦å¯¹gitlabè¿›è¡Œå‡çº§ï¼Œè¿™é‡Œå°†ä¹‹å‰çš„ä¸€æ¬¡å‡çº§è®°å½•è´´å‡ºï¼Œä¾›åç»­å‡çº§ä½œä¸ºå‚è€ƒã€‚\n\n> å‡çº§éœ€è¦é€‰æ‹©æ— äººä½¿ç”¨çš„æ—¶æ®µï¼Œå¹¶æå‰é€šçŸ¥ã€‚\n\n## å‡çº§å‡†å¤‡å·¥ä½œ\n\n### **ç¡®å®šå‡çº§è·¯çº¿**\n\n- ç°æœ‰ç‰ˆæœ¬ï¼š12.10.0\n- å½“ä¸‹ç›®æ ‡ç‰ˆæœ¬ï¼š13.0.6\n- ç»“åˆ [Gitlabå‡çº§è·¯çº¿å»ºè®®](https://docs.gitlab.com/ee/policy/maintenance.html#upgrade-recommendations) ç¡®å®šå¦‚ä¸‹å‡çº§è·¯çº¿ï¼š\n  - 12.10.0 -> 13.0.0 -> 13.0.6 \n  - ç”±äºæˆ‘ä»¬è·¨å¤§ç‰ˆæœ¬å‡çº§äº†ï¼ˆ12-13ï¼‰ï¼Œæ‰€ä»¥å¼•å…¥äº† 13.0.0 çš„ä¸­é—´å‡çº§è·¯å¾„\n\n### **è·å–æœ€æ–°ç‰ˆæœ¬ä¿¡æ¯**\n\n- æŸ¥çœ‹ gitlab releaseé¡µé¢ ä¿¡æ¯\n- æŸ¥çœ‹ gitlab docker hub è·å–gitlab-ce dockeré•œåƒç‰ˆæœ¬TAGï¼š\n- 13.0.0: `gitlab/gitlab-ce:13.0.0-ce.0`\n- 13.0.6: `gitlab/gitlab-ce:13.0.6-ce.0`\n- æŸ¥çœ‹å‡çº§æ³¨æ„äº‹é¡¹\n- å‡çº§æµç¨‹ï¼š https://docs.gitlab.com/omnibus/docker/README.html#update\n- ç‰ˆæœ¬å‡çº§å»ºè®®è·¯çº¿ï¼šhttps://docs.gitlab.com/ee/policy/maintenance.html#upgrade-recommendations\n\n## å¤‡ä»½\n\nå¤‡ä»½æœ‰ä¸¤ç§æ–¹å¼ï¼Œå¤‡ä»½çš„æ•°æ®é‡ä¸ç›¸åŒï¼š\n\n* å¯¹dockeræŒ‚è½½çš„gitlabæ•°æ®ç›®å½•æ•´ä½“å¤‡ä»½\n* ä½¿ç”¨ gitlabçš„ `gitlab-backup create` å‘½ä»¤åˆ›å»ºå¤‡ä»½ï¼Œå¯åŒ…å«æ‰€æœ‰gitä»“åº“ï¼ŒåŒ…æ‹¬wikiåŠæƒé™ä¿¡æ¯ã€‚\n\n> å»ºè®®å¯¹æŒ‚è½½çš„gitlabæ•°æ®ç›®å½•è¿›è¡Œä¸€æ¬¡æ•´ä½“å¤‡ä»½ï¼Œç›®å‰æš‚ä¸æ¸…æ¥šgitlab-backup createå‘½ä»¤åˆ›å»ºçš„å¤‡ä»½æ˜¯å¦åŒ…å«ciç›¸å…³å†…å®¹ã€‚\n\nä»¥ä¸‹å¯¹gitalb-backup å‘½ä»¤æ‰§è¡Œå¤‡ä»½è¿›è¡Œç®€è¦ä»‹ç»ã€‚æ•°æ®ç›®å½•çš„å¤‡ä»½æ–¹å¼ç›´æ¥å¯¹ç›®å½•è¿›è¡Œæ“ä½œå³å¯ã€‚\n\nè¿›å…¥åˆ°gitlabéƒ¨ç½²æœºå™¨ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š\n\n```shell l\ndocker exec -t <container name> gitlab-backup create\n# å¦‚æœdockerå®¹å™¨çš„åç§°æ˜¯gitlabï¼Œåˆ™å¯ä»¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå¤‡ä»½å®Œæˆåä½äºgitlabçš„æ•°æ®ç›®å½•ï¼Œå¦‚ï¼š/data/gitlab/data/backups/\ndocker exec -t $(docker ps | grep gitlab | awk '{print $1}') gitlab-backup create\n# å¤‡ä»½é…ç½®ç›®å½•\nsudo tar -cvf /data/gitlab/data/backups/1592710400_2020_06_21_12.10.0_gitlab_config_backup.tar /data/gitlab/config \n```\n\n## æ‰§è¡Œå‡çº§ï¼š\n\n- è¿›å…¥åˆ°gitlabéƒ¨ç½²æœºå™¨ \n\n```shell\nssh -p 10022 geostar@172.17.0.205\n```\n\n- è·å–Gitlabä¸­é—´ç‰ˆæœ¬é•œåƒåŠæœ€ç»ˆç‰ˆæœ¬é•œåƒ\n\n```shell\ndocker pull gitlab/gitlab-ce:13.0.0-ce.0\ndocker pull gitlab/gitlab-ce:13.0.6-ce.0\n```\n\n- åœæ­¢å¹¶ç§»é™¤ç°æœ‰æœåŠ¡\n\n```shell\nsudo docker stop gitlab \nsudo docker rm gitlab \n```\n\n- è¿›è¡Œå‡çº§ï¼Œä½¿ç”¨ 13.0.0 çš„é•œåƒè¿è¡Œgitlabï¼Œgitlabä¼šè‡ªåŠ¨å¤„ç†æ•°æ®å‡çº§æµç¨‹\n\n```shell\n    sudo docker run --detach \\\n        --hostname 172.17.0.205 \\\n        --publish 443:443 --publish 80:80 --publish 22:22 \\\n        --name gitlab \\\n        --restart always \\\n        --volume /data/gitlab/config:/etc/gitlab \\\n        --volume /data/gitlab/logs:/var/log/gitlab \\\n        --volume /data/gitlab/data:/var/opt/gitlab \\\n        gitlab/gitlab-ce:13.0.0-ce.0\n```\n\n- å¾… 13.0.0 å‡çº§å®Œæ¯•ä¹‹åï¼Œå‡çº§åˆ° 13.0.6ï¼Œä½¿ç”¨ 13.0.6 çš„é•œåƒè¿è¡Œgitlab\n\n```shell\n      sudo docker stop gitlab \n      sudo docker rm gitlab \n      sudo docker run --detach \\\n        --hostname 172.17.0.205 \\\n        --publish 443:443 --publish 80:80 --publish 22:22 \\\n        --name gitlab \\\n        --restart always \\\n        --volume /data/gitlab/config:/etc/gitlab \\\n        --volume /data/gitlab/logs:/var/log/gitlab \\\n        --volume /data/gitlab/data:/var/opt/gitlab \\\n        gitlab/gitlab-ce:13.0.6-ce.0\n```\n\n## ç¡®è®¤å‡çº§æˆåŠŸ\n\nç™»å½•ç®¡ç†å‘˜è´¦å·ï¼Œè¿›å…¥ç®¡ç†ä¸­å¿ƒ-ä»ªè¡¨ç›˜ï¼ŒæŸ¥çœ‹gitlabç‰ˆæœ¬ï¼š\n\n![image-20210302165417697](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210302165417.png)\n\n\n\n\n",
      "data": {
        "title": "å·¥ä½œäº¤æ¥-Gitlabç›¸å…³",
        "date": "2021-04-08 16:48:23",
        "tags": [
          "å·¥ä½œ"
        ],
        "published": false,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "å·¥ä½œäº¤æ¥-Gitlabç›¸å…³"
    },
    {
      "content": "# GeoPanel-ç§»åŠ¨ä¸­å¿ƒ-ä»£ç åŒæ­¥\n\n## ä¸€èˆ¬æ­¥éª¤\n\n1. å…‹éš†gitlabä»£ç åˆ°æœ¬åœ°\n\n\n\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n<svg version=\"1.1\" xmlns:dc=\"http://purl.org/dc/elements/1.1/\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xl=\"http://www.w3.org/1999/xlink\" viewBox=\"586.5 -80 601.5 198.46154\" width=\"601.5\" height=\"198.46154\">\n  <defs>\n    <font-face font-family=\"Helvetica\" font-size=\"16\" units-per-em=\"1000\" underline-position=\"-75.68359\" underline-thickness=\"49.316406\" slope=\"0\" x-height=\"522.9492\" cap-height=\"717.28516\" ascent=\"770.0195\" descent=\"-229.98047\" font-weight=\"400\">\n      <font-face-src>\n        <font-face-name name=\"Helvetica\"/>\n      </font-face-src>\n    </font-face>\n    <font-face font-family=\"PingFang SC\" font-size=\"16\" panose-1=\"2 11 4 0 0 0 0 0 0 0\" units-per-em=\"1000\" underline-position=\"-150\" underline-thickness=\"58\" slope=\"0\" x-height=\"600\" cap-height=\"860\" ascent=\"1060.0021\" descent=\"-340.0007\" font-weight=\"400\">\n      <font-face-src>\n        <font-face-name name=\"PingFangSC-Regular\"/>\n      </font-face-src>\n    </font-face>\n    <font-face font-family=\"Helvetica Neue\" font-size=\"16\" panose-1=\"2 0 5 3 0 0 0 2 0 4\" units-per-em=\"1000\" underline-position=\"-100\" underline-thickness=\"50\" slope=\"0\" x-height=\"517\" cap-height=\"714\" ascent=\"951.9958\" descent=\"-212.99744\" font-weight=\"400\">\n      <font-face-src>\n        <font-face-name name=\"HelveticaNeue\"/>\n      </font-face-src>\n    </font-face>\n    <font-face font-family=\"Courier New\" font-size=\"16\" panose-1=\"2 7 3 9 2 2 5 2 4 4\" units-per-em=\"1000\" underline-position=\"-232.91016\" underline-thickness=\"41.015625\" slope=\"0\" x-height=\"422.85156\" cap-height=\"571.28906\" ascent=\"832.5195\" descent=\"-300.29297\" font-weight=\"400\">\n      <font-face-src>\n        <font-face-name name=\"CourierNewPSMT\"/>\n      </font-face-src>\n    </font-face>\n  </defs>\n  <metadata> Produced by OmniGraffle 7.18.4\\n2021-03-23 05:56:46 +0000</metadata>\n  <g id=\"Canvas_1\" stroke=\"none\" fill-opacity=\"1\" fill=\"none\" stroke-opacity=\"1\" stroke-dasharray=\"none\">\n    <title>Canvas 1</title>\n    <g id=\"Canvas_1_Layer_1\">\n      <title>Layer 1</title>\n      <g id=\"Group_33\">\n        <title>General - Internet</title>\n        <g id=\"Group_35\">\n          <g id=\"Graphic_37\">\n            <path d=\"M 1188 27.79753 L 1188 34.97935 C 1188 47.996394 1173.6364 61.4623 1156.1307 61.4623 L 1061.8693 61.4623 C 1044.1392 61.4623 1030 48.220826 1030 34.97935 L 1030 27.79753 Z\" fill=\"#7d7c7c\"/>\n          </g>\n          <g id=\"Graphic_36\">\n            <path d=\"M 1090.821 -42.000765 C 1107.2045 -42.000765 1121.3438 -32.350197 1127.6278 -18.210992 C 1130.9943 -20.45531 1134.8097 -21.8019 1139.2983 -21.8019 C 1150.5199 -21.8019 1159.4972 -13.04906 1159.7216 -2.0519012 C 1175.6562 -.7053103 1188 14.556053 1188 26.899803 L 1188 29.592985 C 1188 42.83446 1173.6364 56.07594 1155.9062 56.07594 L 1061.8693 56.07594 C 1044.1392 56.07594 1030 42.83446 1030 29.592985 L 1030 26.899803 C 1030 16.800372 1038.5284 2.8855988 1050.4233 -.4808785 C 1050.4233 -.9297421 1050.4233 -1.154174 1050.4233 -1.6030376 C 1050.4233 -24.04622 1068.3778 -42.000765 1090.821 -42.000765 Z\" fill=\"#d2d3d3\"/>\n          </g>\n        </g>\n        <g id=\"Graphic_34\">\n          <text transform=\"translate(1085.4865 63.4623)\" fill=\"black\">\n            <tspan font-family=\"Helvetica\" font-size=\"16\" font-weight=\"400\" fill=\"black\" x=\"0\" y=\"15\">Gitlab</tspan>\n          </text>\n        </g>\n      </g>\n      <g id=\"Group_38\">\n        <title>Mobile Services - SNS - Topic</title>\n        <g id=\"Group_40\">\n          <title>Layer_1</title>\n          <g id=\"Group_53\">\n            <g id=\"Graphic_54\">\n              <rect x=\"586.5\" y=\"48.76923\" width=\"279\" height=\"47.69231\" fill=\"#692f56\"/>\n            </g>\n          </g>\n          <g id=\"Group_51\">\n            <g id=\"Graphic_52\">\n              <rect x=\"586.5\" y=\"-5.736264\" width=\"279\" height=\"43.263736\" fill=\"#692f56\"/>\n            </g>\n          </g>\n          <g id=\"Group_49\">\n            <g id=\"Graphic_50\">\n              <path d=\"M 865.1593 -28.9011 L 865.1593 -20.384615 L 586.5 -20.384615 L 586.5 -28.9011 L 746.95055 -75.23077 Z\" fill=\"#692f56\"/>\n            </g>\n          </g>\n          <g id=\"Group_47\">\n            <g id=\"Graphic_48\">\n              <rect x=\"586.5\" y=\"-80\" width=\"279\" height=\"51.0989\" fill=\"#ad688b\"/>\n              <text transform=\"translate(591.5 -65.45055)\" fill=\"white\">\n                <tspan font-family=\"PingFang SC\" font-size=\"16\" font-weight=\"400\" fill=\"white\" x=\"102.5\" y=\"17\">æœ¬åœ°ä»“åº“</tspan>\n              </text>\n            </g>\n          </g>\n          <g id=\"Group_45\">\n            <g id=\"Graphic_46\">\n              <rect x=\"586.5\" y=\"-13.571429\" width=\"279\" height=\"42.58242\" fill=\"#ad688b\"/>\n            </g>\n          </g>\n          <g id=\"Group_43\">\n            <g id=\"Graphic_44\">\n              <rect x=\"586.5\" y=\"45.36264\" width=\"279\" height=\"42.58242\" fill=\"#ad688b\"/>\n            </g>\n          </g>\n          <g id=\"Graphic_42\">\n            <rect x=\"595.35714\" y=\"-4.7142857\" width=\"260.94505\" height=\"24.527473\" fill=\"white\"/>\n            <text transform=\"translate(600.35714 -1.6745485)\" fill=\"black\">\n              <tspan font-family=\"Helvetica Neue\" font-size=\"16\" font-weight=\"400\" fill=\"black\" x=\"73.91253\" y=\"15\">remotes/origin</tspan>\n            </text>\n          </g>\n          <g id=\"Graphic_41\">\n            <rect x=\"595.35714\" y=\"54.56044\" width=\"260.94505\" height=\"24.527473\" fill=\"white\"/>\n          </g>\n        </g>\n        <g id=\"Graphic_39\">\n          <text transform=\"translate(677.9922 98.46154)\" fill=\"black\">\n            <tspan font-family=\"Courier New\" font-size=\"16\" font-weight=\"400\" fill=\"black\" x=\"4.800781\" y=\"13\">git clone </tspan>\n          </text>\n        </g>\n      </g>\n      <g id=\"Line_55\">\n        <line x1=\"865.5\" y1=\"19.23077\" x2=\"1030\" y2=\"21.23077\" stroke=\"black\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-dasharray=\"8.0,8.0\" stroke-width=\"2\"/>\n      </g>\n    </g>\n  </g>\n</svg>\n\n\n2. æ·»åŠ githubè¿œç¨‹ä»“åº“åˆ°æœ¬åœ°ä»“åº“ï¼ˆä¸‹é¢å–åä¸ºgithubï¼‰\n\n   å¯ä½¿ç”¨ `git remote -v show` å‘½ä»¤ç¡®è®¤å½“å‰è¯´æ³¨å†Œçš„è¿œç¨‹ä»“åº“åˆ—è¡¨\n\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n<svg version=\"1.1\" xmlns:dc=\"http://purl.org/dc/elements/1.1/\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xl=\"http://www.w3.org/1999/xlink\" viewBox=\"285 274 903 216.46154\" width=\"903\" height=\"216.46154\">\n  <defs>\n    <font-face font-family=\"Helvetica\" font-size=\"16\" units-per-em=\"1000\" underline-position=\"-75.68359\" underline-thickness=\"49.316406\" slope=\"0\" x-height=\"522.9492\" cap-height=\"717.28516\" ascent=\"770.0195\" descent=\"-229.98047\" font-weight=\"400\">\n      <font-face-src>\n        <font-face-name name=\"Helvetica\"/>\n      </font-face-src>\n    </font-face>\n    <font-face font-family=\"PingFang SC\" font-size=\"16\" panose-1=\"2 11 4 0 0 0 0 0 0 0\" units-per-em=\"1000\" underline-position=\"-150\" underline-thickness=\"58\" slope=\"0\" x-height=\"600\" cap-height=\"860\" ascent=\"1060.0021\" descent=\"-340.0007\" font-weight=\"400\">\n      <font-face-src>\n        <font-face-name name=\"PingFangSC-Regular\"/>\n      </font-face-src>\n    </font-face>\n    <font-face font-family=\"Helvetica Neue\" font-size=\"16\" panose-1=\"2 0 5 3 0 0 0 2 0 4\" units-per-em=\"1000\" underline-position=\"-100\" underline-thickness=\"50\" slope=\"0\" x-height=\"517\" cap-height=\"714\" ascent=\"951.9958\" descent=\"-212.99744\" font-weight=\"400\">\n      <font-face-src>\n        <font-face-name name=\"HelveticaNeue\"/>\n      </font-face-src>\n    </font-face>\n    <font-face font-family=\"Courier New\" font-size=\"16\" panose-1=\"2 7 3 9 2 2 5 2 4 4\" units-per-em=\"1000\" underline-position=\"-232.91016\" underline-thickness=\"41.015625\" slope=\"0\" x-height=\"422.85156\" cap-height=\"571.28906\" ascent=\"832.5195\" descent=\"-300.29297\" font-weight=\"400\">\n      <font-face-src>\n        <font-face-name name=\"CourierNewPSMT\"/>\n      </font-face-src>\n    </font-face>\n  </defs>\n  <metadata> Produced by OmniGraffle 7.18.4\\n2021-03-23 05:56:46 +0000</metadata>\n  <g id=\"Canvas_1\" stroke=\"none\" fill-opacity=\"1\" fill=\"none\" stroke-opacity=\"1\" stroke-dasharray=\"none\">\n    <title>Canvas 1</title>\n    <g id=\"Canvas_1_Layer_1\">\n      <title>Layer 1</title>\n      <g id=\"Group_3\">\n        <title>General - Internet</title>\n        <g id=\"Group_5\">\n          <g id=\"Graphic_7\">\n            <path d=\"M 443 414.7983 L 443 421.9801 C 443 434.99716 428.63636 448.46307 411.1307 448.46307 L 316.8693 448.46307 C 299.1392 448.46307 285 435.2216 285 421.9801 L 285 414.7983 Z\" fill=\"#7d7c7c\"/>\n          </g>\n          <g id=\"Graphic_6\">\n            <path d=\"M 345.82102 345 C 362.20455 345 376.34375 354.65057 382.62784 368.78977 C 385.9943 366.54545 389.80966 365.19886 394.2983 365.19886 C 405.5199 365.19886 414.49716 373.9517 414.7216 384.94886 C 430.65625 386.29545 443 401.5568 443 413.90057 L 443 416.59375 C 443 429.83523 428.63636 443.0767 410.90625 443.0767 L 316.8693 443.0767 C 299.1392 443.0767 285 429.83523 285 416.59375 L 285 413.90057 C 285 403.80114 293.5284 389.88636 305.4233 386.5199 C 305.4233 386.071 305.4233 385.8466 305.4233 385.39773 C 305.4233 362.95455 323.37784 345 345.82102 345 Z\" fill=\"#d2d3d3\"/>\n          </g>\n        </g>\n        <g id=\"Graphic_4\">\n          <text transform=\"translate(336.4865 450.46307)\" fill=\"black\">\n            <tspan font-family=\"Helvetica\" font-size=\"16\" font-weight=\"400\" fill=\"black\" x=\"0\" y=\"15\">GitHub</tspan>\n          </text>\n        </g>\n      </g>\n      <g id=\"Group_8\">\n        <title>General - Internet</title>\n        <g id=\"Group_10\">\n          <g id=\"Graphic_12\">\n            <path d=\"M 1188 381.79753 L 1188 388.97935 C 1188 401.9964 1173.6364 415.4623 1156.1307 415.4623 L 1061.8693 415.4623 C 1044.1392 415.4623 1030 402.22083 1030 388.97935 L 1030 381.79753 Z\" fill=\"#7d7c7c\"/>\n          </g>\n          <g id=\"Graphic_11\">\n            <path d=\"M 1090.821 311.99924 C 1107.2045 311.99924 1121.3438 321.6498 1127.6278 335.789 C 1130.9943 333.5447 1134.8097 332.1981 1139.2983 332.1981 C 1150.5199 332.1981 1159.4972 340.95094 1159.7216 351.9481 C 1175.6562 353.2947 1188 368.55605 1188 380.8998 L 1188 383.593 C 1188 396.83446 1173.6364 410.07594 1155.9062 410.07594 L 1061.8693 410.07594 C 1044.1392 410.07594 1030 396.83446 1030 383.593 L 1030 380.8998 C 1030 370.80037 1038.5284 356.8856 1050.4233 353.51912 C 1050.4233 353.07026 1050.4233 352.84583 1050.4233 352.39696 C 1050.4233 329.9538 1068.3778 311.99924 1090.821 311.99924 Z\" fill=\"#d2d3d3\"/>\n          </g>\n        </g>\n        <g id=\"Graphic_9\">\n          <text transform=\"translate(1085.4865 417.4623)\" fill=\"black\">\n            <tspan font-family=\"Helvetica\" font-size=\"16\" font-weight=\"400\" fill=\"black\" x=\"0\" y=\"15\">Gitlab</tspan>\n          </text>\n        </g>\n      </g>\n      <g id=\"Group_13\">\n        <title>Mobile Services - SNS - Topic</title>\n        <g id=\"Group_15\">\n          <title>Layer_1</title>\n          <g id=\"Group_28\">\n            <g id=\"Graphic_29\">\n              <rect x=\"586.5\" y=\"402.76923\" width=\"279\" height=\"47.69231\" fill=\"#692f56\"/>\n            </g>\n          </g>\n          <g id=\"Group_26\">\n            <g id=\"Graphic_27\">\n              <rect x=\"586.5\" y=\"348.26374\" width=\"279\" height=\"43.263736\" fill=\"#692f56\"/>\n            </g>\n          </g>\n          <g id=\"Group_24\">\n            <g id=\"Graphic_25\">\n              <path d=\"M 865.1593 325.0989 L 865.1593 333.6154 L 586.5 333.6154 L 586.5 325.0989 L 746.95055 278.76923 Z\" fill=\"#692f56\"/>\n            </g>\n          </g>\n          <g id=\"Group_22\">\n            <g id=\"Graphic_23\">\n              <rect x=\"586.5\" y=\"274\" width=\"279\" height=\"51.0989\" fill=\"#ad688b\"/>\n              <text transform=\"translate(591.5 288.54945)\" fill=\"white\">\n                <tspan font-family=\"PingFang SC\" font-size=\"16\" font-weight=\"400\" fill=\"white\" x=\"102.5\" y=\"17\">æœ¬åœ°ä»“åº“</tspan>\n              </text>\n            </g>\n          </g>\n          <g id=\"Group_20\">\n            <g id=\"Graphic_21\">\n              <rect x=\"586.5\" y=\"340.42857\" width=\"279\" height=\"42.58242\" fill=\"#ad688b\"/>\n            </g>\n          </g>\n          <g id=\"Group_18\">\n            <g id=\"Graphic_19\">\n              <rect x=\"586.5\" y=\"399.36264\" width=\"279\" height=\"42.58242\" fill=\"#ad688b\"/>\n              <text transform=\"translate(591.5 402.42985)\" fill=\"black\">\n                <tspan font-family=\"Helvetica Neue\" font-size=\"16\" font-weight=\"400\" fill=\"black\" x=\"130.5\" y=\"15\">s</tspan>\n              </text>\n            </g>\n          </g>\n          <g id=\"Graphic_17\">\n            <rect x=\"595.35714\" y=\"349.2857\" width=\"260.94505\" height=\"24.527473\" fill=\"white\"/>\n            <text transform=\"translate(600.35714 352.32545)\" fill=\"black\">\n              <tspan font-family=\"Helvetica Neue\" font-size=\"16\" font-weight=\"400\" fill=\"black\" x=\"73.91253\" y=\"15\">remotes/origin</tspan>\n            </text>\n          </g>\n          <g id=\"Graphic_16\">\n            <rect x=\"595.35714\" y=\"408.56044\" width=\"260.94505\" height=\"24.527473\" fill=\"white\"/>\n            <text transform=\"translate(600.35714 411.6002)\" fill=\"black\">\n              <tspan font-family=\"Helvetica Neue\" font-size=\"16\" font-weight=\"400\" fill=\"black\" x=\"71.23253\" y=\"15\">remotes/github</tspan>\n            </text>\n          </g>\n        </g>\n        <g id=\"Graphic_14\">\n          <text transform=\"translate(605.9805 452.46154)\" fill=\"black\">\n            <tspan font-family=\"Courier New\" font-size=\"16\" font-weight=\"400\" fill=\"black\" x=\"19.203125\" y=\"13\">git remote add github</tspan>\n            <tspan font-family=\"Courier New\" font-size=\"16\" font-weight=\"400\" fill=\"black\" x=\"0\" y=\"31\">https://github/com/xx.git</tspan>\n          </text>\n        </g>\n      </g>\n      <g id=\"Line_30\">\n        <line x1=\"586.5\" y1=\"409\" x2=\"443\" y2=\"408.23153\" stroke=\"black\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-dasharray=\"8.0,8.0\" stroke-width=\"2\"/>\n      </g>\n      <g id=\"Line_32\">\n        <line x1=\"865.5\" y1=\"382.23077\" x2=\"1030\" y2=\"375.23077\" stroke=\"black\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-dasharray=\"8.0,8.0\" stroke-width=\"2\"/>\n      </g>\n    </g>\n  </g>\n</svg>\n\n\n3. ä½¿ç”¨ `fetch` å‘½ä»¤è·å–githubè¿œç¨‹ä»“åº“ä»£ç åˆ°æœ¬åœ°\n\n   > é€šè¿‡ `git fetch github` è·å–githubè¿œç¨‹ä»“åº“ä¸Šçš„æ‰€æœ‰åˆ†æ”¯åŠtag\n   >\n   > å¦‚æˆ‘ä»¬éœ€è¦è·å–æŒ‡å®šåˆ†æ”¯ï¼ˆå¦‚ï¼šalphaåˆ†æ”¯ï¼‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ `git fetch github alpha:refs/remotes/github/alpha` åªæ‹‰å–æŒ‡å®šåˆ†æ”¯ï¼›\n   >\n   > å¦‚æœæˆ‘ä»¬éœ€è¦è·å–æŒ‡å®štagï¼ˆå¦‚ v1.3.3ï¼‰ï¼Œå¯é€šè¿‡ `git fetch github v1.3.3:refs/tagg/v1.3.3` åªæ‹‰å–æŒ‡å®štagï¼›\n\n\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n<svg version=\"1.1\" xmlns:dc=\"http://purl.org/dc/elements/1.1/\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xl=\"http://www.w3.org/1999/xlink\" viewBox=\"285 616.5008 903 198.46154\" width=\"903\" height=\"198.46154\">\n  <defs>\n    <font-face font-family=\"Helvetica\" font-size=\"16\" units-per-em=\"1000\" underline-position=\"-75.68359\" underline-thickness=\"49.316406\" slope=\"0\" x-height=\"522.9492\" cap-height=\"717.28516\" ascent=\"770.0195\" descent=\"-229.98047\" font-weight=\"400\">\n      <font-face-src>\n        <font-face-name name=\"Helvetica\"/>\n      </font-face-src>\n    </font-face>\n    <font-face font-family=\"PingFang SC\" font-size=\"16\" panose-1=\"2 11 4 0 0 0 0 0 0 0\" units-per-em=\"1000\" underline-position=\"-150\" underline-thickness=\"58\" slope=\"0\" x-height=\"600\" cap-height=\"860\" ascent=\"1060.0021\" descent=\"-340.0007\" font-weight=\"400\">\n      <font-face-src>\n        <font-face-name name=\"PingFangSC-Regular\"/>\n      </font-face-src>\n    </font-face>\n    <font-face font-family=\"Helvetica Neue\" font-size=\"16\" panose-1=\"2 0 5 3 0 0 0 2 0 4\" units-per-em=\"1000\" underline-position=\"-100\" underline-thickness=\"50\" slope=\"0\" x-height=\"517\" cap-height=\"714\" ascent=\"951.9958\" descent=\"-212.99744\" font-weight=\"400\">\n      <font-face-src>\n        <font-face-name name=\"HelveticaNeue\"/>\n      </font-face-src>\n    </font-face>\n    <font-face font-family=\"Courier New\" font-size=\"16\" panose-1=\"2 7 3 9 2 2 5 2 4 4\" units-per-em=\"1000\" underline-position=\"-232.91016\" underline-thickness=\"41.015625\" slope=\"0\" x-height=\"422.85156\" cap-height=\"571.28906\" ascent=\"832.5195\" descent=\"-300.29297\" font-weight=\"400\">\n      <font-face-src>\n        <font-face-name name=\"CourierNewPSMT\"/>\n      </font-face-src>\n    </font-face>\n    <marker orient=\"auto\" overflow=\"visible\" markerUnits=\"strokeWidth\" id=\"StickArrow_Marker\" stroke-linejoin=\"miter\" stroke-miterlimit=\"10\" viewBox=\"-6 -3 7 6\" markerWidth=\"7\" markerHeight=\"6\" color=\"black\">\n      <g>\n        <path d=\"M -4.8 0 L 0 0 M 0 1.8 L -4.8 0 L 0 -1.8\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1\"/>\n      </g>\n    </marker>\n  </defs>\n  <metadata> Produced by OmniGraffle 7.18.4\\n2021-03-23 06:35:35 +0000</metadata>\n  <g id=\"Canvas_1\" stroke=\"none\" fill-opacity=\"1\" fill=\"none\" stroke-opacity=\"1\" stroke-dasharray=\"none\">\n    <title>Canvas 1</title>\n    <g id=\"Canvas_1_Layer_1\">\n      <title>Layer 1</title>\n      <g id=\"Group_57\">\n        <title>General - Internet</title>\n        <g id=\"Group_59\">\n          <g id=\"Graphic_61\">\n            <path d=\"M 443 757.2991 L 443 764.4809 C 443 777.4979 428.63636 790.9638 411.1307 790.9638 L 316.8693 790.9638 C 299.1392 790.9638 285 777.7224 285 764.4809 L 285 757.2991 Z\" fill=\"#7d7c7c\"/>\n          </g>\n          <g id=\"Graphic_60\">\n            <path d=\"M 345.82102 687.5008 C 362.20455 687.5008 376.34375 697.1513 382.62784 711.2905 C 385.9943 709.0462 389.80966 707.6996 394.2983 707.6996 C 405.5199 707.6996 414.49716 716.4525 414.7216 727.4496 C 430.65625 728.7962 443 744.0576 443 756.4013 L 443 759.0945 C 443 772.336 428.63636 785.5775 410.90625 785.5775 L 316.8693 785.5775 C 299.1392 785.5775 285 772.336 285 759.0945 L 285 756.4013 C 285 746.3019 293.5284 732.3871 305.4233 729.02065 C 305.4233 728.5718 305.4233 728.34736 305.4233 727.8985 C 305.4233 705.4553 323.37784 687.5008 345.82102 687.5008 Z\" fill=\"#d2d3d3\"/>\n          </g>\n        </g>\n        <g id=\"Graphic_58\">\n          <text transform=\"translate(336.4865 792.9638)\" fill=\"black\">\n            <tspan font-family=\"Helvetica\" font-size=\"16\" font-weight=\"400\" fill=\"black\" x=\"0\" y=\"15\">GitHub</tspan>\n          </text>\n        </g>\n      </g>\n      <g id=\"Group_62\">\n        <title>General - Internet</title>\n        <g id=\"Group_64\">\n          <g id=\"Graphic_66\">\n            <path d=\"M 1188 724.2983 L 1188 731.4801 C 1188 744.4972 1173.6364 757.9631 1156.1307 757.9631 L 1061.8693 757.9631 C 1044.1392 757.9631 1030 744.7216 1030 731.4801 L 1030 724.2983 Z\" fill=\"#7d7c7c\"/>\n          </g>\n          <g id=\"Graphic_65\">\n            <path d=\"M 1090.821 654.5 C 1107.2045 654.5 1121.3438 664.1506 1127.6278 678.2898 C 1130.9943 676.04545 1134.8097 674.6989 1139.2983 674.6989 C 1150.5199 674.6989 1159.4972 683.4517 1159.7216 694.4489 C 1175.6562 695.79545 1188 711.0568 1188 723.4006 L 1188 726.09375 C 1188 739.3352 1173.6364 752.5767 1155.9062 752.5767 L 1061.8693 752.5767 C 1044.1392 752.5767 1030 739.3352 1030 726.09375 L 1030 723.4006 C 1030 713.3011 1038.5284 699.3864 1050.4233 696.0199 C 1050.4233 695.571 1050.4233 695.3466 1050.4233 694.8977 C 1050.4233 672.45455 1068.3778 654.5 1090.821 654.5 Z\" fill=\"#d2d3d3\"/>\n          </g>\n        </g>\n        <g id=\"Graphic_63\">\n          <text transform=\"translate(1085.4865 759.9631)\" fill=\"black\">\n            <tspan font-family=\"Helvetica\" font-size=\"16\" font-weight=\"400\" fill=\"black\" x=\"0\" y=\"15\">Gitlab</tspan>\n          </text>\n        </g>\n      </g>\n      <g id=\"Group_67\">\n        <title>Mobile Services - SNS - Topic</title>\n        <g id=\"Group_69\">\n          <title>Layer_1</title>\n          <g id=\"Group_82\">\n            <g id=\"Graphic_83\">\n              <rect x=\"586.5\" y=\"745.27\" width=\"279\" height=\"47.69231\" fill=\"#692f56\"/>\n            </g>\n          </g>\n          <g id=\"Group_80\">\n            <g id=\"Graphic_81\">\n              <rect x=\"586.5\" y=\"690.7645\" width=\"279\" height=\"43.263736\" fill=\"#692f56\"/>\n            </g>\n          </g>\n          <g id=\"Group_78\">\n            <g id=\"Graphic_79\">\n              <path d=\"M 865.1593 667.5997 L 865.1593 676.11615 L 586.5 676.11615 L 586.5 667.5997 L 746.95055 621.27 Z\" fill=\"#692f56\"/>\n            </g>\n          </g>\n          <g id=\"Group_76\">\n            <g id=\"Graphic_77\">\n              <rect x=\"586.5\" y=\"616.5008\" width=\"279\" height=\"51.0989\" fill=\"#ad688b\"/>\n              <text transform=\"translate(591.5 631.0502)\" fill=\"white\">\n                <tspan font-family=\"PingFang SC\" font-size=\"16\" font-weight=\"400\" fill=\"white\" x=\"102.5\" y=\"17\">æœ¬åœ°ä»“åº“</tspan>\n              </text>\n            </g>\n          </g>\n          <g id=\"Group_74\">\n            <g id=\"Graphic_75\">\n              <rect x=\"586.5\" y=\"682.9293\" width=\"279\" height=\"42.58242\" fill=\"#ad688b\"/>\n            </g>\n          </g>\n          <g id=\"Group_72\">\n            <g id=\"Graphic_73\">\n              <rect x=\"586.5\" y=\"741.8634\" width=\"279\" height=\"42.58242\" fill=\"#ad688b\"/>\n            </g>\n          </g>\n          <g id=\"Graphic_71\">\n            <rect x=\"595.35714\" y=\"691.7865\" width=\"260.94505\" height=\"24.527473\" fill=\"white\"/>\n            <text transform=\"translate(600.35714 694.8262)\" fill=\"black\">\n              <tspan font-family=\"Helvetica Neue\" font-size=\"16\" font-weight=\"400\" fill=\"black\" x=\"73.91253\" y=\"15\">remotes/origin</tspan>\n            </text>\n          </g>\n          <g id=\"Graphic_70\">\n            <rect x=\"595.35714\" y=\"751.0612\" width=\"260.94505\" height=\"24.527473\" fill=\"white\"/>\n            <text transform=\"translate(600.35714 754.1009)\" fill=\"black\">\n              <tspan font-family=\"Helvetica Neue\" font-size=\"16\" font-weight=\"400\" fill=\"black\" x=\"71.23253\" y=\"15\">remotes/github</tspan>\n            </text>\n          </g>\n        </g>\n        <g id=\"Graphic_68\">\n          <text transform=\"translate(649.1875 794.9623)\" fill=\"black\">\n            <tspan font-family=\"Courier New\" font-size=\"16\" font-weight=\"400\" fill=\"black\" x=\"0\" y=\"13\">git fetch github</tspan>\n          </text>\n        </g>\n      </g>\n      <g id=\"Line_84\">\n        <line x1=\"573.6002\" y1=\"751.4317\" x2=\"443\" y2=\"750.7323\" marker-start=\"url(#StickArrow_Marker)\" stroke=\"black\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\"/>\n      </g>\n      <g id=\"Line_85\">\n        <line x1=\"865.5\" y1=\"715.7315\" x2=\"1030\" y2=\"717.7315\" stroke=\"black\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-dasharray=\"8.0,8.0\" stroke-width=\"2\"/>\n      </g>\n    </g>\n  </g>\n</svg>\n\n\n\n\n4. å°†ä¸Šä¸€æ­¥æ‹‰å–çš„githubè¿œç¨‹ä»“åº“ä¸Šçš„åˆ†æ”¯/tagæ¨é€åˆ°gitlabè¿œç¨‹ä»“åº“çš„æŒ‡å®šåˆ†æ”¯ï¼›\n\n   > æ¨é€åˆ†æ”¯åˆ°gitlabï¼š`git push origin refs/remotes/github/alpha:alpha` \n   >\n   > æ¨é€tagåˆ°githubï¼š`git push origin refs/tags/v1.3.3:v1.3.3`\n\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n<svg version=\"1.1\" xmlns:dc=\"http://purl.org/dc/elements/1.1/\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xl=\"http://www.w3.org/1999/xlink\" viewBox=\"285 956 903 234.46154\" width=\"903\" height=\"234.46154\">\n  <defs>\n    <font-face font-family=\"Helvetica\" font-size=\"16\" units-per-em=\"1000\" underline-position=\"-75.68359\" underline-thickness=\"49.316406\" slope=\"0\" x-height=\"522.9492\" cap-height=\"717.28516\" ascent=\"770.0195\" descent=\"-229.98047\" font-weight=\"400\">\n      <font-face-src>\n        <font-face-name name=\"Helvetica\"/>\n      </font-face-src>\n    </font-face>\n    <font-face font-family=\"PingFang SC\" font-size=\"16\" panose-1=\"2 11 4 0 0 0 0 0 0 0\" units-per-em=\"1000\" underline-position=\"-150\" underline-thickness=\"58\" slope=\"0\" x-height=\"600\" cap-height=\"860\" ascent=\"1060.0021\" descent=\"-340.0007\" font-weight=\"400\">\n      <font-face-src>\n        <font-face-name name=\"PingFangSC-Regular\"/>\n      </font-face-src>\n    </font-face>\n    <font-face font-family=\"Helvetica Neue\" font-size=\"16\" panose-1=\"2 0 5 3 0 0 0 2 0 4\" units-per-em=\"1000\" underline-position=\"-100\" underline-thickness=\"50\" slope=\"0\" x-height=\"517\" cap-height=\"714\" ascent=\"951.9958\" descent=\"-212.99744\" font-weight=\"400\">\n      <font-face-src>\n        <font-face-name name=\"HelveticaNeue\"/>\n      </font-face-src>\n    </font-face>\n    <font-face font-family=\"Courier New\" font-size=\"16\" panose-1=\"2 7 3 9 2 2 5 2 4 4\" units-per-em=\"1000\" underline-position=\"-232.91016\" underline-thickness=\"41.015625\" slope=\"0\" x-height=\"422.85156\" cap-height=\"571.28906\" ascent=\"832.5195\" descent=\"-300.29297\" font-weight=\"400\">\n      <font-face-src>\n        <font-face-name name=\"CourierNewPSMT\"/>\n      </font-face-src>\n    </font-face>\n    <marker orient=\"auto\" overflow=\"visible\" markerUnits=\"strokeWidth\" id=\"FilledArrow_Marker\" stroke-linejoin=\"miter\" stroke-miterlimit=\"10\" viewBox=\"-1 -3 7 6\" markerWidth=\"7\" markerHeight=\"6\" color=\"black\">\n      <g>\n        <path d=\"M 4.8 0 L 0 -1.8 L 0 1.8 Z\" fill=\"currentColor\" stroke=\"currentColor\" stroke-width=\"1\"/>\n      </g>\n    </marker>\n  </defs>\n  <metadata> Produced by OmniGraffle 7.18.4\\n2021-03-23 06:34:36 +0000</metadata>\n  <g id=\"Canvas_1\" stroke=\"none\" fill-opacity=\"1\" fill=\"none\" stroke-opacity=\"1\" stroke-dasharray=\"none\">\n    <title>Canvas 1</title>\n    <g id=\"Canvas_1_Layer_1\">\n      <title>Layer 1</title>\n      <g id=\"Group_87\">\n        <title>General - Internet</title>\n        <g id=\"Group_89\">\n          <g id=\"Graphic_91\">\n            <path d=\"M 443 1096.7983 L 443 1103.9801 C 443 1116.9972 428.63636 1130.4631 411.1307 1130.4631 L 316.8693 1130.4631 C 299.1392 1130.4631 285 1117.2216 285 1103.9801 L 285 1096.7983 Z\" fill=\"#7d7c7c\"/>\n          </g>\n          <g id=\"Graphic_90\">\n            <path d=\"M 345.82102 1027 C 362.20455 1027 376.34375 1036.6506 382.62784 1050.7898 C 385.9943 1048.5455 389.80966 1047.1989 394.2983 1047.1989 C 405.5199 1047.1989 414.49716 1055.9517 414.7216 1066.9489 C 430.65625 1068.2955 443 1083.5568 443 1095.9006 L 443 1098.5938 C 443 1111.8352 428.63636 1125.0767 410.90625 1125.0767 L 316.8693 1125.0767 C 299.1392 1125.0767 285 1111.8352 285 1098.5938 L 285 1095.9006 C 285 1085.8011 293.5284 1071.8864 305.4233 1068.5199 C 305.4233 1068.071 305.4233 1067.8466 305.4233 1067.3977 C 305.4233 1044.9545 323.37784 1027 345.82102 1027 Z\" fill=\"#d2d3d3\"/>\n          </g>\n        </g>\n        <g id=\"Graphic_88\">\n          <text transform=\"translate(336.4865 1132.4631)\" fill=\"black\">\n            <tspan font-family=\"Helvetica\" font-size=\"16\" font-weight=\"400\" fill=\"black\" x=\"0\" y=\"15\">GitHub</tspan>\n          </text>\n        </g>\n      </g>\n      <g id=\"Group_92\">\n        <title>General - Internet</title>\n        <g id=\"Group_94\">\n          <g id=\"Graphic_96\">\n            <path d=\"M 1188 1063.7975 L 1188 1070.9793 C 1188 1083.9964 1173.6364 1097.4623 1156.1307 1097.4623 L 1061.8693 1097.4623 C 1044.1392 1097.4623 1030 1084.2208 1030 1070.9793 L 1030 1063.7975 Z\" fill=\"#7d7c7c\"/>\n          </g>\n          <g id=\"Graphic_95\">\n            <path d=\"M 1090.821 993.9992 C 1107.2045 993.9992 1121.3438 1003.6498 1127.6278 1017.789 C 1130.9943 1015.5447 1134.8097 1014.1981 1139.2983 1014.1981 C 1150.5199 1014.1981 1159.4972 1022.951 1159.7216 1033.9481 C 1175.6562 1035.2947 1188 1050.556 1188 1062.8998 L 1188 1065.593 C 1188 1078.8345 1173.6364 1092.076 1155.9062 1092.076 L 1061.8693 1092.076 C 1044.1392 1092.076 1030 1078.8345 1030 1065.593 L 1030 1062.8998 C 1030 1052.8004 1038.5284 1038.8856 1050.4233 1035.5191 C 1050.4233 1035.0703 1050.4233 1034.8458 1050.4233 1034.397 C 1050.4233 1011.9538 1068.3778 993.9992 1090.821 993.9992 Z\" fill=\"#d2d3d3\"/>\n          </g>\n        </g>\n        <g id=\"Graphic_93\">\n          <text transform=\"translate(1085.4865 1099.4623)\" fill=\"black\">\n            <tspan font-family=\"Helvetica\" font-size=\"16\" font-weight=\"400\" fill=\"black\" x=\"0\" y=\"15\">Gitlab</tspan>\n          </text>\n        </g>\n      </g>\n      <g id=\"Group_97\">\n        <title>Mobile Services - SNS - Topic</title>\n        <g id=\"Group_99\">\n          <title>Layer_1</title>\n          <g id=\"Group_112\">\n            <g id=\"Graphic_113\">\n              <rect x=\"586.5\" y=\"1084.7692\" width=\"279\" height=\"47.69231\" fill=\"#692f56\"/>\n            </g>\n          </g>\n          <g id=\"Group_110\">\n            <g id=\"Graphic_111\">\n              <rect x=\"586.5\" y=\"1030.2637\" width=\"279\" height=\"43.263736\" fill=\"#692f56\"/>\n            </g>\n          </g>\n          <g id=\"Group_108\">\n            <g id=\"Graphic_109\">\n              <path d=\"M 865.1593 1007.0989 L 865.1593 1015.6154 L 586.5 1015.6154 L 586.5 1007.0989 L 746.95055 960.7692 Z\" fill=\"#692f56\"/>\n            </g>\n          </g>\n          <g id=\"Group_106\">\n            <g id=\"Graphic_107\">\n              <rect x=\"586.5\" y=\"956\" width=\"279\" height=\"51.0989\" fill=\"#ad688b\"/>\n              <text transform=\"translate(591.5 970.5495)\" fill=\"white\">\n                <tspan font-family=\"PingFang SC\" font-size=\"16\" font-weight=\"400\" fill=\"white\" x=\"102.5\" y=\"17\">æœ¬åœ°ä»“åº“</tspan>\n              </text>\n            </g>\n          </g>\n          <g id=\"Group_104\">\n            <g id=\"Graphic_105\">\n              <rect x=\"586.5\" y=\"1022.4286\" width=\"279\" height=\"42.58242\" fill=\"#ad688b\"/>\n            </g>\n          </g>\n          <g id=\"Group_102\">\n            <g id=\"Graphic_103\">\n              <rect x=\"586.5\" y=\"1081.3626\" width=\"279\" height=\"42.58242\" fill=\"#ad688b\"/>\n            </g>\n          </g>\n          <g id=\"Graphic_101\">\n            <rect x=\"595.35714\" y=\"1031.2857\" width=\"260.94505\" height=\"24.527473\" fill=\"white\"/>\n            <text transform=\"translate(600.35714 1034.3255)\" fill=\"black\">\n              <tspan font-family=\"Helvetica Neue\" font-size=\"16\" font-weight=\"400\" fill=\"black\" x=\"73.91253\" y=\"15\">remotes/origin</tspan>\n            </text>\n          </g>\n          <g id=\"Graphic_100\">\n            <rect x=\"595.35714\" y=\"1090.5604\" width=\"260.94505\" height=\"24.527473\" fill=\"white\"/>\n            <text transform=\"translate(600.35714 1093.6002)\" fill=\"black\">\n              <tspan font-family=\"Helvetica Neue\" font-size=\"16\" font-weight=\"400\" fill=\"black\" x=\"71.23253\" y=\"15\">remotes/github</tspan>\n            </text>\n          </g>\n        </g>\n        <g id=\"Graphic_98\">\n          <text transform=\"translate(572.375 1134.4615)\" fill=\"black\">\n            <tspan font-family=\"Courier New\" font-size=\"16\" font-weight=\"400\" fill=\"black\" x=\"76.05078\" y=\"13\">git push origin </tspan>\n            <tspan font-family=\"Courier New\" font-size=\"16\" font-weight=\"400\" fill=\"black\" x=\"52.046875\" y=\"31\">refs/remotes/github/</tspan>\n            <tspan font-family=\"Courier New\" font-size=\"16\" font-weight=\"400\" fill=\"black\" x=\"95.25391\" y=\"49\">alpha:alpha </tspan>\n          </text>\n        </g>\n      </g>\n      <g id=\"Line_114\">\n        <line x1=\"586.5\" y1=\"1091\" x2=\"443\" y2=\"1090.2315\" stroke=\"black\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-dasharray=\"8.0,8.0\" stroke-width=\"2\"/>\n      </g>\n      <g id=\"Line_115\">\n        <line x1=\"870.5\" y1=\"1034.1538\" x2=\"1017.2329\" y2=\"1055.3836\" marker-end=\"url(#FilledArrow_Marker)\" stroke=\"black\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\"/>\n      </g>\n    </g>\n  </g>\n</svg>\n\n\n\n\n\n\n## ç§»åŠ¨ä¸­å¿ƒåŒæ­¥è„šæœ¬è¯´æ˜\n\n> åŒæ­¥è„šæœ¬gitlabåœ°å€ï¼š [syncCode.sh](http://172.17.0.205/Development/Mobile/tools/all/-/blob/master/scripts/sync-code/syncCode.sh)\n\n### ç”¨æ³•è¯´æ˜\n\n```shell\nsource syncCode.sh\nWORKDIR=/Users/hanlyjiang/Wksp/work/gitlab/MOA-auto-sync\n# ç§»åŠ¨ç«¯ä»£ç åŒæ­¥ \nsync_work_repo_branch https://chuanqi900:stgzsz821006@github.com/3930615/moa-release-geo.git $WORKDIR/moa-release-geo-github.git git@172.17.0.205:GeoPanel/MobileCenter/geopanel-android.git \n# åå°ä»£ç åŒæ­¥\nsync_work_repo_branch https://chuanqi900:stgzsz821006@github.com/3930615/moa-release.git $WORKDIR/moa-release-github.git git@172.17.0.205:GeoPanel/MobileCenter/geopanel-mobile-server.git\n```\n\næ‰§è¡Œå¦‚ä¸ŠåŒæ­¥å‘½ä»¤ä¹‹åï¼Œä¼šå°†ä»é“¾åŠ¨githubä»“åº“è·å–çš„æ‰€æœ‰åˆ†æ”¯åŠtagæ¨é€åˆ°gitlabä»“åº“ï¼›\n\n\n\n\n\n# GeoPanel-ç§»åŠ¨ä¸­å¿ƒ-ARMé•œåƒåˆ¶ä½œ-æˆæœé“¾æ¥\n\næœ¬èŠ‚ä»‹ç»ç§»åŠ¨ä¸­å¿ƒå›½äº§åŒ–çš„æ„å»ºæˆæœï¼Œè¯·é˜…è¯»ä»¥ä¸‹æ–‡ç« ï¼š\n\n* [ã€Šç§»åŠ¨ä¸­å¿ƒå›½äº§åŒ–-ARMè¿ç§»åŸºæœ¬æ€è·¯ã€‹](https://shimo.im/docs/0l3NVKX0BgflYN3R/)\n* [ã€Šç§»åŠ¨ä¸­å¿ƒå›½äº§åŒ–-MOAæœåŠ¡è¿ç§»è®°å½•ã€‹](https://shimo.im/docs/VHgRHrXYq9vQkX3Q/ )\n* [ã€Šç§»åŠ¨ä¸­å¿ƒå›½äº§åŒ–-å®æ—¶éŸ³è§†é¢‘æœåŠ¡è¿ç§»è®°å½•ã€‹](https://shimo.im/docs/gO3ox1XzJlHlVzqD/ )\n\nç›¸å…³æˆæœå·²ä¸Šä¼ åˆ°gitlabä»“åº“çš„å¦‚ä¸‹åˆ†æ”¯ï¼š\n\n* [arm/0.5.0-dev](http://zh-gitlab.geostar.com.cn/GeoPanel/MobileCenter/geopanel-mobile-server/-/tree/arm/0.5.0-dev)\n* [arm/v0.3.0-im](http://zh-gitlab.geostar.com.cn/GeoPanel/MobileCenter/geopanel-mobile-server/-/tree/arm/v0.3.0-im)\n\n\n\n# GeoPanel-ç§»åŠ¨ä¸­å¿ƒ-APPç›¸å…³\n\næœ¬å°èŠ‚ä»‹ç»ç§»åŠ¨ä¸­å¿ƒAPPç›¸å…³å†…å®¹ï¼Œä¸»è¦åŒ…æ‹¬å¦‚ä¸‹å†…å®¹ï¼š\n\n* é¡¹ç›®ä»“åº“ä»‹ç»\n* æ³¨æ„ç‚¹ä»‹ç»ï¼šä¸»è¦æ˜¯æˆ‘æ–¹è¿›è¡Œçš„ä¸€äº›ä¿®æ”¹ï¼Œå¯¹ä¿®æ”¹ç‚¹æœ‰æ‰€äº†è§£ï¼Œä»¥ä¾¿åç»­éœ€è¦åˆå¹¶ä»£ç æ—¶å‡å°‘å¯èƒ½ç”±åˆå¹¶å¯¼è‡´çš„é”™è¯¯ã€‚\n\n## é¡¹ç›®ä»“åº“ä»‹ç»\n\n### é¡¹ç›®åœ°å€\n\n* é¡¹ç›®ä»“åº“åœ°å€ï¼š http://172.17.0.205/GeoPanel/MobileCenter/geopanel-android\n* ç›¸å…³æ–‡æ¡£ï¼š \n\n### ä»“åº“åˆ†æ”¯åŠTagè¯´æ˜\n\n#### åˆ†æ”¯è¯´æ˜\n\næ­¤ä»“åº“åŒæ­¥äº†é“¾åŠ¨çš„ä»£ç åˆ†æ”¯ï¼Œå¹¶æ–°å»ºæ–°çš„åˆ†æ”¯å¯¹é“¾åŠ¨ä»£ç è¿›è¡Œä¿®æ”¹ï¼Œå…·ä½“åˆ†æ”¯è·Ÿè¸ªå…³ç³»å¦‚ä¸‹ï¼š\n\n\n<svg width=\"834px\" height=\"587px\" viewBox=\"0 0 834 587\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n    <g id=\"é¡µé¢-1\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n        <g id=\"ç§»åŠ¨ä¸­å¿ƒAPPåˆ†æ”¯å›¾\" transform=\"translate(-196.000000, -78.000000)\">\n            <g id=\"export\" transform=\"translate(197.000000, 79.000000)\">\n                <g id=\"Githubé“¾åŠ¨åˆ†æ”¯\">\n                    <g id=\"æ¶æ„å›¾/å¸¦æ ‡é¢˜æ æ¡†\">\n                        <g id=\"ç¼–ç»„\" stroke-linejoin=\"round\">\n                            <g id=\"åˆ†ç»„\">\n                                <rect id=\"è¾¹æ¡†æ \" stroke=\"#FF9500\" x=\"0.5\" y=\"0.5\" width=\"283\" height=\"584\"></rect>\n                                <rect id=\"æ ‡é¢˜æ \" fill=\"#FF9500\" x=\"0\" y=\"0\" width=\"284\" height=\"26\"></rect>\n                            </g>\n                        </g>\n                        <text id=\"æ ‡é¢˜\" font-family=\"PingFangSC-Regular, PingFang SC\" font-size=\"16\" font-weight=\"normal\" letter-spacing=\"0.0959999995\" fill=\"#FFFFFF\">\n                            <tspan x=\"84.8480622\" y=\"17\">é“¾åŠ¨Githubä»“åº“</tspan>\n                        </text>\n                    </g>\n                    <g id=\"åˆ†æ”¯/ç›´çº¿åˆ†æ”¯å¤‡ä»½-7\" transform=\"translate(20.000000, 499.000000)\">\n                        <line x1=\"0.603462208\" y1=\"20.5434783\" x2=\"234.508368\" y2=\"20.5434783\" id=\"åˆ†æ”¯ç›´çº¿\" stroke=\"#979797\" stroke-width=\"5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></line>\n                        <text id=\"åˆ†æ”¯åç§°\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                            <tspan x=\"0\" y=\"13.2608696\">moa-app-workbench</tspan>\n                        </text>\n                        <text id=\"è¯´æ˜\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                            <tspan x=\"157.85841\" y=\"13.2608696\">å°åº”ç”¨-å·¥ä½œå°</tspan>\n                        </text>\n                    </g>\n                    <g id=\"åˆ†æ”¯/ç›´çº¿åˆ†æ”¯å¤‡ä»½-6\" transform=\"translate(20.000000, 434.000000)\">\n                        <line x1=\"0.603462208\" y1=\"20.5434783\" x2=\"234.508368\" y2=\"20.5434783\" id=\"åˆ†æ”¯ç›´çº¿\" stroke=\"#979797\" stroke-width=\"5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></line>\n                        <text id=\"åˆ†æ”¯åç§°\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                            <tspan x=\"0\" y=\"13.2608696\">moa-app-task</tspan>\n                        </text>\n                        <text id=\"è¯´æ˜\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                            <tspan x=\"169.93041\" y=\"13.2608696\">å°åº”ç”¨-ä»»åŠ¡</tspan>\n                        </text>\n                    </g>\n                    <g id=\"åˆ†æ”¯/ç›´çº¿åˆ†æ”¯å¤‡ä»½-5\" transform=\"translate(20.000000, 369.000000)\">\n                        <line x1=\"0.603462208\" y1=\"20.5434783\" x2=\"234.508368\" y2=\"20.5434783\" id=\"åˆ†æ”¯ç›´çº¿\" stroke=\"#979797\" stroke-width=\"5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></line>\n                        <text id=\"åˆ†æ”¯åç§°\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                            <tspan x=\"0\" y=\"13.2608696\">moa-app-calendar</tspan>\n                        </text>\n                        <text id=\"è¯´æ˜\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                            <tspan x=\"169.93041\" y=\"13.2608696\">å°åº”ç”¨-æ—¥å†</tspan>\n                        </text>\n                    </g>\n                    <g id=\"åˆ†æ”¯/ç›´çº¿åˆ†æ”¯å¤‡ä»½-4\" transform=\"translate(20.000000, 304.000000)\">\n                        <line x1=\"0.603462208\" y1=\"20.5434783\" x2=\"234.508368\" y2=\"20.5434783\" id=\"åˆ†æ”¯ç›´çº¿\" stroke=\"#979797\" stroke-width=\"5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></line>\n                        <text id=\"åˆ†æ”¯åç§°\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                            <tspan x=\"0\" y=\"13.2608696\">moa-app-appmarket</tspan>\n                        </text>\n                        <text id=\"è¯´æ˜\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                            <tspan x=\"145.78641\" y=\"13.2608696\">å°åº”ç”¨-åº”ç”¨å¸‚åœº</tspan>\n                        </text>\n                    </g>\n                    <g id=\"åˆ†æ”¯/ç›´çº¿åˆ†æ”¯å¤‡ä»½-3\" transform=\"translate(20.000000, 239.000000)\">\n                        <line x1=\"0.603462208\" y1=\"20.5434783\" x2=\"234.508368\" y2=\"20.5434783\" id=\"åˆ†æ”¯ç›´çº¿\" stroke=\"#979797\" stroke-width=\"5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></line>\n                        <text id=\"åˆ†æ”¯åç§°\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                            <tspan x=\"0\" y=\"13.2608696\">moa-app-addressbook</tspan>\n                        </text>\n                        <text id=\"è¯´æ˜\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                            <tspan x=\"157.85841\" y=\"13.2608696\">å°åº”ç”¨-é€šè®¯å½•</tspan>\n                        </text>\n                    </g>\n                    <g id=\"åˆ†æ”¯/ç›´çº¿åˆ†æ”¯å¤‡ä»½-2\" transform=\"translate(20.000000, 174.000000)\">\n                        <line x1=\"0.603462208\" y1=\"20.5434783\" x2=\"234.508368\" y2=\"20.5434783\" id=\"åˆ†æ”¯ç›´çº¿\" stroke=\"#979797\" stroke-width=\"5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></line>\n                        <text id=\"åˆ†æ”¯åç§°\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                            <tspan x=\"0\" y=\"13.2608696\">moa-web-imsdk</tspan>\n                        </text>\n                        <text id=\"è¯´æ˜\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                            <tspan x=\"198.29841\" y=\"13.2608696\">imsdk</tspan>\n                        </text>\n                    </g>\n                    <g id=\"åˆ†æ”¯/ç›´çº¿åˆ†æ”¯å¤‡ä»½\" transform=\"translate(20.000000, 109.000000)\">\n                        <line x1=\"0.603462208\" y1=\"20.5434783\" x2=\"234.508368\" y2=\"20.5434783\" id=\"åˆ†æ”¯ç›´çº¿\" stroke=\"#979797\" stroke-width=\"5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></line>\n                        <text id=\"åˆ†æ”¯åç§°\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                            <tspan x=\"0\" y=\"13.2608696\">moa-client-android-module</tspan>\n                        </text>\n                        <text id=\"è¯´æ˜\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                            <tspan x=\"174.31041\" y=\"13.2608696\">APPåº“æ¨¡å—</tspan>\n                        </text>\n                    </g>\n                    <g id=\"åˆ†æ”¯/ç›´çº¿åˆ†æ”¯\" transform=\"translate(20.000000, 44.000000)\">\n                        <line x1=\"0.603462208\" y1=\"20.5434783\" x2=\"234.508368\" y2=\"20.5434783\" id=\"åˆ†æ”¯ç›´çº¿\" stroke=\"#979797\" stroke-width=\"5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></line>\n                        <text id=\"åˆ†æ”¯åç§°\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                            <tspan x=\"0\" y=\"13.2608696\">moa-client-android</tspan>\n                        </text>\n                        <text id=\"è¯´æ˜\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                            <tspan x=\"210.52641\" y=\"13.2608696\">APP</tspan>\n                        </text>\n                    </g>\n                </g>\n                <g id=\"GeoStarä»“åº“å¤‡ä»½\" transform=\"translate(370.000000, 0.000000)\">\n                    <g id=\"æ¶æ„å›¾/å¸¦æ ‡é¢˜æ æ¡†å¤‡ä»½\">\n                        <g id=\"ç¼–ç»„\" stroke-linejoin=\"round\">\n                            <g id=\"åˆ†ç»„\">\n                                <rect id=\"è¾¹æ¡†æ \" stroke=\"#FF9500\" x=\"0.5\" y=\"0.5\" width=\"461\" height=\"583\"></rect>\n                                <rect id=\"æ ‡é¢˜æ \" fill=\"#FF9500\" x=\"0\" y=\"0\" width=\"462\" height=\"26\"></rect>\n                            </g>\n                        </g>\n                        <text id=\"æ ‡é¢˜\" font-family=\"PingFangSC-Regular, PingFang SC\" font-size=\"16\" font-weight=\"normal\" letter-spacing=\"0.0959999995\" fill=\"#FFFFFF\">\n                            <tspan x=\"158.956777\" y=\"17\">GeoStar Gitlabä»“åº“</tspan>\n                        </text>\n                    </g>\n                    <g id=\"é“¾åŠ¨åŸåˆ†æ”¯\" transform=\"translate(18.000000, 44.000000)\">\n                        <g id=\"åˆ†æ”¯/ç›´çº¿åˆ†æ”¯å¤‡ä»½-8\" transform=\"translate(0.000000, 455.000000)\">\n                            <line x1=\"0.595758436\" y1=\"20.5434783\" x2=\"231.514644\" y2=\"20.5434783\" id=\"åˆ†æ”¯ç›´çº¿\" stroke=\"#979797\" stroke-width=\"5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></line>\n                            <text id=\"åˆ†æ”¯åç§°\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                                <tspan x=\"0\" y=\"13.2608696\">moa-app-workbench</tspan>\n                            </text>\n                            <text id=\"è¯´æ˜\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                                <tspan x=\"155.172218\" y=\"13.2608696\">å°åº”ç”¨-å·¥ä½œå°</tspan>\n                            </text>\n                        </g>\n                        <g id=\"åˆ†æ”¯/ç›´çº¿åˆ†æ”¯å¤‡ä»½-9\" transform=\"translate(0.000000, 390.000000)\">\n                            <line x1=\"0.595758436\" y1=\"20.5434783\" x2=\"231.514644\" y2=\"20.5434783\" id=\"åˆ†æ”¯ç›´çº¿\" stroke=\"#979797\" stroke-width=\"5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></line>\n                            <text id=\"åˆ†æ”¯åç§°\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                                <tspan x=\"0\" y=\"13.2608696\">moa-app-task</tspan>\n                            </text>\n                            <text id=\"è¯´æ˜\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                                <tspan x=\"167.244218\" y=\"13.2608696\">å°åº”ç”¨-ä»»åŠ¡</tspan>\n                            </text>\n                        </g>\n                        <g id=\"åˆ†æ”¯/ç›´çº¿åˆ†æ”¯å¤‡ä»½-10\" transform=\"translate(0.000000, 325.000000)\">\n                            <line x1=\"0.595758436\" y1=\"20.5434783\" x2=\"231.514644\" y2=\"20.5434783\" id=\"åˆ†æ”¯ç›´çº¿\" stroke=\"#979797\" stroke-width=\"5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></line>\n                            <text id=\"åˆ†æ”¯åç§°\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                                <tspan x=\"0\" y=\"13.2608696\">moa-app-calendar</tspan>\n                            </text>\n                            <text id=\"è¯´æ˜\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                                <tspan x=\"167.244218\" y=\"13.2608696\">å°åº”ç”¨-æ—¥å†</tspan>\n                            </text>\n                        </g>\n                        <g id=\"åˆ†æ”¯/ç›´çº¿åˆ†æ”¯å¤‡ä»½-11\" transform=\"translate(0.000000, 260.000000)\">\n                            <line x1=\"0.595758436\" y1=\"20.5434783\" x2=\"231.514644\" y2=\"20.5434783\" id=\"åˆ†æ”¯ç›´çº¿\" stroke=\"#979797\" stroke-width=\"5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></line>\n                            <text id=\"åˆ†æ”¯åç§°\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                                <tspan x=\"0\" y=\"13.2608696\">moa-app-appmarket</tspan>\n                            </text>\n                            <text id=\"è¯´æ˜\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                                <tspan x=\"143.100218\" y=\"13.2608696\">å°åº”ç”¨-åº”ç”¨å¸‚åœº</tspan>\n                            </text>\n                        </g>\n                        <g id=\"åˆ†æ”¯/ç›´çº¿åˆ†æ”¯å¤‡ä»½-12\" transform=\"translate(0.000000, 195.000000)\">\n                            <line x1=\"0.595758436\" y1=\"20.5434783\" x2=\"231.514644\" y2=\"20.5434783\" id=\"åˆ†æ”¯ç›´çº¿\" stroke=\"#979797\" stroke-width=\"5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></line>\n                            <text id=\"åˆ†æ”¯åç§°\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                                <tspan x=\"0\" y=\"13.2608696\">moa-app-addressbook</tspan>\n                            </text>\n                            <text id=\"è¯´æ˜\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                                <tspan x=\"155.172218\" y=\"13.2608696\">å°åº”ç”¨-é€šè®¯å½•</tspan>\n                            </text>\n                        </g>\n                        <g id=\"åˆ†æ”¯/ç›´çº¿åˆ†æ”¯å¤‡ä»½-13\" transform=\"translate(0.000000, 130.000000)\">\n                            <line x1=\"0.595758436\" y1=\"20.5434783\" x2=\"231.514644\" y2=\"20.5434783\" id=\"åˆ†æ”¯ç›´çº¿\" stroke=\"#979797\" stroke-width=\"5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></line>\n                            <text id=\"åˆ†æ”¯åç§°\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                                <tspan x=\"0\" y=\"13.2608696\">moa-web-imsdk</tspan>\n                            </text>\n                            <text id=\"è¯´æ˜\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                                <tspan x=\"195.612218\" y=\"13.2608696\">imsdk</tspan>\n                            </text>\n                        </g>\n                        <g id=\"åˆ†æ”¯/ç›´çº¿åˆ†æ”¯å¤‡ä»½-14\" transform=\"translate(0.000000, 65.000000)\">\n                            <line x1=\"0.595758436\" y1=\"20.5434783\" x2=\"231.514644\" y2=\"20.5434783\" id=\"åˆ†æ”¯ç›´çº¿\" stroke=\"#979797\" stroke-width=\"5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></line>\n                            <text id=\"åˆ†æ”¯åç§°\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                                <tspan x=\"0\" y=\"13.2608696\">moa-client-android-module</tspan>\n                            </text>\n                            <text id=\"è¯´æ˜\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                                <tspan x=\"171.624218\" y=\"13.2608696\">APPåº“æ¨¡å—</tspan>\n                            </text>\n                        </g>\n                        <g id=\"åˆ†æ”¯/ç›´çº¿åˆ†æ”¯å¤‡ä»½-15\">\n                            <line x1=\"0.595758436\" y1=\"20.5434783\" x2=\"231.514644\" y2=\"20.5434783\" id=\"åˆ†æ”¯ç›´çº¿\" stroke=\"#979797\" stroke-width=\"5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></line>\n                            <text id=\"åˆ†æ”¯åç§°\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                                <tspan x=\"0\" y=\"13.2608696\">moa-client-android</tspan>\n                            </text>\n                            <text id=\"è¯´æ˜\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                                <tspan x=\"207.840218\" y=\"13.2608696\">APP</tspan>\n                            </text>\n                        </g>\n                    </g>\n                    <g id=\"ç¼–ç»„\" transform=\"translate(115.000000, 67.500000)\">\n                        <path d=\"M-5.68434189e-14,0 L-5.68434189e-14,7.33908739 C-5.22101777e-14,16.1622639 7.14257577,23.3201537 15.965732,23.3390507 L324.567554,24 L324.567554,24\" id=\"è·¯å¾„-2\" stroke=\"#F7B500\" stroke-width=\"5\" stroke-linecap=\"round\"></path>\n                        <text id=\"geo-client-android/m\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                            <tspan x=\"172.132\" y=\"16.5\">geo-client-android/master</tspan>\n                        </text>\n                    </g>\n                    <g id=\"åˆ†æ”¯/æ´¾ç”Ÿå¤‡ä»½\" transform=\"translate(115.000000, 129.500000)\">\n                        <path d=\"M-5.68434189e-14,0 L-5.68434189e-14,7.33908739 C-5.22101777e-14,16.1622639 7.14257577,23.3201537 15.965732,23.3390507 L324.567554,24 L324.567554,24\" id=\"è·¯å¾„-2\" stroke=\"#F7B500\" stroke-width=\"5\" stroke-linecap=\"round\"></path>\n                        <text id=\"geo-client-android/m\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                            <tspan x=\"93.772\" y=\"16.5\">geo-moa-client-android-module/master</tspan>\n                        </text>\n                    </g>\n                    <g id=\"åˆ†æ”¯/æ´¾ç”Ÿå¤‡ä»½-2\" transform=\"translate(115.000000, 196.500000)\">\n                        <path d=\"M-5.68434189e-14,0 L-5.68434189e-14,7.33908739 C-5.22101777e-14,16.1622639 7.14257577,23.3201537 15.965732,23.3390507 L324.567554,24 L324.567554,24\" id=\"è·¯å¾„-2\" stroke=\"#F7B500\" stroke-width=\"5\" stroke-linecap=\"round\"></path>\n                        <text id=\"geo-client-android/m\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                            <tspan x=\"161.584\" y=\"16.5\">geo-moa-web-imsdk/master</tspan>\n                        </text>\n                    </g>\n                    <g id=\"åˆ†æ”¯/æ´¾ç”Ÿå¤‡ä»½-3\" transform=\"translate(118.000000, 259.500000)\">\n                        <path d=\"M-5.68434189e-14,0 L-5.68434189e-14,7.33908739 C-5.22101777e-14,16.1622639 7.14257577,23.3201537 15.965732,23.3390507 L324.567554,24 L324.567554,24\" id=\"è·¯å¾„-2\" stroke=\"#F7B500\" stroke-width=\"5\" stroke-linecap=\"round\"></path>\n                        <text id=\"geo-client-android/m\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                            <tspan x=\"155.548\" y=\"16.5\">geo-app-addressbook/master</tspan>\n                        </text>\n                    </g>\n                    <g id=\"åˆ†æ”¯/æ´¾ç”Ÿå¤‡ä»½-4\" transform=\"translate(115.000000, 326.500000)\">\n                        <path d=\"M-5.68434189e-14,0 L-5.68434189e-14,7.33908739 C-5.22101777e-14,16.1622639 7.14257577,23.3201537 15.965732,23.3390507 L324.567554,24 L324.567554,24\" id=\"è·¯å¾„-2\" stroke=\"#F7B500\" stroke-width=\"5\" stroke-linecap=\"round\"></path>\n                        <text id=\"geo-client-android/m\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                            <tspan x=\"166.204\" y=\"16.5\">geo-app-appmarket/master</tspan>\n                        </text>\n                    </g>\n                    <g id=\"åˆ†æ”¯/æ´¾ç”Ÿå¤‡ä»½-5\" transform=\"translate(115.000000, 393.500000)\">\n                        <path d=\"M-5.68434189e-14,0 L-5.68434189e-14,7.33908739 C-5.22101777e-14,16.1622639 7.14257577,23.3201537 15.965732,23.3390507 L324.567554,24 L324.567554,24\" id=\"è·¯å¾„-2\" stroke=\"#F7B500\" stroke-width=\"5\" stroke-linecap=\"round\"></path>\n                        <text id=\"geo-client-android/m\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                            <tspan x=\"144.148\" y=\"16.5\">geo-app-calendar/nskst/master</tspan>\n                        </text>\n                    </g>\n                    <g id=\"åˆ†æ”¯/æ´¾ç”Ÿå¤‡ä»½-6\" transform=\"translate(115.000000, 456.500000)\">\n                        <path d=\"M-5.68434189e-14,0 L-5.68434189e-14,7.33908739 C-5.22101777e-14,16.1622639 7.14257577,23.3201537 15.965732,23.3390507 L324.567554,24 L324.567554,24\" id=\"è·¯å¾„-2\" stroke=\"#F7B500\" stroke-width=\"5\" stroke-linecap=\"round\"></path>\n                        <text id=\"geo-client-android/m\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                            <tspan x=\"171.112\" y=\"16.5\">geo-app-task/nskst/master</tspan>\n                        </text>\n                    </g>\n                    <g id=\"åˆ†æ”¯/æ´¾ç”Ÿå¤‡ä»½-7\" transform=\"translate(115.000000, 519.500000)\">\n                        <path d=\"M-5.68434189e-14,0 L-5.68434189e-14,7.33908739 C-5.22101777e-14,16.1622639 7.14257577,23.3201537 15.965732,23.3390507 L324.567554,24 L324.567554,24\" id=\"è·¯å¾„-2\" stroke=\"#F7B500\" stroke-width=\"5\" stroke-linecap=\"round\"></path>\n                        <text id=\"geo-client-android/m\" font-family=\"NotoSerifCJKsc-Regular, Noto Serif CJK SC\" font-size=\"12\" font-weight=\"normal\" letter-spacing=\"0.0719999996\" fill=\"#000000\" fill-opacity=\"0.85\">\n                            <tspan x=\"128.956\" y=\"16.5\">geo-app-workbench/nskst/master</tspan>\n                        </text>\n                    </g>\n                </g>\n                <g id=\"è¿æ¥çº¿\" transform=\"translate(259.000000, 63.000000)\" fill=\"#7A7A7A\" fill-rule=\"nonzero\">\n                    <path id=\"ç›´çº¿-2\" d=\"M0.188059701,-4 C2.5043073,-4 4.41182503,-2.25001939 4.6605859,-8.51613636e-05 L9.6880597,0 L9.6880597,1 L4.66051705,1.00070744 C4.41147331,3.25034205 2.50409376,5 0.188059701,5 C-2.29722167,5 -4.3119403,2.98528137 -4.3119403,0.5 C-4.3119403,-1.98528137 -2.29722167,-4 0.188059701,-4 Z M117.31194,-4 L126.31194,0.5 L117.31194,5 L117.311,1 L113.68806,1 L113.68806,0 L117.311,0 L117.31194,-4 Z M19.6880597,0 L19.6880597,1 L13.6880597,1 L13.6880597,0 L19.6880597,0 Z M29.6880597,0 L29.6880597,1 L23.6880597,1 L23.6880597,0 L29.6880597,0 Z M39.6880597,0 L39.6880597,1 L33.6880597,1 L33.6880597,0 L39.6880597,0 Z M49.6880597,0 L49.6880597,1 L43.6880597,1 L43.6880597,0 L49.6880597,0 Z M59.6880597,0 L59.6880597,1 L53.6880597,1 L53.6880597,0 L59.6880597,0 Z M69.6880597,0 L69.6880597,1 L63.6880597,1 L63.6880597,0 L69.6880597,0 Z M79.6880597,0 L79.6880597,1 L73.6880597,1 L73.6880597,0 L79.6880597,0 Z M89.6880597,0 L89.6880597,1 L83.6880597,1 L83.6880597,0 L89.6880597,0 Z M99.6880597,0 L99.6880597,1 L93.6880597,1 L93.6880597,0 L99.6880597,0 Z M109.68806,0 L109.68806,1 L103.68806,1 L103.68806,0 L109.68806,0 Z\"></path>\n                    <path id=\"ç›´çº¿-2å¤‡ä»½\" d=\"M0.5,61 C2.81637876,61 4.72398135,62.7501788 4.97256844,65.000297 L10,65 L10,66 L4.97245735,66.0007074 C4.7234136,68.2503421 2.81603406,70 0.5,70 C-1.98528137,70 -4,67.9852814 -4,65.5 C-4,63.0147186 -1.98528137,61 0.5,61 Z M117.31194,61 L126.31194,65.5 L117.31194,70 L117.311,66 L114,66 L114,65 L117.311,65 L117.31194,61 Z M20,65 L20,66 L14,66 L14,65 L20,65 Z M30,65 L30,66 L24,66 L24,65 L30,65 Z M40,65 L40,66 L34,66 L34,65 L40,65 Z M50,65 L50,66 L44,66 L44,65 L50,65 Z M60,65 L60,66 L54,66 L54,65 L60,65 Z M70,65 L70,66 L64,66 L64,65 L70,65 Z M80,65 L80,66 L74,66 L74,65 L80,65 Z M90,65 L90,66 L84,66 L84,65 L90,65 Z M100,65 L100,66 L94,66 L94,65 L100,65 Z M110,65 L110,66 L104,66 L104,65 L110,65 Z\"></path>\n                    <path id=\"ç›´çº¿-2å¤‡ä»½-2\" d=\"M0.5,127 C2.81637876,127 4.72398135,128.750179 4.97256844,131.000297 L10,131 L10,132 L4.97245735,132.000707 C4.7234136,134.250342 2.81603406,136 0.5,136 C-1.98528137,136 -4,133.985281 -4,131.5 C-4,129.014719 -1.98528137,127 0.5,127 Z M117.31194,127 L126.31194,131.5 L117.31194,136 L117.311,132 L114,132 L114,131 L117.311,131 L117.31194,127 Z M20,131 L20,132 L14,132 L14,131 L20,131 Z M30,131 L30,132 L24,132 L24,131 L30,131 Z M40,131 L40,132 L34,132 L34,131 L40,131 Z M50,131 L50,132 L44,132 L44,131 L50,131 Z M60,131 L60,132 L54,132 L54,131 L60,131 Z M70,131 L70,132 L64,132 L64,131 L70,131 Z M80,131 L80,132 L74,132 L74,131 L80,131 Z M90,131 L90,132 L84,132 L84,131 L90,131 Z M100,131 L100,132 L94,132 L94,131 L100,131 Z M110,131 L110,132 L104,132 L104,131 L110,131 Z\"></path>\n                    <path id=\"ç›´çº¿-2å¤‡ä»½-3\" d=\"M1.5,191 C3.81637876,191 5.72398135,192.750179 5.97256844,195.000297 L11,195 L11,196 L5.97245735,196.000707 C5.7234136,198.250342 3.81603406,200 1.5,200 C-0.985281374,200 -3,197.985281 -3,195.5 C-3,193.014719 -0.985281374,191 1.5,191 Z M117.31194,191 L126.31194,195.5 L117.31194,200 L117.311,196 L115,196 L115,195 L117.311,195 L117.31194,191 Z M21,195 L21,196 L15,196 L15,195 L21,195 Z M31,195 L31,196 L25,196 L25,195 L31,195 Z M41,195 L41,196 L35,196 L35,195 L41,195 Z M51,195 L51,196 L45,196 L45,195 L51,195 Z M61,195 L61,196 L55,196 L55,195 L61,195 Z M71,195 L71,196 L65,196 L65,195 L71,195 Z M81,195 L81,196 L75,196 L75,195 L81,195 Z M91,195 L91,196 L85,196 L85,195 L91,195 Z M101,195 L101,196 L95,196 L95,195 L101,195 Z M111,195 L111,196 L105,196 L105,195 L111,195 Z\"></path>\n                    <path id=\"ç›´çº¿-2å¤‡ä»½-4\" d=\"M0.482071855,257.000036 C2.79821908,256.990808 4.7126401,258.733051 4.97047097,260.981861 L9.99586739,260.962164 L9.99985142,261.962156 L4.97441669,261.982885 C4.73433754,264.233494 2.83394382,265.990737 0.517928145,265.999964 C-1.96733351,266.009866 -3.99006285,264.00319 -3.99996429,261.517928 C-4.00986573,259.032666 -2.00318979,257.009937 0.482071855,257.000036 Z M117.482139,256.5339 L126.499996,260.998008 L117.517996,265.533829 L117.501,261.533 L114.499022,261.545825 L113.999026,261.547817 L113.995042,260.547825 L114.495038,260.545833 L117.498,260.533 L117.482139,256.5339 Z M19.995788,260.922324 L19.9997721,261.922316 L13.9998197,261.94622 L13.9958356,260.946228 L19.995788,260.922324 Z M29.9957087,260.882483 L29.9996927,261.882475 L23.9997403,261.90638 L23.9957563,260.906387 L29.9957087,260.882483 Z M39.9956293,260.842643 L39.9996133,261.842635 L33.9996609,261.866539 L33.9956769,260.866547 L39.9956293,260.842643 Z M49.9955499,260.802803 L49.999534,261.802795 L43.9995816,261.826699 L43.9955976,260.826707 L49.9955499,260.802803 Z M59.9954706,260.762962 L59.9994546,261.762954 L53.9995022,261.786859 L53.9955182,260.786866 L59.9954706,260.762962 Z M69.9953912,260.723122 L69.9993752,261.723114 L63.9994229,261.747018 L63.9954388,260.747026 L69.9953912,260.723122 Z M79.9953118,260.683282 L79.9992959,261.683274 L73.9993435,261.707178 L73.9953595,260.707186 L79.9953118,260.683282 Z M89.9952325,260.643441 L89.9992165,261.643433 L83.9992641,261.667338 L83.9952801,260.667346 L89.9952325,260.643441 Z M99.9951531,260.603601 L99.9991372,261.603593 L93.9991848,261.627497 L93.9952007,260.627505 L99.9951531,260.603601 Z M109.995074,260.563761 L109.999058,261.563753 L103.999105,261.587657 L103.995121,260.587665 L109.995074,260.563761 Z\"></path>\n                    <path id=\"ç›´çº¿-2å¤‡ä»½-5\" d=\"M1.48192786,323.000036 C3.79794324,322.990735 5.71233408,324.732719 5.97041043,326.981335 L10.9958338,326.96186 L10.9998499,327.961852 L5.97453919,327.981737 C5.73499066,330.232835 3.83443222,331.990661 1.51807214,331.999964 C-0.967189189,332.009945 -2.98998274,330.003333 -2.99996371,327.518072 C-3.00994468,325.032811 -1.00333348,323.010017 1.48192786,323.000036 Z M117.481996,322.534173 L126.499996,326.997992 L117.518141,331.5341 L117.502,327.534 L115.499007,327.542177 L114.999011,327.544185 L114.994995,326.544193 L115.494991,326.542185 L117.497,326.534 L117.481996,322.534173 Z M20.9957532,326.9217 L20.9997692,327.921692 L14.9998176,327.945788 L14.9958016,326.945796 L20.9957532,326.9217 Z M30.9956726,326.881539 L30.9996886,327.881531 L24.999737,327.905628 L24.9957209,326.905636 L30.9956726,326.881539 Z M40.9955919,326.841379 L40.999608,327.841371 L34.9996563,327.865467 L34.9956403,326.865475 L40.9955919,326.841379 Z M50.9955113,326.801219 L50.9995273,327.801211 L44.9995757,327.825307 L44.9955597,326.825315 L50.9955113,326.801219 Z M60.9954306,326.761058 L60.9994467,327.76105 L54.9994951,327.785147 L54.995479,326.785155 L60.9954306,326.761058 Z M70.99535,326.720898 L70.999366,327.72089 L64.9994144,327.744986 L64.9953984,326.744994 L70.99535,326.720898 Z M80.9952693,326.680738 L80.9992854,327.68073 L74.9993338,327.704826 L74.9953177,326.704834 L80.9952693,326.680738 Z M90.9951887,326.640578 L90.9992047,327.640569 L84.9992531,327.664666 L84.9952371,326.664674 L90.9951887,326.640578 Z M100.995108,326.600417 L100.999124,327.600409 L94.9991725,327.624505 L94.9951564,326.624513 L100.995108,326.600417 Z M110.995027,326.560257 L110.999043,327.560249 L104.999092,327.584345 L104.995076,326.584353 L110.995027,326.560257 Z\"></path>\n                    <path id=\"ç›´çº¿-2å¤‡ä»½-6\" d=\"M1.5,387 C3.81637876,387 5.72398135,388.750179 5.97256844,391.000297 L11,391 L11,392 L5.97245735,392.000707 C5.7234136,394.250342 3.81603406,396 1.5,396 C-0.985281374,396 -3,393.985281 -3,391.5 C-3,389.014719 -0.985281374,387 1.5,387 Z M117.31194,387 L126.31194,391.5 L117.31194,396 L117.311,392 L115,392 L115,391 L117.311,391 L117.31194,387 Z M21,391 L21,392 L15,392 L15,391 L21,391 Z M31,391 L31,392 L25,392 L25,391 L31,391 Z M41,391 L41,392 L35,392 L35,391 L41,391 Z M51,391 L51,392 L45,392 L45,391 L51,391 Z M61,391 L61,392 L55,392 L55,391 L61,391 Z M71,391 L71,392 L65,392 L65,391 L71,391 Z M81,391 L81,392 L75,392 L75,391 L81,391 Z M91,391 L91,392 L85,392 L85,391 L91,391 Z M101,391 L101,392 L95,392 L95,391 L101,391 Z M111,391 L111,392 L105,392 L105,391 L111,391 Z\"></path>\n                    <path id=\"ç›´çº¿-2å¤‡ä»½-7\" d=\"M0,451 C2.31637876,451 4.22398135,452.750179 4.47256844,455.000297 L9.5,455 L9.5,456 L4.47245735,456.000707 C4.2234136,458.250342 2.31603406,460 0,460 C-2.48528137,460 -4.5,457.985281 -4.5,455.5 C-4.5,453.014719 -2.48528137,451 0,451 Z M117.31194,451 L126.31194,455.5 L117.31194,460 L117.311,456 L113.5,456 L113.5,455 L117.311,455 L117.31194,451 Z M19.5,455 L19.5,456 L13.5,456 L13.5,455 L19.5,455 Z M29.5,455 L29.5,456 L23.5,456 L23.5,455 L29.5,455 Z M39.5,455 L39.5,456 L33.5,456 L33.5,455 L39.5,455 Z M49.5,455 L49.5,456 L43.5,456 L43.5,455 L49.5,455 Z M59.5,455 L59.5,456 L53.5,456 L53.5,455 L59.5,455 Z M69.5,455 L69.5,456 L63.5,456 L63.5,455 L69.5,455 Z M79.5,455 L79.5,456 L73.5,456 L73.5,455 L79.5,455 Z M89.5,455 L89.5,456 L83.5,456 L83.5,455 L89.5,455 Z M99.5,455 L99.5,456 L93.5,456 L93.5,455 L99.5,455 Z M109.5,455 L109.5,456 L103.5,456 L103.5,455 L109.5,455 Z\"></path>\n                </g>\n            </g>\n        </g>\n    </g>\n</svg>\n\nç”±ä¸Šé¢å›¾å¯ä»¥çœ‹å‡ºï¼Œé“¾åŠ¨åœ¨ä¸€ä¸ªä»“åº“ä¸­é€šè¿‡åˆ†æ”¯åˆ†åˆ«å­˜æ”¾äº†ç§»åŠ¨ç«¯Androidæºç ï¼Œç§»åŠ¨ç«¯APPåº“æºç ï¼ŒimsdkåŠç¤ºä¾‹æºç ï¼Œè¿˜æœ‰5ä¸ªåŸºç¡€H5å°åº”ç”¨ã€‚\n\n* é¦–å…ˆï¼Œæˆ‘ä»¬å®Œå…¨åŒæ­¥é“¾åŠ¨çš„å‡ ä¸ªåˆ†æ”¯ï¼ˆ`moa-xxx`ï¼‰åˆ°æˆ‘ä»¬çš„gitlabä»“åº“ï¼›\n* ç„¶åï¼Œæˆ‘ä»¬åŸºäºé“¾åŠ¨çš„å‡ ä¸ªåˆ†æ”¯ï¼Œåˆ†åˆ«æ‹‰å–äº†æˆ‘ä»¬è‡ªå·±çš„åˆ†æ”¯è¿›è¡Œä¿®æ”¹ï¼Œå‘½åä¸º `geo-xxxx`\n\n#### Tagç®¡ç†\n\nç”±äºæˆ‘ä»¬åœ¨ä¸€ä¸ªä»“åº“ä¸­æ”¾ç½®äº†è‹¥å¹²ä¸ªæ¨¡å—ï¼Œé€šè¿‡åˆ†æ”¯åŒºåˆ†ï¼Œåœ¨å»ºç«‹tagæ—¶ï¼Œä¹Ÿéœ€è¦ç›¸åº”çš„åŒºåˆ†ï¼›å¦å¤–ç”±äºé“¾åŠ¨ä¹Ÿä¼šåœ¨ä»“åº“ä¸­æäº¤tagï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹tagçš„å‘½åä½œä¸€å®šçš„çº¦æŸï¼Œä¸€èˆ¬tagåº”å°†åˆ†æ”¯åç§°ä½œä¸ºå‰ç¼€ï¼Œå¦‚ï¼š\n\n* [geo-client-android-v1.2.22](http://172.17.0.205/GeoPanel/MobileCenter/geopanel-android/-/releases/geo-client-android-v1.2.22): ä¸ºandroidç«¯çš„æœ€æ–°ç‰ˆæœ¬tag\n* [geo-app-appmarket-v1.0.2](http://172.17.0.205/GeoPanel/MobileCenter/geopanel-android/-/releases/geo-app-appmarket-v1.0.2)ï¼š ä¸ºå°åº”ç”¨çš„æœ€æ–°ç‰ˆæœ¬tag\n\n\n\n**Androidç«¯ç‰ˆæœ¬tagè¯´æ˜**\n\nAndroidç«¯ä»£ç ä¼šå¯¹åº”å¤šä¸ªåœ°åŒºçš„é¡¹ç›®ï¼Œå¦‚æœä¸ºæ¯ä¸ªåœ°åŒºå•ç‹¬åŒºåˆ†ç‰ˆæœ¬å·ï¼Œä¼šé€ æˆä¸»çº¿ç‰ˆæœ¬ç®¡ç†æ··ä¹±ã€‚\n\nAPPçš„ç‰ˆæœ¬å·ä¸ä¸ä»»ä½•é¡¹ç›®è¿›è¡Œå…³è”ï¼Œæ‰“åŒ…æ—¶ä¸è®ºé’ˆå¯¹å“ªä¸ªé¡¹ç›®/äº§å“å‘åŒ…ï¼Œåªè¦å‘å¸ƒäº†Releaseç‰ˆæœ¬ï¼Œå°±å°†ç‰ˆæœ¬å·é€’å¢ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n* å—å±±å—äº‹é€šå‘å¸ƒç‰ˆæœ¬æ—¶ï¼Œç‰ˆæœ¬å·ä¸º 1.2.19 \n* æ´ªå±±ç®¡ç†é€šæ—¶åˆ™å°†ç‰ˆæœ¬å·è®¾ç½®ä¸º 1.2.20 \n\n![image-20210406160652462](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210406160652.png)\n\n\n\n## é‡è¦ä¿®æ”¹è¯´æ˜\n\nå‰é¢è¯´è¿‡ï¼Œæˆ‘ä»¬çš„ä»£ç ä»é“¾åŠ¨åˆ†æ”¯æ‹‰å–æ–°åˆ†æ”¯è¿›è¡Œäº†ä¸€äº›ä¿®æ”¹ï¼Œè¿™é‡Œä¸»è¦ä»‹ç»ä¸€äº›é‡è¦çš„ä¿®æ”¹ç‚¹ï¼š\n\n1. **æ‰“åŒ…é…ç½®é€»è¾‘è°ƒæ•´ï¼ˆåŒ…æ‹¬åŒ…åï¼Œç­¾åï¼Œç¬¬ä¸‰æ–¹æœåŠ¡è´¦å·çš„keyç­‰çš„ä¿®æ”¹ï¼‰**\n2. **UIç•Œé¢æ ·å¼è°ƒæ•´ï¼›**\n3. **è¿ç§»åˆ°AndroidXï¼›**\n4. **æ‰©å±•cordovaæ’ä»¶ï¼›**\n\n\n\n### æ‰“åŒ…é…ç½®ä¿®æ”¹\n\n#### ä¸åŒé¡¹ç›®çš„åŒ…é…ç½®åŒºåˆ†\n\né“¾åŠ¨æä¾›çš„ç‰ˆæœ¬ä¸­ï¼ŒåŒ…åä¸ºé“¾åŠ¨çš„åŒ…åï¼Œè€Œæˆ‘ä»¬éœ€è¦å°†ä¸€ä¸ªåŒ…åº”ç”¨åˆ°ä¸åŒçš„é¡¹ç›®ä¹‹ä¸­ï¼Œæ•…éœ€è¦å¯¹åŒ…åè¿›è¡ŒåŒºåˆ†ï¼ŒåŒæ—¶è¿˜æœ‰å¯¹åº”çš„ç™¾åº¦åœ°å›¾åŠä¸‰æ–¹æ¨é€ç­‰çš„è´¦å·ä¹Ÿéœ€è¦è¿›è¡ŒåŒºåˆ†ï¼Œæ•…æå–äº†ä¸€å¥—é…ç½®æ–¹å¼ï¼Œä¸ºäº†å‡å°‘å¯¹é“¾åŠ¨åŸæœ‰ä»£ç æ–‡ä»¶çš„ä¿®æ”¹ï¼Œæˆ‘ä»¬çš„é…ç½®ä¸»è¦ä½äºå¦‚ä¸‹æ–°å¢åŠ çš„æ–‡ä»¶åŠç›®å½•ä¸­ï¼š\n\n```shell\nandroid\nâ”œâ”€â”€ dist-config  -  ä¸åŒé¡¹ç›®çš„æ‰“åŒ…é…ç½®å®šä¹‰\nâ”‚Â Â  â””â”€â”€ moa-moa-geo-third-share.gradle\nâ”‚Â Â  â”œâ”€â”€ hongshan_sgt_debug_wuhan.gradle\nâ”‚Â Â  â”œâ”€â”€ hongshan_sgt_release.gradle\nâ”‚Â Â  â”œâ”€â”€ jiujiang_egt_debug_wuhan.gradle\nâ”‚Â Â  â”œâ”€â”€ jiujiang_egt_official.gradle\nâ”‚Â Â  â”œâ”€â”€ ld_test.gradle\nâ”‚Â Â  â”œâ”€â”€ luohu_kst_official.gradle\nâ”‚Â Â  â”œâ”€â”€ moa_jiujiang_wuhan_fixed.gradle\nâ”‚Â Â  â”œâ”€â”€ moa_wxtest_wuhan_195.gradle\nâ”‚Â Â  â”œâ”€â”€ mobile_center_aliyun.gradle\nâ”‚Â Â  â”œâ”€â”€ nskst_official.gradle\nâ”‚Â Â  â”œâ”€â”€ nskst_official_demonstration.gradle\nâ”‚Â Â  â”œâ”€â”€ nskst_official_pre_release.gradle\nâ”‚Â Â  â”œâ”€â”€ nskst_test_internet_shenzhen.gradle\nâ”‚Â Â  â”œâ”€â”€ nskst_test_shenzhen.gradle\nâ”‚Â Â  â”œâ”€â”€ nskst_test_wuhan_fixed.gradle\nâ”‚Â Â  â”œâ”€â”€ nskst_test_wuhan_jianghang.gradle\nâ”‚Â Â  â”œâ”€â”€ nskst_test_wuhan_open.gradle\nâ”‚Â Â  â”œâ”€â”€ nskst_test_wuhan_private.gradle\nâ”‚Â Â  â”œâ”€â”€ nskst_test_wuhan_sr.gradle\nâ”‚Â Â  â”œâ”€â”€ nskst_test_wuhan_wsr.gradle\nâ”‚Â Â  â”œâ”€â”€ rongjiang_kst_official.gradle\nâ”‚Â Â  â”œâ”€â”€ shenzhen_shi_official.gradle\nâ”‚Â Â  â””â”€â”€ template.gradle\nâ”œâ”€â”€ dist-config.gradle - å®šä¹‰é…ç½®dist-configç›®å½•ä¸­é…ç½®çš„åŠ è½½é€»è¾‘ \n```\n\n* å¼•å…¥dist-config.gradleï¼š(platforms/android/app/build.gradle)\n\n  ```groovy\n  apply from: '../dist-config.gradle'\n  ```\n\n> å…·ä½“çš„æ¯ä¸ªåœ°æ–¹çš„é…ç½®ï¼Œç”±äºå·²ç»æœ‰æ¥è§¦å¹¶é…ç½®è¿‡ï¼Œä¸å†èµ˜è¿°\n\n#### ç­¾åé…ç½®\n\n* è®¾ç½®debugå’Œreleaseç›¸åŒç­¾å: (platforms/android/app/build.gradle)\n\n  ```groovy\n   buildTypes {\n          release {\n              minifyEnabled true\n              zipAlignEnabled true  //å‹ç¼©ä¼˜åŒ–\n              shrinkResources true  //ç§»å‡ºæ— ç”¨èµ„æº\n              proguardFiles getDefaultProguardFile(\"proguard-android.txt\"), \"proguard-rules.pro\"\n              signingConfig signingConfigs.moasign\n          }\n          debug {\n              signingConfig signingConfigs.moasign\n          }\n  }\n  ```\n\n* ç­¾åä¿¡æ¯æ›¿æ¢ï¼š(platforms/android/gradle.properties)(é“¾åŠ¨æœªæä¾›å…¶ç­¾åä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬è‡ªå·±ç”Ÿæˆäº†ç­¾åå¹¶æ›¿æ¢é“¾åŠ¨çš„é…ç½®)\n\n  ```groovy\n  # keyAlias\n  MOA_RELEASE_KEY_ALIAS=geostar-moa\n  #keyPassword\n  MOA_RELEASE_KEY_PASSWORD=a7cbf71f1019635fc794df0e1abc3e79\n  #storeFile\n  MOA_RELEASE_STORE_FILE=../geostar.moa.jks\n  #storePassword\n  MOA_RELEASE_STORE_PASSWORD=9b1d0e07ee4bdb03e2249bf57f6974a4\n  ```\n\n  \n\n### è¿ç§»åˆ°AndroidX\n\ngoogleæœ€åˆå‘å¸ƒäº†supportåº“ï¼ˆå¦‚ï¼šv4ï¼Œv7ï¼Œdesignï¼‰ï¼Œä¹‹å‰å¾ˆå¤šæ§ä»¶éƒ½æ˜¯ä½äºè¿™äº›åº“ä¸­çš„ï¼ˆå¦‚ï¼šRecyclerViewï¼ŒCardViewç­‰ï¼‰ï¼Œåç»Ÿä¸€ä¸ºandroidxçš„åº“ï¼Œæ—§çš„supportåº“ä¸å†ç»´æŠ¤ï¼Œä¸ºäº†èƒ½å¤Ÿé¿å…åç»­å¼€å‘åŠŸèƒ½æ—¶å¼•å…¥çš„æŸäº›åº“æ— æ³•ä½¿ç”¨ï¼Œæ•…å°†é¡¹ç›®å…¶è¿ç§»åˆ°androidxã€‚\n\nè¿ç§»androidxçš„ä¿®æ”¹å¯ä»¥æŸ¥çœ‹Gitlabä¸Šçš„æäº¤ï¼š[migrateï¼š è¿ç§»åˆ°AndroidX (adc773ca) Â· æäº¤ Â· GeoPanel / ç§»åŠ¨ä¸­å¿ƒ / ç§»åŠ¨å¹³å°-Androidç«¯ Â· GitLab](http://172.17.0.205/GeoPanel/MobileCenter/geopanel-android/-/commit/adc773ca06c807ec0cb271fb900e72bff48ae5ee)\n\nè¿ç§»ä½¿ç”¨androidstudioæä¾›çš„è¿ç§»å‘½ä»¤ï¼Œä¼šè‡ªåŠ¨å°†é¡¹ç›®ä¸­çš„åŸå…ˆä½¿ç”¨supportåº“çš„éƒ¨åˆ†æ›¿æ¢ä¸ºå¯¹åº”çš„androidxåº“çš„ç”¨æ³•ï¼ŒåŒæ—¶åœ¨ç¼–è¯‘æ—¶ä¹Ÿä¼šå¯¹ä¾èµ–åº“ä¸­jaré‡Œé¢ä½¿ç”¨çš„supportåº“è¿›è¡Œå¤„ç†ã€‚\n\n### UIç•Œé¢æ ·å¼è°ƒæ•´\n\nåœ¨MOAæœ€åˆåº”ç”¨åˆ°å—å±±é¡¹ç›®æ—¶ï¼ŒæŒ‰ç…§å—å±±çš„UIç•Œé¢è¿›è¡Œäº†ä¸€æ³¢ç•Œé¢è°ƒæ•´ã€‚ä¸»è¦åŒ…æ‹¬ï¼š\n\n* ç™»å½•ç•Œé¢æ›¿æ¢ï¼›\n* æ‰€æœ‰nativeé¡µé¢çš„é¡¶éƒ¨æ ·å¼ï¼›\n* åŸºç¡€å°åº”ç”¨çš„é¡¶éƒ¨æ ·å¼åŠç•Œé¢æ ·å¼ï¼›\n\n\n\n### æ‰©å±•cordovaæ’ä»¶\n\nAPPæ•´ä½“çš„æ¶æ„å¦‚ä¸‹ï¼š\n\n<svg width=\"423px\" height=\"345px\" viewBox=\"0 0 423 345\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n    <g id=\"é¡µé¢-1\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n        <g id=\"ç§»åŠ¨ä¸­å¿ƒAPPæ¶æ„\" transform=\"translate(-219.000000, -162.000000)\">\n            <g id=\"æ¶æ„å›¾/å¸¦æ ‡é¢˜æ æ¡†\" transform=\"translate(219.000000, 429.000000)\">\n                <g id=\"åˆ†ç»„\">\n                    <rect id=\"è¾¹æ¡†æ \" stroke=\"#FF9500\" x=\"0.5\" y=\"0.5\" width=\"422\" height=\"77\"></rect>\n                    <rect id=\"æ ‡é¢˜æ \" fill=\"#FF9500\" x=\"0\" y=\"0\" width=\"423\" height=\"26\"></rect>\n                </g>\n                <text id=\"æ ‡é¢˜\" font-family=\"PingFangSC-Regular, PingFang SC\" font-size=\"16\" font-weight=\"normal\" letter-spacing=\"0.0959999995\" fill=\"#FFFFFF\">\n                    <tspan x=\"179.034036\" y=\"17\">ç³»ç»Ÿèƒ½åŠ›</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/å¸¦æ ‡é¢˜æ æ¡†å¤‡ä»½\" transform=\"translate(219.000000, 340.000000)\">\n                <g id=\"åˆ†ç»„\">\n                    <rect id=\"è¾¹æ¡†æ \" stroke=\"#FF9500\" x=\"0.5\" y=\"0.5\" width=\"422\" height=\"77\"></rect>\n                    <rect id=\"æ ‡é¢˜æ \" fill=\"#FF9500\" x=\"0\" y=\"0\" width=\"423\" height=\"26\"></rect>\n                </g>\n                <text id=\"æ ‡é¢˜\" font-family=\"PingFangSC-Regular, PingFang SC\" font-size=\"16\" font-weight=\"normal\" letter-spacing=\"0.0959999995\" fill=\"#FFFFFF\">\n                    <tspan x=\"179.458036\" y=\"17\">APPèƒ½åŠ›</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/å¸¦æ ‡é¢˜æ æ¡†å¤‡ä»½-2\" transform=\"translate(219.000000, 251.000000)\">\n                <g id=\"åˆ†ç»„\">\n                    <rect id=\"è¾¹æ¡†æ \" stroke=\"#FF9500\" x=\"0.5\" y=\"0.5\" width=\"422\" height=\"77\"></rect>\n                    <rect id=\"æ ‡é¢˜æ \" fill=\"#FF9500\" x=\"0\" y=\"0\" width=\"423\" height=\"26\"></rect>\n                </g>\n                <text id=\"æ ‡é¢˜\" font-family=\"PingFangSC-Regular, PingFang SC\" font-size=\"16\" font-weight=\"normal\" letter-spacing=\"0.0959999995\" fill=\"#FFFFFF\">\n                    <tspan x=\"149.010036\" y=\"17\">cordovaæ’ä»¶æ¡†æ¶</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/å¸¦æ ‡é¢˜æ æ¡†å¤‡ä»½-3\" transform=\"translate(219.000000, 162.000000)\">\n                <g id=\"åˆ†ç»„\">\n                    <rect id=\"è¾¹æ¡†æ \" stroke=\"#FF9500\" x=\"0.5\" y=\"0.5\" width=\"422\" height=\"77\"></rect>\n                    <rect id=\"æ ‡é¢˜æ \" fill=\"#FF9500\" x=\"0\" y=\"0\" width=\"423\" height=\"26\"></rect>\n                </g>\n                <text id=\"æ ‡é¢˜\" font-family=\"PingFangSC-Regular, PingFang SC\" font-size=\"16\" font-weight=\"normal\" letter-spacing=\"0.0959999995\" fill=\"#FFFFFF\">\n                    <tspan x=\"176.426036\" y=\"17\">H5å°åº”ç”¨</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/å•ä¸ªæ¨¡å—\" transform=\"translate(228.000000, 468.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#C0C0C0\" fill=\"#EEEEEE\" x=\"0.5\" y=\"0.5\" width=\"52.814433\" height=\"23\"></rect>\n                <text id=\"æ¨¡å—åç§°\" font-family=\"PingFangSC-Semibold, PingFang SC\" font-size=\"11\" font-weight=\"500\" letter-spacing=\"0.121000004\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"15.9717835\" y=\"12\">ç›¸æœº</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/å•ä¸ªæ¨¡å—å¤‡ä»½-6\" transform=\"translate(228.000000, 379.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#C0C0C0\" fill=\"#EEEEEE\" x=\"0.5\" y=\"0.5\" width=\"52.814433\" height=\"23\"></rect>\n                <text id=\"æ¨¡å—åç§°\" font-family=\"PingFangSC-Semibold, PingFang SC\" font-size=\"11\" font-weight=\"500\" letter-spacing=\"0.121000004\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"10.4112835\" y=\"12\">é€šè®¯å½•</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/å•ä¸ªæ¨¡å—å¤‡ä»½-6\" transform=\"translate(228.000000, 201.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#C0C0C0\" fill=\"#EEEEEE\" x=\"0.5\" y=\"0.5\" width=\"52.814433\" height=\"23\"></rect>\n                <text id=\"æ¨¡å—åç§°\" font-family=\"PingFangSC-Semibold, PingFang SC\" font-size=\"11\" font-weight=\"500\" letter-spacing=\"0.121000004\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"10.4112835\" y=\"12\">é€šè®¯å½•</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/å•ä¸ªæ¨¡å—å¤‡ä»½-16\" transform=\"translate(294.000000, 201.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#C0C0C0\" fill=\"#EEEEEE\" x=\"0.5\" y=\"0.5\" width=\"52.814433\" height=\"23\"></rect>\n                <text id=\"æ¨¡å—åç§°\" font-family=\"PingFangSC-Semibold, PingFang SC\" font-size=\"11\" font-weight=\"500\" letter-spacing=\"0.121000004\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"15.9717835\" y=\"12\">æ—¥ç¨‹</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/å•ä¸ªæ¨¡å—å¤‡ä»½-17\" transform=\"translate(360.000000, 201.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#C0C0C0\" fill=\"#EEEEEE\" x=\"0.5\" y=\"0.5\" width=\"52.814433\" height=\"23\"></rect>\n                <text id=\"æ¨¡å—åç§°\" font-family=\"PingFangSC-Semibold, PingFang SC\" font-size=\"11\" font-weight=\"500\" letter-spacing=\"0.121000004\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"15.9717835\" y=\"12\">ä»»åŠ¡</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/å•ä¸ªæ¨¡å—å¤‡ä»½-18\" transform=\"translate(426.000000, 201.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#C0C0C0\" fill=\"#EEEEEE\" x=\"0.5\" y=\"0.5\" width=\"52.814433\" height=\"23\"></rect>\n                <text id=\"æ¨¡å—åç§°\" font-family=\"PingFangSC-Semibold, PingFang SC\" font-size=\"11\" font-weight=\"500\" letter-spacing=\"0.121000004\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"10.4112835\" y=\"12\">å·¥ä½œå°</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/å•ä¸ªæ¨¡å—å¤‡ä»½-12\" transform=\"translate(228.000000, 290.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#C0C0C0\" fill=\"#EEEEEE\" x=\"0.5\" y=\"0.5\" width=\"402.608247\" height=\"23\"></rect>\n                <text id=\"æ¨¡å—åç§°\" font-family=\"PingFangSC-Semibold, PingFang SC\" font-size=\"11\" font-weight=\"500\" letter-spacing=\"0.121000004\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"66.7353762\" y=\"12\">å°†ç³»ç»Ÿèƒ½åŠ›åŠAPPèƒ½åŠ›ä»¥JSæ¥å£çš„æ–¹å¼æš´éœ²ç»™H5å°åº”ç”¨</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/å•ä¸ªæ¨¡å—å¤‡ä»½-7\" transform=\"translate(294.000000, 379.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#C0C0C0\" fill=\"#EEEEEE\" x=\"0.5\" y=\"0.5\" width=\"52.814433\" height=\"23\"></rect>\n                <text id=\"æ¨¡å—åç§°\" font-family=\"PingFangSC-Semibold, PingFang SC\" font-size=\"11\" font-weight=\"500\" letter-spacing=\"0.121000004\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"15.9717835\" y=\"12\">æ¶ˆæ¯</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/å•ä¸ªæ¨¡å—å¤‡ä»½-14\" transform=\"translate(491.000000, 201.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#C0C0C0\" fill=\"#EEEEEE\" x=\"0.5\" y=\"0.5\" width=\"52.814433\" height=\"23\"></rect>\n                <text id=\"æ¨¡å—åç§°\" font-family=\"PingFangSC-Semibold, PingFang SC\" font-size=\"11\" font-weight=\"500\" letter-spacing=\"0.121000004\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"4.8507835\" y=\"12\">åº”ç”¨å¸‚åœº</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/å•ä¸ªæ¨¡å—å¤‡ä»½-8\" transform=\"translate(360.000000, 379.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#C0C0C0\" fill=\"#EEEEEE\" x=\"0.5\" y=\"0.5\" width=\"52.814433\" height=\"23\"></rect>\n                <text id=\"æ¨¡å—åç§°\" font-family=\"PingFangSC-Semibold, PingFang SC\" font-size=\"11\" font-weight=\"500\" letter-spacing=\"0.121000004\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"4.8507835\" y=\"12\">é•œåƒç®¡ç†</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/å•ä¸ªæ¨¡å—å¤‡ä»½-15\" transform=\"translate(558.000000, 201.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#C0C0C0\" fill=\"#EEEEEE\" x=\"0.5\" y=\"0.5\" width=\"73.742268\" height=\"23\"></rect>\n                <text id=\"æ¨¡å—åç§°\" font-family=\"PingFangSC-Semibold, PingFang SC\" font-size=\"11\" font-weight=\"500\" letter-spacing=\"0.121000004\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"9.82636597\" y=\"12\">å…¶ä»–å°åº”ç”¨</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/å•ä¸ªæ¨¡å—å¤‡ä»½-9\" transform=\"translate(426.000000, 379.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#C0C0C0\" fill=\"#EEEEEE\" x=\"0.5\" y=\"0.5\" width=\"69.7560137\" height=\"23\"></rect>\n                <text id=\"æ¨¡å—åç§°\" font-family=\"PingFangSC-Semibold, PingFang SC\" font-size=\"11\" font-weight=\"500\" letter-spacing=\"0.121000004\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"7.81949312\" y=\"12\">æ•°æ®åº“å­˜å‚¨</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/å•ä¸ªæ¨¡å—å¤‡ä»½-10\" transform=\"translate(509.000000, 379.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#C0C0C0\" fill=\"#EEEEEE\" x=\"0.5\" y=\"0.5\" width=\"69.7560137\" height=\"23\"></rect>\n                <text id=\"æ¨¡å—åç§°\" font-family=\"PingFangSC-Semibold, PingFang SC\" font-size=\"11\" font-weight=\"500\" letter-spacing=\"0.121000004\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"13.3799931\" y=\"12\">æ–‡ä»¶å­˜å‚¨</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/å•ä¸ªæ¨¡å—å¤‡ä»½-11\" transform=\"translate(592.000000, 379.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#C0C0C0\" fill=\"#EEEEEE\" x=\"0.5\" y=\"0.5\" width=\"39.8591065\" height=\"23\"></rect>\n                <text id=\"æ¨¡å—åç§°\" font-family=\"PingFangSC-Semibold, PingFang SC\" font-size=\"11\" font-weight=\"500\" letter-spacing=\"0.121000004\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"9.44944673\" y=\"12\">å…¶ä»–</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/å•ä¸ªæ¨¡å—å¤‡ä»½\" transform=\"translate(294.000000, 468.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#C0C0C0\" fill=\"#EEEEEE\" x=\"0.5\" y=\"0.5\" width=\"52.814433\" height=\"23\"></rect>\n                <text id=\"æ¨¡å—åç§°\" font-family=\"PingFangSC-Semibold, PingFang SC\" font-size=\"11\" font-weight=\"500\" letter-spacing=\"0.121000004\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"15.9717835\" y=\"12\">æ–‡ä»¶</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/å•ä¸ªæ¨¡å—å¤‡ä»½-2\" transform=\"translate(360.000000, 468.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#C0C0C0\" fill=\"#EEEEEE\" x=\"0.5\" y=\"0.5\" width=\"69.7560137\" height=\"23\"></rect>\n                <text id=\"æ¨¡å—åç§°\" font-family=\"PingFangSC-Semibold, PingFang SC\" font-size=\"11\" font-weight=\"500\" letter-spacing=\"0.121000004\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"7.81949312\" y=\"12\">æ–¹å‘ä¼ æ„Ÿå™¨</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/å•ä¸ªæ¨¡å—å¤‡ä»½-3\" transform=\"translate(443.000000, 468.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#C0C0C0\" fill=\"#EEEEEE\" x=\"0.5\" y=\"0.5\" width=\"52.814433\" height=\"23\"></rect>\n                <text id=\"æ¨¡å—åç§°\" font-family=\"PingFangSC-Semibold, PingFang SC\" font-size=\"11\" font-weight=\"500\" letter-spacing=\"0.121000004\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"15.5702835\" y=\"12\">GPS</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/å•ä¸ªæ¨¡å—å¤‡ä»½-4\" transform=\"translate(509.000000, 468.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#C0C0C0\" fill=\"#EEEEEE\" x=\"0.5\" y=\"0.5\" width=\"60.7869416\" height=\"23\"></rect>\n                <text id=\"æ¨¡å—åç§°\" font-family=\"PingFangSC-Semibold, PingFang SC\" font-size=\"11\" font-weight=\"500\" letter-spacing=\"0.121000004\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"8.8645292\" y=\"12\">ç½‘ç»œè¯·æ±‚</tspan>\n                </text>\n            </g>\n            <g id=\"æ¶æ„å›¾/å•ä¸ªæ¨¡å—å¤‡ä»½-5\" transform=\"translate(583.000000, 468.000000)\">\n                <rect id=\"çŸ©å½¢\" stroke=\"#C0C0C0\" fill=\"#EEEEEE\" x=\"0.5\" y=\"0.5\" width=\"48.8281787\" height=\"23\"></rect>\n                <text id=\"æ¨¡å—åç§°\" font-family=\"PingFangSC-Semibold, PingFang SC\" font-size=\"11\" font-weight=\"500\" letter-spacing=\"0.121000004\" fill=\"#151515\" fill-opacity=\"0.88378138\">\n                    <tspan x=\"13.9649106\" y=\"12\">å…¶ä»–</tspan>\n                </text>\n            </g>\n        </g>\n    </g>\n</svg>\n\nä¸šåŠ¡çš„å¼€å‘ä¸»è¦ä»¥H5å¼€å‘ä¸ºä¸»ï¼Œä¸ºæ­¤APPéœ€è¦å°†åŸç”Ÿçš„èƒ½åŠ›æä¾›ä¸ºJSçš„APIï¼Œé“¾åŠ¨æä¾›äº†å¾ˆå¤šAPIæ¥å£ï¼Œä¸è¿‡åç»­å‘ç°éƒ¨åˆ†æ¥å£æœ‰BUGï¼Œæˆ–è€…é¡¹ç›®ä¸Šæœ‰æ–°çš„éœ€æ±‚ï¼Œä¸ºæ­¤æˆ‘ä»¬å¯¹cordovaæ’ä»¶åšäº†ä¸€äº›ä¿®æ”¹åŠæ‰©å±•ï¼Œä¸»è¦åŒ…æ‹¬å¦‚ä¸‹å†…å®¹ï¼š\n\n* [äºŒç»´ç æ‰«æ](http://172.17.0.208:12345/moa-doc/api/barcode.html)åŠŸèƒ½æ‰©å±•ï¼Œæ”¯æŒæ›´å¤šè‡ªå®šä¹‰é€‰é¡¹\n* [è®¾ç½®](http://172.17.0.208:12345/moa-doc/api/private-settings.html)åŠŸèƒ½æ‰©å±•ï¼Œæ·»åŠ è‹¥å¹²è®¾ç½®é¡¹APIï¼ŒåŒ…æ‹¬æ¸…é™¤IMæ¶ˆæ¯ï¼Œæ‰“å¼€æ¶ˆæ¯è®¾ç½®ç•Œé¢ç­‰\n* [æ‹æ‘„è§†é¢‘é™åˆ¶æ—¶é•¿ï¼Œè§†é¢‘é€‰æ‹©æ·»åŠ æ—¶é•¿åŠå¤§å°é™åˆ¶](http://172.17.0.208:12345/moa-doc/api/media.html#app-video-getvideo)\n* [æ‹ç…§æ”¯æŒæ·»åŠ æ°´å°](http://172.17.0.208:12345/moa-doc/api/photo.html#app-picture-camera)\n* [å¢åŠ é™„ä»¶æŸ¥çœ‹æ¥å£](http://172.17.0.208:12345/moa-doc/api/filebrowser.html#æ–‡ä»¶æµè§ˆå™¨)\n* [æ·»åŠ æ‰‹åŠ¿å¯†ç ä¿æŠ¤ç›¸å…³è®¾ç½®](http://172.17.0.208:12345/moa-doc/api/private-settings.html#app-settings-opengestureunlocksetting-æ‰“å¼€å†…ç½®çš„æ‰‹åŠ¿è§£é”è®¾ç½®é¡µé¢)\n* [æ·»åŠ ç¬¬ä¸‰æ–¹åˆ†äº«æ¥å£](http://172.17.0.208:12345/moa-doc/api/third-share.html#åˆ†äº«æ¥å£-app-share)\n* [æ·»åŠ æ‰“å¼€å¾®ä¿¡å°ç¨‹åºæ¥å£](http://172.17.0.208:12345/moa-doc/api/third-share.html#æ‰“å¼€å¾®ä¿¡å°ç¨‹åº-app-weixin-openminiprogram)\n* [æ·»åŠ å¯ç”¨å¼•å¯¼é¡µé¢çš„æ¥å£](http://172.17.0.208:12345/moa-doc/api/private-settings.html#)\n\næˆ‘æ–¹æ·»åŠ çš„æ¥å£éƒ½åœ¨ `cd plugins_dev/repo/cordova-plugin-moa-geo-app ` ç›®å½•ä¸­ï¼Œå…·ä½“ç»†èŠ‚ä¹Ÿå¯ä»¥åœ¨git logä¸­ç­›é€‰ â€œH5â€ï¼Œæˆ–è€…é’ˆå¯¹æ­¤ç›®å½•ç›¸å…³çš„æ–‡ä»¶æŸ¥çœ‹å†å²ä¿®æ”¹è®°å½•ï¼Œå®šä½å…·ä½“çš„commitè¿›è¡Œäº†è§£ã€‚\n\n\n\nå…³äºæ’ä»¶å¼€å‘çš„æ–¹å¼ï¼Œä¹‹å‰å·²æœ‰æ¥è§¦ï¼Œä¸åœ¨èµ˜è¿°ï¼Œä»…æ•´ç†ä¸€äº›æ–‡æ¡£ï¼š\n\n* https://shimo.im/docs/XRkgJOPwzmtrFbqM/ ã€ŠCordovaç›¸å…³-READMEã€‹ï¼Œå¯å¤åˆ¶é“¾æ¥åç”¨çŸ³å¢¨æ–‡æ¡£ App æˆ–å°ç¨‹åºæ‰“å¼€\n* https://shimo.im/docs/ne3VVlGLWQf8FB3b/ ã€ŠMOAä¸­çš„Cordovaæ’ä»¶å¼€å‘ - å·¥ä½œæµç¨‹ç¯‡ã€‹ï¼Œå¯å¤åˆ¶é“¾æ¥åç”¨çŸ³å¢¨æ–‡æ¡£ App æˆ–å°ç¨‹åºæ‰“å¼€\n* [Gitlab-æ’ä»¶JSåˆå¹¶readme](http://172.17.0.205/GeoPanel/MobileCenter/geopanel-android/-/blob/geo-client-android/master/plugins_dev/jsMerge/README.md)\n\n## å…¶ä»–è¯´æ˜\n\nç”±äºæœ€åˆè§„åˆ’æ˜¯é“¾åŠ¨å¼€å‘åŸºç¡€ç‰ˆæœ¬ï¼Œåç»­ç”±å…¬å¸è‡ªè¡Œç»´æŠ¤ï¼Œæ•…å‰æœŸéƒ¨åˆ†ä¿®æ”¹å¹¶æœªç‰¹åˆ«ä¸¥æ ¼çš„è€ƒè™‘åŒé“¾åŠ¨çš„ä»£ç åç»­çš„åˆå¹¶ã€‚ä¸”æˆ‘æ–¹ä»£ç åªæœ‰éå¸¸å°‘çš„éƒ¨åˆ†åŒæ­¥åˆ°äº†é“¾åŠ¨ï¼Œæ•…åç»­åˆå¹¶ä»£ç æ—¶åº”è¯¥ç‰¹åˆ«æ³¨æ„ã€‚==å»ºè®®åˆå¹¶ä»£ç åå†ä¸åˆå¹¶å‰çš„ä»£ç è¿›è¡Œå¯¹æ¯”ï¼Œç¡®è®¤åˆå¹¶æ‰€äº§ç”Ÿçš„å·®å¼‚==ã€‚\n\n\n",
      "data": {
        "title": "ç§»åŠ¨ä¸­å¿ƒäº¤æ¥",
        "date": "2021-04-08 16:46:15",
        "tags": [
          "å·¥ä½œ"
        ],
        "published": false,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "ç§»åŠ¨ä¸­å¿ƒäº¤æ¥"
    },
    {
      "content": "# GeoPanelå®¹å™¨åŒ–æ¦‚è§ˆ\n\næ­¤éƒ¨åˆ†ä¸»è¦å·¥ä½œæ˜¯å¯¹GeoPanelä¸­çš„å„æœåŠ¡è¿›è¡Œå®¹å™¨åŒ–æ”¹é€ ï¼Œå³åˆ¶ä½œdockeré•œåƒï¼Œç„¶åå¯¹æœåŠ¡è¿›è¡Œå®¹å™¨åŒ–ç¼–æ’ï¼Œç®€åŒ–éƒ¨ç½²æ­¥éª¤ï¼Œé€‚åº”æ›´åŠ æ™ºèƒ½åŒ–çš„éƒ¨ç½²éœ€æ±‚ã€‚\n\nä¸»è¦åŒ…æ‹¬å¦‚ä¸‹éƒ¨åˆ†ï¼š\n\n```mermaid\ngraph \n\nGeoPanel[GeoPanelå®¹å™¨åŒ–]\nGeoPanel --> pgspideræ‰“åŒ…\nGeoPanel --> hasura-å—æ•°æ®APIå¼•æ“\nGeoPanel --> å…¬å¸è‡ªç ”é•œåƒæ‰“åŒ…\nGeoPanel --> æœåŠ¡ç¼–æ’\n```\n\n* ç”±äºpgspiderå’Œhasuraçš„æ‰“åŒ…è¿‡ç¨‹æ¯”è¾ƒå¤æ‚ï¼Œæ‰€ä»¥éœ€è¦è¿™é‡Œå•ç‹¬åˆ—å‡ºï¼›\n* å…¬å¸è‡ªç ”æœåŠ¡çš„é•œåƒæ‰“åŒ…ä¸»è¦æ˜¯springbootçš„é•œåƒæ‰“åŒ…ï¼Œæµç¨‹æ¯”è¾ƒç®€å•ï¼Œæ‰€ä»¥åˆå¹¶èµ·æ¥è¯´ï¼›\n* æœåŠ¡ç¼–æ’ä¸­æè¿°å½“å‰å·²ç»å®¹å™¨åŒ–çš„æœåŠ¡åŠä½¿ç”¨swarmç¼–æ’çš„æƒ…å†µï¼›\n\n\n\n# GeoPanelå®¹å™¨åŒ–-ARMé•œåƒæ„å»º-é€šç”¨æ­¥éª¤\n\nè¿™é‡Œçš„å›½äº§åŒ–ä¸»è¦æŒ‡ï¼šåˆ¶ä½œarmç‰ˆæœ¬çš„é•œåƒ\n\n## å‰è¨€\n\nç§»åŠ¨ä¸­å¿ƒæ‰€æœ‰æœåŠ¡å…¨éƒ¨åŸºäºdockerï¼Œæ•…æ­¤æ–‡æ¡£å®é™…å™è¿°çš„æ˜¯åŸºäºdockeréƒ¨ç½²çš„æœåŠ¡åœ¨armå¹³å°ä¸Šè¿ç§»çš„åŸºæœ¬è·¯å¾„ï¼›\n\n1. ARM ç‰ˆæœ¬Dockerå®‰è£…ï¼›\n2. æ„å»ºæ‰€æœ‰é•œåƒçš„ARMç‰ˆæœ¬ï¼›\n\n## æµ‹è¯•æœºä¿¡æ¯\n\n| CPU      | FT-1500A 4æ ¸ arm64 |\n| :------- | :----------------- |\n| å†…å­˜     | 8G                 |\n| OS       | éº’éºŸV10            |\n| åŒ…ç®¡ç†å™¨ | apt                |\n\n## ARMæœºå™¨ä¸Šå®‰è£…Docker\n\n>[Dockerå®˜æ–¹æ–‡æ¡£](https://docs.docker.com/engine/install/?fileGuid=0l3NVKX0BgflYN3R)\n\nDockeræ”¯æŒå¦‚ä¸‹ç³»ç»ŸåŠæ¶æ„\n\n![å›¾ç‰‡](https://uploader.shimo.im/f/EgAMxl7X6CbHg4J9.png!thumbnail?fileGuid=0l3NVKX0BgflYN3R)\n\nå›½äº§ç³»ç»Ÿä¾æ®å®‰è£…åŒ…çš„æ ¼å¼é€‰æ‹©å¯¹åº”çš„å‚è€ƒç³»ç»Ÿå³å¯ï¼Œå¦‚éº’éºŸv10åŸºäºubuntuï¼Œå¯ä»¥æŒ‰[å®˜æ–¹æ–‡æ¡£- Install Docker Engine on Ubuntu](https://docs.docker.com/engine/install/ubuntu/?fileGuid=0l3NVKX0BgflYN3R)è¿›è¡Œå®‰è£…ã€‚\n\n### æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯\n\n```plain\ngeostar@geostar-ft1500a:~$ cat /proc/version\nLinux version 4.4.131-20200515.kylin.desktop-generic (YHKYLIN-OS@Kylin) (gcc version 5.5.0 20171010 (Ubuntu/Linaro 5.5.0-12ubuntu1~16.04) ) #kylin SMP Fri May 15 11:29:10 CST 2020\n```\n\nè¿™é‡Œå¯ä»¥çœ‹åˆ°ç³»ç»Ÿæ˜¯åŸºäºubuntu16.04 çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ·»åŠ ubuntu16.04ï¼ˆxenialï¼‰çš„è½¯ä»¶æº\n\n### æ·»åŠ è½¯ä»¶æº\n\n>å‚è€ƒï¼š\n>https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/\n>https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/\n\næ·»åŠ æ¸…åé•œåƒè½¯ä»¶æºï¼ˆarmæ¶æ„ï¼‰\n\n```plain\n# é»˜è®¤æ³¨é‡Šäº†æºç é•œåƒä»¥æé«˜ apt update é€Ÿåº¦ï¼Œå¦‚æœ‰éœ€è¦å¯è‡ªè¡Œå–æ¶ˆæ³¨é‡Š\ndeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ xenial main restricted universe multiverse\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ xenial main restricted universe multiverse\ndeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ xenial-updates main restricted universe multiverse\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ xenial-updates main restricted universe multiverse\ndeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ xenial-backports main restricted universe multiverse\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ xenial-backports main restricted universe multiverse\ndeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ xenial-security main restricted universe multiverse\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ xenial-security main restricted universe multiverse\n```\n\næ›´æ–°ï¼š\n\n```plain\nsudo apt-get install apt-transport-https\nsudo apt-get clean\nsudo apt-get update\n```\n\n### å®‰è£…Docker\n\n```plain\n# å¸è½½æ—§ç‰ˆæœ¬docker\nsudo apt-get remove docker docker-engine docker.io containerd runc\nsudo apt-get update\nsudo apt-get install \\\n    apt-transport-https \\\n    ca-certificates \\\n    curl \\\n    gnupg-agent \\\n    software-properties-common\n    \ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -\n# ç¡®è®¤keyæ·»åŠ æˆåŠŸ(æŸ¥æ‰¾ï¼š9DC8 5822 9FC7 DD38 854AÂ Â E2D8 8D81 803C 0EBF CD88)\nsudo apt-key fingerprint 0EBFCD88\n```\n\nç¼–è¾‘ /etc/apt/source.listï¼Œæ·»åŠ dockerè½¯ä»¶æºï¼ˆarm64 xenialï¼‰ï¼Œå¹¶ä¿å­˜\n\n```plain\n# https://docs.docker.com/engine/install/ubuntu/\ndeb [arch=arm64] https://download.docker.com/linux/ubuntu xenial stable\n```\n\nå®‰è£… docker\n\n```plain\nsudo apt-get update\n# å®‰è£…Docker\nsudo apt-get install docker-ce docker-ce-cli containerd.io\n# å®‰è£…æˆåŠŸï¼ŒæŸ¥çœ‹ç‰ˆæœ¬\ndocker --version\nDocker version 19.03.12, build 48a6621\n```\n\n## åœ¨Dockerhubä¸ŠæŸ¥æ‰¾å·²æœ‰çš„armé•œåƒ\n\nå®é™…ä¸Šå¾ˆå¤šé•œåƒéƒ½æœ‰æ„å»ºarmç‰ˆæœ¬ï¼Œå¯¹äºç›´æ¥ä½¿ç”¨çš„é•œåƒï¼Œæˆ–è€…ä½œä¸ºDockerfileä¸­FROMçš„é•œåƒï¼Œå¦‚æœæœ‰å¯¹åº”çš„armç‰ˆæœ¬ï¼Œåˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œçœç•¥æ„å»ºè¿‡ç¨‹ã€‚ä»¥[postgres](https://hub.docker.com/_/postgres?fileGuid=0l3NVKX0BgflYN3R)ä¸ºä¾‹ï¼Œåœ¨dockerhubä¸Šå¯ä»¥çœ‹åˆ°\n\n![å›¾ç‰‡](https://uploader.shimo.im/f/mEUtglSoqQESjJXs.png!thumbnail?fileGuid=0l3NVKX0BgflYN3R)\n\nåœ¨å…·ä½“çš„tagä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°ç‰ˆæœ¬çš„é•œåƒæ˜¯å¦æ”¯æŒarmæ¶æ„\n\n![å›¾ç‰‡](https://uploader.shimo.im/f/nUbvEcHQlUFCmAkl.png!thumbnail?fileGuid=0l3NVKX0BgflYN3R)\n\nä½†éœ€è¦ä½¿ç”¨çš„é•œåƒä¸æ˜¯æˆ‘ä»¬è‡ªå·±ç¼–è¯‘çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æ¥ç¡®è®¤è¯¥é•œåƒæ˜¯å¦æœ‰å¯¹åº”çš„armç‰ˆæœ¬ã€‚\n\n## ARMç‰ˆæœ¬é•œåƒæ„å»ºï¼ˆéARMæœºå™¨ä¸Šæ‰§è¡Œï¼‰\n\n>å‚è€ƒï¼š\n>-[https://github.com/docker/cli/blob/master/experimental/README.md](https://github.com/docker/cli/blob/master/experimental/README.md?fileGuid=0l3NVKX0BgflYN3R)\n>-[è·¨å¹³å°æ„å»º Docker é•œåƒæ–°å§¿åŠ¿ï¼Œx86ã€arm ä¸€æŠŠæ¢­](https://cloud.tencent.com/developer/article/1543689?fileGuid=0l3NVKX0BgflYN3R)\n\n### æ„å»ºARMé•œåƒçš„ä¸¤ç§æ–¹å¼\n\nå¯¹äºæ„å»ºé•œåƒçš„ARMç‰ˆæœ¬ï¼Œæœ‰å¦‚ä¸‹ä¸¤ç§æ–¹å¼ï¼š\n\n1. åœ¨ARMæœºå™¨ä¸Šä½¿ç”¨ docker build è¿›è¡Œæ„å»ºï¼›\n2. åœ¨X86/AMD64 çš„æœºå™¨ä¸Šä½¿ç”¨ docker buildx è¿›è¡Œäº¤å‰æ„å»ºï¼›\n\nå®é™…æµ‹è¯•ä¸­å‘ç°ç¬¬ä¸€ç§æ–¹å¼åœ¨æŸäº›æƒ…å†µä¸‹ä¼šæœ‰é—®é¢˜ï¼Œå»ºè®®é‡‡ç”¨ç»“åˆé‡‡ç”¨è¿™äºŒç§æ–¹å¼ï¼›\n\nå…³äºç¬¬äºŒç§æ„å»ºæ–¹å¼ï¼Œå¯å…ˆé˜…è¯»[è·¨å¹³å°æ„å»º Docker é•œåƒæ–°å§¿åŠ¿ï¼Œx86ã€arm ä¸€æŠŠæ¢­](https://cloud.tencent.com/developer/article/1543689?fileGuid=0l3NVKX0BgflYN3R)è¿›è¡Œäº†è§£ï¼Œä»¥ä¸‹ç®€è¦ä»‹ç»ä½¿ç”¨buildxäº¤å‰æ„å»ºçš„æ–¹å¼ï¼›\n\n> **âš ï¸æ³¨æ„ï¼š**\n>\n> 1. äº¤å‰æ„å»ºå’Œäº¤å‰è¿è¡Œçš„æ–¹å¼ä¼šæœ‰ä¸€äº›æ— æ³•é¢„çŸ¥çš„é—®é¢˜ï¼Œå»ºè®®ç®€å•çš„æ„å»ºæ­¥éª¤ï¼ˆå¦‚åªæ˜¯ä¸‹è½½è§£å‹å¯¹åº”æ¶æ„çš„æ–‡ä»¶ï¼‰å¯è€ƒè™‘åœ¨x86ä¸‹äº¤å‰æ„å»ºï¼Œå¤æ‚çš„ï¼ˆå¦‚éœ€è¦ç¼–è¯‘çš„ï¼‰åˆ™ç›´æ¥åœ¨armæœºå™¨ä¸Šè¿›è¡Œæ„å»ºï¼›\n>\n> 2. å®é™…æµ‹è¯•å‘ç°ï¼Œä½¿ç”¨[qemuæ–¹å¼](https://github.com/multiarch/qemu-user-static)åœ¨x86å¹³å°ä¸‹è¿è¡Œarmç‰ˆæœ¬çš„é•œåƒæ—¶ï¼Œæ‰§è¡Œç®€å•çš„å‘½ä»¤å¯ä»¥æˆåŠŸï¼ˆå¦‚archï¼‰ï¼Œæ‰§è¡ŒæŸäº›å¤æ‚çš„ç¨‹åºæ—¶ï¼ˆå¦‚å¯åŠ¨javaè™šæ‹Ÿæœºï¼‰ï¼Œä¼šæ— å“åº”ï¼Œæ‰€ä»¥é•œåƒçš„éªŒè¯å·¥ä½œåº”å°½é‡æ”¾ç½®åˆ°armæœºå™¨ä¸Šè¿›è¡Œï¼›\n>\n>    ä¸Šé¢ç¬¬äºŒç‚¹æŒ‰å¦‚ä¸‹æ–¹å¼æµ‹è¯•ï¼š \n>\n>    * `docker run --rm --platform=linux/arm64 openjdk:8u212-jre-alpine arch` å¯æ­£å¸¸è¾“å‡ºï¼›\n>    * `docker run --rm --platform=linux/arm64 openjdk:8u212-jre-alpine java -version` åˆ™ä¼š**å¡ä½**ï¼Œä¸”éœ€è¦ä½¿ç”¨`docker stop`åœæ­¢å®¹å™¨æ‰å¯ä»¥é€€å‡ºå®¹å™¨ï¼›\n\n### å¯ç”¨è¯•éªŒæ€§åŠŸèƒ½\n\n>å‚è€ƒï¼šhttps://docs.docker.com/engine/reference/commandline/cli/#experimental-features\n>æ³¨æ„ï¼šbuildx ä»…æ”¯æŒ docker19.03 åŠä»¥ä¸Šdockerç‰ˆæœ¬\n\nå¦‚éœ€ä½¿ç”¨ buildxï¼Œéœ€è¦å¼€å¯dockerçš„å®éªŒåŠŸèƒ½åï¼Œæ‰å¯ä»¥ä½¿ç”¨ï¼Œå¼€å¯æ–¹å¼ï¼š\n\n* ç¼–è¾‘   /etc/docker/daemon.json\n* æ·»åŠ ï¼š\n\n```json\n{\nÂ Â Â  \"experimental\": true\n}\n```\n\n* ç¼–è¾‘ ï½/.docker/config.json æ·»åŠ ï¼š\n\n```json\n\"experimental\" : \"enabled\"\n```\n\n* é‡å¯Dockerä½¿ç”Ÿæ•ˆï¼š\n  * sudo systemctl  daemon-reload\n  * sudo systemctl  restart docker\n* ç¡®è®¤æ˜¯å¦å¼€å¯ï¼š\n  * docker version -f'{{.Server.Experimental}}'\n  * å¦‚æœè¾“å‡ºtrueï¼Œåˆ™è¡¨ç¤ºå¼€å¯æˆåŠŸ\n\n### ä½¿ç”¨buildxæ„å»º\n\nbuildx çš„è¯¦ç»†ä½¿ç”¨å¯å‚è€ƒï¼š[Dockerå®˜æ–¹æ–‡æ¡£-Reference-buildx ](https://docs.docker.com/engine/reference/commandline/buildx/?fileGuid=0l3NVKX0BgflYN3R)\n\n#### åˆ›å»º buildx æ„å»ºå™¨\n\nä½¿ç”¨ docker buildx ls å‘½ä»¤æŸ¥çœ‹ç°æœ‰çš„æ„å»ºå™¨\n\n```shell\ndocker buildx ls\n```\n\nåˆ›å»ºå¹¶æ„å»ºå™¨ï¼š\n\n```shell\n# ä¸‹é¢çš„åˆ›å»ºå‘½ä»¤ä»»é€‰ä¸€æ¡ç¬¦åˆæƒ…å†µçš„å³å¯\n# 1. ä¸æŒ‡å®šä»»ä½•å‚æ•°åˆ›å»º\ndocker buildx create --use --name multiarch-builder\n# 2. å¦‚åˆ›å»ºåä½¿ç”¨docker buildx ls å‘ç°æ„å»ºèµ·æ²¡æœ‰armæ¶æ„æ”¯æŒï¼Œå¯ä½¿ç”¨--platformæ˜ç¡®æŒ‡å®šè¦æ”¯æŒçš„æ„å»ºç±»å‹ï¼Œå¦‚ä»¥ä¸‹å‘½ä»¤\ndocker buildx create --platform linux/arm64,linux/arm/v7,linux/arm/v6 --name multiarch-builder\n# 3. å¦‚éœ€åœ¨buildxè®¿é—®ç§æœ‰registryï¼Œå¯ä½¿ç”¨hostæ¨¡å¼ï¼Œå¹¶æ‰‹åŠ¨æŒ‡å®šé…ç½®æ–‡ä»¶ï¼Œé¿å…buildxæ—¶æ— æ³•è®¿é—®æœ¬åœ°çš„registryä¸»æœº \ndocker buildx create --platform linux/amd64,linux/arm64,linux/arm/v7,linux/arm/v6  --driver-opt network=host --config=/Users/hanlyjiang/.docker/buildx-config.toml --use --name multiarch-builder \n```\n\nbuildx-config.toml é…ç½®æ–‡ä»¶å†™æ³•ç±»ä¼¼ï¼š\n\n```plain\n# https://github.com/moby/buildkit/blob/master/docs/buildkitd.toml.md\n# registry configures a new Docker register used for cache import or output.\n[registry.\"zh-registry.geostar.com.cn\"]\nÂ  mirrors = [\"zh-registry.geostar.com.cn\"]\nÂ  http = true\nÂ  insecure = true\n```\n\n**å¯ç”¨æ„å»ºå™¨**\n\n```shell\n# åˆå§‹åŒ–å¹¶æ¿€æ´»\ndocker buildx inspect multiarch-builder --bootstrap\n```\n\n**ç¡®è®¤æˆåŠŸ**\n\n```plain\n# ä½¿ç”¨ docker buildx ls æŸ¥çœ‹\ndocker buildx ls \n```\n\n### ä¿®æ”¹Dockerfile\n\nå¯¹ Dockerfile çš„ä¿®æ”¹ï¼Œå¤§è‡´éœ€è¦è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š\n\n1. ç¡®è®¤åŸºç¡€é•œåƒï¼ˆFROMï¼‰æ˜¯å¦æœ‰armç‰ˆæœ¬ï¼Œå¦‚æœæœ‰ï¼Œåˆ™å¯ä»¥ä¸ç”¨æ”¹åŠ¨ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™éœ€è¦å¯»æ‰¾æ›¿ä»£é•œåƒï¼Œå¦‚æ²¡æœ‰æ›¿ä»£é•œåƒï¼Œåˆ™å¯èƒ½éœ€è¦è‡ªè¡Œç¼–è¯‘ï¼›\n2. ç¡®è®¤dockerfileçš„å„ä¸ªæ­¥éª¤ä¸­æ˜¯å¦æœ‰ä¾èµ–CPUæ¶æ„çš„ï¼Œå¦‚æœæœ‰ï¼Œåˆ™éœ€è¦æ›¿æ¢æˆarmæ¶æ„çš„ï¼Œå¦‚åœ¨æ„å»ºjitisçš„é•œåƒæ—¶ï¼ŒDockerfileä¸­æœ‰æ·»åŠ ä¸€ä¸ªamd64æ¶æ„çš„è½¯ä»¶\n\n`ADD https://github.com/just-containers/s6-overlay/releases/download/v1.21.4.0/s6-overlay-amd64.tar.gz /tmp/s6-overlay.tar.gz`\n\næ­¤æ—¶éœ€è¦æ›¿æ¢ä¸ºä¸‹é¢çš„åœ°å€(æ³¨æ„amd64æ›¿æ¢æˆäº†aarch64ï¼Œå½“ç„¶ï¼Œéœ€è¦å…ˆç¡®è®¤ä¸‹è½½åœ°å€ä¸­æœ‰æ— å¯¹åº”æ¶æ„çš„gzåŒ…ï¼Œä¸èƒ½ç®€å•åšå­—ç¬¦æ›¿æ¢)ï¼š\n\n`ADD https://github.com/just-containers/s6-overlay/releases/download/v1.21.4.0/s6-overlay-aarch64.tar.gz /tmp/s6-overlay.tar.gz`\n\nå½“ç„¶ï¼Œæˆ‘ä»¬éœ€è¦ç¡®è®¤è¯¥è½¯ä»¶æœ‰æ­¤æ¶æ„çš„å½’æ¡£åŒ…ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™éœ€è¦è€ƒè™‘ä»æºç æ„å»ºï¼›\n\n> **æç¤ºï¼š**\n>\n> æ€ä¹ˆç¡®å®šä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶/soåº“çš„å¯¹åº”çš„æ‰§è¡Œæ¶æ„ï¼Ÿ å¯ä»¥é€šè¿‡ `file {å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„}` æ¥æŸ¥çœ‹ï¼Œ\n>\n> å¦‚ä¸‹é¢æ—¶macOSä¸Šæ‰§è¡Œfileå‘½ä»¤çš„è¾“å…¥ï¼Œå¯ä»¥å‘ç°macOSä¸Šçš„gitç¨‹åºå¯ä»¥å…¼å®¹ä¸¤ç§æ¶æ„-`x86_64&arm64e`ï¼š\n>\n> ```shell\n> file $(which git)\n> /usr/bin/git: Mach-O universal binary with 2 architectures: [x86_64:Mach-O 64-bit executable x86_64] [arm64e:Mach-O 64-bit executable arm64e]\n> /usr/bin/git (for architecture x86_64):\tMach-O 64-bit executable x86_64\n> /usr/bin/git (for architecture arm64e):\tMach-O 64-bit executable arm64e\n> ```\n>\n> ä¸‹é¢çš„å‘½ä»¤åˆ™å¯¹ä¸€ä¸ªsoæ–‡ä»¶æ‰§è¡Œäº†fileï¼Œå¯ä»¥çœ‹åˆ°å…¶ä¸­çš„æ¶æ„ä¿¡æ¯ `ARM aarch64`ï¼š\n>\n> ```shell\n> file /lib/aarch64-linux-gnu/libpthread-2.23.so\n> /lib/aarch64-linux-gnu/libpthread-2.23.so: ELF 64-bit LSB shared object, ARM aarch64, version 1 (GNU/Linux), dynamically linked, interpreter /lib/ld-linux-aarch64.so.1, BuildID[sha1]=880365ebb22114e4c10108b73243144d5fa315dc, for GNU/Linux 3.7.0, not stripped\n> ```\n\n### docker buildx æ„å»ºarm64é•œåƒçš„å‘½ä»¤\n\nä½¿ç”¨ --platformæ¥æŒ‡å®šæ¶æ„ï¼Œä½¿ç”¨ `--push` æˆ– `--load` æ¥æŒ‡å®šæ„å»ºå®Œæ¯•åçš„åŠ¨ä½œã€‚\n\n```shell\ndocker buildx build --platform=linux/arm64,linux/amd64 -t xxxx:tag . --push \n```\n\n> æç¤ºï¼šå½“æŒ‡å®šå¤šä¸ªæ¶æ„æ—¶ï¼Œåªèƒ½ä½¿ç”¨ --push æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼Œæ— æ³• --loadï¼Œæ¨é€æˆåŠŸåå†é€šè¿‡ docker pull --platform æ¥æ‹‰å–æŒ‡å®šæ¶æ„çš„é•œåƒ\n\n### æ£€æŸ¥æ„å»ºæˆæœ\n\n1. é€šè¿‡ `docker buildx imagetools inspect` å‘½ä»¤æŸ¥çœ‹é•œåƒä¿¡æ¯ï¼Œçœ‹æ˜¯å¦æœ‰å¯¹åº”çš„armæ¶æ„ä¿¡æ¯ï¼›\n2. å®é™…è¿è¡Œé•œåƒï¼Œç¡®è®¤è¿è¡Œæ­£å¸¸ï¼›ï¼ˆåœ¨armæœºå™¨ä¸Šæ‰§è¡Œï¼‰\n\n>æç¤ºï¼šå¦‚è¿è¡Œæ—¶è¾“å‡º exec format error ç±»ä¼¼é”™è¯¯ï¼Œåˆ™è¡¨ç¤ºé•œåƒä¸­éƒ¨åˆ†å¯æ‰§è¡Œæ–‡ä»¶æ¶æ„ä¸åŒ¹é…ã€‚\n\n\n\n## åœ¨x86ä¸Šè¿è¡Œarmé•œåƒ\n\nå¯å‚è€ƒ [github/qemu-user-static](https://github.com/multiarch/qemu-user-static) ,ç®€è¦æè¿°å¦‚ä¸‹ï¼š\n\n* æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å®‰è£…ï¼š\n\n  `docker run --rm --privileged multiarch/qemu-user-static --reset -p yes`\n\n* ä¹‹åå³å¯è¿è¡Œarmç‰ˆæœ¬çš„é•œåƒï¼Œå¦‚ï¼š\n\n  ```shell\n  docker run --rm -t arm64v8/fedora uname -m\n  ```\n\n  \n\n\n\n\n\n# GeoPanelå®¹å™¨åŒ–-PGspideré•œåƒæ„å»º\n\n## æ¦‚è§ˆ\n\npostgreSQLæ˜¯ä¸€ä¸ªå¼€æºçš„å¯¹è±¡-å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œæœ¬èº«æä¾›äº†x86åŠarmç‰ˆæœ¬çš„é•œåƒï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦è‡ªå·±æ„å»ºå¯¹åº”å‘¢ï¼Ÿ\n\n<img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210319141649.png\" alt=\"image-20210319141649673\" style=\"zoom: 50%;\" />\n\nå› ä¸ºæˆ‘ä»¬éœ€è¦ä½¿ç”¨[pgspider](https://github.com/pgspider/pgspider)ï¼Œå®ƒæ˜¯ç»™äºˆpg11.6çš„ä»£ç è¡¥ä¸åŒ…ï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•ç›´æ¥å¤ç”¨å®˜æ–¹çš„é•œåƒä½œä¸ºåŸºç¡€é•œåƒï¼›\n\nåŒæ—¶ï¼Œæˆ‘ä»¬è¿˜æ·»åŠ äº†è®¸å¤špgçš„æ’ä»¶ç”¨äºæ‰©å±•pgçš„èƒ½åŠ›ï¼Œå¦‚æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»è‡ªè¡Œæ‰“åŒ…pgé•œåƒï¼›\n\n### é•œåƒéœ€è¦åŒ…æ‹¬çš„ç»„ä»¶ï¼š\n\n| ç»„ä»¶                 | è¯´æ˜                                                        |\n| -------------------- | ----------------------------------------------------------- |\n| postgis11.6          | postgreSQL                                                  |\n| pgspider             | postgreSQLæºç è¡¥ä¸ï¼Œå¢å¼ºFDWåŠŸèƒ½                             |\n| postgis2.5.3åŠå…¶ä¾èµ– | postgres gis æ’ä»¶ï¼Œç”¨äºæä¾›geometryç›¸å…³æ”¯æŒ                 |\n| postgres_fdw         | postgres_fdw æ¥å…¥å¤–éƒ¨postgresæ•°æ®æº                         |\n| sqlite_fdw           | sqlite_fdw æ¥å…¥å¤–éƒ¨sqliteæ•°æ®æº                             |\n| mysql_fdw            | mysql_fdw æ¥å…¥å¤–éƒ¨mysqlæ•°æ®æº                               |\n| oracle_fdw           | oracle_fdw æ¥å…¥å¤–éƒ¨oracleæ•°æ®æº                             |\n| zdb(es_fdw)          | es_fdw æ¥å…¥å¤–éƒ¨esæ•°æ®æº                                     |\n| debezium             | æ•°æ®åº“äº‹ä»¶è½¬ä¸ºäº‹ä»¶æµï¼Œé…åˆkafkaä½¿ç”¨ï¼Œå®ç°æ•°æ®å®æ—¶åŒæ­¥       |\n| wal2json             | pg æ—¥å¿—æ ¼å¼è½¬æ¢æ’ä»¶ï¼Œé…åˆdebeziumä½¿ç”¨ï¼Œä»¥jsonæ ¼å¼æ¨é€äº‹ä»¶æµ |\n\n\n\n### æ•´ä½“æ„å»ºæµç¨‹\n\nä¸ºäº†æ„å»ºæ­¤é•œåƒï¼Œæˆ‘ä»¬åˆ¶ä½œäº†è‹¥å¹²è¾…åŠ©é•œåƒï¼ŒåŒ…æ‹¬ï¼š\n\n```mermaid\ngraph \nbuilder\n\npgspider-base\n\npostgis-pgspider\n```\n\nå…¶ä¸­:\n\n* `builder` é•œåƒä¸ºæˆ‘ä»¬çš„æ„å»ºå™¨é•œåƒï¼Œç”¨åšpgspiderçš„ç¼–è¯‘ç¯å¢ƒï¼Œå…¶ä¸­åŒ…å«pg11.6æºç åŠpgspideræºç ï¼ŒåŠç¼–è¯‘å¥½çš„pgåŠpgspiderï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶æœªå¯¹æˆæœç‰©è¿›è¡Œæå–ï¼Œå› ä¸ºæ­¤è¿›è¡Œè¦ä¿ç•™æ‰€æœ‰æ„å»ºç¯å¢ƒï¼Œç”¨äºåç»­å…¶ä»–æˆ‘ä»¬é™„åŠ åˆ°pgçš„æ’ä»¶çš„æ„å»ºï¼›\n* `pgspider-base` é•œåƒä¸­å®‰è£…postgresè¿è¡Œæ‰€éœ€è¦çš„è‹¥å¹²ä¾èµ–ï¼Œä½œä¸ºæœ€ç»ˆé•œåƒæ„å»ºçš„åŸºç¡€ï¼Œé¿å…æ¯æ¬¡æ„å»ºé•œåƒéƒ½éœ€è¦æ‰§è¡Œé‡å¤çš„ä¾èµ–å®‰è£…æ“ä½œï¼›\n* `postgis-pgspider` ä¸ºæˆ‘ä»¬çš„æœ€ç»ˆé•œåƒï¼›åŸºäº`pgspider-base`é•œåƒåˆ¶ä½œï¼Œå¹¶åˆå¹¶æˆ‘ä»¬ä½¿ç”¨ `builder` é•œåƒæ„å»ºçš„æ‰€æœ‰éœ€è¦çš„æˆæœæ–‡ä»¶ï¼›\n\næ¥ä¸‹æ¥æˆ‘ä»¬è¯¦ç»†è¯´æ˜ä»¥ä¸Šå‡ ä¸ªé•œåƒåˆ†åˆ«å¦‚ä½•æ„å»ºã€‚\n\n\n\n### ç°åœ¨æˆæœä»“åº“\n\nGitlabä»“åº“åœ°å€ï¼š[geopanel-deploy](http://172.17.0.205/dept-development/product-project/geopanel/geopanel-deploy/-/tree/master/build/pgspider)\n\n> æç¤ºï¼š å¯æŸ¥çœ‹[ä»“åº“ç›®å½•ä¸­çš„README.md](http://172.17.0.205/dept-development/product-project/geopanel/geopanel-deploy/-/tree/master/build/pgspider) äº†è§£æ›´å¤šä¿¡æ¯ï¼›\n\nç›®å½•ç»“æ„å¦‚ä¸‹ï¼š\n\n```shell\npgspider\n    â”œâ”€â”€ Dockerfile-base.dockerfile - æ„å»ºpgspider-baseé•œåƒçš„è„šæœ¬\n    â”œâ”€â”€ Dockerfile-builder.dockerfile - æ„å»ºpgspider-builderé•œåƒçš„è„šæœ¬\n    â”œâ”€â”€ Dockerfile-source-arm-add.dockerfile - æ„å»ºpostgis-pgspideré•œåƒçš„è„šæœ¬ï¼ˆç”¨äºå¢é‡æ„å»ºï¼‰\n    â”œâ”€â”€ Dockerfile-source-arm.dockerfile - æ„å»ºpostgis-pgspideré•œåƒçš„è„šæœ¬\n    â”œâ”€â”€ Dockerfile-source.dockerfile - æ„å»ºpostgis-pgspideré•œåƒçš„è„šæœ¬\n    â”œâ”€â”€ README.md\n    â”œâ”€â”€ binary - æˆ‘æ–¹æœ‰ä¿®æ”¹çš„é¢„ç¼–è¯‘çš„fdwï¼ˆx86æ¶æ„ï¼‰\n    â”‚Â Â  â”œâ”€â”€ mysql_fdw\n    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ mysql_fdw--1.1.sql\n    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ mysql_fdw.control\n    â”‚Â Â  â”‚Â Â  â””â”€â”€ mysql_fdw.so\n    â”‚Â Â  â”œâ”€â”€ oracle\n    â”‚Â Â  â”‚Â Â  â””â”€â”€ oracle_fdw.so\n    â”‚Â Â  â””â”€â”€ zdblibs\n    â”‚Â Â      â”œâ”€â”€ zombodb--1.0.0a1--1.0.0a2.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--1.0.0a2--1.0.0a3.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--1.0.0a3--1.0.0a4.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--1.0.0a4--1.0.0a5.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--1.0.0a5--1.0.0a6.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--1.0.0a6--1.0.0a7.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--1.0.0a7--1.0.0a8.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--1.0.0a8--1.0.0a9.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--1.0.0a9--10-1.0.0a9.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.0--10-1.0.1.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.0a9--10-1.0.0b1.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.0b1--10-1.0.0b2.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.0b10--10-1.0.0b11.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.0b11--10-1.0.0b12.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.0b12--10-1.0.0.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.0b2--10-1.0.0b3.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.0b3--10-1.0.0b4.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.0b4--10-1.0.0b5.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.0b5--10-1.0.0b6.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.0b6--10-1.0.0b7.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.0b7--10-1.0.0b8.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.0b8--10-1.0.0b9.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.0b9--10-1.0.0b10.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.1--10-1.0.2.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.2--10-1.0.3.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.3--10-1.0.4.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.4--10-1.0.5.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.5--4.0.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--4.0.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb.control\n    â”‚Â Â      â””â”€â”€ zombodb.so\n    â”œâ”€â”€ binary-arm æˆ‘æ–¹æœ‰ä¿®æ”¹çš„é¢„ç¼–è¯‘çš„fdwï¼ˆarmæ¶æ„ï¼‰\n    â”‚Â Â  â”œâ”€â”€ mysql_fdw\n    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ mysql_fdw--1.1.sql\n    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ mysql_fdw.control\n    â”‚Â Â  â”‚Â Â  â””â”€â”€ mysql_fdw.so\n    â”‚Â Â  â””â”€â”€ zdblibs\n    â”‚Â Â      â”œâ”€â”€ zombodb--1.0.0a1--1.0.0a2.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--1.0.0a2--1.0.0a3.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--1.0.0a3--1.0.0a4.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--1.0.0a4--1.0.0a5.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--1.0.0a5--1.0.0a6.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--1.0.0a6--1.0.0a7.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--1.0.0a7--1.0.0a8.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--1.0.0a8--1.0.0a9.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--1.0.0a9--10-1.0.0a9.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.0--10-1.0.1.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.0a9--10-1.0.0b1.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.0b1--10-1.0.0b2.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.0b10--10-1.0.0b11.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.0b11--10-1.0.0b12.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.0b12--10-1.0.0.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.0b2--10-1.0.0b3.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.0b3--10-1.0.0b4.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.0b4--10-1.0.0b5.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.0b5--10-1.0.0b6.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.0b6--10-1.0.0b7.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.0b7--10-1.0.0b8.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.0b8--10-1.0.0b9.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.0b9--10-1.0.0b10.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.1--10-1.0.2.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.2--10-1.0.3.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.3--10-1.0.4.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.4--10-1.0.5.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--10-1.0.5--4.0.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb--4.0.sql\n    â”‚Â Â      â”œâ”€â”€ zombodb.control\n    â”‚Â Â      â””â”€â”€ zombodb.so\n    â”œâ”€â”€ config - æ•°æ®åº“é…ç½®æ–‡ä»¶\n    â”‚Â Â  â”œâ”€â”€ pg_hba.conf\n    â”‚Â Â  â”œâ”€â”€ pg_hba.conf.raw\n    â”‚Â Â  â””â”€â”€ postgresql.conf\n    â”œâ”€â”€ debezium - debeziumæ’ä»¶çš„æºç åŠwal2jsonçš„æºç \n    â”‚Â Â  â”œâ”€â”€ README.md\n    â”‚Â Â  â”œâ”€â”€ init-debezium.sh\n    â”‚Â Â  â”œâ”€â”€ postgres-decoderbufs.tar.gz\n    â”‚Â Â  â”œâ”€â”€ test.sql\n    â”‚Â Â  â””â”€â”€ wal2json-wal2json_1_0.tar.gz\n    â”œâ”€â”€ docker-entrypoint.sh - å…¥å£å¯åŠ¨è„šæœ¬\n    â”œâ”€â”€ draft - ä¸´æ—¶æ–‡ä»¶ï¼Œå¯å¿½ç•¥\n    â”‚Â Â  â”œâ”€â”€ Dockerfile\n    â”‚Â Â  â”œâ”€â”€ Dockerfile-all-in-one.dockerfile\n    â”‚Â Â  â”œâ”€â”€ Dockerfile-apt.dockerfile\n    â”‚Â Â  â”œâ”€â”€ Dockerfile-postGIS.dockerfile\n    â”‚Â Â  â””â”€â”€ README.md\n    â”œâ”€â”€ initdb-fdw.sh - åˆå§‹åŒ–fdwsè„šæœ¬\n    â”œâ”€â”€ oracle\n    â”‚Â Â  â”œâ”€â”€ instantclient-basic-linux.x64-12.2.0.1.0.zip\n    â”‚Â Â  â”œâ”€â”€ instantclient-sdk-linux.x64-12.2.0.1.0.zip\n    â”‚Â Â  â”œâ”€â”€ instantclient-sqlplus-linux.x64-12.2.0.1.0.zip\n    â”‚Â Â  â””â”€â”€ oracle_fdw-ORACLE_FDW_2_2_0.tar.gz\n    â”œâ”€â”€ postgis - postgisåŠå…¶ä¾èµ–åº“æºç åŠåˆå§‹åŒ–è„šæœ¬\n    â”‚Â Â  â”œâ”€â”€ CGAL-4.11.2.tar.xz\n    â”‚Â Â  â”œâ”€â”€ SFCGAL-1.3.5.tar.gz\n    â”‚Â Â  â”œâ”€â”€ boost_1_67_0.tar.gz\n    â”‚Â Â  â”œâ”€â”€ gdal-3.0.2.tar.gz\n    â”‚Â Â  â”œâ”€â”€ geos-3.8.0.tar.bz2\n    â”‚Â Â  â”œâ”€â”€ initdb-postgis.sh\n    â”‚Â Â  â”œâ”€â”€ libspatialite-4.3.0a.tar.gz\n    â”‚Â Â  â”œâ”€â”€ mpfr-4.0.2.tar.gz\n    â”‚Â Â  â”œâ”€â”€ postgis-2.5.2.tar.gz\n    â”‚Â Â  â”œâ”€â”€ postgis-2.5.3.tar.gz\n    â”‚Â Â  â”œâ”€â”€ proj-6.2.0.tar.gz\n    â”‚Â Â  â””â”€â”€ update-postgis.sh\n    â””â”€â”€ test.sql - æµ‹è¯•æ˜¯å¦æ­£å¸¸å·¥ä½œçš„sqlæ–‡ä»¶\n\n```\n\n\n\n## builderé•œåƒæ„å»º\n\nbuilderé•œåƒçš„æ‰“åŒ…è„šæœ¬ä¸º `Dockerfile-builder.dockerfile`ï¼Œæˆ‘ä»¬ä½¿ç”¨ç›¸åŒçš„è„šæœ¬æ„å»ºarmåŠx86ç‰ˆæœ¬çš„é•œåƒï¼›\n\n### æ‰“åŒ…å‘½ä»¤\n\n```shell\nTAG=$(date +%Y%m%d)\n# X86 é•œåƒæ„å»º\ndocker build -t pgspider-builder:$TAG -f Dockerfile-builder.dockerfile ./\n## arm\ndocker buildx build \\\n      --progress plain \\\n      --platform=linux/arm64 \\\n      -t pgspider-builder-arm:latest \\\n      -f Dockerfile-builder.dockerfile ./ --load\n```\n\n### è„šæœ¬è¯¦è§£\n\n> æ–‡ä»¶åœ°å€ï¼š [Dockerfile-builder.dockerfile](http://172.17.0.205/dept-development/product-project/geopanel/geopanel-deploy/-/blob/master/build/pgspider/Dockerfile-builder.dockerfile)\n\nè„šæœ¬å†…å®¹å¦‚ä¸‹ï¼Œè¯·æŸ¥çœ‹è„šæœ¬ä¸­çš„æ³¨é‡Šï¼š\n\nè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬ç¼–è¯‘åçš„æˆæœå…¶å®ä½äº `/usr/local/pgspider` ç›®å½•ä¸­ï¼Œè¿™ä¸ªåé¢ä¼šç”¨åˆ°ï¼›\n\n```dockerfile\n#\n# pgspider æºç æ„å»ºé•œåƒï¼ŒåŒ…å«pgspideræºç åŠä¸­é—´ä¸´æ—¶æˆæœï¼Œç”¨äºåç»­æ„å»ºå…¶ä»–fdwåŠæå–pgspiderå¯è¿è¡Œé•œåƒ\n#\n## ä½¿ç”¨ debian:stretch-slim ä½œä¸ºåŸºç¡€\nFROM debian:stretch-slim\nRUN apt-get update && apt-get install -y build-essential git libossp-uuid-dev wget libreadline-dev  zlib1g-dev\n## è®¾ç½®å·¥ä½œç›®å½•ä¸ºapp\nWORKDIR /app\n## \n# æ¥æº https://github.com/docker-library/postgres/blob/master/11/Dockerfile\n## é…ç½®localesä¸ºen_US.utf8\nRUN set -eux; \\\n   if [ -f /etc/dpkg/dpkg.cfg.d/docker ]; then \\\n       # if this file exists, we're likely in \"debian:xxx-slim\", and locales are thus being excluded so we need to remove that exclusion (since we need locales)\n       grep -q '/usr/share/locale' /etc/dpkg/dpkg.cfg.d/docker; \\\n       sed -ri '/\\/usr\\/share\\/locale/d' /etc/dpkg/dpkg.cfg.d/docker; \\\n       ! grep -q '/usr/share/locale' /etc/dpkg/dpkg.cfg.d/docker; \\\n   fi; \\\n   apt-get update; apt-get install -y locales; rm -rf /var/lib/apt/lists/*; \\\n   localedef -i en_US -c -f UTF-8 -A /usr/share/locale/locale.alias en_US.UTF-8\nENV LANG en_US.utf8\n\n## å®‰è£…æ‰€éœ€ä¾èµ–\nRUN set -eux; \\\n   apt-get update; \\\n# install \"nss_wrapper\" in case we need to fake \"/etc/passwd\" and \"/etc/group\" (especially for OpenShift)\n# https://github.com/docker-library/postgres/issues/359\n# https://cwrap.org/nss_wrapper.html\n   apt-get install -y --no-install-recommends libnss-wrapper; \\\n   rm -rf /var/lib/apt/lists/*\n  \n## è·å–pg11.6æºç \nRUN wget https://ftp.postgresql.org/pub/source/v11.6/postgresql-11.6.tar.gz\n## è·å–pgspiderçš„è¡¥ä¸åŒ…\nRUN wget https://raw.githubusercontent.com/pgspider/pgspider/master/pgspider.patch\n## è§£å‹pg\nRUN tar xvf postgresql-11.6.tar.gz\n## åº”ç”¨pgspideræºç è¡¥ä¸åŒ…åˆ°pgæºç \nRUN patch -p1 -d postgresql-11.6 < /app/pgspider.patch\n## å¼€å§‹æ‰§è¡Œç¼–è¯‘ï¼Œå¯å‚è€ƒpgspider githubé¡µé¢\nRUN cd postgresql-11.6 \\\n   && ./configure --with-uuid=ossp \\\n   ## ç¼–è¯‘PGå¹¶install\n   && make && make install \\\n   ## ç¼–è¯‘pgspider_core_fdw å¹¶install\n   && cd /app/postgresql-11.6/contrib/pgspider_core_fdw \\\n   && make && make install \\\n   ## ç¼–è¯‘ pgspider_fdw å¹¶install\n   && cd /app/postgresql-11.6/contrib/pgspider_fdw \\\n   && make && make install \\\n   ## ç¼–è¯‘postgres_fdwå¹¶install\n   && cd /app/postgresql-11.6/contrib/postgres_fdw \\\n   && make && make install \\\n   ## ç¼–è¯‘contribå¹¶install\n   && cd /app/postgresql-11.6/contrib \\\n   && make && make install\nENV PATH $PATH:/usr/local/pgspider/bin\n```\n\n\n\n## baseé•œåƒæ„å»º\n\nbase é•œåƒçš„æ‰“åŒ…è„šæœ¬ä¸º `Dockerfile-base.dockerfile`ï¼Œæˆ‘ä»¬ä½¿ç”¨ç›¸åŒçš„è„šæœ¬æ„å»ºarmåŠx86ç‰ˆæœ¬çš„é•œåƒï¼›\n\n### æ‰“åŒ…å‘½ä»¤\n\n```shell\nTAG=$(date +%Y%m%d)\n# æ‰“åŒ…x86ç‰ˆæœ¬\ndocker build -t pgspider-base:$TAG -f Dockerfile-base.dockerfile ./\n## arm\ndocker buildx build \\\n      --progress plain \\\n      --platform=linux/arm64 \\\n      -t pgspider-base-arm:$TAG \\\n      -f Dockerfile-base.dockerfile ./ --load\n      \n## ä¹Ÿå¯ä½¿ç”¨ä¸€æ¡å‘½ä»¤æ„å»ºä¸¤ä¸ªç‰ˆæœ¬çš„é•œåƒï¼Œæ­¤æ—¶å¿…é¡»åœ¨é•œåƒtagä¸­åŒ…å«å¯ç”¨çš„docker registryåœ°å€ï¼Œå¹¶ä¸”ä½¿ç”¨ `--push` å‚æ•°åœ¨æ‰“åŒ…å®Œæˆåæ¨é€é•œåƒåˆ°registry\n## å®Œæˆåå†æ‹‰å–åˆ°æœ¬åœ°è¿›è¡Œæµ‹è¯•\ndocker buildx build \\\n      --progress plain \\\n      --platform=linux/arm64,linux/amd64 \\\n      -t hanlyjiang/pgspider-base-arm:$TAG \\\n      -f Dockerfile-base.dockerfile ./ --push\n```\n\n\n\n### è„šæœ¬è¯¦è§£\n\n> è„šæœ¬åœ¨çº¿åœ°å€ï¼š [gitlab](http://172.17.0.205/dept-development/product-project/geopanel/geopanel-deploy/-/blob/master/build/pgspider/Dockerfile-base.dockerfile)\n\n```dockerfile\n#\n# PGSpider åŸºç¡€é•œåƒ\n# 1. å®‰è£…éœ€è¦çš„ä¾èµ–ï¼Œé¿å…åç»­æ¯æ¬¡æ„å»ºæ—¶éƒ½éœ€è¦å®‰è£…ï¼ˆä¾èµ–éƒ¨åˆ†å¯èƒ½éœ€è¦ç²¾ç®€ï¼‰\n# 2. æ·»åŠ å¯¹åº”çš„postgresç”¨æˆ·\nFROM debian:stretch-slim\n\n## å®‰è£…å¿…è¦ä¾èµ–\nRUN set -ex; \\\n\tif ! command -v gpg > /dev/null; then \\\n\t\tapt-get update; \\\n\t\tapt-get install -y --no-install-recommends \\\n\t\t\tgnupg \\\n\t\t\tdirmngr \\\n\t\t; \\\n\t\trm -rf /var/lib/apt/lists/*; \\\n\tfi\n\n## å®‰è£…ä¾èµ–ï¼Œå¹¶åˆ›å»ºpgéœ€è¦çš„ç”¨æˆ·åŠç»„idï¼Œåˆ›å»ºpgéœ€è¦çš„ç›®å½•å¹¶èµ‹äºˆå¯¹åº”çš„ç»„å’Œidæ”¹ç›®å½•çš„æƒé™\n# explicitly set user/group IDs\nRUN set -eux; \\\n\tgroupadd -r postgres --gid=999; \\\n# https://salsa.debian.org/postgresql/postgresql-common/blob/997d842ee744687d99a2b2d95c1083a2615c79e8/debian/postgresql-common.postinst#L32-35\n\tuseradd -r -g postgres --uid=999 --home-dir=/var/lib/postgresql --shell=/bin/bash postgres; \\\n# also create the postgres user's home directory with appropriate permissions\n# see https://github.com/docker-library/postgres/issues/274\n\tmkdir -p /var/lib/postgresql; \\\n\tchown -R postgres:postgres /var/lib/postgresql\n\n## æ·»åŠ  gosu ç”¨äºåç»­æ–¹ä¾¿ä½¿ä»rooté™æƒé™\n# grab gosu for easy step-down from root\n# https://github.com/tianon/gosu/releases\nENV GOSU_VERSION 1.12\nRUN set -eux; \\\n\tsavedAptMark=\"$(apt-mark showmanual)\"; \\\n\tapt-get update; \\\n\tapt-get install -y --no-install-recommends ca-certificates wget; \\\n\trm -rf /var/lib/apt/lists/*; \\\n\tdpkgArch=\"$(dpkg --print-architecture | awk -F- '{ print $NF }')\"; \\\n\twget -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch\"; \\\n\twget -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc\"; \\\n\texport GNUPGHOME=\"$(mktemp -d)\"; \\\n\tgpg --batch --keyserver hkps://keys.openpgp.org --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4; \\\n\tgpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu; \\\n\tgpgconf --kill all; \\\n\trm -rf \"$GNUPGHOME\" /usr/local/bin/gosu.asc; \\\n\tapt-mark auto '.*' > /dev/null; \\\n\t[ -z \"$savedAptMark\" ] || apt-mark manual $savedAptMark > /dev/null; \\\n\tapt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false; \\\n\tchmod +x /usr/local/bin/gosu; \\\n\tgosu --version; \\\n\tgosu nobody true\n\n## é…ç½®locale\n# make the \"en_US.UTF-8\" locale so postgres will be utf-8 enabled by default\nRUN set -eux; \\\n\tif [ -f /etc/dpkg/dpkg.cfg.d/docker ]; then \\\n# if this file exists, we're likely in \"debian:xxx-slim\", and locales are thus being excluded so we need to remove that exclusion (since we need locales)\n\t\tgrep -q '/usr/share/locale' /etc/dpkg/dpkg.cfg.d/docker; \\\n\t\tsed -ri '/\\/usr\\/share\\/locale/d' /etc/dpkg/dpkg.cfg.d/docker; \\\n\t\t! grep -q '/usr/share/locale' /etc/dpkg/dpkg.cfg.d/docker; \\\n\tfi; \\\n\tapt-get update; apt-get install -y --no-install-recommends locales; rm -rf /var/lib/apt/lists/*; \\\n\tlocaledef -i en_US -c -f UTF-8 -A /usr/share/locale/locale.alias en_US.UTF-8\nENV LANG en_US.utf8\n\n## å®‰è£…å¿…è¦ä¾èµ–åº“\nRUN set -eux; \\\n\tapt-get update; \\\n\tapt-get install -y --no-install-recommends \\\n# install \"nss_wrapper\" in case we need to fake \"/etc/passwd\" and \"/etc/group\" (especially for OpenShift)\n# https://github.com/docker-library/postgres/issues/359\n# https://cwrap.org/nss_wrapper.html\n\t\tlibnss-wrapper \\\n# install \"xz-utils\" for .sql.xz docker-entrypoint-initdb.d files\n\t\txz-utils \\\n\t; \\\n\trm -rf /var/lib/apt/lists/*\n\n## é…ç½®ä¿¡ä»»çš„gpg key\nRUN set -ex; \\\n# pub   4096R/ACCC4CF8 2011-10-13 [expires: 2019-07-02]\n#       Key fingerprint = B97B 0AFC AA1A 47F0 44F2  44A0 7FCC 7D46 ACCC 4CF8\n# uid                  PostgreSQL Debian Repository\n\tkey='B97B0AFCAA1A47F044F244A07FCC7D46ACCC4CF8'; \\\n\texport GNUPGHOME=\"$(mktemp -d)\"; \\\n\tgpg --batch --keyserver ha.pool.sks-keyservers.net --recv-keys \"$key\"; \\\n\tgpg --batch --export \"$key\" > /etc/apt/trusted.gpg.d/postgres.gpg; \\\n\tcommand -v gpgconf > /dev/null && gpgconf --kill all; \\\n\trm -rf \"$GNUPGHOME\"; \\\n\tapt-key list\n\nENV PG_MAJOR 11\nENV GOSU_VERSION 1.11\n\n## æ·»åŠ postgresqlè½¯ä»¶æºä»“åº“\nRUN set -ex; \\\n\t\\\n# see note below about \"*.pyc\" files\n\texport PYTHONDONTWRITEBYTECODE=1; \\\n\t\\\n\tdpkgArch=\"$(dpkg --print-architecture)\"; \\\n\tcase \"$dpkgArch\" in \\\n\t\tamd64 | i386 | ppc64el) \\\n# arches officialy built by upstream\n\t\t\techo \"deb http://apt.postgresql.org/pub/repos/apt/ stretch-pgdg main $PG_MAJOR\" > /etc/apt/sources.list.d/pgdg.list; \\\n\t\t\techo \"apt-get update;\"; \\\n\t\t\t;; \\\n\t\t*) \\\n# we're on an architecture upstream doesn't officially build for\n# let's build binaries from their published source packages\n        echo \"deb-src http://apt.postgresql.org/pub/repos/apt/ stretch-pgdg main $PG_MAJOR\" > /etc/apt/sources.list.d/pgdg.list; \\\n        ;; \\\n\tesac;\n\n# æ·»åŠ å¿…è¦çš„å·¥å…·åŠä¾èµ–\nRUN apt-get update && apt-get install -y --no-install-recommends unzip wget \\\n    libreadline-dev \\\n    libmongoc-1.0-0  \\\n    libmysql++-dev \\\n    libsqlite3-dev libspatialite7 \\\n    libsybdb5 \\\n    libhiredis-dev \\\n    freetds-dev freetds-common libcurl4-nss-dev unixodbc-dev  \\\n    # libaio-dev - oracle_fdw\n    libaio-dev \\\n    && rm -rf /var/lib/apt/lists/*;\n\n```\n\n\n\n## pgspideré•œåƒæ„å»º\n\nå¯¹x86åŠarmæ¶æ„ï¼Œæˆ‘ä»¬åˆ†åˆ«ç¼–å†™äº†å¯¹åº”çš„è„šæœ¬ï¼Œå…¶ä¸­x86ä½¿ç”¨ Dockerfile-source.dockerfile è„šæœ¬æ„å»ºï¼Œarmä½¿ç”¨Dockerfile-source-arm.dockerfileè„šæœ¬æ„å»ºï¼›\n\n### æ„å»ºå‘½ä»¤\n\n```shell\nTAG=$(date +%Y%m%d)\ndocker build -t pgspider-postgis:$TAG -f Dockerfile-source.dockerfile ./\n## arm \ndocker buildx build \\\n      --progress plain \\\n      --build-arg --platform=linux/arm64 \\\n      -t pgspider-postgis:arm-$TAG \\\n      -f Dockerfile-source-arm.dockerfile ./ --load\n```\n\n### è„šæœ¬è¯¦è§£\n\n* pgspider é•œåƒæ„å»ºçš„æ­¥éª¤è¾ƒå¤šï¼Œæˆ‘ä»¬é‡‡å–åˆ†æ­¥éª¤æ„å»ºçš„æ–¹å¼ä½¿ç”¨ä¸­é—´æ„å»ºè¿‡ç¨‹æ¥å‡å°æœ€ç»ˆé•œåƒçš„å±‚æ•°åŠå¤§å°ï¼›\n\n* å¦å¤–ä¸¤ä¸ªå¹³å°çš„æ„å»ºè„šæœ¬å¤§ä½“ä¸€è‡´ï¼Œä»…æœ‰å°‘æ•°è¿‡ç¨‹æœ‰å·®å¼‚ï¼Œæˆ‘ä»¬å…ˆä½¿ç”¨x86ç‰ˆæœ¬çš„å¯¹æ•´ä½“è¿‡ç¨‹è¿›è¡Œè¯´æ˜ï¼Œåé¢æˆ‘ä»¬ä¼šè¯´æ˜ä¸¤ä¸ªå¹³å°ä¹‹é—´çš„å·®å¼‚ï¼›\n\n#### x86 æ„å»ºè„šæœ¬\n\n> æç¤ºï¼šè„šæœ¬ä¸­æœ‰å¤šä¸ªFROMæ®µï¼Œæ­¤ä¸ºDockerå¤šé˜¶æ®µæ„å»ºå¯ä»¥é€šè¿‡[æ­¤æ–‡ç« ](https://zhuanlan.zhihu.com/p/33795821)è¿›è¡Œäº†è§£ï¼›\n\nä¸»è¦è¿‡ç¨‹å¦‚ä¸‹ï¼š\n\n**ç¬¬ä¸€é˜¶æ®µï¼š**\n\n1. ä»builderé•œåƒå¼€å§‹ï¼Œç”±äºbuilderé•œåƒä¸­å·²ç»åŒ…å«pgæºç è¿˜æœ‰å·²ç»ç¼–å¥½çš„pgåŠpgspiderç­‰ï¼Œæ‰€ä»¥æˆ‘ä»¬æ— éœ€å†ç¼–è¯‘è¿™äº›ï¼›\n\n2. ç¼–è¯‘ mysql_fdw åŠ sqlite_fdwï¼ˆæ³¨æ„ï¼Œå…¶ä¸­mysql_fdwå…¶å®å¯ä»¥ä¸ç”¨äº†ï¼‰\n\n3. å®‰è£… oracle_fdw æ‰€éœ€è¦çš„ä¾èµ–ï¼ˆoracle instant clientï¼‰ï¼›\n\n4. ç¼–è¯‘postgisï¼Œç¼–è¯‘postgiséœ€è¦å…ˆç¼–è¯‘å…¶ä¾èµ–ï¼ˆmpfrï¼Œboost_1_67_0ï¼ŒCGALç­‰ï¼‰ï¼Œè¿™é‡Œæˆ‘ä»¬å°†postgisçš„æ‰€æœ‰çš„ä¾èµ–åŠå…¶è‡ªèº«çš„å®‰è£…è·¯å¾„éƒ½è®¾ç½®ä¸º `/usr/local/pgspider/plugin/postgis`\n\n   ```shell\n   ENV PGIS_INSTALL_PATH /usr/local/pgspider/plugin/postgis\n   ```\n\n5. ç¼–è¯‘å¹¶å®‰è£… debeziumåŠwal2jsonï¼›\n\n6. ä½¿ç”¨stripå¯¹postgisç›®å½•ä¸­çš„æ‰€æœ‰soåº“è¿›è¡Œå¤§å°ä¼˜åŒ–\n\n7. å°†é¢„å…ˆç¼–è¯‘å¥½çš„ å‡ ä¸ªfdwçš„soåŠé…ç½®åŠsqlæ–‡ä»¶æ‹·è´åˆ°æŒ‡å®šç›®å½•ä»¥å®‰è£…æˆ–æ›´æ–°è¿™äº›fdwï¼›\n\n**ç¬¬äºŒé˜¶æ®µï¼š**\n\n1. ä» pgspider-base é•œåƒå¼€å§‹æ„å»ºï¼›\n2. å®‰è£…å¿…è¦çš„ä¾èµ–ï¼›\n3. ä»ç¬¬ä¸€é˜¶æ®µæ‹·è´å‡ºoracle_instantclientçš„ä¾èµ–ï¼›ï¼ˆarmç‰ˆæœ¬æ— æ­¤æ­¥éª¤ï¼Œå› ä¸ºoracle_instantclientä¸æ”¯æŒarmæ¶æ„ï¼‰\n4. ä»ç¬¬ä¸€é˜¶æ®µæ‹·è´å‡º /usr/local/pgspider ç›®å½•ï¼Œå…¶ä¸­åŒ…å«äº†æˆ‘ä»¬ä¹‹å‰ç¼–è¯‘çš„çš„æˆæœï¼›\n5. æ·»åŠ å„ç§åˆå§‹åŒ–è„šæœ¬ï¼Œå¹¶ä¸ºpgè¿è¡Œåšå¿…è¦çš„å‡†å¤‡ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹dockerfileï¼›\n6. æœ€åä½¿ç”¨ EXPOSE æš´éœ² 5432ç«¯å£ï¼Œä½¿ç”¨ CMD [\"postgres\"] é»˜è®¤å¯åŠ¨pgï¼›\n\n```dockerfile\n# ---\n# æ„å»ºèåˆä¸­å¿ƒpgé•œåƒ(ä»æºç æ„å»ºï¼‰ï¼š\n# 1. æ„å»ºpgspiderï¼ˆpgspider-baseé•œåƒä¸­åŒ…å«ï¼‰\n# 2. æ·»åŠ è‹¥å¹²fdwï¼šmysql_fdw,oracle_fdw,sqlite_fdw,postgres_fdwï¼ˆpostgres_fdwåŒ…å«äºpgspider-baseé•œåƒä¸­ï¼‰\n# 3. æ·»åŠ  postgis\n#\n# å‚è€ƒï¼š\n# - https://github.com/rongfengliang/pgspider-docker/blob/master/Dockerfile-all-in-one\n# ---\n## æ„å»º sqlite_fdw  mysql_fdw  oracle_fdw\n#FROM pgspider-builder as build\nFROM hanlyjiang/pgspider-builder as build\n\nWORKDIR /app\n\n## PG ä¸»ç‰ˆæœ¬\nENV PG_MAJOR 11\nENV PG_VERSION 6\n\n## å®‰è£…æ„å»ºæ‰€éœ€çš„ä¾èµ–\nRUN apt-get update \\\n    && apt-get install -y automake autoconf libtool pkg-config libssl-dev \\\n    libsqlite3-dev libsybdb5 freetds-dev freetds-common \\\n    libhiredis-dev libcurl4-nss-dev unixodbc-dev libaio-dev \\\n    # for oracle\n    unzip \\\n#    libmysql++-dev\n    libmysql++-dev \\\n    # libspatialite sqlite ç©ºé—´æ•°æ®æ”¯æŒ - https://packages.debian.org/stretch/libspatialite7\n    libspatialite7\n#    postgresql-${PG_MAJOR}-python-multicorn python-pip\n\n## å®‰è£… sqlite_fdw\nRUN git clone https://github.com/pgspider/sqlite_fdw.git /app/postgresql-${PG_MAJOR}.${PG_VERSION}/contrib/sqlite_fdw\nRUN cd /app/postgresql-${PG_MAJOR}.${PG_VERSION}/contrib/sqlite_fdw && make && make install\n\n## å®‰è£… mysql_fdw\nRUN git clone https://github.com/pgspider/mysql_fdw.git /app/postgresql-${PG_MAJOR}.${PG_VERSION}/contrib/mysql_fdw\nRUN cd /app/postgresql-${PG_MAJOR}.${PG_VERSION}/contrib/mysql_fdw && make && make install\n\n## å®‰è£… Install es_fdw\n#RUN pip install pg_es_fdw\n\n## å®‰è£… oracle_fdw\n### å®‰è£…oracle instantclient\n# https://github.com/rongfengliang/pgspider-docker/blob/master/Dockerfile-all-in-one-oracle\nADD oracle/instantclient-basic-linux.x64-12.2.0.1.0.zip /tmp/instantclient-basic-linux.x64-12.2.0.1.0.zip\nADD oracle/instantclient-sdk-linux.x64-12.2.0.1.0.zip /tmp/instantclient-sdk-linux.x64-12.2.0.1.0.zip\nADD oracle/instantclient-sqlplus-linux.x64-12.2.0.1.0.zip /tmp/instantclient-sqlplus-linux.x64-12.2.0.1.0.zip\nRUN unzip /tmp/instantclient-basic-linux.x64-12.2.0.1.0.zip -d /usr/local/\nRUN unzip /tmp/instantclient-sdk-linux.x64-12.2.0.1.0.zip -d /usr/local/\nRUN unzip /tmp/instantclient-sqlplus-linux.x64-12.2.0.1.0.zip -d /usr/local/\nRUN ln -s /usr/local/instantclient_12_2 /usr/local/instantclient\nRUN ln -s /usr/local/instantclient/libclntsh.so.12.1 /usr/local/instantclient/libclntsh.so\nRUN ln -s /usr/local/instantclient/sqlplus /usr/bin/sqlplus\nENV ORACLE_HOME=/usr/local/instantclient\nENV LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/instantclient\n\n#RUN wget -O /app/ORACLE_FDW_2_2_0.tar.gz https://github.com/laurenz/oracle_fdw/archive/ORACLE_FDW_2_2_0.tar.gz \\\nADD oracle/oracle_fdw-ORACLE_FDW_2_2_0.tar.gz /app/\nRUN mv /app/oracle_fdw-ORACLE_FDW_2_2_0 /app/postgresql-${PG_MAJOR}.${PG_VERSION}/contrib/oracle_fdw \\\n    && cd /app/postgresql-${PG_MAJOR}.${PG_VERSION}/contrib/oracle_fdw \\\n    && make && make install\n\n##  POSTGIS æ„å»º\n### å®‰è£…ä¾èµ–\nRUN apt-get install  -y --no-install-recommends \\\n    libtool libxml2 libxml2-dev \\\n    libxslt1.1 libxslt1-dev \\\n    libjson-c-dev libgmp-dev \\\n    cmake libmpfr-dev\n\n### åˆ›å»ºä¸´æ—¶å·¥ä½œç›®å½•\nRUN mkdir /app/postgis/\nENV PGIS_INSTALL_PATH /usr/local/pgspider/plugin/postgis\nENV LD_LIBRARY_PATH $LD_LIBRARY_PATH:$PGIS_INSTALL_PATH/lib\nENV PATH $PGIS_INSTALL_PATH/bin:/usr/local/pgspider/bin:$PATH\n\n### æ„å»º mpfr\nADD postgis/mpfr-4.0.2.tar.gz /app/postgis/\nRUN cd /app/postgis/mpfr-4.0.2 \\\n    && ./configure --prefix=$PGIS_INSTALL_PATH \\\n    && make && make install\n\n### æ„å»º boost\nADD postgis/boost_1_67_0.tar.gz /app/postgis/\nRUN cd /app/postgis/boost_1_67_0  \\\n    && ./bootstrap.sh -prefix=$PGIS_INSTALL_PATH && ./b2 && ./b2 install\n\n### æ„å»º CGAL\nADD postgis/CGAL-4.11.2.tar.xz /app/postgis/\nRUN cd /app/postgis/CGAL-4.11.2  \\\n    && cmake -DCMAKE_INSTALL_PREFIX=$PGIS_INSTALL_PATH . && make -j$(nproc) && make install\n\n### æ„å»º SFCGAL\nADD postgis/SFCGAL-1.3.5.tar.gz /app/postgis/\nRUN cd /app/postgis/SFCGAL-1.3.5 \\\n    && cmake -DCMAKE_INSTALL_PREFIX=$PGIS_INSTALL_PATH . && make -j$(nproc) && make install\n\n### æ„å»º projï¼Œéœ€è¦å…ˆå®‰è£…sqlite3\nRUN apt-get install  -y --no-install-recommends sqlite3 libsqlite3-dev\nADD postgis/proj-6.2.0.tar.gz /app/postgis/\nRUN cd /app/postgis/proj-6.2.0  \\\n    && ./configure --prefix=$PGIS_INSTALL_PATH && make -j$(nproc) && make install\n\n### æ„å»º gdal\nADD postgis/gdal-3.0.2.tar.gz /app/postgis/\nRUN cd /app/postgis/gdal-3.0.2  \\\n    && ./configure --prefix=$PGIS_INSTALL_PATH \\\n    # proj æ— æ³•ç›´æ¥æ‰¾åˆ°ï¼Œå¿…é¡»æ‰‹åŠ¨æŒ‡å®šï¼ˆå¯èƒ½æ˜¯éœ€è¦é…ç½®includeï¼‰ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥æŒ‡å®šï¼Œpostgisé‡Œé¢åŒ\n        --with-proj=$PGIS_INSTALL_PATH \\\n    && make -j$(nproc) && make install\n\n### æ„å»º geos\nADD postgis/geos-3.8.0.tar.bz2 /app/postgis/\nRUN cd /app/postgis/geos-3.8.0  \\\n    && ./configure --prefix=$PGIS_INSTALL_PATH  \\\n    && make -j$(nproc) && make install\n\n### æ„å»º postgis\nADD postgis/postgis-2.5.3.tar.gz /app/postgis/\nRUN cd /app/postgis/postgis-2.5.3  \\\n    && ./configure --prefix=$PGIS_INSTALL_PATH \\\n    # å‡ ä¸ªconfigå‘½ä»¤ç›´æ¥é…ç½®PATHåå¯ä»¥æ‰¾åˆ°ï¼Œæ‰€ä»¥ä¸åœ¨ä½¿ç”¨å‚æ•°é…ç½®\n#        --with-pgconfig=/usr/local/pgspider/bin/pg_config \\\n#        --with-geosconfig=$$PGIS_INSTALL_PATH/bin/geos-config \\\n#        --with-gdalconfig=$$PGIS_INSTALL_PATH/bin/gdal-config \\\n        --with-projdir=$PGIS_INSTALL_PATH \\\n    && make -j$(nproc) && make install\n\n\nRUN set -ex \\\n#    && sed -i \"s/deb.debian.org/mirrors.tuna.tsinghua.edu.cn/g\" /etc/apt/sources.list \\\n#    && sed -i \"s/security.debian.org/mirrors.tuna.tsinghua.edu.cn/g\"  /etc/apt/sources.list \\\n    # https://packages.debian.org/stretch-backports/libboost-atomic1.67-dev\n#    && echo \"deb http://deb.debian.org/debian stretch-backports main\" >>/etc/apt/sources.list \\\n    && apt-get update \\\n    && apt-get install -y --no-install-recommends \\\n      libprotobuf-c-dev \\\n#      postgresql-12-wal2json \\\n      protobuf-c-compiler \\\n      && rm -rf /var/lib/apt/lists/*\n\n## æ·»åŠ  debezium https://github.com/eulerto/wal2json\nADD debezium/wal2json-wal2json_1_0.tar.gz /app/debezium/\nRUN cd /app/debezium/wal2json-wal2json_1_0 \\\n    && make -j$(nproc) && make install\n\n## æ·»åŠ  debezium - decoderbufs ç ”ç©¶é™¢ä¿®æ”¹ç‰ˆæœ¬\nADD debezium/postgres-decoderbufs.tar.gz /app/debezium/\nRUN cd /app/debezium/postgres-decoderbufs \\\n    && cd proto \\\n    && protoc-c --c_out=../src/proto pg_logicaldec.proto \\\n    && cd .. \\\n    ## make -Bï¼š ç ”ç©¶é™¢æä¾›çš„åŒ…ä¸­å¯èƒ½å¸¦æœ‰ä¹‹å‰makeçš„æˆæœï¼Œæ­¤æ—¶ä¸ä¼šé‡æ–°æ„å»ºï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ -B æ¥å¼ºåˆ¶é‡æ–°æ„å»ºï¼Œä¹Ÿå¯ä»¥å…ˆæ‰§è¡Œ make clean\n    && make -B -j$(nproc) && make install\n\n## æ·»åŠ  debezium - decoderbufs å®˜æ–¹ç‰ˆæœ¬\n#ADD debezium/postgres-decoderbufs-v.1.3.1.Final.tar.gz /app/debezium/\n#RUN cd /app/debezium/postgres-decoderbufs-v.1.3.1.Final \\\n#    && make -j$(nproc) && make install\n\n### å¯¹æ„å»ºpostgisè¿‡ç¨‹ä¸­ç”Ÿæˆçš„æ–‡ä»¶è¿›è¡Œä¼˜åŒ–ï¼Œä»¥å‡å°å¤§å°\n#### 1. ç§»é™¤é™æ€é“¾æ¥åº“æ–‡ä»¶ï¼›2. ä½¿ç”¨stripå‘½ä»¤å¯¹åŠ¨æ€é“¾æ¥åº“soæ–‡ä»¶è¿›è¡Œç¬¦å·è¡¨ä¼˜åŒ–\nRUN cd $PGIS_INSTALL_PATH/lib \\\n    && rm *.a \\\n    && find . -type f -name \"lib*.so.*\" -exec strip {} +\n#    && cd /usr/local/pgspider/plugin/proj/lib \\\n#    && rm *.a && find . -type f -name \"lib*.so.*\" -exec strip {} +\n\n## æ‹·è´mysql\nCOPY binary/mysql_fdw/*.sql         /usr/local/pgspider/share/postgresql/extension/\nCOPY binary/mysql_fdw/*.control    /usr/local/pgspider/share/postgresql/extension/\nCOPY binary/mysql_fdw/*.so         /usr/local/pgspider/lib/postgresql/\n## æ‹·è´zombodb\nCOPY binary/zdblibs/*.sql          /usr/local/pgspider/share/postgresql/extension/\nCOPY binary/zdblibs/*.control      /usr/local/pgspider/share/postgresql/extension/\nCOPY binary/zdblibs/*.so           /usr/local/pgspider/lib/postgresql/\n\n## æ‹·è´oracle fdw\nCOPY binary/oracle/*.so           /usr/local/pgspider/lib/postgresql/\n\n# ------ å¼€å§‹æ„å»ºå®é™…å‘å¸ƒçš„é•œåƒ ------\nFROM hanlyjiang/pgspider-base:latest\nLABEL maintainer=\"jianghanghang@geostar.com.cn\"\n\n## è®¾ç½®è‹¥å¹²ENVï¼ŒæŒ‡ç¤ºç‰ˆæœ¬ä¿¡æ¯\n# buster ä¸Šä¸º12 ï¼Œstretch ä¸Šä¸º 12\n# ENV CDAL_VERSION 12\nENV BOOST_VERSION=1.67.0 \\\n    PG_MAJOR=11 \\\n    PG_VERSION=6 \\\n    POSTGIS_VESION=2.5.3\n\n## å®‰è£…å¿…è¦çš„ä¾èµ–ï¼ˆTODO: éƒ¨åˆ†ä¾èµ–å¯èƒ½ä¸éœ€è¦ï¼‰\nRUN set -ex \\\n#    && sed -i \"s/deb.debian.org/mirrors.tuna.tsinghua.edu.cn/g\" /etc/apt/sources.list \\\n#    && sed -i \"s/security.debian.org/mirrors.tuna.tsinghua.edu.cn/g\"  /etc/apt/sources.list \\\n    # https://packages.debian.org/stretch-backports/libboost-atomic1.67-dev\n#    && echo \"deb http://deb.debian.org/debian stretch-backports main\" >>/etc/apt/sources.list \\\n    && apt-get update \\\n    && apt-get install -y --no-install-recommends \\\n      curl \\\n      libcurl3-gnutls \\\n      libexpat1 \\\n      libgmp10 \\\n      libgmpxx4ldbl \\\n      libjson-c3 \\\n      # buster ä¸Šä¸º6ï¼Œstretchä¸Šä¸º4\n#      libmpfr6 \\\n#      libmpfr4 \\\n      libprotobuf-c1 \\\n      libtiff5 \\\n      libxml2 \\\n      # for debezium\n      postgresql-12-wal2json \\\n      libprotobuf-c-dev \\\n      && rm -rf /var/lib/apt/lists/*\n\n## å®‰è£…oracle_fdwéœ€è¦çš„ Oracle instantclient\n### from: https://github.com/rongfengliang/pgspider-docker/blob/master/Dockerfile-all-in-one-oracle\nCOPY --from=build  /usr/local/instantclient_12_2 /usr/local/instantclient_12_2\nRUN set -ex \\\n    && ln -s /usr/local/instantclient_12_2 /usr/local/instantclient \\\n    && ln -s /usr/local/instantclient/sqlplus /usr/bin/sqlplus\n\n## è®¾ç½®è‹¥å¹²è¿è¡Œéœ€è¦çš„ç¯å¢ƒå˜é‡\nENV ORACLE_HOME=/usr/local/instantclient \\\n    PGIS_INSTALL_PATH=/usr/local/pgspider/plugin/postgis\nENV LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$PGIS_INSTALL_PATH/lib:/usr/local/instantclient \\\n    PATH=$PGIS_INSTALL_PATH/bin:/usr/local/pgspider/bin:$PATH\n## æ‹·è´æ„å»ºå¥½çš„æˆæœ\nCOPY --from=build  /usr/local/pgspider /usr/local/pgspider\n## å…¥å£è„šæœ¬æ·»åŠ \nCOPY docker-entrypoint.sh /usr/local/bin/\nRUN mkdir /docker-entrypoint-initdb.d \\\n    && chmod +x /usr/local/bin/docker-entrypoint.sh \\\n    && ln -s usr/local/bin/docker-entrypoint.sh /\n\n## postgis è„šæœ¬æ·»åŠ \n### fromï¼š https://github.com/postgis/docker-postgis/blob/master/Dockerfile.master.template\nCOPY ./postgis/initdb-postgis.sh /docker-entrypoint-initdb.d/10_postgis.sh\nCOPY ./postgis/update-postgis.sh /usr/local/bin\n## æ·»åŠ æ‰©å±•åˆå§‹åŒ–è„šæœ¬\nCOPY ./initdb-fdw.sh /docker-entrypoint-initdb.d/00_fdws.sh\nCOPY ./debezium/init-debezium.sh /docker-entrypoint-initdb.d/01_debezium.sh\n\n## make the sample config easier to munge (and \"correct by default\")\nRUN sed -ri \"s!^#?(listen_addresses)\\s*=\\s*\\S+.*!\\1 = '*'!\" /usr/local/pgspider/share/postgresql/postgresql.conf.sample; \\\n   grep -F \"listen_addresses = '*'\" /usr/local/pgspider/share/postgresql/postgresql.conf.sample\n\nRUN mkdir -p /var/run/postgresql && chown -R postgres:postgres /var/run/postgresql  && chmod 2777 /var/run/postgresql\n\nENV PGDATA /var/lib/postgresql/data\n## è®¾ç½®ç›®å½•æƒé™ - this 777 will be replaced by 700 at runtime (allows semi-arbitrary \"--user\" values)\nRUN mkdir -p \"$PGDATA\" && chown -R postgres:postgres \"$PGDATA\" && chmod 777 \"$PGDATA\"\nVOLUME /var/lib/postgresql/data\n\nENTRYPOINT [\"docker-entrypoint.sh\"]\n\n# COPY FROM https://github.com/docker-library/postgres/blob/master/11/Dockerfile\n# We set the default STOPSIGNAL to SIGINT, which corresponds to what PostgreSQL\n# calls \"Fast Shutdown mode\" wherein new connections are disallowed and any\n# in-progress transactions are aborted, allowing PostgreSQL to stop cleanly and\n# flush tables to disk, which is the best compromise available to avoid data\n# corruption.\n#\n# Users who know their applications do not keep open long-lived idle connections\n# may way to use a value of SIGTERM instead, which corresponds to \"Smart\n# Shutdown mode\" in which any existing sessions are allowed to finish and the\n# server stops when all sessions are terminated.\n#\n# See https://www.postgresql.org/docs/12/server-shutdown.html for more details\n# about available PostgreSQL server shutdown signals.\n#\n# See also https://www.postgresql.org/docs/12/server-start.html for further\n# justification of this as the default value, namely that the example (and\n# shipped) systemd service files use the \"Fast Shutdown mode\" for service\n# termination.\n#\nSTOPSIGNAL SIGINT\n\n# An additional setting that is recommended for all users regardless of this\n# value is the runtime \"--stop-timeout\" (or your orchestrator/runtime's\n# equivalent) for controlling how long to wait between sending the defined\n# STOPSIGNAL and sending SIGKILL (which is likely to cause data corruption).\n#\n# The default in most runtimes (such as Docker) is 10 seconds, and the\n# documentation at https://www.postgresql.org/docs/12/server-start.html notes\n# that even 90 seconds may not be long enough in many instances.\nEXPOSE 5432\nCMD [\"postgres\"]\n```\n\n### ARMç‰ˆæœ¬æ„å»ºè„šæœ¬\n\nä¸x86ç‰ˆæœ¬ä¸åŒä¹‹å¤„åœ¨äºï¼š\n\n1. fromçš„é•œåƒä¸åŒï¼Œä¸€ä¸ªæ˜¯x86ç‰ˆæœ¬ï¼Œä¸€ä¸ªæ˜¯armç‰ˆæœ¬ï¼›\n2. armç‰ˆæœ¬ä¸åŒ…å«oracle_fdw æ„å»ºçš„ç›¸å…³æ­¥éª¤ï¼›\n\n```dockerfile\n# ---\n# æ„å»ºèåˆä¸­å¿ƒpgé•œåƒ-armbç‰ˆæœ¬(ä»æºç æ„å»ºï¼‰ï¼š\n# 1. æ„å»ºpgspiderï¼ˆpgspider-baseé•œåƒä¸­åŒ…å«ï¼‰\n# 2. æ·»åŠ è‹¥å¹²fdwï¼šmysql_fdw,sqlite_fdw,postgres_fdwï¼ˆpostgres_fdwåŒ…å«äºpgspider-baseé•œåƒä¸­ï¼‰\n# 3. æ·»åŠ  postgis\n#\n# å‚è€ƒï¼š\n# - https://github.com/rongfengliang/pgspider-docker/blob/master/Dockerfile-all-in-one\n# ---\n## æ„å»º sqlite_fdw  mysql_fdw\nFROM zh-registry.geostar.com.cn/geopanel/pgspider-builder-arm:latest as build\n\nWORKDIR /app\n\n## PG ä¸»ç‰ˆæœ¬\nENV PG_MAJOR 11\nENV PG_VERSION 6\n\n## å®‰è£…æ„å»ºæ‰€éœ€çš„ä¾èµ–\nRUN apt-get update \\\n    && apt-get install -y automake autoconf libtool pkg-config libssl-dev \\\n    libsqlite3-dev libsybdb5 freetds-dev freetds-common \\\n    libhiredis-dev libcurl4-nss-dev unixodbc-dev libaio-dev \\\n    # for oracle\n    unzip \\\n#    libmysql++-dev\n    libmysql++-dev \\\n    # libspatialite sqlite ç©ºé—´æ•°æ®æ”¯æŒ - https://packages.debian.org/stretch/libspatialite7\n    libspatialite7\n#    postgresql-${PG_MAJOR}-python-multicorn python-pip\n\n## å®‰è£… sqlite_fdw\nRUN git clone https://github.com/pgspider/sqlite_fdw.git /app/postgresql-${PG_MAJOR}.${PG_VERSION}/contrib/sqlite_fdw\nRUN cd /app/postgresql-${PG_MAJOR}.${PG_VERSION}/contrib/sqlite_fdw && make && make install\n\n## å®‰è£… mysql_fdw\nRUN git clone https://github.com/pgspider/mysql_fdw.git /app/postgresql-${PG_MAJOR}.${PG_VERSION}/contrib/mysql_fdw\nRUN cd /app/postgresql-${PG_MAJOR}.${PG_VERSION}/contrib/mysql_fdw && make && make install\n\n## å®‰è£… Install es_fdw\n#RUN pip install pg_es_fdw\n\n## å®‰è£… oracle_fdw(arm ä¸æ”¯æŒ)\n### å®‰è£…oracle instantclient\n# https://github.com/rongfengliang/pgspider-docker/blob/master/Dockerfile-all-in-one-oracle\n#ADD oracle/instantclient-basic-linux.x64-12.2.0.1.0.zip /tmp/instantclient-basic-linux.x64-12.2.0.1.0.zip\n#ADD oracle/instantclient-sdk-linux.x64-12.2.0.1.0.zip /tmp/instantclient-sdk-linux.x64-12.2.0.1.0.zip\n#ADD oracle/instantclient-sqlplus-linux.x64-12.2.0.1.0.zip /tmp/instantclient-sqlplus-linux.x64-12.2.0.1.0.zip\n#RUN unzip /tmp/instantclient-basic-linux.x64-12.2.0.1.0.zip -d /usr/local/\n#RUN unzip /tmp/instantclient-sdk-linux.x64-12.2.0.1.0.zip -d /usr/local/\n#RUN unzip /tmp/instantclient-sqlplus-linux.x64-12.2.0.1.0.zip -d /usr/local/\n#RUN ln -s /usr/local/instantclient_12_2 /usr/local/instantclient\n#RUN ln -s /usr/local/instantclient/libclntsh.so.12.1 /usr/local/instantclient/libclntsh.so\n#RUN ln -s /usr/local/instantclient/sqlplus /usr/bin/sqlplus\n#ENV ORACLE_HOME=/usr/local/instantclient\n#ENV LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/instantclient\n\n#RUN wget -O /app/ORACLE_FDW_2_2_0.tar.gz https://github.com/laurenz/oracle_fdw/archive/ORACLE_FDW_2_2_0.tar.gz \\\n#ADD oracle/oracle_fdw-ORACLE_FDW_2_2_0.tar.gz /app/\n#RUN mv /app/oracle_fdw-ORACLE_FDW_2_2_0 /app/postgresql-${PG_MAJOR}.${PG_VERSION}/contrib/oracle_fdw \\\n#    && cd /app/postgresql-${PG_MAJOR}.${PG_VERSION}/contrib/oracle_fdw \\\n#    && make && make install\n\n##  POSTGIS æ„å»º\n### å®‰è£…ä¾èµ–\nRUN apt-get install  -y --no-install-recommends \\\n    libtool libxml2 libxml2-dev \\\n    libxslt1.1 libxslt1-dev \\\n    libjson-c-dev libgmp-dev \\\n    cmake libmpfr-dev\n\n### åˆ›å»ºä¸´æ—¶å·¥ä½œç›®å½•\nRUN mkdir /app/postgis/\nENV PGIS_INSTALL_PATH /usr/local/pgspider/plugin/postgis\nENV LD_LIBRARY_PATH $LD_LIBRARY_PATH:$PGIS_INSTALL_PATH/lib\nENV PATH $PGIS_INSTALL_PATH/bin:/usr/local/pgspider/bin:$PATH\n\n### æ„å»º mpfr\nADD postgis/mpfr-4.0.2.tar.gz /app/postgis/\nRUN cd /app/postgis/mpfr-4.0.2 \\\n    && ./configure --prefix=$PGIS_INSTALL_PATH \\\n    && make && make install\n\n### æ„å»º boost\nADD postgis/boost_1_67_0.tar.gz /app/postgis/\nRUN cd /app/postgis/boost_1_67_0  \\\n    && ./bootstrap.sh -prefix=$PGIS_INSTALL_PATH && ./b2 && ./b2 install\n\n### æ„å»º CGAL\nADD postgis/CGAL-4.11.2.tar.xz /app/postgis/\nRUN cd /app/postgis/CGAL-4.11.2  \\\n    && cmake -DCMAKE_INSTALL_PREFIX=$PGIS_INSTALL_PATH . && make -j$(nproc) && make install\n\n### æ„å»º SFCGAL\nADD postgis/SFCGAL-1.3.5.tar.gz /app/postgis/\nRUN cd /app/postgis/SFCGAL-1.3.5 \\\n    && cmake -DCMAKE_INSTALL_PREFIX=$PGIS_INSTALL_PATH . && make -j$(nproc) && make install\n\n### æ„å»º projï¼Œéœ€è¦å…ˆå®‰è£…sqlite3\nRUN apt-get install  -y --no-install-recommends sqlite3 libsqlite3-dev\nADD postgis/proj-6.2.0.tar.gz /app/postgis/\nRUN cd /app/postgis/proj-6.2.0  \\\n    && ./configure --prefix=$PGIS_INSTALL_PATH && make -j$(nproc) && make install\n\n### æ„å»º gdal\nADD postgis/gdal-3.0.2.tar.gz /app/postgis/\nRUN cd /app/postgis/gdal-3.0.2  \\\n    && ./configure --prefix=$PGIS_INSTALL_PATH \\\n    # proj æ— æ³•ç›´æ¥æ‰¾åˆ°ï¼Œå¿…é¡»æ‰‹åŠ¨æŒ‡å®šï¼ˆå¯èƒ½æ˜¯éœ€è¦é…ç½®includeï¼‰ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥æŒ‡å®šï¼Œpostgisé‡Œé¢åŒ\n        --with-proj=$PGIS_INSTALL_PATH \\\n    && make -j$(nproc) && make install\n\n### æ„å»º geos\nADD postgis/geos-3.8.0.tar.bz2 /app/postgis/\nRUN cd /app/postgis/geos-3.8.0  \\\n    && ./configure --prefix=$PGIS_INSTALL_PATH  \\\n    && make -j$(nproc) && make install\n\n### æ„å»º postgis\nADD postgis/postgis-2.5.3.tar.gz /app/postgis/\nRUN cd /app/postgis/postgis-2.5.3  \\\n    && ./configure --prefix=$PGIS_INSTALL_PATH \\\n    # å‡ ä¸ªconfigå‘½ä»¤ç›´æ¥é…ç½®PATHåå¯ä»¥æ‰¾åˆ°ï¼Œæ‰€ä»¥ä¸åœ¨ä½¿ç”¨å‚æ•°é…ç½®\n#        --with-pgconfig=/usr/local/pgspider/bin/pg_config \\\n#        --with-geosconfig=$$PGIS_INSTALL_PATH/bin/geos-config \\\n#        --with-gdalconfig=$$PGIS_INSTALL_PATH/bin/gdal-config \\\n        --with-projdir=$PGIS_INSTALL_PATH \\\n    && make -j$(nproc) && make install\n\nRUN set -ex \\\n#    && sed -i \"s/deb.debian.org/mirrors.tuna.tsinghua.edu.cn/g\" /etc/apt/sources.list \\\n#    && sed -i \"s/security.debian.org/mirrors.tuna.tsinghua.edu.cn/g\"  /etc/apt/sources.list \\\n    # https://packages.debian.org/stretch-backports/libboost-atomic1.67-dev\n#    && echo \"deb http://deb.debian.org/debian stretch-backports main\" >>/etc/apt/sources.list \\\n    && apt-get update \\\n    && apt-get install -y --no-install-recommends \\\n      libprotobuf-c-dev \\\n#      postgresql-12-wal2json \\\n      protobuf-c-compiler \\\n      && rm -rf /var/lib/apt/lists/*\n\n## æ·»åŠ  debezium https://github.com/eulerto/wal2json\nADD debezium/wal2json-wal2json_1_0.tar.gz /app/debezium/\nRUN cd /app/debezium/wal2json-wal2json_1_0 \\\n    && make -j$(nproc) && make install\n\n## æ·»åŠ  debezium - decoderbufs ç ”ç©¶é™¢ä¿®æ”¹ç‰ˆæœ¬\nADD debezium/postgres-decoderbufs.tar.gz /app/debezium/\nRUN cd /app/debezium/postgres-decoderbufs \\\n    && cd proto \\\n    && protoc-c --c_out=../src/proto pg_logicaldec.proto \\\n    && cd .. \\\n    ## make -Bï¼š ç ”ç©¶é™¢æä¾›çš„åŒ…ä¸­å¯èƒ½å¸¦æœ‰ä¹‹å‰makeçš„æˆæœï¼Œæ­¤æ—¶ä¸ä¼šé‡æ–°æ„å»ºï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ -B æ¥å¼ºåˆ¶é‡æ–°æ„å»ºï¼Œä¹Ÿå¯ä»¥å…ˆæ‰§è¡Œ make clean\n    && make -B -j$(nproc) && make install\n\n### å¯¹æ„å»ºpostgisè¿‡ç¨‹ä¸­ç”Ÿæˆçš„æ–‡ä»¶è¿›è¡Œä¼˜åŒ–ï¼Œä»¥å‡å°å¤§å°\n#### 1. ç§»é™¤é™æ€é“¾æ¥åº“æ–‡ä»¶ï¼›2. ä½¿ç”¨stripå‘½ä»¤å¯¹åŠ¨æ€é“¾æ¥åº“soæ–‡ä»¶è¿›è¡Œç¬¦å·è¡¨ä¼˜åŒ–\nRUN cd $PGIS_INSTALL_PATH/lib \\\n    && rm *.a \\\n    && find . -type f -name \"lib*.so.*\" -exec strip {} +\n#    && cd /usr/local/pgspider/plugin/proj/lib \\\n#    && rm *.a && find . -type f -name \"lib*.so.*\" -exec strip {} +\n\n## æ‹·è´mysql\nCOPY binary-arm/mysql_fdw/*.sql         /usr/local/pgspider/share/postgresql/extension/\nCOPY binary-arm/mysql_fdw/*.control    /usr/local/pgspider/share/postgresql/extension/\nCOPY binary-arm/mysql_fdw/*.so         /usr/local/pgspider/lib/postgresql/\n# æ‹·è´zombodb\nCOPY binary-arm/zdblibs/*.sql          /usr/local/pgspider/share/postgresql/extension/\nCOPY binary-arm/zdblibs/*.control      /usr/local/pgspider/share/postgresql/extension/\nCOPY binary-arm/zdblibs/*.so           /usr/local/pgspider/lib/postgresql/\n\n# ------ å¼€å§‹æ„å»ºå®é™…å‘å¸ƒçš„é•œåƒ ------\nFROM zh-registry.geostar.com.cn/geopanel/pgspider-base-arm:latest\nLABEL maintainer=\"jianghanghang@geostar.com.cn\"\n\n## è®¾ç½®è‹¥å¹²ENVï¼ŒæŒ‡ç¤ºç‰ˆæœ¬ä¿¡æ¯\n# buster ä¸Šä¸º12 ï¼Œstretch ä¸Šä¸º 12\n# ENV CDAL_VERSION 12\nENV BOOST_VERSION=1.67.0 \\\n    PG_MAJOR=11 \\\n    PG_VERSION=6 \\\n    POSTGIS_VESION=2.5.3\n\n## å®‰è£…å¿…è¦çš„ä¾èµ–ï¼ˆTODO: éƒ¨åˆ†ä¾èµ–å¯èƒ½ä¸éœ€è¦ï¼‰\nRUN set -ex \\\n#    && sed -i \"s/deb.debian.org/mirrors.tuna.tsinghua.edu.cn/g\" /etc/apt/sources.list \\\n#    && sed -i \"s/security.debian.org/mirrors.tuna.tsinghua.edu.cn/g\"  /etc/apt/sources.list \\\n    # https://packages.debian.org/stretch-backports/libboost-atomic1.67-dev\n#    && echo \"deb http://deb.debian.org/debian stretch-backports main\" >>/etc/apt/sources.list \\\n    && apt-get update \\\n    && apt-get install -y --no-install-recommends \\\n      curl \\\n      libcurl3-gnutls \\\n      libexpat1 \\\n      libgmp10 \\\n      libgmpxx4ldbl \\\n      libjson-c3 \\\n      # buster ä¸Šä¸º6ï¼Œstretchä¸Šä¸º4\n#      libmpfr6 \\\n#      libmpfr4 \\\n      libprotobuf-c1 \\\n      libtiff5 \\\n      libxml2 \\\n      && rm -rf /var/lib/apt/lists/*\n\n## å®‰è£…oracle_fdwéœ€è¦çš„ Oracle instantclient (armç‰ˆæœ¬ä¸æ”¯æŒï¼‰\n### from: https://github.com/rongfengliang/pgspider-docker/blob/master/Dockerfile-all-in-one-oracle\n#COPY --from=build  /usr/local/instantclient_12_2 /usr/local/instantclient_12_2\n#RUN set -ex \\\n#    && ln -s /usr/local/instantclient_12_2 /usr/local/instantclient \\\n#    && ln -s /usr/local/instantclient/sqlplus /usr/bin/sqlplus\n\n## è®¾ç½®è‹¥å¹²è¿è¡Œéœ€è¦çš„ç¯å¢ƒå˜é‡\n#ENV ORACLE_HOME=/usr/local/instantclient \\\nENV PGIS_INSTALL_PATH=/usr/local/pgspider/plugin/postgis\nENV LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$PGIS_INSTALL_PATH/lib:/usr/local/instantclient \\\n    PATH=$PGIS_INSTALL_PATH/bin:/usr/local/pgspider/bin:$PATH\n## æ‹·è´æ„å»ºå¥½çš„æˆæœ\nCOPY --from=build  /usr/local/pgspider /usr/local/pgspider\n## å…¥å£è„šæœ¬æ·»åŠ \nCOPY docker-entrypoint.sh /usr/local/bin/\nRUN mkdir /docker-entrypoint-initdb.d \\\n    && chmod +x /usr/local/bin/docker-entrypoint.sh \\\n    && ln -s usr/local/bin/docker-entrypoint.sh /\n\n## postgis è„šæœ¬æ·»åŠ \n### fromï¼š https://github.com/postgis/docker-postgis/blob/master/Dockerfile.master.template\nCOPY ./postgis/initdb-postgis.sh /docker-entrypoint-initdb.d/10_postgis.sh\nCOPY ./postgis/update-postgis.sh /usr/local/bin\n## æ·»åŠ æ‰©å±•åˆå§‹åŒ–è„šæœ¬\nCOPY ./initdb-fdw.sh /docker-entrypoint-initdb.d/00_fdws.sh\nCOPY ./debezium/init-debezium.sh /docker-entrypoint-initdb.d/01_debezium.sh\n\n## make the sample config easier to munge (and \"correct by default\")\nRUN sed -ri \"s!^#?(listen_addresses)\\s*=\\s*\\S+.*!\\1 = '*'!\" /usr/local/pgspider/share/postgresql/postgresql.conf.sample; \\\n   grep -F \"listen_addresses = '*'\" /usr/local/pgspider/share/postgresql/postgresql.conf.sample\n\nRUN mkdir -p /var/run/postgresql && chown -R postgres:postgres /var/run/postgresql  && chmod 2777 /var/run/postgresql\n\nENV PGDATA /var/lib/postgresql/data\n## è®¾ç½®ç›®å½•æƒé™ - this 777 will be replaced by 700 at runtime (allows semi-arbitrary \"--user\" values)\nRUN mkdir -p \"$PGDATA\" && chown -R postgres:postgres \"$PGDATA\" && chmod 777 \"$PGDATA\"\nVOLUME /var/lib/postgresql/data\n\nENTRYPOINT [\"docker-entrypoint.sh\"]\n\n# COPY FROM https://github.com/docker-library/postgres/blob/master/11/Dockerfile\n# We set the default STOPSIGNAL to SIGINT, which corresponds to what PostgreSQL\n# calls \"Fast Shutdown mode\" wherein new connections are disallowed and any\n# in-progress transactions are aborted, allowing PostgreSQL to stop cleanly and\n# flush tables to disk, which is the best compromise available to avoid data\n# corruption.\n#\n# Users who know their applications do not keep open long-lived idle connections\n# may way to use a value of SIGTERM instead, which corresponds to \"Smart\n# Shutdown mode\" in which any existing sessions are allowed to finish and the\n# server stops when all sessions are terminated.\n#\n# See https://www.postgresql.org/docs/12/server-shutdown.html for more details\n# about available PostgreSQL server shutdown signals.\n#\n# See also https://www.postgresql.org/docs/12/server-start.html for further\n# justification of this as the default value, namely that the example (and\n# shipped) systemd service files use the \"Fast Shutdown mode\" for service\n# termination.\n#\nSTOPSIGNAL SIGINT\n\n# An additional setting that is recommended for all users regardless of this\n# value is the runtime \"--stop-timeout\" (or your orchestrator/runtime's\n# equivalent) for controlling how long to wait between sending the defined\n# STOPSIGNAL and sending SIGKILL (which is likely to cause data corruption).\n#\n# The default in most runtimes (such as Docker) is 10 seconds, and the\n# documentation at https://www.postgresql.org/docs/12/server-start.html notes\n# that even 90 seconds may not be long enough in many instances.\nEXPOSE 5432\nCMD [\"postgres\"]\n```\n\n\n\n## é•œåƒæµ‹è¯•åŠä½¿ç”¨\n\n> æç¤ºï¼šé•œåƒä½¿ç”¨äº†pgå®˜æ–¹çš„å…¥å£è„šæœ¬ï¼Œå®˜æ–¹æ”¯æŒçš„é…ç½®åŠå˜é‡éƒ½å¯ä»¥ä½¿ç”¨ï¼Œå…·ä½“å¯æŸ¥çœ‹[å®˜æ–¹dockerhubé¡µé¢](https://hub.docker.com/_/postgres?tab=description&page=1&ordering=last_updated)\n\nä¸‹é¢æè¿°äº†ä¸€ä¸ªç®€å•çš„æµ‹è¯•æµç¨‹ï¼Œè¯¦ç»†å¯å‚è€ƒï¼š [pgspideré•œåƒè¿è¡Œæµ‹è¯•](http://172.17.0.205/dept-development/product-project/geopanel/geopanel-deploy/-/blob/master/build/pgspider/README.md#%E8%BF%90%E8%A1%8C-1)\n\n```shell\n## æ ¹æ®å¹³å°åŠéœ€è¦ä½¿ç”¨çš„æºï¼Œè®¾ç½® `PG_IMAGE` å˜é‡\n# x86 - dockerhub \nPG_IMAGE=hanlyjiang/pgspider-postgis:latest\n# arm - dockerhub\nPG_IMAGE=hanlyjiang/pgspider-postgis-arm:latest\n# x86 - é˜¿é‡Œäº‘\nPG_IMAGE= zh-registry.geostar.com.cn/geopanel/pgspider-postgis:latest\n# arm - é˜¿é‡Œäº‘\nPG_IMAGE= zh-registry.geostar.com.cn/geopanel/pgspider-postgis-arm:latest\n\n# å¯åŠ¨ pgspider ï¼ˆå¯ä»¥å°† --rm æ¢æˆ -d ä»¥ä¾¿æŒç»­åœ¨åå°è¿è¡Œ ï¼‰\n## é€šè¿‡ POSTGRES_PASSWORD å˜é‡å¯ä»¥è®¾ç½®å¯†ç \ndocker run -it --rm \\\n    --name pgspider \\\n    -p 5434:5432 \\\n    -e POSTGRES_PASSWORD=mysecretpassword \\\n    -v $PWD/data:/var/lib/postgresql/data \\\n    $PG_IMAGE\n\n## å¯åŠ¨åè¿›å…¥å®¹å™¨ï¼š\ndocker exec -it pgspider bash\n### ç„¶åå¯ä»¥æ‰§è¡Œ psql ç­‰å‘½ä»¤\n\n# æµ‹è¯•ç”¨ï¼Œæ­£å¸¸è¿è¡Œå¯ä»¥ä¸ç”¨ç®¡\ndocker run -it --rm \\\n    --entrypoint=\"\" \\\n    --name pgspider \\\n    -e POSTGRES_PASSWORD=mysecretpassword \\\n    -v $PWD/data:/var/lib/postgresql/data \\\n    pgspider-postgis:latest bash\n\n```\n\n## å¯ä¼˜åŒ–éƒ¨åˆ†\n\nbuilderé•œåƒå’Œbaseé•œåƒçš„æ„å»ºarmåŠx86ä¸¤ä¸ªæ¶æ„çš„é•œåƒæ„å»ºå¯ä»¥åˆå¹¶æˆä¸€æ¡å‘½ä»¤å¹¶ä½¿ç”¨ç›¸åŒçš„é•œåƒåç§°ï¼›åŒæ—¶pgspideré•œåƒä¹Ÿå¯ä»¥ç»è¿‡ä¸€å®šçš„æ›´æ”¹ç»Ÿä¸€æˆä¸€ä¸ªæ‰“åŒ…è„šæœ¬ï¼›\n\n\n\n# GeoPanelå®¹å™¨åŒ–-hasuraå³å—æ•°æ®APIå¼•æ“é•œåƒæ„å»º\n\n## Hasuraé•œåƒæ„å»ºæ¦‚è§ˆ\n\n### hasura æ˜¯ä»€ä¹ˆï¼Ÿ\n\nå¼•ç”¨[hasuraå®˜æ–¹]([https://github.com/hasura/graphql-engine/blob/master/translations/README.chinese.md](https://github.com/hasura/graphql-engine/blob/master/translations/README.chinese.md)\n)çš„ä»‹ç»\n\n> Hasura GraphQLå¼•æ“æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„GraphQLæœåŠ¡å™¨ï¼Œå¯ä¸ºæ‚¨æä¾› **Postgresä¸Šå¼€ç®±å³ç”¨çš„å®æ—¶GraphQL API**ï¼Œ å“åº”æ•°æ®åº“äº‹ä»¶çš„ [**Webhookè§¦å‘å™¨**](https://github.com/hasura/graphql-engine/blob/master/event-triggers.md)ï¼Œä»¥åŠç”¨äºä¸šåŠ¡é€»è¾‘å¤„ç†çš„ [**è¿œç«¯Schema**](https://github.com/hasura/graphql-engine/blob/master/remote-schemas.md)ã€‚\n> Hasuraå¯å¸®åŠ©æ‚¨æ„å»ºåŸºäºPostgresçš„GraphQLåº”ç”¨ç¨‹åºï¼Œæˆ–å°†ä½¿ç”¨Postgresçš„ç°æœ‰åº”ç”¨è¿ç§»åˆ°GraphQLä¸Šã€‚\n\nGithubåŠDockerHubåœ°å€ï¼š\n\n* å¼€æºä»“åº“Githubåœ°å€ï¼š[hasura/graphql-engine](hasura/graphql-engine)\n* å®˜æ–¹Dockerhubé•œåƒåœ°å€ï¼š[hasura/graphql-engine](https://hub.docker.com/r/hasura/graphql-engine/tags?page=1&ordering=last_updated)\n\n### æˆ‘ä»¬åšçš„ä¿®æ”¹\n\næˆ‘ä»¬ä½¿ç”¨hasuraä½œä¸ºèåˆä¸­å¿ƒçš„å—æ•°æ®APIå¼•æ“ï¼Œé’ˆå¯¹å¼€æºç‰ˆæœ¬ä½œäº†å¦‚ä¸‹ä¿®æ”¹/æ‰©å±•ï¼š\n\n1. æ±‰åŒ–äº† graphl-engine consoleï¼Œå…¶ä¸­åŒ…æ‹¬ï¼š\n   * æ±‰åŒ– graphql-engineçš„consoleå…¥å£æ–‡ä»¶ä¸­çš„ `Loading...`;\n   * console webé¡µé¢çš„æ‰€æœ‰ç•Œé¢ï¼›\n2. æ ¹æ®éœ€è¦æ‰©å±•äº†å‡ ä¸ªæ¨¡å—ï¼Œæ¨¡å—æ‰©å±•çš„æ–¹å¼ä¸ºï¼š1ï¼‰åœ¨consoleä¸­æ·»åŠ æ‰©å±•æ¨¡å—çš„webæ“ä½œç•Œé¢ï¼›2ï¼‰æä¾›å¯¹åº”çš„springbootæœåŠ¡ä½œä¸ºåç«¯æ¥å£æä¾›æœåŠ¡ï¼›åˆ°ç›®å‰ä¸ºæ­¢ï¼ŒåŒ…æ‹¬ä»¥ä¸‹æ¨¡å—ï¼š\n   * tokenç®¡ç†æœåŠ¡\n   * æ•°æ®åº“é›†æˆæœåŠ¡\n   * restapiæœåŠ¡\n\n### ç›®æ ‡åŠæˆæœ\n\né€šè¿‡å®˜æ–¹çš„dockerhubå¯ä»¥çœ‹åˆ°ï¼Œç›®å‰æ²¡æœ‰armç‰ˆæœ¬çš„é•œåƒï¼Œæ•…æˆ‘ä»¬éœ€è¦ä»å¤´ç¼–è¯‘ã€‚åŒæ—¶æˆ‘ä»¬å¸Œæœ›èƒ½è®©hasuraåœ¨armå¹³å°ä¸Šè¿è¡Œï¼Œæœ€ç»ˆä¹Ÿå®Œæˆäº†æ„å»ºæµç¨‹ï¼Œæ•´ä½“å¦‚ä¸‹ï¼š\n\n![image-20210316140949364](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210316140949.png)\n\n### hasuraæ•´ä½“ç»“æ„\n\n```mermaid\ngraph\n\ngraphql-engine\n\nconsole\n\ncli\n\n```\n\n1. graphql-engine: graphql å¼•æ“\n\n2. consoleï¼šå‰ç«¯ç•Œé¢ï¼Œå®é™…ä¸Šconsoleä¹Ÿä¼šä¸€èµ·æ‰“åŒ…åˆ°graphql-engineçš„é•œåƒé‡Œé¢\n\n3. Hasura CLIæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œæ˜¯ç®¡ç†Hasuraé¡¹ç›®å’Œè¿ç§»çš„ä¸»è¦æ¨¡å¼ã€‚\n\nå®é™…ä¸Šæˆ‘ä»¬åªéœ€è¦å‰ä¸¤ä¸ªéƒ¨åˆ†å³å¯\n\n### æ•´ä½“æ„å»ºæµç¨‹æ¢³ç†\n\n#### ä»£ç ç»“æ„è¯´æ˜\n\n```shell\ngraphql-engine \n\t|-- server\n\t\t  |-- src-rsr\n\t\t  \t\t|-- console.html\n\t|-- console\n\t\t  |-- xx.html\n\t\t  |-- xxxx\n```\n\nserver ç›®å½•ä¼šç¼–è¯‘å‡ºä¸€ä¸ª graphql-engine çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå…¶ä¸­ä¼šåŒ…å« `server/src-rsr/console.html` æ–‡ä»¶ä½œä¸ºé¦–é¡µçš„åŠ è½½æ¨¡æ¿ï¼ˆå³console.htmlï¼‰ã€‚\n\n#### graphql-engine console\n\nconsoleä¸ºwebå·¥ç¨‹ï¼Œä½¿ç”¨npm run buildå³å¯ç¼–è¯‘ï¼Œéå¸¸ç®€å•ã€‚æˆ‘ä»¬åªéœ€è¦é‡ç‚¹å…³æ³¨serveréƒ¨åˆ†å³å¯ã€‚ç°åœ¨æˆ‘ä»¬é‡ç‚¹åˆ†æè¿™ä¸ªserveréƒ¨åˆ†ï¼š\n\n#### graphql-engine server\n\n- graphql-engine server ä½¿ç”¨haskellè¯­è¨€è¿›è¡Œç¼–å†™ï¼Œä½¿ç”¨ cabal è¿›è¡Œæ„å»ºï¼›\n- haskellæ˜¯ä¸€ä¸ªå‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ï¼Œç¼–è¯‘å™¨ä¸ºGHCï¼Œç¼–è¯‘å·¥å…·ä¸€èˆ¬ä½¿ç”¨cabalï¼ŒcabalåŒæ—¶ä¹Ÿæ˜¯é¡¹ç›®çš„ç®¡ç†å·¥å…·ï¼ˆå¦‚åŒ…ç®¡ç†ï¼Œä¾èµ–ç®¡ç†ï¼‰ã€‚\n\nä¹Ÿå°±æ˜¯è¯´ä¸ºäº†ç¼–è¯‘serverï¼Œæˆ‘ä»¬éœ€è¦GHCåŠcabalï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå·¥å…·çš„armç‰ˆæœ¬ç°çŠ¶å¦‚ä½•äº†ï¼Ÿ\n\n* GHCï¼š æ— armç‰ˆæœ¬ç°æˆçš„dockeré•œåƒï¼Œæœ‰é¢„ç¼–è¯‘çš„äºŒè¿›åˆ¶ï¼›\n* cabalï¼š æ— armç‰ˆæœ¬ç°æˆçš„dockeré•œåƒåŠäºŒè¿›åˆ¶æ–‡ä»¶ï¼›\n\nä¸ºäº†ä¸æ±¡æŸ“ç¯å¢ƒï¼Œå¹¶ä¸”æŒä¹…åŒ–æ„å»ºç¯å¢ƒï¼Œæˆ‘ä»¬å‡†å¤‡æ„å»ºä¸€ä¸ªdockerçš„é•œåƒï¼ŒåŒ…å«ghcåŠcabalï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ä¸¤è€…éƒ½éœ€è¦æ„å»ºã€‚\n\næ€»ç»“ä»¥ä¸‹æ„å»ºæ­¥éª¤ï¼š\n\n1. å‡†å¤‡haskellçš„ARMç‰ˆæœ¬ç¼–è¯‘ç¯å¢ƒï¼ˆåŒ…æ‹¬GHCç¼–è¯‘å™¨åŠhasuraç¼–è¯‘æ‰€éœ€è¦çš„cabalå·¥å…·ï¼‰ï¼›\n2. ä½¿ç”¨ä¹‹å‰å‡†å¤‡å¥½çš„ARMç‰ˆæœ¬ç¼–è¯‘ç¯å¢ƒç¼–è¯‘hasuraï¼›\n3. æ‰“åŒ…æˆDockeré•œåƒï¼›\n\n\n\n#### æ•´ä½“æ„å»ºæµç¨‹\n\nåœ¨æµè§ˆ`graphql-engine` çš„ä»“åº“ä¸­ciæ„å»ºçš„éƒ¨åˆ†æ–‡ä»¶ä¹‹åï¼Œæˆ‘å‘ç°è¿˜éœ€è¦å…¶ä»–ä¸€äº›è¾…åŠ©é•œåƒï¼Œæœ€åæ¢³ç†å‡ºå¦‚ä¸‹æ„å»ºæµç¨‹ï¼š\n\n<img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210316090603.png\" alt=\"docker-image-builder-flow\" style=\"zoom: 50%;\" />\n\n\n\n1. é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ„å»º `graphql-engine-builder` çš„é•œåƒï¼Œå…¶ä¸­åŒ…æ‹¬haskellçš„GHCç¼–è¯‘å™¨åŠcabalä¾èµ–ç®¡ç†å·¥å…·ï¼›\n2. ç„¶åæˆ‘ä»¬ä½¿ç”¨`graphql-engine-builder`é•œåƒå¯¹ graphql-engine çš„æºç è¿›è¡Œç¼–è¯‘ï¼Œç”Ÿæˆ graphql-engine çš„äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶åŠ graphql-engine è¿è¡Œæ‰€éœ€è¦çš„ä¾èµ–åº“ï¼›\n3. ç”±äºç¬¬äºŒæ­¥æ„å»ºè¿‡ç¨‹ä¸­æœ‰å¾ˆå¤šä¸­é—´æˆæœï¼Œæˆ‘éœ€è¦ä¸ºgraphql-engineåˆ›é€ ä¸€ä¸ªçº¯å‡€çš„è¿è¡Œç¯å¢ƒä»¥ç¼©å°æœ€ç»ˆçš„è¿è¡Œé•œåƒçš„å¤§å°ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ„å»º `graphql-engine-packager` é•œåƒï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªç²¾ç®€ç‰ˆçš„æ ¹æ–‡ä»¶ç³»ç»Ÿã€‚\n4. ç°åœ¨ï¼Œæˆ‘ä»¬å°†ç¬¬äºŒæ­¥ä¸­ç”Ÿæˆçš„graphql-engineåŠå…¶ä¾èµ–æ–‡ä»¶å’Œç¬¬ä¸‰æ­¥ `graphql-engine-packager` é•œåƒä¸­çš„æ ¹æ–‡ä»¶ç³»ç»Ÿåˆå¹¶åˆ°ä¸€ä¸ªscratché•œåƒï¼Œç„¶åç”Ÿæˆ `graphql-engine-base` çš„é•œåƒï¼Œè¿™ä¸ªé•œåƒå·²ç»åŒ…å«äº†ä¸€ä¸ªå¯ä»¥æ­£å¸¸è¿è¡Œçš„ graphql-engine ï¼Œåªæ˜¯æ²¡æœ‰é›†æˆconsoleèµ„æºåˆ°é•œåƒä¸­ï¼›\n5. æœ€åæˆ‘ä»¬å¯¹consoleè¿›è¡Œç¼–è¯‘ï¼Œç”Ÿæˆassetsèµ„æºï¼Œç„¶ååŸºäº `graphql-engine-base` æ·»åŠ è¿™äº›å‰ç«¯èµ„æºæ–‡ä»¶ï¼Œç”Ÿæˆæˆ‘ä»¬æœ€ç»ˆéœ€è¦çš„ `graphql-engine` é•œåƒï¼›\n\n\n\n## graphql-engine-builder é•œåƒæ„å»º\n\nåŸºäºä»¥ä¸‹åŸå› ï¼Œæˆ‘å†³å®šæ„å»ºä¸€ä¸ªgraphql-engine-builderçš„é•œåƒï¼š\n\n1. ä¸æƒ³æ±¡æŸ“è‡ªå·±çš„ä¸»æœºçš„ç¯å¢ƒï¼Œå®‰è£…ä¸€å †haskellçš„æ„å»ºç¯å¢ƒï¼›\n2. æŒä¹…åŒ–ç¼–è¯‘ç¯å¢ƒï¼Œä½¿å¾—æ„å»ºè¿‡ç¨‹å¯ä»¥æ— æˆæœ¬è¿ç§»åˆ°ä»»ä½•æœºå™¨ï¼›\n\nè¿™ä¸ªbuilderé•œåƒåŒ…å«ä»¥ä¸‹å†…å®¹(å®é™…ä¸Šå°±æ˜¯haskellè¯­è¨€çš„æ„å»ºç¯å¢ƒ)ï¼š\n\n* GHC\n* cabal\n\nç»è¿‡ä¸€ç•ªå°è¯•ï¼Œç¡®å®šäº†å¦‚ä¸‹Dockerfileæ„å»ºè„šæœ¬ï¼š\n\n### **X86** Dockerfile\n\n```dockerfile\n#  x86 ç”¨äºæ„å»ºhasuraçš„é•œåƒ\n# æ„å»ºå‘½ä»¤ docker build -f Dockerfile -t hanlyjiang/graphql-engine-builder:latest .\nFROM haskell:8.10.1\n\n## ensure locale is set during buildï¼ˆå¦åˆ™æ— æ³•æ„å»ºcabalï¼Œä¼šå‡ºç°hGetContenté”™è¯¯ï¼‰\nENV LANG            C.UTF-8\n\n# é¿å…é…ç½®tzdataæ—¶å‡ºç°çš„äº¤äº’å¼ç­‰å¾…ç•Œé¢å¯¼è‡´æ„å»ºå¡ä½\n## https://techoverflow.net/2019/05/18/how-to-fix-configuring-tzdata-interactive-input-when-building-docker-images/\nENV DEBIAN_FRONTEND noninteractive\n\nRUN sed -i \"s/deb.debian.org/mirrors.tuna.tsinghua.edu.cn/g\" /etc/apt/sources.list && \\\n   sed -i \"s/security.debian.org/mirrors.tuna.tsinghua.edu.cn/g\"  /etc/apt/sources.list && \\\n   apt-get update && \\\n   apt-get install -y --no-install-recommends apt-utils lsb-release wget && \\\n   echo \"deb http://apt.postgresql.org/pub/repos/apt buster-pgdg main\" > /etc/apt/sources.list.d/pgdg.list && \\\n   wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc |  apt-key add - && \\\n   apt-get update && \\\n   apt-get install -y --no-install-recommends  postgresql libpq-dev && \\\n   rm -fr /var/lib/apt/lists/* && \\\n   # å®‰è£… upx\n   wget https://github.com/upx/upx/releases/download/v3.96/upx-3.96-amd64_linux.tar.xz && \\\n           tar -xf upx-3.96-amd64_linux.tar.xz  && \\\n           cp upx-3.96-amd64_linux/upx /usr/bin/upx && \\\n           rm -fr upx-3.96-amd64_linux\n```\n\nx86ç‰ˆæœ¬åŸºäº haskellå®˜æ–¹çš„`haskell:8.10.1` é•œåƒï¼Œæ·»åŠ äº†å¦‚ä¸‹åŠ¨ä½œï¼š\n\n1. æ›¿æ¢è½¯ä»¶æºä¸ºå›½å†…è½¯ä»¶æºï¼›\n2. å®‰è£…å¿…è¦çš„è½¯ä»¶ä¾èµ–ï¼›\n3. æ·»åŠ äº†upxç”¨äºäºŒè¿›åˆ¶æ–‡ä»¶ä¼˜åŒ–ï¼›\n\n### **ARM** Dockerfile\n\narmç‰ˆæœ¬çš„åˆ™éœ€è¦ä»å¤´æ„å»º\n\n* æˆ‘ä»¬ä½¿ç”¨ `ubuntu:18.04` ä½œä¸ºåŸºç¡€é•œåƒï¼›\n* é¦–å…ˆå®‰è£…äº† LLVM6.0 åŠ GHC8.6.5 ï¼›\n* ä½¿ç”¨ GHC8.6.5 æ„å»º Cabal3.2.0.0ï¼ˆåŒ…æ‹¬cabal-installï¼‰ï¼Œå› ä¸ºGHC8.10.1æ— æ³•æˆåŠŸæ„å»ºcabal-install 3.2ï¼›\n* ç„¶åå®‰è£… LLVM 9 åŠGHC8.10.1ï¼Œç”¨äºåç»­ç¼–è¯‘hasuraï¼›\n* æ·»åŠ å¿…è¦çš„ä¾èµ–ï¼›\n* æ·»åŠ äº†upxç”¨äºäºŒè¿›åˆ¶æ–‡ä»¶ä¼˜åŒ–ï¼›\n\n```dockerfile\n## Hasura graphql-engine ç¼–è¯‘ç¯å¢ƒ\n# æµ‹è¯•å‘ç°åªæœ‰åœ¨armæœºå™¨ä¸Šæ‰å¯èƒ½æ„å»ºæˆåŠŸï¼Œx86 dockeräº¤å‰æ„å»ºå¤±è´¥\n# docker build -t registry.cn-hangzhou.aliyuncs.com/geostar_private_arm/haskell-ghc8.6.5_8.10.1-cabal3.2:20200817 .\n\n# ghc-8.6.5çš„å®‰è£…æ„å»ºéœ€è¦åœ¨ubuntu18.04ä¸Šï¼ˆglibc2.27)\n## é€šè¿‡å¦‚ä¸‹æ–¹å¼ç¡®è®¤glibcç‰ˆæœ¬ï¼š\n### docker run -it --rm ubuntu:18.04 bash -c \"find / -type f | grep libc-.*.so\" # è¾“å‡º /lib/x86_64-linux-gnu/libc-2.27.so\n### docker run -it --rm debian:stretch bash -c \"find / -type f | grep libc-.*.so\" # è¾“å‡º /lib/x86_64-linux-gnu/libc-2.24.so\n### docker run -it --rm debian:buster bash -c \"find / -type f | grep libc-.*.so\" # è¾“å‡º /lib/aarch64-linux-gnu/libc-2.28.so\n### debianä¹Ÿå¯ä»¥åœ¨æ­¤é¡µé¢æŸ¥çœ‹ï¼šhttps://packages.debian.org/search?searchon=sourcenames&keywords=glibc\n#FROM debian:stretch\nFROM ubuntu:18.04\n\n## ensure locale is set during buildï¼ˆå¦åˆ™æ— æ³•æ„å»ºcabalï¼Œä¼šå‡ºç°hGetContenté”™è¯¯ï¼‰\nENV LANG            C.UTF-8\n\n# é¿å…é…ç½®tzdataæ—¶å‡ºç°çš„äº¤äº’å¼ç­‰å¾…ç•Œé¢å¯¼è‡´æ„å»ºå¡ä½\n## https://techoverflow.net/2019/05/18/how-to-fix-configuring-tzdata-interactive-input-when-building-docker-images/\nENV DEBIAN_FRONTEND noninteractive\n\n# ä»¥é˜²ç½‘ç»œä¸å¥½ï¼Œåˆ‡æ¢åˆ°å›½å†…é•œåƒæº\nRUN apt-get update && \\\n     apt install -y apt-transport-https ca-certificates\nADD ubuntu18.04-sources.list /etc/apt/sources.list\n\n\n# é¿å… hash sum mismatch é—®é¢˜ï¼š\n## https://stackoverflow.com/questions/15505775/debian-apt-packages-hash-sum-mismatch\n# RUN apt-get clean && rm -rf /var/lib/apt/lists/* && apt-get clean && apt-get update && \\\n\n# å®‰è£…å¸¸ç”¨è½¯ä»¶åŠGHCæ„å»ºç›¸å…³ä¾èµ–\nRUN apt-get update && \\\n    apt-get install -y --no-install-recommends gnupg ca-certificates dirmngr curl git wget && \\\n    apt-get install -y --no-install-recommends zlib1g-dev libtinfo-dev libsqlite3-dev \\\n                g++ netbase xz-utils libnuma-dev make openssh-client \\\n                # hasura æ„å»ºéœ€è¦ï¼ˆpg-clientï¼‰\n                ## https://stackoverflow.com/questions/17915098/openssl-ssl-h-no-such-file-or-directory-during-installation-of-git\n                libssl-dev libkrb5-dev && \\\n    # å®‰è£…llvm 6.0ï¼ˆç”¨äºæ„å»ºcabalï¼‰\n    LLVM_VERSION=6.0 && \\\n    # apt-get install -y software-properties-common && \\\n    apt-get install -y --no-install-recommends libghc-network-dev \\\n        llvm-${LLVM_VERSION} llvm-${LLVM_VERSION}-dev postgresql libpq-dev && \\\n        rm -fr /var/lib/apt/lists/* && \\\n    ln -s /usr/lib/llvm-${LLVM_VERSION}/bin/llc /usr/local/bin/llc  && \\\n    ln -s /usr/lib/llvm-${LLVM_VERSION}/bin/opt /usr/local/bin/opt\n\n# å®‰è£… GHC 8.6.5ï¼ˆç”¨äºæ„å»ºCabal3.2.0.0ï¼‰\nRUN GHC=8.6.5 && GHC_OS_DIST=ubuntu18.04 && \\\n    ## ä¸‹è½½é“¾æ¥ç±»ä¼¼ï¼šhttps://downloads.haskell.org/~ghc/8.10.1/ghc-8.10.1-aarch64-deb9-linux.tar.xz \n    wget https://downloads.haskell.org/~ghc/${GHC}/ghc-${GHC}-aarch64-${GHC_OS_DIST}-linux.tar.xz && \\\n    tar -xvf ghc-${GHC}-aarch64-${GHC_OS_DIST}-linux.tar.xz && \\\n    cd ghc-${GHC}  && \\\n    ./configure && \\\n    make install && \\\n    cd ../ && \\\n    rm -rf ghc-${GHC}-aarch64-${GHC_OS_DIST}-linux.tar.xz ghc-${GHC} \n\n# æ„å»º Cabal 3.2.0.0 ï¼ˆåŒ…æ‹¬ cabal-installï¼‰\nRUN git clone -b cabal-install-v3.2.0.0 https://github.com/haskell/cabal.git && \\\n    cd cabal/cabal-install && \\\n    ./bootstrap.sh && \\\n    cd ../.. && \\\n    rm -fr cabal\n\n# å®‰è£… llvm 9 åŠå…¶ä»–æ„å»ºæ‰€éœ€ ï¼ˆpostgresql libpq-devï¼‰pg_config\nRUN LLVM_VERSION=9 && \\\n    apt-get update && \\\n    apt-get install -y --no-install-recommends llvm-${LLVM_VERSION} llvm-${LLVM_VERSION}-dev postgresql libpq-dev && \\\n    # å¦‚æœæœ‰æ—§ç‰ˆæœ¬çš„ï¼Œåˆ™ç§»é™¤é“¾æ¥\n    rm /usr/local/bin/llc /usr/local/bin/opt && \\\n    ln -s /usr/lib/llvm-${LLVM_VERSION}/bin/llc /usr/local/bin/llc && \\\n    ln -s /usr/lib/llvm-${LLVM_VERSION}/bin/opt /usr/local/bin/opt && \\\n    # å®‰è£…ghc8.10.1 ï¼Œè‡ªå¸¦Cabalåº“çš„3.2ç‰ˆæœ¬\n    GHC=8.10.1 && GHC_OS_DIST=deb9 && \\\n    wget https://downloads.haskell.org/~ghc/${GHC}/ghc-${GHC}-aarch64-${GHC_OS_DIST}-linux.tar.xz && \\\n    tar -xvf ghc-${GHC}-aarch64-${GHC_OS_DIST}-linux.tar.xz && \\\n    cd ghc-${GHC}  && \\\n    ./configure && \\\n    make install && \\\n    cd ../ && \\\n    rm -rf ghc-${GHC}-aarch64-${GHC_OS_DIST}-linux.tar.xz ghc-${GHC} && \\\n    # å®‰è£…3.96ç‰ˆæœ¬çš„upx-ç”¨äºå‹ç¼©ä¼˜åŒ–graphql-engineäºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆè½¯ä»¶æºä¸­çš„3.94ç‰ˆæœ¬æœ‰å‹ç¼©aarchçš„äºŒè¿›åˆ¶åæœ‰é—®é¢˜ https://github.com/upx/upx/issues/130ï¼‰\n    wget https://github.com/upx/upx/releases/download/v3.96/upx-3.96-arm64_linux.tar.xz && \\\n    tar -xf upx-3.96-arm64_linux.tar.xz  && \\\n    cp upx-3.96-arm64_linux/upx /usr/bin/upx && \\\n    rm -fr upx-3.96-arm64_linux upx-3.96-arm64_linux.tar.xz /var/lib/apt/lists/*\n\n\n## stack å®‰è£…(hasuraæ„å»ºå¯ä¸å®‰è£…stack)\n# ARG STACK=2.1.3\n# ARG STACK_KEY=C5705533DA4F78D8664B5DC0575159689BEFB442\n# ARG STACK_RELEASE_KEY=2C6A674E85EE3FB896AFC9B965101FF31C5C154D\n\n# RUN arch=`uname -m` && \\\n#     echo $arch && \\ \n#     curl -fSL https://github.com/commercialhaskell/stack/releases/download/v${STACK}/stack-${STACK}-linux-$arch.tar.gz -o  stack.tar.gz && \\\n#     curl -fSL https://github.com/commercialhaskell/stack/releases/download/v${STACK}/stack-${STACK}-linux-$arch.tar.gz.asc -o stack.tar.gz.asc \n# RUN export GNUPGHOME=\"$(mktemp -d)\" && \\\n#     gpg --batch --keyserver ha.pool.sks-keyservers.net --recv-keys ${STACK_KEY} && \\\n#     gpg --batch --keyserver ha.pool.sks-keyservers.net --recv-keys ${STACK_RELEASE_KEY} && \\\n#     gpg --batch --trusted-key 0x575159689BEFB442 --verify stack.tar.gz.asc stack.tar.gz && \\\n#     tar -xf stack.tar.gz -C /usr/local/bin --strip-components=1 && \\\n#     /usr/local/bin/stack config set system-ghc --global true && \\\n#     /usr/local/bin/stack config set install-ghc --global false && \\\n#     rm -rf \"$GNUPGHOME\" /var/lib/apt/lists/* /stack.tar.gz.asc /stack.tar.gz;\n\n# è®¾ç½®ç¯å¢ƒå˜é‡ä½¿å¯ä»¥æ‰¾åˆ°cabalï¼ŒGHCçš„é»˜è®¤ä¼šå®‰è£…åˆ°PATHä¸­ï¼Œæ— éœ€é¢å¤–è®¾ç½®\nENV PATH /root/.cabal/bin:$PATH\n\n## æ²¡æœ‰æŒ‡å®šå‘½ä»¤çš„æ—¶å€™é»˜è®¤è¿è¡Œghci\nCMD [\"ghci\"]\n\n```\n\n> æ³¨æ„ï¼šç”±äºä»¥ä¸Šbuilderé•œåƒæ˜¯ç”¨äºç¼–è¯‘graphql-engineçš„å·¥å…·é•œåƒï¼Œè€Œéæœ€ç»ˆçš„é•œåƒï¼Œæ‰€ä»¥å¹¶æœªåˆ»æ„å¯¹é•œåƒå¤§å°è¿›è¡Œä¼˜åŒ–ï¼›\n\n## graphql-engine-packager æ„å»º\n\npackageré•œåƒä¸­åŒ…å«ä¸€ä¸ªçº¯å‡€çš„æ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œå¯ä¸ºgraphql-engine serveræä¾›åŸºç¡€çš„è¿è¡Œç¯å¢ƒï¼›\n\n### æ•´ä½“è¯´æ˜\n\ngraphql-engine-packagerçš„é•œåƒæ„å»ºè„šæœ¬ä½äºæºç çš„ `server/packaging` ç›®å½•ä¸­çš„ `package.df` æ–‡ä»¶ä¸­ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n\n```dockerfile\nFROM hasura/haskell-docker-packager:20190731\nMAINTAINER vamshi@hasura.io\n\nRUN apt-get update && apt-get install -y libpq5 upx \\\n && update-ca-certificates \\\n && mkdir -p /usr/src/busybox/rootfs/etc/ssl/certs \\\n && cp -L /etc/ssl/certs/* /usr/src/busybox/rootfs/etc/ssl/certs/ \\\n && rm -rf /var/lib/apt/lists/*\n```\n\nå¯ä»¥çœ‹åˆ°å…¶åŸºäº `hasura/haskell-docker-packager:20190731` çš„é•œåƒï¼ˆ[DockerHubå¯¹åº”é¡µé¢](https://hub.docker.com/r/hasura/haskell-docker-packager/tags?page=1&ordering=last_updated)ï¼‰ï¼Œå…·ä½“æ„å»ºæ–¹å¼å¦‚ä¸‹ï¼š\n\n```shell\nregistry=hanlyjiang  # æ›¿æ¢æˆè‡ªè¡Œè®¾ç½®çš„å€¼\npackager_ver=20210316 # æ›¿æ¢æˆè‡ªè¡Œè®¾ç½®çš„å€¼\n\ndocker build -t '$registry/graphql-engine-packager:$packager_ver' -f packaging/packager.df ./packaging/\n```\n\nä»ä»¥ä¸Šåˆ†æå¯çŸ¥ï¼Œæˆ‘ä»¬è¦æ„å»ºpackageré•œåƒï¼Œéœ€è¦å…ˆæ„å»º`haskell-docker-packager`é•œåƒï¼Œè€Œå¯¹äºX86ç‰ˆæœ¬æ¥è¯´ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ä½¿ç”¨å®˜æ–¹å·²ç»æ„å»ºå¥½çš„é•œåƒï¼Œå¯¹äºARMç‰ˆæœ¬æ¥è¯´ï¼Œåˆ™éœ€è¦æˆ‘ä»¬ä»å¤´æ„å»ºï¼›\n\n\n\n### X86é•œåƒæ„å»º\n\nå¦‚ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬ç›´æ¥åŸºäºå®˜æ–¹çš„ `hasura/haskell-docker-packager:20190731`å¹¶ä½¿ç”¨æºç ç›®å½•ä¸­çš„ `packaging/packager.df` æ–‡ä»¶æ„å»ºå‡ºå¯¹åº”çš„`graphql-engine-packager`é•œåƒå³å¯ï¼›\n\n### ARM\n\n#### haskell-docker-packager é•œåƒæ„å»º\n\narmç‰ˆæœ¬åˆ™éœ€è¦æˆ‘ä»¬ä»å¤´æ„å»º `haskell-docker-packager` çš„é•œåƒï¼ŒåŸºäºå®˜æ–¹çš„ [github/hasura/haskell-docker-builder](https://github.com/hasura/haskell-docker-builder) æºç ï¼Œæˆ‘ç•¥ä½œä¿®æ”¹ï¼Œè®©å…¶å¯ä»¥æ„å»ºå‡ºarmç‰ˆæœ¬çš„é•œåƒï¼Œå¯¹åº”çš„ä»£ç æ”¾ç½®äº [github/hanlyjiang/haskell-docker-builder](https://github.com/hanlyjiang/haskell-docker-builder) ä¸­ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å³å¯æ„å»ºå‡ºarmç‰ˆæœ¬çš„ `haskell-docker-packager` é•œåƒï¼š\n\n```shell\ngit clone git@github.com:hanlyjiang/haskell-docker-builder.git \nmake build \n```\n\nä¸Šè¿°å‘½ä»¤æ‰§è¡Œå®Œæ¯•åä¼šç”Ÿæˆä¸€ä¸ª `hanlyjiang/haskell-docker-packager:å½“å‰æ—¥æœŸ` çš„é•œåƒã€‚\n\n\n\n#### graphql-engine-packager é•œåƒæ„å»º\n\nåŒæ ·çš„ï¼Œæˆ‘ä»¬åœ¨ graphql-engineçš„æºä»£ç çš„ `server/packaging` ç›®å½•ä¸­æ·»åŠ ä¸€ä¸ªåä¸º `packaging-arm.df` çš„æ–‡ä»¶ç”¨äºæ„å»º arm ç‰ˆæœ¬çš„ `graphql-engine-packager` é•œåƒï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n\n```dockerfile\nFROM hanlyjiang/haskell-docker-packager:20200814\nMAINTAINER hanlyjiang@outlook.com\n\nRUN apt-get update && apt-get install -y libpq5 upx \\\n && update-ca-certificates \\\n && mkdir -p /usr/src/busybox/rootfs/etc/ssl/certs \\\n && cp -L /etc/ssl/certs/* /usr/src/busybox/rootfs/etc/ssl/certs/ \\\n && rm -rf /var/lib/apt/lists/*\n```\n\nå¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤æ„å»ºarmç‰ˆæœ¬é•œåƒï¼š\n\n```shell\nregistry=hanlyjiang  # æ›¿æ¢æˆè‡ªè¡Œè®¾ç½®çš„å€¼\npackager_ver=20210316 # æ›¿æ¢æˆè‡ªè¡Œè®¾ç½®çš„å€¼\n```\n\næ„å»ºå¯ä»¥åœ¨armæœºå™¨ä¸Šæ‰§è¡Œï¼Œä¹Ÿå¯ä»¥åœ¨x86æœºå™¨ä¸Šé€šè¿‡buildxæ¥äº¤å‰æ„å»ºï¼š\n\n- arm æœºå™¨ä¸Šæ‰§è¡Œï¼š    \n\n```shell\ndocker build -t '$registry/graphql-engine-packager:$packager_ver' -f packaging/packager-arm.df ./packaging/\n```\n\n- éarmæœºå™¨ä¸Šäº¤å‰æ„å»ºarmé•œåƒ\n\n```shell\ndocker buildx build --platform=linux/arm64 -t '$registry/graphql-engine-packager:$packager_ver' -f packaging/packager-arm.df ./packaging/ --load\n```\n\n\n\n## graphql-engine-base æ„å»º\n\n`graphql-engine-base` é•œåƒåŒ…å« graphql-engine çš„ serverï¼Œå½“ä¸åŒ…å« console çš„ web èµ„æºï¼›\n\n### X86é•œåƒæ„å»º\n\n```dockerfile\n### æ„å»º graphql-engine é•œåƒ\n## docker build -f Dockerfile-all.dockerfile -t graphql-engine-base:20201109 ./\n\n## -- ç¼–è¯‘ graphql-engine\n# \nFROM hanlyjiang/graphql-engine-builder:20201111 as builder\n\nARG GIT_TAG=v1.3.2\nARG GIT_USER=docker-build\nARG GIT_PWD=4Kqy9Cb4FcYx2H4goiEq\n\nRUN git clone -b $GIT_TAG http://$GIT_USER:$GIT_PWD@172.17.0.205/dept-development/product-project/geopanel/development-center/blockdataapi-engine.git /app/graphql-engine \n\nWORKDIR /app/graphql-engine/server\n\n# åˆå§‹åŒ–cabalçš„é…ç½®\nRUN ln -s cabal.project.ci cabal.project.local && \\\n    export LANG=C.UTF-8 && \\\n    # ç”Ÿæˆé…ç½®æ–‡ä»¶(~/.cabal/config) https://cabal.readthedocs.io/en/3.4/installing-packages.html\n    cabal user-config update && \\\n    # æ›¿æ¢ä¸ºå›½å†…æº\n    sed -i 's/hackage.haskell.org/mirrors.tuna.tsinghua.edu.cn/g' /root/.cabal/config  && \\\n    sed -i 's/mirrors.tuna.tsinghua.edu.cn\\//mirrors.tuna.tsinghua.edu.cn\\/hackage/g' /root/.cabal/config\n\n# é‡æ–°æ›´æ–°è½¯ä»¶åŒ…ä¿¡æ¯(å•ç‹¬ä½œä¸ºä¸€å±‚ï¼Œä»¥ä¾¿ç¼“å­˜)\nRUN cabal new-update\n\n# ç¼–è¯‘ graphql-engine å¯æ‰§è¡Œæ–‡ä»¶\n# æˆ‘ä»¬å°†åŠ è½½ä¸­æ›¿æ¢ä¸ºä¸­æ–‡\nRUN sed -i 's/Loading/åŠ è½½ä¸­/g' src-rsr/console.html && \\\n    # https://cabal.readthedocs.io/en/3.4/cabal-project.html#cfg-flag---jobs\n    cabal new-build --jobs=$(nproc)\nRUN build_output=../_build_output && \\\n    exec_glob=`find ./dist-newstyle/ -type f -name \"graphql-engine\"` && \\\n    mkdir $build_output && \\\n    cp \"$exec_glob\" $build_output/ && \\\n    # get-version éœ€è¦åŸºäºgitä»“åº“è·å–ç‰ˆæœ¬å·\n    ../scripts/get-version.sh >$build_output/version.txt \n\n\n## -- æå–åŸºç¡€çš„rootfs\n# docker build --progress plain -t graphql-engine-baserootfs:20201110 --target baseRootfs ./\nFROM hasura/graphql-engine-packager:20190731 as baseRootfs\nCOPY --from=builder /app/graphql-engine/_build_output/ /root/\nRUN mkdir /rootfs/ && /build.sh graphql-engine | tar -x -C /rootfs/\n\n\n## æ„å»ºæœ€ç»ˆçš„rootfs\n# docker build --progress plain -f Dockerfile-all.dockerfile -t graphql-engine-builderrootfs:20201110 --target bulderRootfs ./\nFROM builder as bulderRootfs\nWORKDIR /app/graphql-engine/\nCOPY --from=baseRootfs /rootfs /app/graphql-engine/server/packaging/build/rootfs\n\nRUN pg_dump_ver=12 && \\\n    exec_glob=`find server/dist-newstyle/ -type f -name \"graphql-engine\"` && \\\n    build_output=./_build_output  && \\\n    packaging_dir=./server/packaging/  && \\\n    rootfs_dir=$packaging_dir/build/rootfs  && \\\n    cp $build_output/graphql-engine $rootfs_dir/bin && \\\n    # è·å–æ‰€æœ‰åŠ¨æ€é“¾æ¥åº“\n    ldd $build_output/graphql-engine | awk 'BEGIN{ORS=\"\\n\"}$1~/^\\//{print $1}$3~/^\\//{print $3}' | xargs cp -n -L --parents -t $rootfs_dir/ && \\\n    # è·å– pg_dump\n    cp /usr/lib/postgresql/$pg_dump_ver/bin/pg_dump $rootfs_dir/bin/pg_dump && \\\n    # ä¼˜åŒ–&å‹ç¼©\n    strip --strip-unneeded $rootfs_dir/bin/graphql-engine && \\\n    upx $rootfs_dir/bin/graphql-engine \n\n## - ä¸å¸¦ console-assets\n# docker build --progress plain -f Dockerfile-base.dockerfile -t graphql-engine-base:20201110 --target graphql-engine-base ./\nFROM scratch as graphql-engine-base\nCOPY --from=bulderRootfs /app/graphql-engine/server/packaging/build/rootfs/ /\nENV LANG=C.UTF-8 LC_ALL=C.UTF-8\nCMD [\"graphql-engine\", \"serve\"]\n```\n\næ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æ„å»ºï¼š\n\n```shell\nTAG=$(date '+%Y%m%d')\n\ndocker build -t graphql-engine-base:$TAG ./ \n```\n\n\n\n### ARMç‰ˆæœ¬é•œåƒæ„å»º\n\n```dockerfile\n### æ„å»º graphql-engine é•œåƒ\n## docker buildx build --platform=linux/arm64  -f Dockerfile-base-arm.dockerfile -t graphql-engine-base:arm-20201109 ./ --load\n\n\n## æ„å»ºå‡†å¤‡\n# docker pull hanlyjiang/graphql-engine-builder:arm-latest\n\n## -- ç¼–è¯‘ graphql-engine\n# \nFROM hanlyjiang/graphql-engine-builder:arm-latest as builder\n\nARG GIT_TAG=v1.3.2\nARG GIT_USER=docker-build\nARG GIT_PWD=4Kqy9Cb4FcYx2H4goiEq\n\nRUN git clone -b $GIT_TAG http://$GIT_USER:$GIT_PWD@172.17.0.205/dept-development/product-project/geopanel/development-center/blockdataapi-engine.git /app/graphql-engine \n\nWORKDIR /app/graphql-engine/server\n\n# åˆå§‹åŒ–cabalçš„é…ç½®\nRUN ln -s cabal.project.ci cabal.project.local && \\\n    export LANG=C.UTF-8 && \\\n    # ç”Ÿæˆé…ç½®æ–‡ä»¶(~/.cabal/config) https://cabal.readthedocs.io/en/3.4/installing-packages.html\n    cabal user-config update && \\\n    # æ›¿æ¢ä¸ºå›½å†…æº\n    sed -i 's/hackage.haskell.org/mirrors.tuna.tsinghua.edu.cn/g' /root/.cabal/config  && \\\n    sed -i 's/mirrors.tuna.tsinghua.edu.cn\\//mirrors.tuna.tsinghua.edu.cn\\/hackage/g' /root/.cabal/config\n\n# é‡æ–°æ›´æ–°è½¯ä»¶åŒ…ä¿¡æ¯(å•ç‹¬ä½œä¸ºä¸€å±‚ï¼Œä»¥ä¾¿ç¼“å­˜)\n## update è¿‡ç¨‹ä¸­å¯èƒ½è‡ªåŠ¨å»githubä¸‹è½½ä»“åº“\nRUN cabal new-update\n\n# ç¼–è¯‘ graphql-engine å¯æ‰§è¡Œæ–‡ä»¶\nRUN sed -i 's/Loading/åŠ è½½ä¸­/g' src-rsr/console.html && \\\n    # https://cabal.readthedocs.io/en/3.4/cabal-project.html#cfg-flag---jobs\n    cabal new-build --jobs=$(nproc)\nRUN build_output=../_build_output && \\\n    exec_glob=`find ./dist-newstyle/ -type f -name \"graphql-engine\"` && \\\n    mkdir $build_output && \\\n    cp \"$exec_glob\" $build_output/ && \\\n    # get-version éœ€è¦åŸºäºgitä»“åº“è·å–ç‰ˆæœ¬å·\n    ../scripts/get-version.sh >$build_output/version.txt \n\n\n## -- æå–åŸºç¡€çš„rootfs\n# docker buildx build --platform=linux/arm64  -f Dockerfile-base.dockerfile --progress plain -t graphql-engine-baserootfs:20201110 --target baseRootfs ./ --load\nFROM hanlyjiang/graphql-engine-packager:20200814 as baseRootfs\nCOPY --from=builder /app/graphql-engine/_build_output/ /root/\n# build.sh çš„å†…å®¹å°±æ˜¯ä¸‹é¢çš„ ldd graphql-engine | awk 'BEGIN{ORS=\"\\n\"}$1~/^\\//{print $1}$3~/^\\//{print $3}' | xargs cp -n -L --parents -t ï¼Œç”¨äºæ‹·è´packageré•œåƒä¸­graphql-engineéœ€è¦çš„ä¾èµ–åº“åˆ°rootfs\nRUN mkdir /rootfs/ && /build.sh graphql-engine | tar -x -C /rootfs/\n\n\n## æ„å»ºæœ€ç»ˆçš„rootfs\n# docker buildx build --platform=linux/arm64  --progress plain -f Dockerfile-base.dockerfile -t graphql-engine-builderrootfs:20201110 --target bulderRootfs ./ --load\nFROM builder as bulderRootfs\nWORKDIR /app/graphql-engine/\nCOPY --from=baseRootfs /rootfs /app/graphql-engine/server/packaging/build/rootfs\n\nRUN pg_dump_ver=12 && \\\n    exec_glob=`find server/dist-newstyle/ -type f -name \"graphql-engine\"` && \\\n    build_output=./_build_output  && \\\n    packaging_dir=./server/packaging/  && \\\n    rootfs_dir=$packaging_dir/build/rootfs  && \\\n    cp $build_output/graphql-engine $rootfs_dir/bin && \\\n    # è·å–æ‰€æœ‰åŠ¨æ€é“¾æ¥åº“\n    ldd $build_output/graphql-engine | awk 'BEGIN{ORS=\"\\n\"}$1~/^\\//{print $1}$3~/^\\//{print $3}' | xargs cp -n -L --parents -t $rootfs_dir/ && \\\n    # è·å– pg_dump(arm builderé•œåƒè·¯å¾„ä¸ä¸€æ ·)\n    cp /usr/share/postgresql-common/pg_wrapper $rootfs_dir/bin/pg_dump && \\\n    # ä¼˜åŒ–&å‹ç¼©\n    strip --strip-unneeded $rootfs_dir/bin/graphql-engine && \\\n    upx $rootfs_dir/bin/graphql-engine \n\n## - ä¸å¸¦ console-assets\n# docker buildx build --platform=linux/arm64  --progress plain -f Dockerfile-base.dockerfile -t graphql-engine-base-arm:20201110 --target graphql-engine-base ./ --load\nFROM scratch as graphql-engine-base\nLABEL maintainer=\"jianghanghang@geostar.com.cn\"\nCOPY --from=bulderRootfs /app/graphql-engine/server/packaging/build/rootfs/ /\nENV LANG=C.UTF-8 LC_ALL=C.UTF-8\nCMD [\"graphql-engine\", \"serve\"]\n\n```\n\næ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æ„å»ºï¼š\n\n```shell\nTAG=$(date '+%Y%m%d')\n\n# ARMæœºå™¨æ‰§è¡Œ\ndocker build  -t graphql-engine-base:arm-$TAG  ./\n\n# x86äº¤å‰æ„å»º\ndocker buildx build --platform=linux/arm64 -t  graphql-engine-base:arm-$TAG ./ --load\n```\n\n\n\n### æ„å»ºè„šæœ¬åˆå¹¶ç®€åŒ–ï¼ˆæœªéªŒè¯ï¼‰\n\n```dockerfile\n### æ„å»º graphql-engine é•œåƒ\n## docker build -f Dockerfile-all.dockerfile -t graphql-engine-base:20201109 ./\n\n## -- ç¼–è¯‘ graphql-engine\n# \n\nARG builder_image\nARG packager_image\nFROM ${builder_image} as builder\n\nARG GIT_TAG=v1.3.2\nARG GIT_USER=docker-build\nARG GIT_PWD=4Kqy9Cb4FcYx2H4goiEq\n\nRUN git clone -b $GIT_TAG http://$GIT_USER:$GIT_PWD@172.17.0.205/dept-development/product-project/geopanel/development-center/blockdataapi-engine.git /app/graphql-engine \n\nWORKDIR /app/graphql-engine/server\n\n# åˆå§‹åŒ–cabalçš„é…ç½®\nRUN ln -s cabal.project.ci cabal.project.local && \\\n    export LANG=C.UTF-8 && \\\n    # ç”Ÿæˆé…ç½®æ–‡ä»¶(~/.cabal/config) https://cabal.readthedocs.io/en/3.4/installing-packages.html\n    cabal user-config update && \\\n    # æ›¿æ¢ä¸ºå›½å†…æº\n    sed -i 's/hackage.haskell.org/mirrors.tuna.tsinghua.edu.cn/g' /root/.cabal/config  && \\\n    sed -i 's/mirrors.tuna.tsinghua.edu.cn\\//mirrors.tuna.tsinghua.edu.cn\\/hackage/g' /root/.cabal/config\n\n# é‡æ–°æ›´æ–°è½¯ä»¶åŒ…ä¿¡æ¯(å•ç‹¬ä½œä¸ºä¸€å±‚ï¼Œä»¥ä¾¿ç¼“å­˜)\nRUN cabal new-update\n\n# ç¼–è¯‘ graphql-engine å¯æ‰§è¡Œæ–‡ä»¶\n# æˆ‘ä»¬å°†åŠ è½½ä¸­æ›¿æ¢ä¸ºä¸­æ–‡\nRUN sed -i 's/Loading/åŠ è½½ä¸­/g' src-rsr/console.html && \\\n    # https://cabal.readthedocs.io/en/3.4/cabal-project.html#cfg-flag---jobs\n    cabal new-build --jobs=$(nproc)\nRUN build_output=../_build_output && \\\n    exec_glob=`find ./dist-newstyle/ -type f -name \"graphql-engine\"` && \\\n    mkdir $build_output && \\\n    cp \"$exec_glob\" $build_output/ && \\\n    # get-version éœ€è¦åŸºäºgitä»“åº“è·å–ç‰ˆæœ¬å·\n    ../scripts/get-version.sh >$build_output/version.txt \n\n\n## -- æå–åŸºç¡€çš„rootfs\n# docker build --progress plain -t graphql-engine-baserootfs:20201110 --target baseRootfs ./\nFROM ${packager_image} as baseRootfs\nCOPY --from=builder /app/graphql-engine/_build_output/ /root/\nRUN mkdir /rootfs/ && /build.sh graphql-engine | tar -x -C /rootfs/\n\n\n## æ„å»ºæœ€ç»ˆçš„rootfs\n# docker build --progress plain -f Dockerfile-all.dockerfile -t graphql-engine-builderrootfs:20201110 --target bulderRootfs ./\nFROM builder as bulderRootfs\nWORKDIR /app/graphql-engine/\nCOPY --from=baseRootfs /rootfs /app/graphql-engine/server/packaging/build/rootfs\n\nRUN pg_dump_ver=12 && \\\n    exec_glob=`find server/dist-newstyle/ -type f -name \"graphql-engine\"` && \\\n    build_output=./_build_output  && \\\n    packaging_dir=./server/packaging/  && \\\n    rootfs_dir=$packaging_dir/build/rootfs  && \\\n    cp $build_output/graphql-engine $rootfs_dir/bin && \\\n    # è·å–æ‰€æœ‰åŠ¨æ€é“¾æ¥åº“\n    ldd $build_output/graphql-engine | awk 'BEGIN{ORS=\"\\n\"}$1~/^\\//{print $1}$3~/^\\//{print $3}' | xargs cp -n -L --parents -t $rootfs_dir/ && \\\n    # è·å– pg_dump\n    cp /usr/lib/postgresql/$pg_dump_ver/bin/pg_dump $rootfs_dir/bin/pg_dump && \\\n    # ä¼˜åŒ–&å‹ç¼©\n    strip --strip-unneeded $rootfs_dir/bin/graphql-engine && \\\n    upx $rootfs_dir/bin/graphql-engine \n\n## - ä¸å¸¦ console-assets\n# docker build --progress plain -f Dockerfile-base.dockerfile -t graphql-engine-base:20201110 --target graphql-engine-base ./\nFROM scratch as graphql-engine-base\nCOPY --from=bulderRootfs /app/graphql-engine/server/packaging/build/rootfs/ /\nENV LANG=C.UTF-8 LC_ALL=C.UTF-8\nCMD [\"graphql-engine\", \"serve\"]\n```\n\næ„å»ºå‘½ä»¤ï¼š\n\n* **X86**\n\n  ```shell\n  builder_image=hanlyjiang/graphql-engine-builder:20201111\n  packager_image=hasura/graphql-engine-packager:20190731\n  TAG=$(date '+%Y%m%d')\n  \n  docker build ./ -t graphql-engine-base:$TAG --build-arg builder_image=\"$builder_image\" --build-arg packager_image=\"$packager_image\"\n  ```\n\n* **ARM**\n\n  ```shell\n  builder_image=hanlyjiang/graphql-engine-builder:arm-latest\n  packager_image=hanlyjiang/graphql-engine-packager:20200814\n  TAG=$(date '+%Y%m%d')\n  \n  # ARMæœºå™¨æ‰§è¡Œ\n  docker build  -t graphql-engine-base:arm-$TAG --build-arg builder_image=\"$builder_image\" --build-arg packager_image=\"$packager_image\" ./\n  \n  # x86äº¤å‰æ„å»º\n  docker buildx build --platform=linux/arm64 -t  graphql-engine-base:arm-$TAG --build-arg builder_image=\"$builder_image\" --build-arg packager_image=\"$packager_image\" ./ --load\n  ```\n\n  \n\n## graphql-engine é•œåƒæ„å»º\n\ngraphql-engine å³æ˜¯æˆ‘ä»¬æœ€ç»ˆéœ€è¦ä½¿ç”¨çš„é•œåƒï¼ŒåŒ…å«graphql-engine çš„serveråŠconsole webèµ„æºï¼›\n\n### X86\n\n```dockerfile\n### æ„å»º graphql-engine é•œåƒ\n## docker build -t graphql-engine:20201111 ./\n\n## -- æ„å»º console \n# docker build --progress plain -f Dockerfile-console.dockerfile  -t graphql-engine-consolebuilder:20201110 --target consoleBuilder ./\nFROM hanlyjiang/node-11-alpine-git:20201113 as consoleBuilder\n# æœ‰æ—¶consoleä»£ç æ›´æ–°ï¼Œæˆ‘ä»¬ç›´æ¥ä»ä»“åº“è·å–æœ€æ–°ä»£ç \n# COPY --from=builder /app/graphql-engine/console /app/console\nARG GIT_TAG=v1.3.2\nARG GIT_USER=docker-build\nARG GIT_PWD=4Kqy9Cb4FcYx2H4goiEq\nRUN git clone -b $GIT_TAG http://$GIT_USER:$GIT_PWD@172.17.0.205/dept-development/product-project/geopanel/development-center/blockdataapi-engine.git /app/graphql-engine\n\nWORKDIR /app/graphql-engine/console\n# å•ç‹¬æå–installæ­¥éª¤ä¾¿äºç¼“å­˜\nRUN set -eux ; \\\n    npm config set sass_binary_site=https://npm.taobao.org/mirrors/node-sass && \\\n    npm install --registry=https://registry.npm.taobao.org\n# RUN npm install\nRUN git pull && npm run build\n# å¼€å§‹æ„å»º\nRUN set -eux ; \\\n    CONSOLE_ASSETS_PATH=./static/assets && \\\n    DIST_PATH=./static/dist && \\\n    ls -laR $DIST_PATH && \\\n    if [ ! -d \"$CONSOLE_ASSETS_PATH/common\" ]; then \\\n\t\tmkdir -p $CONSOLE_ASSETS_PATH/common; \\\n\t\tcp -r \"$DIST_PATH/../assets/common\" \"$CONSOLE_ASSETS_PATH\"; \\\n\tfi;  \\ \n\trm -rf \"$CONSOLE_ASSETS_PATH/versioned\" && \\\n\tmkdir -p \"$CONSOLE_ASSETS_PATH/versioned\" && \\\n    cp \"$DIST_PATH\"/*.js \"$CONSOLE_ASSETS_PATH/versioned/\" && \\\n\tgzip -f $CONSOLE_ASSETS_PATH/versioned/*.js && \\\n    # console æ‰“åŒ…æ–¹å¼ä¸­å¯èƒ½å°†cssæ”¾ç½®åˆ°jsä¸­ï¼Œè¿™é‡Œä¸å¼ºåˆ¶è¦æ±‚æœ‰cssæ–‡ä»¶ç”Ÿæˆ\n    cp \"$DIST_PATH\"/*.css \"$CONSOLE_ASSETS_PATH/versioned/\" || true && \\\n    gzip -f $CONSOLE_ASSETS_PATH/versioned/*.css || true\n\n## -- æ„å»ºæœ€ç»ˆé•œåƒ\n# docker build --progress plain -t graphql-engine:20201110 ./\nFROM zh-registry.geostar.com.cn/geopanel/graphql-engine-base:20201123\nLABEL maintainer=\"jianghanghang@geostar.com.cn\"\nCOPY --from=consoleBuilder /app/graphql-engine/console/static/assets /srv/console-assets\n\nCOPY docker-entrypoint.sh /usr/local/bin/\nRUN chmod +x /usr/local/bin/docker-entrypoint.sh \\\n    && ln -s usr/local/bin/docker-entrypoint.sh /\n\nENTRYPOINT [\"docker-entrypoint.sh\"]\n```\n\næ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æ„å»ºï¼š\n\n```shell\nTAG=$(date '+%Y%m%d')\ndocker build -t graphql-engine:$TAG ./\n```\n\n\n\n### ARM\n\n```dockerfile\n### æ„å»º graphql-engine é•œåƒ\n## docker build  -f Dockerfile-arm.dockerfile -t graphql-engine:20201113 ./\n## docker buildx build --platform=linux/arm64  -f Dockerfile-arm.dockerfile -t graphql-engine:arm-20201113 ./ --load\n\n## -- æ„å»º console \n# docker buildx build --platform=linux/arm64 --progress plain -f Dockerfile-console.dockerfile  -t graphql-engine-consolebuilder:20201110 --target consoleBuilder ./  --load\nFROM hanlyjiang/node-11-alpine-git:20201113 as consoleBuilder\n# æœ‰æ—¶consoleä»£ç æ›´æ–°ï¼Œæˆ‘ä»¬ç›´æ¥ä»ä»“åº“è·å–æœ€æ–°ä»£ç \n# COPY --from=builder /app/graphql-engine/console /app/console\nARG GIT_TAG=v1.3.2\nARG GIT_USER=docker-build\nARG GIT_PWD=4Kqy9Cb4FcYx2H4goiEq\nRUN git clone -b $GIT_TAG http://$GIT_USER:$GIT_PWD@172.17.0.205/dept-development/product-project/geopanel/development-center/blockdataapi-engine.git /app/graphql-engine\n\nWORKDIR /app/graphql-engine/console\n# å•ç‹¬æå–installæ­¥éª¤ä¾¿äºç¼“å­˜\nRUN npm install --registry=https://registry.npm.taobao.org\nRUN npm run build \n# å¼€å§‹æ„å»º\nRUN set -eux ; \\\n    CONSOLE_ASSETS_PATH=./static/assets && \\\n    DIST_PATH=./static/dist && \\\n    ls -laR $DIST_PATH && \\\n    if [ ! -d \"$CONSOLE_ASSETS_PATH/common\" ]; then \\\n\t\tmkdir -p $CONSOLE_ASSETS_PATH/common; \\\n\t\tcp -r \"$DIST_PATH/../assets/common\" \"$CONSOLE_ASSETS_PATH\"; \\\n\tfi;  \\ \n\trm -rf \"$CONSOLE_ASSETS_PATH/versioned\" && \\\n\tmkdir -p \"$CONSOLE_ASSETS_PATH/versioned\" && \\\n    cp \"$DIST_PATH\"/*.js \"$CONSOLE_ASSETS_PATH/versioned/\" && \\\n\tgzip -f $CONSOLE_ASSETS_PATH/versioned/*.js && \\\n    # console æ‰“åŒ…æ–¹å¼ä¸­å¯èƒ½å°†cssæ”¾ç½®åˆ°jsä¸­ï¼Œè¿™é‡Œä¸å¼ºåˆ¶è¦æ±‚æœ‰cssæ–‡ä»¶ç”Ÿæˆ\n    cp \"$DIST_PATH\"/*.css \"$CONSOLE_ASSETS_PATH/versioned/\" || true && \\\n    gzip -f $CONSOLE_ASSETS_PATH/versioned/*.css || true\n\n## -- æ„å»ºæœ€ç»ˆé•œåƒ\n# docker buildx build --platform=linux/arm64  --progress plain -t graphql-engine:20201110 ./  --load\nFROM zh-registry.geostar.com.cn/geopanel/graphql-engine-base:arm-v1.3.2\nLABEL maintainer=\"jianghanghang@geostar.com.cn\"\nCOPY --from=consoleBuilder /app/graphql-engine/console/static/assets /srv/console-assets\n# COPY --from=zh-registry.geostar.com.cn/geopanel/graphql-engine:v1.3.2 /srv/console-assets /srv/console-assets\n\nCOPY docker-entrypoint.sh /usr/local/bin/\nRUN chmod +x /usr/local/bin/docker-entrypoint.sh \\\n    && ln -s usr/local/bin/docker-entrypoint.sh /\n\nENTRYPOINT [\"docker-entrypoint.sh\"]\n\n```\n\næ„å»ºå‘½ä»¤ï¼š\n\n```shell\nTAG=$(date '+%Y%m%d')\ndocker build  -f Dockerfile-arm.dockerfile -t graphql-engine:$TAG ./\ndocker buildx build --platform=linux/arm64  -f Dockerfile-arm.dockerfile -t graphql-engine:arm-$TAG ./ --load\n```\n\n\n\n### æ„å»ºè„šæœ¬ç®€åŒ–(æœªéªŒè¯)\n\n```dockerfile\n### æ„å»º graphql-engine é•œåƒ\n## docker build  -f Dockerfile-arm.dockerfile -t graphql-engine:20201113 ./\n## docker buildx build --platform=linux/arm64  -f Dockerfile-arm.dockerfile -t graphql-engine:arm-20201113 ./ --load\n\nARG base_image\n\n## -- æ„å»º console \n# docker buildx build --platform=linux/arm64 --progress plain -f Dockerfile-console.dockerfile  -t graphql-engine-consolebuilder:20201110 --target consoleBuilder ./  --load\nFROM hanlyjiang/node-11-alpine-git:20201113 as consoleBuilder\n# æœ‰æ—¶consoleä»£ç æ›´æ–°ï¼Œæˆ‘ä»¬ç›´æ¥ä»ä»“åº“è·å–æœ€æ–°ä»£ç \n# COPY --from=builder /app/graphql-engine/console /app/console\nARG GIT_TAG=v1.3.2\nARG GIT_USER=docker-build\nARG GIT_PWD=4Kqy9Cb4FcYx2H4goiEq\nRUN git clone -b $GIT_TAG http://$GIT_USER:$GIT_PWD@172.17.0.205/dept-development/product-project/geopanel/development-center/blockdataapi-engine.git /app/graphql-engine\n\nWORKDIR /app/graphql-engine/console\n# å•ç‹¬æå–installæ­¥éª¤ä¾¿äºç¼“å­˜\nRUN npm install --registry=https://registry.npm.taobao.org\nRUN npm run build \n# å¼€å§‹æ„å»º\nRUN set -eux ; \\\n    CONSOLE_ASSETS_PATH=./static/assets && \\\n    DIST_PATH=./static/dist && \\\n    ls -laR $DIST_PATH && \\\n    if [ ! -d \"$CONSOLE_ASSETS_PATH/common\" ]; then \\\n\t\tmkdir -p $CONSOLE_ASSETS_PATH/common; \\\n\t\tcp -r \"$DIST_PATH/../assets/common\" \"$CONSOLE_ASSETS_PATH\"; \\\n\tfi;  \\ \n\trm -rf \"$CONSOLE_ASSETS_PATH/versioned\" && \\\n\tmkdir -p \"$CONSOLE_ASSETS_PATH/versioned\" && \\\n    cp \"$DIST_PATH\"/*.js \"$CONSOLE_ASSETS_PATH/versioned/\" && \\\n\tgzip -f $CONSOLE_ASSETS_PATH/versioned/*.js && \\\n    # console æ‰“åŒ…æ–¹å¼ä¸­å¯èƒ½å°†cssæ”¾ç½®åˆ°jsä¸­ï¼Œè¿™é‡Œä¸å¼ºåˆ¶è¦æ±‚æœ‰cssæ–‡ä»¶ç”Ÿæˆ\n    cp \"$DIST_PATH\"/*.css \"$CONSOLE_ASSETS_PATH/versioned/\" || true && \\\n    gzip -f $CONSOLE_ASSETS_PATH/versioned/*.css || true\n\n## -- æ„å»ºæœ€ç»ˆé•œåƒ\n# docker buildx build --platform=linux/arm64  --progress plain -t graphql-engine:20201110 ./  --load\nFROM ${base_image}\nLABEL maintainer=\"jianghanghang@geostar.com.cn\"\nCOPY --from=consoleBuilder /app/graphql-engine/console/static/assets /srv/console-assets\n# COPY --from=zh-registry.geostar.com.cn/geopanel/graphql-engine:v1.3.2 /srv/console-assets /srv/console-assets\n\nCOPY docker-entrypoint.sh /usr/local/bin/\nRUN chmod +x /usr/local/bin/docker-entrypoint.sh \\\n    && ln -s usr/local/bin/docker-entrypoint.sh /\n\nENTRYPOINT [\"docker-entrypoint.sh\"]\n```\n\n* x86æ„å»ºï¼š\n\n  ```shell\n  base_image=zh-registry.geostar.com.cn/geopanel/graphql-engine-base:20201123\n  \n  TAG=$(date '+%Y%m%d')\n  \n  docker build ./ -t graphql-engine-base:$TAG --build-arg base_image=\"$base_image\" --build-arg \n  ```\n\n  \n\n* armæ„å»º\n\n  ```shell\n  base_image=zh-registry.geostar.com.cn/geopanel/graphql-engine-base:arm-v1.3.2\n  \n  TAG=$(date '+%Y%m%d')\n  \n  # arm æœºå™¨ç›´æ¥æ„å»º\n  docker build ./ -t graphql-engine:arm-$TAG --build-arg base_image=\"$base_image\" --build-arg \n  \n  \n  # x86äº¤å‰æ„å»º\n  docker buildx build --platform=linux/arm64 -t  graphql-engine:arm-$TAG --build-arg base_image=\"$base_image\" ./ --load\n  ```\n\n\n\n# GeoPanelå®¹å™¨åŒ–-è‡ªç ”æœåŠ¡é•œåƒæ„å»º\n\n## å‰è¨€\n\næ‰€æœ‰å½“å‰å·²ç»æ„å»ºçš„æœåŠ¡ï¼Œéƒ½å¯ä»¥é€šè¿‡[gepanel-deploy ä»“åº“ä¸­çš„readme](http://172.17.0.205/dept-development/product-project/geopanel/geopanel-deploy/-/blob/master/README.md)è¿›è¡Œå¿«é€Ÿå¯¼èˆªï¼Œå¦‚ï¼š\n\n<img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210319162128.png\" alt=\"image-20210319162127913\" style=\"zoom: 50%;\" />\n\n## blockapi-token æœåŠ¡é•œåƒæ„å»º\n\né•œåƒæ„å»ºçš„ç›¸å…³æ–‡ä»¶ç›®å½•ä½äº [gitlabæ­¤è·¯å¾„](http://zh-gitlab.geostar.com.cn/dept-development/product-project/geopanel/development-center/blockdataapi-engine/-/tree/v1.3.2/docker/hasura-token)ï¼Œå…·ä½“æ„å»ºæ—¶æ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š\n\n1. **ç‹å³°**æä¾›æˆå“jaråŒ…ï¼›\n2. æ”¾ç½®åˆ°æ­¤ç›®å½•æ‰§è¡Œdocker buildx build å‘½ä»¤æ‰“åŒ…ï¼›\n\nç”±äºå…¶dockerfileéå¸¸ç®€å•ï¼Œæ‰€ä»¥åœ¨æ­¤ä¸å†è§£é‡Šï¼Œå¯ç›´æ¥æŸ¥çœ‹gitlabä¸­å¯¹åº”çš„ï¼š\n\n* [dockerfile](http://172.17.0.205/dept-development/product-project/geopanel/development-center/blockdataapi-engine/-/blob/v1.3.2/docker/hasura-token/Dockerfile)\n* [æ‰“åŒ…åŠä½¿ç”¨æ–¹å¼](http://172.17.0.205/dept-development/product-project/geopanel/development-center/blockdataapi-engine/-/blob/v1.3.2/docker/hasura-token/README.md)\n\n\n\n## blockapi-db-integrate æœåŠ¡é•œåƒæ„å»º\n\næ•°æ®åº“é›†æˆæœåŠ¡çš„é•œåƒæ„å»ºç›¸å…³æ–‡ä»¶ä½äº [gitlabæ­¤è·¯å¾„](http://zh-gitlab.geostar.com.cn/dept-development/product-project/geopanel/FusionCenter/integrate-db/-/tree/dev/docker) ï¼Œå…·ä½“æ„å»ºæ—¶æ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š\n\n1. **éŸ©å°ä¹** æä¾›æˆå“jaræˆ–è€…æˆ‘ä»¬è‡ªè¡Œä»[æºç ](http://zh-gitlab.geostar.com.cn/dept-development/product-project/geopanel/FusionCenter/integrate-db/-/tree/dev)ç¼–è¯‘jarï¼›\n2. æ”¾ç½®åˆ°dockeræ„å»ºç›®å½•ä½¿ç”¨docker buildx buildå‘½ä»¤æ„å»ºï¼›\n\nç”±äºå…¶dockerfileéå¸¸ç®€å•ï¼Œæ‰€ä»¥åœ¨æ­¤ä¸å†è§£é‡Šï¼Œå¯ç›´æ¥æŸ¥çœ‹gitlabä¸­å¯¹åº”çš„ï¼š\n\n* [dockerfile](http://172.17.0.205/dept-development/product-project/geopanel/FusionCenter/integrate-db/-/blob/dev/docker/Dockerfile)\n* [æ‰“åŒ…åŠä½¿ç”¨æ–¹å¼](http://172.17.0.205/dept-development/product-project/geopanel/FusionCenter/integrate-db/-/blob/dev/docker/README.md)\n\n\n\n## blockapi-restapi æœåŠ¡é•œåƒæ„å»º\n\nç”±äºä¹‹å‰æœ‰å®Œæˆè¿‡ï¼Œåœ¨æ­¤ä¸åœ¨å™è¿°ï¼Œå¯å‚è€ƒ [æ­¤gitlabç›®å½•](http://zh-gitlab.geostar.com.cn/dept-development/product-project/geopanel/FusionCenter/rest-api/-/tree/master/docker)\n\n\n\n## gpl-datacollection æœåŠ¡é•œåƒæ„å»º\n\nåŸ‹ç‚¹ç³»ç»ŸæœåŠ¡é•œåƒçš„æ„å»ºæ–‡ä»¶ä½äº [gitlabæ­¤è·¯å¾„](http://zh-gitlab.geostar.com.cn/dept-development/product-project/geopanel/development-center/event-tracking-manager-system/-/tree/develop/docker) ï¼Œå…·ä½“æ„å»ºæ—¶æ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š\n\n1. **ç‹å³°** æä¾›æˆå“jarï¼›\n2. æ”¾ç½®åˆ°dockeræ„å»ºç›®å½•ä½¿ç”¨ docker buildx buildå‘½ä»¤æ„å»ºï¼›\n\nç”±äºå…¶dockerfileéå¸¸ç®€å•ï¼Œæ‰€ä»¥åœ¨æ­¤ä¸å†è§£é‡Šï¼Œå¯ç›´æ¥æŸ¥çœ‹gitlabä¸­å¯¹åº”çš„ï¼š\n\n* [dockerfile](http://172.17.0.205/dept-development/product-project/geopanel/development-center/event-tracking-manager-system/-/blob/develop/docker/Dockerfile)\n* [æ‰“åŒ…åŠä½¿ç”¨æ–¹å¼](http://172.17.0.205/dept-development/product-project/geopanel/development-center/event-tracking-manager-system/-/blob/develop/docker/README.md)\n\n\n\n\n\n# GeoPanelå®¹å™¨åŒ–-æœåŠ¡ç¼–æ’\n\n## é•œåƒå­˜å‚¨åŠåˆ†å‘ç®¡ç†\n\n<img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210323092448.png\" alt=\"geopanel-registrys\" style=\"zoom: 40%;\" />\n\n1. harbor ä¸ºå†…ç½‘åŸºäº [harbor](https://goharbor.io/) æ­å»ºçš„ç§æœ‰docker registry;\n2. å¯¹äºè‡ªè¡Œæ„å»ºçš„é•œåƒï¼Œæˆ‘ä»¬åªéœ€è¦å°†é•œåƒæ¨é€åˆ°harborï¼Œæ ¹æ®é…ç½®å¥½çš„è‡ªåŠ¨å¤åˆ¶è§„åˆ™ï¼Œé•œåƒä¼šè‡ªåŠ¨åŒæ­¥åˆ°é˜¿é‡Œäº‘ç§æœ‰dockeré•œåƒä»“åº“ï¼Œä¹‹åè¯¥é•œåƒå³å¯ä»é˜¿é‡Œäº‘é•œåƒä»“åº“æ‹‰å–ï¼›\n3. harborä»“åº“å¯ä½¿ç”¨åŸŸè´¦å·è¿›è¡Œç™»å½•ï¼ŒæŒ‰é¡¹ç›®è¿›è¡Œè¯»å†™æƒé™æ§åˆ¶ï¼›   \n4. é˜¿é‡Œäº‘çš„ç§æœ‰é•œåƒä»“åº“å¼€æ”¾ä¸€ä¸ªå…¬ç”¨çš„åªè¯»è´¦å·ï¼Œä¸æ¥å—æ‰‹åŠ¨é•œåƒæ¨é€ï¼›   \n5. å®é™…éƒ¨ç½²æ—¶ï¼Œå¯æ ¹æ®ç°åœºçš„ç½‘ç»œæƒ…å†µï¼Œé€‰æ‹©ä½¿ç”¨å…¬å¸ä»“åº“/é˜¿é‡Œäº‘ä»“åº“åœ¨çº¿æ‹‰å–ï¼Œæˆ–è€…ä½¿ç”¨é•œåƒæ‰¹é‡å¯¼å‡ºè„šæœ¬æ‰¹é‡å¯¼å‡ºé•œåƒæ–‡ä»¶ï¼Œè¿›è¡Œç¦»çº¿éƒ¨ç½²ï¼›\n\n\n\n## GeoPanelæœåŠ¡ååŠå˜é‡å‘½åçº¦å®š\n\n### è‡ªæœ‰æœåŠ¡å‘½åçº¦å®š   \n\nè§„èŒƒæœåŠ¡å‘½åèƒ½æ–¹ä¾¿æ ‡è¯†æœåŠ¡ä¹‹é—´çš„é€»è¾‘å…³ç³»ï¼Œå¯¹åº”çš„æœåŠ¡å‘½åä¼šåæ˜ åˆ°é›†ç¾¤éƒ¨ç½²ä¸­æœåŠ¡çš„åç§°ï¼ŒæœåŠ¡ä¸­æ¥å£/é¡µé¢çš„åŸºç¡€åœ°å€ï¼ŒæœåŠ¡ç›¸å…³çš„é…ç½®å˜é‡ã€‚\n\n* æœåŠ¡ä¸­åº”åŒ…å«æœåŠ¡æ‰€å±çš„æ¨¡å—å†…å®¹ç¼©å†™ï¼Œå¦‚å—æ•°æ®apiå¼•æ“ä¸ºblockapiï¼›\n* æœåŠ¡çš„å®¹å™¨ç¼–æ’åç§°ï¼Œé•œåƒåç§°ï¼ŒæœåŠ¡çš„åŸºç¡€æœåŠ¡åœ°å€ï¼ŒæœåŠ¡åœ¨æ•´ä¸ªé›†ç¾¤ä¸­çš„å¯¼å…¥æˆ–å¯¼å‡ºçš„é…ç½®å˜é‡åç§°å‡åº”ä¿æŒä¸€è‡´æ€§ï¼›\n\nç›®å‰æœ‰å¦‚ä¸‹å‡ ä¸ªä¸»è¦æœåŠ¡å•å…ƒï¼š\n\n#### **å½“å‰é›†ç¾¤æœåŠ¡å‘½å**\n\n| æœåŠ¡             | å‘½åè¯´æ˜                                                     |\n| ---------------- | ------------------------------------------------------------ |\n| å—æ•°æ®APIå¼•æ“    | å‘½åä¸º blockapi ï¼ŒåŒ…å«ä»¥ä¸‹æœåŠ¡ï¼š<br/>1. `blockapi` : å—æ•°æ®apiå¼•æ“æœåŠ¡ï¼ˆåŸºç¡€hasura graphqlå¼•æ“ï¼‰<br/>2. `blockapi-token`: å—æ•°æ®apiå¼•æ“æ‰©å±•æ¨¡å—-tokenç®¡ç†service <br/>3. `blockapi-db-integrate`ï¼šå—æ•°æ®apiå¼•æ“æ‰©å±•æ¨¡å—-æ•°æ®åº“é›†æˆservice <br/>4. `blockapi-restapi`: å—æ•°æ®apiå¼•æ“æ‰©å±•æ¨¡å—-restapi service |\n| åŸ‹ç‚¹æ—¥å¿—ç®¡ç†ç³»ç»Ÿ | å‘½å ï¼š `gpl-data-collection`                                |\n\n#### **å½“å‰å„æœåŠ¡æ¥å£/webç•Œé¢åŸºç¡€åœ°å€ï¼š**\n\n| æœåŠ¡                  | åŸºç¡€åœ°å€             | ç¤ºä¾‹                                                         |\n| --------------------- | -------------------- | ------------------------------------------------------------ |\n| blockapi              | -                    | ä¿æŒå’Œå¼€æºç‰ˆæœ¬graphql-engineä¸€è‡´                             |\n| blockapi-token        | /block-api/tks       | http://192.168.43.73:8881/block-api/tks                      |\n| blockapi-db-integrate | /block-api/db-intgrs | http://192.168.43.73:8882/block-api/db-intgrs                |\n| blockapi-restapi      | /block-api/restapi   | [http://172.17.0.105:8884/block-api/restapi](http://172.17.0.105:8884/block-api/restapi) |\n| gpl-data-collection   | /gpl-dc              | http://192.168.43.73:8883/gpl-dc                             |\n\n### é€šç”¨å˜é‡è¯´æ˜\n\n#### æ¦‚è¿°\n\nåœ¨æœåŠ¡éƒ¨ç½²æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ç¯å¢ƒå˜é‡æ¥ä¸ºå„ä¸ªæœåŠ¡æä¾›éœ€è¦çš„é…ç½®ï¼Œä»¥ä¸‹é€šç”¨å˜é‡ç”¨äºå‡å°‘æœåŠ¡éƒ¨ç½²æ—¶æ‰€éœ€è¦çš„å˜é‡ï¼Œå¤§è‡´æŒ‰ä»¥ä¸‹åŸåˆ™ï¼š\n\n* ç›¸åŒå«ä¹‰çš„å˜é‡å°½é‡ç»Ÿä¸€ä¸ºä¸€ä¸ª\n* æœ‰å¯èƒ½å†…éƒ¨å’Œå¤–éƒ¨ç”¨é€”çš„æœåŠ¡ä½¿ç”¨ä¸¤ä¸ªå˜é‡åŒºåˆ†å¼€æ¥\n* å˜é‡å‘½åéœ€è¦å¸¦ä¸ŠæœåŠ¡åå‰ç¼€\n\n> **å¤–éƒ¨URLå’Œå†…éƒ¨URLè¯´æ˜ï¼šï¼ˆä¸‹æ–¹éƒ¨åˆ†æœåŠ¡ä¼šå¯¼å‡ºå†…éƒ¨å’Œå¤–éƒ¨ä¸¤ä¸ªurlçš„å˜é‡ï¼‰**\n>\n> * **å†…éƒ¨URL**ï¼šåœ¨dockeré›†ç¾¤å†…éƒ¨ï¼Œå¯ä»¥ä½¿ç”¨æœåŠ¡åæ›¿ä»£IPåœ°å€è®¿é—®å¯¹åº”çš„æœåŠ¡ï¼Œä¸€èˆ¬ç”¨äºæœåŠ¡å†…éƒ¨ä¹‹é—´äº’ç›¸è®¿é—®ï¼›ï¼ˆå¦‚ä½¿ç”¨å†…éƒ¨URLï¼Œåœ¨éƒ¨ç½²æ—¶å¯ä¸éœ€è¦ä¿®æ”¹é…ç½®ï¼‰\n> * **å¤–éƒ¨URL**ï¼šå½“æœåŠ¡éœ€è¦ç»™å®¢æˆ·ç«¯ï¼ˆå¦‚APPæˆ–æµè§ˆå™¨ï¼‰æˆ–ä¸å±äºæˆ‘æ–¹æœåŠ¡é›†ç¾¤çš„å…¶ä»–æœåŠ¡è°ƒç”¨æ—¶ï¼Œéœ€è¦æä¾›å¤–éƒ¨çš„IPï¼ˆédockeré›†ç¾¤å†…éƒ¨ï¼‰ç»™å¤–éƒ¨è®¿é—®ï¼›\n\n| **æœåŠ¡**              | **å˜é‡å**                                                   | è¯´æ˜åŠç¤ºä¾‹å€¼                                                 | **springbootå˜é‡å**                      |\n| :-------------------- | :----------------------------------------------------------- | :----------------------------------------------------------- | ----------------------------------------- |\n| postgres              |                                                              |                                                              |                                           |\n| zookeeper             |                                                              | æš‚æœªä¾›å¤–éƒ¨ä½¿ç”¨ï¼Œä¸å¯¼å‡ºå˜é‡                                   |                                           |\n| kafka                 | *kafka å†…éƒ¨åœ°å€*<br/>`KAFKA_INTERNAL_URL`                    | kafka:9092                                                   | kafka.internal_url                        |\n|                       | *kafka å¤–éƒ¨åœ°å€*<br/>`KAFKA_EXTERNAL_URL`                    | 192.168.43.22:9094                                           | kafka.external_url                        |\n| redis                 | RedisæœåŠ¡ä¸»æœº<br/>`REDIS_HOST`                               | redis                                                        | redis.host                                |\n|                       | RedisæœåŠ¡ç«¯å£<br/>`REDIS_PORT`                               | 6379                                                         | redis.port                                |\n|                       | RedisæœåŠ¡è®¿é—®å¯†ç <br/>`REDIS_PASSWORD`                       | vsMEDgmxZdjOi7Nd                                             | redis.password                            |\n| blockapi              | å—æ•°æ®APIå¼•æ“æ•°æ®åº“åœ°å€<br/>`HASURA_GRAPHQL_DATABASE_URL`<br/>`BLOCKAPI_DATABASE_URL` | postgres://postgres:<br/>d8cfe3137214759a932014084ac410b9<br/>@postgres:5432/hasura | blockapi.database_url                     |\n|                       | å—æ•°æ®APIå¼•æ“ç®¡ç†å¯†é’¥<br/>`HASURA_GRAPHQL_ADMIN_SECRET`<br/>`BLOCKAPI_ADMIN_SECRET` | d8cfe3137214759a932014084ac410b9<br/>ä¸¤ä¸ªå˜é‡å«ä¹‰ä¸€è‡´ï¼Œä¼˜å…ˆä½¿ç”¨ BLOCKAPI_ADMIN_SECRET | blockapi.admin_secert                     |\n|                       | å—æ•°æ®APIå¼•æ“å†…éƒ¨åœ°å€<br/>`BLOCKAPI_INTERNAL_URL`            | `http://graphql-engine:8080`                                 | blockapi.internal_url                     |\n|                       | å—æ•°æ®APIå¼•æ“çš„å¤–éƒ¨åœ°å€<br>`BLOCKAPI_EXTERNAL_URL`           | `http://192.168.43.22:8883`                                  | blockapi.external_url                     |\n| blockapi-token<br>    | å—æ•°æ®APIå¼•æ“tokenç®¡ç†æœåŠ¡å†…éƒ¨æ¥å£åœ°å€<br>`BLOCKAPI_TOKEN_INTERNAL_URL` | http://blockapi-token:9099/block-api/tks                     | blockapi.token.internal_url               |\n|                       | å—æ•°æ®APIå¼•æ“tokenç®¡ç†æœåŠ¡å¤–éƒ¨æ¥å£åœ°å€<br>`BLOCKAPI_TOKEN_EXTERNAL_URL` | http://192.168.43.73:8881/block-api/tks                      | blockapi.token.external_url               |\n| blockapi-db-integrate | å—æ•°æ®APIå¼•æ“æ•°æ®åº“é›†æˆæœåŠ¡å¤–éƒ¨æ¥å£åœ°å€<br>`BLOCKAPI_DATABASE_INTEGRATE_EXTERNAL_URL` | http://192.168.43.73:8882/block-api/db-intgrs                | blockapi.database_intergrate.external_url |\n| gpl-data-collection   | åŸ‹ç‚¹ç³»ç»ŸæœåŠ¡åœ°å€ï¼Œæš‚æœªä¾›å¤–éƒ¨ä½¿ç”¨ï¼Œä½†æä¾›é¢„å®šä¹‰2ä¸ªå˜é‡<br>`GPL_DATACOLLECTION_INTERNAL_URL` |                                                              | gpl_datacollection.internal_url           |\n|                       | `GPL_DATACOLLECTION_EXTERNAL_URL`                            |                                                              | gpl_datacollection.external_url           |\n\n#### åœ¨springbootä¸­ä½¿ç”¨å˜é‡\n\n> å¾…è¡¥å……\n\n\n\n## å½“å‰æœåŠ¡ç¼–æ’ç­–ç•¥\n\nå½“å‰å°†æ‰€æœ‰å·²ç»å®¹å™¨åŒ–çš„æœåŠ¡åˆ’åˆ†ä¸ºå¦‚ä¸‹æœåŠ¡éƒ¨ç½²å•å…ƒï¼š\n\n```mermaid\ngraph LR\n\nG[GeoPanel] --> B\n\nG --> K\n\nG --> GPL_DC\n\nB[blockapi] --> blockapi-engine\nB --> postgres\nB --> redis\nB --> blockapi-token\nB --> blockapi-db-integrate\nB --> blockapi-restapi\n\nK[kafka] --> kafka\nK --> zookeeper\n\nGPL_DC[gpl-datacollection] --> gpl-datacollection\n```\n\nç›®å‰åˆ†ä¸ºä¸‰å—ï¼ˆblockapiï¼Œkafkaï¼Œgpl-datacollectionï¼‰ï¼Œæ¯ä¸ªæ¨¡å—åˆ†åˆ«å¯¹åº”ä¸€ä¸ªswarmçš„éƒ¨ç½²ymlé…ç½®ï¼Œå¯ä»¥å•ç‹¬è¿›è¡Œå¯åŠ¨ï¼Œä½¿ç”¨ç›¸åŒçš„stackåç§°å¯åŠ¨åï¼Œåˆ™å¯ä»¥è¿›å…¥ä¸€ä¸ªstackä¸­ï¼›\n\néƒ¨ç½²ä»“åº“åœ°å€ä½äº[gitlabä¸Š](http://zh-gitlab.geostar.com.cn/dept-development/product-project/geopanel/geopanel-deploy)ã€‚\n\n## å½“å‰éƒ¨ç½²ä»“åº“ç»†èŠ‚è¯´æ˜\n\n```shell\n.\nâ”œâ”€â”€ README.md -- æ–‡æ¡£è¯´æ˜\nâ”œâ”€â”€ blockapi -- å—æ•°æ®apiå¼•æ“çš„éƒ¨ç½²é…ç½®æ‰€åœ¨ç›®å½•\nâ”‚Â Â  â”œâ”€â”€ README.md -- å—æ•°æ®apiå¼•æ“çš„é…ç½®åŠå¯åŠ¨è¯´æ˜æ–‡æ¡£\nâ”‚Â Â  â”œâ”€â”€ config.env -- å•ç‹¬çš„é…ç½®æ–‡ä»¶ï¼Œç›®å‰æœªä½¿ç”¨\nâ”‚Â Â  â”œâ”€â”€ db-init - æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ï¼Œä»…åšå¤‡ä»½ï¼Œç›®å‰æœªä½¿ç”¨\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ 00_fdws.sh\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ 10_postgis.sh\nâ”‚Â Â  â”‚Â Â  â””â”€â”€ 20_gpl_data_collection.sql\nâ”‚Â Â  â”œâ”€â”€ docker-compose-arm.yml -- armç‰ˆæœ¬çš„éƒ¨ç½²é…ç½®æ–‡ä»¶\nâ”‚Â Â  â”œâ”€â”€ docker-compose.yml -- x86ç‰ˆæœ¬çš„éƒ¨ç½²é…ç½®æ–‡ä»¶\nâ”‚Â Â  â””â”€â”€ redis-config -- redis é…ç½®\nâ”‚Â Â      â””â”€â”€ redis.conf\nâ”œâ”€â”€ data -- æ•°æ®æŒ‚è½½ç›®å½•\nâ”‚Â Â  â””â”€â”€ redis\nâ”œâ”€â”€ deploy.sh -- è¾…åŠ©éƒ¨ç½²è„šæœ¬\nâ”œâ”€â”€ env -- å…¨å±€é…ç½®ç›®å½•\nâ”‚Â Â  â””â”€â”€ global.env -- å…¨å±€é…ç½®ï¼ŒåŒ…å«æ‰€æœ‰é…ç½®é¡¹ç›®ï¼Œå¦‚å¯èƒ½æœ‰éœ€è¦ä½¿ç”¨å…¬å…±é…ç½®çš„ï¼ŒæœåŠ¡éƒ½åº”è¯¥åœ¨ymlä¸­å£°æ˜æ—¶å¼•ç”¨æ­¤é…ç½®\nâ”œâ”€â”€ gpl-datacollection -- åŸ‹ç‚¹ç®¡ç†ç³»ç»Ÿéƒ¨ç½²é…ç½®ç›®å½•\nâ”‚Â Â  â”œâ”€â”€ README.md -- åŸ‹ç‚¹ç³»ç»Ÿçš„é…ç½®ä¿®æ”¹åŠå¯åŠ¨æ–¹å¼è¯´æ˜æ–‡æ¡£\nâ”‚Â Â  â”œâ”€â”€ config.env -- åŸ‹ç‚¹ç³»ç»Ÿçš„å•ç‹¬çš„é…ç½®æ–‡ä»¶ï¼Œç›®å‰æœªä½¿ç”¨\nâ”‚Â Â  â””â”€â”€ docker-compose.yml --åŸ‹ç‚¹ç³»ç»Ÿçš„éƒ¨ç½²å¯åŠ¨é…ç½®æ–‡ä»¶\nâ”œâ”€â”€ kafka -- kafkaçš„éƒ¨ç½²é…ç½®ç›®å½•\nâ”‚Â Â  â”œâ”€â”€ README.md -- kafkaæœåŠ¡è¯´æ˜ï¼ŒkafkaéªŒè¯æ–¹å¼è¯´æ˜\nâ”‚Â Â  â””â”€â”€ docker-compose.yml -- éƒ¨ç½²é…ç½®æ–‡ä»¶\n```\n\næ€»çš„æ¥è¯´ï¼Œç›®å‰æœ‰å¦‚ä¸‹ç»“æ„è®¾è®¡ï¼š\n\n1. æŒ‰é€»è¾‘ç›¸å…³æ€§å°†æœåŠ¡è¿›è¡Œä¸€å®šçš„åˆ’åˆ†ï¼Œä¸€ä¸ªå•å…ƒçš„æœåŠ¡çš„éƒ¨ç½²ç›¸å…³æ–‡ä»¶åŠé…ç½®åœ¨ä¸€ä¸ªéƒ¨ç½²ç›®å½•ä¸­å•ç‹¬å­˜å‚¨ï¼Œä½¿ç”¨ä¸€ä¸ªdocker-compose.ymlæ–‡ä»¶æ¥ç¼–æ’ï¼Œå¯ä»¥å•ç‹¬å¯åŠ¨ï¼›\n2. ä½¿ç”¨ä¸€ä¸ª `env/global.env` æ–‡ä»¶æ¥å­˜æ”¾æ‰€æœ‰éœ€è¦ä¿®æ”¹çš„é…ç½®åŠå…¨å±€é…ç½®/éœ€è¦å…±äº«çš„é…ç½®-ä»¥æ–¹ä¾¿éƒ¨ç½²æ—¶ç»Ÿä¸€ä¿®æ”¹ï¼Œæ¯ä¸ªéƒ¨ç½²å•å…ƒä¸­é¢„ç•™ä¸€ä¸ª`.env`æ–‡ä»¶-ç”¨äºå­˜æ”¾ç§æœ‰é…ç½®ï¼Œåªæ˜¯ç›®å‰éƒ½æ²¡æœ‰ä½¿ç”¨ï¼›\n3. æä¾›äº†ä¸€ä¸ª `deploy.sh` çš„è¾…åŠ©éƒ¨ç½²è„šæœ¬ç”¨äºç®€åŒ–éƒ¨ç½²æ­¥éª¤ï¼Œä½†æ­¤è„šæœ¬ç›®å‰å¹¶ä¸å¤Ÿå®Œå–„ï¼›\n4. æ¯ä¸ªéƒ¨ç½²ç›®å½•æä¾›README.mdå•ç‹¬å¯¹å½“å‰ç›®å½•ä¸­çš„éƒ¨ç½²å•å…ƒè¿›è¡Œè¯´æ˜ï¼Œä¸€èˆ¬åº”åŒ…å«é…ç½®ä¿®æ”¹è¯´æ˜ï¼Œéƒ¨ç½²å¯åŠ¨è¯´æ˜ï¼Œå¯åŠ¨æˆåŠŸç¡®è®¤æ–¹å¼ï¼Œæ•°æ®æŒ‚è½½æƒ…å†µè¯´æ˜ï¼Œæ ¹æ®å…·ä½“æƒ…å†µä¹Ÿå¯ä»¥æä¾›ç®€å•çš„æµ‹è¯•æ­¥éª¤ï¼›\n\n> å¯¹äºå„ä¸ªéƒ¨ç½²å•å…ƒçš„éƒ¨ç½²æ–‡ä»¶ï¼Œä¸å†å•ç‹¬è¯´æ˜ï¼Œè¯·å‚è€ƒä»“åº“ä¸­çš„ymléƒ¨ç½²æ–‡ä»¶åŠreadme\n\n\n\n\n",
      "data": {
        "title": "GeoPanelå®¹å™¨åŒ–",
        "date": "2021-04-08 15:10:06",
        "tags": [],
        "published": false,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "geopanel-rong-qi-hua"
    },
    {
      "content": "\n\n* ç®€å•ä»‹ç»ç³»ç»Ÿæ¶æ„ã€ç¼–è¯‘ç¯å¢ƒçš„æ­å»º\n* ç®€å•ä»‹ç»åˆ©ç”¨ AndroidStudio è°ƒè¯• system_process è¿›ç¨‹çš„æ–¹æ³•åŠç¼–è¯‘æ›´æ–°éƒ¨åˆ†ç³»ç»Ÿæ¨¡å—çš„æ–¹å¼\n\n<!-- more -->\n\n\n## Androidç³»ç»Ÿæ¶æ„\n\nAndroid ç³»ç»Ÿæ¶æ„å¦‚ä¸‹ä¸¤å›¾æ‰€ç¤ºï¼š\n\n![Android æ¡†æ¶è¯¦æƒ…](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210401092831.png) \n\n![Android ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210401092925.png)\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\n\n\n- **åº”ç”¨æ¡†æ¶**ã€‚åº”ç”¨æ¡†æ¶æœ€å¸¸è¢«åº”ç”¨å¼€å‘è€…ä½¿ç”¨ã€‚å¾ˆå¤šæ­¤ç±» API éƒ½å¯ä»¥ç›´æ¥æ˜ å°„åˆ°åº•å±‚ HAL æ¥å£ï¼Œå¹¶å¯æä¾›ä¸å®ç°é©±åŠ¨ç¨‹åºç›¸å…³çš„å®ç”¨ä¿¡æ¯ã€‚\n- **Binder IPC**ã€‚Binder è¿›ç¨‹é—´é€šä¿¡ (IPC) æœºåˆ¶å…è®¸åº”ç”¨æ¡†æ¶è·¨è¶Šè¿›ç¨‹è¾¹ç•Œå¹¶è°ƒç”¨ Android ç³»ç»ŸæœåŠ¡ä»£ç ï¼Œè¿™ä½¿å¾—é«˜çº§æ¡†æ¶ API èƒ½ä¸ Android ç³»ç»ŸæœåŠ¡è¿›è¡Œäº¤äº’ã€‚åœ¨åº”ç”¨æ¡†æ¶çº§åˆ«ï¼Œå¼€å‘è€…æ— æ³•çœ‹åˆ°æ­¤ç±»é€šä¿¡çš„è¿‡ç¨‹ï¼Œä½†ä¸€åˆ‡ä¼¼ä¹éƒ½åœ¨â€œæŒ‰éƒ¨å°±ç­åœ°è¿è¡Œâ€ã€‚\n- **ç³»ç»ŸæœåŠ¡**ã€‚ç³»ç»ŸæœåŠ¡æ˜¯ä¸“æ³¨äºç‰¹å®šåŠŸèƒ½çš„æ¨¡å—åŒ–ç»„ä»¶ï¼Œä¾‹å¦‚çª—å£ç®¡ç†å™¨ã€æœç´¢æœåŠ¡æˆ–é€šçŸ¥ç®¡ç†å™¨ã€‚åº”ç”¨æ¡†æ¶ API æ‰€æä¾›çš„åŠŸèƒ½å¯ä¸ç³»ç»ŸæœåŠ¡é€šä¿¡ï¼Œä»¥è®¿é—®åº•å±‚ç¡¬ä»¶ã€‚Android åŒ…å«ä¸¤ç»„æœåŠ¡ï¼šâ€œç³»ç»Ÿâ€ï¼ˆè¯¸å¦‚çª—å£ç®¡ç†å™¨å’Œé€šçŸ¥ç®¡ç†å™¨ä¹‹ç±»çš„æœåŠ¡ï¼‰å’Œâ€œåª’ä½“â€ï¼ˆä¸æ’­æ”¾å’Œå½•åˆ¶åª’ä½“ç›¸å…³çš„æœåŠ¡ï¼‰ã€‚\n- **ç¡¬ä»¶æŠ½è±¡å±‚ (HAL)**ã€‚HAL å¯å®šä¹‰ä¸€ä¸ªæ ‡å‡†æ¥å£ä»¥ä¾›ç¡¬ä»¶ä¾›åº”å•†å®ç°ï¼Œè¿™å¯è®© Android å¿½ç•¥è¾ƒä½çº§åˆ«çš„é©±åŠ¨ç¨‹åºå®ç°ã€‚å€ŸåŠ© HALï¼Œç¡¬ä»¶å¼€å‘è€…å¯ä»¥é¡ºåˆ©å®ç°ç›¸å…³åŠŸèƒ½ï¼Œè€Œä¸ä¼šå½±å“æˆ–æ›´æ”¹æ›´é«˜çº§åˆ«çš„ç³»ç»Ÿã€‚HAL å®ç°ä¼šè¢«å°è£…æˆæ¨¡å—ï¼Œå¹¶ä¼šç”± Android ç³»ç»Ÿé€‚æ—¶åœ°åŠ è½½ã€‚å¦‚éœ€äº†è§£è¯¦æƒ…ï¼Œè¯·å‚é˜…[ç¡¬ä»¶æŠ½è±¡å±‚ (HAL)](https://source.android.google.cn/devices/architecture/hal?hl=zh-cn)ã€‚\n- **Linux å†…æ ¸**ã€‚å¼€å‘è®¾å¤‡é©±åŠ¨ç¨‹åºä¸å¼€å‘å…¸å‹çš„ Linux è®¾å¤‡é©±åŠ¨ç¨‹åºç±»ä¼¼ã€‚Android ä½¿ç”¨çš„ Linux å†…æ ¸ç‰ˆæœ¬åŒ…å«ä¸€äº›ç‰¹æ®Šçš„è¡¥å……åŠŸèƒ½ï¼Œä¾‹å¦‚ä½å†…å­˜ç»ˆæ­¢å®ˆæŠ¤è¿›ç¨‹ï¼ˆä¸€ä¸ªå†…å­˜ç®¡ç†ç³»ç»Ÿï¼Œå¯æ›´ä¸»åŠ¨åœ°ä¿ç•™å†…å­˜ï¼‰ã€å”¤é†’é”å®šï¼ˆä¸€ç§ [`PowerManager`](https://developer.android.google.cn/reference/android/os/PowerManager.html?hl=zh-cn) ç³»ç»ŸæœåŠ¡ï¼‰ã€Binder IPC é©±åŠ¨ç¨‹åºï¼Œä»¥åŠå¯¹ç§»åŠ¨åµŒå…¥å¼å¹³å°æ¥è¯´éå¸¸é‡è¦çš„å…¶ä»–åŠŸèƒ½ã€‚è¿™äº›è¡¥å……åŠŸèƒ½ä¸»è¦ç”¨äºå¢å¼ºç³»ç»ŸåŠŸèƒ½ï¼Œä¸ä¼šå½±å“é©±åŠ¨ç¨‹åºå¼€å‘ã€‚å¯ä»¥ä½¿ç”¨ä»»æ„ç‰ˆæœ¬çš„å†…æ ¸ï¼Œåªè¦å®ƒæ”¯æŒæ‰€éœ€åŠŸèƒ½ï¼ˆå¦‚ Binder é©±åŠ¨ç¨‹åºï¼‰å³å¯ã€‚ä¸è¿‡å»ºè®®ä½¿ç”¨ Android å†…æ ¸çš„æœ€æ–°ç‰ˆæœ¬ã€‚å¦‚éœ€äº†è§£è¯¦æƒ…ï¼Œè¯·å‚é˜…[æ„å»ºå†…æ ¸](https://source.android.google.cn/setup/building-kernels?hl=zh-cn)ä¸€æ–‡ã€‚\n\n> ä»¥ä¸Šéƒ¨åˆ†å†…å®¹æ¥æºï¼š https://source.android.google.cn/devices/architecture?hl=zh-cn\n\n## æ­å»ºå¼€å‘ç¯å¢ƒå¹¶ç¼–è¯‘æºç \n\næœ¬èŠ‚å°†è®¨è®º Android 11 æºç ä¸‹è½½å’Œç¼–è¯‘çš„æ–¹æ³•ã€AndroidStudioå¼€å‘ç¯å¢ƒçš„æ­å»ºæ–¹æ³•ï¼ŒåŠ system_process è¿›ç¨‹çš„è°ƒè¯•æ–¹æ³•ç­‰ç›¸å…³çŸ¥è¯†ã€‚\n\n### é€‰æ‹©åˆ†æ”¯\n\nå¯å‚è€ƒ source.android.google.cn çš„æ–‡æ¡£ [ä»£å·ã€æ ‡è®°å’Œ Build å·](https://source.android.google.cn/setup/start/build-numbers) ï¼Œå¯ä»¥çœ‹åˆ°å½“å‰æœ€æ–°çš„ç‰ˆæœ¬åŠæ ‡è®°å¦‚ä¸‹ï¼š\n\n| Build           | æ ‡è®°               | ç‰ˆæœ¬      | æ”¯æŒçš„è®¾å¤‡                                                   | å®‰å…¨è¡¥ä¸ç¨‹åºçº§åˆ« |\n| :-------------- | :----------------- | :-------- | :----------------------------------------------------------- | :--------------- |\n| RQ2A.210305.007 | android-11.0.0_r33 | Android11 | --                                                           | --               |\n| RQ1D.210105.003 | android-11.0.0_r28 | Android11 | Pixel 3ã€Pixel 3 XLã€Pixel 4a (5G)ã€Pixel 5                  | 2021-01-05       |\n| RQ1A.210105.003 | android-11.0.0_r27 | Android11 | Pixel 3ã€Pixel 3 XLã€Pixel 4ã€Pixel 4a (5G)ã€Pixel 4 XLã€Pixel 5 | 2021-01-05       |\n| RQ1A.210105.002 | android-11.0.0_r26 | Android11 | Pixel 3aã€Pixel 3a XLã€Pixel 4a                              | 2021-01-05       |\n\nå‚è€ƒä»£ç ä»“åº“ä¸­çš„[æœ€æ–°Tag](https://android.googlesource.com/platform/bionic/+/refs/tags/android-11.0.0_r33)ï¼Œæˆ‘ä»¬é€‰æ‹© `android-11.0.0_r33`\n\n### æ­å»ºAndroidæ„å»ºç¯å¢ƒ\n\næ„å»ºç¯å¢ƒçš„æ­å»ºå¯å‚è€ƒå®˜æ–¹çš„ [æ­å»ºæ„å»ºç¯å¢ƒ](https://source.android.google.cn/setup/build/initializing) æ–‡æ¡£ï¼Œä»¥ä¸‹ç»“åˆå®é™…æ­å»ºè¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ç®€è¦è¿›è¡Œä»‹ç»ã€‚\n\n#### æ„å»ºç¯å¢ƒè¦æ±‚\n\né¦–å…ˆéœ€è¦æœºå™¨æ»¡è¶³ä¸€äº›[è¦æ±‚](https://source.android.google.cn/setup/build/requirements)ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œéœ€è¦ï¼š\n\n* æ“ä½œç³»ç»Ÿï¼š Linux æˆ–è€… macOS\n* å†…å­˜ï¼š 16GBçš„å¯ç”¨RAM/äº¤æ¢ç©ºé—´\n* ç¡¬ç›˜ï¼š æ£€å‡ºä»£ç è‡³å°‘250GBå¯ç”¨ç£ç›˜ç©ºé—´ï¼Œå¦‚æœéœ€è¦æ„å»ºï¼Œåˆ™è¿˜éœ€è¦150GB\n\nä»Android8.0 å¼€å§‹ï¼Œå¯ä»¥ä½¿ç”¨æºç ä¸­å¸¦çš„Dockerfileæ¥æ„å»ºä¸€ä¸ªé•œåƒç”¨äºç¼–è¯‘aospæºç ï¼›ä¸‹é¢æˆ‘ä»¬å°†åˆ†åˆ«ä»‹ç»å¦‚ä½•æ„å»ºç¼–è¯‘ç”¨çš„Dockeré•œåƒåŠç›´æ¥åœ¨macOS11.2ä¸Šæ­å»ºæ„å»ºç¯å¢ƒï¼Œæ„å»ºæ—¶æ ¹æ®æƒ…å†µä»»é€‰ä¸€ç§å³å¯ã€‚\n\n> æç¤ºï¼š\n>\n> æœ€æ–°çš„æ„å»ºè¦æ±‚å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ [aospæºç æ„å»ºè¦æ±‚](https://source.android.google.cn/setup/build/requirements)\n\n#### æ­å»ºæ„å»ºç¯å¢ƒ-Docker\n\n> dockeré•œåƒåŸºäºubuntu:18.04ï¼Œæ‰€ä»¥ubuntuä¸Šä¹Ÿå¯ä»¥æŒ‰ç…§dockerfileä¸­çš„å‘½ä»¤é…ç½®ç¯å¢ƒ\n\nè¿™é‡Œå‡è®¾å®‰è£…äº†Dockerï¼Œå¦‚æœæ²¡æœ‰å®‰è£…ï¼Œå¯ä»¥å‚è€ƒ[Dockerå®˜æ–¹å®‰è£…æ–‡æ¡£](https://docs.docker.com/engine/install/)è¿›è¡Œå®‰è£…ã€‚\n\n```shell\nmkdir docker\ncd docker\n```\n\nå°†å¦‚ä¸‹å†…å®¹ä¿å­˜ä¸ºDockerfileï¼Œå¹¶å­˜å‚¨åˆ°ä¹‹å‰å»ºç«‹çš„dockerç›®å½•\n\n```dockerfile\nFROM ubuntu:18.04\n\nARG userid\nARG groupid\nARG username\n\nRUN apt-get update \\\n    && apt-get install -y git-core gnupg flex bison build-essential zip \\\n    curl zlib1g-dev gcc-multilib g++-multilib libc6-dev-i386 lib32ncurses5-dev \\\n    x11proto-core-dev libx11-dev lib32z1-dev libgl1-mesa-dev libxml2-utils xsltproc unzip fontconfig \\\n    python3 \\\n    && rm -rf /var/lib/apt/lists/* \n    \n# æœ€æ–°çš„AOSPæºç ä¸­å·²ç»å¸¦äº†JDKï¼Œæ‰€ä»¥æ— éœ€å®‰è£…\n# RUN curl -o jdk8.tgz https://android.googlesource.com/platform/prebuilts/jdk/jdk8/+archive/master.tar.gz \\\n#  && tar -zxf jdk8.tgz linux-x86 \\\n#  && mv linux-x86 /usr/lib/jvm/java-8-openjdk-amd64 \\\n#  && rm -rf jdk8.tgz\n\nRUN curl -o /usr/local/bin/repo https://storage.googleapis.com/git-repo-downloads/repo \\\n && chmod a+x /usr/local/bin/repo \\\n && ln -s /usr/bin/python3 /usr/bin/python\n\nRUN groupadd -f -g $groupid $username || true \\\n && useradd -m -u $userid -g $groupid $username \\\n && echo $username >/root/username \\\n && echo \"export USER=\"$username >>/home/$username/.gitconfig\nCOPY gitconfig /home/$username/.gitconfig\nRUN chown $userid:$groupid /home/$username/.gitconfig\nENV HOME=/home/$username\nENV USER=$username\nENTRYPOINT chroot --userspec=$(cat /root/username):$(cat /root/username) / /bin/bash -i\n```\n\n> ä»¥ä¸ŠdockerfileåŸºäºæºç ä¸­ `build/make/tools/docker/Dockerfile` ä¿®æ”¹\n\n**æ„å»ºé•œåƒï¼š**\n\n```shell\n# Copy your host gitconfig, or create a stripped down version\n$ cp ~/.gitconfig gitconfig\n$ docker build --build-arg userid=$(id -u) --build-arg groupid=$(id -g) --build-arg username=$(id -un) -t android-build-bionic .\n```\n\n**ä½¿ç”¨é•œåƒï¼š**\n\n> å¯ä»¥ç›´æ¥ä½¿ç”¨æˆ‘å·²ç»æ„å»ºå¥½çš„é•œåƒï¼š `hanlyjiang/android-build-bionic`ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ‹‰å–å¹¶ä¿®æ”¹tagï¼š\n>\n> `docker pull hanlyjiang/android-build-bionic`\n>\n> `docker tag hanlyjiang/android-build-bionic android-build-bionic:latest`\n\nå‡è®¾aospçš„æºç ç›®å½•ä½äº ï½/aosp\n\n```shell\n# è®¾ç½®å˜é‡æŒ‡å‘æºç é¡¶å±‚ç›®å½•\nANDROID_BUILD_TOP=~/aosp\n# å¦‚è‡ªè¡Œæ„å»ºé•œåƒï¼Œæ­¤å¤„\nBUILD_IMAGE=android-build-bionic\ncd $ANDROID_BUILD_TOP\n# è¿è¡Œå®¹å™¨ï¼Œå¹¶å°†aospæºç ç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨çš„/srcç›®å½•\ndocker run -it --rm --name aosp-builder -v $PWD:/src $BUILD_IMAGE\n```\n\nå¯åŠ¨æˆåŠŸåå°±ä¼šè¿›å…¥å®¹å™¨çš„shellä¸­ï¼Œä¹‹ååœ¨å®¹å™¨ä¸­è¿›è¡Œæ‰§è¡Œå¯¹åº”çš„ç¼–è¯‘å‘½ä»¤å³å¯ã€‚\n\n> **dockerä½¿ç”¨æç¤ºï¼š**\n>\n> 1. ä¸Šé¢çš„`docker run `å‘½ä»¤ä¸­æ·»åŠ äº† `--rm` é€‰é¡¹ï¼Œåœ¨å¯åŠ¨çš„äº¤äº’å¼bashç»“æŸåå°±ä¼šè‡ªåŠ¨ç§»é™¤å®¹å™¨ã€‚ä¹‹åéœ€è¦å†æ¬¡è¾“å…¥`docker run`å‘½ä»¤å¯åŠ¨å®¹å™¨ï¼›ä¸ºäº†é¿å…æ¯æ¬¡éƒ½è¾“å…¥å¦‚ä¸Šå‘½ä»¤å¯åŠ¨å®¹å™¨ï¼Œå¯ä»¥ç§»é™¤`--rm` é€‰é¡¹\n> 2. æˆ‘ä»¬æ‰§è¡Œæ„å»ºä¸€èˆ¬éœ€è¦è¾ƒé•¿æ—¶é—´ï¼ŒæœŸé—´å¦‚æœæˆ‘ä»¬é€€å‡ºå®¹å™¨çš„bashï¼Œåˆ™æ„å»ºä»»åŠ¡ä¼šç»ˆæ­¢ï¼Œè¿™æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `ctrl+P ctrl+Q` å‘½ä»¤å‘Šè¯‰dockeræˆ‘ä»¬éœ€è¦å…³é—­å®¹å™¨åˆ°æœ¬æœºçš„è¾“å…¥è¾“å‡ºé‡å®šå‘ï¼Œä½†æ˜¯å¹¶ä¸æš‚åœä»»ä½•æ‰§è¡Œçš„ä»»åŠ¡ã€‚ä¹‹åå†ä½¿ç”¨ `docker attach aosp-builder`ï¼ˆaosp-builderæ˜¯æˆ‘ä»¬å¯åŠ¨æ—¶æŒ‡å®šçš„å®¹å™¨åç§°ï¼‰ å³å¯é‡æ–°å°†å®¹å™¨è¾“å…¥è¾“å‡ºé‡å®šå‘åˆ°æœ¬æœºç»ˆç«¯ï¼Œç»§ç»­ä¸å®¹å™¨å†…çš„shelläº¤äº’ã€‚\n\n#### æ­å»ºæ„å»ºç¯å¢ƒ-macOS11.2\n\nè¿™é‡Œä»‹ç»ä¸‹macOSï¼ˆx86ï¼‰ç¼–è¯‘çš„ç¯å¢ƒé…ç½®\n\n1. å‡†å¤‡æºç ç›®å½•\n\n   ç”±äºmacOSé»˜è®¤çš„åˆ†åŒºæ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ï¼Œä½†æ˜¯aospç¼–è¯‘éœ€è¦åŒºåˆ†å¤§å°å†™ï¼Œæ‰€ä»¥éœ€è¦åˆ›å»ºä¸€ä¸ªåŒºåˆ†å¤§å°å†™çš„åˆ†åŒºï¼Œè¿™é‡Œå¯ä»¥æœ‰ä¸¤ç§é€‰æ‹©ï¼š\n\n   1ï¼‰ä½¿ç”¨å¦å¤–ä¸€ä¸ªç£ç›˜ï¼ˆå¦‚å¤–ç½®çš„ç§»åŠ¨ç¡¬ç›˜ï¼‰ï¼Œç„¶åä½¿ç”¨ç£ç›˜å·¥å…·å°†å…¶æŠ¹æ‰ä¸ºåŒºåˆ†å¤§å°å†™çš„åˆ†åŒºï¼›\n\n   2ï¼‰åˆ›å»ºä¸€ä¸ªåŒºåˆ†å¤§å°å†™çš„ç£ç›˜æ˜ åƒï¼Œå¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤æ‰§è¡Œ\n\n   ```shell\n   hdiutil create -type SPARSE -fs 'Case-sensitive Journaled HFS+' -size 250g ~/android.dmg.sparseimage\n   \n   # å®šä¹‰è£…è½½å¸è½½å‡½æ•°\n   mountAndroid() { hdiutil attach ~/android.dmg.sparseimage -mountpoint /Volumes/android; }\n   umountAndroid() { hdiutil detach /Volumes/android; }\n   # è£…è½½åˆšåˆšåˆ›å»ºçš„ç£ç›˜æ˜ åƒåˆ° /Volumes/android ç›®å½•ï¼Œä¹‹åcd åˆ°æ­¤ç›®å½•æ‰§è¡Œå³å¯\n   mountAndroid\n   ```\n\n2. å®‰è£… xcode å‘½ä»¤è¡Œå·¥å…·\n\n   ```shell\n   xcode-select --install\n   ```\n\n3. è®¾ç½®bash\n\n   ```shell\n   # å¯åŠ å…¥åˆ°ï½/.bash_profile æ–‡ä»¶ä¸­\n   ulimit -S -n 2048\n   ```\n\n4. ä¸‹è½½ 10.15 SDK\n\n   ä»æ­¤å¤„ä¸‹è½½ï¼š https://github.com/phracker/MacOSX-SDKs/releases\n\n   ä¸‹è½½å®Œæˆåæ”¾å…¥åˆ°æ­¤ç›®å½•ï¼š`/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/`\n\n5. ä¿®å¤ä»£ç ï¼ˆåœ¨ä¸‹è½½å®Œæˆæºç ä¹‹åæ‰§è¡Œï¼‰\n\n   * ç¼–è¾‘æ–‡ä»¶ `system/core/base/cmsg.cpp`\n\n   * æ·»åŠ ä¸€è¡Œï¼š`size_t psize = getpagesize();`\n\n     ```cpp\n     namespace base {\n         \n     size_t psize = getpagesize();\n         \n     ssize_t SendFileDescriptorVector(borrowed_fd sockfd, const void* data, size_t len,\n     ```\n\n   * å°†æ–‡ä»¶ä¸­æ‰€æœ‰ **PAGE_SIZE** æ›¿æ¢ä¸º **psize**\n\n> å‚è€ƒï¼š\n>\n> * [Building Android 11 for PH-1 on Apple Silicon](https://nf4789.medium.com/building-android-11-for-ph-1-on-apple-silicon-6600436a36a0)\n> * [Could not find a supported mac sdk: â€œ10.10â€ â€œ10.11â€ â€œ10.12â€ â€œ10.13â€](https://stackoverflow.com/questions/50760701/could-not-find-a-supported-mac-sdk-10-10-10-11-10-12-10-13)\n> * [åˆ›å»ºåŒºåˆ†å¤§å°å†™çš„ç£ç›˜æ˜ åƒ-source.android.google.cn](https://source.android.google.cn/setup/build/initializing?hl=zh-cn#creating-a-case-sensitive-disk-image)\n\n### ä¸‹è½½æºç \n\n#### å®‰è£…Repo\n\n> æç¤ºï¼š å…ˆå‰æ„å»ºçš„dockeré•œåƒä¸­å·²ç»å®‰è£…äº†repoï¼Œå¦‚ä½¿ç”¨é•œåƒï¼Œå¯è·³è¿‡æ­¤æ­¥éª¤\n\n```shell\nmkdir ~/.bin\nPATH=~/.bin:$PATH\n\n# è¿™é‡Œå¯èƒ½éœ€è¦å¼€å¯ä»£ç†\ncurl https://storage.googleapis.com/git-repo-downloads/repo > ~/bin/repo\nchmod a+x ~/bin/repo\n\n# éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ\nrepo help\n```\n\nè¾“å‡ºå¦‚ä¸‹åˆ™è¡¨ç¤ºå®‰è£…æˆåŠŸï¼š\n\n```shell\nusage: repo COMMAND [ARGS]\n\nrepo is not yet installed.  Use \"repo init\" to install it here.\n\nThe most commonly used repo commands are:\n\n  init      Install repo in the current working directory\n  help      Display detailed help on a command\n\nFor access to the full online help, install repo (\"repo init\").\n```\n\n#### è·å–aospæºç åº•åŒ…\n\n```shell\nwget https://mirrors.tuna.tsinghua.edu.cn/aosp-monthly/aosp-latest.tar\n# è§£å‹\ntar xf aosp-latest.tar\n```\n\næˆ–è€…ç›´æ¥ä¸‹è½½ï¼š\n\n```shell\nmkdir aosp ; cd aosp \nrepo init -u https://android.googlesource.com/platform/manifest -b android-11.0.0_r33\n```\n\nç„¶åæ‰§è¡Œä»£ç åŒæ­¥å‘½ä»¤ï¼š\n\n```shell\nrepo sync -c -j16\n```\n\n> repo sync å‘½ä»¤è¯´æ˜ï¼š \n>\n> * é€šè¿‡ `-c` æŒ‡å®šåªè·å–å½“å‰åˆ†æ”¯\n> * é€šè¿‡ `-j16` æŒ‡å®šå¹¶è¡Œè·å–çš„çº¿ç¨‹æ•°é‡ï¼Œè¿™é‡Œæˆ‘ç”µè„‘ä¸º8æ ¸ï¼Œæ‰€ä»¥æŒ‡å®šäº†16ä¸ªçº¿ç¨‹\n\n> **æç¤ºï¼š**\n>\n> ä»£ç ä¸‹è½½å®Œæˆåï¼Œæˆ‘ä»¬å¤åˆ¶ä¸€ä»½åˆ°å¦å¤–ä¸€ä¸ªç›®å½•åªç”¨äºæµè§ˆä»£ç  `rsync -a -H --progress aosp aosp-ro`\n\n### ç¼–è¯‘æºç \n\né¦–å…ˆï¼Œ æˆ‘ä»¬ä½¿ç”¨ repo å¯åŠ¨ä¸€ä¸ªå·¥ä½œåˆ†æ”¯\n\n```shell\nrepo start dev_android11_r33 --all\n```\n\nåˆå§‹åŒ–ç¯å¢ƒï¼š\n\n```shell\nsource build/envsetup.sh\n```\n\n`envsetup.sh` è„šæœ¬ä¼šå¯¼å…¥è‹¥å¹²å‘½ä»¤ï¼Œå¯ä½¿ç”¨ `hmm` æŸ¥çœ‹å®Œæ•´çš„å¯ç”¨å‘½ä»¤åˆ—è¡¨ã€‚\n\né€‰æ‹©ç›®æ ‡ï¼š\n\n```shell\nlunch aosp_x86_64-eng\n```\n\nè¾“å‡ºå¦‚ä¸‹ï¼š\n\n```shell\n$ lunch aosp_x86_64-eng\n============================================\nPLATFORM_VERSION_CODENAME=REL\nPLATFORM_VERSION=11\nTARGET_PRODUCT=aosp_x86_64\nTARGET_BUILD_VARIANT=eng\nTARGET_BUILD_TYPE=release\nTARGET_ARCH=x86_64\nTARGET_ARCH_VARIANT=x86_64\nTARGET_2ND_ARCH=x86\nTARGET_2ND_ARCH_VARIANT=x86_64\nHOST_ARCH=x86_64\nHOST_OS=darwin\nHOST_OS_EXTRA=Darwin-20.3.0-x86_64-11.2.3\nHOST_BUILD_TYPE=release\nBUILD_ID=RQ2A.210305.007\nOUT_DIR=out\nPRODUCT_SOONG_NAMESPACES=device/generic/goldfish device/generic/goldfish-opengl hardware/google/camera hardware/google/camera/devices/EmulatedCamera device/generic/goldfish device/generic/goldfish-opengl\n```\n\næ„å»ºï¼š\n\n```shell\nmake -j16\n```\n\n> æç¤ºï¼šæ„å»ºå‘½ä»¤å¯å‚è€ƒ [å®˜æ–¹æ–‡æ¡£-ç¼–è¯‘ Android](https://source.android.google.cn/setup/build/building)\n\næ„å»ºæˆåŠŸåè¾“å‡ºå¦‚ä¸‹ï¼š\n\n```shell\n[100% 119047/119047] Create system-qemu.img now\nremoving out/target/product/generic_x86_64/system-qemu.img.qcow2\nout/host/darwin-x86/bin/sgdisk --clear out/target/product/generic_x86_64/system-qemu.img\n\n#### build completed successfully (14:34:15 (hh:mm:ss)) ####\n```\n\næˆ‘ä»¬è¿™é‡Œä½¿ç”¨æ¨¡æ‹Ÿå™¨è¿›è¡Œè¿è¡Œ\n\n```shell\nemulator\n```\n\nè¿è¡Œèµ·æ¥ä¹‹åï¼ŒæŸ¥çœ‹å…¶ä¸­çš„ç³»ç»Ÿç‰ˆæœ¬å·å¦‚ä¸‹ï¼š\n\n<img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210403135316.png\" alt=\"Screenshot_1617429150\" style=\"zoom:35%;\" />\n\n## ä½¿ç”¨AndroidStudioè°ƒè¯• `system_process`\n\næœ¬å°èŠ‚ä»‹ç»å¦‚ä½•ä½¿ç”¨ASæ¥è°ƒè¯•Android Java Frameworkçš„æ ¸å¿ƒè¿›ç¨‹ system_processã€‚\n\n### ä¸‹è½½å®‰è£…AndroidStudio\n\nä»[AndroidStudioå®˜æ–¹é¡µé¢](https://developer.android.google.cn/studio)ä¸‹è½½å®‰è£…è¿è¡Œå³å¯\n\n### ç”ŸæˆASé¡¹ç›®é…ç½®\n\næ€»çš„æµç¨‹å¦‚ä¸‹ï¼š\n\n* å…¨é‡ç¼–è¯‘ä¸€æ¬¡aospæºç \n* ç¼–è¯‘`development/tools/idegen` ç”Ÿæˆ `idegen.jar` æ–‡ä»¶ï¼›\n* ä½¿ç”¨`development/tools/idegen/idegen.sh` ç”ŸæˆASé¡¹ç›®é…ç½®\n* ä½¿ç”¨AndroidStudioæ‰“å¼€ç”Ÿæˆçš„é…ç½®ï¼Œå¯¼å…¥æºç é¡¹ç›®\n\nå…¶ä¸­ `idegen.sh` ä»…æ˜¯ç®€å•çš„ä½¿ç”¨javaæ‰§è¡Œidegen.jarï¼Œidegen.jar ä¼šåœ¨æºç æ ¹ç›®å½•ç”Ÿæˆandroidstudioä½¿ç”¨çš„ä¸¤ä¸ªæ–‡ä»¶ï¼Œå³`android.iml`å’Œ`android.ipr`ï¼Œç”Ÿæˆè¿‡ç¨‹ä¸­ä¼šè¯»å– `excluded-paths` æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¸­å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å®šä¹‰è¿‡æ»¤è§„åˆ™ï¼Œè¯¥æ–‡ä»¶ä¼šä»ä¸‰ä¸ªè·¯å¾„å»è¯»å–ï¼š\n\n* `development/tools/idegen/excluded-paths`\n* `vendor/google/excluded-paths`\n* æºç æ ¹ç›®å½•çš„ `excluded-paths`\n\næ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å°†è‡ªå·±çš„è¿‡æ»¤è§„åˆ™å®šä¹‰åˆ°æºç æ ¹ç›®å½•çš„ `excluded-paths`æ–‡ä»¶ä¸­å³å¯ã€‚\n\n`android.iml` ä¸­æœ‰ä¸‰ç§xmlé…ç½®: \n\n1ï¼‰`sourceFolder`;\n\n2) `excludeFolder`;\n\n3) `orderEntry`; \n\nidegen.jar åœ¨æ‰§è¡Œæ—¶ä¼šæ ¹æ®é…ç½®çš„è§„åˆ™è‡ªåŠ¨å†™å…¥è¿™ä¸‰ç§è§„åˆ™ï¼Œå…¶ä¸­sourceFolderç”¨äºæŒ‡å®šæºç ç›®å½•-å³asä¼šå°†å…¶ä½œä¸ºæºç å¯¼å…¥ï¼ŒexcludeFolderç”¨äºæŒ‡å®šæ’é™¤ç›®å½•-å³aså‹æ ¹ä¸ä¼šå»æœç´¢ä»»ä½•æ–‡ä»¶ï¼Œä¹Ÿä¸ä¼šå¯¹å…¶ä¸­çš„æ–‡ä»¶å»ºç«‹ç´¢å¼•ï¼ŒorderEntry åˆ™ä¸€èˆ¬ç”¨äºæŒ‡å®šä¾èµ–çš„jaræ–‡ä»¶ï¼›\n\nåœ¨idegen.jarçš„é€»è¾‘ä¸­ï¼š\n\n* æ²¡æœ‰è¢«è¿‡æ»¤è§„åˆ™åŒ¹é…åˆ°çš„ç›®å½•éƒ½ä¼šå°è¯•å»å…¶ä¸­æœå¯»javaåŠjaræ–‡ä»¶ï¼Œåªæœ‰åœ¨å…¶ä¸­æ‰¾åˆ°äº†æºç æ–‡ä»¶ï¼Œæ‰ä¼šè¢«åŠ å…¥åˆ°sourceFolderä¸­ã€‚\n* è¿‡æ»¤è§„åˆ™ä¸­é…ç½®çš„ç›®å½•ï¼Œåªæœ‰å…¶ä¸­æœ‰javaåŠjaræ–‡ä»¶æ—¶ï¼Œæ‰ä¼šè¢«åŠ å…¥åˆ°excludeFolderé…ç½®ä¸­ã€‚\n* å¦‚æœç›®å½•ä¸­æ‰¾åˆ°äº†javaæ–‡ä»¶ï¼Œä¼šå»è¯»å–javaæ–‡ä»¶ï¼Œè‡ªåŠ¨ç¡®è®¤sourceFolderçš„å¼€å§‹è·¯å¾„ï¼Œä»¥ä¿è¯è·¯å¾„èƒ½æ­£ç¡®åŒ¹é…åŒ…åï¼Œå¦‚ï¼šæœ‰ä¸ªç›®å½•`de vice/test/src/java/android/Test.java`ï¼Œå…¶ä¸­Test.javaçš„åŒ…ä¸ºandroidï¼Œé‚£ä¹ˆsourceFolderçš„è·¯å¾„ä¼šè‡ªåŠ¨è®¾ç½®ä¸º`de vice/test/src/java/`ã€‚\n\n#### ä¿®æ”¹idegenä»£ç å¹¶ç¼–è¯‘idegen.jar\n\nä¿®æ”¹ `development/tools/idegen` æ¨¡å—ä»£ç åŠé…ç½®\n\n1. `src/Log.java` ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬æŸ¥çœ‹ç”Ÿæˆçš„è¿‡ç¨‹ï¼Œæ‰“å¼€debugæ—¥å¿—å¼€å…³\n\n   ```java\n   class Log {\n   \n       static final boolean DEBUG = true;\n       \n       // ...\n   }\n   ```\n\n2. `src/IntelliJ.java` , è¿™é‡Œç”±äºä»£ç ä¸­ä¹¦å†™é”™è¯¯ï¼Œprebuilt å®é™…ä¸Šåœ¨æºç ä¸­å¹¶ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬æ‰‹åŠ¨å°†å…¶ä¿®æ”¹ä¸º `prebuilts`\n\n   ```java\n           sourceRootsXml.append(\"<excludeFolder url=\\\"file://$MODULE_DIR$/out/target/product\\\"/>\\n\");\n   // ä¿®æ”¹è¿™ä¸€è¡Œ prebuilt --> prebuilts\n           sourceRootsXml.append(\"<excludeFolder url=\\\"file://$MODULE_DIR$/prebuilts\\\"/>\\n\");\n   \n   ```\n\n3. ç¼–è¯‘ç”Ÿæˆ idegen.jar\n\n   ```shell\n   # åœ¨æºç æ ¹ç›®å½•æ‰§è¡Œ\n   source build/envsetup.sh\n   cd development/tools/idegen\n   mm -j16\n   ```\n\n   æˆåŠŸç”Ÿæˆåè¾“å‡ºå¦‚ä¸‹ï¼š\n\n   ```shell\n   [100% 228/228] Install: out/host/darwin-x86/framework/idegen.jar\n   #### build completed successfully (05:30 (mm:ss)) ####\n   ```\n\n\n\n#### æ‰‹åŠ¨è·å–javaæ–‡ä»¶\n\n##### æ‰‹åŠ¨è·å–AIDLç”Ÿæˆçš„javaæ–‡ä»¶\n\næˆ‘ä»¬é€šè¿‡å¦‚ä¸‹å‘½ä»¤å°†aidlç”Ÿæˆçš„javaæ–‡ä»¶æ‹·è´åˆ° æºç æ ¹ç›®å½•çš„`idea/aidl/src`ç›®å½•ä¸‹\n\n```shell\ncroot\nmkdir -p idea/aidl/src\nfind out/soong/.intermediates/frameworks/base/api-stubs-docs-non-updatable/android_common/gen/aidl -name \"*.srcjar\" | xargs -I {} unzip {} -d idea/aidl/src\n```\n\n##### è·å–ç”Ÿæˆçš„èµ„æº\n\n```shell\ncp -R out/soong/.intermediates/frameworks/base/core/res/framework-res/android_common/gen/aapt2/R idea/framework-res_R\n```\n\n\n\n#### ç¼–è¾‘æ’é™¤è§„åˆ™å¹¶ç”Ÿæˆé…ç½®\n\n1. åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­æ·»åŠ ä¸€ä¸ª `excluded-paths` æ–‡ä»¶ï¼Œè¾“å…¥å¦‚ä¸‹å†…å®¹ï¼ˆä¸€è¡Œä½œä¸ºä¸€ä¸ªåŒ¹é…è§„åˆ™ï¼Œè§„åˆ™çš„æ ¼å¼æŒ‰Javaä¸­Patternç±»çš„è§„åˆ™ç¼–å†™ï¼‰\n\n   ```shell\n   # å‡ ä¸ªæ ¹ç›®å½•çš„è§„åˆ™\n   ^art/.*\n   ^packages/.*\n   ^bootable/.*\n   ^build/.*\n   ^cts/.*\n   ^dalvik/.*\n   ^developers/.*\n   ^external/.*\n   ^platform_testing/.*\n   ^pdk/.*\n   ^sdk/.*\n   ^system/.*\n   ^test/.*\n   \n   # platform-compatä¸­æœ‰æ³¨è§£çš„ç±»\n   ^tools/(?!(platform-compat))\n   ^development/.*\n   ^device/.*\n   ^prebuilts/*\n   \n   # è¿™é‡Œæˆ‘ä»¬æŸ¥çœ‹è¿™ä¸¤ä¸ªæ¨¡å—ï¼Œæ‰€ä»¥æ³¨é‡Šæ‰\n   #^libcore/.*\n   #^frameworks/.*\n   # å…³äºoutå…¶ä»–çš„ä¸€äº›è§„åˆ™\n   ^out/soong/.intermediates/(?!((frameworks)|(libcore)))\n   # ./out/soong/.intermediates/frameworks/native/libs/binder/libbinder/android_x86_64_shared/gen/aidl/android/os/BnServiceManager.h\n   # ^out/soong/.intermediates/.*\n   ^out/target/.*\n   \n   # æ ¹æ®å®é™…è¿è¡Œæƒ…å†µè¡¥å……çš„è§„åˆ™\n   # ç§»é™¤å¯èƒ½çš„jar\n   # å¦‚ ./frameworks/base/tools/aapt2/integration-tests/CommandTests/android-28.jar\n   ^frameworks/base/tools/aapt2/.*\\.jar\n   ^frameworks/base/tests\n   ^libcore/support/src/test\n   ^libcore/luni/src/test\n   gradle-wrapper.jar\n   \n   # å¯¹äºsdkæºç çš„éšè—ï¼Œæˆ‘ä»¬excludeæ‰ï¼Œä»¥ä½¿å¯ä»¥æ‰¾åˆ°çœŸæ­£çš„æºç \n   ^libcore/ojluni/annotations\n   ```\n\n2. ç”Ÿæˆimlæ–‡ä»¶ï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤ç”Ÿæˆ\n\n   ```shell\n   development/tools/idegen/idegen.sh\n   ```\n\n   å®Œæˆåæ ¹ç›®å½•ä¸‹å³ç”Ÿæˆäº†`android.iml`,`android.ipr` \n\n### å¯¼å…¥åˆ°AndroidStudio\n\n#### androidstudio é…ç½®\n\n1. é…ç½®jvmé€‰é¡¹ï¼Œæ ¹æ®æœºå™¨å®é™…æƒ…å†µè®¾ç½®vmåˆ†é…çš„å†…å­˜ç­–ç•¥\n\n   <img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210402093304.png\" alt=\"image-20210402093304425\"  />\n\n   ```shell\n   -Xmx16g\n   -Xms2g\n   ```\n\n2. é…ç½® idea å±æ€§\n\n   <img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210401212321.png\" alt=\"image-20210401212321136\" style=\"zoom:40%;\" />\n\n   ```shell\n   # å¤§å°å†™æ•æ„Ÿï¼ˆmacOSï¼‰\n   idea.case.sensitive.fs=true\n   \n   idea.max.intellisense.filesize=100000\n   ```\n\n#### å¯¼å…¥é¡¹ç›®åˆ°ASå¹¶é…ç½®\n\né…ç½®sdkä¸»è¦æ˜¯ä¸ºäº†é¿å…æŸ¥çœ‹æˆ–è°ƒè¯•ä»£ç æ—¶ï¼ŒASä»ç„¶å»ä½¿ç”¨SDKä¸­é…ç½®çš„classï¼Œè€Œä¸æ˜¯æˆ‘ä»¬çš„aospä¸­çš„javaæºç ã€‚\n\n1. ä½¿ç”¨AndroidStudio æ‰“å¼€é¡¹ç›®æ ¹ç›®å½•ä¸‹ `android.ipr` æ–‡ä»¶å³å¯å¯¼å…¥é¡¹ç›®ï¼›\n\n2. é…ç½®é¡¹ç›®SDKï¼Œè¿›å…¥é¡¹ç›®è®¾ç½®ï¼Œæ·»åŠ ä¸€ä¸ªæ–°çš„JDKï¼Œå¹¶åˆ é™¤æ‰€æœ‰ä¾èµ–jaråº“ï¼Œæˆ‘ä»¬è¿™é‡Œå–åä¸ºï¼š`1.8 (No Libraries)`\n\n   <img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210402095209.png\" alt=\"image-20210402095209074\" style=\"zoom:67%;\" />\n\n3. é…ç½®é¡¹ç›®SDKï¼Œè¿›å…¥é¡¹ç›®è®¾ç½®ï¼Œæ·»åŠ ä¸€ä¸ªæ–°çš„SDKï¼Œå¹¶åˆ é™¤æ‰€æœ‰jaråº“ï¼Œå¯¹åº”çš„JDKé€‰æ‹©ä¹‹å‰åˆ›å»ºçš„`1.8 (No Libraries)`ï¼Œè¿™é‡Œæˆ‘ä»¬å°†SDKå‘½åä¸º `Android API 30 Platform-NoLib`\n\n   <img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210402095255.png\" alt=\"image-20210402095255063\" style=\"zoom:67%;\" />\n\n4. åœ¨Projectè®¾ç½®ä¸­ï¼Œé€‰æ‹©é¡¹ç›®SDKä¸ºä¹‹å‰è®¾ç½®çš„ `Android API 30 Platform-NoLib`\n\n   <img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210402095343.png\" alt=\"image-20210402095343474\" style=\"zoom:67%;\" />\n\n5. è¿›å…¥é¡¹ç›®è®¾ç½®-æ¨¡å—è®¾ç½®ï¼Œå°†æ¨¡å—çš„SDKè®¾ç½®ä¸ºä¹‹å‰è®¾ç½®çš„  `Android API 30 Platform-NoLib` \n\n   <img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210402095449.png\" alt=\"image-20210402095449805\" style=\"zoom:67%;\" />\n\n#### é™„åŠ è°ƒè¯•å™¨åˆ° system_process \n\n1. é™„åŠ è°ƒè¯•å™¨åˆ° `system_process` è¿›ç¨‹\n\n![image-20210402093915683](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210402093915.png)\n\n![image-20210402095736899](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210402095736.png)\n\n2. æˆåŠŸåçš„Debuggerç•Œé¢å¦‚ä¸‹æ‰€ç¤º\n\n   ![image-20210402100639004](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210402100639.png)\n\n3. æ‰“æ–­ç‚¹æµ‹è¯•ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©åœ¨ `Binder.java` æ–‡ä»¶ä¸­æ·»åŠ æ–­ç‚¹ï¼Œç„¶ååœ¨æ¨¡æ‹Ÿå™¨ä¸­æ‰“å¼€ç›¸æœºAPPä»¥è§¦å‘æ–­ç‚¹é€»è¾‘ã€‚ä¸‹å›¾å°±è¡¨ç¤ºæˆ‘ä»¬åˆ°è¾¾äº†æ–­ç‚¹ï¼Œè¯´æ˜æˆ‘ä»¬å¯ä»¥é€šè¿‡ASæ¥è°ƒè¯•è¯¥è¿›ç¨‹äº†ã€‚\n\n   ![image-20210402101258438](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210402101258.png)\n\n> æç¤ºï¼šé™„åŠ è°ƒè¯•å™¨æ—¶ï¼Œå¦‚æ‰¾ä¸åˆ°è®¾å¤‡ï¼Œå¯å‚è€ƒç¬¬5å°èŠ‚ä¸­çš„ *é”™è¯¯è§£å†³ï¼šDebugä¸­ä¸æ˜¾ç¤ºè®¾å¤‡*\n\n## ä¿®æ”¹å¹¶æ›´æ–°ç³»ç»Ÿæ¨¡å—\n\nåœ¨è°ƒè¯•åˆ†æè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½æˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸€ä¸‹å…¶ä¸­å†…å®¹ä»¥ååŠ©åˆ†æï¼Œå¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼è¿›è¡Œã€‚\n\n### Framework\n\næ„å»º framework åˆ†ä¸¤å—ï¼š\n\n1. JAR éƒ¨åˆ†ä½¿ç”¨å‘½ä»¤ `mmm frameworks/base/`\n2. èµ„æºéƒ¨åˆ†ï¼š `mmm frameworks/base/core/res/`\n\n**å®‰è£…ï¼š**\n\n```shell\n# è·å–rootæƒé™\nadb root\nadb disable-verity\nadb reboot\nadb remount\n# ç§»é™¤æ—§çš„framework\nadb shell\ncd /system/framework/\nrm framework-res.apk\nexit\n\n# æ¨å…¥æ–°çš„framework\nadb push out/target/product/<device_targeted>/system/framework/framework-res.apk /system/framework/\n\n# é‡å¯æœåŠ¡\nadb reboot\n```\n\n### packagesä¸­app\n\n* æ„å»º\n\n```shell\ncd ~/aosp\nsource build/envsetup.sh \nlunch aosp_x86_64-eng\n# é‡æ–°æ„å»ºå•ä¸ªæ¨¡å— (å¦‚ Dialer)\nmmm packages/apps/dialer/\n# ç”Ÿæˆçš„æ–‡ä»¶ä¼šåœ¨æ§åˆ¶å°ä¸­è¾“å‡ºæ¥\n```\n\n* æ›´æ–°åˆ°ç³»ç»Ÿ\n\n```shell\nadb install -r out/target/product/<device_targeted>/system/priv-app/<app_name>/<app_name>.apk\nadb reboot\n```\n\n### SystemUI\n\n* ç¼–è¯‘\n\n```shell\ncd WORKING_DIRECTORY\nsource build/envsetup.sh\n# é€‰æ‹©è®¾å¤‡\nlunch 31\n# é‡æ–°æ„å»ºSystemUI\nmmm frameworks/base/packages/SystemUI/\n```\n\n* å®‰è£…åˆ°ç³»ç»Ÿ\n\n```shell\nadb install -r out/target/product/<device_targeted>/system/priv-app/SystemUI/SystemUI.apk\nadb reboot\n```\n\n\n\n## ä½¿ç”¨æç¤ºåŠå¸¸è§é”™è¯¯\n\n### ä½¿ç”¨æç¤ºï¼šé¡¹ç›®æºç æµè§ˆé…ç½®\n\n#### ç­›é€‰Projectä»£ç èŒƒå›´\n\n1. ç‚¹å‡»projectçª—å£çš„è®¾ç½®æŒ‰é’®ï¼Œé€‰æ‹© â€œEdit Scopesâ€\n\n   ![image-20210402104239366](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210402104239.png)\n\n2. æ–°å»ºä¸€ä¸ªè§„åˆ™ï¼Œè¾“å…¥åç§°ï¼Œå¹¶åœ¨Patternä¸­è¾“å…¥è¿‡æ»¤è§„åˆ™ï¼š `file[android]:frameworks//*||file[android]:libcore//*`\n\n   <img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210402104205.png\" alt=\"image-20210402104205399\" style=\"zoom:67%;\" />\n\n#### è¿‡æ»¤VCSé…ç½®ä¸­ä¸å¿…è¦çš„æ¨¡å—\n\næ‰“å¼€VCSé…ç½®ï¼Œç§»é™¤frameworkså’Œlibcoreä¹‹å¤–çš„æ‰€æœ‰å…¶ä»–æ¨¡å—\n\n<img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210402105446.png\" alt=\"image-20210402105446083\" style=\"zoom: 67%;\" />\n\n### ä½¿ç”¨æç¤ºï¼šå¯¼å…¥å…¶ä»–æ¨¡å—çš„æºç åˆ°AS\n\nä¸å»ºè®®ç›´æ¥ä¿®æ”¹ android.iml æ–‡ä»¶ï¼Œåº”å½“é€šè¿‡ä¿®æ”¹æºç æ ¹ç›®å½•è‡ªå®šä¹‰çš„ `excluded-paths` æ–‡ä»¶ä¸­å®šä¹‰çš„è§„åˆ™æ¥åŒ…å«å…¶ä»–æ¨¡å—çš„æºç ã€‚\n\nä¿®æ”¹æ­¤æ–‡ä»¶åï¼Œé‡æ–°æ‰§è¡Œ `development/tools/idegen/idegen.sh` æ¥ç”Ÿæˆæœ€æ–°çš„asé¡¹ç›®é…ç½®ã€‚ç”Ÿæˆå®Œæˆåä¸€èˆ¬aså¦‚æœæ˜¯æ‰“å¼€çŠ¶æ€ï¼Œä¼šè‡ªåŠ¨æ›´æ–°ç´¢å¼•ï¼Œå¦‚æœç´¢å¼•æ›´æ–°æœ‰é—®é¢˜ï¼Œå¯å…³é—­é¡¹ç›®ï¼Œç„¶åé‡æ–°æ‰“å¼€ã€‚\n\n### é”™è¯¯è§£å†³ï¼šmacOS .DS_Store å¯¼è‡´æ‰“åŒ…é•œåƒå¤±è´¥\n\nç¼–è¯‘åŸºæœ¬å®Œæˆï¼Œä½†æ˜¯æœ€åæ‰“åŒ…system.imgæ–‡ä»¶æ—¶æŠ¥é”™ï¼ŒæŠ¥é”™å†…å®¹å¦‚ä¸‹ï¼š\n\n```shell\nset_selinux_xattr: No such file or directory searching for label \"/.DS_Store\"\ne2fsdroid: No such file or directory while configuring the file system\n\n10:00:38 ninja failed with: exit status 1\n```\n\nè§£å†³æ–¹å¼ï¼šåˆ é™¤æºç ç›®å½•ä¸­çš„æ‰€æœ‰ `.DS_Store`ï¼Œå¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤è¿›è¡Œç»Ÿä¸€æ¸…ç†\n\n```shell\nfind . -name \".DS_Store\"  | xargs -I {} rm {} \n```\n\n> è¯´æ˜ï¼š .DS_Store æ–‡ä»¶ä¸ºmacOSä¸­å­˜å‚¨æ–‡ä»¶å¤¹ç•Œé¢å±•ç¤ºç›¸å…³çš„ä¸€äº›ä¿¡æ¯ï¼Œåœ¨Finderä¸­æŸ¥çœ‹å¯¹åº”ç›®å½•åå¯èƒ½ä¼šç”Ÿæˆ\n\n### é”™è¯¯è§£å†³ï¼šé™„åŠ è°ƒè¯•å™¨æ—¶ä¸æ˜¾ç¤ºè®¾å¤‡\n\nåœ¨é™„åŠ è°ƒè¯•å™¨æ—¶ï¼Œå¯èƒ½ä¼šå¦‚ä¸‹å›¾ä¸€æ ·ï¼Œæ¨¡æ‹Ÿå™¨å·²ç»å¯åŠ¨äº†ï¼Œä½†æ˜¯é™„åŠ è°ƒè¯•å™¨çš„çª—å£ä¸­è®¾å¤‡åˆ—è¡¨ä¸­æ²¡æœ‰è®¾å¤‡\n\n![image-20210402121454042](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210402121454.png)\n\næ­¤æ—¶æ£€æŸ¥è‡ªå·±çš„é¡¹ç›®é…ç½®ä¸­çš„SDKæ˜¯å¦é€‰æ‹©äº†AndroidSDKï¼Œè®¾ç½®æˆ Android SDK å³å¯\n\n<img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210402121537.png\" alt=\"image-20210402121537412\" style=\"zoom:67%;\" />\n\n\n\n### é”™è¯¯è§£å†³ï¼šæ¨¡æ‹Ÿå™¨æ— æ³•å¯åŠ¨-æŠ¥æ‰¾ä¸åˆ°å†…æ ¸ç‰ˆæœ¬ä¿¡æ¯\n\nå½“ä½¿ç”¨ `android-11.0.0_r28` ç‰ˆæœ¬æ—¶ï¼Œç¼–è¯‘é€šè¿‡åï¼Œä½¿ç”¨emulatorå¯åŠ¨æ—¶ï¼ŒæŠ¥å‡ºå¦‚ä¸‹é”™è¯¯\n\n```shell\nemulator: ERROR: Can't find 'Linux version ' string in kernel image file: /Volumes/HIKVISION/google-aosp/out/target/product/generic_x86_64/kernel-ranchu\n```\n\nåŸå› æ˜¯emulatorç‰ˆæœ¬è¿‡æ—§ï¼Œéœ€è¦ä½¿ç”¨æ–°çš„emulatorï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è·å–æ–°çš„ç‰ˆæœ¬ï¼š\n\n```shell\ncd prebuilts/android-emulator\n# æŸ¥è¯¢å¯ç”¨åˆ†æ”¯ï¼Œhttps://android.googlesource.com/platform/prebuilts/android-emulator/+refs\ngit fetch aosp android-11.0.0_r33:refs/remotes/m/android-11.0.0_r33\n# æ£€å‡ºåˆ†æ”¯\ngit co -b android-11.0.0_r33 refs/remotes/m/\nandroid-11.0.0_r33\n```\n\nè·å–å®Œæˆåå†æ¬¡æ‰§è¡Œ `emulator` å‘½ä»¤\n\n```shell\nemulator -version\n# Android emulator version 30.3.0.0 (build_id 6946397) (CL:N/A)\nemulator \n# å¯åŠ¨æ¨¡æ‹Ÿå™¨\n```\n\n## å‚è€ƒæ–‡ç« \n\n**å‚è€ƒï¼š** \n\n* [ä½¿ç”¨ Android Studio é˜…è¯» AOSP æºç ](https://blog.devwu.com/2019/06/23/how-to-reading-AOSP-with-Android-Studio/)\n* [AOSP Source Code in Android Studio (Explore only)](https://param105.medium.com/aosp-source-code-in-android-studio-explore-only-1cdc3081cf51)\n* [Stackoverflow aosp-and-intellij-idea](https://stackoverflow.com/questions/16582112/aosp-and-intellij-idea)\n* [Building Android O with a Mac - Christopher Ney](https://medium.com/@christopherney/building-android-o-with-a-mac-da07e8bd94f9)\n* [Building Android 11 for PH-1 on Apple Silicon](https://nf4789.medium.com/building-android-11-for-ph-1-on-apple-silicon-6600436a36a0)\n* [Could not find a supported mac sdk: â€œ10.10â€ â€œ10.11â€ â€œ10.12â€ â€œ10.13â€](https://stackoverflow.com/questions/50760701/could-not-find-a-supported-mac-sdk-10-10-10-11-10-12-10-13)\n* [åˆ›å»ºåŒºåˆ†å¤§å°å†™çš„ç£ç›˜æ˜ åƒ-source.android.google.cn](https://source.android.google.cn/setup/build/initializing?hl=zh-cn#creating-a-case-sensitive-disk-image)\n\n\n\n",
      "data": {
        "title": "æ­å»ºAndroidæºç å·¥ä½œç¯å¢ƒ",
        "date": "2021-04-08 10:18:50",
        "tags": [
          "Android",
          "æºç åˆ†æ"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "\n\n* ç®€å•ä»‹ç»ç³»ç»Ÿæ¶æ„ã€ç¼–è¯‘ç¯å¢ƒçš„æ­å»º\n* ç®€å•ä»‹ç»åˆ©ç”¨ AndroidStudio è°ƒè¯• system_process è¿›ç¨‹çš„æ–¹æ³•åŠç¼–è¯‘æ›´æ–°éƒ¨åˆ†ç³»ç»Ÿæ¨¡å—çš„æ–¹å¼",
      "fileName": "æ­å»ºAndroidæºç å·¥ä½œç¯å¢ƒ"
    },
    {
      "content": "ä»…è®°å½•ä½¿ç”¨Grideaè¿‡ç¨‹ä¸­è§£å†³çš„é—®é¢˜åŠè§£å†³æ–¹å¼\n<!-- more -->\n\n\n\n## ä¸‹è½½å®‰è£…å¹¶ä½¿ç”¨\nè®¿é—®è¿™é‡Œï¼ˆhttps://gridea.dev/ï¼‰ä¸‹è½½å®‰è£…å¹¶ä½¿ç”¨ï¼Œä¸èµ˜è¿°ã€‚\n\n## è¿œç¨‹åŒæ­¥githubé…ç½®\nå…³äºå»ºç«‹ä»“åº“ï¼Œè·å–tokenï¼Œé…ç½®pagesèµ˜è¿°ï¼Œä»…è®°å½•é¢å¤–çš„é…ç½®ã€‚\n\n\nåœ¨Grideaçš„å·¥ä½œç›®å½•çš„æ ¹ç›®å½•ä¸­æ–°å»ºä¸€ä¸ª `.gitignore` æ–‡ä»¶ï¼Œè¾“å…¥å¦‚ä¸‹å†…å®¹ï¼š\n```txt\n.DS_Store\n*/.DS_Store\n# è‡ªå·±çš„æœ¬åœ°è‰ç¨¿\ntypora\n```\n> è¿œç¨‹åŒæ­¥æ—¶ï¼Œä¼šå°†æ­¤æ–‡ä»¶æ”¾å…¥åˆ°outputç›®å½•ä¸‹ï¼Œç„¶åå°†outputç›®å½•æ¨é€åˆ°githubä¸Šï¼Œä¸ºäº†é¿å…å°†å…¶ä¸­çš„æŸäº›æ–‡ä»¶æ¨å…¥åˆ°è¿œç¨‹ä»“åº“ï¼Œæ•…å¯ä»¥é€šè¿‡æ­¤æ–¹å¼å®šä¹‰gitignore\n",
      "data": {
        "title": "Grideaä½¿ç”¨å°è®°",
        "date": "2021-04-05 11:58:07",
        "tags": [
          "å·¥å…·"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "ä»…è®°å½•ä½¿ç”¨Grideaè¿‡ç¨‹ä¸­è§£å†³çš„é—®é¢˜åŠè§£å†³æ–¹å¼",
      "fileName": "Grideaä½¿ç”¨å°è®°"
    },
    {
      "content": "ç¿»è¯‘å›½å¤–æ–‡ç« ï¼Œè¯¥æ–‡ç« ä»‹ç»äº†Androidå¼€å‘ä¸­çŸ©é˜µç›¸å…³çš„æ•°å­¦çŸ¥è¯†ï¼ŒåŒ…æ‹¬çŸ©é˜µæ˜¯ä»€ä¹ˆï¼ŸçŸ©é˜µåŠ æ³•åŠä¹˜æ³•è¿ç®—ï¼Œ2x2çŸ©é˜µçš„å˜æ¢ï¼Œæœ€åæ¼”è¿›ä¸ºAndroidä¸­ä½¿ç”¨çš„3x3çŸ©é˜µã€‚æ–‡ä¸­å›¾ç‰‡åŠåŠ¨å›¾æ¯”è¾ƒå¤šï¼Œç›¸å¯¹å¥½æ‡‚ã€‚\n<!-- more -->\n\n\n> åŸæ–‡é“¾æ¥ï¼šhttps://i-rant.arnaudbos.com/matrices-for-developers/#technical-challenge\n\nå‡ å‘¨å‰ï¼Œæˆ‘åœ¨ä¸€ä¸ªandroid-user-groupé¢‘é“ä¸Šï¼Œæœ‰äººé—®ä¸€ä¸ªå…³äºAndroidçš„Matrix.postScaleï¼ˆsxï¼Œsyï¼Œpxï¼Œpyï¼‰æ–¹æ³•åŠå…¶å·¥ä½œåŸç†çš„é—®é¢˜ï¼Œå› ä¸ºå®ƒâ€œéš¾ä»¥æŒæ¡â€ã€‚ \n\nåœ¨2016å¹´åˆï¼Œæˆ‘åœ¨ä¸€ä¸ªAndroidåº”ç”¨ç¨‹åºä¸Šå®Œæˆäº†ä¸€ä¸ªè‡ªç”±é¡¹ç›®ï¼Œåœ¨å…¶ä¸­æˆ‘å¿…é¡»å®ç°ä¸€ä¸ªä»¤äººå…´å¥‹çš„åŠŸèƒ½ï¼š \n\nç”¨æˆ·åœ¨è´­ä¹°å¹¶ä¸‹è½½äº†å²©å£çš„æ•°å­—åœ°å½¢åï¼Œå¿…é¡»èƒ½å¤ŸæŸ¥çœ‹ç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆçš„å²©å£ï¼š \n\n* æ‚¬å´–çš„ç…§ç‰‡ï¼Œ \n* åŒ…å«çˆ¬å¡è·¯çº¿å åŠ å±‚çš„SVGæ–‡ä»¶ã€‚ \n\nç”¨æˆ·å¿…é¡»å…·æœ‰éšæ„å¹³ç§»å’Œç¼©æ”¾çš„èƒ½åŠ›ï¼Œå¹¶ä¸”å¿…é¡»å…·æœ‰â€œè·Ÿéšâ€å›¾ç‰‡çš„è·¯çº¿å±‚ã€‚ \n\n| APPæˆªå›¾1                                                     | APPæˆªå›¾2                                                     | APPæˆªå›¾3                                                     |\n| ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |\n| <img src=\"Matrices for developers_files/ca-screenshot-1.png\" alt=\"img\" style=\"zoom:25%;\" /> | <img src=\"Matrices for developers_files/ca-screenshot-2.png\" alt=\"img\" style=\"zoom:25%;\" /> | <img src=\"Matrices for developers_files/ca-screenshot-3.png\" alt=\"img\" style=\"zoom:25%;\" /> |\n\n\n\n## æŠ€æœ¯æŒ‘æˆ˜\n\nä¸ºäº†è®©æ”€çˆ¬è·¯çº¿çš„å›¾å±‚èƒ½å¤Ÿè·Ÿéšç”¨æˆ·çš„æ‰‹åŠ¿æ“ä½œï¼Œæˆ‘å‘ç°æˆ‘ä¸å¾—ä¸é‡è½½Android ImageViewï¼Œåœ¨Canvasä¸Šç»˜åˆ¶å¹¶å¤„ç†æ‰‹æŒ‡æ‰‹åŠ¿ã€‚ ä½œä¸ºä¸€åä¼˜ç§€çš„å·¥ç¨‹å¸ˆï¼šæˆ‘æœç´¢äº†Stack OverflowğŸ˜… æˆ‘å‘ç°éœ€è¦`android.graphics.Matrix`ç±»è¿›è¡Œ2Dè½¬æ¢ã€‚ \n\nè¿™ä¸ªç±»çš„é—®é¢˜åœ¨äºï¼Œä»æ–¹æ³•åç§°æ¥è¯´ï¼Œä½ èƒ½å¾ˆæ¸…æ¥šçš„äº†è§£å®ƒçš„ä½œç”¨ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰æ²¡æœ‰ä¸€å®šçš„æ•°å­¦èƒŒæ™¯çŸ¥è¯†ï¼Œä½ å¾ˆéš¾äº†è§£å®ƒèƒŒåæ˜¯æ€ä¹ˆå®ç°çš„ï¼Œæ¯”æ–¹è¯´ä¸‹é¢æ˜¯matrixçš„æŸä¸ªæ–¹æ³•çš„APIæ–‡æ¡£è¯´æ˜ï¼š\n\n> boolean postScale (float sx, float sy, float px, float py)\n>\n> Postconcats the matrix with the specified scale. Mâ€™ = S(sx, sy, px, py) * M\n\nä»æ–‡æ¡£çœ‹èµ·å®ƒå¯ä»¥é€šè¿‡æŸäº›å‚æ•°ç¼©æ”¾æŸäº›ä¸œè¥¿ï¼Œå¹¶é€šè¿‡æŸç§ä¹˜æ³•æ¥å®Œæˆå®ƒã€‚ä¸è¿‡æˆ‘è¿˜æ˜¯æœ‰å¾ˆå¤šç–‘é—®ï¼š \n\n* å®ƒåˆ°åº•æ˜¯åšä»€ä¹ˆçš„ï¼Ÿ ç¼©æ”¾çŸ©é˜µï¼Ÿ é‚£æ˜¯ä»€ä¹ˆæ„æ€ï¼Œæˆ‘æƒ³ç¼©æ”¾ç”»å¸ƒâ€¦ \n* æˆ‘åº”è¯¥ä½¿ç”¨preScaleè¿˜æ˜¯postScaleï¼Ÿ å½“æˆ‘ä»ä»æ‰‹åŠ¿æ£€æµ‹ä»£ç è·å–è¾“å…¥å‚æ•°ï¼Œç„¶åè¿›å…¥å°è¯•å’Œé”™è¯¯çš„æ— é™å¾ªç¯æ—¶ï¼Œæ˜¯å¦éœ€è¦å°è¯•åŒæ—¶ä½¿ç”¨è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Ÿ \n\nå› æ­¤ï¼Œåœ¨å¼€å‘è¿‡ç¨‹çš„è¿™ä¸€åˆ»ï¼Œæˆ‘æ„è¯†åˆ°åœ¨å®Œæˆå¤§å­¦çš„å¤´ä¸¤å¹´åï¼Œæˆ‘éœ€è¦é‡æ–°å­¦ä¹ å¾ˆå¤šå¹´å‰å…³äºçŸ©é˜µçš„åŸºæœ¬æ•°å­¦æŠ€èƒ½ã€‚ \n\n\n\nåœ¨æœå¯»ç½‘ç»œèµ„æ–™æ—¶ï¼Œæˆ‘å‘ç°äº†å¾ˆå¤šä¸é”™çš„èµ„æºï¼Œå¹¶ä¸”èƒ½å¤Ÿå†æ¬¡å­¦ä¹ ä¸€äº›æ•°å­¦çŸ¥è¯†ã€‚ é€šè¿‡å°†æˆ‘çš„ç†è§£åº”ç”¨åˆ°Javaå’ŒAndroidä¸­çš„ä»£ç ï¼Œå®ƒè¿˜å¸®åŠ©æˆ‘è§£å†³äº†2Dè½¬æ¢é—®é¢˜ã€‚ å› æ­¤ï¼Œè€ƒè™‘åˆ°æˆ‘åœ¨ä¸Šé¢æåˆ°çš„é¢‘é“ä¸Šè¿›è¡Œçš„è®¨è®ºï¼Œä¼¼ä¹æˆ‘ä¸æ˜¯å”¯ä¸€ä¸€ä¸ªåœ¨çŸ©é˜µä¸­è‹¦è‹¦æŒ£æ‰çš„äººï¼Œè¯•å›¾å¼„æ˜ç™½è¿™ä¸€ç‚¹ï¼Œå¹¶åœ¨Androidçš„Matrixç±»å’Œæ–¹æ³•ä¸­ä½¿ç”¨è¿™äº›æŠ€èƒ½ï¼Œæ‰€ä»¥æˆ‘æƒ³æˆ‘ä¼šå†™ä¸€ç¯‡æ–‡ç« ï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯å…³äºçŸ©é˜µçš„ï¼Œç¬¬äºŒéƒ¨åˆ†â€œ[ä½¿ç”¨Androidå’ŒJavaè¿›è¡Œ2Dè½¬æ¢](https://i-rant.arnaudbos.com/2d-transformations-android-java/)â€æ˜¯å…³äºå¦‚ä½•åœ¨Javaå’ŒAndroidä¸Šå°†å…³äºçŸ©é˜µçš„çŸ¥è¯†åº”ç”¨åˆ°ä»£ç ä¸­ã€‚ \n\n## Matrixæ˜¯ä»€ä¹ˆï¼Ÿ\n\næˆ‘åœ¨å¯æ±—å­¦é™¢ï¼ˆKhan Academyï¼‰ä¸Šå‘ç°ä¸€é—¨[å…³äºçŸ©é˜µçš„å¾ˆå¥½çš„ä»£æ•°è¯¾ç¨‹](https://www.khanacademy.org/math/algebra-home/alg-matrices)ã€‚ \n\nå¦‚æœä½ ä¹Ÿé‡åˆ°æ­¤ç±»é—®é¢˜ï¼Œæˆ‘è§‰å¾—ä½ ä¹Ÿå¯ä»¥èŠ±æ—¶é—´æ¥å­¦ä¹ è¿™ä¸ªè¯¾ç¨‹ï¼Œç­‰åˆ°ä½ è§‰å¾—â€œåŸæ¥å°±æ˜¯è¿™æ ·â€ï¼Œå°±å·®ä¸å¤šäº†ã€‚å®é™…ä¸Šå­¦ä¹ è¿™äº›è¯¾ç¨‹åªéœ€å‡ ä¸ªå°æ—¶çš„æŠ•èµ„ï¼Œè€Œä¸”è¯¾ç¨‹æ˜¯å…è´¹çš„ï¼Œä½ ä¸€å®šä¸ä¼šåæ‚”ã€‚ \n\nçŸ©é˜µæ“…é•¿è¡¨ç¤ºæ•°æ®ï¼Œæ‰€ä»¥å¯¹çŸ©é˜µçš„æ“ä½œå¯ä»¥å¸®åŠ©æ‚¨è§£å†³æ­¤æ•°æ®ä¸Šçš„é—®é¢˜ã€‚è¿˜è®°å¾—åœ¨å­¦æ ¡å¿…é¡»è§£çº¿æ€§æ–¹ç¨‹ç»„å—ï¼Ÿ\n\nè§£çº¿æ€§æ–¹ç¨‹ç»„æœ€å¸¸è§æ–¹æ³•ï¼ˆè‡³å°‘æ˜¯æˆ‘ç ”ç©¶è¿‡çš„ä¸¤ç§æ–¹æ³•ï¼‰æ˜¯æ¶ˆå…ƒæ³•æˆ–è¡Œå‡å°‘æ–¹æ³•ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨çŸ©é˜µæ¥è¿›è¡Œçº¿æ€§æ–¹ç¨‹ç»„çš„æ±‚è§£ã€‚\n\nçŸ©é˜µåœ¨æ¯ä¸ªç§‘å­¦åˆ†æ”¯ä¸­éƒ½å¤§é‡ä½¿ç”¨ï¼Œå®ƒä»¬ä¹Ÿå¯ä»¥ç”¨äºçº¿æ€§å˜æ¢æ¥æè¿°ç‚¹åœ¨ç©ºé—´ä¸­çš„ä½ç½®ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬å°†åœ¨æœ¬æ–‡ä¸­ç®€è¦ç ”ç©¶çš„ã€‚ \n\n### è§£åˆ¨\n\nç®€å•æ¥è¯´ï¼ŒçŸ©é˜µæ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œå®é™…ä¸Šï¼Œä¸€ä¸ª $m\\ \\times n$ çš„çŸ©é˜µå¯ä»¥å¯¹åº”äºä¸€ä¸ªé•¿åº¦ä¸º $m$ çš„æ•°ç»„ï¼Œè¯¥æ•°ç»„çš„æ¯ä¸ªitemæ˜¯å¦å¤–ä¸€ä¸ªé•¿åº¦ä¸º $n$ çš„æ•°ç»„ã€‚ é€šå¸¸æ¥è¯´ $m$ ä»£è¡¨äº†è¡Œæ•°ï¼Œ$n$ ä»£è¡¨åˆ—æ•°ï¼Œmatrixä¸­çš„æ¯ä¸ªå…ƒç´ ç§°ä¹‹ä¸º æ¡ç›®-$entry$ .\n\nçŸ©é˜µä½¿ç”¨ä¸€ä¸ªç²—ä½“å¤§å†™å­—æ¯è¡¨ç¤ºï¼Œæ¯ä¸ª $entry$ ä½¿ç”¨å¯¹åº”çš„å°å†™å­—æ¯è¡¨ç¤ºï¼ŒåŒæ—¶ä½¿ç”¨è¡Œå·å’Œåˆ—å·ç»„åˆæˆä¸ºä¸‹æ ‡ï¼Œä¸€ä¸ªçŸ©é˜µçš„ç¤ºä¾‹å¦‚ä¸‹ï¼š\n$$\n\\textbf{A} = \\begin{pmatrix} \na_{11} & a_{12} &  ...  & a_{1n} \\\\ \na_{21} & a_{12} &  ...  & a_{1n} \\\\ \nâ‹® & â‹® &  â‹±  & â‹® \\\\ \na_{m1} & a_{m2} &  ...  & a_{mn} \\\\ \n\\end{pmatrix}\n$$\n\n\næ¥ä¸‹æ¥æˆ‘ä»¬å°†å­¦ä¹ çŸ©é˜µçš„ä¸€äº›è¿ç®—ï¼š[åŠ æ³•å’Œå‡æ³•](https://www.khanacademy.org/bigbingo_redirect?continue=https%3A%2F%2Fwww.khanacademy.org%2Fmath%2Falgebra-home%2Falg-matrices%2Falg-adding-and-subtracting-matrices%2Fv%2Fmatrix-addition-and-subtraction-1&conversion_ids=condensed_tutorial_title_click)å’Œ[ä¹˜æ³•ï¼ˆmultiplicationï¼‰](https://www.khanacademy.org/math/algebra-home/alg-matrices/alg-multiplying-matrices-by-matrices/a/multiplying-matrices)ã€‚ \n\n### åŠ æ³•å’Œå‡æ³•\n\n[çŸ©é˜µçš„åŠ æ³•å’Œå‡æ³•](https://www.khanacademy.org/bigbingo_redirect?continue=https%3A%2F%2Fwww.khanacademy.org%2Fmath%2Falgebra-home%2Falg-matrices%2Falg-adding-and-subtracting-matrices%2Fv%2Fmatrix-addition-and-subtraction-1&conversion_ids=condensed_tutorial_title_click)æ˜¯é€šè¿‡çŸ©é˜µçš„ç›¸åº”çš„entryç›¸åŠ æˆ–ç›¸å‡æ¥å®Œæˆçš„ï¼Œè®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š\n$$\n\\textbf{A} + \\textbf{B} = \\begin{pmatrix} \na_{11} & a_{12} &  ...  & a_{1n} \\\\ \na_{21} & a_{12} &  ...  & a_{1n} \\\\ \nâ‹® & â‹® &  â‹±  & â‹® \\\\ \na_{m1} & a_{m2} &  ...  & a_{mn} \\\\ \n\\end{pmatrix} + \n\\begin{pmatrix} \nb_{11} & b_{12} &  ...  & b_{1n} \\\\ \nb_{21} & b_{12} &  ...  & b_{1n} \\\\ \nâ‹® & â‹® &  â‹±  & â‹® \\\\ \nb_{m1} & b_{m2} &  ...  & b_{mn} \\\\ \n\\end{pmatrix}= \n\\begin{pmatrix} \na_{11} + b_{11} & a_{12}+b_{12} &  ...  & a_{1n}+b_{1n} \\\\ \na_{21}+b_{21} \t& a_{12}+b_{12} &  ...  & a_{1n}+b_{1n} \\\\ \nâ‹® \t\t\t\t&\tâ‹® \t\t\t&   â‹±  \t& \tâ‹® \t\t\t\\\\ \na_{m1}+b_{m1} \t& a_{m2}+b_{m2} &  ...  & a_{mn}+b_{mn} \\\\ \n\\end{pmatrix}\n$$\nä»ä¸Šé¢çš„è®¡ç®—æ–¹å¼å¯ä»¥ç¡®å®šï¼ŒçŸ©é˜µçš„åŠ æ³•å’Œå‡æ³•åªèƒ½æ˜¯ä¸¤ä¸ªå…·æœ‰ç›¸åŒç»´åº¦ï¼ˆ$m \\times n$ï¼‰çš„çŸ©é˜µä¹‹é—´è¿›è¡Œï¼›\n\n**åŠ æ³•ç¤ºä¾‹ï¼š**\n$$\n\\textbf{A} + \\textbf{B} = \\begin{pmatrix} \n4 & -8  &  7 \\\\ \n0 & 2 &  3 \\\\ \n15 & 4 & 9 \\\\\n\\end{pmatrix} + \n\\begin{pmatrix} \n-5 & 2  & 3 \\\\\n4 & -1 & 6 \\\\\n0 & 12 & 3 \\\\\n\\end{pmatrix}= \n\\begin{pmatrix} \n4+(-5) & (-8)+2 & 7+3 \\\\\n0+4 & 2+(-1) & (-1)+6 \\\\\n15+0 & 4+12 & 9+3 \\\\\n\\end{pmatrix}= \n\\begin{pmatrix} \n-1 & -6 & 10 \\\\\n4 & 1 & -5 \\\\\n15 & 16 & 12 \\\\\n\\end{pmatrix}\n$$\n\n**å‡æ³•ç¤ºä¾‹ï¼š**\n$$\n\\textbf{A} + \\textbf{B} = \n\\begin{pmatrix} \n    4 & -8  &  7 \\\\ \n    0 & 2 &  3 \\\\ \n    15 & 4 & 9 \\\\\n\\end{pmatrix}+ \n\\begin{pmatrix} \n    -5 & 2  & 3 \\\\\n    4 & -1 & 6 \\\\\n    0 & 12 & 3 \\\\\n\\end{pmatrix}= \n\\begin{pmatrix} \n    4-(-5) & (-8)-2 & 7-3 \\\\\n    0-4 & 2-(-1) & (-1)-6 \\\\\n    15-0 & 4-12 & 9-3 \\\\\n\\end{pmatrix}= \n\\begin{pmatrix} \n    9  &  -10  &   4 \\\\\n    -4  &   3  &  -7 \\\\\n    15  &  -8  &   6 \\\\\n\\end{pmatrix}\n$$\n\n\n### çŸ©é˜µä¹˜æ³•\n\nä¸Šæ•°å­¦è¯¾çš„æ—¶å€™ï¼Œè€å¸ˆè¯´è¿‡ï¼šâ€œä½ ä¸èƒ½åœ¨æ©˜å­é‡ŒåŠ è‹¹æœï¼Œè¿™æ˜¯æ²¡æœ‰é“ç†çš„â€ï¼Œç„¶åå‘Šè¯‰æˆ‘ä»¬å•ä½åœ¨è¿ç®—ä¸­çš„é‡è¦æ€§ï¼Œä¹Ÿå°±æ˜¯ä¸åŒå•ä½çš„æ“ä½œæ•°ä¸èƒ½è¿›è¡Œè¿ç®—ã€‚ \n\nä½†æ˜¯ï¼Œå¯¹äºçŸ©é˜µæ¥è¯´ï¼Œè‹¹æœå’Œæ©™å­ç›¸ä¹˜æ˜¯åˆæ³•çš„ï¼Œæˆ‘ä»¬åªèƒ½å°†çŸ©é˜µåŠ åˆ°ç›¸åŒç»´åº¦çš„çŸ©é˜µä¸Šï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å°†çŸ©é˜µä¸æ•°å­—å’Œå…¶ä»–ç»´åº¦ä¸åŒçš„çŸ©é˜µç›¸ä¹˜ã€‚ \n\n#### æ ‡é‡ $\\times$ çŸ©é˜µ\n\nåœ¨çŸ©é˜µçš„ä¹˜æ³•ä¸­ï¼Œå•ä¸€çš„æ•°å­—å®é™…ä¸Šåº”è¯¥ç§°ä¹‹ä¸ºæ ‡é‡ï¼ˆ$\\textbf{scalar}$ï¼‰ï¼Œä¸‹é¢çš„è¿ç®—ä¸­ï¼Œå®é™…ä¸Šä¸æ˜¯å°†çŸ©é˜µä¹˜ä»¥æ•°å­—ï¼Œè€Œæ˜¯å°†çŸ©é˜µä¹˜ä»¥æ ‡é‡ã€‚çŸ©é˜µä¹˜ä»¥æ ‡é‡çš„è®¡ç®—æ–¹å¼æ˜¯ï¼š**å°†çŸ©é˜µä¸­çš„æ¯ä¸ªæ¡ç›®ä¹˜ä»¥æ ‡é‡ï¼Œç„¶åå¾—åˆ°å¦å¤–ä¸€ä¸ªçŸ©é˜µ**ã€‚ \n$$\n\\textit{k} . \\textbf{A} =  \n\\textit{k} .\n\\begin{pmatrix} \na_{11} & a_{12} &  ...  & a_{1n} \\\\ \na_{21} & a_{12} &  ...  & a_{1n} \\\\ \nâ‹® & â‹® &  â‹±  & â‹® \\\\ \na_{m1} & a_{m2} &  ...  & a_{mn} \\\\ \n\\end{pmatrix}= \n\\begin{pmatrix} \n\\textit{k} . a_{11} & \\textit{k} . a_{12} &  ...  & \\textit{k} . a_{1n} \\\\ \n\\textit{k} .a_{21} \t& \\textit{k} . a_{12} &  ...  & \\textit{k} . a_{1n} \\\\ \nâ‹® \t\t\t\t&\tâ‹® \t\t\t&   â‹±  \t& \tâ‹® \t\t\t\\\\ \n\\textit{k} .a_{m1} \t& \\textit{k} . a_{m2} &  ...  & \\textit{k} . a_{mn} \\\\ \n\\end{pmatrix}\n$$\nä¸€ä¸ªç®€å•çš„**ç¤ºä¾‹**å¦‚ä¸‹ï¼š\n$$\n4 . \\begin{pmatrix}\n0 & 3 & 12 \\\\\n7 & -5 & 1 \\\\\n-8 & 2 & 0  \\\\\n\\end{pmatrix} =  \n\\begin{pmatrix}\n0 & 12 & 48 \\\\\n28 & -20 & 4 \\\\\n-32 & 8 & 0  \\\\\n\\end{pmatrix} \n$$\n\n\n#### çŸ©é˜µ $\\times$ çŸ©é˜µ\n\nå¦å¤–ä¸€ç§çŸ©é˜µä¹˜æ³•å°±æ˜¯ [çŸ©é˜µä¹˜ä»¥çŸ©é˜µ](https://www.khanacademy.org/math/algebra-home/alg-matrices/alg-multiplying-matrices-by-matrices/a/multiplying-matrices) ï¼ŒçŸ©é˜µä¹˜æ³•è¿ç®—èµ·æ¥ç¨å¾®æœ‰ç‚¹å¤æ‚ï¼Œå› ä¸ºæˆ‘ä»¬å¹¶ä¸èƒ½ç®€å•çš„å¯¹åº”çš„entryè¿›è¡Œä¹˜æ³•è¿ç®—ï¼Œå…·ä½“è®¡ç®—è§„åˆ™æˆ‘ä»¬ç›´æ¥çœ‹ç»´åŸºç™¾ç§‘çš„è¯´æ˜ï¼š\n\n> å¦‚æœ $\\mathbf{A}$ æ˜¯ä¸€ä¸ª $m \\times n$ çš„ çŸ©é˜µï¼Œ$\\mathbf{B}$ æ˜¯ä¸€ä¸ª $n \\times p$ çš„matrix, é‚£ä¹ˆå®ƒä»¬çš„çŸ©é˜µä¹˜ç§¯ $\\mathbf{AB}$ æ˜¯ä¸€ä¸ª $m \\times p $çš„çŸ©é˜µ, \n>\n> å…¶ä¸­çŸ©é˜µ $\\mathbf{A}$ è¡Œä¸­çš„ $n$ ä¸ªæ¡ç›®ä¸çŸ©é˜µ $\\mathbf{B}$ åˆ—ä¸­çš„ $n$ ä¸ªæ¡ç›® ç›¸ä¹˜å¹¶æ±‚å’Œ å¾—å‡ºçŸ©é˜µ $\\mathbf{AB}$ çš„æ¡ç›®ã€‚\n\nçœ‹èµ·æ¥æœ‰ç‚¹å¤æ‚ï¼Œè®©æˆ‘ä»¬é€æ®µåˆ†è§£çš„æ¥çœ‹ï¼š\n\n> å¦‚æœ $\\mathbf{A}$ æ˜¯ä¸€ä¸ª $m \\times n$ çš„ çŸ©é˜µï¼Œ$\\mathbf{B}$ æ˜¯ä¸€ä¸ª $n \\times p$ çš„matrix, é‚£ä¹ˆå®ƒä»¬çš„çŸ©é˜µä¹˜ç§¯ $\\mathbf{AB}$ æ˜¯ä¸€ä¸ª $m \\times p$ çš„çŸ©é˜µ\n\nä¸Šé¢çš„è§„åˆ™æˆ‘ä»¬å¯ä»¥å†™æˆï¼š $\\mathbf{A}_{m \\times n}  \\times \\mathbf{B}_{n \\times p} = \\mathbf{AB}_{m \\times p}$\n\nçœ‹ä¸€ä¸ªç®€å•çš„çŸ©é˜µ $\\mathbf{A}_{2 \\times 3} = \\begin{pmatrix} a_{11} & a_{12} & a_{13} \\\\ a_{21}&a_{22}&a_{23} \\end{pmatrix}$ å’Œå¦å¤–ä¸€ä¸ªçŸ©é˜µ $\\mathbf{B}_{3 \\times 1} = \\begin{pmatrix} b_{11} \\\\ b_{21} \\\\ b_{31}  \\end{pmatrix}$ ï¼Œè¿™é‡Œ$m = 2, n=3, p=1$ï¼Œæ‰€ä»¥çŸ©é˜µä¹˜ç§¯ä¸ºä¸€ä¸ª$2\\times1$çš„çŸ©é˜µï¼š $\\mathbf{AB}=\\begin{pmatrix} ab_{11} \\\\ ab_{12} \\end{pmatrix}$ã€‚\n\næ¥ä¸‹æ¥æˆ‘ä»¬åˆ†è§£ç¬¬äºŒéƒ¨åˆ†ï¼š\n\n* ==çŸ©é˜µ $\\mathbf{A}$ è¡Œä¸­çš„ $n$ ä¸ªæ¡ç›®== æŒ‡çš„æ˜¯ï¼šçŸ©é˜µ $\\mathbf{A}$ çš„æ¯ä¸€è¡Œéƒ½æ˜¯ä¸€ä¸ª $n=3$ çš„æ•°ç»„ï¼Œç¬¬ä¸€è¡Œæˆ‘ä»¬å¯ä»¥è®°ä¸º $a_{11}, a_{12} , a_{13}$\n* ==çŸ©é˜µ $\\mathbf{B}$ åˆ—ä¸­çš„ $n$ ä¸ªæ¡ç›®== æŒ‡çš„æ˜¯ï¼šçŸ©é˜µ $\\mathbf{B}$ ä¸­çš„æ¯ä¸€åˆ—ä¹Ÿæ˜¯ä¸€ä¸ª $n=3$ çš„æ•°ç»„ï¼Œç¬¬ä¸€åˆ—å¯ä»¥è®°ä¸ºï¼š $b_{11}, b_{12} , b_{13}$\n* ==ç›¸ä¹˜== æŒ‡ï¼š $\\mathbf{A}$ çš„è¡Œä¸­çš„æ¯ä¸ªæ¡ç›®éƒ½ä¸ $\\mathbf{B}$ çš„åˆ—ä¸­çš„æ¯ä¸ªå¯¹åº”æ¡ç›®ä¸€ä¸€ç›¸ä¹˜ï¼ˆç¬¬ä¸€ä¸ªæ¡ç›®å¯¹åº”ç¬¬ä¸€ä¸ªï¼Œç¬¬äºŒå¯¹ç¬¬äºŒï¼Œä¾æ¬¡ï¼‰ï¼Œç»“æœå°±æ˜¯ï¼š$a_{11} \\times b_{11}, a_{12} \\times b_{12} \\ å’Œ \\  a_{13} \\times b_{13}$\n* ==æ±‚å’Œ== æŒ‡ï¼šç´¯åŠ è¿™äº›å¯¹åº”çš„è¡Œå’Œåˆ—æ¡ç›®çš„ä¹˜ç§¯ï¼Œå¾—åˆ°æ–°çš„çŸ©é˜µåœ¨è¯¥è¡Œå·å’Œåˆ—å·å¤„çš„æ–°çš„æ¡ç›®ï¼Œæ–°çš„æ¡ç›®çš„å€¼ä¸ºï¼š$a_ {11} \\times b_ {11} + a_ {12} \\times b_ {21} + a_{13} \\times b_ {31}$\n\n$$\n\\mathbf{A} = \\begin{pmatrix} a_{11} & a_{12} & \\cdots & a_{1n}\\\\ a_{21} & a_{22} & \\vdots & a_{2n}\\\\ \\vdots & \\vdots & \\ddots & \\vdots\\\\ a_{m1} & a_{m2} & \\cdots & a_{mn} \\end{pmatrix} \\text{, } \\mathbf{B} = \\begin{pmatrix} b_{11} & b_{12} & \\cdots & b_{1p}\\\\ b_{21} & b_{22} & \\vdots & b_{2p}\\\\ \\vdots & \\vdots & \\ddots & \\vdots\\\\ b_{n1} & b_{n2} & \\cdots & b_{np} \\end{pmatrix} \\\\ \\\\\n\\mathbf{AB} = \\begin{pmatrix} ab_{11} & ab_{12} & \\cdots & ab_{1p}\\\\ ab_{21} & ab_{22} & \\vdots & ab_{2p}\\\\ \\vdots & \\vdots & \\ddots & \\vdots\\\\ ab_{m1} & ab_{m2} & \\cdots & ab_{mp} \\end{pmatrix} \\text{å…¶ä¸­ } ab_{ij}=\\sum_{k=1}^{m}a_{ik}b_{kj}\n$$\n\næˆ‘ä»¬ç”¨ä¸€ä¸ªå¯è§†åŒ–çš„æ–¹å¼æ¥è¡¨ç¤ºè¿™ä¸ªè¿‡ç¨‹ï¼š\n\n![Matrix multiplication diagram 2](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210308191112.png)\n\n$$\n\\mathbf{A} = \\begin{pmatrix} 4 & 3\\\\ 0 & -5\\\\ 2 & 1\\\\ -6 & 8 \\end{pmatrix} \\text{, } \\mathbf{B} = \\begin{pmatrix} 7 & 1 & 3\\\\ -2 & 4 & 1 \\end{pmatrix}\n\\\\ \n\\begin{aligned} \\mathbf{AB} &= \\begin{pmatrix} 4\\times7+3\\times\\left(-2\\right) & 4\\times1+3\\times4 & 4\\times3+3\\times1\\\\ 0\\times7+\\left(-5\\right)\\times\\left(-2\\right) & 0\\times1+\\left(-5\\right)\\times4 & 0\\times3+\\left(-5\\right)\\times1\\\\ 2\\times7+1\\times\\left(-2\\right) & 2\\times1+1\\times4 & 2\\times3+1\\times1\\\\ \\left(-6\\right)\\times7+8\\times\\left(-2\\right) & \\left(-6\\right)\\times1+8\\times4 & \\left(-6\\right)\\times3+8\\times1 \\end{pmatrix}\\\\\\\\ &= \\begin{pmatrix} 28-6 & 4+12 & 12+3\\\\ 0+10 & 0-20 & 0-5\\\\ 14-2 & 2+4 & 6+1\\\\ -42-16 & -6+32 & -18+8 \\end{pmatrix}\\\\\\\\ \\mathbf{AB} &= \\begin{pmatrix} 22 & 16 & 15\\\\ 10 & -20 & -5\\\\ 12 & 6 & 7\\\\ -58 & 26 & -10 \\end{pmatrix} \\end{aligned}\n$$\n\n\n> æ³¨æ„ï¼š\n>\n> ä¸ºäº†å®šä¹‰çŸ©é˜µä¹˜æ³•ï¼Œ==ç¬¬ä¸€ä¸ªçŸ©é˜µä¸­çš„åˆ—æ•°==å¿…é¡»ç­‰äº==ç¬¬äºŒä¸ªçŸ©é˜µä¸­çš„è¡Œæ•°==ã€‚\n\n\n**äº†è§£æ›´å¤šï¼š**\n\n* [äº†è§£æ›´å¤š](https://www.khanacademy.org/math/algebra-home/alg-matrices/alg-properties-of-matrix-multiplication/v/defined-and-undefined-matrix-operations)\n* [äº†è§£æ›´å¤š](https://www.khanacademy.org/math/algebra-home/alg-matrices/alg-properties-of-matrix-multiplication/a/matrix-multiplication-dimensions)\n\n## å˜æ¢çŸ©é˜µ\n\nç°åœ¨æˆ‘ä»¬çŸ¥é“äº†çŸ©é˜µæ˜¯ä»€ä¹ˆï¼Œå¹¶ä¸”çŸ¥é“çŸ©é˜µå¦‚ä½•ç›¸ä¹˜ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸‹çŸ©é˜µå¦‚ä½•åº”ç”¨äºäºŒç»´å˜æ¢ï¼›\n\n### è½¬æ¢ç‚¹\n\næ­£å¦‚ä¹‹å‰æ‰€è¯´ï¼ŒçŸ©é˜µå¯ä»¥è¢«ç”¨äºè¡¨ç¤ºçº¿æ€§æ–¹ç¨‹ç»„ï¼Œå‡è®¾æˆ‘ä»¬æœ‰å¦‚ä¸‹æ–¹ç¨‹ç»„ï¼š\n$$\n2x + y = 5 \\\\\n-x + 2y = 0\n$$\nå¦‚æœä½ å¯¹çŸ©é˜µä¹˜æ³•å¾ˆç†Ÿæ‚‰ï¼Œä½ å¯èƒ½çœ‹åˆ°ä¸Šè¿°æ–¹ç¨‹ä¸­éšè—çš„çŸ©é˜µä¹˜æ³•ï¼š\n$$\n\\begin{pmatrix}\n2 & 1 \\\\\n-1 & 2 \\\\ \n\\end{pmatrix} \n. \n\\begin{pmatrix}\nx \\\\ y \n\\end{pmatrix}=\n\\begin{pmatrix}\n5 \\\\ 0\n\\end{pmatrix}\n$$\nå¦‚æœä½ çœ‹çš„æ›´æ·±ä¸€ç‚¹ï¼Œä½ å¯èƒ½ä¼šå‘ç°åŸºäºçŸ©é˜µ$\\begin{pmatrix} x \\\\ y \\end{pmatrix}$ å’Œ $\\begin{pmatrix} 5 \\\\ 0 \\end{pmatrix}$çš„ä¸€äº›è§„å¾‹ã€‚\n\né‚£å°±æ˜¯ï¼šè¿™ä¸¤ä¸ªçŸ©é˜µéƒ½å¯ä»¥è¢«ç”¨æ¥ä»£è¡¨ç¬›å¡å°”å¹³é¢ä¸­çš„ç‚¹ï¼Œä¸€ä¸ªç‚¹å¯ä»¥ç”¨æºè‡ªåŸç‚¹çš„å‘é‡è¡¨ç¤ºï¼Œè¿™ä¸ªå‘é‡æ˜¯ä¸€ä¸ª $2Ã—1$ çš„çŸ©é˜µã€‚ \n\næˆ‘ä»¬ç°åœ¨çŸ¥é“äº†ä¸€ä¸ªçŸ©é˜µä¹˜æ³•å°±ä»£è¡¨äº†ä¸€ä¸ªç‚¹åˆ°å¦å¤–ä¸€ä¸ªç‚¹çš„è½¬æ¢ï¼Œå°½ç®¡æˆ‘ä»¬ç›®å‰è¿˜ä¸çŸ¥é“ç¬¬ä¸€ä¸ªç‚¹çš„åæ ‡æ˜¯ä»€ä¹ˆï¼Œä¸è¿‡ä¸ç”¨æ‹…å¿ƒï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“ï¼Œç»™å®šä¸€ä¸ªä½ç½®çŸ¢é‡ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡çŸ©é˜µä¹˜æ³•è¿ç®—å°†å…¶è½¬æ¢ä¸ºå¦å¤–ä¸€ä¸ªçŸ¢é‡ã€‚\n\nå¦‚æœä¸€ä¸ªç‚¹ $\\mathbf{P}$ æ˜¯ä¸€ä¸ªå€¼ä¸º$\\begin{pmatrix} x\\\\y \\end{pmatrix}$ çš„ä½ç½®çŸ¢é‡ï¼Œæˆ‘ä»¬å¯ä»¥ä¹˜ä¸€ä¸ªçŸ©é˜µæ¥å¾—åˆ°ä¸€ä¸ªæ–°çš„ç‚¹ $\\mathbf{P}^{'}$\n\nå®ƒå¯ä»¥é€šè¿‡ä½ç½®çŸ¢é‡ $\\begin{pmatrix} x^{'} \\\\ y^{'} \\end{pmatrix}$ æ¥è¡¨ç¤ºï¼›\n\nä¸€ä¸ªé‡è¦çš„ç‚¹åœ¨äºï¼Œä¸ºäº†æ»¡è¶³çŸ©é˜µä¹˜æ³•çš„è¦æ±‚ï¼Œ[çŸ©é˜µå˜æ¢](https://www.khanacademy.org/math/algebra-home/alg-matrices/alg-matrices-as-transformations/v/transforming-position-vector)å¿…é¡»æ‹¥æœ‰ç‰¹å®šçš„ç»´åº¦ï¼Œå› ä¸ºæºä½ç½®çŸ¢é‡ $\\begin{pmatrix} x\\\\y \\end{pmatrix}$ æ˜¯ä¸€ä¸ª $2\\times 1$ çš„çŸ©é˜µï¼Œè€Œç›®æ ‡ä½ç½®çŸ¢é‡ $\\begin{pmatrix} x^{'} \\\\ y^{'} \\end{pmatrix}$ ä¹Ÿæ˜¯ä¸€ä¸ª $2 \\times 1$ çš„çŸ©é˜µï¼Œæ‰€ä»¥å˜æ¢çŸ©é˜µå¿…é¡»æ˜¯ä¸€ä¸ª $2 \\times 2$ çš„çŸ©é˜µï¼Œè¿™æ ·æ‰èƒ½æ»¡è¶³çŸ©é˜µä¹˜æ³•çš„è¦æ±‚ï¼š\n$$\n\\mathbf{A} . \\begin{pmatrix} x\\\\y \\end{pmatrix} = \\begin{pmatrix} a_{11} & a_{12}\\\\ a_{21} & a_{22} \\end{pmatrix} . \\begin{pmatrix} x\\\\y \\end{pmatrix} = \\begin{pmatrix} x^{\\prime}\\\\y^{\\prime} \\end{pmatrix}\n$$\n\n> 1. ç¬¬ä¸€ä¸ªçŸ©é˜µçš„åˆ—æ•°å¿…é¡»ç­‰äºç¬¬äºŒä¸ªçŸ©é˜µçš„è¡Œæ•°ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªçŸ©é˜µçš„åˆ—æ•°éœ€è¦ä¸º 2 \n> 2. çŸ©é˜µç›¸ä¹˜å¾—åˆ°çš„çŸ©é˜µçš„å°ºå¯¸ä¸º $ç¬¬ä¸€ä¸ªçŸ©é˜µçš„è¡Œæ•° \\times ç¬¬äºŒä¸ªçŸ©é˜µçš„åˆ—æ•°$ï¼Œä¸ºäº†å¾—åˆ°ä¸€ä¸ª $2 \\times 1$ çš„ç»“æœçŸ©é˜µï¼Œåˆ™==ç¬¬ä¸€ä¸ªçŸ©é˜µçš„è¡Œæ•°== ä¸º 2\n> 3. æ•…å˜æ¢çŸ©é˜µçš„è¡Œåˆ—æ•°ä¸ºï¼š$2 \\times 2$\n> 4. æç¤ºï¼šåé¢æˆ‘ä»¬ä¼šçœ‹åˆ°ï¼ŒçŸ©é˜µä¹˜æ³•ä¸­çš„é¡ºåºå¾ˆé‡è¦ã€‚æ¯”æ–¹è¯´ä¸Šé¢çš„çŸ©é˜µä¹˜æ³•ï¼Œå¦‚æœè°ƒæ¢ $\\mathbf{A}$ å’Œ $\\begin{pmatrix} x\\\\y \\end{pmatrix}$ çš„é¡ºåºï¼Œåˆ™æ— æ³•è·å¾—ä¸€ä¸ªæ–°çš„ç‚¹ï¼š $P_{2\\times1} . A_{1\\times n}=P^{'}_{2 \\times n}$ï¼ˆä¸æˆç«‹ï¼‰\n\n>  è½¬æ¢çŸ©é˜µçš„å¦å¤–ä¸€ä¸ªéå¸¸å¥½ç”¨çš„åœ°æ–¹åœ¨äºï¼Œå®ƒå¯ä»¥åŒæ—¶[æ‰¹é‡çš„è½¬æ¢ä¸€æ‰¹ç‚¹](https://www.khanacademy.org/math/algebra-home/alg-matrices/alg-matrices-as-transformations/v/matrix-transformation-triangle)ï¼›\n\n$$\n\\mathbf{A} . \\begin{pmatrix} x\\\\y \\end{pmatrix} = \\begin{pmatrix} a_{11} & a_{12}\\\\ a_{21} & a_{22} \\end{pmatrix} . \\begin{pmatrix} x\\\\y \\end{pmatrix} = \\begin{pmatrix} x^{\\prime}\\\\y^{\\prime} \\end{pmatrix}\n$$\n\n\n\nå‡è®¾ä½ çŸ¥é“æ‰€éœ€è¦çš„åº”ç”¨çš„æ‰€æœ‰è½¬æ¢ç±»å‹ï¼ˆ`rotation`,`scale`,`translation`ï¼‰åŠå…¶ä»–å‚æ•°ã€‚\n\né‚£ä¹ˆï¼Œå¦‚ä½•è·å¾—ç¼©æ”¾2å€å¹¶æ²¿ç€é¡ºæ—¶é’ˆæ–¹å‘æ—‹è½¬90åº¦çš„è½¬æ¢çŸ©é˜µå‘¢ï¼Ÿ \n\nç­”æ¡ˆæ˜¯ï¼šæˆ‘ä»¬éœ€è¦æ›´å¤šæ•°å­¦çŸ¥è¯†ã€‚\n\n### æ›´å¤šæ•°å­¦çŸ¥è¯† \n\nå»ºè®®å¤§å®¶é˜…è¯»[æ­¤è¯¾ç¨‹](https://www.khanacademy.org/math/algebra-home/alg-matrices/alg-matrices-as-transformations/a/matrices-as-transformations)ä¸­æœ‰å…³å˜æ¢çš„çŸ©é˜µè¯¾ç¨‹ï¼ˆå…¶ä¸­æœ‰å¤§é‡ç²¾ç¾çš„å›¾ç¤ºå’ŒåŠ¨ç”»ï¼‰ï¼Œç‰¹åˆ«æ˜¯å®ƒçš„æœ€åä¸€éƒ¨åˆ†ï¼š*ç”¨çŸ©é˜µè¡¨ç¤ºäºŒç»´çº¿æ€§å˜æ¢*ï¼Œè®²çš„éå¸¸ä¸é”™ï¼›\n\nå›åˆ°æˆ‘ä»¬åˆšæ‰è®¨è®ºçš„é—®é¢˜ï¼Œç°åœ¨è®©æˆ‘ä»¬äº†è§£æ›´å¤šæ•°å­¦çŸ¥è¯†å§ã€‚\n\nç°åœ¨æˆ‘å‡è®¾ä½ å­¦ä¹ äº†ä¸Šé¢çš„è¯¾ç¨‹ï¼Œä¸‹é¢çš„éƒ¨åˆ†æ˜¯å¯¹è¯¥è¯¾ç¨‹çš„ç®€å•å›é¡¾ï¼š\n\n* ä¸€ä¸ªä½ç½®çŸ¢é‡ $\\begin{pmatrix}x \\\\ y \\end{pmatrix}$ å¯ä»¥è¢«è¡¨ç¤ºä¸º ï¼š $\\begin{pmatrix}x \\\\ y \\end{pmatrix} = x . \\begin{pmatrix} \\color{Green}1 \\\\ \\color{Green}0 \\end{pmatrix} + y . \\begin{pmatrix} \\color{Red}0 \\\\ \\color{Red}1 \\end{pmatrix}$\n\n  > **è§£é‡Šï¼š**\n  >\n  > $\\begin{pmatrix}x \\\\ y \\end{pmatrix}$ å¯ä»¥è¢«åˆ†è§£ä¸ºä¸€ä¸ªçŸ©é˜µåŠ æ³•è¿ç®—ï¼š $\\begin{pmatrix}x \\\\ y \\end{pmatrix} = \\begin{pmatrix}x \\\\ 0 \\end{pmatrix} + \\begin{pmatrix}0 \\\\ y \\end{pmatrix}$ \n  >\n  > å…¶ä¸­çš„æ¯ä¸ªåŠ æ³•çš„è¿ç®—çŸ©é˜µéƒ½å¯ä»¥è¢«ç»§ç»­æ‹†åˆ†ä¸ºä¸€ä¸ªæ ‡é‡åŒçŸ©é˜µçš„ä¹˜æ³•ï¼š\n  >\n  > * $\\begin{pmatrix} x \\\\ 0 \\end{pmatrix} = x . \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$ \n  > * $\\begin{pmatrix} 0 \\\\ y \\end{pmatrix} = y . \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}$ \n  >\n  > ç°åœ¨ï¼Œæˆ‘ä»¬çœ‹å…¶ä¸­çš„çŸ©é˜µ $\\begin{pmatrix} 1\\\\0 \\end{pmatrix}$ å’Œ $\\begin{pmatrix} 0 \\\\1 \\end{pmatrix}$ï¼Œå…¶å®å®ƒä»¬æ˜¯ç¬›å¡å°”åæ ‡å¹³é¢çš„å•ä½çŸ¢é‡ï¼›\n  >\n  > å› æ­¤ï¼Œ $\\begin{pmatrix}x \\\\ y \\end{pmatrix} = x . \\begin{pmatrix} \\color{Green}1 \\\\ \\color{Green}0 \\end{pmatrix} + y . \\begin{pmatrix} \\color{Red}0 \\\\ \\color{Red}1 \\end{pmatrix}$ å°±æ˜¯ä½ç½®çŸ¢é‡ $\\begin{pmatrix}x \\\\ y \\end{pmatrix}$ çš„å¦å¤–ä¸€ç§å†™æ³•ï¼Œå®ƒä»£è¡¨äº†ç”±æˆ‘ä»¬çš„ç¬›å¡å°”å¹³é¢çš„å•ä½å‘é‡çš„å˜æ¢ç»™å‡ºçš„ç‚¹ã€‚ \n\n* åœ¨åº”ç”¨äº†å˜æ¢çŸ©é˜µ$\\mathbf{A} = \\begin{pmatrix} \\color{Green} a & \\color{Red} b\\\\ \\color{Green} c & \\color{Red} d \\end{pmatrix}$ ä¹‹åï¼Œ $\\begin{pmatrix} \\color{Green}a\\\\\\color{Green}c \\end{pmatrix}$ å’Œ $\\begin{pmatrix}\\color{Red} b\\\\ \\color{Red} d\\end{pmatrix}$ å°†è¢«åˆ†åˆ«æ”¾ç½®äº $\\begin{pmatrix} \\color{Green}1 \\\\ \\color{Green}0 \\end{pmatrix}$ å’Œ $\\begin{pmatrix} \\color{Red}0 \\\\ \\color{Red}1 \\end{pmatrix}$ çš„ä½ç½®ï¼›\n\n  > **è§£é‡Šï¼š**\n  >\n  > æˆ‘ä»¬ä¾ç„¶ä»å•ä½çŸ¢é‡ $\\begin{pmatrix} \\color{Green}1 \\\\ \\color{Green}0 \\end{pmatrix}$å’Œ $\\begin{pmatrix} \\color{Red}0 \\\\ \\color{Red}1 \\end{pmatrix}$ å¼€å§‹\n  >\n  > æˆ‘ä»¬çŸ¥é“ $\\begin{pmatrix}x \\\\ y \\end{pmatrix} = x . \\begin{pmatrix} \\color{Green}1 \\\\ \\color{Green}0 \\end{pmatrix} + y . \\begin{pmatrix} \\color{Red}0 \\\\ \\color{Red}1 \\end{pmatrix}$ï¼Œç°åœ¨æˆ‘ä»¬æƒ³åƒä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬åº”ç”¨ä¸€ä¸ªå˜æ¢åˆ°æˆ‘ä»¬çš„å¹³é¢ä¸Šï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„å•ä½çŸ¢é‡ä¹Ÿä¼šéšä¹‹å˜æ¢å§ï¼Ÿ \n  >\n  > æˆ‘ä»¬å‡è®¾å˜æ¢å $\\begin{pmatrix} \\color{Green}1 \\\\ \\color{Green}0 \\end{pmatrix}$ ä¼šåè½åœ¨ $\\begin{pmatrix} \\color{Green}a \\\\ \\color{Green}c \\end{pmatrix}$ ä¸Šï¼Œè€Œ$\\begin{pmatrix} \\color{Red}0 \\\\ \\color{Red}1 \\end{pmatrix}$ ä¼šè½åœ¨ $\\begin{pmatrix} \\color{Red}b \\\\ \\color{Red}d \\end{pmatrix}$ ä¸Šï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ä½ç½®çŸ¢é‡ $\\begin{pmatrix}x \\\\ y \\end{pmatrix}$  å°†ä¼šè½åœ¨ $x.\\begin{pmatrix}\\color{Green} a \\\\ c \\end{pmatrix} + y.\\begin{pmatrix} \\color{Red} b\\\\d  \\end{pmatrix} = \\begin{pmatrix}\\color{Green}a.x + \\color{Red}b.y \\\\ {\\color{Green}c.x + \\color{Red}d.y}  \\end{pmatrix}$\n\n* ç»è¿‡ä¸Šé¢çš„çŸ©é˜µå˜æ¢ï¼Œ$\\begin{pmatrix} x \\\\ y \\end{pmatrix}$ å°†ä¼šåè½äº $\\begin{pmatrix} \\color{Green}a.x + \\color{Red}b.y \\\\ \\color{Green}c.x + \\color{Red}d.y \\\\ \\end{pmatrix}$\n\nå¦‚æœä½ æ— æ³•ç†è§£ä¸Šé¢çš„å˜æ¢è¿‡ç¨‹ï¼Œè¯·å­¦ä¹ ä¸Šé¢çš„è¯¾ç¨‹å¹¶åå¤é˜…è¯»ã€‚\n\n\n\nç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦æ˜ç¡®æˆ‘ä»¬çš„ç›®æ ‡ï¼Œå°±æ˜¯ï¼šæˆ‘ä»¬éœ€è¦æ‰¾å‡ºæˆ‘ä»¬çš„å˜æ¢çŸ©é˜µ $\\mathbf{A}$ ï¼Œå› ä¸ºæˆ‘ä»¬çŸ¥é“äº†æˆ‘ä»¬æƒ³è¦åº”ç”¨çš„è½¬æ¢ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦æ‰¾åˆ°é‚£ä¸ªèƒ½å¤Ÿåº”ç”¨åˆ°æˆ‘ä»¬çš„ä½ç½®çŸ¢é‡ä¸Šæ¥è½¬æ¢æˆ‘ä»¬å›¾å½¢çš„çŸ©é˜µï¼›\n\nè®©æˆ‘ä»¬ä»¥ä¸€ç³»åˆ—ç‚¹çš„è½¬æ¢ä¸ºä¾‹ï¼šæˆ‘ä»¬çŸ¥é“ä½ç½®çŸ¢é‡å°†åˆ°è¾¾çš„ä½ç½®ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦æ±‚å‡ºçŸ©é˜µ $\\mathbf{A}$ ã€‚ \n\næˆ‘ä»¬çš„ç¬›å¡å°”å¹³é¢ä¸Šæœ‰ä¸€ä¸ªç”±ä¸‰ä¸ªç‚¹ $\\mathbf{P}_{(2,1)},\\mathbf{Q}_{(2,0)}  \\mathbf{R}_{(0,2)}$ Pç»„æˆçš„ä¸‰è§’å½¢ï¼Œ ä»¥åŠå¦ä¸€ä¸ªä»£è¡¨ç¬¬ä¸€ä¸ªä¸‰è§’å½¢çš„å˜æ¢ç‰ˆæœ¬çš„ä¸‰è§’å½¢ï¼š$\\mathbf{P}^{'}_{(5,0)},\\mathbf{Q}^{'}_{(-4,2)}  \\mathbf{R}^{'}_{(2,4)}$ \n\n![2D-transformed-triangle](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210308214033.png)\n\nä¸Šé¢çš„ä¾‹å­ä¸­æˆ‘ä»¬åªéœ€è¦ä¸¤ä¸ªç‚¹å°±å¯ä»¥æ±‚è§£å‡ºçŸ©é˜µ$\\mathbf{A}$ï¼Œæˆ‘ä»¬ä½¿ç”¨ $\\mathbf{P}$ å’Œ $\\mathbf{Q}$ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå˜æ¢ä¹‹åï¼š\n$$\n\\begin{pmatrix} 2\\\\ 1 \\end{pmatrix} \\text{ ä½äº } \\begin{pmatrix} 5\\\\ 0 \\end{pmatrix} \n\\\\\n\\\\\n\\begin{pmatrix} -2\\\\ 0 \\end{pmatrix} \\text{ ä½äº } \\begin{pmatrix} -4\\\\ 2 \\end{pmatrix}\n$$\nä¹Ÿå°±æ˜¯è¯´ï¼š\n$$\n\\begin{pmatrix} x\\\\ y \\end{pmatrix} = \\begin{pmatrix} 2\\\\ 1 \\end{pmatrix} \\text{ ä½äº } \\begin{pmatrix} a.x+b.y\\\\ c.x+d.y \\end{pmatrix} = \\begin{pmatrix} 5\\\\ 0 \\end{pmatrix}\n\\\\\n\\\\\n\\begin{pmatrix} x\\\\ y \\end{pmatrix} = \\begin{pmatrix} -2\\\\ 0 \\end{pmatrix} \\text{ ä½äº } \\begin{pmatrix} a.x+b.y\\\\ c.x+d.y \\end{pmatrix} = \\begin{pmatrix} -4\\\\ 2 \\end{pmatrix}\n$$\nç®€åŒ–ä¹‹åå°±æ˜¯ï¼š\n$$\n\\begin{pmatrix} 2.a+1.b\\\\ 2.c+1.d \\end{pmatrix} = \\begin{pmatrix} 5\\\\ 0 \\end{pmatrix}\n\\\\\n\\begin{pmatrix} -2.a+0.b\\\\ -2.c+0.d \\end{pmatrix} = \\begin{pmatrix} -4\\\\ 2 \\end{pmatrix}\n$$\né€šè¿‡ç¬¬2ä¸ªç­‰å¼å¯ä»¥ç®—å‡ºï¼Œ $a=2$ ï¼Œ$c=-1$ï¼Œä»£å…¥åˆ°ç¬¬ä¸€ä¸ªç­‰å¼ä¸­å¯ä»¥å¾—å‡ºï¼š $b=1$, $d =2$ï¼Œç°åœ¨æˆ‘ä»¬å¾—åˆ°äº†æˆ‘ä»¬çš„å˜æ¢çŸ©é˜µï¼š\n$$\n\\mathbf{A} = \\begin{pmatrix} \\color{Green} 2 & \\color{Red} 1\\\\ \\color{Green} -\\color{Green} 1 & \\color{Red} 2 \\end{pmatrix}\n$$\n\n### å•ä½çŸ©é˜µ\n\nç°åœ¨æˆ‘ä»¬è¿˜ä¸çŸ¥é“å¦‚ä½•å®šä¹‰ä¸€ä¸ªè½¬æ¢çŸ©é˜µï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“å®ƒçš„è¡¨ç¤ºå½¢å¼ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬è¦åšä»€ä¹ˆå‘¢ï¼Ÿè¿˜è®°å¾—åœ¨ä¸Šä¸€ä¸ªå°èŠ‚ä¸­ï¼Œæˆ‘ä»¬è¯´è¿‡ï¼Œä¸€ä¸ªä½ç½®$\\begin{pmatrix}x \\\\ y \\end{pmatrix}$ å¯ä»¥è¢«è¡¨ç¤ºä¸º $\\begin{pmatrix}x \\\\ y \\end{pmatrix} = x . \\begin{pmatrix} \\color{Green}1 \\\\ \\color{Green}0 \\end{pmatrix} + y . \\begin{pmatrix} \\color{Red}0 \\\\ \\color{Red}1 \\end{pmatrix}$ ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„èµ·ç‚¹ï¼Œæˆ‘ä»¬åˆšåˆšåˆ—å‡ºäº†æˆ‘ä»¬çš„==åŸºæœ¬==çŸ©é˜µï¼š\n\n$$\n\\begin{pmatrix} \\color{Green}1 & \\color{Red}0 \\\\ \\color{Green} 0  & \\color{Red} 1 \\end{pmatrix}\n$$\n\nè¿™ä¸ªçŸ©é˜µä»£è¡¨äº†ä½ çš„å¹³é¢çš„åŸºç¡€çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯åˆšåŠ è½½å›¾åƒæ—¶åº”ç”¨äºå¹³é¢çš„çŸ©é˜µï¼ˆå›¾åƒä¸å…¶å˜æ¢åçš„å®¹å™¨è§†å›¾çš„å¤§å°ç›¸åŒï¼‰ï¼Œæ¢ä¸€ç§è¯´æ³•å°±æ˜¯ï¼Œåº”ç”¨äº†è¿™ä¸ªçŸ©é˜µçš„ä½ç½®çŸ¢é‡å°†ä¼šè¿”å›ä¸€æ ·çš„ä½ç½®çŸ¢é‡ã€‚è¿™æ ·çš„çŸ©é˜µå°±ç§°ä¹‹ä¸º ==å•ä½çŸ©é˜µ==([identity matrix](https://www.khanacademy.org/math/algebra-home/alg-matrices/alg-properties-of-matrix-multiplication/a/intro-to-identity-matrices))\n\n### ç»“åˆå¤šç§å˜æ¢\n\nåœ¨æˆ‘ä»¬äº†è§£æ›´å¤šç»†èŠ‚ä¹‹å‰ï¼Œè¿˜æœ‰ä¸€ä»¶äº‹ï¼Œå°±æ˜¯ï¼šæˆ‘ä»¬å¸Œæœ›ç”¨æˆ·èƒ½å¤Ÿç»„åˆ/é“¾æ¥å¤šç§å˜æ¢ï¼ˆä¾‹å¦‚ï¼ŒåŒæ—¶ç¼©æ”¾å’Œå¹³ç§»ï¼‰ã€‚ \n\nä¸ºäº†èƒ½é“¾æ¥å¤šä¸ªè½¬æ¢ï¼Œæˆ‘ä»¬éœ€è¦ç†è§£[çŸ©é˜µä¹˜æ³•çš„æ€§è´¨](https://www.khanacademy.org/math/algebra-home/alg-matrices/alg-properties-of-matrix-multiplication/a/properties-of-matrix-multiplication) ã€‚æ›´å…·ä½“çš„è¯´æ˜¯æˆ‘ä»¬éœ€è¦äº†è§£çŸ©é˜µä¹˜æ³•çš„==éäº¤æ¢æ€§(non-commutative)==å’Œ==ç»“åˆæ€§==(associative)\n\n* çŸ©é˜µä¹˜æ³•æ˜¯å¯ç»“åˆçš„ï¼š $\\left(\\mathbf{A}.\\mathbf{B}\\right).\\mathbf{C} = \\mathbf{A}.\\left(\\mathbf{B}.\\mathbf{C}\\right)$\n* çŸ©é˜µä¹˜æ³•æ˜¯ä¸å¯äº¤æ¢çš„ï¼š$\\mathbf{A}.\\mathbf{B} \\neq \\mathbf{B}.\\mathbf{A}$\n\nå›åˆ°æˆ‘ä»¬çš„å˜æ¢ï¼Œæƒ³è±¡æˆ‘ä»¬æƒ³è¦åº”ç”¨å˜æ¢ $\\mathbf{B}$ ,ç„¶ååº”ç”¨å˜æ¢ $\\mathbf{A}$ åˆ°æˆ‘ä»¬çš„ä½ç½®çŸ¢é‡ $\\vec{v}$ ,ä¸¤æ¬¡å˜æ¢å¯ä»¥åˆ†åˆ«è¡¨ç¤ºä¸ºï¼š$\\vec{v^{\\prime}} = \\mathbf{B} . \\vec{v}$ åŠ $\\vec{v^{\\prime\\prime}} = \\mathbf{A} . \\vec{v^{\\prime}}$ ,ç»“åˆä¸‹æ¥ï¼š\n\n$$\n\\vec{v^{\\prime\\prime}} = \\mathbf{A} . \\left( \\mathbf{B} . \\vec{v} \\right)\n$$\nå› ä¸ºçŸ©é˜µä¹˜æ³•æ˜¯å¯ä»¥ç»“åˆçš„ï¼Œæ‰€ä»¥ï¼š\n$$\n\\vec{v^{\\prime\\prime}} = \\mathbf{A} . \\left( \\mathbf{B} . \\vec{v} \\right) \\Leftrightarrow \\vec{v^{\\prime\\prime}} = \\left( \\mathbf{A} . \\mathbf{B} \\right) . \\vec{v}\n$$\nå› ä¸ºçŸ©é˜µä¹˜æ³•æ˜¯ä¸å¯äº¤æ¢çš„ï¼Œæ‰€ä»¥ä¸¤ä¸ªå˜æ¢çŸ©é˜µçš„åº”ç”¨é¡ºåºä¸å¯æ”¹å˜ï¼Œå³ $\\mathbf{A}.\\mathbf{B}$ ä¸èƒ½å˜æ¢æˆ $\\mathbf{B}.\\mathbf{A}$ï¼Œå¦åˆ™å°†ä¼šäº§ç”Ÿä¸åŒçš„å˜æ¢æ•ˆæœï¼›\n\n> æ³¨æ„è¿™é‡ŒçŸ©é˜µå˜æ¢åº”ç”¨çš„é¡ºåºå’Œè½¬æ¢æˆä¹˜æ³•ä¹‹åçš„çŸ©é˜µé¡ºåºï¼Œæˆ‘ä»¬å…ˆåº”ç”¨$\\mathbf{B}$ï¼Œç„¶åå†åº”ç”¨ $\\mathbf{A}$ï¼Œç»“åˆä¹‹åçš„é¡ºåºæ˜¯ ï¼š$\\mathbf{A.B}$\n\n## å˜æ¢ç±»å‹\n\nä½¿ç”¨ $2\\times2$ çš„çŸ©é˜µæˆ‘ä»¬å¯ä»¥å®šä¹‰å¤šç§ä¸åŒç±»å‹çš„äºŒç»´å˜æ¢ç±»å‹ï¼Œä½ å¯èƒ½å·²ç»åœ¨è¯¾ç¨‹  [matrices as transformations](https://www.khanacademy.org/math/algebra-home/alg-matrices/alg-matrices-as-transformations/a/matrices-as-transformations) ä¸­äº†è§£äº†å…¶ä¸­çš„å¤§éƒ¨åˆ†å˜æ¢ï¼Œè¿™äº›å˜æ¢åŒ…æ‹¬ï¼š\n\n* ç¼©æ”¾\n* Reflexion-åå°„\n* Shearing\n* Rotation-æ—‹è½¬\n\næœ¬å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç‚¹ $\\mathbf{P}_{(x,y)}$ï¼Œè¿™ä¸ªç‚¹ä»£è¡¨äº†å¹³é¢ä¸­çš„ä»»ä¸€ä¸ªç‚¹ï¼Œæˆ‘ä»¬å¸Œæœ›æ‰¾åˆ°ä¸€ä¸ªçŸ©é˜µèƒ½å°†ç‚¹è½¬æ¢åˆ° $\\mathbf{P^{'}}_{(x^{'},y^{'})}$ï¼Œä¹Ÿå°±æ˜¯ï¼š\n$$\n\\begin{pmatrix} x^{\\prime}\\\\y^{\\prime} \\end{pmatrix} = \\mathbf{A} . \\begin{pmatrix} x\\\\y \\end{pmatrix} = \\begin{pmatrix} a & b\\\\c & d \\end{pmatrix} . \\begin{pmatrix} x\\\\y \\end{pmatrix}\n$$\n\n### Scaling\n\nç¼©æ”¾çœ‹èµ·æ¥å¾ˆå¥½è¡¨ç¤ºï¼Œæ¯”æ–¹è¯´æ”¾å¤§2å€ï¼Œåªéœ€å°†åæ ‡ä¹˜ä»¥æ¯”ä¾‹å› å­å°±å¯ä»¥äº†ï¼Œä½†æ˜¯æˆ‘ä»¬å¯èƒ½å¸Œæœ›å¯¹è½¬æ¢ä½¿ç”¨ä¸åŒçš„æ°´å¹³å’Œå‚ç›´ç¼©æ”¾æ¯”ä¾‹ï¼Œè¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬åº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ\n\nä¸ºäº†èƒ½å¤Ÿåœ¨ä¸åŒçš„æ–¹å‘ä½¿ç”¨ä¸åŒçš„ç¼©æ”¾æ¯”ä¾‹ï¼Œæˆ‘ä»¬å¿…é¡»åŒºåˆ†æ°´å¹³å’Œå‚ç›´æ–¹å‘çš„ç¼©æ”¾æ¯”ä¾‹ï¼Œå®ƒä»¬åˆ†åˆ«ä½¿ç”¨$S_{x}$ å’Œ$S_{y}$è¡¨ç¤ºï¼›\n\næˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¸¤ä¸ªç­‰å¼ï¼š\n$$\n\\begin{aligned} x' &= S_{x} . x \\\\ y' &= S_{y} . y \\end{aligned}\n$$\nç»“åˆä¹‹å‰çš„çŸ©é˜µï¼š\n$$\n\\begin{pmatrix} x^{\\prime}\\\\y^{\\prime} \\end{pmatrix} = \\begin{pmatrix} a & b\\\\c & d \\end{pmatrix} . \\begin{pmatrix} x\\\\y \\end{pmatrix}\n$$\næˆ‘ä»¬å¯ä»¥å¾—åˆ° $a,b,c,d$ å¦‚ä¸‹ï¼š\n$$\n\\left.\n\\begin{aligned} S_{x} . x &= a . x + b . y\\\\\\\\ \\Rightarrow a &= S_{x} \\text{ ä¸” }\\\\ b &= 0 \\end{aligned}\n\\middle |\n\\begin{aligned} S_{y} . y &= c . x + d . y\\\\\\\\ \\Rightarrow c &= S_{y} \\text{ ä¸” }\\\\ d &= 0 \\end{aligned}\n\\right.\n$$\n\nç¼©æ”¾æ¯”ä¾‹$(S_x,S_y)$ å¯¹åº”çš„ $2\\times2$ ç¼©æ”¾çŸ©é˜µå°±æ˜¯ï¼š\n$$\n \\begin{pmatrix} a & b\\\\c & d \\end{pmatrix} =\n  \\begin{pmatrix} S_x & 0\\\\0 & S_y \\end{pmatrix}\n$$\nå½“ç¼©æ”¾æ¯”ä¾‹ä¸º $1$ æ—¶ï¼Œåº”ç”¨è¿™ä¸ªç¼©æ”¾çŸ©é˜µæ˜¯ï¼š\n$$\n\\begin{pmatrix} S_{x} & 0\\\\0 & S_{y} \\end{pmatrix} = \\begin{pmatrix} 1 & 0\\\\0 & 1 \\end{pmatrix}\n$$\nä¹Ÿå°±æ˜¯å•ä½çŸ©é˜µï¼Œåº”ç”¨ä¹‹å $x$ï¼Œ$y$ å‡ä¸ä¼šæ”¹å˜ï¼Œè¿™ä¸å•ä½çŸ©é˜µçš„æ„ä¹‰ç¬¦åˆã€‚\n\n### Reflexion-ä»¿å°„\n\nä»¿å°„ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä¸¤ç§å‰æ–¹çš„ä»¿å°„ç±»å‹ï¼šå›´ç»•è½´æˆ–å›´ç»•ç‚¹çš„ä»¿å°„ã€‚ \n\nä¸ºç®€å•èµ·è§ï¼Œæˆ‘ä»¬å°†é‡ç‚¹æ”¾åœ¨$x$å’Œ$y$è½´å‘¨å›´çš„ä»¿å°„ï¼ˆåŸç‚¹å‘¨å›´çš„åå°„ç­‰åŒäºåœ¨$x$å’Œ$y$è½´ä¸Šè¿ç»­æ–½åŠ ä»¿å°„ï¼‰ã€‚ \n\nå›´ç»• $x$ è½´çš„åå°„ï¼š\n$$\n\\left.\\begin{aligned} x^{\\prime} &= x\\\\ x &= a . x + b . y\\\\\\\\ \\Rightarrow a &= 1 \\text{ and }\\\\ b &= 0 \\end{aligned}\n\\middle|\n\\begin{aligned} y^{\\prime} &= -y\\\\ -y &= c . x + d . y\\\\\\\\ \\Rightarrow c &= 0 \\text{ and }\\\\ d &= -1 \\end{aligned}\n\\right. \n$$\næœ‰è¶£çš„æ˜¯ï¼Œå›´ç»• $x$ è½´çš„ä»¿å°„å’Œä½¿ç”¨ -1 ä½œä¸ºç¼©æ”¾å› å­å¯¹$x$ è¿›è¡Œç¼©æ”¾çš„è½¬æ¢çŸ©é˜µä¸€è‡´ï¼›\n$$\n\\begin{pmatrix} a & b\\\\c & d \\end{pmatrix} = \\begin{pmatrix} 1 & 0\\\\ 0 & -1 \\end{pmatrix}\n$$\nå›´ç»• $y$ è½´æ–¹å‘çš„ä»¿å°„ï¼š\n$$\n\\left.\n\\begin{aligned} x^{\\prime} &= -x\\\\ -x &= a . x + b . y\\\\\\\\ \\Rightarrow a &= -1 \\text{ and }\\\\ b &= 0 \\end{aligned}\n\\middle|\n\\begin{aligned} y^{\\prime} &= y\\\\ y &= c . x + d . y\\\\\\\\ \\Rightarrow c &= 0 \\text{ and }\\\\ d &= 1 \\end{aligned}\n\\right.\n$$\nè½¬æ¢çŸ©é˜µï¼š\n$$\n\\begin{pmatrix} a & b\\\\c & d \\end{pmatrix} = \\begin{pmatrix} -1 & 0\\\\ 0 & 1 \\end{pmatrix}\n$$\n\n### Shearing-å‰ªåˆ‡\n\nè¿™ä¸ªShearingå˜æ¢æœ‰äº›å¤æ‚ã€‚\n\nåœ¨æˆ‘å‘ç°çš„å¤§å¤šæ•°ç¤ºä¾‹ä¸­ï¼Œå‰ªåˆ‡éƒ½æ˜¯é€šè¿‡æ·»åŠ ä¸€ä¸ªå¯ä»¥ä»£è¡¨shearingè§’åº¦çš„å¸¸é‡æ¥æ›´æ”¹åæ ‡æ¥è§£é‡Šçš„ã€‚\n\næ¯”æ–¹è¯´ï¼Œä¸€ä¸ªæ²¿ç€$x$ è½´æ–¹å‘çš„ shear é€šå¸¸ä½¿ç”¨ä¸€ä¸ªé¡¶ç‚¹ä½äº$(0,1)$ çš„çŸ©å½¢å˜æ¢æˆä¸€ä¸ªé¡¶ç‚¹ä½äº $(1,1)$ çš„å¹³è¡Œå››è¾¹å½¢æ¥è§£é‡Šï¼›\n\n![2D-constant-shearing](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210308225012.png)\n\n<center>Shearing along x axis by a constant k<sub>x</sub>=1</center>\n\nä¸è¿‡åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘æƒ³ç”¨å‰ªåˆ‡è§’ï¼ˆè½´è¢«å‰ªåˆ‡çš„è§’åº¦ï¼‰æ¥è§£é‡Šå®ƒã€‚æˆ‘ä»¬ç§°ä¹‹ä¸º $\\alpha$ ï¼ˆalphaï¼‰ã€‚\n\n![2D-angle-shearing](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210308230002.gif)\n\n![D-angle-shearing](Matrices for developers_files/2D-angle-shearing.gif)\n\n<center>Shearing along x axis by an angle Î±</center>\n\nå¦‚æœçœ‹ä¸Šé¢çš„å¹³é¢ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ–°çš„æ¨ªåæ ‡ $x^{\\prime}$ ç­‰äº$x$åŠ /å‡å»$y$è½´ï¼Œ$y$è½´çš„å‰ªåˆ‡å½¢å¼ä»¥åŠçŸ©å½¢å·¦ä¸Šè§’é¡¶ç‚¹ä¸å¹³è¡Œå››è¾¹å½¢å·¦ä¸Šè§’é¡¶ç‚¹ä¹‹é—´çš„çº¿æ®µæ‰€å½¢æˆçš„ä¸‰è§’å½¢çš„ç›¸å¯¹è¾¹ã€‚ æ¢å¥è¯è¯´ï¼Œ$x ^{\\prime}$ ç­‰äº $x$â€‹ åŠ /å‡ç»¿è‰²ä¸‰è§’å½¢çš„å¦ä¸€ä¾§\n\n| ![2D-angle-shearing-triangles-1](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210308231659.png) | ![2D-angle-shearing-triangles-2](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210308231705.png) |\n| ------------------------------------------------------------ | ------------------------------------------------------------ |\n| ![2D-angle-shearing-triangles-3](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210308231710.png) | ![2D-angle-shearing-triangles-4](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210308231717.png) |\n\n> åœ¨ç›´è§’ä¸‰è§’å½¢ä¸­ï¼š \n>\n> * æ–œè¾¹(==*hypotenuse*==)æ˜¯æœ€é•¿çš„ä¸€é¢ \n> * å¯¹è¾¹ï¼ˆ==*opposite*==ï¼‰æ˜¯ä¸ç»™å®šè§’åº¦ç›¸åçš„é‚£ä¸€ä¾§ \n> * ç›¸é‚»è¾¹ï¼ˆ==*adjacent*==ï¼‰æ˜¯ç»™å®šè§’åº¦çš„ä¸‹ä¸€ä¸ª \n\n* $\\mathbf{PP^{'}}$ æ˜¯å¯¹è¾¹ï¼Œä¸ºäº†è®¡ç®—$x^{'}$ åˆ° $x$ çš„è·ç¦»ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—å‡ºå¯¹è¾¹çš„é•¿åº¦ ($k$)ï¼›\n* é‚»è¾¹å°±æ˜¯ $P^{'}$ çš„åæ ‡ï¼š $y$ ;\n* æˆ‘ä»¬ä¸çŸ¥é“æ–œè¾¹çš„é•¿åº¦\n\nåœ¨ä¸‰è§’å‡½æ•°ï¼ˆtrigonometryï¼‰ä¸­ï¼š\n$$\n\\begin{aligned} \\cos \\left( \\alpha \\right) &= \\frac{é‚»è¾¹}{æ–œè¾¹}\\\\\\\\ \\sin \\left( \\alpha \\right) &= \\frac{å¯¹è¾¹}{æ–œè¾¹}\\\\\\\\ \\tan \\left( \\alpha \\right) &= \\frac{å¯¹è¾¹}{é‚»è¾¹} \\end{aligned}\n$$\nç°åœ¨ï¼Œæˆ‘ä»¬çŸ¥é“äº† $\\alpha$ ,ä½†æˆ‘ä»¬ä¸çŸ¥é“æ–œè¾¹çš„é•¿åº¦ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨ cosine å‡½æ•°ã€‚\n\nå¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬çŸ¥é“é‚»è¾¹çš„é•¿åº¦ï¼ˆä¹Ÿå°±æ˜¯$y$),æˆ‘ä¸€æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ tangent å‡½æ•°æ¥æ±‚å‡ºå¯¹è¾¹çš„é•¿åº¦ï¼š\n$$\n\\begin{aligned}\\tan \\left( \\alpha \\right) &= \\frac{å¯¹è¾¹}{é‚»è¾¹}\\\\\\\\å¯¹è¾¹ &= é‚»è¾¹ \\times \\tan \\left( \\alpha \\right)\\end{aligned}\n$$\n æˆ‘ä»¬å¯ä»¥å¼€å§‹æ±‚è§£æˆ‘ä»¬çš„çº¿æ€§æ–¹ç¨‹ç»„æ¥å¾—å‡ºæˆ‘ä»¬éœ€è¦çš„çŸ©é˜µï¼š\n$$\nx^{\\prime} = x + k = x + y . \\tan \\left( \\alpha \\right)\n\\\\\ny^{\\prime} = y\n$$\nå½“ $\\alpha > 0$ æ—¶ï¼Œ$tan(\\alpha) < 0$ï¼Œå½“ $Î±<0, \\tan \\left( \\alpha \\right) > 0$ ,ä¸¤ç§æƒ…å†µä¸‹ï¼Œé€šè¿‡ $xâ€²= x+k=x+y.tan(Î±)$ æ±‚è§£å‡ºæ¥çš„å¯èƒ½ä¸ºæ­£ä¹Ÿå¯èƒ½ä¸ºè´Ÿï¼›$\\alpha > 0$ ä¸ºé€†æ—¶é’ˆçš„æ—‹è½¬/æ–œåˆ‡è§’ï¼Œå½“ $Î±<0$ æ—¶ï¼Œä¸ºé¡ºæ—¶é’ˆæ–¹å‘çš„æ—‹è½¬/æ–œåˆ‡è§’ã€‚\n$$\n\\left.\n\\begin{aligned} x^{\\prime} &= x + y . \\tan \\left( \\alpha \\right) \\\\ x + y . \\tan \\left( \\alpha \\right) &= a . x + b . y\\\\\\\\ \\Rightarrow a &= 1 \\text{ and }\\\\ b &= \\tan \\left( \\alpha \\right) \\end{aligned}\n\\middle|\n\\begin{aligned} y^{\\prime} &= y\\\\ y &= c . x + d . y\\\\\\\\ \\Rightarrow c &= 0 \\text{ and }\\\\ d &= 1 \\end{aligned}\n\\right.\n$$\n\næ²¿$x$æ–¹å‘å‰ªåˆ‡çš„å˜æ¢çŸ©é˜µä¸º:\n$$\n\\begin{aligned} \n\\begin{pmatrix} a & b\\\\c & d \\end{pmatrix} = \\begin{pmatrix} 1 & \\tan \\alpha \\\\ 0 & 1 \\end{pmatrix} = \\begin{pmatrix} 1 & k_{x}\\\\ 0 & 1 \\end{pmatrix}\\\\\\\\ \n{\\text{å…¶ä¸­ } k_{x} \\text{ æ˜¯ shearing å¸¸é‡}}\n\\end{aligned}\n$$\n ç±»ä¼¼çš„ï¼Œæ²¿ $y$ æ–¹å‘å‰ªåˆ‡çš„å˜æ¢çŸ©é˜µä¸ºï¼š\n$$\n\\begin{aligned} \\begin{pmatrix} a & b\\\\c & d \\end{pmatrix} = \\begin{pmatrix} 1 & 0\\\\ \\tan \\beta & 1 \\end{pmatrix} = \\begin{pmatrix} 1 & 0\\\\ k_{y} & 1 \\end{pmatrix}\\\\\\\\ \\text{å…¶ä¸­ } k_{y} \\text{ æ˜¯ shearing å¸¸é‡} \\end{aligned}\n$$\n\n### Rotation\n\næ—‹è½¬å°±æ›´åŠ å¤æ‚äº†ã€‚\n\næˆ‘ä»¬ä»”ç»†çœ‹ä¸‹ä¸‹é¢ å›´ç»•åŸç‚¹æ—‹è½¬ $\\theta$ (theta)è§’åº¦ çš„ä¾‹å­:\n\n![D-angle-shearing](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210309094706.gif)\n\n![D-angle-shearing](Matrices for developers_files/2D-rotation.gif)\n\n\n\næ³¨æ„ï¼Œä¸¤ä¸ªç‚¹ $\\mathbf{P}$ å’Œ  $\\mathbf{P}^{'}$ åœ¨å®ƒä»¬è‡ªå·±çš„åæ ‡å¹³é¢ä¸­éƒ½æœ‰ç›¸åŒçš„åæ ‡$(x,y)$ï¼Œä½†æ˜¯ $\\mathbf{P}^{'}$ åœ¨ç¬¬ä¸€ä¸ªæ²¡æœ‰è¢«æ—‹è½¬çš„åæ ‡ç³»ä¸­æœ‰æ–°çš„åæ ‡ï¼š $\\left({x^{'},y^{'}}\\right)$ ã€‚\n\né‚£ä¹ˆï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥å®šä¹‰åŸå§‹åæ ‡ç‚¹$(x,y)$ åˆ°æ–°çš„åæ ‡ç‚¹  $\\left({x^{'},y^{'}}\\right)$ ä¹‹é—´çš„å…³ç³»äº†å—ï¼Ÿ\n\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‰è§’å‡½æ•°æ¥å¸®åŠ©æˆ‘ä»¬è®¡ç®—ï¼Œåœ¨å¯»æ‰¾å¯¹åº”çš„è§£æ³•æ—¶ï¼Œæˆ‘å‘ç°äº†[å°¼å…‹Â·è´é‡Œï¼ˆNick Berryï¼‰](http://datagenetics.com/blog/august32013/)çš„åŸºäºå‡ ä½•çš„è§£é‡Šå’Œ[æ­¤è§†é¢‘](https://www.youtube.com/watch?v=h11ljFJeaLo)ã€‚ \n\nè€å®è¯´ï¼Œæˆ‘å¯¹è¿™ç§è§£å†³æ–¹æ¡ˆä¸æ˜¯100ï¼…æ»¡æ„ï¼Œå› ä¸ºæˆ‘ä¸å®Œå…¨ç†è§£äº†å®ƒã€‚ åœ¨é‡æ–°é˜…è¯»æˆ‘å†™çš„å†…å®¹ä¹‹åï¼ŒHadrienï¼ˆå®¡é˜…è€…ä¹‹ä¸€ï¼‰å’Œæˆ‘å‘ç°æˆ‘çš„è§£é‡Šæœ‰äº›ä¸æ˜¯é‚£ä¹ˆå®Œç¾ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨æœ‰å…´è¶£ï¼Œæˆ‘ä¼šæŠŠå®ƒç•™åœ¨è¿™é‡Œï¼Œä½†æˆ‘å»ºè®®æ‚¨ä¸è¦æ‰“æ‰°ï¼Œé™¤éæ‚¨éå¸¸å¥½å¥‡å¹¶ä¸”ä¸è¦ä»‹æ„ä¸€äº›æ··ä¹±ã€‚ \n\n> \n\nç°åœ¨ï¼Œä¸ºäº†è¿›è¡Œç®€å•çš„è§£é‡Šæ¸…æ¥šæ—‹è½¬çš„æ¦‚å¿µï¼Œæˆ‘å°†é‡‡ç”¨ *æ­¤ä½ç½®å‘é‡è½åœ¨æ˜ å°„åˆ°å¦å¤–ä¸€ä¸ªä½ç½®å‘é‡ä¸Š* çš„è·¯çº¿ã€‚ \n\nå‡è®¾ä½ åƒä¸‹å›¾ä¸€æ ·åœ¨å•ä½çŸ¢é‡ä¸Šè¿›è¡Œç¼©æ”¾ï¼š \n\n![2D-rotation-unit](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210309101356.png)\n\nåŸºäºä¸‰è§’å‡½æ•°çš„è§„åˆ™ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å¾—åˆ°ï¼š\n$$\n\\left.\n\\begin{pmatrix} 0\\\\ 1 \\end{pmatrix} \\text{ lands on } \\begin{pmatrix} \\cos \\theta \\\\ \\sin \\theta \\end{pmatrix}\n\\middle|\n\\begin{pmatrix} 1\\\\ 0 \\end{pmatrix} \\text{ lands on } \\begin{pmatrix} - \\sin \\theta \\\\ \\cos \\theta \\end{pmatrix}\n\\right.\n$$\nä¹Ÿå°±æ˜¯ï¼š\n$$\n\\begin{pmatrix} x\\\\ y \\end{pmatrix} = \\begin{pmatrix} 1\\\\ 0 \\end{pmatrix} \\text{ lands on } \\begin{pmatrix} a.x+b.y\\\\ c.x+d.y \\end{pmatrix} = \\begin{pmatrix} \\cos \\theta \\\\ \\sin \\theta \\end{pmatrix}\n$$\n\n$$\n\\begin{pmatrix} x\\\\ y \\end{pmatrix} = \\begin{pmatrix} 0\\\\ 1 \\end{pmatrix} \\text{ lands on } \\begin{pmatrix} a.x+b.y\\\\ c.x+d.y \\end{pmatrix} = \\begin{pmatrix} - \\sin \\theta \\\\ \\cos \\theta \\end{pmatrix}\n$$\n\næˆ‘ä»¬å¯ä»¥æ¨æ–­å‡ºï¼š\n$$\n\\left.\n\\begin{pmatrix} 1.a+0.b\\\\ 1.c+0.d \\end{pmatrix} = \\begin{pmatrix} \\cos \\theta \\\\ \\sin \\theta \\end{pmatrix}\n\\middle|\n\\begin{pmatrix} 0.a+1.b\\\\ 0.c+1.d \\end{pmatrix} = \\begin{pmatrix} - \\sin \\theta \\\\ \\cos \\theta \\end{pmatrix}\n\\right.\n$$\nå¾ˆæ˜æ˜¾å¯ä»¥å¾—å‡ºï¼š $a = \\cos\\left(\\theta \\right), b = - \\sin \\left( \\theta \\right), c = \\sin \\left( \\theta \\right) ï¼Œè€Œ\\  d = \\cos \\left( \\theta \\right)$ ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°æˆ‘ä»¬çš„æ—‹è½¬çŸ©é˜µï¼š\n$$\n\\begin{pmatrix} a & b\\\\c & d \\end{pmatrix} = \\begin{pmatrix} \\cos \\theta & -\\sin \\theta\\\\ \\sin \\theta & \\cos \\theta \\end{pmatrix}\n$$\næ­å–œä½ ï¼ç°åœ¨ä½ å·²ç»çŸ¥é“äº†å¦‚ä½•å®šä¹‰ç¼©æ”¾ï¼Œä»¿å°„ï¼Œå‰ªåˆ‡å’Œæ—‹è½¬çš„å˜æ¢çŸ©é˜µã€‚ é‚£ä¹ˆï¼Œè¿˜å·®ä»€ä¹ˆå‘¢ï¼Ÿ \n\n## 3x3 å˜æ¢çŸ©é˜µ\n\nå¦‚æœä½ çœ‹åˆ°äº†è¿™é‡Œï¼Œç»è¿‡ä¸Šé¢çš„è§£é‡Šï¼Œä½ å¯èƒ½çŸ¥é“äº†ä¸Šè¿°çš„å•ä¸ªå˜æ¢ä¸ºä»€ä¹ˆä¼šèµ·ä½œç”¨ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬çš„ç›®æ ‡å…¶å®æ˜¯ç†è§£è¿™äº›ä»¿å°„å˜æ¢ï¼Œç„¶ååœ¨ä»£ç ä¸­åº”ç”¨å®ƒä»¬ã€‚\n\nä»…ä»…çŸ¥é“å•ä¸ªå˜æ¢çš„ç”¨æ³•ä¹Ÿæ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œå› ä¸ºç°åœ¨æˆ‘ä»¬çŸ¥é“äº†å˜æ¢çŸ©é˜µé•¿ä»€ä¹ˆæ ·ï¼Œå¹¶ä¸”çŸ¥é“å¦‚ä½•åœ¨ç»™å®šçš„å‡ ä¸ªä½ç½®çŸ¢é‡çš„æƒ…å†µä¸‹è®¡ç®—ä¸€ä¸ªå˜æ¢çŸ©é˜µï¼Œäº†è§£è¿™äº›å°±å·²ç»éå¸¸äº†ä¸èµ·äº†ã€‚\n\nä½†æ˜¯ï¼Œæœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼šæˆ‘ä»¬èƒ½é€šè¿‡ $2\\times2$ çš„çŸ©é˜µæ‰€åšçš„æ“ä½œå¤ªå°‘äº†ï¼Œä½ åªèƒ½åšä¸€äº›æˆ‘ä»¬ä¹‹é—´è§åˆ°è¿‡çš„å˜æ¢ï¼š\n\n* Scaling - ç¼©æ”¾\n* Reflexion - ä»¿å°„\n* Shearing - å‰ªåˆ‡\n* Rotation - æ—‹è½¬\n\né‚£ä¹ˆæˆ‘ä»¬è¿˜éœ€è¦ä»€ä¹ˆï¼Ÿ ç­”æ¡ˆæ˜¯ï¼š **å¹³ç§»-translations**\n\nå¹³ç§»éå¸¸æœ‰ç”¨ï¼Œæ¯”æ–¹è¯´å½“ç”¨æˆ·è§¦æ‘¸å›¾åƒå¹¶ç§»åŠ¨æ‰‹æŒ‡æ—¶ï¼Œå›¾ç‰‡éœ€è¦èƒ½è·Ÿéšç”¨æˆ·çš„æ‰‹åŠ¿ä¸€èµ·ç§»åŠ¨ï¼›å¹³ç§»å¯ä»¥è¢«å®šä¹‰ä¸ºä¸¤ä¸ªçŸ©é˜µçš„åŠ æ³•ï¼š\n$$\n\\begin{pmatrix}\nx^{'} \\\\ y^{'} \n\\end{pmatrix} = \\begin{pmatrix} x \\\\ y \\end{pmatrix} + \\begin{pmatrix} t_x \\\\ t_y \\end{pmatrix}\n$$\nä¸è¿‡ï¼Œæˆ‘ä»¬å¸Œæœ›ç”¨æˆ·èƒ½å¤Ÿè”åˆæ‰§è¡Œå¤šç§å˜æ¢ï¼ˆå¦‚ä»¥ä¸€ä¸ªä¸æ˜¯åŸç‚¹çš„ç‚¹ä¸ºä¸­å¿ƒè¿›è¡Œç¼©æ”¾ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ‰¾åˆ°å°†å¹³ç§»è¡¨ç¤ºä¸ºçŸ©é˜µä¹˜æ³•çš„æ–¹å¼ã€‚\n\n> è¿™é‡Œå¯èƒ½æ¶‰åŠåˆ° [Homogeneous coordinates](https://en.wikipedia.org/wiki/Homogeneous_coordinates çš„ä¸–ç•Œï¼Œä¸è¿‡ä½ å¯ä»¥ä¸ç”¨äº†è§£è¿™äº›ã€‚\n\nè¿™é‡Œå…³è”æ¦‚å¿µå°±æ˜¯ï¼š\n\n* æˆ‘ä»¬ä½¿ç”¨çš„å¹³é¢ç¬›å¡å°”åæ ‡å¹³é¢å®é™…ä¸Šåªæ˜¯ä¸‰ç»´åæ ‡ç©ºé—´ä¸­ä¼—å¤šå¹³é¢ä¸­çš„ä¸€ä¸ªï¼Œå…¶ $z$ åæ ‡ ä¸º 1 \n* å¯¹äºä¸‰ç»´ç©ºé—´çš„ä»»æ„ç‚¹ $(x,y,z)$ æ¥è¯´ï¼ŒæŠ•å½±ç©ºé—´ä¸­ç©¿è¿‡è¿™ä¸ªç‚¹å’ŒåŸç‚¹çš„çº¿ï¼ŒåŒæ—¶ä¹Ÿä¼šç©¿è¿‡ä½¿ç”¨ç›¸åŒçš„ç¼©æ”¾æ¯”ä¾‹å¯¹ $x,y,z$ è¿›è¡Œç¼©æ”¾åçš„ç‚¹ï¼›\n* è¿™æ¡çº¿ä¸Šçš„ä»»æ„ç‚¹çš„åæ ‡å¯ä»¥è¡¨ç¤ºä¸ºï¼š$\\left(\\frac{x}{z}, \\frac{y}{z}, z\\right)$  \n\n![img](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210309104502.png)\n\n>  æˆ‘åœ¨æœ¬æ–‡çš„æœ«å°¾é™„ä¸Šäº†æˆ‘æ”¶é›†çš„ç›¸å…³æ–‡ç« åŠåšå®¢çš„é“¾æ¥ï¼Œå¦‚æœä½ æ„Ÿå…´è¶£ï¼Œå¯ä»¥ç»§ç»­æ·±å…¥é˜…è¯»ã€‚\n\næˆ‘ä»¬ç°åœ¨ä¸ä»…å¯ä»¥å°†ç¬›å¡å°”åæ ‡ç³»ï¼ˆ$z=1$ï¼‰ä¸­çš„ç‚¹è¡¨ç¤ºä¸ºä¸€ä¸ª $2\\times1$ çš„çŸ©é˜µï¼Œä¹Ÿå¯ä»¥è¡¨ç¤ºä¸ºä¸€ä¸ª $3\\times1$çš„çŸ©é˜µï¼š\n$$\n\\begin{pmatrix} x\\\\ y \\end{pmatrix} \\Leftrightarrow \\begin{pmatrix} x\\\\ y\\\\ 1 \\end{pmatrix}\n$$\nä¸è¿‡è¿™ä¹Ÿæ„å‘³ç€æˆ‘ä»¬éœ€è¦é‡æ–°å®šä¹‰æˆ‘ä»¬ä¹‹å‰å¾—åˆ°çš„å˜æ¢çŸ©é˜µï¼Œå› ä¸ºä¸€ä¸ª $3\\times1$ çš„ä½ç½®çŸ¢é‡ä¹˜ä»¥ä¸€ä¸ª $2\\times2$ çš„å˜æ¢çŸ©é˜µæ˜¯æœªå®šä¹‰çš„ã€‚\n\næˆ‘ä»¬å¿…é¡»æ‰¾åˆ°ä¸€ä¸ªå˜æ¢çŸ©é˜µ $\\mathbf{A} = \\begin{pmatrix} a & b & c \\\\ d & e &f \\\\ g&h &i \\end{pmatrix}$ \n\nåŒå‰é¢çš„ç« èŠ‚ä¸€æ ·ï¼Œæˆ‘ä»¬å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç‚¹ $\\mathbf{P}_{(x,y,z)}$ ï¼Œè¿™ä¸ªç‚¹ä»£è¡¨äº†ç¬›å¡å°”å¹³é¢ä¸­çš„ä»»æ„ç‚¹ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¸Œæœ›æ‰¾åˆ°ä¸€ä¸ªå˜æ¢çŸ©é˜µçŸ©é˜µèƒ½å¤Ÿå°†åæ ‡ç‚¹è½¬æ¢æˆ $\\mathbf{P}^{'}_{(x^{'},y^{'},z^{'})}$ ï¼Œå…¶ä¸­å˜æ¢åçš„ç‚¹çš„ $z^{'} = z$ :\n$$\n\\begin{pmatrix} x^{\\prime}\\\\y^{\\prime}\\\\z^{\\prime} \\end{pmatrix} = \\mathbf{A} . \\begin{pmatrix} x\\\\y\\\\z \\end{pmatrix} = \\begin{pmatrix} a & b & c\\\\d & e & f\\\\g & h & i\\end{pmatrix} . \\begin{pmatrix} x\\\\y\\\\z \\end{pmatrix}\n$$\n\n### ç¼©æ”¾\n\nç¼©æ”¾çš„çŸ©é˜µå½¢å¼å¦‚ä¸‹ï¼š\n$$\n\\begin{pmatrix} x^{\\prime}\\\\y^{\\prime}\\\\z^{\\prime} \\end{pmatrix} = \\begin{pmatrix} s_{x}.x\\\\s_{y}.y\\\\z \\end{pmatrix} = \\begin{pmatrix} a & b & c\\\\d & e & f\\\\g & h & i\\end{pmatrix} . \\begin{pmatrix} x\\\\y\\\\z \\end{pmatrix}\n$$\nä¸ºäº†æ‰¾åˆ°çŸ©é˜µ $A$ ï¼Œæˆ‘ä»¬è¿›è¡Œçº¿æ€§æ–¹ç¨‹æ±‚è§£ï¼š\n$$\n\\left.\n\\begin{aligned} x^{\\prime} &= s_{x} . x\\\\ s_{x} . x &= a . x + b . y + c . z\\\\\\\\ \\Rightarrow a &= s_{x} \\text{ ä¸” }\\\\ b &= 0 \\text{ ä¸” }\\\\ c &= 0 \\end{aligned}\n\\middle|\n\\begin{aligned} y^{\\prime} &= s_{y} . y\\\\ s_{y} . y &= d . x + e . y + f + z\\\\\\\\ \\Rightarrow e &= s_{y} \\text{ ä¸” }\\\\ d &= 0 \\text{ ä¸” }\\\\ f &= 0 \\end{aligned}\n\\middle|\n\\begin{aligned} z^{\\prime} &= z\\\\ \\Rightarrow z &= g . x + h . y + i + z\\\\ \\Rightarrow g &= 0 \\text{ ä¸” }\\\\ h &= 0 \\text{ ä¸” }\\\\ i &= 1 \\end{aligned}\n\\right.\n$$\nç¼©æ”¾æ¯”ä¾‹ $\\left( S_x, S_y \\right)$ çš„ $3 \\times 3$ çš„çŸ©é˜µä¸ºï¼š\n$$\n\\begin{pmatrix} a & b & c\\\\d & e & f\\\\g & h & i\\end{pmatrix} = \\begin{pmatrix} s_{x} & 0 &0\\\\0 & s_{y} & 0\\\\0 & 0 & 1\\end{pmatrix}\n$$\n\n### Reflexion\n\nå¯¹å›´ç»• $x$ è½´çš„ä»¿å°„çš„çŸ©é˜µ $\\mathbf{A}$ å¦‚ä¸‹ï¼š\n$$\n\\begin{pmatrix} x^{\\prime}\\\\y^{\\prime}\\\\z^{\\prime} \\end{pmatrix} = \\begin{pmatrix} x\\\\-y\\\\z \\end{pmatrix} = \\begin{pmatrix} a & b & c\\\\d & e & f\\\\g & h & i\\end{pmatrix} . \\begin{pmatrix} x\\\\y\\\\z \\end{pmatrix}\n$$\nåŒç†ï¼Œæ±‚è§£çº¿æ€§æ–¹ç¨‹ç»„ï¼Œå¾—åˆ°å˜æ¢çŸ©é˜µå„ä¸ªæ¡ç›®çš„å€¼ï¼š\n$$\n\\left.\n\\begin{aligned} x^{\\prime} &= x\\\\ x &= a . x + b . y + c . z\\\\\\\\ \\Rightarrow a &= 1 \\text{ ä¸” }\\\\ b &= 0 \\text{ ä¸” }\\\\ c &= 0 \\end{aligned}\n\\middle|\n\\begin{aligned} y^{\\prime} &= -y\\\\ -y &= d . x + e . y + f . z\\\\\\\\ \\Rightarrow d &= 0 \\text{ ä¸” }\\\\ e &= -1 \\text{ ä¸” }\\\\ f &= 0 \\end{aligned}\n\\middle|\n\\begin{aligned} z^{\\prime} &= z\\\\ z &= g . x + h . y + i . z\\\\\\\\ \\Rightarrow g &= 0 \\text{ ä¸” }\\\\ h &= 0 \\text{ ä¸” }\\\\ i &= 1 \\end{aligned}\n\\right.\n$$\næ ¹æ®æ±‚è§£ç»“æœï¼Œå¾—åˆ°å›´ç»• $x$ è½´çš„å˜æ¢çŸ©é˜µä¸ºï¼š\n$$\n\\begin{pmatrix} a & b & c\\\\d & e & f\\\\g & h & i\\end{pmatrix} = \\begin{pmatrix} 1 & 0 & 0\\\\ 0 & -1 & 0\\\\ 0 & 0 & 1 \\end{pmatrix}\n$$\nå¯¹å›´ç»• $y$ è½´çš„ä»¿å°„çš„çŸ©é˜µ $\\mathbf{A}$ çœ‹å¦‚ä¸‹ï¼š\n$$\n\\begin{pmatrix} x^{\\prime}\\\\y^{\\prime}\\\\z^{\\prime} \\end{pmatrix} = \\begin{pmatrix} x\\\\-y\\\\z \\end{pmatrix} = \\begin{pmatrix} a & b & c\\\\d & e & f\\\\g & h & i\\end{pmatrix} . \\begin{pmatrix} x\\\\y\\\\z \\end{pmatrix}\n$$\næ±‚è§£çº¿æ€§æ–¹ç¨‹ç»„ï¼š\n$$\n\\left.\n\\begin{aligned} x^{\\prime} &= -x\\\\ -x &= a . x + b . y + c . z\\\\\\\\ \\Rightarrow a &= -1 \\text{ and }\\\\ b &= 0 \\text{ and }\\\\ c &= 0 \\end{aligned}\n\\middle|\n\\begin{aligned} y^{\\prime} &= y\\\\ y &= d . x + e . y + f . z\\\\\\\\ \\Rightarrow d &= 0 \\text{ and }\\\\ e &= 1 \\text{ and }\\\\ f &= 0 \\end{aligned}\n\\middle|\n\\begin{aligned} z^{\\prime} &= z\\\\ z &= g . x + h . y + i . z\\\\\\\\ \\Rightarrow g &= 0 \\text{ and }\\\\ h &= 0 \\text{ and }\\\\ i &= 1 \\end{aligned}\n\\right.\n$$\n\né‚£ä¹ˆï¼Œå›´ç»• $y$ è½´çš„å˜æ¢çŸ©é˜µä¸ºï¼š\n$$\n\\begin{pmatrix} a & b & c\\\\d & e & f\\\\g & h & i\\end{pmatrix} = \\begin{pmatrix} -1 & 0 & 0\\\\ 0 & 1 & 0\\\\ 0 & 0 & 1 \\end{pmatrix}\n$$\n\n### Shearing\n\næ²¿ç€ $x$ æ–¹å‘å‰ªåˆ‡çš„è½¬æ¢çŸ©é˜µï¼š\n$$\n\\begin{aligned} \\begin{pmatrix} a & b & c\\\\d & e & f\\\\g & h & i\\end{pmatrix} &= \\begin{pmatrix} 1 & \\tan \\alpha & 0\\\\ 0 & 1 & 0\\\\ 0 & 0 & 1 \\end{pmatrix}\\\\\\\\ &= \\begin{pmatrix} 1 & k_{x} & 0\\\\ 0 & 1 & 0\\\\ 0 & 0 & 1 \\end{pmatrix}\\\\\\\\ & \\text{å…¶ä¸­ } k \\text{ æ˜¯ shearing å¸¸é‡} \\end{aligned}\n$$\nåŒæ ·çš„ï¼Œæ²¿ç€ y æ–¹å‘å‰ªåˆ‡çš„è½¬æ¢çŸ©é˜µï¼š\n$$\n\\begin{aligned} \\begin{pmatrix} a & b & c\\\\d & e & f\\\\g & h & i\\end{pmatrix} &= \\begin{pmatrix} 1 & 0 & 0\\\\ \\tan \\beta & 1 & 0\\\\ 0 & 0 & 1 \\end{pmatrix}\\\\\\\\ &= \\begin{pmatrix} 1 & 0 & 0\\\\ k_{y} & 1 & 0\\\\ 0 & 0 & 1 \\end{pmatrix}\\\\\\\\ & \\text{å…¶ä¸­ } k \\text{ æ˜¯ shearing å¸¸é‡} \\end{aligned}\n$$\n\n### æ—‹è½¬\n\nä½¿ç”¨ç›¸åŒçš„è®¡ç®—æ”¾å‡ºï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºæ–°çš„æ—‹è½¬çŸ©é˜µæ˜¯åŸºäºæˆ‘ä»¬ä¹‹å‰çš„ $2\\times2$ çš„æ—‹è½¬çŸ©é˜µï¼Œæ·»åŠ äº†ä¸€åˆ—ï¼Œè¯¥åˆ—çš„æ¡ç›®æ˜¯ï¼š$0,0$ å’Œ $1$ã€‚\n$$\n\\begin{pmatrix} a & b & c\\\\d & e & f\\\\g & h & i\\end{pmatrix} = \\begin{pmatrix} \\cos \\theta & -\\sin \\theta & 0\\\\ \\sin \\theta & \\cos \\theta & 0\\\\ 0 & 0 & 1 \\end{pmatrix}\n$$\n\n### å¹³ç§»\n\nå¹³ç§»æ˜¯æœ€æœ‰æ„æ€çš„ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ª $3\\times3$ çš„å¹³ç§»çŸ©é˜µï¼Œæˆ‘ä»¬éœ€è¦çš„çŸ©é˜µ $\\mathbf{A}$ éœ€è¦æ»¡è¶³å¦‚ä¸‹æ¡ä»¶ï¼š\n$$\n\\begin{pmatrix} x^{\\prime}\\\\y^{\\prime}\\\\z^{\\prime} \\end{pmatrix} = \\begin{pmatrix} x+t_{x}\\\\y+t_{y}\\\\z \\end{pmatrix} = \\begin{pmatrix} a & b & c\\\\d & e & f\\\\g & h & i\\end{pmatrix} . \\begin{pmatrix} x\\\\y\\\\z \\end{pmatrix}\n$$\næ±‚è§£çº¿æ€§æ–¹ç¨‹ç»„ï¼š\n$$\n\\left.\n\\begin{aligned} x^{\\prime} &= x + t_{x} \\\\ x + t_{x} &= a . x + b . y + c . z\\\\\\\\ \\Rightarrow a &= 1 \\text{ ä¸” }\\\\ b &= 0 \\text{ ä¸” }\\\\ c &= t_{x} \\end{aligned}\n\\middle|\n\\begin{aligned} y^{\\prime} &= y + t_{y}\\\\ y + t_{y} &= d . x + e . y + f . z\\\\\\\\ \\Rightarrow d &= 0 \\text{ ä¸” }\\\\ e &= 1 \\text{ ä¸” }\\\\ f &= t_{y} \\end{aligned}\n\\middle|\n\\begin{aligned} z^{\\prime} &= z\\\\ z &= g . x + h . y + i . z\\\\\\\\ \\Rightarrow g &= 0 \\text{ ä¸” }\\\\ h &= 0 \\text{ ä¸” }\\\\ i &= 1 \\end{aligned}\n\\right.\n$$\nå¾—åˆ°çŸ©é˜µ $\\mathbf{A}$:\n$$\n\\begin{pmatrix} a & b & c\\\\d & e & f\\\\g & h & i\\end{pmatrix} = \\begin{pmatrix} 1 & 0 & t_{x}\\\\0 & 1 & t_{y}\\\\0 & 0 & 1\\end{pmatrix}\n$$\n\n## çŸ©é˜µæ€»ç»“(Matrices wrap-up) \n\nå®é™…ä¸Šï¼Œä½ ä¸å¿…æ¯æ¬¡éƒ½åšè¿™äº›çº¿æ€§ä»£æ•°çš„è®¡ç®—ï¼Œä½ åªéœ€è¦ä½¿ç”¨å®ƒä»¬å°±å¯ä»¥äº†ã€‚\n\n**æ€»ç»“ï¼š**\n\n* å¹³ç§»çŸ©é˜µï¼š$\\begin{pmatrix}1 & 0 & t_{x}\\\\0 & 1 & t_{y}\\\\0 & 0 & 1\\end{pmatrix}$\n* ç¼©æ”¾çŸ©é˜µï¼š$\\begin{pmatrix}s_{x} & 0 & 0\\\\0 & s_{y} & 0\\\\0 & 0 & 1\\end{pmatrix}$\n* å‰ªåˆ‡çŸ©é˜µï¼š$\\begin{pmatrix}1 & \\tan \\alpha & 0\\\\\\tan \\beta & 1 & 0\\\\0 & 0 & 1\\end{pmatrix} = \\begin{pmatrix}1 & k_{x} & 0\\\\k_{y} & 1 & 0\\\\0 & 0 & 1\\end{pmatrix}$\n* æ—‹è½¬çŸ©é˜µï¼š $\\begin{pmatrix}\\cos \\theta & -\\sin \\theta & 0\\\\\\sin \\theta & \\cos \\theta & 0\\\\0 & 0 & 1\\end{pmatrix}$\n\nç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ˜“çš„å®šä¹‰æˆ‘ä»¬è‡ªå·±éœ€è¦çš„çŸ©é˜µï¼Œè€Œä¸”ä½ ä¹ŸçŸ¥é“äº†å®ƒå¦‚ä½•å·¥ä½œã€‚\n\næœ€åä¸€ä¸ªé—®é¢˜æ˜¯ï¼šæˆ‘ä»¬ä¹‹å‰è®¨è®ºçš„å˜æ¢éƒ½æ˜¯ä»¥åŸç‚¹ä¸ºä¸­å¿ƒã€‚å¦‚æœæˆ‘ä»¬éœ€è¦ä¸ä»¥åŸç‚¹ä¸ºä¸­å¿ƒäº†ï¼Ÿæ¯”æ–¹è¯´ä»¥æŒ‡å®šç‚¹è¿›è¡Œç¼©æ”¾ï¼Œä»¥æŸä¸ªç‚¹å¯¹å›¾åƒè¿›è¡Œæ—‹è½¬ï¼Œè¿™è¦æ€ä¹ˆåšäº†ï¼Ÿ\n\nè¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆæ˜¯ï¼š ç»„åˆï¼ˆ***composition***ï¼‰ï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨å‡ ä¸ªå˜æ¢æ¥ç»„åˆæˆæˆ‘ä»¬éœ€è¦çš„å˜æ¢ï¼›\n\n\n\n### ç»„åˆå®ä¾‹ï¼š pinch-zoom\n\næƒ³è±¡ä½ æœ‰ä¸€ä¸ªå½¢çŠ¶ï¼ˆæ¯”æ–¹è¯´æ­£æ–¹å½¢ï¼‰ï¼Œä½ æƒ³è¦ä»¥æ­£æ–¹å½¢çš„ä¸­å¿ƒè¿›è¡Œç¼©æ”¾ï¼Œç”¨äºæ¨¡æ‹Ÿæåˆç¼©æ”¾è¡Œä¸ºã€‚\n\nå˜æ¢å¯ä»¥æŒ‰å¦‚ä¸‹åºåˆ—è¿›è¡Œç»„åˆï¼š\n\n* ç§»åŠ¨é”šç‚¹åˆ°åŸç‚¹: $\\left( -t_{x}, -t_{y} \\right)$\n* ä½¿ç”¨ $\\left( s_{x}, s_{y} \\right)$ è¿›è¡Œç¼©æ”¾\n* å°†é”šç‚¹ç§»åŠ¨å›æ¥ï¼š$\\left( t_{x}, t_{y} \\right)$\n\nå…¶ä¸­ $t$ æ˜¯æˆ‘ä»¬ç¼©æ”¾å˜æ¢çš„é”šç‚¹ï¼ˆè¿™é‡Œæ˜¯æ­£æ–¹å½¢çš„ä¸­å¿ƒç‚¹ï¼‰ã€‚\n\næˆ‘ä»¬çš„å˜æ¢åºåˆ—åŒ…æ‹¬ä¸‹é¢çš„ç¬¬ä¸€ä¸ªå¹³ç§»çŸ©é˜µ $\\mathbf{C}$ ï¼Œç¼©æ”¾çŸ©é˜µ $\\mathbf{B}$ ï¼Œè¿˜æœ‰åé¢çš„ä¸€ä¸ªå¹³ç§»çŸ©é˜µ $\\mathbf{A}$ \n$$\n\\mathbf{C} = \\begin{pmatrix} 1 & 0 & -t_{x} \\\\ 0 & 1 & -t_{y} \\\\ 0 & 0 & 1 \\end{pmatrix} \\text{ , } \\mathbf{B} = \\begin{pmatrix} s_{x} & 0 & 0 \\\\ 0 & s_{y} & 0 \\\\ 0 & 0 & 1 \\end{pmatrix} \\text{ è¿˜æœ‰ } \\mathbf{A} = \\begin{pmatrix} 1 & 0 & t_{x} \\\\ 0 & 1 & t_{y} \\\\ 0 & 0 & 1 \\end{pmatrix}\n$$\nå› ä¸ºçŸ©é˜µä¹˜æ³•è¿ç®—æ˜¯ä¸å¯äº¤æ¢çš„ï¼Œé¡ºåºå¾ˆé‡è¦ï¼Œå› æ­¤æˆ‘ä»¬å°†åè¿‡æ¥åº”ç”¨è¿™äº›çŸ©é˜µã€‚\n\næˆ‘ä»¬å¾—åˆ°å¦‚ä¸‹ç»„åˆç»“æœï¼š\n$$\n\\begin{aligned} \\mathbf{A} . \\mathbf{B} . \\mathbf{C} &= \\begin{pmatrix} 1 & 0 & t_{x} \\\\ 0 & 1 & t_{y} \\\\ 0 & 0 & 1 \\end{pmatrix} . \\begin{pmatrix} s_{x} & 0 & 0 \\\\ 0 & s_{y} & 0 \\\\ 0 & 0 & 1 \\end{pmatrix} . \\begin{pmatrix} 1 & 0 & -t_{x} \\\\ 0 & 1 & -t_{y} \\\\ 0 & 0 & 1 \\end{pmatrix}\\\\\\\\ &= \\begin{pmatrix} 1 & 0 & t_{x} \\\\ 0 & 1 & t_{y} \\\\ 0 & 0 & 1 \\end{pmatrix} . \\begin{pmatrix} s_{x} & 0 & -s_{x}.t_{x} \\\\ 0 & s_{y} & -s_{y}.t_{y} \\\\ 0 & 0 & 1 \\end{pmatrix}\\\\\\\\ \\mathbf{A} . \\mathbf{B} . \\mathbf{C} &= \\begin{pmatrix} s_{x} & 0 & -s_{x}.t_{x} + t_{x} \\\\ 0 & s_{y} & -s_{y}.t_{y} + t_{y} \\\\ 0 & 0 & 1 \\end{pmatrix} \\end{aligned}\n$$\nå‡è®¾æˆ‘ä»¬æœ‰å¦‚ä¸‹æ­£æ–¹å½¢ï¼Œå…¶å„ç‚¹åæ ‡å¦‚ä¸‹ï¼š\n$$\n\\begin{pmatrix}x_{1} & x_{2} & x_{3} & x_{4}\\\\y_{1} & y_{2} & y_{3} & y_{4}\\\\1 & 1 & 1 & 1\\end{pmatrix} = \\begin{pmatrix}2 & 4 & 4 & 2\\\\1 & 1 & 3 & 3\\\\1 & 1 & 1 & 1\\end{pmatrix}\n$$\n![pinch-zoom-init](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210309115937.png)\n\næˆ‘ä»¬æƒ³è¦ä»¥å®ƒçš„ä¸­å¿ƒç‚¹åº”ç”¨ä¸¤å€çš„ç¼©æ”¾ï¼š \n\næ–°çš„åæ ‡å°†ä¼šæ˜¯ä¸‹é¢è¿™æ ·ï¼š\n$$\n\\begin{aligned} \\begin{pmatrix} x_{1}^{\\prime} & x_{2}^{\\prime} & x_{3}^{\\prime} & x_{4}^{\\prime}\\\\ y_{1}^{\\prime} & y_{2}^{\\prime} & y_{3}^{\\prime} & y_{4}^{\\prime}\\\\ 1 & 1 & 1 & 1 \\end{pmatrix} &= \\begin{pmatrix} s_{x} & 0 & -s_{x}.t_{x} + t_{x} \\\\ 0 & s_{y} & -s_{y}.t_{y} + t_{y} \\\\ 0 & 0 & 1 \\end{pmatrix} . \\begin{pmatrix} x_{1} & x_{2} & x_{3} & x_{4}\\\\ y_{1} & y_{2} & y_{3} & y_{4}\\\\ 1 & 1 & 1 & 1 \\end{pmatrix}\\\\\\\\ &= \\begin{pmatrix} 2 & 0 & -2.3 + 3 \\\\ 0 & 2 & -2.2 + 2 \\\\ 0 & 0 & 1 \\end{pmatrix} . \\begin{pmatrix} 2 & 4 & 4 & 2\\\\ 1 & 1 & 3 & 3\\\\ 1 & 1 & 1 & 1 \\end{pmatrix}\\\\\\\\ &= \\begin{pmatrix} 2 & 0 & -3 \\\\ 0 & 2 & -2 \\\\ 0 & 0 & 1 \\end{pmatrix} . \\begin{pmatrix} 2 & 4 & 4 & 2\\\\ 1 & 1 & 3 & 3\\\\ 1 & 1 & 1 & 1 \\end{pmatrix}\\\\\\\\ \\begin{pmatrix} x_{1}^{\\prime} & x_{2}^{\\prime} & x_{3}^{\\prime} & x_{4}^{\\prime}\\\\ y_{1}^{\\prime} & y_{2}^{\\prime} & y_{3}^{\\prime} & y_{4}^{\\prime}\\\\ 1 & 1 & 1 & 1 \\end{pmatrix} &= \\begin{pmatrix} 1 & 5 & 5 & 1\\\\ 0 & 0 & 4 & 4\\\\ 1 & 1 & 1 & 1 \\end{pmatrix} \\end{aligned}\n$$\n![pinch-zoom](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210309120126.gif)\n\n### ç»„åˆç¤ºä¾‹ï¼š æ—‹è½¬å›¾åƒ\n\nå‡è®¾ä½ æœ‰ä¸€ä¸ªå›¾åƒè®¾ç½®åœ¨viewä¸­ï¼Œä½†æ˜¯åŸç‚¹å¹¶ä¸æ˜¯viewçš„ä¸­å¿ƒç‚¹ï¼Œé€šå¸¸åŸç‚¹å¯èƒ½åœ¨å·¦ä¸Šè§’ï¼Œä½†æ˜¯ä½ å¸Œæœ›èƒ½å¤Ÿå›´ç»•viewçš„ä¸­ç‚¹æ¥æ—‹è½¬å›¾åƒï¼›\n\nè¿™ä¸ªå˜æ¢çš„ç»„åˆåŒ…æ‹¬å¦‚ä¸‹åºåˆ—ï¼š\n\n- ç§»åŠ¨é”šç‚¹åˆ°åŸç‚¹ï¼š $\\left( -t_{x}, -t_{y} \\right)$\n- æ—‹è½¬ $\\theta$ è§’åº¦\n- ç§»åŠ¨å›é”šç‚¹: $\\left( t_{x}, t_{y} \\right)$\n\nå…¶ä¸­ $t$ æ˜¯æˆ‘ä»¬æ—‹è½¬å˜æ¢çš„é”šç‚¹ã€‚\n\nåŒæ ·çš„ï¼Œå˜æ¢è¿‡ç¨‹æœ‰å¦‚ä¸‹ä¸‰ä¸ªçŸ©é˜µï¼Œç¬¬ä¸€ä¸ªå¹³ç§»çŸ©é˜µ $\\mathbf{C}$ ï¼Œæ—‹è½¬çŸ©é˜µ $\\mathbf{B}$ ,è¿˜æœ‰åé¢çš„ä¸€ä¸ªå¹³ç§»çŸ©é˜µ$\\mathbf{A}$ ï¼š\n$$\n\\mathbf{C} = \\begin{pmatrix} 1 & 0 & -t_{x} \\\\ 0 & 1 & -t_{y} \\\\ 0 & 0 & 1 \\end{pmatrix} \\text{ , } \\mathbf{B} = \\begin{pmatrix} \\cos \\theta & -\\sin \\theta & 0 \\\\ \\sin \\theta & \\cos \\theta & 0 \\\\ 0 & 0 & 1 \\end{pmatrix} \\text{ è¿˜æœ‰ } \\mathbf{A} = \\begin{pmatrix} 1 & 0 & t_{x} \\\\ 0 & 1 & t_{y} \\\\ 0 & 0 & 1 \\end{pmatrix}\n$$\næˆ‘ä»¬å¯ä»¥ç»„åˆå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š\n$$\n\\begin{aligned} \\mathbf{A} . \\mathbf{B} . \\mathbf{C} &= \\begin{pmatrix} 1 & 0 & t_{x} \\\\ 0 & 1 & t_{y} \\\\ 0 & 0 & 1 \\end{pmatrix} . \\begin{pmatrix} \\cos \\theta & -\\sin \\theta & 0 \\\\ \\sin \\theta & \\cos \\theta & 0 \\\\ 0 & 0 & 1 \\end{pmatrix} . \\begin{pmatrix} 1 & 0 & -t_{x} \\\\ 0 & 1 & -t_{y} \\\\ 0 & 0 & 1 \\end{pmatrix}\\\\\\\\ &= \\begin{pmatrix} 1 & 0 & t_{x} \\\\ 0 & 1 & t_{y} \\\\ 0 & 0 & 1 \\end{pmatrix} . \\begin{pmatrix} \\cos \\theta & -\\sin \\theta & -\\cos \\theta.t_{x} +\\sin \\theta.t_{y} \\\\ \\sin \\theta & \\cos \\theta & -\\sin \\theta.t_{x} -\\cos \\theta.t_{y} \\\\ 0 & 0 & 1 \\end{pmatrix}\\\\\\\\ \\mathbf{A} . \\mathbf{B} . \\mathbf{C} &= \\begin{pmatrix} \\cos \\theta & -\\sin \\theta & -\\cos \\theta.t_{x} +\\sin \\theta.t_{y} + t_{x} \\\\ \\sin \\theta & \\cos \\theta & -\\sin \\theta.t_{x} -\\cos \\theta.t_{y} + t_{y} \\\\ 0 & 0 & 1 \\end{pmatrix} \\end{aligned}\n$$\nå‡è®¾æˆ‘ä»¬çš„viewçš„èŒƒå›´æ˜¯ä¸€ä¸ªæ­£æ–¹å½¢ï¼Œé¡¶ç‚¹åæ ‡å¦‚ä¸‹ï¼š\n$$\n\\begin{pmatrix}x_{1} & x_{2} & x_{3} & x_{4}\\\\y_{1} & y_{2} & y_{3} & y_{4}\\\\1 & 1 & 1 & 1\\end{pmatrix} = \\begin{pmatrix}2 & 4 & 4 & 2\\\\1 & 1 & 3 & 3\\\\1 & 1 & 1 & 1\\end{pmatrix}\n$$\n![rotate-image-init](https://i-rant.arnaudbos.com/img/matrices-for-developers/rotate-image-init.png)\n\næˆ‘ä»¬å¸Œæœ›å›´ç»•å…¶ä¸­å¿ƒæ—‹è½¬ $\\theta = 90^{\\circ}$ ï¼Œé‚£ä¹ˆæ–°çš„åæ ‡æ˜¯ï¼š\n$$\n\\begin{aligned} \\begin{pmatrix} x_{1}^{\\prime} & x_{2}^{\\prime} & x_{3}^{\\prime} & x_{4}^{\\prime}\\\\ y_{1}^{\\prime} & y_{2}^{\\prime} & y_{3}^{\\prime} & y_{4}^{\\prime}\\\\ 1 & 1 & 1 & 1 \\end{pmatrix} &= \\begin{pmatrix} \\cos \\theta & -\\sin \\theta & -\\cos \\theta.t_{x} +\\sin \\theta.t_{y} + t_{x} \\\\ \\sin \\theta & \\cos \\theta & -\\sin \\theta.t_{x} -\\cos \\theta.t_{y} + t_{y} \\\\ 0 & 0 & 1 \\end{pmatrix} . \\begin{pmatrix} x_{1} & x_{2} & x_{3} & x_{4}\\\\ y_{1} & y_{2} & y_{3} & y_{4}\\\\ 1 & 1 & 1 & 1 \\end{pmatrix}\\\\\\\\ &= \\begin{pmatrix} 0 & -1 & -0.3+1.2+3 \\\\ 1 & 0 & -1.3-0.2+2 \\\\ 0 & 0 & 1 \\end{pmatrix} . \\begin{pmatrix} 2 & 4 & 4 & 2\\\\ 1 & 1 & 3 & 3\\\\ 1 & 1 & 1 & 1 \\end{pmatrix}\\\\\\\\ &= \\begin{pmatrix} 0 & -1 & 5 \\\\ 1 & 0 & -1 \\\\ 0 & 0 & 1 \\end{pmatrix} . \\begin{pmatrix} 2 & 4 & 4 & 2\\\\ 1 & 1 & 3 & 3\\\\ 1 & 1 & 1 & 1 \\end{pmatrix}\\\\\\\\ \\begin{pmatrix} x_{1}^{\\prime} & x_{2}^{\\prime} & x_{3}^{\\prime} & x_{4}^{\\prime}\\\\ y_{1}^{\\prime} & y_{2}^{\\prime} & y_{3}^{\\prime} & y_{4}^{\\prime}\\\\ 1 & 1 & 1 & 1 \\end{pmatrix} &= \\begin{pmatrix} 4 & 4 & 2 & 2\\\\ 1 & 3 & 3 & 1\\\\ 1 & 1 & 1 & 1 \\end{pmatrix} \\end{aligned}\n$$\n![rotate-image](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210309121028.gif)\n\n![rotate-image](https://i-rant.arnaudbos.com/img/matrices-for-developers/rotate-image.gif)\n\n## èµ„æºåŠé“¾æ¥\n\n- [All the Geogebra files Iâ€™ve used to generate the graphics and gifs](https://github.com/arnaudbos/i-rant/tree/develop/static/code/matrices-for-developers)\n- [Khan Academy algebra course on matrices](https://www.khanacademy.org/math/algebra-home/alg-matrices)\n- [A course on â€œAffine Transformationâ€ at The University of Texas at Austin](https://www.cs.utexas.edu/~fussell/courses/cs384g-fall2010/lectures/lecture07-Affine.pdf)\n- [A course on â€œComposing Transformationsâ€ at The Ohio State University](http://web.cse.ohio-state.edu/~whmin/courses/cse5542-2013-spring/6-Transformation_II.pdf)\n- [A blogpost on â€œRotating imagesâ€ by Nick Berry](http://datagenetics.com/blog/august32013/)\n- [A Youtube video course on â€œThe Rotation Matrixâ€ by Michael J. Ruiz](https://www.youtube.com/watch?v=h11ljFJeaLo)\n- [Wikipedia on Homogeneous coordinates](https://en.wikipedia.org/wiki/Homogeneous_coordinates)\n- [A blogpost on â€œExplaining Homogeneous Coordinates & Projective Geometryâ€ by Tom Dalling](http://www.tomdalling.com/blog/modern-opengl/explaining-homogenous-coordinates-and-projective-geometry/)\n- [A blogpost on â€œHomogeneous Coordinatesâ€ by Song Ho Ahn](http://www.songho.ca/math/homogeneous/homogeneous.html)\n- [A Youtube video course on â€œ2D transformations and homogeneous coordinatesâ€ by Tarun Gehlot](https://www.youtube.com/watch?v=Xzu8_Fe3ImI)\n\n### [2D Transformations with Android and Java](https://i-rant.arnaudbos.com/2d-transformations-android-java/)\n\n\n<br/>\n--- \n<br/>\n\n### è¯‘è€…è¡¥å…… \n#### android çŸ©é˜µï¼š\n\n$$\n\\begin{bmatrix}\n  MSCALE\\_X & MSKEW\\_X & MTRANS\\_X \\\\\n  MSKEW\\_Y & MSCALE\\_Y & MTRANS\\_Y \\\\\n  MPERSP\\_0 & MPERSP\\_1 & MPERSP\\_2 \\\\\n\\end{bmatrix}\n$$\n\n| å­—æ®µ                                 | ç”¨é€”                                         |\n| ------------------------------------ | -------------------------------------------- |\n| `MSCALE_X`ï¼Œ`MSCALE_Y`               | æ§åˆ¶Xè½´å’ŒYè½´æ–¹å‘çš„ç¼©æ”¾                       |\n| `MSKEW_X`ï¼Œ`MSKEW_Y`                 | æ§åˆ¶Xåæ ‡å’ŒYåæ ‡çš„æ‰­æ›²ç³»æ•°(æ—‹è½¬)             |\n| `MTRANS_X`ï¼Œ`MTRANS_Y`               | æ§åˆ¶Xæ–¹å‘å’ŒYæ–¹å‘çš„çº¿æ€§å¹³ç§»                   |\n| `MPERSP_0` , `MPERSP_1` , `MPERSP_2` | MPERSP_0ã€MPERSP_1å’ŒMPERSP_2æ˜¯å…³äºé€è§†çš„æ§åˆ¶ |\n\n#### matlab çŸ©é˜µè¿ç®— \n\n>\n>`>>`A = [4 3 ; 0 -5; 2 1 ; -6 8]\n>\n>A =\n>\n>     4     3\n>     0    -5\n>     2     1\n>    -6     8\n>\n>`>>`B = [7 1 3 ; -2 4 1]\n>\n>B =\n>\n>     7     1     3\n>    -2     4     1\n>\n>`>>`A*B\n>\n>ans =\n>\n>    22    16    15\n>    10   -20    -5\n>    12     6     7\n>   -58    26   -10\n>\n>`>>`B*A\n>\n><p style=\"color:red\">é”™è¯¯ä½¿ç”¨  * <br/>\n>\n><p style=\"color:red\">ç”¨äºçŸ©é˜µä¹˜æ³•çš„ç»´åº¦ä¸æ­£ç¡®ã€‚è¯·æ£€æŸ¥å¹¶ç¡®ä¿ç¬¬ä¸€ä¸ªçŸ©é˜µä¸­çš„åˆ—æ•°ä¸ç¬¬äºŒä¸ªçŸ©é˜µä¸­\n>çš„è¡Œæ•°åŒ¹é…ã€‚è¦æ‰§è¡ŒæŒ‰å…ƒç´ ç›¸ä¹˜ï¼Œè¯·ä½¿ç”¨ '.*'ã€‚</p>\n>\n>\n>\n>`>>`A+B\n>\n><p style=\"color:red\">çŸ©é˜µç»´åº¦å¿…é¡»ä¸€è‡´ã€‚</p>\n",
      "data": {
        "title": "[è¯‘]Androidå¼€å‘æ‰€éœ€è¦çš„çŸ©é˜µçŸ¥è¯†",
        "date": "2021-02-08 10:38:22",
        "tags": [
          "Android"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "ç¿»è¯‘å›½å¤–æ–‡ç« ï¼Œè¯¥æ–‡ç« ä»‹ç»äº†Androidå¼€å‘ä¸­çŸ©é˜µç›¸å…³çš„æ•°å­¦çŸ¥è¯†ï¼ŒåŒ…æ‹¬çŸ©é˜µæ˜¯ä»€ä¹ˆï¼ŸçŸ©é˜µåŠ æ³•åŠä¹˜æ³•è¿ç®—ï¼Œ2x2çŸ©é˜µçš„å˜æ¢ï¼Œæœ€åæ¼”è¿›ä¸ºAndroidä¸­ä½¿ç”¨çš„3x3çŸ©é˜µã€‚æ–‡ä¸­å›¾ç‰‡åŠåŠ¨å›¾æ¯”è¾ƒå¤šï¼Œç›¸å¯¹å¥½æ‡‚ã€‚",
      "fileName": "Androidå¼€å‘æ‰€éœ€è¦çš„çŸ©é˜µçŸ¥è¯†"
    },
    {
      "content": "\ngradleæœ‰ä¸‰ç§ç¼–å†™æ’ä»¶çš„æ–¹å¼ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨åœ¨é¡¹ç›®ä¸­çš„buildSrcæ¨¡å—ä¸­ç¼–å†™æ’ä»¶çš„æ–¹å¼ï¼Œè‡ªå®šä¹‰äº†ä¸€ä¸ªåº”ç”¨äºAndroidé¡¹ç›®çš„æ ¹æ®flavorè¿‡æ»¤soåº“çš„gradleæ’ä»¶ï¼›\n\n<!-- more -->\n\n## æ¦‚è¿°   \n\nè‡ªå®šä¹‰gradleæ’ä»¶æœ‰å¦‚ä¸‹ä¸‰ç§æ–¹å¼ï¼ˆ[ğŸ”—é“¾æ¥](https://docs.gradle.org/current/userguide/custom_plugins.html#sec:packaging_a_plugin)ï¼‰ï¼š\n\n1. åœ¨buildscriptä¸­ç›´æ¥ç¼–å†™ï¼›\n2. åœ¨buildSrcé¡¹ç›®ä¸­ç¼–å†™æ’ä»¶ä»£ç ï¼›\n3. åœ¨ç‹¬ç«‹çš„é¡¹ç›®ä¸­ç¼–å†™æ’ä»¶ä»£ç ï¼›\n\nè¿™é‡Œæˆ‘ä»¬å°†ä½¿ç”¨buildSrcæ–¹å¼å®ç°ä¸€ä¸ªgradleæ’ä»¶ã€‚\n\n## æ–°å»º buildSrc module\n\ngradleä¼šåœ¨é¡¹ç›®ä¸­å¯»æ‰¾åç§°ä¸ºbuildSrcæ¨¡å—ï¼Œå°†å…¶åŠ è½½ä¸ºgradleçš„æ’ä»¶ä»£ç ç›®å½•ã€‚æ‰€ä»¥æˆ‘ä»¬ç›´æ¥é€šè¿‡èœå•æ–°å»ºä¸€ä¸ªåä¸º buildSrc çš„java/kotlinæ¨¡å—ã€‚\n\nç„¶ååœ¨build.gradleä¸­æ·»åŠ ç›¸å…³çš„plugin(java-gradle-plugin)åŠä¾èµ–ï¼š\n\n```groovy\nplugins {\n    id 'java'\n    id 'java-gradle-plugin'\n    id \"org.jetbrains.kotlin.jvm\" version '1.3.61'\n}\n\ngroup = \"io.github.hanlyjiang.gradle\"\nversion = \"0.0.2\"\n\ndependencies {\n    testCompile group: 'junit', name: 'junit', version: '4.12'\n    // æ·»åŠ androidç›¸å…³build toolsä¾èµ–ï¼Œä»¥ä¾¿ä½¿ç”¨ android gradle ç›¸å…³çš„API\n    compile 'com.android.tools.build:gradle:3.2.0'\n}\n```\n\n## ç¼–å†™æ’ä»¶\n\n### éœ€æ±‚ç®€ä»‹\n\n* **åº”ç”¨åœºæ™¯ï¼š**æˆ‘ä»¬çš„äº§å“ä¸­é›†æˆäº†ä¸¤ç§VPN SDKï¼Œä½†æ˜¯å…·ä½“åˆ°æ¯ä¸ªé¡¹ç›®ä¸Šé¢ï¼Œéƒ½åªä¼šè½åœ°åˆ°å…·ä½“çš„ä¸€ç§ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦æ’é™¤å¯¹åº”çš„SDKçš„SOåº“ä»¥å‡å°APPåŒ…å¤§å°ï¼Œä¸åŒçš„åœ°åŒºçš„æ‰“åŒ…é…ç½®é€šè¿‡flavoræ¥è¿›è¡ŒåŒºåˆ†é…ç½®ï¼Œå³æ¯ä¸ªåœ°åŒºä¼šå¯¹åº”ä¸åŒçš„flavorï¼›\n\n* **éœ€æ±‚æå–**ï¼š è¿™é‡Œå®é™…ä¸Šæˆ‘ä»¬éœ€è¦çš„æ˜¯èƒ½å¤Ÿæ ¹æ®flavorï¼Œåœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­ç§»é™¤æŒ‡å®šçš„soæ–‡ä»¶ï¼›\n\n* **å®ç°æ€è·¯ï¼š** \n\n  * flavoré…ç½®æ–¹å¼ï¼šåœ¨flavorä¸­é…ç½®ä¸€ä¸ªbuildConfigFieldå­—æ®µï¼Œç”¨äºæŒ‡å®šæˆ‘ä»¬çš„flavoréœ€è¦çš„é…ç½®\n\n    ```groovy\n    // é…ç½®VPNç±»å‹\n    buildConfigField \"String\", \"VPN_TYPE\", \"\\\"$VpnType.SANG_FOR\\\"\"\n    ```\n\n  * æ’ä»¶é…ç½®ï¼šæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªso_excludeé…ç½®æ¥æŒ‡å®šå…·ä½“çš„excludeè§„åˆ™ï¼ŒåŒ…å«ä¸¤ä¸ªå­—æ®µã€‚\n\n    * buildConfigFieldKey ç”¨äºæŒ‡å®šä¹‹å‰åœ¨flavorä¸­å®šä¹‰çš„é…ç½®ï¼›\n    * configMap ä¸ºä¸€ä¸ªé…ç½®è¡¨ï¼ŒæŒ‡å®šä¸Šé¢çš„å­—æ®µå¯å–çš„å€¼ï¼Œå³å¯¹åº”å€¼åº”è¯¥excludeçš„soæ–‡ä»¶åˆ—è¡¨ï¼›\n\n    ```groovy\n    so_exclude {\n        /**\n         * ä½¿ç”¨VPN_TYPE æ¥è®¾ç½®soè¿‡æ»¤çš„è§„åˆ™\n         */\n        buildConfigFieldKey = \"VPN_TYPE\"\n        configMap = [\n                (VpnType.H3C_iNode.name()): [\n                        // æ–°åä¸‰è¿‡æ»¤æ·±ä¿¡æœçš„\n                        \"lib/armeabi-v7a/libauth_forward.so\",\n                        \"lib/armeabi-v7a/libhttps.so\",\n                        \"lib/armeabi-v7a/libpkcs12cert.so\",\n                        \"lib/armeabi-v7a/libsvpnservice.so\"\n                ],\n                (VpnType.SANG_FOR.name()) : [\n                        // æ·±ä¿¡æœè¿‡æ»¤æ–°åä¸‰çš„\n                        \"lib/armeabi-v7a/libies.so\",\n                ],\n                (VpnType.NONE.name())     : [\n                        // å¦‚é…ç½®æˆ NONEï¼Œåˆ™è¿‡æ»¤æ‰æ‰€æœ‰çš„VPNçš„\n                        // æ·±ä¿¡æœçš„so\n                        \"lib/armeabi-v7a/libauth_forward.so\",\n                        \"lib/armeabi-v7a/libhttps.so\",\n                        \"lib/armeabi-v7a/libpkcs12cert.so\",\n                        \"lib/armeabi-v7a/libsvpnservice.so\",\n                        // inodeçš„so\n                        \"lib/armeabi-v7a/libies.so\",\n                ]\n        ]\n    }\n    ```\n\n### å®šä¹‰æ’ä»¶åŠä½¿ç”¨æ’ä»¶ç®€ä»‹\n\n* æ’ä»¶éœ€è¦ç»§æ‰¿ `org.gradle.api.Plugin`ï¼Œå¯åœ¨Pluginå¯¹æ„å»ºæµç¨‹è¿›è¡Œè‡ªå®šä¹‰ï¼ˆå¦‚ï¼šåˆ›å»ºä»»åŠ¡ï¼Œå®šä¹‰ä»»åŠ¡å…³ç³»ï¼Œä¿®æ”¹å·²æœ‰ä»»åŠ¡åŠ¨ä½œç­‰ï¼‰\n* æ’ä»¶å¦‚æœéœ€è¦èƒ½å¤Ÿè¯»å–ä¸€äº›é…ç½®ï¼Œå¯é€šè¿‡ `project.extensions.create` æ¥ä»build.gradleä¸­æå–\n* å¦‚éœ€åœ¨è‡ªå·±çš„ androidä»£ç æ¨¡å—ä¸­ä½¿ç”¨æ’ä»¶ï¼Œé€šè¿‡ `apply plugin: æ’ä»¶ç±»å¼•ç”¨å³å¯`\n\n### æ’ä»¶å®ç°\n\n* æ’ä»¶çš„å®ç°å¦‚ä¸‹ï¼š\n  * è¯»å– so_exclude é…ç½®ï¼Œå­˜å‚¨åˆ° extensionï¼ˆç±»å‹ä¸º FlavorSoExcludePluginExtension ï¼‰ä¸­\n  * è¯»å– android çš„é…ç½®ï¼Œæ‰¾åˆ° AppExtensionç±»å‹çš„é…ç½®ï¼Œä¹Ÿå°±æ˜¯åº”ç”¨äº† `apply application` çš„æ¨¡å—çš„é…ç½®ï¼Œæˆ‘ä»¬çš„é¡¹ç›®ä¸­åªæœ‰ä¸€ä¸ªappæ¨¡å—åº”ç”¨æ­¤é…ç½®-å³æˆ‘ä»¬çš„apkæ¨¡å—ï¼›\n  * éå†æ‰€æœ‰å˜ä½“ï¼Œè·å–å¯¹åº”å˜ä½“çš„ so_exclude å¯¹åº”çš„é…ç½®å­—æ®µçš„å€¼ï¼Œå»ºç«‹flavoråˆ°é…ç½®å€¼çš„æ˜ å°„è¡¨ï¼›\n  * ä¿®æ”¹ packageApplication ä»»åŠ¡ï¼Œè®©å…¶åœ¨æ‰§è¡Œä¹‹å‰å³åˆ é™¤å¾…æ‰“åŒ…ä¸´æ—¶ç›®å½•ä¸­çš„å¯¹åº”soæ–‡ä»¶ï¼›\n\n```kotlin\npackage io.github.hanlyjiang.gradle.plugin.soexclude\n\nimport com.android.build.gradle.AppExtension\nimport com.android.build.gradle.api.ApkVariantOutput\nimport org.gradle.api.Plugin\nimport org.gradle.api.Project\nimport org.gradle.api.logging.LogLevel\nimport org.gradle.api.logging.Logger\nimport org.gradle.api.logging.Logging\nimport java.io.File\n\n/**\n * so æ’ä»¶çš„ gradle é…ç½®å®ä½“\n */\nopen class FlavorSoExcludePluginExtension {\n\n    /**\n     * so è¿‡æ»¤é…ç½®è¡¨\n     */\n    var configMap: Map<String, List<String>>? = null\n\n    /**\n     * é…ç½®å­—æ®µçš„åç§°\n     */\n    var buildConfigFieldKey: String = FlavorSoExcludePlugin.DEFAULT_CONFIG_KEY\n}\n\n/**\n * flavor so æ‰“åŒ…è¿‡æ»¤é…ç½®\n *\n * ## ç”¨æ³•è¯´æ˜ï¼š\n *\n * 1. åœ¨build.gradle ä¸­å¼•å…¥æ’ä»¶ <code>apply plugin: FlavorSoExcludePlugin</code>;\n * 2. æ·»åŠ  so_exclude é…ç½®æ®µï¼š\n *\n * ```groovy\n * so_exclude {\n *   buildConfigFieldKey = \"VPN_TYPE\"\n *   configMap = [\n *       (VpnType.H3C_iNode.name()): [\n *           \"lib/armeabi-v7a/libauth_forward.so\",\n *           \"lib/armeabi-v7a/libhttps.so\",\n *           \"lib/armeabi-v7a/libpkcs12cert.so\",\n *           \"lib/armeabi-v7a/libsvpnservice.so\"\n *      ],\n *      (VpnType.SANG_FOR.name()) : [\n *           \"lib/armeabi-v7a/libies.so\",\n *       ],\n *       (VpnType.NONE.name())     : [\n *               // æ·±ä¿¡æœçš„so\n *               \"lib/armeabi-v7a/libauth_forward.so\",\n *               \"lib/armeabi-v7a/libhttps.so\",\n *               \"lib/armeabi-v7a/libpkcs12cert.so\",\n *               \"lib/armeabi-v7a/libsvpnservice.so\",\n *               // inodeçš„so\n *               \"lib/armeabi-v7a/libies.so\",\n *        ]\n *   ]\n *}\n *```\n * 3. åœ¨flavorçš„é…ç½®ä¸­æ·»åŠ  buildConfigField é…ç½®ï¼Œå¦‚ï¼š\n * ```\n * buildConfigField \"String\", \"VPN_TYPE\", \"\\\"$VpnType.H3C_iNode\\\"\"\n * ```\n * å…¶ä¸­å­—æ®µçš„åç§°ä¸º ä¹‹å‰ so_exclude ä¸­é…ç½®çš„ `buildConfigFieldKey` å­—æ®µï¼Œå¯¹åº”çš„å€¼ä¸º configMap ä¸­çš„ key ï¼Œå¦‚æ­¤é…ç½®åï¼Œæ‰“åŒ…æ—¶å°±ä¼šå°†configMapå¯¹åº”keyä¸­çš„soåˆ—è¡¨è¿‡æ»¤æ‰\n * @author hanlyjiang 09/20/20 2:42 PM\n * @version 1.0\n */\nclass FlavorSoExcludePlugin : Plugin<Project> {\n    companion object {\n        const val PLUGIN_NAME = \"FlavorSoExcludePlugin\"\n        const val DEFAULT_CONFIG_KEY = \"SO_EXCLUDE\"\n        const val DEBUG = false\n\n        private val logger: Logger = Logging.getLogger(FlavorSoExcludePlugin::class.java)\n\n        fun logInfo(msg: String) {\n            logger.log(LogLevel.LIFECYCLE, \"<- $PLUGIN_NAME: $msg ->\")\n        }\n\n        fun logDebug(msg: String) {\n            if (DEBUG) {\n                logInfo(msg)\n            }\n        }\n    }\n\n    lateinit var extension: FlavorSoExcludePluginExtension\n\n    override fun apply(project: Project) {\n        // æ·»åŠ è‡ªå·±çš„é…ç½®\n        extension = project.extensions.create(\"so_exclude\", FlavorSoExcludePluginExtension::class.java)\n\n        // åˆ›å»ºä¸€ä¸ªæ‰“å°é…ç½®çš„ä»»åŠ¡ï¼Œç”¨äºå®šä¹‰\n        val task = project.tasks.create(\"printConfig\")\n        task.group = \"soExclude-plugin\"\n        task.doLast {\n            logInfo(\"-- é…ç½®å­—æ®µï¼šbuildConfigFieldKey= \" + extension.buildConfigFieldKey)\n            logInfo(\"-- å½“å‰é…ç½®ï¼š\")\n            extension.configMap?.run {\n                this.keys.forEach { key ->\n                    logInfo(\"-- config: $key -- \")\n                    get(key)?.forEach {\n                        logInfo(\"values: $it\")\n                    }\n                    logInfo(\"------------------ \")\n                }\n            }\n        }\n\t\t// è·å–androidçš„é…ç½®\n        val androidExtensions = project.extensions.getByName(\"android\")\n        logInfo(\"\" + androidExtensions.javaClass)\n        if (androidExtensions is AppExtension) { \n            // applicatoinç±»å‹çš„å°±è¿›è¡Œä»»åŠ¡å¤„ç†\n            initPackageOptions(project, androidExtensions)\n        }\n    }\n\n\n    /**\n     * vpn é…ç½®\n     */\n    private var configMap: MutableMap<String, String> = HashMap()\n\n    private fun initPackageOptions(project: Project, android: AppExtension) {\n        project.afterEvaluate {\n            android.productFlavors.all {\n                val flavorName = it.name\n                logDebug(\"--productFlavors : ${it.name}\")\n                var soExcludeConfig = \"\"\n                it.buildConfigFields[extension.buildConfigFieldKey]?.run {\n                    soExcludeConfig = value.replace(\"\\\"\", \"\")\n                }\n                logDebug(\"--productFlavors : $flavorName, soExcludeConfig: $soExcludeConfig\")\n                configMap[flavorName] = soExcludeConfig\n            }\n            android.applicationVariants.all { variant ->\n                logDebug(\"app variant flavorName: ${variant.flavorName}\")\n                val flavorName = variant.flavorName\n                val configKey = configMap[flavorName]\n                variant.outputs.forEach { output ->\n                    if (output is ApkVariantOutput) {\n                        //æ ¸å¿ƒé€»è¾‘ï¼šä¿®æ”¹packageApplicationä»»åŠ¡ï¼Œåœ¨ç”ŸæˆapkåŒ…ä¹‹å‰ï¼Œåˆ é™¤æ‰“åŒ…ä¸´æ—¶ç›®å½•ä¸­çš„soæ–‡ä»¶å³å¯é¿å…æ‰“åŒ…soåˆ°apkä¸­\n                        output.packageApplication.doFirst {\n                            output.packageApplication.jniFolders.all {\n                                // jniFolder ç›®å½•ä¸ºæœ€åæ‰“åŒ…apkæ—¶ï¼Œç”¨äºå­˜æ”¾soæ–‡ä»¶çš„ä¸´æ—¶ç›®å½•\n                                logInfo(\"å˜ä½“åç§°: ${variant.flavorName} , configKey: ${configKey}, jniFolders: \" + it.absoluteFile)\n                                handleExclude(it, configKey);\n                                true\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    private fun handleExclude(jniFolder: File?, configKey: String?) {\n        extension.configMap?.run {\n            val soExcludeList: List<String>? = get(configKey)\n            soExcludeList?.run {\n                deleteJniSoFiles(jniFolder, *(soExcludeList.toTypedArray()))\n            }\n        }\n\n    }\n\n    private fun deleteJniSoFiles(jniFolder: File?, vararg files: String) {\n        for (item in files) {\n            val file = File(jniFolder, item)\n            if (file.exists()) {\n                val deleteResult = file.delete()\n                logInfo(\"åˆ é™¤soæ–‡ä»¶ $item : ${if (deleteResult) \"æˆåŠŸ\" else \"å¤±è´¥\"}\")\n            }\n        }\n    }\n\n}\n\n```\n\n\n\n## ä½¿ç”¨æšä¸¾è¿›è¡Œé…ç½®\n\næˆ‘ä»¬åœ¨buildSrcä¸­å®šä¹‰ä¸€ä¸ªæšä¸¾ç±»ï¼Œç”¨äºçº¦å®šå¯ä»¥é…ç½®çš„å€¼ï¼Œå³å¯ä»¥æ¸…æ™°å®šä¹‰é…ç½®å€¼é¿å…é…ç½®æ—¶ç›´æ¥å†™å­—ç¬¦ä¸²å®¹æ˜“å‡ºé”™ï¼Œåˆå¯ä»¥æ”¯æŒä»£ç è‡ªåŠ¨è¡¥å…¨æ–¹ä¾¿é…ç½®ã€‚\n\n```kotlin\npackage io.github.hanlyjiang.gradle.plugin.vpn\n\n/**\n * VPN ç±»å‹\n */\nenum class VpnType {\n    /**\n     * æ·±ä¿¡æœ\n     */\n    SANG_FOR,\n\n    /**\n     * æ–°åä¸‰\n     */\n    H3C_iNode,\n\n    /**\n     * ä¸ä½¿ç”¨VPN\n     */\n    NONE,\n}\n/**\n * VPN ç±»å‹\n */\nenum class VpnType {\n    /**\n     * æ·±ä¿¡æœ\n     */\n    SANG_FOR,\n\n    /**\n     * æ–°åä¸‰\n     */\n    H3C_iNode,\n\n    /**\n     * ä¸ä½¿ç”¨VPN\n     */\n    NONE,\n}\n```\n\n## ä½¿ç”¨æ’ä»¶\n\n1. é€šè¿‡ apply plugin å¼•å…¥æ’ä»¶ï¼Œç›´æ¥ä½¿ç”¨æ’ä»¶ç±»åç§°å³å¯ï¼›\n2. æšä¸¾é…ç½®ä½¿ç”¨ï¼Œåœ¨gradleé…ç½®ä¸­å¯¼å…¥å¯¹åº”çš„æšä¸¾ç±»ï¼Œç„¶åç›´æ¥ä½¿ç”¨å³å¯ï¼š\n\nå…·ä½“é…ç½®å¦‚ä¸‹ï¼š\n\n```groovy\n// app/build.gradle\nimport io.github.hanlyjiang.gradle.plugin.soexclude.FlavorSoExcludePlugin\nimport io.github.hanlyjiang.gradle.plugin.vpn.VpnType\n\napply plugin: 'com.android.application'\n// åº”ç”¨æ’ä»¶\napply plugin: FlavorSoExcludePlugin\n\nso_exclude {\n    /**\n     * ä½¿ç”¨VPN_TYPE æ¥è®¾ç½®soè¿‡æ»¤çš„è§„åˆ™\n     */\n    buildConfigFieldKey = \"VPN_TYPE\"\n    configMap = [\n            (VpnType.H3C_iNode.name()): [\n                    // æ–°åä¸‰è¿‡æ»¤æ·±ä¿¡æœçš„\n                    \"lib/armeabi-v7a/libauth_forward.so\",\n                    \"lib/armeabi-v7a/libhttps.so\",\n                    \"lib/armeabi-v7a/libpkcs12cert.so\",\n                    \"lib/armeabi-v7a/libsvpnservice.so\"\n            ],\n            (VpnType.SANG_FOR.name()) : [\n                    // æ·±ä¿¡æœè¿‡æ»¤æ–°åä¸‰çš„\n                    \"lib/armeabi-v7a/libies.so\",\n            ],\n            (VpnType.NONE.name())     : [\n                    // å¦‚é…ç½®æˆ NONEï¼Œåˆ™è¿‡æ»¤æ‰æ‰€æœ‰çš„VPNçš„\n                    // æ·±ä¿¡æœçš„so\n                    \"lib/armeabi-v7a/libauth_forward.so\",\n                    \"lib/armeabi-v7a/libhttps.so\",\n                    \"lib/armeabi-v7a/libpkcs12cert.so\",\n                    \"lib/armeabi-v7a/libsvpnservice.so\",\n                    // inodeçš„so\n                    \"lib/armeabi-v7a/libies.so\",\n            ]\n    ]\n}\n\nandroid {\n    defaultConfig {\n        // é…ç½®VPNç±»å‹\n        buildConfigField \"String\", \"VPN_TYPE\", \"\\\"$VpnType.SANG_FOR\\\"\"\n    }\n    productFlavors {\n        // ...\n    }\n}\n```\n\n## å‚è€ƒæ–‡æ¡£\n\n- [è‡ªå®šä¹‰æ’ä»¶-å®˜æ–¹æ–‡æ¡£](https://docs.gradle.org/current/userguide/custom_plugins.html)\n- [å†è§å§ buildSrc, æ‹¥æŠ± Composing builds æå‡Android ç¼–è¯‘é€Ÿåº¦](https://juejin.im/post/6844904176250519565)\n- [å¦‚ä½•åˆ¤æ–­ä»»åŠ¡æ˜¯å¦UP-TO-DATE](https://www.jianshu.com/p/eb3fb33e4287)\n- [å¦‚ä½•è®©ä»»åŠ¡æ”¯æŒUP_TO_DATE-Gradleå®˜æ–¹æ–‡æ¡£](https://docs.gradle.org/current/userguide/more_about_tasks.html#sec:up_to_date_checks)\n- åˆ›å»ºä»»åŠ¡-https://docs.gradle.org/current/dsl/org.gradle.api.Project.html#org.gradle.api.Project:task(java.util.Map,java.lang.String)\n- [å¢é‡ä»»åŠ¡-Gradleå®˜æ–¹æ–‡æ¡£](https://docs.gradle.org/current/userguide/custom_tasks.html#incremental_tasks)\n- [å¢é‡æ„å»ºå¦‚ä½•å®ç°ï¼Ÿ-gradleå®˜æ–¹æ–‡æ¡£](https://docs.gradle.org/current/userguide/more_about_tasks.html#sec:how_does_it_work)",
      "data": {
        "title": "ç¼–å†™ä¸€ä¸ªAndroid Gradleæ’ä»¶",
        "date": "2020-09-20 10:18:50",
        "tags": [
          "Android",
          "Gradle"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "\ngradleæœ‰ä¸‰ç§ç¼–å†™æ’ä»¶çš„æ–¹å¼ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨åœ¨é¡¹ç›®ä¸­çš„buildSrcæ¨¡å—ä¸­ç¼–å†™æ’ä»¶çš„æ–¹å¼ï¼Œè‡ªå®šä¹‰äº†ä¸€ä¸ªåº”ç”¨äºAndroidé¡¹ç›®çš„æ ¹æ®flavorè¿‡æ»¤soåº“çš„gradleæ’ä»¶ï¼›",
      "fileName": "ç¼–å†™ä¸€ä¸ªAndroid-Gradleæ’ä»¶"
    },
    {
      "content": "\nä»‹ç»ARMç‰ˆæœ¬çš„Dockeré•œåƒçš„æ„å»ºï¼ŒåŒ…æ‹¬ARMæœºå™¨ä¸ŠDockerçš„å®‰è£…ï¼Œåœ¨ARMæœºå™¨ä¸Šæ„å»ºé•œåƒï¼ŒåŠåœ¨amd64æœºå™¨ä¸Šä½¿ç”¨buildxäº¤å‰æ„å»ºarmç‰ˆæœ¬é•œåƒã€‚\n\n<!-- more -->\n\n\n## å‰è¨€\n\nç°åœ¨å¾ˆå¤šåœ°æ–¹éƒ½å¯¹æœåŠ¡çš„å›½äº§åŒ–é€‚é…æœ‰æ‰€è¦æ±‚ï¼Œä¸€èˆ¬çš„å›½äº§åŒ–å¹³å°éƒ½æä¾›armç‰ˆæœ¬çš„linuxäº‘ç¯å¢ƒä¾›æˆ‘ä»¬è¿›è¡ŒæœåŠ¡éƒ¨ç½²ï¼Œå› æ­¤éœ€è¦æ„å»ºarmç‰ˆæœ¬çš„é•œåƒã€‚\n\n\n## æµ‹è¯•æœºä¿¡æ¯\n\n| CPU      | FT-1500A 4æ ¸ arm64 |\n| :------- | :----------------- |\n| å†…å­˜     | 8G                 |\n| OS       | éº’éºŸV10            |\n| åŒ…ç®¡ç†å™¨ | apt                |\n\n## ARMæœºå™¨ä¸Šå®‰è£…Docker\n\n>[Dockerå®˜æ–¹æ–‡æ¡£](https://docs.docker.com/engine/install/?fileGuid=0l3NVKX0BgflYN3R)\n\nDockeræ”¯æŒå¦‚ä¸‹ç³»ç»ŸåŠæ¶æ„\n\n![å›¾ç‰‡](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210408172838.png!thumbnail)\n\nå›½äº§ç³»ç»Ÿä¾æ®å®‰è£…åŒ…çš„æ ¼å¼é€‰æ‹©å¯¹åº”çš„å‚è€ƒç³»ç»Ÿå³å¯ï¼Œå¦‚éº’éºŸv10åŸºäºubuntuï¼Œå¯ä»¥æŒ‰[å®˜æ–¹æ–‡æ¡£- Install Docker Engine on Ubuntu](https://docs.docker.com/engine/install/ubuntu/?fileGuid=0l3NVKX0BgflYN3R)è¿›è¡Œå®‰è£…ã€‚\n\n### æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯\n\n```plain\ngeostar@geostar-ft1500a:~$ cat /proc/version\nLinux version 4.4.131-20200515.kylin.desktop-generic (YHKYLIN-OS@Kylin) (gcc version 5.5.0 20171010 (Ubuntu/Linaro 5.5.0-12ubuntu1~16.04) ) #kylin SMP Fri May 15 11:29:10 CST 2020\n```\n\nè¿™é‡Œå¯ä»¥çœ‹åˆ°ç³»ç»Ÿæ˜¯åŸºäºubuntu16.04 çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ·»åŠ ubuntu16.04ï¼ˆxenialï¼‰çš„è½¯ä»¶æº\n\n### æ·»åŠ è½¯ä»¶æº\n\n>å‚è€ƒï¼š\n>https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/\n>https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/\n\næ·»åŠ æ¸…åé•œåƒè½¯ä»¶æºï¼ˆarmæ¶æ„ï¼‰\n\n```plain\n# é»˜è®¤æ³¨é‡Šäº†æºç é•œåƒä»¥æé«˜ apt update é€Ÿåº¦ï¼Œå¦‚æœ‰éœ€è¦å¯è‡ªè¡Œå–æ¶ˆæ³¨é‡Š\ndeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ xenial main restricted universe multiverse\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ xenial main restricted universe multiverse\ndeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ xenial-updates main restricted universe multiverse\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ xenial-updates main restricted universe multiverse\ndeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ xenial-backports main restricted universe multiverse\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ xenial-backports main restricted universe multiverse\ndeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ xenial-security main restricted universe multiverse\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ xenial-security main restricted universe multiverse\n```\n\næ›´æ–°ï¼š\n\n```plain\nsudo apt-get install apt-transport-https\nsudo apt-get clean\nsudo apt-get update\n```\n\n### å®‰è£…Docker\n\n```plain\n# å¸è½½æ—§ç‰ˆæœ¬docker\nsudo apt-get remove docker docker-engine docker.io containerd runc\nsudo apt-get update\nsudo apt-get install \\\n    apt-transport-https \\\n    ca-certificates \\\n    curl \\\n    gnupg-agent \\\n    software-properties-common\n    \ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -\n# ç¡®è®¤keyæ·»åŠ æˆåŠŸ(æŸ¥æ‰¾ï¼š9DC8 5822 9FC7 DD38 854AÂ Â E2D8 8D81 803C 0EBF CD88)\nsudo apt-key fingerprint 0EBFCD88\n```\n\nç¼–è¾‘ /etc/apt/source.listï¼Œæ·»åŠ dockerè½¯ä»¶æºï¼ˆarm64 xenialï¼‰ï¼Œå¹¶ä¿å­˜\n\n```plain\n# https://docs.docker.com/engine/install/ubuntu/\ndeb [arch=arm64] https://download.docker.com/linux/ubuntu xenial stable\n```\n\nå®‰è£… docker\n\n```plain\nsudo apt-get update\n# å®‰è£…Docker\nsudo apt-get install docker-ce docker-ce-cli containerd.io\n# å®‰è£…æˆåŠŸï¼ŒæŸ¥çœ‹ç‰ˆæœ¬\ndocker --version\nDocker version 19.03.12, build 48a6621\n```\n\n## åœ¨Dockerhubä¸ŠæŸ¥æ‰¾å·²æœ‰çš„armé•œåƒ\n\nå®é™…ä¸Šå¾ˆå¤šé•œåƒéƒ½æœ‰æ„å»ºarmç‰ˆæœ¬ï¼Œå¯¹äºç›´æ¥ä½¿ç”¨çš„é•œåƒï¼Œæˆ–è€…ä½œä¸ºDockerfileä¸­FROMçš„é•œåƒï¼Œå¦‚æœæœ‰å¯¹åº”çš„armç‰ˆæœ¬ï¼Œåˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œçœç•¥æ„å»ºè¿‡ç¨‹ã€‚ä»¥[postgres](https://hub.docker.com/_/postgres?fileGuid=0l3NVKX0BgflYN3R)ä¸ºä¾‹ï¼Œåœ¨dockerhubä¸Šå¯ä»¥çœ‹åˆ°\n\n![å›¾ç‰‡](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210408172847.png!thumbnail)\n\nåœ¨å…·ä½“çš„tagä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°ç‰ˆæœ¬çš„é•œåƒæ˜¯å¦æ”¯æŒarmæ¶æ„\n\n![å›¾ç‰‡](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210408172851.png!thumbnail)\n\nä½†éœ€è¦ä½¿ç”¨çš„é•œåƒä¸æ˜¯æˆ‘ä»¬è‡ªå·±ç¼–è¯‘çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æ¥ç¡®è®¤è¯¥é•œåƒæ˜¯å¦æœ‰å¯¹åº”çš„armç‰ˆæœ¬ã€‚\n\n## ARMç‰ˆæœ¬é•œåƒæ„å»ºï¼ˆéARMæœºå™¨ä¸Šæ‰§è¡Œï¼‰\n\n>å‚è€ƒï¼š\n>-[https://github.com/docker/cli/blob/master/experimental/README.md](https://github.com/docker/cli/blob/master/experimental/README.md?fileGuid=0l3NVKX0BgflYN3R)\n>-[è·¨å¹³å°æ„å»º Docker é•œåƒæ–°å§¿åŠ¿ï¼Œx86ã€arm ä¸€æŠŠæ¢­](https://cloud.tencent.com/developer/article/1543689?fileGuid=0l3NVKX0BgflYN3R)\n\n### æ„å»ºARMé•œåƒçš„ä¸¤ç§æ–¹å¼\n\nå¯¹äºæ„å»ºé•œåƒçš„ARMç‰ˆæœ¬ï¼Œæœ‰å¦‚ä¸‹ä¸¤ç§æ–¹å¼ï¼š\n\n1. åœ¨ARMæœºå™¨ä¸Šä½¿ç”¨ docker build è¿›è¡Œæ„å»ºï¼›\n2. åœ¨X86/AMD64 çš„æœºå™¨ä¸Šä½¿ç”¨ docker buildx è¿›è¡Œäº¤å‰æ„å»ºï¼›\n\nå®é™…æµ‹è¯•ä¸­å‘ç°ç¬¬ä¸€ç§æ–¹å¼åœ¨æŸäº›æƒ…å†µä¸‹ä¼šæœ‰é—®é¢˜ï¼Œå»ºè®®é‡‡ç”¨ç»“åˆé‡‡ç”¨è¿™äºŒç§æ–¹å¼ï¼›\n\nå…³äºç¬¬äºŒç§æ„å»ºæ–¹å¼ï¼Œå¯å…ˆé˜…è¯»[è·¨å¹³å°æ„å»º Docker é•œåƒæ–°å§¿åŠ¿ï¼Œx86ã€arm ä¸€æŠŠæ¢­](https://cloud.tencent.com/developer/article/1543689?fileGuid=0l3NVKX0BgflYN3R)è¿›è¡Œäº†è§£ï¼Œä»¥ä¸‹ç®€è¦ä»‹ç»ä½¿ç”¨buildxäº¤å‰æ„å»ºçš„æ–¹å¼ï¼›\n\n> **âš ï¸æ³¨æ„ï¼š**\n>\n> 1. äº¤å‰æ„å»ºå’Œäº¤å‰è¿è¡Œçš„æ–¹å¼ä¼šæœ‰ä¸€äº›æ— æ³•é¢„çŸ¥çš„é—®é¢˜ï¼Œå»ºè®®ç®€å•çš„æ„å»ºæ­¥éª¤ï¼ˆå¦‚åªæ˜¯ä¸‹è½½è§£å‹å¯¹åº”æ¶æ„çš„æ–‡ä»¶ï¼‰å¯è€ƒè™‘åœ¨x86ä¸‹äº¤å‰æ„å»ºï¼Œå¤æ‚çš„ï¼ˆå¦‚éœ€è¦ç¼–è¯‘çš„ï¼‰åˆ™ç›´æ¥åœ¨armæœºå™¨ä¸Šè¿›è¡Œæ„å»ºï¼›\n>\n> 2. å®é™…æµ‹è¯•å‘ç°ï¼Œä½¿ç”¨[qemuæ–¹å¼](https://github.com/multiarch/qemu-user-static)åœ¨x86å¹³å°ä¸‹è¿è¡Œarmç‰ˆæœ¬çš„é•œåƒæ—¶ï¼Œæ‰§è¡Œç®€å•çš„å‘½ä»¤å¯ä»¥æˆåŠŸï¼ˆå¦‚archï¼‰ï¼Œæ‰§è¡ŒæŸäº›å¤æ‚çš„ç¨‹åºæ—¶ï¼ˆå¦‚å¯åŠ¨javaè™šæ‹Ÿæœºï¼‰ï¼Œä¼šæ— å“åº”ï¼Œæ‰€ä»¥é•œåƒçš„éªŒè¯å·¥ä½œåº”å°½é‡æ”¾ç½®åˆ°armæœºå™¨ä¸Šè¿›è¡Œï¼›\n>\n>    ä¸Šé¢ç¬¬äºŒç‚¹æŒ‰å¦‚ä¸‹æ–¹å¼æµ‹è¯•ï¼š \n>\n>    * `docker run --rm --platform=linux/arm64 openjdk:8u212-jre-alpine arch` å¯æ­£å¸¸è¾“å‡ºï¼›\n>    * `docker run --rm --platform=linux/arm64 openjdk:8u212-jre-alpine java -version` åˆ™ä¼š**å¡ä½**ï¼Œä¸”éœ€è¦ä½¿ç”¨`docker stop`åœæ­¢å®¹å™¨æ‰å¯ä»¥é€€å‡ºå®¹å™¨ï¼›\n\n### å¯ç”¨è¯•éªŒæ€§åŠŸèƒ½\n\n>å‚è€ƒï¼šhttps://docs.docker.com/engine/reference/commandline/cli/#experimental-features\n>æ³¨æ„ï¼šbuildx ä»…æ”¯æŒ docker19.03 åŠä»¥ä¸Šdockerç‰ˆæœ¬\n\nå¦‚éœ€ä½¿ç”¨ buildxï¼Œéœ€è¦å¼€å¯dockerçš„å®éªŒåŠŸèƒ½åï¼Œæ‰å¯ä»¥ä½¿ç”¨ï¼Œå¼€å¯æ–¹å¼ï¼š\n\n* ç¼–è¾‘   /etc/docker/daemon.json\n* æ·»åŠ ï¼š\n\n```json\n{\nÂ Â Â  \"experimental\": true\n}\n```\n\n* ç¼–è¾‘ ï½/.docker/config.json æ·»åŠ ï¼š\n\n```json\n\"experimental\" : \"enabled\"\n```\n\n* é‡å¯Dockerä½¿ç”Ÿæ•ˆï¼š\n  * sudo systemctl  daemon-reload\n  * sudo systemctl  restart docker\n* ç¡®è®¤æ˜¯å¦å¼€å¯ï¼š\n  * docker version -f'{{.Server.Experimental}}'\n  * å¦‚æœè¾“å‡ºtrueï¼Œåˆ™è¡¨ç¤ºå¼€å¯æˆåŠŸ\n\n### ä½¿ç”¨buildxæ„å»º\n\nbuildx çš„è¯¦ç»†ä½¿ç”¨å¯å‚è€ƒï¼š[Dockerå®˜æ–¹æ–‡æ¡£-Reference-buildx ](https://docs.docker.com/engine/reference/commandline/buildx/?fileGuid=0l3NVKX0BgflYN3R)\n\n#### åˆ›å»º buildx æ„å»ºå™¨\n\nä½¿ç”¨ docker buildx ls å‘½ä»¤æŸ¥çœ‹ç°æœ‰çš„æ„å»ºå™¨\n\n```shell\ndocker buildx ls\n```\n\nåˆ›å»ºå¹¶æ„å»ºå™¨ï¼š\n\n```shell\n# ä¸‹é¢çš„åˆ›å»ºå‘½ä»¤ä»»é€‰ä¸€æ¡ç¬¦åˆæƒ…å†µçš„å³å¯\n# 1. ä¸æŒ‡å®šä»»ä½•å‚æ•°åˆ›å»º\ndocker buildx create --use --name multiarch-builder\n# 2. å¦‚åˆ›å»ºåä½¿ç”¨docker buildx ls å‘ç°æ„å»ºèµ·æ²¡æœ‰armæ¶æ„æ”¯æŒï¼Œå¯ä½¿ç”¨--platformæ˜ç¡®æŒ‡å®šè¦æ”¯æŒçš„æ„å»ºç±»å‹ï¼Œå¦‚ä»¥ä¸‹å‘½ä»¤\ndocker buildx create --platform linux/arm64,linux/arm/v7,linux/arm/v6 --name multiarch-builder\n# 3. å¦‚éœ€åœ¨buildxè®¿é—®ç§æœ‰registryï¼Œå¯ä½¿ç”¨hostæ¨¡å¼ï¼Œå¹¶æ‰‹åŠ¨æŒ‡å®šé…ç½®æ–‡ä»¶ï¼Œé¿å…buildxæ—¶æ— æ³•è®¿é—®æœ¬åœ°çš„registryä¸»æœº \ndocker buildx create --platform linux/amd64,linux/arm64,linux/arm/v7,linux/arm/v6  --driver-opt network=host --config=/Users/hanlyjiang/.docker/buildx-config.toml --use --name multiarch-builder \n```\n\nbuildx-config.toml é…ç½®æ–‡ä»¶å†™æ³•ç±»ä¼¼ï¼š\n\n```plain\n# https://github.com/moby/buildkit/blob/master/docs/buildkitd.toml.md\n# registry configures a new Docker register used for cache import or output.\n[registry.\"zh-registry.geostar.com.cn\"]\nÂ  mirrors = [\"zh-registry.geostar.com.cn\"]\nÂ  http = true\nÂ  insecure = true\n```\n\n**å¯ç”¨æ„å»ºå™¨**\n\n```shell\n# åˆå§‹åŒ–å¹¶æ¿€æ´»\ndocker buildx inspect multiarch-builder --bootstrap\n```\n\n**ç¡®è®¤æˆåŠŸ**\n\n```plain\n# ä½¿ç”¨ docker buildx ls æŸ¥çœ‹\ndocker buildx ls \n```\n\n### ä¿®æ”¹Dockerfile\n\nå¯¹ Dockerfile çš„ä¿®æ”¹ï¼Œå¤§è‡´éœ€è¦è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š\n\n1. ç¡®è®¤åŸºç¡€é•œåƒï¼ˆFROMï¼‰æ˜¯å¦æœ‰armç‰ˆæœ¬ï¼Œå¦‚æœæœ‰ï¼Œåˆ™å¯ä»¥ä¸ç”¨æ”¹åŠ¨ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™éœ€è¦å¯»æ‰¾æ›¿ä»£é•œåƒï¼Œå¦‚æ²¡æœ‰æ›¿ä»£é•œåƒï¼Œåˆ™å¯èƒ½éœ€è¦è‡ªè¡Œç¼–è¯‘ï¼›\n2. ç¡®è®¤dockerfileçš„å„ä¸ªæ­¥éª¤ä¸­æ˜¯å¦æœ‰ä¾èµ–CPUæ¶æ„çš„ï¼Œå¦‚æœæœ‰ï¼Œåˆ™éœ€è¦æ›¿æ¢æˆarmæ¶æ„çš„ï¼Œå¦‚åœ¨æ„å»ºjitisçš„é•œåƒæ—¶ï¼ŒDockerfileä¸­æœ‰æ·»åŠ ä¸€ä¸ªamd64æ¶æ„çš„è½¯ä»¶\n\n`ADD https://github.com/just-containers/s6-overlay/releases/download/v1.21.4.0/s6-overlay-amd64.tar.gz /tmp/s6-overlay.tar.gz`\n\næ­¤æ—¶éœ€è¦æ›¿æ¢ä¸ºä¸‹é¢çš„åœ°å€(æ³¨æ„amd64æ›¿æ¢æˆäº†aarch64ï¼Œå½“ç„¶ï¼Œéœ€è¦å…ˆç¡®è®¤ä¸‹è½½åœ°å€ä¸­æœ‰æ— å¯¹åº”æ¶æ„çš„gzåŒ…ï¼Œä¸èƒ½ç®€å•åšå­—ç¬¦æ›¿æ¢)ï¼š\n\n`ADD https://github.com/just-containers/s6-overlay/releases/download/v1.21.4.0/s6-overlay-aarch64.tar.gz /tmp/s6-overlay.tar.gz`\n\nå½“ç„¶ï¼Œæˆ‘ä»¬éœ€è¦ç¡®è®¤è¯¥è½¯ä»¶æœ‰æ­¤æ¶æ„çš„å½’æ¡£åŒ…ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™éœ€è¦è€ƒè™‘ä»æºç æ„å»ºï¼›\n\n> **æç¤ºï¼š**\n>\n> æ€ä¹ˆç¡®å®šä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶/soåº“çš„å¯¹åº”çš„æ‰§è¡Œæ¶æ„ï¼Ÿ å¯ä»¥é€šè¿‡ `file {å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„}` æ¥æŸ¥çœ‹ï¼Œ\n>\n> å¦‚ä¸‹é¢æ—¶macOSä¸Šæ‰§è¡Œfileå‘½ä»¤çš„è¾“å…¥ï¼Œå¯ä»¥å‘ç°macOSä¸Šçš„gitç¨‹åºå¯ä»¥å…¼å®¹ä¸¤ç§æ¶æ„-`x86_64&arm64e`ï¼š\n>\n> ```shell\n> file $(which git)\n> /usr/bin/git: Mach-O universal binary with 2 architectures: [x86_64:Mach-O 64-bit executable x86_64] [arm64e:Mach-O 64-bit executable arm64e]\n> /usr/bin/git (for architecture x86_64):\tMach-O 64-bit executable x86_64\n> /usr/bin/git (for architecture arm64e):\tMach-O 64-bit executable arm64e\n> ```\n>\n> ä¸‹é¢çš„å‘½ä»¤åˆ™å¯¹ä¸€ä¸ªsoæ–‡ä»¶æ‰§è¡Œäº†fileï¼Œå¯ä»¥çœ‹åˆ°å…¶ä¸­çš„æ¶æ„ä¿¡æ¯ `ARM aarch64`ï¼š\n>\n> ```shell\n> file /lib/aarch64-linux-gnu/libpthread-2.23.so\n> /lib/aarch64-linux-gnu/libpthread-2.23.so: ELF 64-bit LSB shared object, ARM aarch64, version 1 (GNU/Linux), dynamically linked, interpreter /lib/ld-linux-aarch64.so.1, BuildID[sha1]=880365ebb22114e4c10108b73243144d5fa315dc, for GNU/Linux 3.7.0, not stripped\n> ```\n\n### docker buildx æ„å»ºarm64é•œåƒçš„å‘½ä»¤\n\nä½¿ç”¨ --platformæ¥æŒ‡å®šæ¶æ„ï¼Œä½¿ç”¨ `--push` æˆ– `--load` æ¥æŒ‡å®šæ„å»ºå®Œæ¯•åçš„åŠ¨ä½œã€‚\n\n```shell\ndocker buildx build --platform=linux/arm64,linux/amd64 -t xxxx:tag . --push \n```\n\n> æç¤ºï¼šå½“æŒ‡å®šå¤šä¸ªæ¶æ„æ—¶ï¼Œåªèƒ½ä½¿ç”¨ --push æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼Œæ— æ³• --loadï¼Œæ¨é€æˆåŠŸåå†é€šè¿‡ docker pull --platform æ¥æ‹‰å–æŒ‡å®šæ¶æ„çš„é•œåƒ\n\n### æ£€æŸ¥æ„å»ºæˆæœ\n\n1. é€šè¿‡ `docker buildx imagetools inspect` å‘½ä»¤æŸ¥çœ‹é•œåƒä¿¡æ¯ï¼Œçœ‹æ˜¯å¦æœ‰å¯¹åº”çš„armæ¶æ„ä¿¡æ¯ï¼›\n2. å®é™…è¿è¡Œé•œåƒï¼Œç¡®è®¤è¿è¡Œæ­£å¸¸ï¼›ï¼ˆåœ¨armæœºå™¨ä¸Šæ‰§è¡Œï¼‰\n\n>æç¤ºï¼šå¦‚è¿è¡Œæ—¶è¾“å‡º exec format error ç±»ä¼¼é”™è¯¯ï¼Œåˆ™è¡¨ç¤ºé•œåƒä¸­éƒ¨åˆ†å¯æ‰§è¡Œæ–‡ä»¶æ¶æ„ä¸åŒ¹é…ã€‚\n\n\n\n## åœ¨x86ä¸Šè¿è¡Œarmé•œåƒ\n\nå¯å‚è€ƒ [github/qemu-user-static](https://github.com/multiarch/qemu-user-static) ,ç®€è¦æè¿°å¦‚ä¸‹ï¼š\n\n* æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å®‰è£…ï¼š\n\n  `docker run --rm --privileged multiarch/qemu-user-static --reset -p yes`\n\n* ä¹‹åå³å¯è¿è¡Œarmç‰ˆæœ¬çš„é•œåƒï¼Œå¦‚ï¼š\n\n  ```shell\n  docker run --rm -t arm64v8/fedora uname -m\n  ```\n\n",
      "data": {
        "title": "Dockeræ„å»ºArmæ¶æ„é•œåƒ-é€šç”¨æ­¥éª¤",
        "date": "2020-08-19 17:20:59",
        "tags": [
          "Docker"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "\nä»‹ç»ARMç‰ˆæœ¬çš„Dockeré•œåƒçš„æ„å»ºï¼ŒåŒ…æ‹¬ARMæœºå™¨ä¸ŠDockerçš„å®‰è£…ï¼Œåœ¨ARMæœºå™¨ä¸Šæ„å»ºé•œåƒï¼ŒåŠåœ¨amd64æœºå™¨ä¸Šä½¿ç”¨buildxäº¤å‰æ„å»ºarmç‰ˆæœ¬é•œåƒã€‚",
      "fileName": "Docker-ARMæ¶æ„é•œåƒæ„å»º-é€šç”¨æ­¥éª¤"
    },
    {
      "content": "æœ¬æ–‡ä»‹ç»Gitlab-Runnerçš„å®‰è£…è¿è¡Œï¼ˆåŒ…æ‹¬dockeræ–¹å¼å®‰è£…è¿è¡ŒåŠäºŒè¿›åˆ¶ç›´æ¥è¿è¡Œï¼‰ï¼Œå¹¶ä»‹ç»å¦‚ä½•å°†Gitlabæ³¨å†Œåˆ°Gitlabã€‚åŒæ—¶è¿˜ä»‹ç»äº†gitlab-runnerçš„ä¸€äº›å¸¸ç”¨æ“ä½œå‘½ä»¤ã€‚\n\n\n<!-- more -->\n\n\n\n## å®‰è£…Gitlab-Runner\n\ngitlab-runnerå¯ä»¥ä½¿ç”¨dockeræ–¹å¼è¿è¡Œï¼Œä¹Ÿå¯ä»¥åœ¨ä¸»æœºä¸Šè¿è¡Œå…¶äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¯æŒ‰å¦‚ä¸‹æ–¹å¼è¿›è¡Œé€‰æ‹©ï¼š\n\n* æ‰§è¡Œé€šç”¨çš„æ„å»ºæµ‹è¯•ä»»åŠ¡åŠä¸ä¸éœ€è¦ç›´æ¥è®¿é—®ä¸»æœºç›®å½•çš„ï¼Œä»¥dockeræ–¹å¼å®‰è£…ï¼›\n* æ‰§è¡Œéƒ¨ç½²ç±»ä»»åŠ¡æˆ–éœ€è¦ç›´æ¥è®¿é—®ä¸»æœºç›®å½•çš„ï¼Œä»¥äºŒè¿›åˆ¶æ–¹å¼å®‰è£…ï¼›\n\nä»¥ä¸‹åˆ†åˆ«ä»‹ç»ä¸Šè¿°ä¸¤ç§å®‰è£…æ–¹å¼ã€‚\n\n\n\n### ä½¿ç”¨dockerå®‰è£…gitlab-runner\n\nä½¿ç”¨dockeræ–¹å¼å®‰è£…çš„ï¼Œéœ€å…ˆåœ¨ä¸»æœºä¸Šå®‰è£…dockerç¯å¢ƒï¼Œå¯å‚è€ƒ Docker å®˜æ–¹å®‰è£…æ–‡æ¡£ã€‚ä»¥ä¸‹æ“ä½œå‡è®¾ä¸»æœºä¸Šå·²æ­£ç¡®å®‰è£…å¹¶é…ç½®äº†dockerè¿è¡Œç¯å¢ƒï¼›\n\n>æç¤ºï¼šå¯ä»¥ä½¿ç”¨åŸºäºalpineçš„é•œåƒæ¥å‡å°å¤§å°\n\n```shell\n# å»ºç«‹é…ç½®æŒ‚è½½ç›®å½•\nmkdir -p /data/gitlab-runner/config\n# å»ºç«‹æ„å»ºç›®å½•æŒ‚è½½ç›®å½•\nmkdir -p /data/gitlab-runner/home\n# æ³¨æ„ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†åŸºäºalpineçš„é•œåƒæ¥å‡å°å¤§å°ï¼›ä½¿ç”¨ --restart æ ‡è¯†æ¥è‡ªåŠ¨é‡å¯\ndocker run -d --name gitlab-runner --restart always \\\n  -v /data/gitlab-runner/config:/etc/gitlab-runner \\\n  -v /data/gitlab-runner/home:/home/gitlab-runner \\\n  -v /var/run/docker.sock:/var/run/docker.sock \\\n  gitlab/gitlab-runner:alpine\n  \n# é€šè¿‡ä»¥ä¸‹å‘½ä»¤è®¾ç½®dockerå¼€æœºè‡ªå¯\nsudoÂ systemctl enable docker\n```\n\n### dockerå®‰è£…çš„gitlab-runnerå¸¸ç”¨æ“ä½œ\n\n#### è¿è¡Œå‘½ä»¤\n\nä½¿ç”¨å·²æœ‰å®¹å™¨\n\n```shell\n# å®¹å™¨å·²ç»è¿è¡Œçš„æƒ…å†µä¸‹\n# 1. äº¤äº’å¼æ‰§è¡Œï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œç„¶åè¾“å…¥å‘½ä»¤\ndocker exec -it gitlab-runner /bin/bash\n# ç„¶åæ‰§è¡Œå‘½ä»¤\ngitlab-runer --help\n# 2. å•æ¬¡æ‰§è¡Œ\ndocker exec gitlab-runner gitlab-runner --help\n```\n\nä½¿ç”¨ä¸´æ—¶çš„ï¼š\n\n```shell\ndocker run --rm -t -i gitlab/gitlab-runner:alpine --help\n# -it ä½¿ç”¨äº¤äº’å¼ç»ˆç«¯\n# --rm è‡ªåŠ¨åˆ é™¤\n```\n\n#### é‡å¯gitlab-runner\n\n```\ndocker restart gitlab-runner\n```\n\n#### å‡çº§ç‰ˆæœ¬\n\n```shell\n# è·å–æœ€æ–°\ndocker pull gitlab/gitlab-runner:alpine\ndocker stop gitlab-runner && docker rm gitlab-runner\ndocker run -d --name gitlab-runner --restart always \\\n  -v /var/run/docker.sock:/var/run/docker.sock \\\n  -v /data/gitlab-runner/config:/etc/gitlab-runner \\\n  -v /data/gitlab-runner/home:/home/gitlab-runner \\\n  gitlab/gitlab-runner:alpine\n```\n\n#### æŸ¥çœ‹æ—¥å¿—\n\n```shell\ndocker logs gitlab-runner\n```\n\n#### é…ç½® gitlab-runner åˆ«å\n\nåœ¨ `~/.bash_profile` æˆ– `~/.bashrc` æ–‡ä»¶ä¸­åŠ å…¥å¦‚ä¸‹å‡½æ•°é…ç½®ï¼Œåç»­è¿è¡Œ gitlab-runner å‘½ä»¤æ—¶å³å¯çœå»docker exec å‘½ä»¤\n\n```shell\n# æ·»åŠ  gitlab-runner ç›´æ¥æ‰§è¡Œåˆ°å®¹å™¨\nfunction gitlab-runner(){\n    docker exec -it gitlab-runner gitlab-runner $@\n}\n```\n\n\n\n### ä½¿ç”¨äºŒè¿›åˆ¶åŒ…å®‰è£…è¿è¡Œgitlab-runner\n\n#### è·å–å®‰è£…åŒ…å®‰è£…å¹¶è¿è¡Œ\n\n* Centos or RedHat ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å®‰è£…ï¼š\n\n  ```shell\n  ARCH=$(arch)\n  \n  curl -LJO \"https://gitlab-runner-downloads.s3.amazonaws.com/latest/rpm/gitlab-runner$ARCH.rpm\"\n  \n  rpm -i gitlab-runner_$ARCH.rpm\n  ```\n\n* Debian or Ubuntu ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å®‰è£…\n\n  ```shell\n  ARCH=$(arch)\n  \n  curl -LJO \"https://gitlab-runner-downloads.s3.amazonaws.com/latest/deb/gitlab-runner_$ARCH.deb\"\n  \n  dpkg -i gitlab-runner_$ARCH.deb\n  ```\n\n* Windows å®‰è£…\n\n  è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š https://docs.gitlab.com/runner/install/windows.html#installation\n\n* æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸï¼Œå¦‚èƒ½æˆåŠŸè¾“å‡ºgitlab-runnerçš„ç”¨æ³•ä¿¡æ¯ï¼Œåˆ™è¡¨ç¤ºå®‰è£…æˆåŠŸ\n\n  ```\n  gitlab-runner --help\n  ```\n\n* æµ‹è¯•æ˜¯å¦æˆåŠŸå¯åŠ¨\n\n  ```\n  gitlab-runner status\n  # å¦‚è¾“å‡º Service is runningï¼Œåˆ™è¡¨ç¤ºæˆåŠŸå¯åŠ¨äº†\n  ```\n\n  > é€šè¿‡dockeræ–¹å¼è¿è¡Œçš„runneråœ¨è¿è¡Œ `gitlab-runner status`æ—¶ä¼šè¾“å‡º `not running`ï¼Œè¿™å¯¹äºdockeræ–¹å¼è¿è¡Œçš„runneræ˜¯æ­£å¸¸çš„ï¼Œåªæœ‰ç›´æ¥è¿è¡Œäºä¸»æœºä¸Šçš„runneréœ€è¦å¯åŠ¨å¯¹åº”çš„æœåŠ¡ï¼›\n\n#### å®‰è£…å¹¶æ›´æ–°Gitç‰ˆæœ¬\n\nGitlab-CI ä»»åŠ¡åœ¨ runner æœºå™¨ä¸Šæ‰§è¡Œï¼Œä¼šå…ˆé€šè¿‡gitè·å–å¯¹åº”ä»“åº“çš„æœ€æ–°ä»£ç ï¼Œè¿™ä¸ªè·å–ä»£ç çš„æ“ä½œæ˜¯é€šè¿‡gitæ¥å®Œæˆçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å®‰è£…gitå·¥å…·ï¼›\n\n* **å®‰è£…Git**\n\n  ```shell\n  sudo yum install -y git\n   # æŸ¥çœ‹ç‰ˆæœ¬\n  git --version\n  # centos7 ä¸Šä¸º 1.8.xï¼Œæ— æ³•æ»¡è¶³gitlabè¦æ±‚\n  ```\n\n* **å‡çº§Gitç‰ˆæœ¬**\n\n  æŸäº›linuxå‘å‹ç‰ˆä¸Šgitç‰ˆæœ¬è¿‡ä½ï¼Œåœ¨æ‰§è¡Œæµæ°´çº¿æ—¶ä¼šå¤±è´¥ï¼Œéœ€è¦å‡çº§gitç‰ˆæœ¬ï¼Œå¯æŒ‰å¦‚ä¸‹æ–¹å¼ä»æºç å®‰è£…æœ€æ–°gitç‰ˆæœ¬ï¼›\n\n  * ä¸‹è½½git v2.27.0æºç \n\n    ```shell\n    ## ä»¥ä¸‹ä¸‹è½½æ–¹å¼ä»»é€‰å…¶ä¸€\n    # å¯é€‰ä¸‹è½½æ–¹å¼1 - ä»gitee å…‹éš†\n    git clone -b v2.27.0 https://gitee.com/hanlyjiang/git.git git-2.27.0\n    cd git-2.27.0 && git checkout -b tag-v2.27.0 v2.27.0\n    \n    # å¯é€‰ä¸‹è½½æ–¹å¼2 - ä»githubç›´æ¥ä¸‹è½½åŒ…\n    curl -LJO https://github.com/git/git/archive/v2.27.0.tar.gz\n    tar -xvf git-2.27.0.tar.gz \n    cd git-2.27.0\n    ```\n\n  * ç¼–è¯‘å®‰è£…\n\n    ```shell\n    # å®‰è£…ç¼–è¯‘ä¾èµ–åº“\n    sudo yum install  -y autoconf gcc openssh zlib-devel\n    \n    # ç¼–è¯‘å¹¶å®‰è£…\n    make configure ;# as yourself\n    ./configure --prefix=/usr ;# as yourself\n    make -j8 all ;# as yourself\n    sudo make install ;# as root\n    \n    # ç¡®è®¤ç‰ˆæœ¬ï¼š\n    git --version\n    # git version 2.27.0\n    ```\n\n#### å°†gitlab-runnerç”¨æˆ·æ·»åŠ åˆ°dockerç”¨æˆ·ç»„ï¼ˆå¯é€‰ï¼‰\n\nå¦‚éœ€è¦åœ¨è¯¥gitlab-runnerçš„CIè„šæœ¬ä¸­è¿è¡Œdockerå‘½ä»¤ï¼Œè¿™éœ€è¦å°† gitlab-runnerç”¨æˆ·æ·»åŠ åˆ°dockerçš„ç”¨æˆ·ç»„ï¼Œå¯æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š\n\n```shell\nsudo usermod -a -G docker gitlab-runner\n\n# éªŒè¯æƒé™\nsudo -u gitlab-runner -H docker info\n```\n\n#### ä¿®æ”¹ gitlab-runner æ„å»ºç›®å½•\n\nå¦‚åœ¨æ‰§è¡Œciä»»åŠ¡æ—¶ï¼Œæ‹‰å–ä»£ç æ—¶æŠ¥buildç›®å½•æƒé™é—®é¢˜ï¼Œå¯å°è¯•æŒ‰å¦‚ä¸‹æ–¹å¼ä¿®æ”¹æŒ‡å®šrunnerçš„æ„å»ºç›®å½•\n\n1. æŸ¥æ‰¾é…ç½®æ–‡ä»¶è·¯å¾„\n\n   ``` shell\n   gitlab-runner list \n   # å…¶ä¸­ConfigFileçš„å€¼å°±æ˜¯å¯¹åº”çš„é…ç½®æ–‡ä»¶ï¼Œå¦‚ï¼š\n   # ConfigFile=/etc/gitlab-runner/config.toml\n   ```\n\n2. ä¿®æ”¹ `builds_dir` æŒ‡å‘\n\n   æ‰¾å¯¹è¯¥ä»»åŠ¡å¯¹åº”çš„`[[runner]]` é…ç½®æ®µï¼Œå¹¶åœ¨è¯¥é…ç½®ä¸­æ·»åŠ  `builds_dir` æŒ‡å‘æ–°çš„å…·æœ‰æƒé™çš„ç›®å½•ï¼Œç„¶åé‡å¯å¯åŠ¨gitlab-runnerå³å¯ï¼›\n\n   ```yaml\n   [[runners]]\n     name = \"blockdataapi-engine\"\n     url = \"http://172.17.0.205/\"\n     token = \"Y-6zdV9zzi8xsY1rygbn\"\n     executor = \"shell\"\n     builds_dir = \"/data/gitlab-runner/builds\"\n     [runners.custom_build_dir]\n     [runners.cache]\n       [runners.cache.s3]\n       [runners.cache.gcs]\n   ```\n\n\n\n## æ³¨å†Œ Runner åˆ° Gitlab\n\nè¿™é‡Œæˆ‘ä»¬å°†runneræ³¨å†Œä¸ºç¾¤ç»„çš„Runnerï¼Œç¾¤ç»„runnerå¯ä»¥åœ¨ç¾¤ç»„ä¸­å…±äº«ï¼Œæ‰€æœ‰å­ç¾¤ç»„å’Œé¡¹ç›®éƒ½å¯ä»¥ä½¿ç”¨è¯¥Runnerã€‚ä¹Ÿå¯ä»¥å°†Runneræ³¨å†Œåˆ°æŒ‡å®šé¡¹ç›®ä»“åº“ä¸Šï¼Œæ“ä½œä¸Šåªæœ‰è·å–gitlab-runneræ³¨å†Œä¿¡æ¯æ—¶ä¸ä¸€æ ·ï¼›\n\n### è·å–gitlab-runneræ³¨å†Œä¿¡æ¯\n\n> å¦‚éœ€æ³¨å†Œåˆ°å…·ä½“é¡¹ç›®ï¼Œåœ¨é¡¹ç›®çš„è®¾ç½®åœ¨è¿›å…¥å¯¹åº”çš„CI/CDè®¾ç½®å³å¯ï¼Œåç»­æ“ä½œæµç¨‹ä¸€è‡´ï¼›\n\nåœ¨ç¾¤ç»„çš„è®¾ç½®ä¸­æ‰“å¼€ CI/CD è®¾ç½®\n\n![å›¾ç‰‡](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210224180602.png!thumbnail)\n\nå±•å¼€ Runner æ ä½\n\n![å›¾ç‰‡](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210224180606.png!thumbnail)\n\nè¿™é‡Œæˆ‘ä»¬é€‰æ‹©é€šè¿‡æ‰‹åŠ¨è®¾ç½®group runnerçš„æ–¹å¼æ¥æ³¨å†Œï¼Œå¯ä»¥è·å–åˆ°ä»¥ä¸‹ä¿¡æ¯ï¼š\n\n![å›¾ç‰‡](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210224180610.png!thumbnail)\n\n### æ³¨å†Œrunner\n\nä»¥dockeræ–¹å¼è¿è¡Œçš„gitlab-runnerå¯æŒ‰å¦‚ä¸‹æ–¹å¼è¿›å…¥äº¤äº’ç¯å¢ƒï¼Œ**ç›´æ¥äºŒè¿›åˆ¶è¿è¡Œçš„æ— éœ€æ­¤æ“ä½œ**ï¼›\n\nåœ¨gitlab-runner çš„æœºå™¨ä¸Šæ‰§è¡Œæ³¨å†Œå‘½ä»¤ï¼Œå°†runneræ³¨å†Œåˆ°gitlabï¼Œä¸ºäº†æ–¹ä¾¿æ“ä½œï¼Œæˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›å…¥gitlab-runnerå®¹å™¨shellç¯å¢ƒï¼š\n\n```shell\ndocker exec -it gitlab-runner /bin/bash\n```\n\næ‰§è¡Œå®Œæˆåå‡ºç°å¦‚ä¸‹äº¤äº’çª—å£\n\n```shell\nbash-4.4#\n```\n\ndockeræ–¹å¼è¿è¡Œçš„runneréœ€åœ¨æ­¤bashä¸­æ‰§è¡Œå‘½ä»¤ï¼Œä¸»æœºä¹‹é—´è¿è¡Œçš„runnerç›´æ¥åœ¨shellä¸­æ‰§è¡Œå³å¯ã€‚\n\n### æ‰§è¡Œregisterå‘½ä»¤è¿›è¡Œæ³¨å†Œ\n\n```shell\ngitlab-runner register \n# urlï¼š\nhttp://172.17.0.205/\n# token\ncEJ611JDeCWSMyu7WXWi\n# description - ç”¨äºè¾¨è¯†è¯¥æ³¨å†Œæ‰€å±çš„ç¾¤ç»„æˆ–é¡¹ç›®ï¼Œå¯ä»¥è®¾ç½®ä¸ºæ–¹ä¾¿åŒºåˆ†çš„å­—ç¬¦ä¸²\nsonarqube-runner\n# ci-tag - æ ‡ç­¾ç”¨äºåç»­CIé…ç½®ä¸­é€‰æ‹©æ­¤æ‰§è¡Œå™¨ï¼ŒåæœŸå¯ä»¥é€šè¿‡gitlabç•Œé¢æ›´æ”¹\nsonarqube,common-build\n# executor - åç»­CIä»»åŠ¡çš„æ‰§è¡Œæ–¹å¼ï¼Œdockeræ–¹å¼è¿è¡Œçš„è¯·é€‰æ‹©docker\ndocker\n# default image - CIé…ç½®ä¸­æœªæŒ‡å®šé•œåƒæ—¶é»˜è®¤ä½¿ç”¨çš„é•œåƒ\nbusybox:1.31.1\n```\n\nä»¥ä¸‹ä¸ºä¸€ä¸ªæ³¨å†Œè¿‡ç¨‹çš„äº¤äº’ç¤ºä¾‹ï¼š\n\n```shell\nbash-4.4# gitlab-runner registerÂ \nRuntime platformÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  arch=amd64 os=linux pid=205 revision=05161b14 version=12.4.1\nRunning in system-mode.Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â \nÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â \nPlease enter the gitlab-ci coordinator URL (e.g. https://gitlab.com/):\nhttp://172.17.0.205/\nPlease enter the gitlab-ci token for this runner:\ncEJ611JDeCWSMyu7WXWi\nPlease enter the gitlab-ci description for this runner:\n[e0311b0ce34b]: sonarqube-runner\nPlease enter the gitlab-ci tags for this runner (comma separated):\nsonarqube,common-build\nRegistering runner... succeededÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â runner=cEJ611JD\nPlease enter the executor: virtualbox, docker+machine, docker-ssh+machine, custom, docker-ssh, parallels, kubernetes, docker, shell, ssh:\ndocker\nPlease enter the default Docker image (e.g. ruby:2.6):\nbusybox:1.31.1\nRunner registered successfully. Feel free to start it, but if it's running already the config should be automatically reloaded!\n```\n\n### æ³¨å†Œåç¡®è®¤\n\nå®Œæˆååœ¨åˆšæ‰çš„é¡µé¢å¯ä»¥çœ‹åˆ°ï¼›\n![å›¾ç‰‡](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210224180615.png)\n\n### å–æ¶ˆæ³¨å†Œ\n\nä½¿ç”¨ list å‘½ä»¤æŸ¥çœ‹å½“å‰æ³¨å†Œçš„tokenåŠurl\n\n```shell\ngitlab-runner list\n# è¾“å‡ºç±»ä¼¼\nRuntime platform                                    arch=amd64 os=linux pid=23 revision=05161b14 version=12.4.1\nListing configured runners                          ConfigFile=/etc/gitlab-runner/config.toml\nsonarqube-runner                                    Executor=docker Token=wNwxjEztRpKxYDyK1zVd URL=http://172.17.0.205/\n```\n\nä½¿ç”¨listå‘½ä»¤è¾“å‡ºçš„tokenæœºurlä½œä¸ºå‚æ•° ä½¿ç”¨unregisterå‘½ä»¤å–æ¶ˆæ³¨å†Œ\n\n```shell\ngitlab-runner unregister -t 7KM7ftthLAYeJdsB3Tbk -u http://172.17.0.205/\n```\n\n\n\n## äº†è§£æ›´å¤š\n\n* [DOCKER æ–¹å¼å®‰è£…gitlab-runner](https://docs.gitlab.com/runner/install/docker.html)\n* [Linuxå®‰è£…gitlab-runner-Gitlabå®˜æ–¹æ–‡æ¡£](https://docs.gitlab.com/runner/install/linux-manually.html)\n* [ä½¿ç”¨Dockerè¿è¡ŒGitlab-Runner-Gitlabå®˜æ–¹æ–‡æ¡£](https://docs.gitlab.com/runner/install/docker.html)\n* [æ³¨å†ŒRunner-Gitlabå®˜æ–¹æ–‡æ¡£](https://docs.gitlab.com/runner/register/index.html)\n* [Gitlab-Runner alpine Dockerfile](https://gitlab.com/gitlab-org/gitlab-runner/blob/master/dockerfiles/alpine/Dockerfile)\n* [Windowsä¸Šæ³¨å†ŒRunner](https://docs.gitlab.com/runner/install/windows.html)\n* [å¦‚ä½•åœ¨dockeræ‰§è¡Œå™¨ä¸­æ„å»ºDockeré•œåƒï¼Ÿ](http://github.com/help/ci/docker/using_docker_build.md)",
      "data": {
        "title": "Gitlab-Runnerå®‰è£…å¹¶æ³¨å†Œ ",
        "date": "2020-06-11 16:11:58",
        "tags": [
          "Gitlab",
          "å·¥å…·"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "æœ¬æ–‡ä»‹ç»Gitlab-Runnerçš„å®‰è£…è¿è¡Œï¼ˆåŒ…æ‹¬dockeræ–¹å¼å®‰è£…è¿è¡ŒåŠäºŒè¿›åˆ¶ç›´æ¥è¿è¡Œï¼‰ï¼Œå¹¶ä»‹ç»å¦‚ä½•å°†Gitlabæ³¨å†Œåˆ°Gitlabã€‚åŒæ—¶è¿˜ä»‹ç»äº†gitlab-runnerçš„ä¸€äº›å¸¸ç”¨æ“ä½œå‘½ä»¤ã€‚",
      "fileName": "Gitlab-å®‰è£…å¹¶æ³¨å†ŒGitlab-runner"
    },
    {
      "content": "\nå°†gitlabï¼ˆDockeræ–¹å¼è¿è¡Œï¼‰ä»12.10.0å‡çº§åˆ°13.0.6 çš„è¿‡ç¨‹è®°å½•ã€‚\n\n<!-- more -->\n\n## å‡çº§å‡†å¤‡å·¥ä½œ\n\n### **ç¡®å®šå‡çº§è·¯çº¿**\n\n- ç°æœ‰ç‰ˆæœ¬ï¼š12.10.0\n- å½“ä¸‹ç›®æ ‡ç‰ˆæœ¬ï¼š13.0.6\n- ç»“åˆ [Gitlabå‡çº§è·¯çº¿å»ºè®®](https://docs.gitlab.com/ee/policy/maintenance.html#upgrade-recommendations) ç¡®å®šå¦‚ä¸‹å‡çº§è·¯çº¿ï¼š\n  - 12.10.0 -> 13.0.0 -> 13.0.6 \n  - ç”±äºæˆ‘ä»¬è·¨å¤§ç‰ˆæœ¬å‡çº§äº†ï¼ˆ12-13ï¼‰ï¼Œæ‰€ä»¥å¼•å…¥äº† 13.0.0 çš„ä¸­é—´å‡çº§è·¯å¾„\n\n### **è·å–æœ€æ–°ç‰ˆæœ¬ä¿¡æ¯**\n\n- æŸ¥çœ‹ gitlab releaseé¡µé¢ ä¿¡æ¯\n- æŸ¥çœ‹ gitlab docker hub è·å–gitlab-ce dockeré•œåƒç‰ˆæœ¬TAGï¼š\n- 13.0.0: `gitlab/gitlab-ce:13.0.0-ce.0`\n- 13.0.6: `gitlab/gitlab-ce:13.0.6-ce.0`\n- æŸ¥çœ‹å‡çº§æ³¨æ„äº‹é¡¹\n- å‡çº§æµç¨‹ï¼š https://docs.gitlab.com/omnibus/docker/README.html#update\n- ç‰ˆæœ¬å‡çº§å»ºè®®è·¯çº¿ï¼šhttps://docs.gitlab.com/ee/policy/maintenance.html#upgrade-recommendations\n\n## å¤‡ä»½\n\nå¤‡ä»½æœ‰ä¸¤ç§æ–¹å¼ï¼Œå¤‡ä»½çš„æ•°æ®é‡ä¸ç›¸åŒï¼š\n\n* å¯¹dockeræŒ‚è½½çš„gitlabæ•°æ®ç›®å½•æ•´ä½“å¤‡ä»½\n* ä½¿ç”¨ gitlabçš„ `gitlab-backup create` å‘½ä»¤åˆ›å»ºå¤‡ä»½ï¼Œå¯åŒ…å«æ‰€æœ‰gitä»“åº“ï¼ŒåŒ…æ‹¬wikiåŠæƒé™ä¿¡æ¯ã€‚\n\n> å»ºè®®å¯¹æŒ‚è½½çš„gitlabæ•°æ®ç›®å½•è¿›è¡Œä¸€æ¬¡æ•´ä½“å¤‡ä»½ï¼Œç›®å‰æš‚ä¸æ¸…æ¥šgitlab-backup createå‘½ä»¤åˆ›å»ºçš„å¤‡ä»½æ˜¯å¦åŒ…å«ciç›¸å…³å†…å®¹ã€‚\n\nä»¥ä¸‹å¯¹gitalb-backup å‘½ä»¤æ‰§è¡Œå¤‡ä»½è¿›è¡Œç®€è¦ä»‹ç»ã€‚æ•°æ®ç›®å½•çš„å¤‡ä»½æ–¹å¼ç›´æ¥å¯¹ç›®å½•è¿›è¡Œæ“ä½œå³å¯ã€‚\n\nè¿›å…¥åˆ°gitlabéƒ¨ç½²æœºå™¨ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š\n\n```shell l\ndocker exec -t <container name> gitlab-backup create\n# å¦‚æœdockerå®¹å™¨çš„åç§°æ˜¯gitlabï¼Œåˆ™å¯ä»¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå¤‡ä»½å®Œæˆåä½äºgitlabçš„æ•°æ®ç›®å½•ï¼Œå¦‚ï¼š/data/gitlab/data/backups/\ndocker exec -t $(docker ps | grep gitlab | awk '{print $1}') gitlab-backup create\n# å¤‡ä»½é…ç½®ç›®å½•\nsudo tar -cvf /data/gitlab/data/backups/1592710400_2020_06_21_12.10.0_gitlab_config_backup.tar /data/gitlab/config \n```\n\n## æ‰§è¡Œå‡çº§ï¼š\n\n- è¿›å…¥åˆ°gitlabéƒ¨ç½²æœºå™¨ \n\n```shell\nssh -p 10022 geostar@172.17.0.205\n```\n\n- è·å–Gitlabä¸­é—´ç‰ˆæœ¬é•œåƒåŠæœ€ç»ˆç‰ˆæœ¬é•œåƒ\n\n```shell\ndocker pull gitlab/gitlab-ce:13.0.0-ce.0\ndocker pull gitlab/gitlab-ce:13.0.6-ce.0\n```\n\n- åœæ­¢å¹¶ç§»é™¤ç°æœ‰æœåŠ¡\n\n```shell\nsudo docker stop gitlab \nsudo docker rm gitlab \n```\n\n- è¿›è¡Œå‡çº§ï¼Œä½¿ç”¨ 13.0.0 çš„é•œåƒè¿è¡Œgitlabï¼Œgitlabä¼šè‡ªåŠ¨å¤„ç†æ•°æ®å‡çº§æµç¨‹\n\n```shell\n    sudo docker run --detach \\\n        --hostname 172.17.0.205 \\\n        --publish 443:443 --publish 80:80 --publish 22:22 \\\n        --name gitlab \\\n        --restart always \\\n        --volume /data/gitlab/config:/etc/gitlab \\\n        --volume /data/gitlab/logs:/var/log/gitlab \\\n        --volume /data/gitlab/data:/var/opt/gitlab \\\n        gitlab/gitlab-ce:13.0.0-ce.0\n```\n\n- å¾… 13.0.0 å‡çº§å®Œæ¯•ä¹‹åï¼Œå‡çº§åˆ° 13.0.6ï¼Œä½¿ç”¨ 13.0.6 çš„é•œåƒè¿è¡Œgitlab\n\n```shell\n      sudo docker stop gitlab \n      sudo docker rm gitlab \n      sudo docker run --detach \\\n        --hostname 172.17.0.205 \\\n        --publish 443:443 --publish 80:80 --publish 22:22 \\\n        --name gitlab \\\n        --restart always \\\n        --volume /data/gitlab/config:/etc/gitlab \\\n        --volume /data/gitlab/logs:/var/log/gitlab \\\n        --volume /data/gitlab/data:/var/opt/gitlab \\\n        gitlab/gitlab-ce:13.0.6-ce.0\n```\n\n## ç¡®è®¤å‡çº§æˆåŠŸ\n\nç™»å½•ç®¡ç†å‘˜è´¦å·ï¼Œè¿›å…¥ç®¡ç†ä¸­å¿ƒ-ä»ªè¡¨ç›˜ï¼ŒæŸ¥çœ‹gitlabç‰ˆæœ¬ï¼š\n\n![image-20210302165417697](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210302165417.png)\n\n",
      "data": {
        "title": "Gitlabå‡çº§è®°å½•ï¼ˆ12.10.0-13.0.6ï¼‰",
        "date": "2020-05-21 16:50:41",
        "tags": [
          "Gitlab"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "\nå°†gitlabï¼ˆDockeræ–¹å¼è¿è¡Œï¼‰ä»12.10.0å‡çº§åˆ°13.0.6 çš„è¿‡ç¨‹è®°å½•ã€‚",
      "fileName": "gitlab-sheng-ji-ji-lu-12100-1306"
    },
    {
      "content": "ä¸»è¦å†…å®¹ï¼š\n*  ä½¿ç”¨dockerè¿è¡Œ gitlabï¼›\n*  é…ç½®LDAPåŠé‚®ç®±ï¼›\n*  é…ç½®ç®¡ç†å‘˜è´¦å·ï¼›\n*  é…ç½®é‚®ç®±é€šçŸ¥ï¼›\n*  å…³é—­ç”¨æˆ·æ³¨å†Œï¼›\n<!-- more -->\n\n## å®‰è£…\n\næˆ‘ä»¬ä½¿ç”¨dockeræ¥å®‰è£…Gitlabï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å³å¯å®‰è£…è¿è¡Œï¼Œå®Œæˆåä½¿ç”¨\n\n```shell\nexport GITLAB_DATA=/data/gitlab\n# è®¾ç½®ä¸»æœºçš„ipåŸŸå\nexport HOST_IP=192.168.43.62\nmkdir $GITLAB_DATA/config $GITLAB_DATA/logs $GITLAB_DATA/data\ndocker run --detach \\\n        --hostname $HOST_IP \\\n        --publish 443:443 --publish 80:80 --publish 22:22 \\\n        --name gitlab \\\n        --restart always \\\n        --volume $GITLAB_DATA/config:/etc/gitlab \\\n        --volume $GITLAB_DATA/logs:/var/log/gitlab \\\n        --volume $GITLAB_DATA/data:/var/opt/gitlab \\\n        gitlab/gitlab-ce:13.9.1-ce.0\n```\n\n> * æ•°æ®å…¨éƒ¨æŒ‚è½½åœ¨å¤–éƒ¨ç›®å½• GITLAB_DATA ä¸­\n> * `--hostname 192.168.43.62` : æŒ‡å®šå½“å‰æœåŠ¡çš„IPæˆ–è€…åŸŸåï¼Œåç»­å°†ä¼šæ˜¾ç¤ºä¸ºgitlabä»£ç ä»“åº“çš„å…‹éš†åœ°å€\n> * `--restart always` : è®¾ç½®æœåŠ¡è‡ªåŠ¨é‡å¯\n\n> æŸ¥çœ‹gitlabçš„å¯ç”¨ç‰ˆæœ¬ï¼š \n>\n> * [dockerhub/gitlab-ce](dockerhub/gitlab-ce)\n> * [gitlab release page](https://about.gitlab.com/releases/categories/releases/)\n\n### **æŸ¥çœ‹å¯åŠ¨çŠ¶æ€**\n\nå¯åŠ¨æœŸé—´å¯ä»¥ä½¿ç”¨ `docker ps` æŸ¥çœ‹çŠ¶æ€ï¼Œå¦‚STATUSä¸­æ˜¾ç¤ºä¸º`starting`åˆ™è¡¨ç¤ºæœåŠ¡è¿˜åœ¨å¯åŠ¨ä¸­ï¼Œå¦‚æ˜¾ç¤ºä¸º`healthy`åˆ™è¡¨ç¤ºæœåŠ¡å·²æ­£å¸¸å¯åŠ¨ï¼Œå³å¯è®¿é—® http://192.168.43.62 è®¿é—®Gitlabçš„webåœ°å€ã€‚\n\n```shell\nCONTAINER ID        IMAGE                          COMMAND             CREATED             STATUS                 PORTS                                                          NAMES\n79b432f0f601        gitlab/gitlab-ce:13.0.6-ce.0   \"/assets/wrapper\"   2 months ago        Up 2 weeks (healthy)   0.0.0.0:22->22/tcp, 0.0.0.0:80->80/tcp, 0.0.0.0:443->443/tcp   gitlab\n```\n\nä¹Ÿå¯ä½¿ç”¨ `docker logs -f gitlab` æ¥æŸ¥çœ‹gitlabçš„æœåŠ¡å¯åŠ¨æ—¥å¿—\n\n### è®¾ç½®rootç®¡ç†å‘˜ç”¨æˆ·å¯†ç \n\né¦–æ¬¡æ‰“å¼€é¡µé¢åä¼šæç¤ºè®¾ç½®rootç”¨æˆ·çš„å¯†ç ï¼Œè®¾ç½®ååŠ¡å¿…è®°å½•å¥½ç”¨æˆ·å¯†ç ï¼Œåç»­å°†ä½¿ç”¨æ­¤ç”¨æˆ·å¯¹Gitlabè¿›è¡Œç®¡ç†\n\n<img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210302163607.png\" alt=\"image-20210302163607120\" style=\"zoom:50%;\" />\n\n## é…ç½®LDAP\n\næœåŠ¡å¯åŠ¨æ­£å¸¸åï¼Œ`$GITLAB_DATA/config` æ–‡ä»¶å¤¹ä¸­å³ç”Ÿæˆäº†gitlabçš„é…ç½®æ–‡ä»¶ï¼Œå¯ç¼–è¾‘`$GITLAB_DATA/config/gitlab.rb` ï¼ˆå¯¹åº”å®¹å™¨å†…éƒ¨ `/etc/gitlab/gitlab.rb` ï¼‰æ–‡ä»¶æ¥ä¿®æ”¹gitlabé…ç½®ä»¥ä½¿ç”¨LDAP\n\n```shell\nvim /etc/gitlab/gitlab.rb\n```\n\né€šè¿‡`?` æœç´¢`LDAP`ï¼Œæ‰¾åˆ°å¦‚ä¸‹é…ç½®ç«¯ï¼ŒæŒ‰å¦‚ä¸‹æ–¹å¼è¿›è¡Œä¿®æ”¹ï¼š\n\n```ruby\n\n### LDAP Settings\n###! Docs: https://docs.gitlab.com/omnibus/settings/ldap.html\n###! **Be careful not to break the indentation in the ldap_servers block. It is\n###!   in yaml format and the spaces must be retained. Using tabs will not work.**\n\ngitlab_rails['ldap_enabled'] = true\n\ngitlab_rails['ldap_servers'] = YAML.load <<-'EOS'\n   main:\n     label: 'åŸŸè´¦å·'\n     host: '172.17.0.3'\n     port: 389\n     uid: 'sAMAccountName'\n     bind_dn: 'CN=åŸŸè´¦å·è¯»å–ç”¨æˆ·,OU=colorless-åŸŸç”¨æˆ·,DC=colorless,DC=com,DC=cn'\n     password: 'åŸŸè´¦å·è¯»å–ç”¨æˆ·çš„ç™»å½•å¯†ç '\n     encryption: 'plain' # \"start_tls\" or \"simple_tls\" or \"plain\"\n     verify_certificates: false\n     smartcard_auth: false\n     active_directory: true\n     allow_username_or_email_login: false # æ˜¯å¦å…è®¸ä»¥ç”¨æˆ·åç™»å½•ï¼ˆé‚®ç®±ä¹Ÿä¼šå–ç”¨æˆ·åæ¥ä¸¥é‡ï¼‰\n     lowercase_usernames: false\n     block_auto_created_users: false\n     base: 'OU=colorless-åŸŸç”¨æˆ·,DC=colorless,DC=com,DC=cn'\n     user_filter: ''\nEOS\n\n```\n\n> é…ç½®ä¿®æ”¹è¯´æ˜ï¼š\n>\n> * `ldap_enabled` éœ€è¦è®¾ç½®ä¸ºtrue\n> * `ldap_servers` é…ç½®ADåŸŸç›¸å…³ä¿¡æ¯\n>   * labelï¼š éšä¾¿å–ï¼Œä¼šæ˜¾ç¤ºåœ¨gitlabçš„ç™»å½•é¡µé¢\n>   * hostï¼š åŸŸæ§åˆ¶æœåŠ¡å™¨ä¸»æœºåœ°å€\n>   * portï¼š åŸŸæ§åˆ¶å™¨æœåŠ¡ç«¯å£\n>   * uidï¼š  å°†åŸŸç”¨æˆ·ä¿¡æ¯ä¸­çš„å“ªä¸ªå­—æ®µä½œä¸ºgitlabä¸Šçš„ç™»å½•æ ‡è¯†ï¼ˆä¸€èˆ¬éƒ½æ˜¯sAMAccountNameï¼‰\n>   * bind_dnï¼š ç”¨äºè®¿é—®åŸŸæ§åˆ¶æœåŠ¡å™¨çš„ç”¨æˆ·è´¦å·ï¼Œç”¨æˆ·è´¦å·çš„æ ¼å¼éœ€è¦ä½¿ç”¨`CN=xxx,OU=XXX,DC=XXXX` ç±»ä¼¼çš„æ ¼å¼\n>   * passwordï¼š å¯¹åº”çš„base_dnè´¦å·çš„å¯†ç \n>   * baseï¼š ç”¨äºç™»å½•æ—¶ï¼Œä¼šå»baseæ‰€å®šä¹‰çš„ç»„é‡Œé¢å»æ£€ç´¢ç”¨æˆ·æ˜¯å¦å­˜åœ¨ï¼Œå¦‚ç”¨æˆ·åœ¨è¿™ä¸ªèŒƒå›´å†…ï¼Œæ‰å¯ä»¥ç™»å½•ï¼›å¦‚åŠç”¨äºå…¬å¸ä¸€ä¸ªéƒ¨é—¨çš„ç™»å½•ï¼Œå¯å°†baseå€¼é…ç½®åˆ°éƒ¨é—¨çº§åˆ«ï¼Œåˆ™å…¶ä»–éƒ¨åˆ†æ— æ³•ä»¥åŸŸè´¦å·è¿›è¡Œç™»å½•ï¼›\n>\n> æç¤ºï¼š å¦‚æ— æ³•ç¡®è®¤ uidï¼Œbind_dnï¼Œbase ç­‰çš„å€¼ï¼Œå¯ä»¥å’¨è¯¢ä¿¡æ¯ä¸­å¿ƒæˆ–è€…ä½¿ç”¨ADåŸŸè®¿é—®æŸ¥çœ‹è½¯ä»¶ï¼ˆå¦‚ï¼š[Apache Directory](http://directory.apache.org/)ï¼‰è¿æ¥åˆ°åŸŸè´¦å·æ§åˆ¶å™¨æœåŠ¡åï¼Œé€šè¿‡å›¾å½¢ç•Œé¢æŸ¥çœ‹å¯¹åº”ä¿¡æ¯ï¼›\n\nä¿®æ”¹å®Œæ¯•åéœ€è¦ä¿å­˜æ–‡ä»¶åé‡å¯gitlabæœåŠ¡ï¼Œå¯¹äºdockerå¯åŠ¨çš„gitlabæ¥è¯´ï¼Œå¯æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤é‡å¯æœåŠ¡ï¼š\n\n```shell\n# å…¶ä¸­gitlabä¸ºæˆ‘ä»¬ä½¿ç”¨docker run å‘½ä»¤æ—¶é€šè¿‡--nameé€‰é¡¹æŒ‡å®šçš„å®¹å™¨åç§°\ndocker restart gitlab \n```\n\nå¾…gitlabé‡å¯å®Œæ¯•åï¼Œç™»å½•ç•Œé¢å³å‡ºç°åŸŸè´¦å·ç™»å½•çš„tabå…¥å£ï¼Œç‚¹å‡»åŸŸè´¦å·tabå³å¯ä½¿ç”¨åŸŸè´¦å·è¿›è¡Œç™»å½•\n\n<img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210302161215.png\" alt=\"image-20210302161215567\" style=\"zoom:50%;\" />\n\n## é…ç½®é‚®ç®±é€šçŸ¥\n\nå…¬å¸é‚®ç®±æœåŠ¡å™¨é…ç½®ï¼š\n\n```ruby\ngitlab_rails['smtp_enable'] = true\ngitlab_rails['smtp_address'] = \"mail.colorless.com.cn\"\ngitlab_rails['smtp_port'] = 25\ngitlab_rails['smtp_user_name'] = \"gitlab@colorless.com.cn\"\ngitlab_rails['smtp_password'] = \"xxxxx\"\ngitlab_rails['smtp_domain'] = \"colorless.com.cn\"\ngitlab_rails['smtp_authentication'] = \"login\"\ngitlab_rails['smtp_enable_starttls_auto'] = true\ngitlab_rails['smtp_tls'] = false\n```\n\n163é‚®ç®±é…ç½®ç¤ºä¾‹ï¼šï¼ˆéœ€åœ¨163é‚®ç®±ä¸­å¼€å¯SMTPæœåŠ¡ï¼Œå¯å‚è€ƒï¼š [CSDN-å¦‚ä½•ä½¿ç”¨163çš„SMTPæœåŠ¡å‘é‚®ä»¶ï¼Ÿ](https://blog.csdn.net/liuyuinsdu/article/details/113878840)ï¼‰\n\n```ruby\ngitlab_rails['smtp_enable'] = true\ngitlab_rails['smtp_address'] = \"smtp.163.com\"\ngitlab_rails['smtp_port'] = 25\ngitlab_rails['smtp_user_name'] = \"colorless@163.com\"\ngitlab_rails['smtp_password'] = \"å¯†ç \"\ngitlab_rails['smtp_domain'] = \"163.com\"\ngitlab_rails['smtp_authentication'] = \"login\"\ngitlab_rails['smtp_enable_starttls_auto'] = true\ngitlab_rails['smtp_tls'] = false\n```\n\n\n\n## å…³é—­åŠç®¡ç†å‘˜é…ç½®\n\n### èµ‹äºˆæŒ‡å®šåŸŸè´¦å·ç®¡ç†å‘˜æƒé™\n\nåœ¨é…ç½®äº†åŸŸè´¦å·ç™»å½•ä¹‹åï¼Œå…ˆè®©éœ€è¦è®¾ç½®ä¸ºç®¡ç†å‘˜çš„è´¦å·ä½¿ç”¨åŸŸè´¦å·ç™»å½•ä¸€æ¬¡gitlabï¼Œç™»å½•ågitlabå³ä¼šä¸ºè¯¥ç”¨æˆ·åˆ›å»ºå…³è”çš„gitlabè´¦å·ã€‚\n\nç„¶åä½¿ç”¨rootç”¨æˆ·ç™»å½•ï¼Œè¿›å…¥\n\n<img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210302164307.png\" alt=\"image-20210302164306980\" style=\"zoom:50%;\" />\n\nå°†ç”¨æˆ·çš„è®¿é—®ç±»å‹åˆ‡æ¢ä¸ºç®¡ç†å‘˜ï¼š\n\n<img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210302164354.png\" alt=\"image-20210302164354791\" style=\"zoom:50%;\" />\n\n### å…³é—­ç”¨æˆ·æ³¨å†Œ\n\nåœ¨é…ç½®äº†åŸŸè´¦å·ç™»å½•ä¹‹åï¼Œå¯ä»¥å…³é—­ç”¨æˆ·æ³¨å†Œï¼Œå³åªå…è®¸æ‹¥æœ‰åŸŸè´¦å·çš„äººå‘˜è¿›è¡Œç™»å½•ï¼›\n\n<img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210302164139.png\" alt=\"image-20210302164139380\" style=\"zoom:67%;\" />\n\n\n",
      "data": {
        "title": "Gitlabå®‰è£…é…ç½®",
        "date": "2020-04-06 11:54:06",
        "tags": [
          "Gitlab",
          "å·¥å…·"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "ä¸»è¦å†…å®¹ï¼š\n*  ä½¿ç”¨dockerè¿è¡Œ gitlabï¼›\n*  é…ç½®LDAPåŠé‚®ç®±ï¼›\n*  é…ç½®ç®¡ç†å‘˜è´¦å·ï¼›\n*  é…ç½®é‚®ç®±é€šçŸ¥ï¼›\n*  å…³é—­ç”¨æˆ·æ³¨å†Œï¼›",
      "fileName": "Gitlab-å®‰è£…å¹¶é…ç½®Gitlab"
    },
    {
      "content": "Androidæä¾›çš„å‡ ç§JSåŒJavaäº¤äº’çš„æ–¹å¼ä»‹ç»ï¼Œé€šè¿‡ä¸€ä¸ªå®ä¾‹ä»‹ç»é€šè¿‡`evaluateJavascript`è°ƒç”¨JSæ–¹æ³•ã€‚\n\n<!-- more -->\n## Androidæä¾›çš„jsåŸç”Ÿäº¤äº’API\n\n### Androidè°ƒç”¨ JS ä»£ç ï¼š\n\n1. é€šè¿‡WebViewçš„ **loadUrl()**\n2. é€šè¿‡WebViewçš„ **evaluateJavascript()** æ–¹æ³•\n\nAndroidè°ƒç”¨ JS ä»£ç ä¸»è¦ä½¿ç”¨ ç¬¬äºŒç§æ–¹æ³•ã€‚\n\n### JS è°ƒç”¨ Android ä»£ç ï¼š\n\n1. **é€šè¿‡ WebView çš„ addJavascriptInterface() è¿›è¡Œå¯¹è±¡æ˜ å°„**\n2. é€šè¿‡**WebChromeClient**çš„ **onJsAlert**() ã€**onJsConfirm**()ã€**onJsPrompt**() æ–¹æ³•å›è°ƒæ‹¦æˆªJSå¯¹è¯æ¡†**alert**()ã€**confirm**()ã€**prompt**() æ¶ˆæ¯\n3. é€šè¿‡**WebViewClient**çš„**shouldOverrideUrlLoading()** æ–¹æ³•å›è°ƒæ‹¦æˆª url\n\nç¬¬2å’Œç¬¬3ä¸­æ–¹å¼èƒ½åŠ›æœ‰é™ï¼Œæ‰€ä»¥ä¸»è¦æ˜¯ç¬¬ä¸€ç§ã€‚\n\n**å®˜æ–¹ç¤ºä¾‹ä»£ç ï¼š**\n\naddJavaScriptInterface æ³¨å…¥åŸç”Ÿå¯¹è±¡åˆ°JS + åŸç”Ÿé€šè¿‡loadUrl è°ƒç”¨JSä»£ç \n\n```\nclass JsObject {\n@JavascriptInterface\npublic String toString() { return \"injectedObject\"; }\n}\nwebview.getSettings().setJavaScriptEnabled(true);\n// æ³¨å…¥Javaå¯¹è±¡åˆ° JavaScript ï¼ŒJSä¸­å¯ä»¥é€šè¿‡ injectedObject æ¥è°ƒç”¨åŸç”Ÿä»£ç \nwebView.addJavascriptInterface(new JsObject(), \"injectedObject\");\nwebView.loadData(\"\", \"text/html\", null);\nwebView.loadUrl(\"javascript:alert(injectedObject.toString())\");\n```\n>**æ³¨æ„ï¼š**\n>1. Android 4.2ï¼ˆJELLY BEANï¼‰åŠæ›´é«˜ç‰ˆæœ¬ä¸­åªæœ‰è¢«*JavascriptInterface*æ³¨è§£çš„publicæ–¹æ³•æ‰å¯ä»¥åœ¨jsä¸­è°ƒç”¨ï¼› Android4.2ä»¥ä¸‹è®¾å¤‡ä¸Šï¼Œæ‰€æœ‰publicæ–¹æ³•éƒ½å¯ä»¥è¢«jsè®¿é—®ï¼ˆåŒ…æ‹¬ç»§æ‰¿çš„ï¼‰\n>2. é€šè¿‡*addJavaScriptInterface*åŠ å…¥å¯¹è±¡ ï¼š å¿…é¡»åœ¨æ³¨å…¥å¯¹è±¡ä¹‹å‰å¯ç”¨JavaScriptï¼Œå¹¶ä¸”æ³¨å…¥çš„å¯¹è±¡ç›´åˆ°ä¸‹æ¬¡é¡µé¢é‡æ–°åŠ è½½æ‰ä¼šå‡ºç°åœ¨JavaScriptä¸­ã€‚\n\n\n\n## åº”ç”¨å®ä¾‹ï¼šJavaåŒVueäº¤äº’\n\næˆ‘ä»¬éœ€è¦åœ¨é¡µé¢åŠ è½½å®Œæ¯•ä¹‹åæ›´æ–°æ•°æ®ï¼Œæ­¤æ—¶éœ€è¦é€šè¿‡Javaä¾§è°ƒç”¨JSçš„æ–¹æ³•æ¥å°†æ•°æ®ä¼ é€’ç»™JSé€šçŸ¥å…¶æ›´æ–°ï¼›\né¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨JSä¾§å®šä¹‰ä¸€ä¸ªæ¥æ”¶æ•°æ®çš„æ–¹æ³•ï¼Œä¸ºäº†èƒ½è®©Javaä¾§èƒ½æ–¹ä¾¿æ‰¾åˆ°ï¼Œæˆ‘ä»¬å°†æ–¹æ³•å®šä¹‰åˆ°windowå¯¹è±¡ä¸Šã€‚\nç„¶ååœ¨WebViewä¸­é¡µé¢åŠ è½½å®Œæ¯•ï¼ˆonPageFinishedï¼‰åï¼Œè°ƒç”¨ `webView.evaluateJavascript` æ¥è°ƒç”¨æ­¤JSæ–¹æ³•ï¼›\n\n### JSä¾§æ–¹æ³•æ³¨å†Œ\n\n>æ³¨æ„ï¼š\n>1. éœ€è¦æ·»åŠ åˆ°å…¨å±€å¯¹è±¡ï¼Œè¿™æ ·æ‰èƒ½Androidä¾§æ‰èƒ½è°ƒç”¨ï¼›\n>2. ç”±äºç¤ºä¾‹ä¸­åªæœ‰ä¸€ä¸ªappç»„ä»¶ï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨ vm.$children[0] è·å–vueç»„ä»¶\n>3. component.$data è·å–ç»„ä»¶çš„æ•°æ®ï¼Œå¹¶èµ‹å€¼ï¼Œèµ‹å€¼åviewä¼šè‡ªåŠ¨å˜åŒ–ï¼›\n```javascript\n// main.js\n/* eslint-disable no-new */\nlet vm = new Vue({\n  el: '#app',\n  components: {App},\n  template: '<App/>',\n});\n// å®šä¹‰hnUpdateDataæ–¹æ³•åˆ°windowå…¨å±€å¯¹è±¡\nwindow.hnApp = {};\nwindow.hnApp.hnUpdateData = function (data) {\n  if (!data) {\n    Android.alert(\"æ•°æ®æ ¼å¼ä¸æ­£ç¡®\");\n    return;\n  }\n  console.log(data);\n  const jsonData = JSON.parse(data);\n  const component = vm.$children[0];\n  component.$data.header = jsonData.header ? jsonData.header : {};\n  component.$data.jjb = jsonData.jjb ? jsonData.jjb : {};\n  component.$data.events = jsonData.events ? jsonData.events : [];\n};\n```\n### åŸç”Ÿä¾§è°ƒç”¨JS\n\n#### å®šä¹‰æ–¹æ³•-è°ƒç”¨JSæ–¹æ³•æ›´æ–°æ•°æ®\n\n```java\n    private void tryUpdateWebData(JSdata jSdata) {\n        if (isPageLoaded && isDataReady) {\n            String methodName = \"window.hnApp.hnUpdateData\";\n            String params = new Gson().toJson(jSdata);\n            String js = \"javascript:\" + methodName + \"(\" + JSONObject.quote(params) + \")\";\n            webView.evaluateJavascript(js, new ValueCallback<String>() {\n                @Override\n                public void onReceiveValue(String value) {\n                }\n            });\n        }\n    }\n```\n> æ³¨æ„ï¼š\n>\n> 1.  jsæ‰§è¡Œä»£ç ï¼šjavascript:methodName(å‚æ•°)\n> 2.  å‚æ•°å¤„ç†ï¼šJSONObject.quote(params) å¯¹è±¡è½¬jsonå­—ç¬¦ä¸²\n\n### WebViewåˆå§‹åŒ–å¹¶è°ƒç”¨JSæ–¹æ³•\n\n```java\npublic void initView() {\n        webView = (WebView) findViewById(R.id.web_view);\n        webView.setWebViewClient(webViewClient);\n        webView.setWebChromeClient(webChromeClient);\n        webView.setDownloadListener(downloadListener);\n        webView.requestFocusFromTouch();\n        WebSettings settings = webView.getSettings();    // Copy From Cordova SystemWebViewEngine.java\n        settings.setJavaScriptEnabled(true);\n        settings.setJavaScriptCanOpenWindowsAutomatically(true);\n        settings.setJavaScriptEnabled(true);\n    }\n\n    private WebViewClient webViewClient = new WebViewClient() {\n        @RequiresApi(api = Build.VERSION_CODES.LOLLIPOP)\n        @Override\n        public boolean shouldOverrideUrlLoading(WebView view, WebResourceRequest request) {\n            view.loadUrl(request.getUrl().toString());\n            super.shouldOverrideUrlLoading(view, request);\n            return true;\n        }\n\n        @Override\n        public void onPageFinished(WebView view, String url) {\n            super.onPageFinished(view, url);\n            isPageLoaded = true;\n            // è°ƒç”¨jsæ›´æ–°æ•°æ®\n            tryUpdateWebData(mData);\n        }\n    };\n\n    private WebChromeClient webChromeClient = new WebChromeClient() {\n        // ...   \n    }\n\n```",
      "data": {
        "title": "Android-WebViewä¸­JavaåŒJSçš„äº¤äº’",
        "date": "2020-03-20 10:18:50",
        "tags": [
          "Android",
          "WebView",
          "Vue"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "Androidæä¾›çš„å‡ ç§JSåŒJavaäº¤äº’çš„æ–¹å¼ä»‹ç»ï¼Œé€šè¿‡ä¸€ä¸ªå®ä¾‹ä»‹ç»é€šè¿‡`evaluateJavascript`è°ƒç”¨JSæ–¹æ³•ã€‚",
      "fileName": "Android-WebViewä¸­JavaåŒJSçš„äº¤äº’"
    },
    {
      "content": "> æ¬¢è¿æ¥åˆ°æˆ‘çš„å°ç«™å‘€ï¼Œå¾ˆé«˜å…´é‡è§ä½ ï¼ğŸ¤\n\n## ğŸ  å…³äºæœ¬ç«™\n\n## ğŸ‘¨â€ğŸ’» åšä¸»æ˜¯è°\n\n## â›¹ å…´è¶£çˆ±å¥½\n\n## ğŸ“¬ è”ç³»æˆ‘å‘€\n",
      "data": {
        "title": "å…³äº",
        "date": "2019-01-25 19:09:48",
        "tags": null,
        "published": true,
        "hideInList": true,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "about"
    },
    {
      "content": "ğŸ‘  æ¬¢è¿ä½¿ç”¨ **Gridea** ï¼  \nâœï¸  **Gridea** ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ... \n\n<!-- more -->\n\n[Github](https://github.com/getgridea/gridea)  \n[Gridea ä¸»é¡µ](https://gridea.dev/)  \n[ç¤ºä¾‹ç½‘ç«™](http://fehey.com/)\n\n## ç‰¹æ€§ğŸ‘‡\nğŸ“  ä½ å¯ä»¥ä½¿ç”¨æœ€é…·çš„ **Markdown** è¯­æ³•ï¼Œè¿›è¡Œå¿«é€Ÿåˆ›ä½œ  \n\nğŸŒ‰  ä½ å¯ä»¥ç»™æ–‡ç« é…ä¸Šç²¾ç¾çš„å°é¢å›¾å’Œåœ¨æ–‡ç« ä»»æ„ä½ç½®æ’å…¥å›¾ç‰‡  \n\nğŸ·ï¸  ä½ å¯ä»¥å¯¹æ–‡ç« è¿›è¡Œæ ‡ç­¾åˆ†ç»„  \n\nğŸ“‹  ä½ å¯ä»¥è‡ªå®šä¹‰èœå•ï¼Œç”šè‡³å¯ä»¥åˆ›å»ºå¤–éƒ¨é“¾æ¥èœå•  \n\nğŸ’»  ä½ å¯ä»¥åœ¨ **Windows**ï¼Œ**MacOS** æˆ– **Linux** è®¾å¤‡ä¸Šä½¿ç”¨æ­¤å®¢æˆ·ç«¯  \n\nğŸŒ  ä½ å¯ä»¥ä½¿ç”¨ **ğ–¦ğ—‚ğ—ğ—ğ—ğ–» ğ–¯ğ–ºğ—€ğ–¾ğ—Œ** æˆ– **Coding Pages** å‘ä¸–ç•Œå±•ç¤ºï¼Œæœªæ¥å°†æ”¯æŒæ›´å¤šå¹³å°  \n\nğŸ’¬  ä½ å¯ä»¥è¿›è¡Œç®€å•çš„é…ç½®ï¼Œæ¥å…¥ [Gitalk](https://github.com/gitalk/gitalk) æˆ– [DisqusJS](https://github.com/SukkaW/DisqusJS) è¯„è®ºç³»ç»Ÿ  \n\nğŸ‡¬ğŸ‡§  ä½ å¯ä»¥ä½¿ç”¨**ä¸­æ–‡ç®€ä½“**æˆ–**è‹±è¯­**  \n\nğŸŒ  ä½ å¯ä»¥ä»»æ„ä½¿ç”¨åº”ç”¨å†…é»˜è®¤ä¸»é¢˜æˆ–ä»»æ„ç¬¬ä¸‰æ–¹ä¸»é¢˜ï¼Œå¼ºå¤§çš„ä¸»é¢˜è‡ªå®šä¹‰èƒ½åŠ›  \n\nğŸ–¥  ä½ å¯ä»¥è‡ªå®šä¹‰æºæ–‡ä»¶å¤¹ï¼Œåˆ©ç”¨ OneDriveã€ç™¾åº¦ç½‘ç›˜ã€iCloudã€Dropbox ç­‰è¿›è¡Œå¤šè®¾å¤‡åŒæ­¥  \n\nğŸŒ± å½“ç„¶ **Gridea** è¿˜å¾ˆå¹´è½»ï¼Œæœ‰å¾ˆå¤šä¸è¶³ï¼Œä½†è¯·ç›¸ä¿¡ï¼Œå®ƒä¼šä¸åœå‘å‰ ğŸƒ\n\næœªæ¥ï¼Œå®ƒä¸€å®šä¼šæˆä¸ºä½ ç¦»ä¸å¼€çš„ä¼™ä¼´\n\nå°½æƒ…å‘æŒ¥ä½ çš„æ‰åå§ï¼\n\nğŸ˜˜ Enjoy~\n",
      "data": {
        "title": "Hello Gridea",
        "date": "2018-12-12 00:00:00",
        "tags": [
          "Gridea"
        ],
        "published": true,
        "hideInList": true,
        "feature": "/post-images/hello-gridea.png",
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "ğŸ‘  æ¬¢è¿ä½¿ç”¨ **Gridea** ï¼  \nâœï¸  **Gridea** ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ... ",
      "fileName": "hello-gridea"
    },
    {
      "content": "androidäº‹ä»¶åŸºç¡€åŠæ‰‹åŠ¿ï¼Œä¸»è¦å…³æ³¨å„ç§æ‰‹åŠ¿çš„ä½¿ç”¨åŠå…¶è®¡ç®—åŸç† ã€‚  \n\n<!-- more -->\n\n\n## Androidäº‹ä»¶åŸºç¡€\n\nè¿™é‡Œæˆ‘ä»¬ä¸»è¦å…³æ³¨æ¦‚å¿µ\n\n### äº‹ä»¶ç›‘å¬å™¨åŠäº‹ä»¶å¤„ç†ç¨‹åº\n\nå¯ç›´æ¥æŸ¥çœ‹ [å®˜æ–¹æ–‡æ¡£](https://developer.android.google.cn/guide/topics/ui/ui-events)ï¼Œæ­¤å¤„ä»…åšç®€è¦æè¿°ï¼›\n\n#### äº‹ä»¶ç›‘å¬å™¨\n\nViewç±»çš„åŒ…å«ä¸€ä¸ªå›è°ƒæ–¹æ³•çš„æ¥å£ï¼Œé€šè¿‡setXXXListeneræ¥å®šä¹‰äº‹ä»¶å¤„ç†ç¨‹åºï¼›\n\n> äº‹ä»¶ç›‘å¬å™¨æ˜¯ `View` ç±»ä¸­åŒ…å«ä¸€ä¸ªå›è°ƒæ–¹æ³•çš„æ¥å£ã€‚å½“ç”¨æˆ·ä¸ç•Œé¢é¡¹ç›®ä¹‹é—´çš„äº’åŠ¨è§¦å‘å·²æ³¨å†Œç›‘å¬å™¨çš„ View å¯¹è±¡æ—¶ï¼ŒAndroid æ¡†æ¶å°†è°ƒç”¨è¿™äº›æ–¹æ³•ã€‚\n>\n> äº‹ä»¶ç›‘å¬å™¨æ¥å£ä¸­åŒ…å«ä»¥ä¸‹å›è°ƒæ–¹æ³•ï¼šonClick()ï¼ŒonLongClick()ï¼ŒonFocusChange()ï¼ŒonKey()ï¼ŒonTouch()ï¼ŒonCreateContextMenu()\n\næˆ‘ä»¬é‡ç‚¹å…³æ³¨onTouchï¼š\n\n> onTouch()ï¼š åœ¨ `View.OnTouchListener` ä¸­ã€‚å½“ç”¨æˆ·æ‰§è¡Œå¯è§†ä¸ºè§¦æ‘¸äº‹ä»¶çš„æ“ä½œæ—¶ï¼ŒåŒ…æ‹¬æŒ‰ä¸‹ã€é‡Šæ”¾æˆ–å±å¹•ä¸Šçš„ä»»ä½•ç§»åŠ¨æ‰‹åŠ¿ï¼ˆåœ¨é¡¹ç›®è¾¹ç•Œå†…ï¼‰ï¼Œç³»ç»Ÿä¼šè°ƒç”¨æ­¤æ–¹æ³•ã€‚\n>\n> æ­¤æ–¹æ³•è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒæŒ‡ç¤ºç›‘å¬å™¨æ˜¯å¦å¤„ç†å®Œæ­¤äº‹ä»¶ã€‚é‡è¦çš„æ˜¯ï¼Œæ­¤äº‹ä»¶å¯ä»¥æ‹¥æœ‰å¤šä¸ªåˆ†å…ˆåé¡ºåºçš„æ“ä½œã€‚å› æ­¤ï¼Œå¦‚æœåœ¨æ”¶åˆ° down æ“ä½œäº‹ä»¶æ—¶è¿”å› falseï¼Œåˆ™è¡¨ç¤ºæ‚¨å¹¶æœªå¤„ç†å®Œæ­¤äº‹ä»¶ï¼Œè€Œä¸”å¯¹å…¶åç»­æ“ä½œä¹Ÿä¸æ„Ÿå…´è¶£ã€‚å› æ­¤ï¼Œæ‚¨æ— éœ€æ‰§è¡Œäº‹ä»¶å†…çš„ä»»ä½•å…¶ä»–æ“ä½œï¼Œå¦‚æ‰‹åŠ¿æˆ–æœ€ç»ˆçš„ up æ“ä½œäº‹ä»¶ã€‚\n\n#### äº‹ä»¶å¤„ç†ç¨‹åº\n\nç›´æ¥å¼•ç”¨å®˜æ–¹æ–‡æ¡£æè¿°ï¼š\n\n> å¦‚æœæ‚¨ä» View æ„å»ºè‡ªå®šä¹‰ç»„ä»¶ï¼Œåˆ™å¯å®šä¹‰å‡ ç§å›è°ƒæ–¹æ³•ï¼Œç”¨ä½œé»˜è®¤äº‹ä»¶å¤„ç†ç¨‹åºã€‚åœ¨æœ‰å…³[è‡ªå®šä¹‰ View ç»„ä»¶](https://developer.android.google.cn/guide/topics/ui/custom-components)çš„æ–‡æ¡£ä¸­ï¼Œæ‚¨å°†äº†è§£ä¸€äº›ç”¨äºäº‹ä»¶å¤„ç†çš„å¸¸è§å›è°ƒï¼ŒåŒ…æ‹¬ï¼š\n>\n> - `onKeyDown(int, KeyEvent)`ï¼šåœ¨å‘ç”Ÿæ–°çš„æŒ‰é”®äº‹ä»¶æ—¶è°ƒç”¨ã€‚\n> - `onKeyUp(int, KeyEvent)`ï¼šåœ¨å‘ç”Ÿ key up äº‹ä»¶æ—¶è°ƒç”¨ã€‚\n> - `onTrackballEvent(MotionEvent)`ï¼šåœ¨å‘ç”Ÿè½¨è¿¹çƒåŠ¨ä½œäº‹ä»¶æ—¶è°ƒç”¨ã€‚\n> - `onTouchEvent(MotionEvent)`ï¼šåœ¨å‘ç”Ÿè§¦å±åŠ¨ä½œäº‹ä»¶æ—¶è°ƒç”¨ã€‚\n> - `onFocusChanged(boolean, int, Rect)`ï¼šåœ¨ View å¯¹è±¡è·å¾—æˆ–å¤±å»ç„¦ç‚¹æ—¶è°ƒç”¨ã€‚\n>\n> è¿˜æœ‰ä¸€äº›å…¶ä»–æ–¹æ³•å€¼å¾—æ‚¨æ³¨æ„ï¼Œå°½ç®¡å®ƒä»¬å¹¶é View ç±»çš„ä¸€éƒ¨åˆ†ï¼Œä½†å¯èƒ½ä¼šç›´æ¥å½±å“æ‰€èƒ½é‡‡å–çš„äº‹ä»¶å¤„ç†æ–¹å¼ã€‚å› æ­¤ï¼Œåœ¨ç®¡ç†å¸ƒå±€å†…æ›´å¤æ‚çš„äº‹ä»¶æ—¶ï¼Œä¸å¦¨è€ƒè™‘ä½¿ç”¨ä»¥ä¸‹å…¶ä»–æ–¹æ³•ï¼š\n>\n> - `Activity.dispatchTouchEvent(MotionEvent)`ï¼šæ­¤æ–¹æ³•å…è®¸ `Activity` åœ¨æ‰€æœ‰è§¦æ‘¸äº‹ä»¶åˆ†æ´¾ç»™çª—å£ä¹‹å‰æˆªè·å®ƒä»¬ã€‚\n> - `ViewGroup.onInterceptTouchEvent(MotionEvent)`ï¼šæ­¤æ–¹æ³•å…è®¸ `ViewGroup` ç›‘è§†åˆ†æ´¾ç»™å­çº§ View çš„äº‹ä»¶ã€‚\n> - `ViewParent.requestDisallowInterceptTouchEvent(boolean)`ï¼šå¯¹çˆ¶çº§ View è°ƒç”¨æ­¤æ–¹æ³•ï¼Œå¯æŒ‡ç¤ºä¸åº”ä½¿ç”¨ `onInterceptTouchEvent(MotionEvent)` æˆªè·è§¦æ‘¸äº‹ä»¶ã€‚\n\nè¿™é‡Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨ `onTouchEvent(MotionEvent)` å³åœ¨å‘ç”Ÿè§¦å±åŠ¨ä½œäº‹ä»¶æ—¶è°ƒç”¨çš„å›è°ƒæ–¹æ³•ï¼›\n\n### è§¦æ‘¸æ‰‹åŠ¿\n\næ‰‹åŠ¿å¯ä»¥è®©ç”¨æˆ·é€šè¿‡è§¦æ‘¸æ¥ä¸å±å¹•å…ƒç´ è¿›è¡Œäº¤äº’ï¼›\n\n**ç”¨æˆ·äº¤æˆ·è§’åº¦çš„æ‰‹åŠ¿åˆ’åˆ†**ï¼š\n\n| æ‰‹åŠ¿ç±»å‹ | å…·ä½“æ‰‹åŠ¿-ä¸åŒç±»å‹ä¹‹é—´æœ‰é‡å¤ | è§£é‡Š                                                         |\n| -------- | --------------------------- | ------------------------------------------------------------ |\n| å¯¼èˆªæ‰‹åŠ¿ |                             | å®ç°å¯¼èˆªä½œç”¨                                                 |\n|          | ç‚¹å‡» - Tap                  | å¦‚ï¼šç‚¹å‡»æŒ‰é’®è·³è½¬åˆ°å¦å¤–ä¸€ä¸ªé¡µé¢                               |\n|          | æ»šåŠ¨å’Œæ‹–ç§» - Scroll&Pan     | å¦‚ï¼šæ»‘åŠ¨å›¾ç‰‡åˆ—è¡¨æˆ–æ‹–åŠ¨ä»¥æµè§ˆåœ°å›¾<br/><br/>Scroll - å¿«é€Ÿæ‹–åŠ¨å¹¶æŠ¬èµ·æ‰‹æŒ‡æ—¶å‘ç”Ÿçš„ä¸€ç§æ»šåŠ¨ <br/> Pan-æ‹–ç§»ï¼Œæ…¢é€Ÿç§»åŠ¨ |\n|          | æ‹–åŠ¨/æ‹–æ‹½ - Drag            | ç”¨æˆ·åœ¨è§¦æ‘¸å±ä¸Šæ‹–åŠ¨æ‰‹æŒ‡æ—¶å‘ç”Ÿçš„ä¸€ç§æ»šåŠ¨<br/>å¦‚ï¼šæŒ‰ä½åº•éƒ¨sheetå¹¶å‘å±å¹•é¡¶éƒ¨æ‹–åŠ¨ |\n|          | è½»æ‰« - Swipe                | å•ä¸ªæ‰‹æŒ‡è§¦æ‘¸å±å¹•å¹¶å¿«é€Ÿåœ°æœä»»æ„ä¸€ä¸ªæ–¹å‘æ»‘åŠ¨<br/>å¦‚ï¼šå·¦å³æ»‘åŠ¨ä»¥åœ¨ä¸åŒçš„Tabé¡µä¸­åˆ‡æ¢ |\n|          | æåˆ/ç¼©æ”¾ - Pinch           | åŒæŒ‡æˆ–å¤šæŒ‡æåˆ<br/>å¦‚ï¼šåœ¨ä¸€ä¸ªå›¾ç‰‡åˆ—è¡¨ä¸­ç¼©æ”¾ä¸€ä¸ªitemè¿›å…¥å¤§å›¾æŸ¥çœ‹ç•Œé¢ |\n| åŠ¨ä½œæ‰‹åŠ¿ |                             | æ‰§è¡ŒæŸç§åŠ¨ä½œ                                                 |\n|          | ç‚¹å‡» - Tap                  |                                                              |\n|          | é•¿æŒ‰ - Long press           | å¦‚ï¼šé•¿æŒ‰é€‰ä¸­                                                 |\n|          | è½»æ‰« - Swipe                | å¦‚ï¼šè½»æ‰«itemå±•ç°åˆ é™¤/æ”¶è—æŒ‰é’®                                |\n| å˜æ¢æ‰‹åŠ¿ |                             | ç”¨äºæ”¹å˜å…ƒç´ å¤§å°ï¼Œä½ç½®ï¼Œæ—‹è½¬è§’åº¦ï¼Œå®ç°å˜æ¢æ•ˆæœ               |\n|          | åŒå‡» - Double tap           | å¦‚ï¼šåŒå‡»ç¼©æ”¾å›¾ç‰‡                                             |\n|          | æåˆ/ç¼©æ”¾ - Pinch           | å¦‚ï¼šç¼©æ”¾æŸ¥çœ‹å›¾ç‰‡ç»†èŠ‚                                         |\n|          | ç»„åˆæ‰‹åŠ¿                    | å¦‚ï¼šåœ°å›¾ä¸­çš„æ”¾å¤§ç¼©å°&æ—‹è½¬                                    |\n|          | é€‰å–å¹¶æ‹–åŠ¨ - Pick up&Move   | é•¿æŒ‰é€‰æ‹©å…ƒç´  + æ‹–åŠ¨å…ƒç´                                       |\n\n>  [æ¥æº](https://material.io/design/interaction/gestures.html)åŠæ‰‹åŠ¿çš„åŠ¨ç”»æ•ˆæœå¯ä»¥çœ‹è¿™é‡Œï¼š [material.io](https://material.io/design/interaction/gestures.html#types-of-gestures)\n\n**Androidä¸­ç”¨äºæ£€æµ‹æˆ–å¤„ç†æ‰‹åŠ¿çš„ç±»/æ–¹æ³•ï¼š**\n\n* [GestureDetector](https://developer.android.google.cn/reference/android/view/GestureDetector)ï¼šæ”¯æŒæ£€æµ‹æŒ‰ä¸‹ã€æ»‘åŠ¨ã€é•¿æŒ‰ç­‰æ‰‹åŠ¿ï¼›äº‹ä»¶å›è°ƒæ–¹æ³•åŒ…æ‹¬ `onDown()`ã€`onLongPress()`ã€`onFling()`ã€[onScroll()](https://developer.android.google.cn/reference/android/view/GestureDetector.OnGestureListener#onScroll(android.view.MotionEvent, android.view.MotionEvent, float, float)) ç­‰ã€‚å¯ä»¥å°† `GestureDetector` ä¸ `onTouchEvent()` æ–¹æ³•ç»“åˆä½¿ç”¨ï¼›\n* [ScaleGestureDetector](https://developer.android.google.cn/reference/android/view/ScaleGestureDetector)ï¼šç”¨äºæ£€æµ‹ç¼©æ”¾æ‰‹åŠ¿ï¼›\n* [onTouchEvent()](https://developer.android.google.cn/reference/android/view/View#onTouchEvent(android.view.MotionEvent))ï¼š ç›´æ¥å¤„ç†onTouchEvent()æ–¹æ³•ï¼Œç„¶åè‡ªè¡Œæ ¹æ®äº‹ä»¶åºåˆ—æ¥åˆ¤æ–­æ‰‹åŠ¿ï¼›\n* [VelocityTracker](https://developer.android.google.cn/reference/android/view/VelocityTracker)ï¼šç”¨äºè·Ÿè¸ªè§¦æ‘¸äº‹ä»¶çš„é€Ÿåº¦ï¼Œå¦‚æ»‘åŠ¨äº‹ä»¶ä¸­ä¸€èˆ¬éœ€è¦ç»“åˆé€Ÿåº¦æ¥ä½¿ç”¨ï¼›\n* [Scroller](https://developer.android.google.cn/reference/android/widget/Scroller) & [OverScroller](https://developer.android.google.cn/reference/android/widget/OverScroller)ï¼š ç”¨äºæ”¶é›†è§¦æ‘¸äº‹ä»¶æ¥ç”Ÿæˆæ»šåŠ¨åŠ¨ç”»æ‰€éœ€çš„æ•°æ®ï¼ŒOverScrollerå¯ä»¥æŒ‡ç¤ºæ»‘åŠ¨åæ˜¯å¦åˆ°è¾¾äº†å†…å®¹è¾¹ç¼˜ï¼›\n\n>  **ä¸¤ç§ä¸åŒçš„æ»šåŠ¨: æ‹–åŠ¨å’Œæ»‘åŠ¨**\n>\n> - **æ‹–åŠ¨**æ˜¯æŒ‡ç”¨æˆ·åœ¨è§¦æ‘¸å±ä¸Šæ‹–åŠ¨æ‰‹æŒ‡æ—¶å‘ç”Ÿçš„ä¸€ç§æ»šåŠ¨ã€‚ç®€å•çš„æ‹–åŠ¨é€šå¸¸æ˜¯é€šè¿‡æ›¿æ¢ `GestureDetector.OnGestureListener` ä¸­çš„ `onScroll()` å®ç°çš„ã€‚æœ‰å…³æ‹–åŠ¨çš„è¯¦ç»†è®¨è®ºï¼Œå¯å‚é˜…[æ‹–åŠ¨å’Œç¼©æ”¾](https://developer.android.google.cn/training/gestures/scale)ã€‚\n> - **æ»‘åŠ¨**æ˜¯ç”¨æˆ·å¿«é€Ÿæ‹–åŠ¨å¹¶æŠ¬èµ·æ‰‹æŒ‡æ—¶å‘ç”Ÿçš„ä¸€ç§æ»šåŠ¨ã€‚åœ¨ç”¨æˆ·æŠ¬èµ·æ‰‹æŒ‡åï¼Œæ‚¨é€šå¸¸éœ€è¦ç»§ç»­æ»šåŠ¨ï¼ˆç§»åŠ¨è§†å£ï¼‰ï¼Œä½†è¦å‡é€Ÿï¼Œç›´åˆ°è§†å£åœæ­¢ç§»åŠ¨ä¸ºæ­¢ã€‚æ»‘åŠ¨å¯ä»¥é€šè¿‡æ›¿æ¢ `GestureDetector.OnGestureListener` ä¸­çš„ `onFling()` ä»¥åŠä½¿ç”¨æ»šåŠ¨æ¡å¯¹è±¡æ¥å®ç°ã€‚\n> - ç³»ç»Ÿä¼šåœ¨ç”¨æˆ·æ‹–åŠ¨æ‰‹æŒ‡ä»¥å¹³ç§»å†…å®¹æ—¶è°ƒç”¨ `onScroll()`ï¼Œç³»ç»Ÿä»…åœ¨æ‰‹æŒ‡è¿˜åœ¨å±å¹•ä¸Šæ—¶æ‰ä¼šè°ƒç”¨ `onScroll()`ï¼›å½“æ‰‹æŒ‡ä»å±å¹•ä¸ŠæŠ¬èµ·æ—¶ï¼Œæ‰‹åŠ¿ä¾¿ä¼šç»“æŸï¼Œæˆ–å¼€å§‹æ‰§è¡Œæ»‘åŠ¨æ‰‹åŠ¿ï¼ˆå¦‚æœæ‰‹æŒ‡åœ¨æŠ¬èµ·ä¹‹å‰æ­£åœ¨ä»¥ä¸€å®šçš„é€Ÿåº¦ç§»åŠ¨ï¼‰ã€‚\n\n\n\næ¥ä¸‹æ¥æˆ‘ä»¬è¯¦ç»†äº†è§£è§¦æ‘¸æ‰‹åŠ¿ä¸­å„ä¸ªitemçš„ç”¨æ³•ï¼›\n\n\n\n## è§¦æ‘¸äº‹ä»¶ç±»é€ä¸ªäº†è§£\n\næˆ‘ä»¬å…ˆå¯¹æ¶‰åŠçš„å…ƒç´ ç±»è¿›è¡Œå•ç‹¬å­¦ä¹ ï¼Œç”±äºæ™®é€šçš„äº‹ä»¶ç›‘å¬å™¨æ¯”è¾ƒç®€å•ï¼Œæ‰€ä»¥ä¸»è¦å…³æ³¨è§¦æ‘¸æ‰‹åŠ¿éƒ¨åˆ†ï¼Œè¿™å—å…ˆä»GestureDetectorå¼€å§‹ï¼›\n\n### GestureDetector è¯¦è§£\n\nèƒ½å¤Ÿè¯†åˆ«çš„æ‰‹åŠ¿ï¼Œæ˜¯ `GestureDetector.OnGestureListener`åŠ ï¼Œ`GestureDetector.SimpleOnGestureListener` ,å…¶ä¸­ åŒ…æ‹¬å¦‚ä¸‹å‡ ç§ï¼š\n\n| å›è°ƒæ–¹æ³•                                                    | å¯¹åº”äº‹ä»¶è§¦å‘æ—¶æœºåŠè¯´æ˜                       |\n| ----------------------------------------------------------- | -------------------------------------------- |\n| `onDown(downEvent):Boolean`                                 | ç‚¹æŒ‰æŒ‰ä¸‹æ‰‹æŒ‡æ—¶ eventä¸ºdownäº‹ä»¶æ—¶è§¦å‘.        |\n| `onFling(downEvent,upEvent,velocityX,velocityY):Boolean`    | æ»‘åŠ¨(æŠ•æ·)äº‹ä»¶å‘ç”Ÿæ—¶è§¦å‘                     |\n| `onLongPress(downEvent)`                                    | å‘ç”Ÿé•¿æŒ‰äº‹ä»¶æ—¶è§¦å‘                           |\n| `onScroll(downEvent,moveEvent,distanceX,distanceY):Boolean` | æ‹–åŠ¨äº‹ä»¶å‘ç”Ÿæ—¶                               |\n| `onShowPress(downEvent)`                                    | æŒ‰åœ¨å±å¹•ä¸Šä½†æ˜¯æ²¡æœ‰ç§»åŠ¨æˆ–æŠ¬èµ·æ‰‹æŒ‡             |\n| `onSingleTapUp(upEvent):Boolean`                            | ç‚¹æŒ‰æŠ¬èµ·æ‰‹æŒ‡æ—¶è§¦å‘                           |\n| `GestureDetector.SimpleOnGestureListener`                   |                                              |\n| `onContextClick(event)`                                     | ä¸Šä¸‹æ–‡èœå•ç‚¹å‡»äº‹ä»¶å‘ç”Ÿæ—¶                     |\n| `onDoubleTap(event)`                                        | åŒå‡»äº‹ä»¶                                     |\n| `onDoubleTapEvent(event)`                                   | åŒå‡»äº‹ä»¶è¿‡ç¨‹ä¸­çš„äº‹ä»¶ï¼ŒåŒ…æ‹¬downï¼Œmoveï¼Œupäº‹ä»¶ |\n| `onSingleTapConfirmed(event)`                               | å•æ¬¡ç‚¹å‡»å‘ç”Ÿæ—¶                               |\n\n#### **é—®é¢˜ï¼š**\n\nä»¥ä¸‹é€šè¿‡**é˜…è¯»APIæ–‡æ¡£å¹¶ç¼–å†™ç®€å•çš„ç¤ºä¾‹ä»£ç **ï¼Œé€šè¿‡**æ“ä½œè§¦å‘å¯¹åº”çš„æ‰‹åŠ¿æ¥è§‚å¯Ÿ**ä»¥ç¡®å®šä»¥ä¸‹é—®é¢˜çš„ç­”æ¡ˆã€‚\n\n1. GestureDetector å„ä¸ªäº‹ä»¶å‘ç”Ÿçš„å…³ç³»ï¼Œæœ‰æ— äº¤å‰ï¼Ÿ\n   * æŒ‰ä¸‹-é‡Šæ”¾å¯èƒ½çš„äº‹ä»¶åºåˆ—ï¼š\n     * onDown - onSingleTapUpï¼š æŒ‰ä¸‹ï¼Œè¿…é€ŸæŠ¬èµ·ï¼ˆå¹²å‡€åˆ©è½çš„ï¼‰\n     * onDown - onShowPress - onSingleTapUpï¼šæŒ‰ä¸‹ï¼Œç¼“æ…¢æŠ¬èµ·\n     * onDown - onShowPress - onLongPressï¼šæŒ‰ä¸‹ï¼Œç¨æœ‰å»¶è¿Ÿçš„æŠ¬èµ·\n   * onScrollè§¦å‘çš„å¯èƒ½äº‹ä»¶åºåˆ—ï¼š\n     * longPress è¢«è§¦å‘ä¹‹åï¼Œæ— æ³•å†è§¦å‘onScroll\n     * onDown - onScroll\n     * onDown - onShowPress - onScroll\n   * onFlingçš„è§¦å‘åºåˆ—\n     * è§¦å‘onScroll - å¤šä¸ª onScroll - onFling\n2. GestureDetector.SimpleOnGestureDetector\n   * å•æ¬¡ç‚¹å‡»äº‹ä»¶åºåˆ—ï¼š\n     * onDown - onSingleTapUp - onSingleTapConfirmed\n     * onDown - onShowPress - onSingleTapUp - onSingleTapConfirmed ï¼ˆæŒ‰ä¸‹åç¨æœ‰åœé¡¿ï¼‰\n   * åŒå‡»å¯èƒ½çš„äº‹ä»¶åºåˆ—ï¼š\n     * onDown - onShowPress - onSingleTapUp - onDoubleTap_down - onDoubleTapEvent_down - **onDown** - onShowPress - onDoubleTapEvent_up\n3. æ»‘åŠ¨onFlingå’Œæ‹–åŠ¨onScrollçš„åŒºåˆ«æ—¶æœºï¼Ÿ\n   * onScrollä¸€å®šå…ˆå‘ç”Ÿï¼Œå¦‚æœæŠ¬èµ·æ—¶æœ‰ä¸€å®šé€Ÿåº¦ï¼Œå°±ä¼šè§¦å‘onFling\n4. `onSingleTapUp(upEvent)` åŠ `onSingleTapConfirmed(event)`çš„åŒºåˆ«ï¼Ÿ\n   - onSingleTapConfirmed åªä¼šåœ¨ç¡®è®¤å½“å‰tapä¹‹åä¸ä¼šæœ‰å¦å¤–ä¸€æ¬¡tapæ„æˆdouble-tapæ‰‹åŠ¿çš„æƒ…å†µä¸‹æ‰ä¼šè¢«è§¦å‘ï¼Œä¹Ÿå°±æ˜¯è¯´onSingleTapUpå®é™…ä¸Šæœ‰å¯èƒ½æ—¶doubleTapçš„ä¸€æ¬¡äº‹ä»¶ï¼Œå¦‚æœç¡®å®šåªèƒ½åˆæ˜ç¡®çš„å•æ¬¡ç‚¹å‡»äº‹ä»¶è§¦å‘ï¼Œå°±éœ€è¦åŒºåˆ†\n5. onDoubleTab å’Œ onDoubleTapEvent ä¹‹å‰çš„åŒºåˆ«ï¼Ÿ\n   - onDoubleTab åªåŒ…å«downäº‹ä»¶ï¼Œè€ŒonDoubleTapEventåˆ™è¿˜åŒ…å«å…¶ä»–äº‹ä»¶ï¼ˆmoveï¼Œupï¼‰\n\n\n\n\n\n\n\n\n\n#### Scroller è¯¦è§£\n\nscroller æœ¬èº«å¹¶ä¸ä¸Viewå…³è”ï¼Œä»…ç”¨äºåšè¾…åŠ©çš„åŠ¨ç”»è®¡ç®—ï¼Œä½¿ç”¨èµ·æ¥æœ‰ä»¥ä¸‹æ­¥éª¤ï¼š\n\n1. åˆå§‹åŒ–\n2. é€šè¿‡`startScroll`æˆ–`fling`æ–¹æ³•è®¾å®šè®¡ç®—æ¨¡å‹åŠè®¡ç®—æ‰€éœ€è¦çš„å‚æ•°\n3. å®šæœŸè°ƒç”¨ `computeScrollOffset` è¿›è¡Œè¿ç®—ï¼Œç„¶åå–å‡ºè¿ç®—åçš„å€¼\n4. ä½¿ç”¨è¿ç®—åçš„å€¼åŠ¨æ€çš„æ”¹å˜Viewçš„å±æ€§å®ç°æ»šåŠ¨æ•ˆæœ\n\n##### è®¡ç®—æ¨¡å‹ï¼š\n\n| æ¨¡å‹/æ–¹æ³•       | å‚æ•°      | å«ä¹‰                                                         |\n| --------------- | --------- | ------------------------------------------------------------ |\n| **startScroll** | startX    | èµ·å§‹æ°´å¹³æ»šåŠ¨åç§»é‡ï¼ˆä»¥åƒç´ ä¸ºå•ä½ï¼‰ï¼Œæ­£æ•°ä¼šå°†å†…å®¹å‘å·¦æ»šåŠ¨ã€‚   |\n|                 | startY    | å¼€å§‹çš„å‚ç›´æ»šåŠ¨åç§»é‡ï¼ˆä»¥åƒç´ ä¸ºå•ä½ï¼‰ã€‚ æ­£æ•°å°†ä½¿å†…å®¹å‘ä¸Šæ»šåŠ¨ã€‚ |\n|                 | dx        | æ»‘åŠ¨çš„æ°´å¹³è·ç¦»ã€‚ æ­£æ•°ä¼šå°†å†…å®¹å‘å·¦æ»šåŠ¨ã€‚                      |\n|                 | dy        | å‚ç›´æ»‘åŠ¨è·ç¦»ã€‚ æ­£æ•°å°†ä½¿å†…å®¹å‘ä¸Šæ»šåŠ¨ã€‚                        |\n|                 | duration  | æ»šåŠ¨æŒç»­æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰                                 |\n| **fling**       | startX    | æ»šåŠ¨çš„èµ·ç‚¹ï¼ˆXï¼‰                                              |\n|                 | startY    | æ»šåŠ¨çš„èµ·ç‚¹ï¼ˆYï¼‰                                              |\n|                 | velocityX | æ»šåŠ¨çš„åˆå§‹é€Ÿåº¦ï¼ˆXæ–¹å‘ï¼‰ï¼Œä»¥åƒç´ /ç§’ä¸ºå•ä½ã€‚                   |\n|                 | velocityY | æ»šåŠ¨çš„åˆå§‹é€Ÿåº¦ï¼ˆYæ–¹å‘ï¼‰ï¼Œä»¥åƒç´ /ç§’ä¸ºå•ä½ã€‚                   |\n|                 | minX      | æœ€å°Xå€¼ã€‚ æ»šåŠ¨æ¡å°†ä¸ä¼šæ»šåŠ¨åˆ°è¯¥ç‚¹ã€‚                           |\n|                 | maxX      | æœ€å¤§Xå€¼ã€‚ æ»šåŠ¨æ¡å°†ä¸ä¼šæ»šåŠ¨åˆ°è¯¥ç‚¹ã€‚                           |\n|                 | minY      | æœ€å°Yå€¼ã€‚ æ»šåŠ¨æ¡å°†ä¸ä¼šæ»šåŠ¨åˆ°è¯¥ç‚¹ã€‚                           |\n|                 | maxY      | æœ€å¤§Yå€¼ã€‚ æ»šåŠ¨æ¡å°†ä¸ä¼šæ»šåŠ¨åˆ°è¯¥ç‚¹ã€‚                           |\n\n##### è®¡ç®—ç»“æœå€¼\n\n| æ–¹æ³•/å€¼  | è¯´æ˜                            |\n| -------- | ------------------------------- |\n| getCurrX | æ–°çš„Xåç§»é‡æ˜¯è·åŸç‚¹çš„ç»å¯¹è·ç¦»ã€‚ |\n| getCurrY | æ–°çš„Yåç§»é‡æ˜¯è·åŸç‚¹çš„ç»å¯¹è·ç¦»ã€‚ |\n|          |                                 |\n\n### `ScaleGestureDetector` è¯¦è§£\n\nä½¿ç”¨æä¾›çš„ MotionEvent äº‹ä»¶åºåˆ—æ¥æ£€æµ‹ç¼©æ”¾æ‰‹åŠ¿ï¼Œå½“æ£€æµ‹åˆ°å¯¹åº”çš„ç¼©æ”¾äº‹ä»¶æ—¶ï¼Œä¼šé€šè¿‡ OnScaleGestureListener æ¥é€šçŸ¥ç”¨æˆ·ï¼›\n\nä½¿ç”¨æµç¨‹ï¼š\n\n* ä¸º View åˆ›å»º ScaleGestureDetector å®ä¾‹ï¼›\n* åœ¨ View.onTouchEvent(MotionEvent) æ–¹æ³•ä¸­è°ƒç”¨ ScaleGestureDetector å®ä¾‹çš„ onTouchEvent æ–¹æ³•ï¼›\n\n#### åŸºæœ¬ç”¨æ³•\n\n* ##### **æ„é€ å‡½æ•°**\n\n| ä»“åº“                 | å«ä¹‰/ä½œç”¨                      |\n| -------------------- | ------------------------------ |\n| context              | ä¸Šä¸‹æ–‡                         |\n| ScaleGestureListener | ç¼©æ”¾ç›‘å¬                       |\n| Handlerï¼ˆå¯é€‰ï¼‰      | ç”¨äºè¿è¡Œå»¶è¿Ÿä¾¦å¬äº‹ä»¶çš„å¤„ç†ç¨‹åº |\n\n* ##### **æ–¹æ³•åŠå±æ€§** \n\n| å±æ€§/æ–¹æ³•             | å«ä¹‰è¯´æ˜                                                     | å¤‡æ³¨                                            |\n| --------------------- | ------------------------------------------------------------ | ----------------------------------------------- |\n| getCurrent**Span**    | ä¸¤ä¸ªæ‰‹æŒ‡ä¹‹é—´çš„é€šè¿‡æ‰‹åŠ¿ç„¦ç‚¹çš„å¹³å‡è·ç¦»                         | ï¼ˆä½•ä¸ºå¹³å‡è·ç¦»ï¼Ÿï¼‰                              |\n| getCurrent**Span**X   | å½¢æˆæ‰‹åŠ¿çš„è¿‡ç¨‹ä¸­ä¸¤ä¸ªæ‰‹æŒ‡ä¹‹é—´é€šè¿‡æ‰‹åŠ¿ç„¦ç‚¹çš„Xæ–¹å‘çš„å¹³å‡è·ç¦»    | ä¸¤ä¸ªæ‰‹æŒ‡çš„æ»‘åŠ¨Xè·ç¦»ç›¸åŠ å–å¹³å‡                   |\n| getCurrent**Span**Y   | å½¢æˆæ‰‹åŠ¿çš„è¿‡ç¨‹ä¸­ä¸¤ä¸ªæ‰‹æŒ‡ä¹‹é—´é€šè¿‡æ‰‹åŠ¿ç„¦ç‚¹çš„Yæ–¹å‘çš„å¹³å‡è·ç¦»    | ä¸¤ä¸ªæ‰‹æŒ‡çš„æ»‘åŠ¨Yè·ç¦»ç›¸åŠ å–å¹³å‡                   |\n| getEventTime          | è¿”å›æ­£åœ¨å¤„ç†çš„å½“å‰äº‹ä»¶çš„äº‹ä»¶æ—¶é—´                             |                                                 |\n| get**Focus**X         | å½“å‰æ‰‹åŠ¿ç„¦ç‚¹ï¼ˆgesture's focal pointï¼‰çš„Xåæ ‡                 | æ‰‹åŠ¿ç„¦ç‚¹=ä¸¤ä¸ªæ‰‹åŠ¿ç‚¹çš„ä¸­ç‚¹ï¼›åŒå‡»è§¦å‘æ—¶åˆ™æ˜¯è§¦æ‘¸ç‚¹ |\n| get**Focus**Y         | å½“å‰æ‰‹åŠ¿ç„¦ç‚¹ï¼ˆgesture's focal pointï¼‰çš„Yåæ ‡                 | ä¸¤ä¸ªæ‰‹åŠ¿ç‚¹çš„ä¸­ç‚¹                                |\n| getPrevious**Span**   | ä¹‹å‰çš„ ä¸¤ä¸ªæ‰‹æŒ‡ä¹‹é—´çš„é€šè¿‡**æ‰‹åŠ¿ç„¦ç‚¹**çš„å¹³å‡è·ç¦»              | ä¸Šæ¬¡å›è°ƒï¼ˆscaleBegin/scaleï¼‰çš„spanå‚æ•°          |\n| getPrevious**Span**X  | ä¹‹å‰çš„ å½¢æˆæ‰‹åŠ¿çš„è¿‡ç¨‹ä¸­ä¸¤ä¸ªæ‰‹æŒ‡ä¹‹é—´é€šè¿‡æ‰‹åŠ¿ç„¦ç‚¹çš„Xæ–¹å‘çš„å¹³å‡è·ç¦» |                                                 |\n| getPrevious**Span**Y  | ä¹‹å‰çš„ å½¢æˆæ‰‹åŠ¿çš„è¿‡ç¨‹ä¸­ä¸¤ä¸ªæ‰‹æŒ‡ä¹‹é—´é€šè¿‡æ‰‹åŠ¿ç„¦ç‚¹çš„Yæ–¹å‘çš„å¹³å‡è·ç¦» |                                                 |\n| getScaleFactor        | ä»ä¹‹å‰çš„ç¼©æ”¾äº‹ä»¶åˆ°å½“å‰ç¼©æ”¾äº‹ä»¶çš„ ç¼©æ”¾æ¯”ä¾‹                    | ä¸¤æ¬¡å›è°ƒä¹‹é—´çš„ç¼©æ”¾æ¯”ä¾‹                          |\n| getTimeDelta          | ä¸Šä¸€ä¸ªè¢«æ¥å—çš„ç¼©æ”¾äº‹ä»¶åˆ°å½“å‰ç¼©æ”¾äº‹ä»¶ä¹‹å‰çš„æ—¶é—´å·®             | ä¸¤æ¬¡å›è°ƒä¹‹é—´çš„                                  |\n| isInProgress          | ç¼©æ”¾æ‰‹åŠ¿æ˜¯å¦æ­£åœ¨è¿›è¡Œä¸­                                       | ScaleBegin ä¸­ä¸ºfalseï¼Œå¦å¤–ä¸¤ä¸ªä¸ºtrue            |\n| isQuickScaleEnabled   | æ˜¯å¦å¯ç”¨äº†å¿«é€Ÿç¼©æ”¾-ç”¨æˆ·é€šè¿‡åŒå‡»+ä¸€ä¸ªSwipeæ“ä½œæ¥è§¦å‘ç¼©æ”¾      |                                                 |\n| isStylusScaleEnabled  | è¿”å›ç”¨æˆ·ä½¿ç”¨è§¦ç¬”å¹¶æŒ‰ä¸‹æŒ‰é’®çš„è§¦ç¬”ç¼©æ”¾æ‰‹åŠ¿æ˜¯å¦åº”è¯¥æ‰§è¡Œç¼©æ”¾ã€‚   |                                                 |\n| setQuickScaleEnabled  | å½“ç”¨æˆ·æ‰§è¡ŒåŒå‡»+SwipeåŠ¨ä½œæ—¶æ˜¯å¦è§¦å‘ç¼©æ”¾ç›‘å¬                   |                                                 |\n| setStylusScaleEnabled | å½“ç”¨æˆ·æ‰§è¡Œè§¦ç¬”ç¼©æ”¾åŠ¨ä½œæ—¶æ˜¯å¦è§¦å‘ç¼©æ”¾ç›‘å¬                     |                                                 |\n| onTouchEvent          | æ¥å—MotionEventså¹¶åœ¨é€‚å½“çš„æ—¶æœºåˆ†å‘äº‹ä»¶åˆ° OnScaleGestureListener |                                                 |\n\n* **å¦‚ä½•ä½¿ç”¨ï¼Ÿ**\n\n  1. æ„é€ ä¾¦å¬å™¨å¯¹è±¡ï¼›\n  2. åœ¨ onTouchEvent å›è°ƒä¸­è°ƒç”¨ä¾¦å¬å™¨å¯¹è±¡çš„ onTouchEventæ–¹æ³•å¹¶ä¼ å…¥MotionEventï¼›\n\n  ```kotlin\n  var mScaleGestureDetector = ScaleGestureDetector(this,this)\n  \n  override fun onTouchEvent(event: MotionEvent?): Boolean {\n          return mScaleGestureDetector.onTouchEvent(event) || super.onTouchEvent(event)\n  }\n  ```\n\n#### æ·±å…¥æ¢ç©¶\n\n1. å¦‚ä½•è§¦å‘æ‰‹åŠ¿ï¼Ÿ\n   - ä¸¤ä¸ªæ‰‹æŒ‡å¼ å¼€é—­åˆå°±å¯ä»¥\n2. å¦‚ä½•æ¶ˆè´¹æ‰‹åŠ¿ï¼Ÿ\n3. å¦‚ä½•åˆ©ç”¨æ‰‹åŠ¿çš„å‚æ•°å®ç°ç¼©æ”¾çš„åŠ¨ç”»/åŠ¨ä½œï¼Ÿ\n\n##### å¦‚ä½•æ¶ˆè´¹æ‰‹åŠ¿ï¼Ÿ \n\n| **äº‹ä»¶ç±»å‹**     | **CurrentSpan** | **currentSpanX** | **currentSpanY** | **EventTime** | **FocusX** | **FocusY** | **Previouspan** | **PreviouspanX** | **PreviouspanY** | **ScaleFactor** | **TimeDelta** | **isInProgress** | **isQuickScaleEnabled** | **isStylusScaleEnabled** |\n| ---------------- | --------------- | ---------------- | ---------------- | ------------- | ---------- | ---------- | --------------- | ---------------- | ---------------- | --------------- | ------------- | ---------------- | ----------------------- | ------------------------ |\n| **onScaleBegin** | 448.18158       | 338.30157        | 293.9707         | 120680064     | 405.82724  | 765.9927   | 448.18158       | 338.30157        | 293.9707         | 1.0             | 0             | FALSE            | TRUE                    | TRUE                     |\n| **onScale**      | 448.18158       | 338.30157        | 293.9707         | 120680064     | 405.82724  | 765.9927   | 448.18158       | 338.30157        | 293.9707         | 1.0             | 0             | TRUE             | TRUE                    | true                     |\n| **onScale**      | 473.83823       | 355.72217        | 313.0246         | 120680081     | 408.95367  | 770.60486  | 448.18158       | 338.30157        | 293.9707         | 1.0572461       | 17            | TRUE             | TRUE                    | true                     |\n| **onScale**      | 492.1729        | 367.65485        | 327.20648        | 120680098     | 410.2758   | 772.77576  | 473.83823       | 355.72217        | 313.0246         | 1.038694        | 17            | TRUE             | TRUE                    | true                     |\n| **onScale**      | 509.8993        | 380.36285        | 339.59003        | 120680114     | 411.72714  | 775.3407   | 492.1729        | 367.65485        | 327.20648        | 1.0360166       | 16            | TRUE             | TRUE                    | true                     |\n| **onScale**      | 526.8072        | 391.90063        | 352.05072        | 120680131     | 413.6501   | 777.7251   | 509.8993        | 380.36285        | 339.59003        | 1.0331593       | 17            | TRUE             | TRUE                    | true                     |\n| **onScale**      | 541.9916        | 402.3568         | 363.13068        | 120680147     | 415.72614  | 780.33923  | 526.8072        | 391.90063        | 352.05072        | 1.0288234       | 16            | TRUE             | TRUE                    | true                     |\n| **onScale**      | 552.3365        | 408.6225         | 371.62244        | 120680164     | 418.1556   | 782.6556   | 541.9916        | 402.3568         | 363.13068        | 1.0190868       | 17            | TRUE             | TRUE                    | true                     |\n| **onScale**      | 560.9881        | 413.25342        | 379.38013        | 120680181     | 418.5      | 783.56335  | 552.3365        | 408.6225         | 371.62244        | 1.0156636       | 17            | TRUE             | TRUE                    | true                     |\n| **onScale**      | 567.2112        | 417.16174        | 384.32355        | 120680197     | 419.58087  | 785.08093  | 560.9881        | 413.25342        | 379.38013        | 1.011093        | 16            | TRUE             | TRUE                    | true                     |\n| **onScale**      | 575.6995        | 423.24652        | 390.24646        | 120680214     | 420.5411   | 786.0411   | 567.2112        | 417.16174        | 384.32355        | 1.014965        | 17            | TRUE             | TRUE                    | true                     |\n| **onScale**      | 584.7019        | 428.15033        | 398.2005         | 120680230     | 422.02505  | 788.0502   | 575.6995        | 423.24652        | 390.24646        | 1.0156373       | 16            | TRUE             | TRUE                    | true                     |\n| **onScale**      | 592.25555       | 432.04736        | 405.09473        | 120680247     | 423.02368  | 789.5237   | 584.7019        | 428.15033        | 398.2005         | 1.0129188       | 17            | TRUE             | TRUE                    | true                     |\n| **onScale**      | 601.86597       | 436.95844        | 413.89606        | 120680263     | 424.47922  | 791.9689   | 592.25555       | 432.04736        | 405.09473        | 1.0162268       | 16            | TRUE             | TRUE                    | true                     |\n| **onScale**      | 611.9895        | 442.71814        | 422.5302         | 120680280     | 425.453    | 793.453    | 601.86597       | 436.95844        | 413.89606        | 1.0168202       | 17            | TRUE             | TRUE                    | true                     |\n| **onScale**      | 621.78754       | 447.69666        | 431.49445        | 120680297     | 426.94946  | 794.94946  | 611.9895        | 442.71814        | 422.5302         | 1.0160102       | 17            | TRUE             | TRUE                    | true                     |\n| **onScale**      | 629.77124       | 451.88318        | 438.64954        | 120680313     | 427.9416   | 795.4416   | 621.78754       | 447.69666        | 431.49445        | 1.0128399       | 16            | TRUE             | TRUE                    | true                     |\n| **onScale**      | 636.78015       | 454.8739         | 445.6217         | 120680330     | 428.43695  | 795.93695  | 629.77124       | 451.88318        | 438.64954        | 1.0111293       | 17            | TRUE             | TRUE                    | true                     |\n| **onScaleEnd**   | 644.16754       | 458.65613        | 452.31226        | 120680346     | 428.5      | 795.5      | 636.78015       | 454.8739         | 445.6217         | 1.0             | 16            | TRUE             | TRUE                    | true                     |\n\nä»¥ä¸‹æ˜¯æµ‹è¯•è¿‡ç¨‹ä¸­çš„detectorçš„å±æ€§å˜åŒ–æ•°æ®ï¼Œå¯ä»¥å‘ç°å¦‚ä¸‹è§„å¾‹ï¼š\n\n1.  **onScaleBegin** æ—¶ inProgressä¸ºfalse\n\n2. currentSpan<sup>^2</sup> = currentSpanX<sup>^2</sup> * currentSpanY<sup>^2</sup> ï¼Œå³currentSpanä¸ºä¸¤ä¸ªæ‰‹æŒ‡æ€»å…±ç§»åŠ¨çš„è·ç¦»ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n* æ‰‹æŒ‡1ç§»åŠ¨çš„è½¨è¿¹ä¸ºè“è‰²çŸ©å½¢ä¸­çš„å¯¹è§’çº¿ï¼Œæ‰‹æŒ‡2ç§»åŠ¨çš„è½¨è¿¹ä¸ºçº¢è‰²çŸ©å½¢çš„å¯¹è§’çº¿\n\n<img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210224223801.png\" alt=\"image-20210224223801886\" style=\"zoom:50%;\" />\n\n* currentSpan å°±æ˜¯ä¸¤ä¸ªæ‰‹æŒ‡ç§»åŠ¨çš„å¯¹è§’çº¿ç›¸åŠ ï¼ŒcurrentSpanXå’ŒcurrentSpanYåˆ†åˆ«ä¸ºè“è‰²çŸ©å½¢å’Œçº¢è‰²çŸ©å½¢æŒ‰å¦‚ä¸‹æ–¹å¼æ‹¼æ¥æˆä¸€ä¸ªå¤§çš„çŸ©å½¢ä¹‹åçš„ä¸¤æ¡è¾¹ï¼›\n\n<img src=\"https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210224223831.png\" alt=\"image-20210224223831274\" style=\"zoom:50%;\" />\n\n3. æ¯æ¬¡äº‹ä»¶çš„previouSpançš„å€¼éƒ½ç­‰äºä¸Šæ¬¡äº‹ä»¶çš„currentSpançš„å€¼ï¼›\n4. FocusXå’ŒFocusYå³ä¸ºäº‹ä»¶å›è°ƒè§¦å‘æ—¶ä¸¤ä¸ªæ‰‹æŒ‡è¿çº¿çš„ä¸­ç‚¹åæ ‡ï¼Œéšç€æ‰‹æŒ‡çš„ä¸æ–­ç§»åŠ¨ï¼Œç„¦ç‚¹ä¹Ÿæ˜¯ä¸æ–­çš„å˜åŒ–çš„ï¼›\n5. å¤§éƒ¨åˆ†timeDeltaéƒ½åœ¨16-17mså·¦å³ï¼Œæ‰€ä»¥ä¸åº”åœ¨å›è°ƒæ–¹æ³•ä¸­æ‰§è¡Œè€—æ—¶äº‹ä»¶ï¼Œå¯¹åº”é€»è¾‘åº”æ”¾ç½®åˆ°Runnableä¸­å»æ‰§è¡Œï¼›\n6. scaleBeginå’Œç¬¬ä¸€æ¬¡onScaleå›è°ƒçš„å„é¡¹å€¼éƒ½ä¸€è‡´ï¼Œé™¤äº†scaleBeginçš„isInProgressä¸º`FALSE`ï¼›\n7. ç¼©æ”¾æ¯”ä¾‹ï¼ˆscaleFactorï¼‰ä¸º1.0æ—¶ï¼Œæ²¡æœ‰ç¼©æ”¾ï¼›\n\n##### å¦‚ä½•åˆ©ç”¨æ‰‹åŠ¿çš„å‚æ•°å®ç°ç¼©æ”¾çš„åŠ¨ç”»/åŠ¨ä½œï¼Ÿ\n\nå‡è®¾æˆ‘ç°åœ¨éœ€è¦åœ¨æ£€æµ‹åˆ°ç¼©æ”¾æ‰‹åŠ¿æ—¶åŒæ­¥çš„å¯¹ImageViewæ‰§è¡Œç¼©æ”¾åŠ¨ä½œï¼Œæ­¤æ—¶åº”è¯¥æ€ä¹ˆåšï¼Ÿ\n\n* å¦‚ä½•å¯¹ImageViewçš„å›¾ç‰‡è¿›è¡Œç¼©æ”¾ï¼Ÿ\n  * æ ¹æ®ç¼©æ”¾æ¯”ä¾‹ä¸æ–­çš„é‡æ–°è®¾ç½®Viewçš„scaleXåŠscaleYçš„å€¼ï¼›\n* æ¯æ¬¡äº‹ä»¶è§¦å‘éƒ½è¿›è¡Œç¼©æ”¾æ“ä½œï¼Ÿè¿˜æ˜¯ç§¯ç´¯ä¸€å®šç¨‹åº¦ä¹‹åè¿›è¡Œï¼Ÿ\n  * ç”±äºæ¯æ¬¡å˜åŒ–çš„æ—¶é—´éå¸¸çŸ­ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥åœ¨æ¯æ¬¡onScaleæ–¹æ³•è§¦å‘æ—¶æ‰§è¡Œå˜æ¢ï¼›\n\n## å¦‚ä½•è®©Viewæ ¹æ®æ‰‹åŠ¿æ•ˆæœè¿›è¡Œå˜æ¢ï¼Ÿ\n\né€šè¿‡ä¹‹å‰å¯¹æ‰‹åŠ¿ä¾¦å¬å™¨ï¼Œç¼©æ”¾æ‰‹åŠ¿ä¾¦å¬å™¨åŠæ»šåŠ¨æ¡ç±»çš„å­¦ä¹ åŠåˆ†æï¼Œæˆ‘ä»¬çŸ¥é“äº†å„ä¸ªç±»çš„åŸºæœ¬ç”¨é€”ï¼š\n\n* GeostureDetectorï¼š è¾…åŠ©ä¾¦å¬åˆ¤æ–­downï¼Œtagï¼Œdoubletapï¼Œscrollï¼Œflingç­‰æ‰‹åŠ¿å¹¶åœ¨æ£€æµ‹åˆ°æ‰‹åŠ¿åå›è°ƒå¯¹åº”çš„æ–¹æ³•ï¼Œç»™å‡ºäº‹ä»¶ç›¸å…³çš„å‚æ•°æ•°æ®ï¼›\n* ScaleGeostureDetectorï¼š è¾…åŠ©ä¾¦å¬åˆ¤æ–­ç¼©æ”¾æ‰‹åŠ¿ï¼Œå¹¶åœ¨ç¼©æ”¾æ‰‹åŠ¿å‘ç”Ÿæ—¶é€šè¿‡å›è°ƒå¯¹åº”æ–¹æ³•æ¥é€šçŸ¥æˆ‘ä»¬å¯¹åº”äº‹ä»¶çš„å‘ç”Ÿï¼Œå¹¶ç»™å‡ºäº‹ä»¶ç›¸å…³çš„å‚æ•°æ•°æ®ï¼›\n* Scrollerï¼š ç”¨äºè¾…åŠ©è®¡ç®—ç”Ÿæˆæ»šåŠ¨è¿‡ç¨‹ä¸­çš„ä¸€ç³»åˆ—å€¼çš„åºåˆ—ï¼›\n\nå¯ä»¥æ–¹å‘ï¼Œä¸Šè¿°ç±»åªæ˜¯å‘Šè¯‰ä½ äº‹ä»¶å‘ç”Ÿäº†ï¼Œè¿˜æœ‰å‘Šè¯‰ä½ äº‹ä»¶çš„ç›¸å…³å‚æ•°ï¼Œå¦‚æ»šåŠ¨äº‹ä»¶çš„æ»šåŠ¨è·ç¦»ï¼Œflingäº‹ä»¶çš„æ»‘åŠ¨é€Ÿåº¦ï¼Œç­‰ç­‰ï¼Œä½†æ˜¯éƒ½æ²¡æœ‰æ¶‰åŠåˆ°å¦‚ä½•å˜æ¢å°†è¿™äº›äº‹ä»¶åæ˜ åˆ°ç•Œé¢çš„å˜åŒ–ä¸Šï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•å°†ä¸Šè¿°çš„äº‹ä»¶å˜åŒ–åæ˜ åˆ°ç•Œé¢ä¸Šå‘¢ï¼Ÿ\n\n### ViewåŸºç¡€å±æ€§\n\néƒ¨åˆ†å˜åŒ–æ•ˆæœéƒ½æ˜¯é’ˆå¯¹View/ViewGroupæ¥è¯´çš„ï¼Œè¦æƒ³æ”¹å˜Viewï¼Œå°±å¾—æ”¹å˜å…¶å±æ€§ï¼Œå¦‚ï¼š\n\n* æ»‘åŠ¨æ—¶æ”¹å˜TransitionXï¼ŒTransitionY\n* ç¼©æ”¾æ—¶æ”¹å˜Viewçš„scaleX/scaleY\n\næˆ‘ä»¬éœ€è¦ç ”ç©¶Viewä¸­æœ‰å“ªäº›å±æ€§ï¼Œå±æ€§å¦‚ä½•å½±å“Viewçš„å±•ç¤ºæ•ˆæœï¼Œä»¥ä¸‹é€šè¿‡APIæ–‡æ¡£çš„setXXXå±æ€§åˆ—å‡ºViewçš„éƒ¨åˆ†å±æ€§ï¼š\n\n| å±æ€§                                                    | è¯´æ˜                                                         |\n| ------------------------------------------------------- | ------------------------------------------------------------ |\n| **alpha**                                               | é€æ˜åº¦                                                       |\n| background/backgroundColor                              | èƒŒæ™¯                                                         |\n| **bottom<br/>left<br/>right<br/>top**<br/>**elevation** | è§†å›¾ç›¸å¯¹äºparentçš„ä½ç½®<br/>elevationä¸ºviewçš„æ·±åº¦             |\n| clipBounds                                              | çŸ©å½¢è£å‰ªåŒºåŸŸï¼Œviewçš„å†…å®¹ä¼šåœ¨è¯¥åŒºåŸŸç»˜åˆ¶                       |\n| clipToOutline:Boolean                                   |                                                              |\n| fadingEdgeLength                                        | ç”¨äºæŒ‡ç¤ºæ­¤è§†å›¾ä¸­æ›´å¤šå†…å®¹å¯ç”¨çš„è¤ªè‰²è¾¹ç¼˜çš„å¤§å°                 |\n| foreground                                              | å‰æ™¯drawable                                                 |\n| layoutParams                                            | å¸ƒå±€å‚æ•°                                                     |\n| minHeight<br/>minWidth                                  | æœ€å°å®½é«˜                                                     |\n| padding                                                 | å†…è¾¹è·                                                       |\n| relativePadding                                         | å‡å»å¯èƒ½çš„æ»šåŠ¨æ¡å°ºå¯¸                                         |\n| **pivotX<br/>pivotY**                                   | view æ—‹è½¬ç¼©æ”¾æ‰€å›´ç»•çš„ç‚¹ã€‚é»˜è®¤ä¸ºviewä¸­ç‚¹åæ ‡                  |\n| **rotation**                                            | ç»•pivotç‚¹çš„æ—‹è½¬è§’åº¦                                          |\n| **rotationX<br/>rotationY**                             | ç»•é€šè¿‡pivotç‚¹çš„æ°´å¹³çº¿/å‚ç›´çº¿çš„æ—‹è½¬è§’åº¦                       |\n| **scaleX<br/>scaleY**                                   | X/Yæ–¹å‘ä¸Šç»•pivotç‚¹çš„ç¼©æ”¾æ¯”ä¾‹ï¼Œ1.0è¡¨ç¤ºæ— ç¼©æ”¾                  |\n| **scrollX<br/>scrollY**                                 | æ°´å¹³/å‚ç›´æ»šåŠ¨ä½ç½®çš„position                                  |\n| **translationX<br/>translationY<br/>translationZ**      | ç›¸å¯¹äºè§†å›¾å·¦è¾¹ä½ç½®çš„æ°´å¹³/å‚ç›´/æ·±åº¦ä½ç½®ï¼Œå¯ä»¥æ”¹å˜å¸ƒå±€         |\n| **x/y/z**                                               | x: xä½ç½®ï¼› ç­‰æ•ˆtranslationX=x-left<br/>y: yä½ç½®ï¼› ç­‰æ•ˆtranslationY=y-top<br/>z: zä½ç½®ï¼› ç­‰æ•ˆtranslationZ=z-elevation |\n\nä¸è§†å›¾å˜åŒ–ç›¸å…³çš„æœ€åŸºæœ¬çš„å°±æ˜¯åŠ ç²—éƒ¨åˆ†çš„å±æ€§ï¼Œæ€»ç»“èµ·æ¥å°±æ˜¯ä½ç½®ï¼Œå¤§å°ï¼Œé€æ˜åº¦ï¼Œæ—‹è½¬ï¼Œç¼©æ”¾ï¼Œå¹³ç§»ã€‚å…¶ä»–å…·ä½“çš„å­Viewåˆ™å¯èƒ½å¼•å…¥è‡ªå·±çš„å±æ€§ï¼›\n\n### é‚£ä¹ˆæ—‹è½¬/å¹³ç§»/ç¼©æ”¾ç©¶ç«Ÿæ”¹å˜çš„æ˜¯å•¥ï¼Ÿ\n\n* æ»šåŠ¨åŠå¹³ç§»ï¼ˆscroll/flingï¼‰ï¼šæ”¹å˜xå’Œyï¼ˆäº¦å¯ä»¥é€šè¿‡translationX/Yï¼Œæœ€ç»ˆéƒ½æ˜¯æ”¹å˜äº†xå’Œyï¼‰\n* ç¼©æ”¾ï¼š æ”¹å˜scaleX/scaleY/pivotX/pivotY\n\n\n\n### Matrixè§£æ\n\nç”¨é€”ï¼š matrixå­˜å‚¨ä¸€ä¸ª3x3çš„çŸ©é˜µï¼Œç”¨äºå¯¹åæ ‡è¿›è¡Œå˜æ¢ï¼›\n$$\n\\begin{bmatrix}\n  MSCALE\\_X & MSKEW\\_X & MTRANS\\_X \\\\\n  MSKEW\\_Y & MSCALE\\_Y & MTRANS\\_Y \\\\\n  MPERSP\\_0 & MPERSP\\_1 & MPERSP\\_2 \\\\\n\\end{bmatrix}\n$$\nçŸ©é˜µå„ä¸ªå…ƒç´ çš„ç”¨é€”ï¼š\n\n| å­—æ®µ                                 | ç”¨é€”                                         |\n| ------------------------------------ | -------------------------------------------- |\n| `MSCALE_X`ï¼Œ`MSCALE_Y`               | æ§åˆ¶Xè½´å’ŒYè½´æ–¹å‘çš„ç¼©æ”¾                       |\n| `MSKEW_X`ï¼Œ`MSKEW_Y`                 | æ§åˆ¶Xåæ ‡å’ŒYåæ ‡çš„æ‰­æ›²ç³»æ•°(æ—‹è½¬)             |\n| `MTRANS_X`ï¼Œ`MTRANS_Y`               | æ§åˆ¶Xæ–¹å‘å’ŒYæ–¹å‘çš„çº¿æ€§å¹³ç§»                   |\n| `MPERSP_0` , `MPERSP_1` , `MPERSP_2` | MPERSP_0ã€MPERSP_1å’ŒMPERSP_2æ˜¯å…³äºé€è§†çš„æ§åˆ¶ |\n\nMatrixæä¾›ä¸€ç³»åˆ—çš„è¾…åŠ©å˜æ¢å‡½æ•°ï¼Œæ¯ç§ç±»å‹æœ‰ `pre`,`post`,`set`ä¸‰ç§æ“ä½œæ–¹å¼ï¼ŒçŸ©é˜µçš„ä¹˜æ³•è¿ç®—é¡ºåºä¸ä¸€è‡´ç»“æœä¸åŒï¼Œpreè¡¨ç¤ºå‰ï¼ˆpreconcatsï¼‰ï¼Œpostè¡¨ç¤ºåï¼ˆpostconcatsï¼‰ï¼Œsetä¸ºç›´æ¥è®¾ç½®ï¼›\n\n`postScale`æ–¹æ³•æ¥å¯¹åæ ‡åæ¥è§¦ç¼©æ”¾å˜æ¢ï¼Œæœ‰ä¸¤ç§å˜ä½“ï¼š\n\n| æ–¹æ³•                                                 | è¯´æ˜                                                         |\n| ---------------------------------------------------- | ------------------------------------------------------------ |\n| `postScale (float sx, float sy, float px, float py)` | ä½¿ç”¨æŒ‡å®šçš„scaleæ‰§è¡ŒçŸ©é˜µpostconcatsï¼š`M' = S(sx, sy, px, py) * M` <br/>å…¶ä¸­sxï¼Œsyåˆ†åˆ«ä¸ºxè½´å’Œyè½´çš„ç¼©æ”¾å¤§å°ï¼Œpxï¼Œpyä¸ºç¼©æ”¾ä¸­å¿ƒç‚¹çš„åæ ‡ |\n| `boolean postScale (float sx, float sy)`             | ä½¿ç”¨æŒ‡å®šçš„scaleæ‰§è¡ŒçŸ©é˜µpostconcatsï¼š `M' = S(sx, sy) * M`    |\n\n#### postå’ŒsetåŠpreçš„åŒºåˆ«\n\n##### scale\n\n|           | currentScale                                                 |\n| --------- | ------------------------------------------------------------ |\n| preScale  | å’ŒpostScaleå¯¹å€¼äº§ç”Ÿä¸€æ ·çš„æ•ˆæœï¼Œä½†æ˜¯å¦‚æœæœ‰å…¶ä»–å˜æ¢ä¸€èµ·ä½¿ç”¨ï¼Œä»–ä¼šå…ˆäºsetè¢«åº”ç”¨ |\n| setScale  | ç›´æ¥è¦†ç›–ï¼Œå¦‚æœmatrixä¸­åŸå…ˆæœ‰scaleçš„å€¼ï¼Œé‚£ä¹ˆåŸå…ˆçš„å€¼ä¼šè¢«è¦†ç›–  |\n| postScale | åªéœ€è¦è®¾ç½®å¢é‡å³å¯ï¼Œå¦‚åŸå…ˆçš„scaleä¸º0.5425669ï¼ŒpostScale(1.3947428)åscaleçš„å€¼ä¸º $$0.5425669*1.3947428 = 0.7567413$$ |\n\n\n\n### Matrixå¦‚ä½•ä¸ImageViewç»“åˆ\n\né‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•æ‰èƒ½å°†MatrixåŒImageViewæˆ–è€…Canvasæˆ–è€…Bitmapç»“åˆèµ·æ¥å‘¢ï¼Ÿ\n\næŸ¥æ‰¾Canvasçš„ç›¸å…³æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°setMatrixæ–¹æ³•ï¼Œ\n\n> ```\n> public void setMatrix (Matrix matrix)\n> ```\n>\n> Completely replace the current matrix with the specified matrix. If the matrix parameter is null, then the current matrix is reset to identity. **Note:** it is recommended to use `concat(android.graphics.Matrix)`, `scale(float, float)`, `translate(float, float)` and `rotate(float)` instead of this method.\n\nåŒæ—¶ä¸‹é¢æ¸©é¦¨æç¤ºï¼Œè®©æˆ‘ä»¬ä½¿ç”¨å…¶ä»–æ–¹æ³•ï¼Œå…¶ä¸­æ¶‰åŠåˆ°çŸ©é˜µçš„å°±æœ‰contactï¼Œæ‰€ä»¥æˆ‘ä»¬ç ”ç©¶ä¸‹contactæ–¹æ³•ï¼š\n\ncontactæ–¹æ³•æ¥å—ä¸€ä¸ªMatrixå¯¹è±¡ï¼Œå¯ä»¥å°†å‚æ•°ä¸­çš„çŸ©é˜µé¢„è¿æ¥åˆ°canvasæœ¬èº«çš„çŸ©é˜µä¸Šï¼ˆPreconcat the current matrix with the specified matrix.ï¼‰ï¼›å‡è®¾å½“å‰çŸ©é˜µä¸ºCï¼Œè¦è¿æ¥çš„çŸ©é˜µä¸ºSï¼Œè¿™é‡Œçš„é¢„è¿æ¥ï¼ˆpreconcatï¼‰æŒ‡çš„æ˜¯ï¼š`C = S x C`\n\n## å•ä¸€æ•ˆæœå®ç°\n\n### æ‹–åŠ¨æ•ˆæœå®ç°\n\n1. åˆå§‹åŒ–`GestureDetector`\n\n   ```kotlin\n   private lateinit var mDetector: GestureDetector\n   \n   override fun onCreate(savedInstanceState: Bundle?) {\n           super.onCreate(savedInstanceState)\n           mDetector = GestureDetector(this, simpleDetectorListener)\n   }\n   ```\n\n2. ä½¿ç”¨ `GestureDetector` ä¾¦å¬ `onScroll` æ‰‹åŠ¿\n\n   ```kotlin\n   override fun dispatchTouchEvent(ev: MotionEvent?): Boolean {\n   \treturn mDetector.onTouchEvent(ev)\n   }\n   ```\n\n3. `GestureDetector` çš„ `onScroll` å›è°ƒæ–¹æ³•ä¸­å¤„ç†æ»šåŠ¨äº‹ä»¶\n\n   ```kotlin\n   override fun onScroll(e1: MotionEvent?, e2: MotionEvent?, distanceX: Float, distanceY: Float): Boolean {\n       // æ”¹å˜ImageView çš„xå’Œy\n       imageView.x -= distanceX\n       imageView.y -= distanceY\n       return true\n   }\n   ```\n\n### Fling-æŠ•æ·æ•ˆæœå®ç°\n\n1. åˆå§‹åŒ–`GestureDetector`åŠ `Scroller`\n\n   ```kotlin\n   private lateinit var mDetector: GestureDetector\n   private lateinit var mScroller: Scroller\n   override fun onCreate(savedInstanceState: Bundle?) {\n           super.onCreate(savedInstanceState)\n           mDetector = GestureDetector(this, simpleDetectorListener)\n       \tmScroller = Scroller(this)\n   }\n   ```\n\n2. åœ¨onTouchEventæˆ–dispatchTouchEventä¸­ä½¿ç”¨`GestureDetector` ä¾¦å¬ `onFling` æ‰‹åŠ¿\n\n   ```kotlin\n   override fun dispatchTouchEvent(ev: MotionEvent?): Boolean {\n           return mDetector.onTouchEvent(ev)\n   }\n   ```\n\n3. onFlingå›è°ƒä¸­ä½¿ç”¨`Scroller `å®Œæˆæ»šåŠ¨è¾…åŠ©è®¡ç®—å¹¶ä»Scrollerä¸­è·å–å‚æ•°æ¥æ›´æ–°è§†å›¾çš„x,yç›¸å…³å±æ€§\n\n   ```kotlin\n   override fun onFling(e1: MotionEvent?, e2: MotionEvent?, velocityX: Float, velocityY: Float): Boolean {\n           return handleFling(e1, e2, velocityX, velocityY)\n   }\n   \n   private fun handleFling(down: MotionEvent?, move: MotionEvent?, velocityX: Float, velocityY: Float): Boolean {\n           // åœæ­¢\n           mScroller.forceFinished(true)\n           val minX: Int = (imageView.pivotX * (1 - imageView.scaleX)).roundToInt()\n           val minY: Int = (imageView.pivotY * (1 - imageView.scaleY)).roundToInt()\n           val maxX: Int = ((imageView.width - imageView.pivotX) * (imageView.scaleX - 1)).roundToInt()\n           val maxY: Int = ((imageView.height - imageView.pivotY) * (imageView.scaleY - 1)).roundToInt()\n           mScroller.fling(imageView.x.toInt(), imageView.y.toInt(), velocityX.toInt(), velocityY.toInt(),\n                   minX, maxX, minY, maxY)\n           // Invalidate to request a redraw\n           isFling = true\n           postFling()\n           return true\n   }\n   \n   private fun postFling() {\n       imageView.postDelayed(flingRunnable, 16L)\n   }\n   \n   private val flingRunnable = Runnable {\n           if (!mScroller.isFinished ) {\n               // è®¡ç®—æ»šåŠ¨åçš„å‚æ•°\n               mScroller.computeScrollOffset()\n               // ä»æ»šåŠ¨å™¨ä¸­è·å–è®¡ç®—å‡ºçš„å€¼å¹¶æ›´æ–°å›¾ç‰‡çš„x,yå±æ€§\n               imageView.x = mScroller.currX.toFloat()\n               imageView.y = mScroller.currY.toFloat()\n               // å®šæœŸåˆ·æ–°\n               postFling()\n           }\n   }\n   ```\n\n**Viewç¼©æ”¾åflingè¾¹ç•Œè®¡ç®—**\n\n![image-20210228180521446](https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210228180522.png)\n\n**è¯´æ˜ï¼š**\n\n1. ç¼©æ”¾å‰å®½ï¼šwidth\n\n2. ç¼©æ”¾å‰é«˜ï¼šheight\n\n3. ç¼©æ”¾æ¯”ä¾‹ï¼šscale\n\n4. ç¼©æ”¾ç„¦ç‚¹åæ ‡ï¼šfocusXï¼ŒfocusY\n\n5. minX = - focusX * ï¼ˆscale-1ï¼‰\n\n6. minY = - focusY * ï¼ˆscale-1ï¼‰\n\n7. maxX = ï¼ˆwidth-focusXï¼‰*ï¼ˆscale-1ï¼‰\n\n8. maxY = ï¼ˆheight-focusYï¼‰*ï¼ˆscale-1ï¼‰\n\n### ScaleGestureDetector å®ç°åŒæŒ‡ç¼©æ”¾æ•ˆæœ\n\n1. åˆå§‹åŒ– `ScaleGestureDetector` ï¼›\n\n   ```\n       private lateinit var mScaleDetector: ScaleGestureDetector\n       private val scaleDetectorListener: ScaleGestureDetector.OnScaleGestureListener = object : ScaleGestureDetector.OnScaleGestureListener {\n   \n           override fun onScaleBegin(detector: ScaleGestureDetector?): Boolean {\n               isScaling = true\n               scaleStartX = detector!!.focusX\n               scaleStartY = detector.focusY\n               return true\n           }\n   \n           override fun onScale(detector: ScaleGestureDetector?): Boolean {\n               Timber.tag(\"GestureDetector\").d(\"handleScale onScale\")\n               detector?.run {\n                   handleScale(detector)\n               }\n               return true\n           }\n   \n   \n           override fun onScaleEnd(detector: ScaleGestureDetector?) {\n               Timber.tag(\"GestureDetector\").d(\"handleScale onScaleEnd\")\n               isScaling = false\n           }\n       }\n   ```\n\n   \n\n2. äº‹ä»¶åˆ†å‘æ—¶è°ƒç”¨ `ScaleGestureDetector` çš„ onTouchEvent æ–¹æ³•ä¼ é€’äº‹ä»¶åºåˆ—ï¼›\n\n3. åœ¨scaleäº‹ä»¶å›è°ƒæ–¹æ³•ä¸­å¤„ç†scaleäº‹ä»¶-æ ¹æ®äº‹ä»¶å‚æ•°æ›´æ–°Viewçš„ç¼©æ”¾ï¼ˆscaleXï¼ŒscaleYï¼‰å±æ€§å®Œæˆè§†å›¾æ›´æ–°ï¼›\n\n## å‚è€ƒæ–‡ç«  \n\n### matrixå‚è€ƒ\n\n* [Android matrix.postScaleçš„ç”¨æ³•](https://blog.csdn.net/maxchenfuhai/article/details/51690857)\n* [Android Matrix](https://www.jianshu.com/p/a08e589ce5d4)\n* [Matrixå­¦ä¹ 1ã€åŸºç¡€çš„çŸ¥è¯†](https://www.cnblogs.com/li-print/p/3318805.html)\n* [MathJaxåŸºæœ¬çš„ä½¿ç”¨æ–¹å¼](https://blog.csdn.net/u010945683/article/details/46757757)\n* [Typora Math Block](https://support.typora.io/Markdown-Reference/#math-blocks)\n* [What does it mean to â€œpreconcatâ€ a matrix in Android?](https://stackoverflow.com/questions/2695537/what-does-it-mean-to-preconcat-a-matrix-in-android)\n* [Android Matrixçš„preã€postç†è§£](https://www.jianshu.com/p/7ca1d675a7c8)\n\n### androidæ‰‹åŠ¿\n\n* [æ‰‹åŠ¿ç±»å‹- Material.io](https://material.io/design/interaction/gestures.html#types-of-gestures)\n\n\n",
      "data": {
        "title": "Androidäº‹ä»¶åŠæ‰‹åŠ¿",
        "date": "2018-02-20 10:13:24",
        "tags": [
          "Android"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "androidäº‹ä»¶åŸºç¡€åŠæ‰‹åŠ¿ï¼Œä¸»è¦å…³æ³¨å„ç§æ‰‹åŠ¿çš„ä½¿ç”¨åŠå…¶è®¡ç®—åŸç† ã€‚  ",
      "fileName": "android-shi-jian-ji-shou-shi"
    }
  ],
  "tags": [
    {
      "index": -1,
      "name": "Arduino",
      "slug": "Arduino",
      "used": true
    },
    {
      "name": "CICD",
      "slug": "liJNwHTT8",
      "used": true
    },
    {
      "name": "WebView",
      "slug": "6XxcIf5h1",
      "used": true
    },
    {
      "name": "Vue",
      "slug": "-DsjqfHTsD",
      "used": true
    },
    {
      "name": "Gradle",
      "slug": "A1ylY5G8e",
      "used": true
    },
    {
      "name": "Docker",
      "slug": "NMptrGpeB",
      "used": true
    },
    {
      "index": -1,
      "name": "å·¥ä½œ",
      "slug": "BRSqI8ENH",
      "used": true
    },
    {
      "name": "Gitlab",
      "slug": "uWWSWaUAr",
      "used": true
    },
    {
      "name": "Android",
      "slug": "50sRf4lAz",
      "used": true
    },
    {
      "name": "æºç åˆ†æ",
      "slug": "WWHfwvAsi_",
      "used": true
    },
    {
      "name": "å·¥å…·",
      "slug": "d4ukbE27b",
      "used": true
    },
    {
      "name": "Gridea",
      "slug": "iJMEiKV_v",
      "used": true
    },
    {
      "index": 5,
      "name": "è®¾è®¡",
      "slug": "design",
      "used": false
    },
    {
      "index": -1,
      "name": "Sketch",
      "slug": "Sketch",
      "used": false
    },
    {
      "index": -1,
      "name": "æ—¥å¸¸",
      "slug": "SwVYtT_78",
      "used": false
    }
  ],
  "menus": [
    {
      "link": "/",
      "name": "é¦–é¡µ",
      "openType": "Internal"
    },
    {
      "link": "/archives",
      "name": "å½’æ¡£",
      "openType": "Internal"
    },
    {
      "link": "/tags",
      "name": "æ ‡ç­¾",
      "openType": "Internal"
    },
    {
      "link": "/post/about",
      "name": "å…³äº",
      "openType": "Internal"
    }
  ]
}