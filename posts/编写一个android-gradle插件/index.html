<!doctype html><html lang=zh-cn dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ç¼–å†™ä¸€ä¸ªAndroid Gradleæ’ä»¶ | æ¸…æ°´æ± å¡˜</title><meta name=keywords content="Android,Gradle"><meta name=description content="gradleæœ‰ä¸‰ç§ç¼–å†™æ’ä»¶çš„æ–¹å¼ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨åœ¨é¡¹ç›®ä¸­çš„buildSrcæ¨¡å—ä¸­ç¼–å†™æ’ä»¶çš„æ–¹å¼ï¼Œè‡ªå®šä¹‰äº†ä¸€ä¸ªåº”ç”¨äºAndroidé¡¹ç›®çš„æ ¹æ®flavorè¿‡æ»¤soåº“çš„gradleæ’ä»¶ï¼›

æ¦‚è¿°
è‡ªå®šä¹‰gradleæ’ä»¶æœ‰å¦‚ä¸‹ä¸‰ç§æ–¹å¼ï¼ˆğŸ”—é“¾æ¥ï¼‰ï¼š

åœ¨buildscriptä¸­ç›´æ¥ç¼–å†™ï¼›
åœ¨buildSrcé¡¹ç›®ä¸­ç¼–å†™æ’ä»¶ä»£ç ï¼›
åœ¨ç‹¬ç«‹çš„é¡¹ç›®ä¸­ç¼–å†™æ’ä»¶ä»£ç ï¼›

è¿™é‡Œæˆ‘ä»¬å°†ä½¿ç”¨buildSrcæ–¹å¼å®ç°ä¸€ä¸ªgradleæ’ä»¶ã€‚"><meta name=author content="é‡ç”Ÿè²è—•"><link rel=canonical href=https://hanlyjiang.github.io/posts/%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AAandroid-gradle%E6%8F%92%E4%BB%B6/><link crossorigin=anonymous href=/assets/css/stylesheet.0ddbb411bed5280eeba0e4a55c287e6addf14dc6eb09c604363a7ce5c4d40c1c.css integrity="sha256-Ddu0Eb7VKA7roOSlXCh+at3xTcbrCcYENjp85cTUDBw=" rel="preload stylesheet" as=style><link rel=icon href=https://hanlyjiang.github.io/img/home.png><link rel=icon type=image/png sizes=16x16 href=https://hanlyjiang.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://hanlyjiang.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://hanlyjiang.github.io/apple-touch-icon.png><link rel=mask-icon href=https://hanlyjiang.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh-cn href=https://hanlyjiang.github.io/posts/%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AAandroid-gradle%E6%8F%92%E4%BB%B6/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="https://hanlyjiang.github.io/posts/%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AAandroid-gradle%E6%8F%92%E4%BB%B6/"><meta property="og:site_name" content="æ¸…æ°´æ± å¡˜"><meta property="og:title" content="ç¼–å†™ä¸€ä¸ªAndroid Gradleæ’ä»¶"><meta property="og:description" content="gradleæœ‰ä¸‰ç§ç¼–å†™æ’ä»¶çš„æ–¹å¼ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨åœ¨é¡¹ç›®ä¸­çš„buildSrcæ¨¡å—ä¸­ç¼–å†™æ’ä»¶çš„æ–¹å¼ï¼Œè‡ªå®šä¹‰äº†ä¸€ä¸ªåº”ç”¨äºAndroidé¡¹ç›®çš„æ ¹æ®flavorè¿‡æ»¤soåº“çš„gradleæ’ä»¶ï¼›
æ¦‚è¿° è‡ªå®šä¹‰gradleæ’ä»¶æœ‰å¦‚ä¸‹ä¸‰ç§æ–¹å¼ï¼ˆğŸ”—é“¾æ¥ï¼‰ï¼š
åœ¨buildscriptä¸­ç›´æ¥ç¼–å†™ï¼› åœ¨buildSrcé¡¹ç›®ä¸­ç¼–å†™æ’ä»¶ä»£ç ï¼› åœ¨ç‹¬ç«‹çš„é¡¹ç›®ä¸­ç¼–å†™æ’ä»¶ä»£ç ï¼› è¿™é‡Œæˆ‘ä»¬å°†ä½¿ç”¨buildSrcæ–¹å¼å®ç°ä¸€ä¸ªgradleæ’ä»¶ã€‚"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-09-20T10:18:50+00:00"><meta property="article:modified_time" content="2020-09-20T10:18:50+00:00"><meta property="article:tag" content="Android"><meta property="article:tag" content="Gradle"><meta name=twitter:card content="summary"><meta name=twitter:title content="ç¼–å†™ä¸€ä¸ªAndroid Gradleæ’ä»¶"><meta name=twitter:description content="gradleæœ‰ä¸‰ç§ç¼–å†™æ’ä»¶çš„æ–¹å¼ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨åœ¨é¡¹ç›®ä¸­çš„buildSrcæ¨¡å—ä¸­ç¼–å†™æ’ä»¶çš„æ–¹å¼ï¼Œè‡ªå®šä¹‰äº†ä¸€ä¸ªåº”ç”¨äºAndroidé¡¹ç›®çš„æ ¹æ®flavorè¿‡æ»¤soåº“çš„gradleæ’ä»¶ï¼›

æ¦‚è¿°
è‡ªå®šä¹‰gradleæ’ä»¶æœ‰å¦‚ä¸‹ä¸‰ç§æ–¹å¼ï¼ˆğŸ”—é“¾æ¥ï¼‰ï¼š

åœ¨buildscriptä¸­ç›´æ¥ç¼–å†™ï¼›
åœ¨buildSrcé¡¹ç›®ä¸­ç¼–å†™æ’ä»¶ä»£ç ï¼›
åœ¨ç‹¬ç«‹çš„é¡¹ç›®ä¸­ç¼–å†™æ’ä»¶ä»£ç ï¼›

è¿™é‡Œæˆ‘ä»¬å°†ä½¿ç”¨buildSrcæ–¹å¼å®ç°ä¸€ä¸ªgradleæ’ä»¶ã€‚"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://hanlyjiang.github.io/posts/"},{"@type":"ListItem","position":2,"name":"ç¼–å†™ä¸€ä¸ªAndroid Gradleæ’ä»¶","item":"https://hanlyjiang.github.io/posts/%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AAandroid-gradle%E6%8F%92%E4%BB%B6/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ç¼–å†™ä¸€ä¸ªAndroid Gradleæ’ä»¶","name":"ç¼–å†™ä¸€ä¸ªAndroid Gradleæ’ä»¶","description":"gradleæœ‰ä¸‰ç§ç¼–å†™æ’ä»¶çš„æ–¹å¼ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨åœ¨é¡¹ç›®ä¸­çš„buildSrcæ¨¡å—ä¸­ç¼–å†™æ’ä»¶çš„æ–¹å¼ï¼Œè‡ªå®šä¹‰äº†ä¸€ä¸ªåº”ç”¨äºAndroidé¡¹ç›®çš„æ ¹æ®flavorè¿‡æ»¤soåº“çš„gradleæ’ä»¶ï¼›\næ¦‚è¿° è‡ªå®šä¹‰gradleæ’ä»¶æœ‰å¦‚ä¸‹ä¸‰ç§æ–¹å¼ï¼ˆğŸ”—é“¾æ¥ï¼‰ï¼š\nåœ¨buildscriptä¸­ç›´æ¥ç¼–å†™ï¼› åœ¨buildSrcé¡¹ç›®ä¸­ç¼–å†™æ’ä»¶ä»£ç ï¼› åœ¨ç‹¬ç«‹çš„é¡¹ç›®ä¸­ç¼–å†™æ’ä»¶ä»£ç ï¼› è¿™é‡Œæˆ‘ä»¬å°†ä½¿ç”¨buildSrcæ–¹å¼å®ç°ä¸€ä¸ªgradleæ’ä»¶ã€‚\n","keywords":["Android","Gradle"],"articleBody":"gradleæœ‰ä¸‰ç§ç¼–å†™æ’ä»¶çš„æ–¹å¼ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨åœ¨é¡¹ç›®ä¸­çš„buildSrcæ¨¡å—ä¸­ç¼–å†™æ’ä»¶çš„æ–¹å¼ï¼Œè‡ªå®šä¹‰äº†ä¸€ä¸ªåº”ç”¨äºAndroidé¡¹ç›®çš„æ ¹æ®flavorè¿‡æ»¤soåº“çš„gradleæ’ä»¶ï¼›\næ¦‚è¿° è‡ªå®šä¹‰gradleæ’ä»¶æœ‰å¦‚ä¸‹ä¸‰ç§æ–¹å¼ï¼ˆğŸ”—é“¾æ¥ï¼‰ï¼š\nåœ¨buildscriptä¸­ç›´æ¥ç¼–å†™ï¼› åœ¨buildSrcé¡¹ç›®ä¸­ç¼–å†™æ’ä»¶ä»£ç ï¼› åœ¨ç‹¬ç«‹çš„é¡¹ç›®ä¸­ç¼–å†™æ’ä»¶ä»£ç ï¼› è¿™é‡Œæˆ‘ä»¬å°†ä½¿ç”¨buildSrcæ–¹å¼å®ç°ä¸€ä¸ªgradleæ’ä»¶ã€‚\næ–°å»º buildSrc module gradleä¼šåœ¨é¡¹ç›®ä¸­å¯»æ‰¾åç§°ä¸ºbuildSrcæ¨¡å—ï¼Œå°†å…¶åŠ è½½ä¸ºgradleçš„æ’ä»¶ä»£ç ç›®å½•ã€‚æ‰€ä»¥æˆ‘ä»¬ç›´æ¥é€šè¿‡èœå•æ–°å»ºä¸€ä¸ªåä¸º buildSrc çš„java/kotlinæ¨¡å—ã€‚\nç„¶ååœ¨build.gradleä¸­æ·»åŠ ç›¸å…³çš„plugin(java-gradle-plugin)åŠä¾èµ–ï¼š\nplugins { id 'java' id 'java-gradle-plugin' id \"org.jetbrains.kotlin.jvm\" version '1.3.61' } group = \"io.github.hanlyjiang.gradle\" version = \"0.0.2\" dependencies { testCompile group: 'junit', name: 'junit', version: '4.12' // æ·»åŠ androidç›¸å…³build toolsä¾èµ–ï¼Œä»¥ä¾¿ä½¿ç”¨ android gradle ç›¸å…³çš„API compile 'com.android.tools.build:gradle:3.2.0' } ç¼–å†™æ’ä»¶ éœ€æ±‚ç®€ä»‹ **åº”ç”¨åœºæ™¯ï¼š**æˆ‘ä»¬çš„äº§å“ä¸­é›†æˆäº†ä¸¤ç§VPN SDKï¼Œä½†æ˜¯å…·ä½“åˆ°æ¯ä¸ªé¡¹ç›®ä¸Šé¢ï¼Œéƒ½åªä¼šè½åœ°åˆ°å…·ä½“çš„ä¸€ç§ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦æ’é™¤å¯¹åº”çš„SDKçš„SOåº“ä»¥å‡å°APPåŒ…å¤§å°ï¼Œä¸åŒçš„åœ°åŒºçš„æ‰“åŒ…é…ç½®é€šè¿‡flavoræ¥è¿›è¡ŒåŒºåˆ†é…ç½®ï¼Œå³æ¯ä¸ªåœ°åŒºä¼šå¯¹åº”ä¸åŒçš„flavorï¼›\néœ€æ±‚æå–ï¼š è¿™é‡Œå®é™…ä¸Šæˆ‘ä»¬éœ€è¦çš„æ˜¯èƒ½å¤Ÿæ ¹æ®flavorï¼Œåœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­ç§»é™¤æŒ‡å®šçš„soæ–‡ä»¶ï¼›\nå®ç°æ€è·¯ï¼š\nflavoré…ç½®æ–¹å¼ï¼šåœ¨flavorä¸­é…ç½®ä¸€ä¸ªbuildConfigFieldå­—æ®µï¼Œç”¨äºæŒ‡å®šæˆ‘ä»¬çš„flavoréœ€è¦çš„é…ç½®\n// é…ç½®VPNç±»å‹ buildConfigField \"String\", \"VPN_TYPE\", \"\\\"$VpnType.SANG_FOR\\\"\" æ’ä»¶é…ç½®ï¼šæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªso_excludeé…ç½®æ¥æŒ‡å®šå…·ä½“çš„excludeè§„åˆ™ï¼ŒåŒ…å«ä¸¤ä¸ªå­—æ®µã€‚\nbuildConfigFieldKey ç”¨äºæŒ‡å®šä¹‹å‰åœ¨flavorä¸­å®šä¹‰çš„é…ç½®ï¼› configMap ä¸ºä¸€ä¸ªé…ç½®è¡¨ï¼ŒæŒ‡å®šä¸Šé¢çš„å­—æ®µå¯å–çš„å€¼ï¼Œå³å¯¹åº”å€¼åº”è¯¥excludeçš„soæ–‡ä»¶åˆ—è¡¨ï¼› so_exclude { /** * ä½¿ç”¨VPN_TYPE æ¥è®¾ç½®soè¿‡æ»¤çš„è§„åˆ™ */ buildConfigFieldKey = \"VPN_TYPE\" configMap = [ (VpnType.H3C_iNode.name()): [ // æ–°åä¸‰è¿‡æ»¤æ·±ä¿¡æœçš„ \"lib/armeabi-v7a/libauth_forward.so\", \"lib/armeabi-v7a/libhttps.so\", \"lib/armeabi-v7a/libpkcs12cert.so\", \"lib/armeabi-v7a/libsvpnservice.so\" ], (VpnType.SANG_FOR.name()) : [ // æ·±ä¿¡æœè¿‡æ»¤æ–°åä¸‰çš„ \"lib/armeabi-v7a/libies.so\", ], (VpnType.NONE.name()) : [ // å¦‚é…ç½®æˆ NONEï¼Œåˆ™è¿‡æ»¤æ‰æ‰€æœ‰çš„VPNçš„ // æ·±ä¿¡æœçš„so \"lib/armeabi-v7a/libauth_forward.so\", \"lib/armeabi-v7a/libhttps.so\", \"lib/armeabi-v7a/libpkcs12cert.so\", \"lib/armeabi-v7a/libsvpnservice.so\", // inodeçš„so \"lib/armeabi-v7a/libies.so\", ] ] } å®šä¹‰æ’ä»¶åŠä½¿ç”¨æ’ä»¶ç®€ä»‹ æ’ä»¶éœ€è¦ç»§æ‰¿ org.gradle.api.Pluginï¼Œå¯åœ¨Pluginå¯¹æ„å»ºæµç¨‹è¿›è¡Œè‡ªå®šä¹‰ï¼ˆå¦‚ï¼šåˆ›å»ºä»»åŠ¡ï¼Œå®šä¹‰ä»»åŠ¡å…³ç³»ï¼Œä¿®æ”¹å·²æœ‰ä»»åŠ¡åŠ¨ä½œç­‰ï¼‰ æ’ä»¶å¦‚æœéœ€è¦èƒ½å¤Ÿè¯»å–ä¸€äº›é…ç½®ï¼Œå¯é€šè¿‡ project.extensions.create æ¥ä»build.gradleä¸­æå– å¦‚éœ€åœ¨è‡ªå·±çš„ androidä»£ç æ¨¡å—ä¸­ä½¿ç”¨æ’ä»¶ï¼Œé€šè¿‡ apply plugin: æ’ä»¶ç±»å¼•ç”¨å³å¯ æ’ä»¶å®ç° æ’ä»¶çš„å®ç°å¦‚ä¸‹ï¼š è¯»å– so_exclude é…ç½®ï¼Œå­˜å‚¨åˆ° extensionï¼ˆç±»å‹ä¸º FlavorSoExcludePluginExtension ï¼‰ä¸­ è¯»å– android çš„é…ç½®ï¼Œæ‰¾åˆ° AppExtensionç±»å‹çš„é…ç½®ï¼Œä¹Ÿå°±æ˜¯åº”ç”¨äº† apply application çš„æ¨¡å—çš„é…ç½®ï¼Œæˆ‘ä»¬çš„é¡¹ç›®ä¸­åªæœ‰ä¸€ä¸ªappæ¨¡å—åº”ç”¨æ­¤é…ç½®-å³æˆ‘ä»¬çš„apkæ¨¡å—ï¼› éå†æ‰€æœ‰å˜ä½“ï¼Œè·å–å¯¹åº”å˜ä½“çš„ so_exclude å¯¹åº”çš„é…ç½®å­—æ®µçš„å€¼ï¼Œå»ºç«‹flavoråˆ°é…ç½®å€¼çš„æ˜ å°„è¡¨ï¼› ä¿®æ”¹ packageApplication ä»»åŠ¡ï¼Œè®©å…¶åœ¨æ‰§è¡Œä¹‹å‰å³åˆ é™¤å¾…æ‰“åŒ…ä¸´æ—¶ç›®å½•ä¸­çš„å¯¹åº”soæ–‡ä»¶ï¼› package io.github.hanlyjiang.gradle.plugin.soexclude import com.android.build.gradle.AppExtension import com.android.build.gradle.api.ApkVariantOutput import org.gradle.api.Plugin import org.gradle.api.Project import org.gradle.api.logging.LogLevel import org.gradle.api.logging.Logger import org.gradle.api.logging.Logging import java.io.File /** * so æ’ä»¶çš„ gradle é…ç½®å®ä½“ */ open class FlavorSoExcludePluginExtension { /** * so è¿‡æ»¤é…ç½®è¡¨ */ var configMap: Map","wordCount":"2635","inLanguage":"zh-cn","datePublished":"2020-09-20T10:18:50Z","dateModified":"2020-09-20T10:18:50Z","author":{"@type":"Person","name":"é‡ç”Ÿè²è—•"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://hanlyjiang.github.io/posts/%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AAandroid-gradle%E6%8F%92%E4%BB%B6/"},"publisher":{"@type":"Organization","name":"æ¸…æ°´æ± å¡˜","logo":{"@type":"ImageObject","url":"https://hanlyjiang.github.io/img/home.png"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://hanlyjiang.github.io/ accesskey=h title="æ¸…æ°´æ± å¡˜ (Alt + H)"><img src=https://hanlyjiang.github.io/img/home.png alt aria-label=logo height=35>æ¸…æ°´æ± å¡˜</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://hanlyjiang.github.io/ title=é¦–é¡µ><span><i class='fas fa-home'></i>é¦–é¡µ</span></a></li><li><a href=https://hanlyjiang.github.io/archives/ title=å½’æ¡£><span><i class='fas fa-tags'></i>å½’æ¡£</span></a></li><li><a href=https://hanlyjiang.github.io/tags/ title=æ ‡ç­¾><span>æ ‡ç­¾</span></a></li><li><a href=https://hanlyjiang.github.io/search/ title="æœç´¢ (Alt + /)" accesskey=/><span>æœç´¢</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://hanlyjiang.github.io/>ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href=https://hanlyjiang.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">ç¼–å†™ä¸€ä¸ªAndroid Gradleæ’ä»¶</h1><div class=post-meta><span title='2020-09-20 10:18:50 +0000 UTC'>2020å¹´9æœˆ20æ—¥</span>&nbsp;Â·&nbsp;<span>6 åˆ†é’Ÿ</span>&nbsp;Â·&nbsp;<span>é‡ç”Ÿè²è—•</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>ç›®å½•</span></summary><div class=inner><ul><li><a href=#%e6%a6%82%e8%bf%b0 aria-label=æ¦‚è¿°>æ¦‚è¿°</a></li><li><a href=#%e6%96%b0%e5%bb%ba-buildsrc-module aria-label="æ–°å»º buildSrc module">æ–°å»º buildSrc module</a></li><li><a href=#%e7%bc%96%e5%86%99%e6%8f%92%e4%bb%b6 aria-label=ç¼–å†™æ’ä»¶>ç¼–å†™æ’ä»¶</a><ul><li><a href=#%e9%9c%80%e6%b1%82%e7%ae%80%e4%bb%8b aria-label=éœ€æ±‚ç®€ä»‹>éœ€æ±‚ç®€ä»‹</a></li><li><a href=#%e5%ae%9a%e4%b9%89%e6%8f%92%e4%bb%b6%e5%8f%8a%e4%bd%bf%e7%94%a8%e6%8f%92%e4%bb%b6%e7%ae%80%e4%bb%8b aria-label=å®šä¹‰æ’ä»¶åŠä½¿ç”¨æ’ä»¶ç®€ä»‹>å®šä¹‰æ’ä»¶åŠä½¿ç”¨æ’ä»¶ç®€ä»‹</a></li><li><a href=#%e6%8f%92%e4%bb%b6%e5%ae%9e%e7%8e%b0 aria-label=æ’ä»¶å®ç°>æ’ä»¶å®ç°</a></li></ul></li><li><a href=#%e4%bd%bf%e7%94%a8%e6%9e%9a%e4%b8%be%e8%bf%9b%e8%a1%8c%e9%85%8d%e7%bd%ae aria-label=ä½¿ç”¨æšä¸¾è¿›è¡Œé…ç½®>ä½¿ç”¨æšä¸¾è¿›è¡Œé…ç½®</a></li><li><a href=#%e4%bd%bf%e7%94%a8%e6%8f%92%e4%bb%b6 aria-label=ä½¿ç”¨æ’ä»¶>ä½¿ç”¨æ’ä»¶</a></li><li><a href=#%e5%8f%82%e8%80%83%e6%96%87%e6%a1%a3 aria-label=å‚è€ƒæ–‡æ¡£>å‚è€ƒæ–‡æ¡£</a></li></ul></div></details></div><div class=post-content><p>gradleæœ‰ä¸‰ç§ç¼–å†™æ’ä»¶çš„æ–¹å¼ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨åœ¨é¡¹ç›®ä¸­çš„buildSrcæ¨¡å—ä¸­ç¼–å†™æ’ä»¶çš„æ–¹å¼ï¼Œè‡ªå®šä¹‰äº†ä¸€ä¸ªåº”ç”¨äºAndroidé¡¹ç›®çš„æ ¹æ®flavorè¿‡æ»¤soåº“çš„gradleæ’ä»¶ï¼›</p><h2 id=æ¦‚è¿°>æ¦‚è¿°<a hidden class=anchor aria-hidden=true href=#æ¦‚è¿°>#</a></h2><p>è‡ªå®šä¹‰gradleæ’ä»¶æœ‰å¦‚ä¸‹ä¸‰ç§æ–¹å¼ï¼ˆ<a href=https://docs.gradle.org/current/userguide/custom_plugins.html#sec:packaging_a_plugin>ğŸ”—é“¾æ¥</a>ï¼‰ï¼š</p><ol><li>åœ¨buildscriptä¸­ç›´æ¥ç¼–å†™ï¼›</li><li>åœ¨buildSrcé¡¹ç›®ä¸­ç¼–å†™æ’ä»¶ä»£ç ï¼›</li><li>åœ¨ç‹¬ç«‹çš„é¡¹ç›®ä¸­ç¼–å†™æ’ä»¶ä»£ç ï¼›</li></ol><p>è¿™é‡Œæˆ‘ä»¬å°†ä½¿ç”¨buildSrcæ–¹å¼å®ç°ä¸€ä¸ªgradleæ’ä»¶ã€‚</p><h2 id=æ–°å»º-buildsrc-module>æ–°å»º buildSrc module<a hidden class=anchor aria-hidden=true href=#æ–°å»º-buildsrc-module>#</a></h2><p>gradleä¼šåœ¨é¡¹ç›®ä¸­å¯»æ‰¾åç§°ä¸ºbuildSrcæ¨¡å—ï¼Œå°†å…¶åŠ è½½ä¸ºgradleçš„æ’ä»¶ä»£ç ç›®å½•ã€‚æ‰€ä»¥æˆ‘ä»¬ç›´æ¥é€šè¿‡èœå•æ–°å»ºä¸€ä¸ªåä¸º buildSrc çš„java/kotlinæ¨¡å—ã€‚</p><p>ç„¶ååœ¨build.gradleä¸­æ·»åŠ ç›¸å…³çš„plugin(java-gradle-plugin)åŠä¾èµ–ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span>plugins <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    id <span style=color:#e6db74>&#39;java&#39;</span>
</span></span><span style=display:flex><span>    id <span style=color:#e6db74>&#39;java-gradle-plugin&#39;</span>
</span></span><span style=display:flex><span>    id <span style=color:#e6db74>&#34;org.jetbrains.kotlin.jvm&#34;</span> version <span style=color:#e6db74>&#39;1.3.61&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>group <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;io.github.hanlyjiang.gradle&#34;</span>
</span></span><span style=display:flex><span>version <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;0.0.2&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dependencies <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    testCompile group: <span style=color:#e6db74>&#39;junit&#39;</span><span style=color:#f92672>,</span> name: <span style=color:#e6db74>&#39;junit&#39;</span><span style=color:#f92672>,</span> version: <span style=color:#e6db74>&#39;4.12&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æ·»åŠ androidç›¸å…³build toolsä¾èµ–ï¼Œä»¥ä¾¿ä½¿ç”¨ android gradle ç›¸å…³çš„API
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    compile <span style=color:#e6db74>&#39;com.android.tools.build:gradle:3.2.0&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=ç¼–å†™æ’ä»¶>ç¼–å†™æ’ä»¶<a hidden class=anchor aria-hidden=true href=#ç¼–å†™æ’ä»¶>#</a></h2><h3 id=éœ€æ±‚ç®€ä»‹>éœ€æ±‚ç®€ä»‹<a hidden class=anchor aria-hidden=true href=#éœ€æ±‚ç®€ä»‹>#</a></h3><ul><li><p>**åº”ç”¨åœºæ™¯ï¼š**æˆ‘ä»¬çš„äº§å“ä¸­é›†æˆäº†ä¸¤ç§VPN SDKï¼Œä½†æ˜¯å…·ä½“åˆ°æ¯ä¸ªé¡¹ç›®ä¸Šé¢ï¼Œéƒ½åªä¼šè½åœ°åˆ°å…·ä½“çš„ä¸€ç§ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦æ’é™¤å¯¹åº”çš„SDKçš„SOåº“ä»¥å‡å°APPåŒ…å¤§å°ï¼Œä¸åŒçš„åœ°åŒºçš„æ‰“åŒ…é…ç½®é€šè¿‡flavoræ¥è¿›è¡ŒåŒºåˆ†é…ç½®ï¼Œå³æ¯ä¸ªåœ°åŒºä¼šå¯¹åº”ä¸åŒçš„flavorï¼›</p></li><li><p><strong>éœ€æ±‚æå–</strong>ï¼š è¿™é‡Œå®é™…ä¸Šæˆ‘ä»¬éœ€è¦çš„æ˜¯èƒ½å¤Ÿæ ¹æ®flavorï¼Œåœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­ç§»é™¤æŒ‡å®šçš„soæ–‡ä»¶ï¼›</p></li><li><p><strong>å®ç°æ€è·¯ï¼š</strong></p><ul><li><p>flavoré…ç½®æ–¹å¼ï¼šåœ¨flavorä¸­é…ç½®ä¸€ä¸ªbuildConfigFieldå­—æ®µï¼Œç”¨äºæŒ‡å®šæˆ‘ä»¬çš„flavoréœ€è¦çš„é…ç½®</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span><span style=color:#75715e>// é…ç½®VPNç±»å‹
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>buildConfigField <span style=color:#e6db74>&#34;String&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;VPN_TYPE&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;\&#34;$VpnType.SANG_FOR\&#34;&#34;</span>
</span></span></code></pre></div></li><li><p>æ’ä»¶é…ç½®ï¼šæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªso_excludeé…ç½®æ¥æŒ‡å®šå…·ä½“çš„excludeè§„åˆ™ï¼ŒåŒ…å«ä¸¤ä¸ªå­—æ®µã€‚</p><ul><li>buildConfigFieldKey ç”¨äºæŒ‡å®šä¹‹å‰åœ¨flavorä¸­å®šä¹‰çš„é…ç½®ï¼›</li><li>configMap ä¸ºä¸€ä¸ªé…ç½®è¡¨ï¼ŒæŒ‡å®šä¸Šé¢çš„å­—æ®µå¯å–çš„å€¼ï¼Œå³å¯¹åº”å€¼åº”è¯¥excludeçš„soæ–‡ä»¶åˆ—è¡¨ï¼›</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span>so_exclude <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * ä½¿ç”¨VPN_TYPE æ¥è®¾ç½®soè¿‡æ»¤çš„è§„åˆ™
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    buildConfigFieldKey <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;VPN_TYPE&#34;</span>
</span></span><span style=display:flex><span>    configMap <span style=color:#f92672>=</span> <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>(</span>VpnType<span style=color:#f92672>.</span><span style=color:#a6e22e>H3C_iNode</span><span style=color:#f92672>.</span><span style=color:#a6e22e>name</span><span style=color:#f92672>()):</span> <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>                    <span style=color:#75715e>// æ–°åä¸‰è¿‡æ»¤æ·±ä¿¡æœçš„
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    <span style=color:#e6db74>&#34;lib/armeabi-v7a/libauth_forward.so&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;lib/armeabi-v7a/libhttps.so&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;lib/armeabi-v7a/libpkcs12cert.so&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;lib/armeabi-v7a/libsvpnservice.so&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>],</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>(</span>VpnType<span style=color:#f92672>.</span><span style=color:#a6e22e>SANG_FOR</span><span style=color:#f92672>.</span><span style=color:#a6e22e>name</span><span style=color:#f92672>())</span> <span style=color:#f92672>:</span> <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>                    <span style=color:#75715e>// æ·±ä¿¡æœè¿‡æ»¤æ–°åä¸‰çš„
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    <span style=color:#e6db74>&#34;lib/armeabi-v7a/libies.so&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>],</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>(</span>VpnType<span style=color:#f92672>.</span><span style=color:#a6e22e>NONE</span><span style=color:#f92672>.</span><span style=color:#a6e22e>name</span><span style=color:#f92672>())</span>     <span style=color:#f92672>:</span> <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>                    <span style=color:#75715e>// å¦‚é…ç½®æˆ NONEï¼Œåˆ™è¿‡æ»¤æ‰æ‰€æœ‰çš„VPNçš„
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    <span style=color:#75715e>// æ·±ä¿¡æœçš„so
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    <span style=color:#e6db74>&#34;lib/armeabi-v7a/libauth_forward.so&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;lib/armeabi-v7a/libhttps.so&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;lib/armeabi-v7a/libpkcs12cert.so&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;lib/armeabi-v7a/libsvpnservice.so&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#75715e>// inodeçš„so
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    <span style=color:#e6db74>&#34;lib/armeabi-v7a/libies.so&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div></li></ul></li></ul><h3 id=å®šä¹‰æ’ä»¶åŠä½¿ç”¨æ’ä»¶ç®€ä»‹>å®šä¹‰æ’ä»¶åŠä½¿ç”¨æ’ä»¶ç®€ä»‹<a hidden class=anchor aria-hidden=true href=#å®šä¹‰æ’ä»¶åŠä½¿ç”¨æ’ä»¶ç®€ä»‹>#</a></h3><ul><li>æ’ä»¶éœ€è¦ç»§æ‰¿ <code>org.gradle.api.Plugin</code>ï¼Œå¯åœ¨Pluginå¯¹æ„å»ºæµç¨‹è¿›è¡Œè‡ªå®šä¹‰ï¼ˆå¦‚ï¼šåˆ›å»ºä»»åŠ¡ï¼Œå®šä¹‰ä»»åŠ¡å…³ç³»ï¼Œä¿®æ”¹å·²æœ‰ä»»åŠ¡åŠ¨ä½œç­‰ï¼‰</li><li>æ’ä»¶å¦‚æœéœ€è¦èƒ½å¤Ÿè¯»å–ä¸€äº›é…ç½®ï¼Œå¯é€šè¿‡ <code>project.extensions.create</code> æ¥ä»build.gradleä¸­æå–</li><li>å¦‚éœ€åœ¨è‡ªå·±çš„ androidä»£ç æ¨¡å—ä¸­ä½¿ç”¨æ’ä»¶ï¼Œé€šè¿‡ <code>apply plugin: æ’ä»¶ç±»å¼•ç”¨å³å¯</code></li></ul><h3 id=æ’ä»¶å®ç°>æ’ä»¶å®ç°<a hidden class=anchor aria-hidden=true href=#æ’ä»¶å®ç°>#</a></h3><ul><li>æ’ä»¶çš„å®ç°å¦‚ä¸‹ï¼š<ul><li>è¯»å– so_exclude é…ç½®ï¼Œå­˜å‚¨åˆ° extensionï¼ˆç±»å‹ä¸º FlavorSoExcludePluginExtension ï¼‰ä¸­</li><li>è¯»å– android çš„é…ç½®ï¼Œæ‰¾åˆ° AppExtensionç±»å‹çš„é…ç½®ï¼Œä¹Ÿå°±æ˜¯åº”ç”¨äº† <code>apply application</code> çš„æ¨¡å—çš„é…ç½®ï¼Œæˆ‘ä»¬çš„é¡¹ç›®ä¸­åªæœ‰ä¸€ä¸ªappæ¨¡å—åº”ç”¨æ­¤é…ç½®-å³æˆ‘ä»¬çš„apkæ¨¡å—ï¼›</li><li>éå†æ‰€æœ‰å˜ä½“ï¼Œè·å–å¯¹åº”å˜ä½“çš„ so_exclude å¯¹åº”çš„é…ç½®å­—æ®µçš„å€¼ï¼Œå»ºç«‹flavoråˆ°é…ç½®å€¼çš„æ˜ å°„è¡¨ï¼›</li><li>ä¿®æ”¹ packageApplication ä»»åŠ¡ï¼Œè®©å…¶åœ¨æ‰§è¡Œä¹‹å‰å³åˆ é™¤å¾…æ‰“åŒ…ä¸´æ—¶ç›®å½•ä¸­çš„å¯¹åº”soæ–‡ä»¶ï¼›</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>package</span> io.github.hanlyjiang.gradle.plugin.soexclude
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> com.android.build.gradle.AppExtension
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> com.android.build.gradle.api.ApkVariantOutput
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> org.gradle.api.Plugin
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> org.gradle.api.Project
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> org.gradle.api.logging.LogLevel
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> org.gradle.api.logging.Logger
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> org.gradle.api.logging.Logging
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> java.io.File
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * so æ’ä»¶çš„ gradle é…ç½®å®ä½“
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>open</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FlavorSoExcludePluginExtension</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * so è¿‡æ»¤é…ç½®è¡¨
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> configMap: Map&lt;String, List&lt;String&gt;&gt;? = <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * é…ç½®å­—æ®µçš„åç§°
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> buildConfigFieldKey: String = <span style=color:#a6e22e>FlavorSoExcludePlugin</span>.DEFAULT_CONFIG_KEY
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * flavor so æ‰“åŒ…è¿‡æ»¤é…ç½®
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * ## ç”¨æ³•è¯´æ˜ï¼š
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 1. åœ¨build.gradle ä¸­å¼•å…¥æ’ä»¶ &lt;code&gt;apply plugin: FlavorSoExcludePlugin&lt;/code&gt;;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 2. æ·»åŠ  so_exclude é…ç½®æ®µï¼š
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * ```groovy
</span></span></span><span style=display:flex><span><span style=color:#75715e> * so_exclude {
</span></span></span><span style=display:flex><span><span style=color:#75715e> *   buildConfigFieldKey = &#34;VPN_TYPE&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e> *   configMap = [
</span></span></span><span style=display:flex><span><span style=color:#75715e> *       (VpnType.H3C_iNode.name()): [
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           &#34;lib/armeabi-v7a/libauth_forward.so&#34;,
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           &#34;lib/armeabi-v7a/libhttps.so&#34;,
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           &#34;lib/armeabi-v7a/libpkcs12cert.so&#34;,
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           &#34;lib/armeabi-v7a/libsvpnservice.so&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e> *      ],
</span></span></span><span style=display:flex><span><span style=color:#75715e> *      (VpnType.SANG_FOR.name()) : [
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           &#34;lib/armeabi-v7a/libies.so&#34;,
</span></span></span><span style=display:flex><span><span style=color:#75715e> *       ],
</span></span></span><span style=display:flex><span><span style=color:#75715e> *       (VpnType.NONE.name())     : [
</span></span></span><span style=display:flex><span><span style=color:#75715e> *               // æ·±ä¿¡æœçš„so
</span></span></span><span style=display:flex><span><span style=color:#75715e> *               &#34;lib/armeabi-v7a/libauth_forward.so&#34;,
</span></span></span><span style=display:flex><span><span style=color:#75715e> *               &#34;lib/armeabi-v7a/libhttps.so&#34;,
</span></span></span><span style=display:flex><span><span style=color:#75715e> *               &#34;lib/armeabi-v7a/libpkcs12cert.so&#34;,
</span></span></span><span style=display:flex><span><span style=color:#75715e> *               &#34;lib/armeabi-v7a/libsvpnservice.so&#34;,
</span></span></span><span style=display:flex><span><span style=color:#75715e> *               // inodeçš„so
</span></span></span><span style=display:flex><span><span style=color:#75715e> *               &#34;lib/armeabi-v7a/libies.so&#34;,
</span></span></span><span style=display:flex><span><span style=color:#75715e> *        ]
</span></span></span><span style=display:flex><span><span style=color:#75715e> *   ]
</span></span></span><span style=display:flex><span><span style=color:#75715e> *}
</span></span></span><span style=display:flex><span><span style=color:#75715e> *```
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 3. åœ¨flavorçš„é…ç½®ä¸­æ·»åŠ  buildConfigField é…ç½®ï¼Œå¦‚ï¼š
</span></span></span><span style=display:flex><span><span style=color:#75715e> * ```
</span></span></span><span style=display:flex><span><span style=color:#75715e> * buildConfigField &#34;String&#34;, &#34;VPN_TYPE&#34;, &#34;\&#34;$VpnType.H3C_iNode\&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * ```
</span></span></span><span style=display:flex><span><span style=color:#75715e> * å…¶ä¸­å­—æ®µçš„åç§°ä¸º ä¹‹å‰ so_exclude ä¸­é…ç½®çš„ `buildConfigFieldKey` å­—æ®µï¼Œå¯¹åº”çš„å€¼ä¸º configMap ä¸­çš„ key ï¼Œå¦‚æ­¤é…ç½®åï¼Œæ‰“åŒ…æ—¶å°±ä¼šå°†configMapå¯¹åº”keyä¸­çš„soåˆ—è¡¨è¿‡æ»¤æ‰
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author hanlyjiang 09/20/20 2:42 PM
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @version 1.0
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FlavorSoExcludePlugin</span> : Plugin&lt;Project&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>companion</span> <span style=color:#66d9ef>object</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>val</span> PLUGIN_NAME = <span style=color:#e6db74>&#34;FlavorSoExcludePlugin&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>val</span> DEFAULT_CONFIG_KEY = <span style=color:#e6db74>&#34;SO_EXCLUDE&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>val</span> DEBUG = <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> logger: Logger = <span style=color:#a6e22e>Logging</span>.getLogger(FlavorSoExcludePlugin<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>logInfo</span>(msg: String) {
</span></span><span style=display:flex><span>            logger.log(<span style=color:#a6e22e>LogLevel</span>.LIFECYCLE, <span style=color:#e6db74>&#34;&lt;- </span><span style=color:#e6db74>$PLUGIN</span><span style=color:#e6db74>_NAME: </span><span style=color:#e6db74>$msg</span><span style=color:#e6db74> -&gt;&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>logDebug</span>(msg: String) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (DEBUG) {
</span></span><span style=display:flex><span>                logInfo(msg)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>lateinit</span> <span style=color:#66d9ef>var</span> extension: FlavorSoExcludePluginExtension
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>apply</span>(project: Project) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// æ·»åŠ è‡ªå·±çš„é…ç½®
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        extension = project.extensions.create(<span style=color:#e6db74>&#34;so_exclude&#34;</span>, FlavorSoExcludePluginExtension<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// åˆ›å»ºä¸€ä¸ªæ‰“å°é…ç½®çš„ä»»åŠ¡ï¼Œç”¨äºå®šä¹‰
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>val</span> task = project.tasks.create(<span style=color:#e6db74>&#34;printConfig&#34;</span>)
</span></span><span style=display:flex><span>        task.group = <span style=color:#e6db74>&#34;soExclude-plugin&#34;</span>
</span></span><span style=display:flex><span>        task.doLast {
</span></span><span style=display:flex><span>            logInfo(<span style=color:#e6db74>&#34;-- é…ç½®å­—æ®µï¼šbuildConfigFieldKey= &#34;</span> + extension.buildConfigFieldKey)
</span></span><span style=display:flex><span>            logInfo(<span style=color:#e6db74>&#34;-- å½“å‰é…ç½®ï¼š&#34;</span>)
</span></span><span style=display:flex><span>            extension.configMap<span style=color:#f92672>?.</span>run {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>this</span>.keys.forEach { key <span style=color:#f92672>-&gt;</span>
</span></span><span style=display:flex><span>                    logInfo(<span style=color:#e6db74>&#34;-- config: </span><span style=color:#e6db74>$key</span><span style=color:#e6db74> -- &#34;</span>)
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>get</span>(key)<span style=color:#f92672>?.</span>forEach {
</span></span><span style=display:flex><span>                        logInfo(<span style=color:#e6db74>&#34;values: </span><span style=color:#e6db74>$it</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                    logInfo(<span style=color:#e6db74>&#34;------------------ &#34;</span>)
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>		<span style=color:#75715e>// è·å–androidçš„é…ç½®
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>val</span> androidExtensions = project.extensions.getByName(<span style=color:#e6db74>&#34;android&#34;</span>)
</span></span><span style=display:flex><span>        logInfo(<span style=color:#e6db74>&#34;&#34;</span> + androidExtensions.javaClass)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (androidExtensions <span style=color:#66d9ef>is</span> AppExtension) { 
</span></span><span style=display:flex><span>            <span style=color:#75715e>// applicatoinç±»å‹çš„å°±è¿›è¡Œä»»åŠ¡å¤„ç†
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            initPackageOptions(project, androidExtensions)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * vpn é…ç½®
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> configMap: MutableMap&lt;String, String&gt; = HashMap()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>initPackageOptions</span>(project: Project, android: AppExtension) {
</span></span><span style=display:flex><span>        project.afterEvaluate {
</span></span><span style=display:flex><span>            android.productFlavors.all {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>val</span> flavorName = <span style=color:#66d9ef>it</span>.name
</span></span><span style=display:flex><span>                logDebug(<span style=color:#e6db74>&#34;--productFlavors : </span><span style=color:#e6db74>${it.name}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>var</span> soExcludeConfig = <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>it</span>.buildConfigFields[extension.buildConfigFieldKey]<span style=color:#f92672>?.</span>run {
</span></span><span style=display:flex><span>                    soExcludeConfig = <span style=color:#66d9ef>value</span>.replace(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                logDebug(<span style=color:#e6db74>&#34;--productFlavors : </span><span style=color:#e6db74>$flavorName</span><span style=color:#e6db74>, soExcludeConfig: </span><span style=color:#e6db74>$soExcludeConfig</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>                configMap[flavorName] = soExcludeConfig
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            android.applicationVariants.all { variant <span style=color:#f92672>-&gt;</span>
</span></span><span style=display:flex><span>                logDebug(<span style=color:#e6db74>&#34;app variant flavorName: </span><span style=color:#e6db74>${variant.flavorName}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>val</span> flavorName = variant.flavorName
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>val</span> configKey = configMap[flavorName]
</span></span><span style=display:flex><span>                variant.outputs.forEach { output <span style=color:#f92672>-&gt;</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> (output <span style=color:#66d9ef>is</span> ApkVariantOutput) {
</span></span><span style=display:flex><span>                        <span style=color:#75715e>//æ ¸å¿ƒé€»è¾‘ï¼šä¿®æ”¹packageApplicationä»»åŠ¡ï¼Œåœ¨ç”ŸæˆapkåŒ…ä¹‹å‰ï¼Œåˆ é™¤æ‰“åŒ…ä¸´æ—¶ç›®å½•ä¸­çš„soæ–‡ä»¶å³å¯é¿å…æ‰“åŒ…soåˆ°apkä¸­
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                        output.packageApplication.doFirst {
</span></span><span style=display:flex><span>                            output.packageApplication.jniFolders.all {
</span></span><span style=display:flex><span>                                <span style=color:#75715e>// jniFolder ç›®å½•ä¸ºæœ€åæ‰“åŒ…apkæ—¶ï¼Œç”¨äºå­˜æ”¾soæ–‡ä»¶çš„ä¸´æ—¶ç›®å½•
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                                logInfo(<span style=color:#e6db74>&#34;å˜ä½“åç§°: </span><span style=color:#e6db74>${variant.flavorName}</span><span style=color:#e6db74> , configKey: </span><span style=color:#e6db74>${configKey}</span><span style=color:#e6db74>, jniFolders: &#34;</span> + <span style=color:#66d9ef>it</span>.absoluteFile)
</span></span><span style=display:flex><span>                                handleExclude(<span style=color:#66d9ef>it</span>, configKey);
</span></span><span style=display:flex><span>                                <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>                            }
</span></span><span style=display:flex><span>                        }
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>handleExclude</span>(jniFolder: File?, configKey: String?) {
</span></span><span style=display:flex><span>        extension.configMap<span style=color:#f92672>?.</span>run {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>val</span> soExcludeList: List&lt;String&gt;? = <span style=color:#66d9ef>get</span>(configKey)
</span></span><span style=display:flex><span>            soExcludeList<span style=color:#f92672>?.</span>run {
</span></span><span style=display:flex><span>                deleteJniSoFiles(jniFolder, *(soExcludeList.toTypedArray()))
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>deleteJniSoFiles</span>(jniFolder: File?, <span style=color:#66d9ef>vararg</span> files: String) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (item <span style=color:#66d9ef>in</span> files) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>val</span> file = File(jniFolder, item)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>file</span>.exists()) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>val</span> deleteResult = <span style=color:#66d9ef>file</span>.delete()
</span></span><span style=display:flex><span>                logInfo(<span style=color:#e6db74>&#34;åˆ é™¤soæ–‡ä»¶ </span><span style=color:#e6db74>$item</span><span style=color:#e6db74> : </span><span style=color:#e6db74>${if (deleteResult) &#34;æˆåŠŸ&#34; else &#34;å¤±è´¥&#34;}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=ä½¿ç”¨æšä¸¾è¿›è¡Œé…ç½®>ä½¿ç”¨æšä¸¾è¿›è¡Œé…ç½®<a hidden class=anchor aria-hidden=true href=#ä½¿ç”¨æšä¸¾è¿›è¡Œé…ç½®>#</a></h2><p>æˆ‘ä»¬åœ¨buildSrcä¸­å®šä¹‰ä¸€ä¸ªæšä¸¾ç±»ï¼Œç”¨äºçº¦å®šå¯ä»¥é…ç½®çš„å€¼ï¼Œå³å¯ä»¥æ¸…æ™°å®šä¹‰é…ç½®å€¼é¿å…é…ç½®æ—¶ç›´æ¥å†™å­—ç¬¦ä¸²å®¹æ˜“å‡ºé”™ï¼Œåˆå¯ä»¥æ”¯æŒä»£ç è‡ªåŠ¨è¡¥å…¨æ–¹ä¾¿é…ç½®ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>package</span> io.github.hanlyjiang.gradle.plugin.vpn
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * VPN ç±»å‹
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>enum</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>VpnType</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * æ·±ä¿¡æœ
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    SANG_FOR,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * æ–°åä¸‰
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    H3C_iNode,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * ä¸ä½¿ç”¨VPN
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    NONE,
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * VPN ç±»å‹
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>enum</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>VpnType</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * æ·±ä¿¡æœ
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    SANG_FOR,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * æ–°åä¸‰
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    H3C_iNode,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * ä¸ä½¿ç”¨VPN
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    NONE,
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=ä½¿ç”¨æ’ä»¶>ä½¿ç”¨æ’ä»¶<a hidden class=anchor aria-hidden=true href=#ä½¿ç”¨æ’ä»¶>#</a></h2><ol><li>é€šè¿‡ apply plugin å¼•å…¥æ’ä»¶ï¼Œç›´æ¥ä½¿ç”¨æ’ä»¶ç±»åç§°å³å¯ï¼›</li><li>æšä¸¾é…ç½®ä½¿ç”¨ï¼Œåœ¨gradleé…ç½®ä¸­å¯¼å…¥å¯¹åº”çš„æšä¸¾ç±»ï¼Œç„¶åç›´æ¥ä½¿ç”¨å³å¯ï¼š</li></ol><p>å…·ä½“é…ç½®å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span><span style=color:#75715e>// app/build.gradle
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>import</span> io.github.hanlyjiang.gradle.plugin.soexclude.FlavorSoExcludePlugin
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> io.github.hanlyjiang.gradle.plugin.vpn.VpnType
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>apply plugin: <span style=color:#e6db74>&#39;com.android.application&#39;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// åº”ç”¨æ’ä»¶
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>apply plugin: FlavorSoExcludePlugin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>so_exclude <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * ä½¿ç”¨VPN_TYPE æ¥è®¾ç½®soè¿‡æ»¤çš„è§„åˆ™
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    buildConfigFieldKey <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;VPN_TYPE&#34;</span>
</span></span><span style=display:flex><span>    configMap <span style=color:#f92672>=</span> <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>(</span>VpnType<span style=color:#f92672>.</span><span style=color:#a6e22e>H3C_iNode</span><span style=color:#f92672>.</span><span style=color:#a6e22e>name</span><span style=color:#f92672>()):</span> <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>                    <span style=color:#75715e>// æ–°åä¸‰è¿‡æ»¤æ·±ä¿¡æœçš„
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    <span style=color:#e6db74>&#34;lib/armeabi-v7a/libauth_forward.so&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;lib/armeabi-v7a/libhttps.so&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;lib/armeabi-v7a/libpkcs12cert.so&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;lib/armeabi-v7a/libsvpnservice.so&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>],</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>(</span>VpnType<span style=color:#f92672>.</span><span style=color:#a6e22e>SANG_FOR</span><span style=color:#f92672>.</span><span style=color:#a6e22e>name</span><span style=color:#f92672>())</span> <span style=color:#f92672>:</span> <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>                    <span style=color:#75715e>// æ·±ä¿¡æœè¿‡æ»¤æ–°åä¸‰çš„
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    <span style=color:#e6db74>&#34;lib/armeabi-v7a/libies.so&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>],</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>(</span>VpnType<span style=color:#f92672>.</span><span style=color:#a6e22e>NONE</span><span style=color:#f92672>.</span><span style=color:#a6e22e>name</span><span style=color:#f92672>())</span>     <span style=color:#f92672>:</span> <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>                    <span style=color:#75715e>// å¦‚é…ç½®æˆ NONEï¼Œåˆ™è¿‡æ»¤æ‰æ‰€æœ‰çš„VPNçš„
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    <span style=color:#75715e>// æ·±ä¿¡æœçš„so
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    <span style=color:#e6db74>&#34;lib/armeabi-v7a/libauth_forward.so&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;lib/armeabi-v7a/libhttps.so&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;lib/armeabi-v7a/libpkcs12cert.so&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;lib/armeabi-v7a/libsvpnservice.so&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#75715e>// inodeçš„so
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    <span style=color:#e6db74>&#34;lib/armeabi-v7a/libies.so&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>android <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    defaultConfig <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// é…ç½®VPNç±»å‹
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        buildConfigField <span style=color:#e6db74>&#34;String&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;VPN_TYPE&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;\&#34;$VpnType.SANG_FOR\&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    productFlavors <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=å‚è€ƒæ–‡æ¡£>å‚è€ƒæ–‡æ¡£<a hidden class=anchor aria-hidden=true href=#å‚è€ƒæ–‡æ¡£>#</a></h2><ul><li><a href=https://docs.gradle.org/current/userguide/custom_plugins.html>è‡ªå®šä¹‰æ’ä»¶-å®˜æ–¹æ–‡æ¡£</a></li><li><a href=https://juejin.im/post/6844904176250519565>å†è§å§ buildSrc, æ‹¥æŠ± Composing builds æå‡Android ç¼–è¯‘é€Ÿåº¦</a></li><li><a href=https://www.jianshu.com/p/eb3fb33e4287>å¦‚ä½•åˆ¤æ–­ä»»åŠ¡æ˜¯å¦UP-TO-DATE</a></li><li><a href=https://docs.gradle.org/current/userguide/more_about_tasks.html#sec:up_to_date_checks>å¦‚ä½•è®©ä»»åŠ¡æ”¯æŒUP_TO_DATE-Gradleå®˜æ–¹æ–‡æ¡£</a></li><li>åˆ›å»ºä»»åŠ¡-https://docs.gradle.org/current/dsl/org.gradle.api.Project.html#org.gradle.api.Project:task(java.util.Map,java.lang.String)</li><li><a href=https://docs.gradle.org/current/userguide/custom_tasks.html#incremental_tasks>å¢é‡ä»»åŠ¡-Gradleå®˜æ–¹æ–‡æ¡£</a></li><li><a href=https://docs.gradle.org/current/userguide/more_about_tasks.html#sec:how_does_it_work>å¢é‡æ„å»ºå¦‚ä½•å®ç°ï¼Ÿ-gradleå®˜æ–¹æ–‡æ¡£</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://hanlyjiang.github.io/tags/android/>Android</a></li><li><a href=https://hanlyjiang.github.io/tags/gradle/>Gradle</a></li></ul><nav class=paginav><a class=prev href=https://hanlyjiang.github.io/posts/android%E5%BC%80%E5%8F%91%E6%89%80%E9%9C%80%E8%A6%81%E7%9A%84%E7%9F%A9%E9%98%B5%E7%9F%A5%E8%AF%86/><span class=title>Â« ä¸Šä¸€é¡µ</span><br><span>[è¯‘]Androidå¼€å‘æ‰€éœ€è¦çš„çŸ©é˜µçŸ¥è¯†</span>
</a><a class=next href=https://hanlyjiang.github.io/posts/docker-arm%E6%9E%B6%E6%9E%84%E9%95%9C%E5%83%8F%E6%9E%84%E5%BB%BA-%E9%80%9A%E7%94%A8%E6%AD%A5%E9%AA%A4/><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>Dockeræ„å»ºArmæ¶æ„é•œåƒ-é€šç”¨æ­¥éª¤</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://hanlyjiang.github.io/>æ¸…æ°´æ± å¡˜</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="å¤åˆ¶";function s(){t.innerHTML="å·²å¤åˆ¶ï¼",setTimeout(()=>{t.innerHTML="å¤åˆ¶"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>