<!doctype html><html lang=zh-cn dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>移动中心交接 | 清水池塘</title><meta name=keywords content="工作"><meta name=description content='GeoPanel-移动中心-代码同步
一般步骤

克隆gitlab代码到本地

<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">

  
    
      
        
      
    
    
      
        
      
    
    
      
        
      
    
    
      
        
      
    
  
   Produced by OmniGraffle 7.18.4\n2021-03-23 05:56:46 +0000
  
    Canvas 1
    
      Layer 1
      
        General - Internet
        
          
            
          
          
            
          
        
        
          
            Gitlab
          
        
      
      
        Mobile Services - SNS - Topic
        
          Layer_1
          
            
              
            
          
          
            
              
            
          
          
            
              
            
          
          
            
              
              
                本地仓库
              
            
          
          
            
              
            
          
          
            
              
            
          
          
            
            
              remotes/origin
            
          
          
            
          
        
        
          
            git clone 
          
        
      
      
        
      
    
  



添加github远程仓库到本地仓库（下面取名为github）'><meta name=author content="野生莲藕"><link rel=canonical href=https://hanlyjiang.github.io/posts/%E7%A7%BB%E5%8A%A8%E4%B8%AD%E5%BF%83%E4%BA%A4%E6%8E%A5/><link crossorigin=anonymous href=/assets/css/stylesheet.1dac4471c235f77048759b61f5192f2fba4fce1a14cedacd96fa820edde1c41e.css integrity="sha256-HaxEccI193BIdZth9RkvL7pPzhoUztrNlvqCDt3hxB4=" rel="preload stylesheet" as=style><link rel=icon href=https://hanlyjiang.github.io/img/home.png><link rel=icon type=image/png sizes=16x16 href=https://hanlyjiang.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://hanlyjiang.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://hanlyjiang.github.io/apple-touch-icon.png><link rel=mask-icon href=https://hanlyjiang.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh-cn href=https://hanlyjiang.github.io/posts/%E7%A7%BB%E5%8A%A8%E4%B8%AD%E5%BF%83%E4%BA%A4%E6%8E%A5/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="https://hanlyjiang.github.io/posts/%E7%A7%BB%E5%8A%A8%E4%B8%AD%E5%BF%83%E4%BA%A4%E6%8E%A5/"><meta property="og:site_name" content="清水池塘"><meta property="og:title" content="移动中心交接"><meta property="og:description" content='GeoPanel-移动中心-代码同步 一般步骤 克隆gitlab代码到本地 <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"> Produced by OmniGraffle 7.18.4\n2021-03-23 05:56:46 +0000 Canvas 1 Layer 1 General - Internet Gitlab Mobile Services - SNS - Topic Layer_1 本地仓库 remotes/origin git clone 添加github远程仓库到本地仓库（下面取名为github）'><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-04-08T16:46:15+00:00"><meta property="article:modified_time" content="2021-04-08T16:46:15+00:00"><meta property="article:tag" content="工作"><meta name=twitter:card content="summary"><meta name=twitter:title content="移动中心交接"><meta name=twitter:description content='GeoPanel-移动中心-代码同步
一般步骤

克隆gitlab代码到本地

<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">

  
    
      
        
      
    
    
      
        
      
    
    
      
        
      
    
    
      
        
      
    
  
   Produced by OmniGraffle 7.18.4\n2021-03-23 05:56:46 +0000
  
    Canvas 1
    
      Layer 1
      
        General - Internet
        
          
            
          
          
            
          
        
        
          
            Gitlab
          
        
      
      
        Mobile Services - SNS - Topic
        
          Layer_1
          
            
              
            
          
          
            
              
            
          
          
            
              
            
          
          
            
              
              
                本地仓库
              
            
          
          
            
              
            
          
          
            
              
            
          
          
            
            
              remotes/origin
            
          
          
            
          
        
        
          
            git clone 
          
        
      
      
        
      
    
  



添加github远程仓库到本地仓库（下面取名为github）'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://hanlyjiang.github.io/posts/"},{"@type":"ListItem","position":2,"name":"移动中心交接","item":"https://hanlyjiang.github.io/posts/%E7%A7%BB%E5%8A%A8%E4%B8%AD%E5%BF%83%E4%BA%A4%E6%8E%A5/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"移动中心交接","name":"移动中心交接","description":"GeoPanel-移动中心-代码同步 一般步骤 克隆gitlab代码到本地 \u003c!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\"\u003e Produced by OmniGraffle 7.18.4\\n2021-03-23 05:56:46 +0000 Canvas 1 Layer 1 General - Internet Gitlab Mobile Services - SNS - Topic Layer_1 本地仓库 remotes/origin git clone 添加github远程仓库到本地仓库（下面取名为github）\n","keywords":["工作"],"articleBody":"GeoPanel-移动中心-代码同步 一般步骤 克隆gitlab代码到本地 \u003c!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\"\u003e Produced by OmniGraffle 7.18.4\\n2021-03-23 05:56:46 +0000 Canvas 1 Layer 1 General - Internet Gitlab Mobile Services - SNS - Topic Layer_1 本地仓库 remotes/origin git clone 添加github远程仓库到本地仓库（下面取名为github）\n可使用 git remote -v show 命令确认当前说注册的远程仓库列表\n\u003c!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\"\u003e Produced by OmniGraffle 7.18.4\\n2021-03-23 05:56:46 +0000 Canvas 1 Layer 1 General - Internet GitHub General - Internet Gitlab Mobile Services - SNS - Topic Layer_1 本地仓库 s remotes/origin remotes/github git remote add github https://github/com/xx.git 使用 fetch 命令获取github远程仓库代码到本地\n通过 git fetch github 获取github远程仓库上的所有分支及tag\n如我们需要获取指定分支（如：alpha分支），也可以通过 git fetch github alpha:refs/remotes/github/alpha 只拉取指定分支；\n如果我们需要获取指定tag（如 v1.3.3），可通过 git fetch github v1.3.3:refs/tagg/v1.3.3 只拉取指定tag；\n\u003c!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\"\u003e Produced by OmniGraffle 7.18.4\\n2021-03-23 06:35:35 +0000 Canvas 1 Layer 1 General - Internet GitHub General - Internet Gitlab Mobile Services - SNS - Topic Layer_1 本地仓库 remotes/origin remotes/github git fetch github 将上一步拉取的github远程仓库上的分支/tag推送到gitlab远程仓库的指定分支；\n推送分支到gitlab：git push origin refs/remotes/github/alpha:alpha\n推送tag到github：git push origin refs/tags/v1.3.3:v1.3.3\n\u003c!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\"\u003e Produced by OmniGraffle 7.18.4\\n2021-03-23 06:34:36 +0000 Canvas 1 Layer 1 General - Internet GitHub General - Internet Gitlab Mobile Services - SNS - Topic Layer_1 本地仓库 remotes/origin remotes/github git push origin refs/remotes/github/ alpha:alpha 移动中心同步脚本说明 同步脚本gitlab地址： syncCode.sh\n用法说明 source syncCode.sh WORKDIR=/Users/hanlyjiang/Wksp/work/gitlab/MOA-auto-sync # 移动端代码同步 sync_work_repo_branch https://chuanqi900:stgzsz821006@github.com/3930615/moa-release-geo.git $WORKDIR/moa-release-geo-github.git git@172.17.0.205:GeoPanel/MobileCenter/geopanel-android.git # 后台代码同步 sync_work_repo_branch https://chuanqi900:stgzsz821006@github.com/3930615/moa-release.git $WORKDIR/moa-release-github.git git@172.17.0.205:GeoPanel/MobileCenter/geopanel-mobile-server.git 执行如上同步命令之后，会将从链动github仓库获取的所有分支及tag推送到gitlab仓库；\nGeoPanel-移动中心-ARM镜像制作-成果链接 本节介绍移动中心国产化的构建成果，请阅读以下文章：\n《移动中心国产化-ARM迁移基本思路》 《移动中心国产化-MOA服务迁移记录》 《移动中心国产化-实时音视频服务迁移记录》 相关成果已上传到gitlab仓库的如下分支：\narm/0.5.0-dev arm/v0.3.0-im GeoPanel-移动中心-APP相关 本小节介绍移动中心APP相关内容，主要包括如下内容：\n项目仓库介绍 注意点介绍：主要是我方进行的一些修改，对修改点有所了解，以便后续需要合并代码时减少可能由合并导致的错误。 项目仓库介绍 项目地址 项目仓库地址： http://172.17.0.205/GeoPanel/MobileCenter/geopanel-android 相关文档： 仓库分支及Tag说明 分支说明 此仓库同步了链动的代码分支，并新建新的分支对链动代码进行修改，具体分支跟踪关系如下：\n链动Github仓库 moa-app-workbench 小应用-工作台 moa-app-task 小应用-任务 moa-app-calendar 小应用-日历 moa-app-appmarket 小应用-应用市场 moa-app-addressbook 小应用-通讯录 moa-web-imsdk imsdk moa-client-android-module APP库模块 moa-client-android APP GeoStar Gitlab仓库 moa-app-workbench 小应用-工作台 moa-app-task 小应用-任务 moa-app-calendar 小应用-日历 moa-app-appmarket 小应用-应用市场 moa-app-addressbook 小应用-通讯录 moa-web-imsdk imsdk moa-client-android-module APP库模块 moa-client-android APP geo-client-android/master geo-moa-client-android-module/master geo-moa-web-imsdk/master geo-app-addressbook/master geo-app-appmarket/master geo-app-calendar/nskst/master geo-app-task/nskst/master geo-app-workbench/nskst/master 由上面图可以看出，链动在一个仓库中通过分支分别存放了移动端Android源码，移动端APP库源码，imsdk及示例源码，还有5个基础H5小应用。\n首先，我们完全同步链动的几个分支（moa-xxx）到我们的gitlab仓库； 然后，我们基于链动的几个分支，分别拉取了我们自己的分支进行修改，命名为 geo-xxxx Tag管理 由于我们在一个仓库中放置了若干个模块，通过分支区分，在建立tag时，也需要相应的区分；另外由于链动也会在仓库中提交tag，所以我们需要对tag的命名作一定的约束，一般tag应将分支名称作为前缀，如：\ngeo-client-android-v1.2.22: 为android端的最新版本tag geo-app-appmarket-v1.0.2： 为小应用的最新版本tag Android端版本tag说明\nAndroid端代码会对应多个地区的项目，如果为每个地区单独区分版本号，会造成主线版本管理混乱。\nAPP的版本号不与任何项目进行关联，打包时不论针对哪个项目/产品发包，只要发布了Release版本，就将版本号递增。如下图所示：\n南山块事通发布版本时，版本号为 1.2.19 洪山管理通时则将版本号设置为 1.2.20 重要修改说明 前面说过，我们的代码从链动分支拉取新分支进行了一些修改，这里主要介绍一些重要的修改点：\n打包配置逻辑调整（包括包名，签名，第三方服务账号的key等的修改） UI界面样式调整； 迁移到AndroidX； 扩展cordova插件； 打包配置修改 不同项目的包配置区分 链动提供的版本中，包名为链动的包名，而我们需要将一个包应用到不同的项目之中，故需要对包名进行区分，同时还有对应的百度地图及三方推送等的账号也需要进行区分，故提取了一套配置方式，为了减少对链动原有代码文件的修改，我们的配置主要位于如下新增加的文件及目录中：\nandroid ├── dist-config - 不同项目的打包配置定义 │ └── moa-moa-geo-third-share.gradle │ ├── hongshan_sgt_debug_wuhan.gradle │ ├── hongshan_sgt_release.gradle │ ├── jiujiang_egt_debug_wuhan.gradle │ ├── jiujiang_egt_official.gradle │ ├── ld_test.gradle │ ├── luohu_kst_official.gradle │ ├── moa_jiujiang_wuhan_fixed.gradle │ ├── moa_wxtest_wuhan_195.gradle │ ├── mobile_center_aliyun.gradle │ ├── nskst_official.gradle │ ├── nskst_official_demonstration.gradle │ ├── nskst_official_pre_release.gradle │ ├── nskst_test_internet_shenzhen.gradle │ ├── nskst_test_shenzhen.gradle │ ├── nskst_test_wuhan_fixed.gradle │ ├── nskst_test_wuhan_jianghang.gradle │ ├── nskst_test_wuhan_open.gradle │ ├── nskst_test_wuhan_private.gradle │ ├── nskst_test_wuhan_sr.gradle │ ├── nskst_test_wuhan_wsr.gradle │ ├── rongjiang_kst_official.gradle │ ├── shenzhen_shi_official.gradle │ └── template.gradle ├── dist-config.gradle - 定义配置dist-config目录中配置的加载逻辑 引入dist-config.gradle：(platforms/android/app/build.gradle)\napply from: '../dist-config.gradle' 具体的每个地方的配置，由于已经有接触并配置过，不再赘述\n签名配置 设置debug和release相同签名: (platforms/android/app/build.gradle)\nbuildTypes { release { minifyEnabled true zipAlignEnabled true //压缩优化 shrinkResources true //移出无用资源 proguardFiles getDefaultProguardFile(\"proguard-android.txt\"), \"proguard-rules.pro\" signingConfig signingConfigs.moasign } debug { signingConfig signingConfigs.moasign } } 签名信息替换：(platforms/android/gradle.properties)(链动未提供其签名信息，所以我们自己生成了签名并替换链动的配置)\n# keyAlias MOA_RELEASE_KEY_ALIAS=geostar-moa #keyPassword MOA_RELEASE_KEY_PASSWORD=a7cbf71f1019635fc794df0e1abc3e79 #storeFile MOA_RELEASE_STORE_FILE=../geostar.moa.jks #storePassword MOA_RELEASE_STORE_PASSWORD=9b1d0e07ee4bdb03e2249bf57f6974a4 迁移到AndroidX google最初发布了support库（如：v4，v7，design），之前很多控件都是位于这些库中的（如：RecyclerView，CardView等），后统一为androidx的库，旧的support库不再维护，为了能够避免后续开发功能时引入的某些库无法使用，故将项目其迁移到androidx。\n迁移androidx的修改可以查看Gitlab上的提交：migrate： 迁移到AndroidX (adc773ca) · 提交 · GeoPanel / 移动中心 / 移动平台-Android端 · GitLab\n迁移使用androidstudio提供的迁移命令，会自动将项目中的原先使用support库的部分替换为对应的androidx库的用法，同时在编译时也会对依赖库中jar里面使用的support库进行处理。\nUI界面样式调整 在MOA最初应用到南山项目时，按照南山的UI界面进行了一波界面调整。主要包括：\n登录界面替换； 所有native页面的顶部样式； 基础小应用的顶部样式及界面样式； 扩展cordova插件 APP整体的架构如下：\n系统能力 APP能力 cordova插件框架 H5小应用 相机 通讯录 通讯录 日程 任务 工作台 将系统能力及APP能力以JS接口的方式暴露给H5小应用 消息 应用市场 镜像管理 其他小应用 数据库存储 文件存储 其他 文件 方向传感器 GPS 网络请求 其他 业务的开发主要以H5开发为主，为此APP需要将原生的能力提供为JS的API，链动提供了很多API接口，不过后续发现部分接口有BUG，或者项目上有新的需求，为此我们对cordova插件做了一些修改及扩展，主要包括如下内容：\n二维码扫描功能扩展，支持更多自定义选项 设置功能扩展，添加若干设置项API，包括清除IM消息，打开消息设置界面等 拍摄视频限制时长，视频选择添加时长及大小限制 拍照支持添加水印 增加附件查看接口 添加手势密码保护相关设置 添加第三方分享接口 添加打开微信小程序接口 添加启用引导页面的接口 我方添加的接口都在 cd plugins_dev/repo/cordova-plugin-moa-geo-app 目录中，具体细节也可以在git log中筛选 “H5”，或者针对此目录相关的文件查看历史修改记录，定位具体的commit进行了解。\n关于插件开发的方式，之前已有接触，不在赘述，仅整理一些文档：\nhttps://shimo.im/docs/XRkgJOPwzmtrFbqM/ 《Cordova相关-README》，可复制链接后用石墨文档 App 或小程序打开 https://shimo.im/docs/ne3VVlGLWQf8FB3b/ 《MOA中的Cordova插件开发 - 工作流程篇》，可复制链接后用石墨文档 App 或小程序打开 Gitlab-插件JS合并readme 其他说明 由于最初规划是链动开发基础版本，后续由公司自行维护，故前期部分修改并未特别严格的考虑同链动的代码后续的合并。且我方代码只有非常少的部分同步到了链动，故后续合并代码时应该特别注意。==建议合并代码后再与合并前的代码进行对比，确认合并所产生的差异==。\n","wordCount":"3254","inLanguage":"zh-cn","datePublished":"2021-04-08T16:46:15Z","dateModified":"2021-04-08T16:46:15Z","author":{"@type":"Person","name":"野生莲藕"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://hanlyjiang.github.io/posts/%E7%A7%BB%E5%8A%A8%E4%B8%AD%E5%BF%83%E4%BA%A4%E6%8E%A5/"},"publisher":{"@type":"Organization","name":"清水池塘","logo":{"@type":"ImageObject","url":"https://hanlyjiang.github.io/img/home.png"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://hanlyjiang.github.io/ accesskey=h title="清水池塘 (Alt + H)"><img src=https://hanlyjiang.github.io/img/home.png alt aria-label=logo height=35>清水池塘</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://hanlyjiang.github.io/ title=首页><span><i class='fas fa-home'></i>首页</span></a></li><li><a href=https://hanlyjiang.github.io/archives/ title=归档><span><i class='fas fa-tags'></i>归档</span></a></li><li><a href=https://hanlyjiang.github.io/tags/ title=标签><span>标签</span></a></li><li><a href=https://hanlyjiang.github.io/search/ title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://hanlyjiang.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://hanlyjiang.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">移动中心交接</h1><div class=post-meta><span title='2021-04-08 16:46:15 +0000 UTC'>2021年4月8日</span>&nbsp;·&nbsp;<span>7 min</span>&nbsp;·&nbsp;<span>野生莲藕</span></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#geopanel-%e7%a7%bb%e5%8a%a8%e4%b8%ad%e5%bf%83-%e4%bb%a3%e7%a0%81%e5%90%8c%e6%ad%a5 aria-label=GeoPanel-移动中心-代码同步>GeoPanel-移动中心-代码同步</a><ul><li><a href=#%e4%b8%80%e8%88%ac%e6%ad%a5%e9%aa%a4 aria-label=一般步骤>一般步骤</a></li><li><a href=#%e7%a7%bb%e5%8a%a8%e4%b8%ad%e5%bf%83%e5%90%8c%e6%ad%a5%e8%84%9a%e6%9c%ac%e8%af%b4%e6%98%8e aria-label=移动中心同步脚本说明>移动中心同步脚本说明</a><ul><li><a href=#%e7%94%a8%e6%b3%95%e8%af%b4%e6%98%8e aria-label=用法说明>用法说明</a></li></ul></li></ul></li><li><a href=#geopanel-%e7%a7%bb%e5%8a%a8%e4%b8%ad%e5%bf%83-arm%e9%95%9c%e5%83%8f%e5%88%b6%e4%bd%9c-%e6%88%90%e6%9e%9c%e9%93%be%e6%8e%a5 aria-label=GeoPanel-移动中心-ARM镜像制作-成果链接>GeoPanel-移动中心-ARM镜像制作-成果链接</a></li><li><a href=#geopanel-%e7%a7%bb%e5%8a%a8%e4%b8%ad%e5%bf%83-app%e7%9b%b8%e5%85%b3 aria-label=GeoPanel-移动中心-APP相关>GeoPanel-移动中心-APP相关</a><ul><li><a href=#%e9%a1%b9%e7%9b%ae%e4%bb%93%e5%ba%93%e4%bb%8b%e7%bb%8d aria-label=项目仓库介绍>项目仓库介绍</a><ul><li><a href=#%e9%a1%b9%e7%9b%ae%e5%9c%b0%e5%9d%80 aria-label=项目地址>项目地址</a></li><li><a href=#%e4%bb%93%e5%ba%93%e5%88%86%e6%94%af%e5%8f%8atag%e8%af%b4%e6%98%8e aria-label=仓库分支及Tag说明>仓库分支及Tag说明</a><ul><li><a href=#%e5%88%86%e6%94%af%e8%af%b4%e6%98%8e aria-label=分支说明>分支说明</a></li><li><a href=#tag%e7%ae%a1%e7%90%86 aria-label=Tag管理>Tag管理</a></li></ul></li></ul></li><li><a href=#%e9%87%8d%e8%a6%81%e4%bf%ae%e6%94%b9%e8%af%b4%e6%98%8e aria-label=重要修改说明>重要修改说明</a><ul><li><a href=#%e6%89%93%e5%8c%85%e9%85%8d%e7%bd%ae%e4%bf%ae%e6%94%b9 aria-label=打包配置修改>打包配置修改</a><ul><li><a href=#%e4%b8%8d%e5%90%8c%e9%a1%b9%e7%9b%ae%e7%9a%84%e5%8c%85%e9%85%8d%e7%bd%ae%e5%8c%ba%e5%88%86 aria-label=不同项目的包配置区分>不同项目的包配置区分</a></li><li><a href=#%e7%ad%be%e5%90%8d%e9%85%8d%e7%bd%ae aria-label=签名配置>签名配置</a></li></ul></li><li><a href=#%e8%bf%81%e7%a7%bb%e5%88%b0androidx aria-label=迁移到AndroidX>迁移到AndroidX</a></li><li><a href=#ui%e7%95%8c%e9%9d%a2%e6%a0%b7%e5%bc%8f%e8%b0%83%e6%95%b4 aria-label=UI界面样式调整>UI界面样式调整</a></li><li><a href=#%e6%89%a9%e5%b1%95cordova%e6%8f%92%e4%bb%b6 aria-label=扩展cordova插件>扩展cordova插件</a></li></ul></li><li><a href=#%e5%85%b6%e4%bb%96%e8%af%b4%e6%98%8e aria-label=其他说明>其他说明</a></li></ul></li></ul></div></details></div><div class=post-content><h1 id=geopanel-移动中心-代码同步>GeoPanel-移动中心-代码同步<a hidden class=anchor aria-hidden=true href=#geopanel-移动中心-代码同步>#</a></h1><h2 id=一般步骤>一般步骤<a hidden class=anchor aria-hidden=true href=#一般步骤>#</a></h2><ol><li>克隆gitlab代码到本地</li></ol><!doctype html><svg viewBox="586.5 -80 601.5 198.46154" width="601.5" height="198.46154"><defs><font-face font-family="Helvetica" font-size="16" units-per-em="1e3" underline-position="-75.68359" underline-thickness="49.316406" slope="0" x-height="522.9492" cap-height="717.28516" ascent="770.0195" descent="-229.98047" font-weight="400"><font-face-src><font-face-name name="Helvetica"/></font-face-src></font-face><font-face font-family="PingFang SC" font-size="16" panose-1="2 11 4 0 0 0 0 0 0 0" units-per-em="1e3" underline-position="-150" underline-thickness="58" slope="0" x-height="600" cap-height="860" ascent="1060.0021" descent="-340.0007" font-weight="400"><font-face-src><font-face-name name="PingFangSC-Regular"/></font-face-src></font-face><font-face font-family="Helvetica Neue" font-size="16" panose-1="2 0 5 3 0 0 0 2 0 4" units-per-em="1e3" underline-position="-100" underline-thickness="50" slope="0" x-height="517" cap-height="714" ascent="951.9958" descent="-212.99744" font-weight="400"><font-face-src><font-face-name name="HelveticaNeue"/></font-face-src></font-face><font-face font-family="Courier New" font-size="16" panose-1="2 7 3 9 2 2 5 2 4 4" units-per-em="1e3" underline-position="-232.91016" underline-thickness="41.015625" slope="0" x-height="422.85156" cap-height="571.28906" ascent="832.5195" descent="-300.29297" font-weight="400"><font-face-src><font-face-name name="CourierNewPSMT"/></font-face-src></font-face></defs><g id="Canvas_1" stroke="none" fill-opacity="1" fill="none" stroke-opacity="1" stroke-dasharray="none"><title>Canvas 1</title><g id="Canvas_1_Layer_1"><title>Layer 1</title><g id="Group_33"><title>General - Internet</title><g id="Group_35"><g id="Graphic_37"><path d="M1188 27.79753v7.18182C1188 47.996394 1173.6364 61.4623 1156.1307 61.4623H1061.8693C1044.1392 61.4623 1030 48.220826 1030 34.97935V27.79753z" fill="#7d7c7c"/></g><g id="Graphic_36"><path d="M1090.821-42.000765C1107.2045-42.000765 1121.3438-32.350197 1127.6278-18.210992 1130.9943-20.45531 1134.8097-21.8019 1139.2983-21.8019 1150.5199-21.8019 1159.4972-13.04906 1159.7216-2.0519012 1175.6562-.7053103 1188 14.556053 1188 26.899803v2.693182C1188 42.83446 1173.6364 56.07594 1155.9062 56.07594H1061.8693C1044.1392 56.07594 1030 42.83446 1030 29.592985V26.899803C1030 16.800372 1038.5284 2.8855988 1050.4233-.4808785c0-.4488636.0-.6732955.0-1.1221591C1050.4233-24.04622 1068.3778-42.000765 1090.821-42.000765z" fill="#d2d3d3"/></g></g><g id="Graphic_34"><text transform="translate(1085.4865 63.4623)" fill="#000"><tspan font-family="Helvetica" font-size="16" font-weight="400" fill="#000" x="0" y="15">Gitlab</tspan></text></g></g><g id="Group_38"><title>Mobile Services - SNS - Topic</title><g id="Group_40"><title>Layer_1</title><g id="Group_53"><g id="Graphic_54"><rect x="586.5" y="48.76923" width="279" height="47.69231" fill="#692f56"/></g></g><g id="Group_51"><g id="Graphic_52"><rect x="586.5" y="-5.736264" width="279" height="43.263736" fill="#692f56"/></g></g><g id="Group_49"><g id="Graphic_50"><path d="M865.1593-28.9011v8.516485H586.5V-28.9011L746.95055-75.23077z" fill="#692f56"/></g></g><g id="Group_47"><g id="Graphic_48"><rect x="586.5" y="-80" width="279" height="51.0989" fill="#ad688b"/><text transform="translate(591.5 -65.45055)" fill="#fff"><tspan font-family="PingFang SC" font-size="16" font-weight="400" fill="#fff" x="102.5" y="17">本地仓库</tspan></text></g></g><g id="Group_45"><g id="Graphic_46"><rect x="586.5" y="-13.571429" width="279" height="42.58242" fill="#ad688b"/></g></g><g id="Group_43"><g id="Graphic_44"><rect x="586.5" y="45.36264" width="279" height="42.58242" fill="#ad688b"/></g></g><g id="Graphic_42"><rect x="595.35714" y="-4.7142857" width="260.94505" height="24.527473" fill="#fff"/><text transform="translate(600.35714 -1.6745485)" fill="#000"><tspan font-family="Helvetica Neue" font-size="16" font-weight="400" fill="#000" x="73.91253" y="15">remotes/origin</tspan></text></g><g id="Graphic_41"><rect x="595.35714" y="54.56044" width="260.94505" height="24.527473" fill="#fff"/></g></g><g id="Graphic_39"><text transform="translate(677.9922 98.46154)" fill="#000"><tspan font-family="Courier New" font-size="16" font-weight="400" fill="#000" x="4.800781" y="13">git clone</tspan></text></g></g><g id="Line_55"><line x1="865.5" y1="19.23077" x2="1030" y2="21.23077" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-dasharray="8.0,8.0" stroke-width="2"/></g></g></g></svg><ol start=2><li><p>添加github远程仓库到本地仓库（下面取名为github）</p><p>可使用 <code>git remote -v show</code> 命令确认当前说注册的远程仓库列表</p></li></ol><!doctype html><svg viewBox="285 274 903 216.46154" width="903" height="216.46154"><defs><font-face font-family="Helvetica" font-size="16" units-per-em="1e3" underline-position="-75.68359" underline-thickness="49.316406" slope="0" x-height="522.9492" cap-height="717.28516" ascent="770.0195" descent="-229.98047" font-weight="400"><font-face-src><font-face-name name="Helvetica"/></font-face-src></font-face><font-face font-family="PingFang SC" font-size="16" panose-1="2 11 4 0 0 0 0 0 0 0" units-per-em="1e3" underline-position="-150" underline-thickness="58" slope="0" x-height="600" cap-height="860" ascent="1060.0021" descent="-340.0007" font-weight="400"><font-face-src><font-face-name name="PingFangSC-Regular"/></font-face-src></font-face><font-face font-family="Helvetica Neue" font-size="16" panose-1="2 0 5 3 0 0 0 2 0 4" units-per-em="1e3" underline-position="-100" underline-thickness="50" slope="0" x-height="517" cap-height="714" ascent="951.9958" descent="-212.99744" font-weight="400"><font-face-src><font-face-name name="HelveticaNeue"/></font-face-src></font-face><font-face font-family="Courier New" font-size="16" panose-1="2 7 3 9 2 2 5 2 4 4" units-per-em="1e3" underline-position="-232.91016" underline-thickness="41.015625" slope="0" x-height="422.85156" cap-height="571.28906" ascent="832.5195" descent="-300.29297" font-weight="400"><font-face-src><font-face-name name="CourierNewPSMT"/></font-face-src></font-face></defs><g id="Canvas_1" stroke="none" fill-opacity="1" fill="none" stroke-opacity="1" stroke-dasharray="none"><title>Canvas 1</title><g id="Canvas_1_Layer_1"><title>Layer 1</title><g id="Group_3"><title>General - Internet</title><g id="Group_5"><g id="Graphic_7"><path d="M443 414.7983V421.9801c0 13.01706-14.36364 26.48297-31.8693 26.48297H316.8693C299.1392 448.46307 285 435.2216 285 421.9801V414.7983z" fill="#7d7c7c"/></g><g id="Graphic_6"><path d="M345.82102 345C362.20455 345 376.34375 354.65057 382.62784 368.78977 385.9943 366.54545 389.80966 365.19886 394.2983 365.19886c11.2216.0 20.19886 8.75283999999999 20.4233 19.75C430.65625 386.29545 443 401.5568 443 413.90057V416.59375c0 13.24148-14.36364 26.48295-32.09375 26.48295H316.8693c-17.7301.0-31.8693-13.24147-31.8693-26.48295V413.90057C285 403.80114 293.5284 389.88636 305.4233 386.5199 305.4233 386.071 305.4233 385.8466 305.4233 385.39773 305.4233 362.95455 323.37784 345 345.82102 345z" fill="#d2d3d3"/></g></g><g id="Graphic_4"><text transform="translate(336.4865 450.46307)" fill="#000"><tspan font-family="Helvetica" font-size="16" font-weight="400" fill="#000" x="0" y="15">GitHub</tspan></text></g></g><g id="Group_8"><title>General - Internet</title><g id="Group_10"><g id="Graphic_12"><path d="M1188 381.79753V388.97935C1188 401.9964 1173.6364 415.4623 1156.1307 415.4623H1061.8693C1044.1392 415.4623 1030 402.22083 1030 388.97935V381.79753z" fill="#7d7c7c"/></g><g id="Graphic_11"><path d="M1090.821 311.99924C1107.2045 311.99924 1121.3438 321.6498 1127.6278 335.789 1130.9943 333.5447 1134.8097 332.1981 1139.2983 332.1981 1150.5199 332.1981 1159.4972 340.95094 1159.7216 351.9481 1175.6562 353.2947 1188 368.55605 1188 380.8998V383.593C1188 396.83446 1173.6364 410.07594 1155.9062 410.07594H1061.8693C1044.1392 410.07594 1030 396.83446 1030 383.593V380.8998C1030 370.80037 1038.5284 356.8856 1050.4233 353.51912c0-.448859999999968.0-.673290000000009.0-1.12216000000001.0-22.44316 17.9545000000001-40.39772 40.3977-40.39772z" fill="#d2d3d3"/></g></g><g id="Graphic_9"><text transform="translate(1085.4865 417.4623)" fill="#000"><tspan font-family="Helvetica" font-size="16" font-weight="400" fill="#000" x="0" y="15">Gitlab</tspan></text></g></g><g id="Group_13"><title>Mobile Services - SNS - Topic</title><g id="Group_15"><title>Layer_1</title><g id="Group_28"><g id="Graphic_29"><rect x="586.5" y="402.76923" width="279" height="47.69231" fill="#692f56"/></g></g><g id="Group_26"><g id="Graphic_27"><rect x="586.5" y="348.26374" width="279" height="43.263736" fill="#692f56"/></g></g><g id="Group_24"><g id="Graphic_25"><path d="M865.1593 325.0989V333.6154H586.5V325.0989l160.45055-46.32967z" fill="#692f56"/></g></g><g id="Group_22"><g id="Graphic_23"><rect x="586.5" y="274" width="279" height="51.0989" fill="#ad688b"/><text transform="translate(591.5 288.54945)" fill="#fff"><tspan font-family="PingFang SC" font-size="16" font-weight="400" fill="#fff" x="102.5" y="17">本地仓库</tspan></text></g></g><g id="Group_20"><g id="Graphic_21"><rect x="586.5" y="340.42857" width="279" height="42.58242" fill="#ad688b"/></g></g><g id="Group_18"><g id="Graphic_19"><rect x="586.5" y="399.36264" width="279" height="42.58242" fill="#ad688b"/><text transform="translate(591.5 402.42985)" fill="#000"><tspan font-family="Helvetica Neue" font-size="16" font-weight="400" fill="#000" x="130.5" y="15">s</tspan></text></g></g><g id="Graphic_17"><rect x="595.35714" y="349.2857" width="260.94505" height="24.527473" fill="#fff"/><text transform="translate(600.35714 352.32545)" fill="#000"><tspan font-family="Helvetica Neue" font-size="16" font-weight="400" fill="#000" x="73.91253" y="15">remotes/origin</tspan></text></g><g id="Graphic_16"><rect x="595.35714" y="408.56044" width="260.94505" height="24.527473" fill="#fff"/><text transform="translate(600.35714 411.6002)" fill="#000"><tspan font-family="Helvetica Neue" font-size="16" font-weight="400" fill="#000" x="71.23253" y="15">remotes/github</tspan></text></g></g><g id="Graphic_14"><text transform="translate(605.9805 452.46154)" fill="#000"><tspan font-family="Courier New" font-size="16" font-weight="400" fill="#000" x="19.203125" y="13">git remote add github</tspan><tspan font-family="Courier New" font-size="16" font-weight="400" fill="#000" x="0" y="31">https://github/com/xx.git</tspan></text></g></g><g id="Line_30"><line x1="586.5" y1="409" x2="443" y2="408.23153" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-dasharray="8.0,8.0" stroke-width="2"/></g><g id="Line_32"><line x1="865.5" y1="382.23077" x2="1030" y2="375.23077" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-dasharray="8.0,8.0" stroke-width="2"/></g></g></g></svg><ol start=3><li><p>使用 <code>fetch</code> 命令获取github远程仓库代码到本地</p><blockquote><p>通过 <code>git fetch github</code> 获取github远程仓库上的所有分支及tag</p><p>如我们需要获取指定分支（如：alpha分支），也可以通过 <code>git fetch github alpha:refs/remotes/github/alpha</code> 只拉取指定分支；</p><p>如果我们需要获取指定tag（如 v1.3.3），可通过 <code>git fetch github v1.3.3:refs/tagg/v1.3.3</code> 只拉取指定tag；</p></blockquote></li></ol><!doctype html><svg viewBox="285 616.5008 903 198.46154" width="903" height="198.46154"><defs><font-face font-family="Helvetica" font-size="16" units-per-em="1e3" underline-position="-75.68359" underline-thickness="49.316406" slope="0" x-height="522.9492" cap-height="717.28516" ascent="770.0195" descent="-229.98047" font-weight="400"><font-face-src><font-face-name name="Helvetica"/></font-face-src></font-face><font-face font-family="PingFang SC" font-size="16" panose-1="2 11 4 0 0 0 0 0 0 0" units-per-em="1e3" underline-position="-150" underline-thickness="58" slope="0" x-height="600" cap-height="860" ascent="1060.0021" descent="-340.0007" font-weight="400"><font-face-src><font-face-name name="PingFangSC-Regular"/></font-face-src></font-face><font-face font-family="Helvetica Neue" font-size="16" panose-1="2 0 5 3 0 0 0 2 0 4" units-per-em="1e3" underline-position="-100" underline-thickness="50" slope="0" x-height="517" cap-height="714" ascent="951.9958" descent="-212.99744" font-weight="400"><font-face-src><font-face-name name="HelveticaNeue"/></font-face-src></font-face><font-face font-family="Courier New" font-size="16" panose-1="2 7 3 9 2 2 5 2 4 4" units-per-em="1e3" underline-position="-232.91016" underline-thickness="41.015625" slope="0" x-height="422.85156" cap-height="571.28906" ascent="832.5195" descent="-300.29297" font-weight="400"><font-face-src><font-face-name name="CourierNewPSMT"/></font-face-src></font-face><marker orient="auto" overflow="visible" markerUnits="strokeWidth" id="StickArrow_Marker" stroke-linejoin="miter" stroke-miterlimit="10" viewBox="-6 -3 7 6" markerWidth="7" markerHeight="6" color="#000"><g><path d="M-4.8.0H0M0 1.8-4.8.0.0-1.8" fill="none" stroke="currentColor" stroke-width="1"/></g></marker></defs><g id="Canvas_1" stroke="none" fill-opacity="1" fill="none" stroke-opacity="1" stroke-dasharray="none"><title>Canvas 1</title><g id="Canvas_1_Layer_1"><title>Layer 1</title><g id="Group_57"><title>General - Internet</title><g id="Group_59"><g id="Graphic_61"><path d="M443 757.2991V764.4809C443 777.4979 428.63636 790.9638 411.1307 790.9638H316.8693c-17.7301.0-31.8693-13.2414-31.8693-26.4829V757.2991z" fill="#7d7c7c"/></g><g id="Graphic_60"><path d="M345.82102 687.5008C362.20455 687.5008 376.34375 697.1513 382.62784 711.2905 385.9943 709.0462 389.80966 707.6996 394.2983 707.6996c11.2216.0 20.19886 8.75289999999995 20.4233 19.75C430.65625 728.7962 443 744.0576 443 756.4013V759.0945C443 772.336 428.63636 785.5775 410.90625 785.5775H316.8693C299.1392 785.5775 285 772.336 285 759.0945V756.4013C285 746.3019 293.5284 732.3871 305.4233 729.02065 305.4233 728.5718 305.4233 728.34736 305.4233 727.8985c0-22.4432 17.95454-40.3977 40.39772-40.3977z" fill="#d2d3d3"/></g></g><g id="Graphic_58"><text transform="translate(336.4865 792.9638)" fill="#000"><tspan font-family="Helvetica" font-size="16" font-weight="400" fill="#000" x="0" y="15">GitHub</tspan></text></g></g><g id="Group_62"><title>General - Internet</title><g id="Group_64"><g id="Graphic_66"><path d="M1188 724.2983V731.4801C1188 744.4972 1173.6364 757.9631 1156.1307 757.9631H1061.8693C1044.1392 757.9631 1030 744.7216 1030 731.4801V724.2983z" fill="#7d7c7c"/></g><g id="Graphic_65"><path d="M1090.821 654.5C1107.2045 654.5 1121.3438 664.1506 1127.6278 678.2898 1130.9943 676.04545 1134.8097 674.6989 1139.2983 674.6989 1150.5199 674.6989 1159.4972 683.4517 1159.7216 694.4489 1175.6562 695.79545 1188 711.0568 1188 723.4006V726.09375C1188 739.3352 1173.6364 752.5767 1155.9062 752.5767H1061.8693C1044.1392 752.5767 1030 739.3352 1030 726.09375V723.4006C1030 713.3011 1038.5284 699.3864 1050.4233 696.0199 1050.4233 695.571 1050.4233 695.3466 1050.4233 694.8977 1050.4233 672.45455 1068.3778 654.5 1090.821 654.5z" fill="#d2d3d3"/></g></g><g id="Graphic_63"><text transform="translate(1085.4865 759.9631)" fill="#000"><tspan font-family="Helvetica" font-size="16" font-weight="400" fill="#000" x="0" y="15">Gitlab</tspan></text></g></g><g id="Group_67"><title>Mobile Services - SNS - Topic</title><g id="Group_69"><title>Layer_1</title><g id="Group_82"><g id="Graphic_83"><rect x="586.5" y="745.27" width="279" height="47.69231" fill="#692f56"/></g></g><g id="Group_80"><g id="Graphic_81"><rect x="586.5" y="690.7645" width="279" height="43.263736" fill="#692f56"/></g></g><g id="Group_78"><g id="Graphic_79"><path d="M865.1593 667.5997V676.11615H586.5V667.5997L746.95055 621.27z" fill="#692f56"/></g></g><g id="Group_76"><g id="Graphic_77"><rect x="586.5" y="616.5008" width="279" height="51.0989" fill="#ad688b"/><text transform="translate(591.5 631.0502)" fill="#fff"><tspan font-family="PingFang SC" font-size="16" font-weight="400" fill="#fff" x="102.5" y="17">本地仓库</tspan></text></g></g><g id="Group_74"><g id="Graphic_75"><rect x="586.5" y="682.9293" width="279" height="42.58242" fill="#ad688b"/></g></g><g id="Group_72"><g id="Graphic_73"><rect x="586.5" y="741.8634" width="279" height="42.58242" fill="#ad688b"/></g></g><g id="Graphic_71"><rect x="595.35714" y="691.7865" width="260.94505" height="24.527473" fill="#fff"/><text transform="translate(600.35714 694.8262)" fill="#000"><tspan font-family="Helvetica Neue" font-size="16" font-weight="400" fill="#000" x="73.91253" y="15">remotes/origin</tspan></text></g><g id="Graphic_70"><rect x="595.35714" y="751.0612" width="260.94505" height="24.527473" fill="#fff"/><text transform="translate(600.35714 754.1009)" fill="#000"><tspan font-family="Helvetica Neue" font-size="16" font-weight="400" fill="#000" x="71.23253" y="15">remotes/github</tspan></text></g></g><g id="Graphic_68"><text transform="translate(649.1875 794.9623)" fill="#000"><tspan font-family="Courier New" font-size="16" font-weight="400" fill="#000" x="0" y="13">git fetch github</tspan></text></g></g><g id="Line_84"><line x1="573.6002" y1="751.4317" x2="443" y2="750.7323" marker-start="url(#StickArrow_Marker)" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></g><g id="Line_85"><line x1="865.5" y1="715.7315" x2="1030" y2="717.7315" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-dasharray="8.0,8.0" stroke-width="2"/></g></g></g></svg><ol start=4><li><p>将上一步拉取的github远程仓库上的分支/tag推送到gitlab远程仓库的指定分支；</p><blockquote><p>推送分支到gitlab：<code>git push origin refs/remotes/github/alpha:alpha</code></p><p>推送tag到github：<code>git push origin refs/tags/v1.3.3:v1.3.3</code></p></blockquote></li></ol><!doctype html><svg viewBox="285 956 903 234.46154" width="903" height="234.46154"><defs><font-face font-family="Helvetica" font-size="16" units-per-em="1e3" underline-position="-75.68359" underline-thickness="49.316406" slope="0" x-height="522.9492" cap-height="717.28516" ascent="770.0195" descent="-229.98047" font-weight="400"><font-face-src><font-face-name name="Helvetica"/></font-face-src></font-face><font-face font-family="PingFang SC" font-size="16" panose-1="2 11 4 0 0 0 0 0 0 0" units-per-em="1e3" underline-position="-150" underline-thickness="58" slope="0" x-height="600" cap-height="860" ascent="1060.0021" descent="-340.0007" font-weight="400"><font-face-src><font-face-name name="PingFangSC-Regular"/></font-face-src></font-face><font-face font-family="Helvetica Neue" font-size="16" panose-1="2 0 5 3 0 0 0 2 0 4" units-per-em="1e3" underline-position="-100" underline-thickness="50" slope="0" x-height="517" cap-height="714" ascent="951.9958" descent="-212.99744" font-weight="400"><font-face-src><font-face-name name="HelveticaNeue"/></font-face-src></font-face><font-face font-family="Courier New" font-size="16" panose-1="2 7 3 9 2 2 5 2 4 4" units-per-em="1e3" underline-position="-232.91016" underline-thickness="41.015625" slope="0" x-height="422.85156" cap-height="571.28906" ascent="832.5195" descent="-300.29297" font-weight="400"><font-face-src><font-face-name name="CourierNewPSMT"/></font-face-src></font-face><marker orient="auto" overflow="visible" markerUnits="strokeWidth" id="FilledArrow_Marker" stroke-linejoin="miter" stroke-miterlimit="10" viewBox="-1 -3 7 6" markerWidth="7" markerHeight="6" color="#000"><g><path d="M4.8.0.0-1.8V1.8z" fill="currentColor" stroke="currentColor" stroke-width="1"/></g></marker></defs><g id="Canvas_1" stroke="none" fill-opacity="1" fill="none" stroke-opacity="1" stroke-dasharray="none"><title>Canvas 1</title><g id="Canvas_1_Layer_1"><title>Layer 1</title><g id="Group_87"><title>General - Internet</title><g id="Group_89"><g id="Graphic_91"><path d="M443 1096.7983V1103.9801C443 1116.9972 428.63636 1130.4631 411.1307 1130.4631H316.8693C299.1392 1130.4631 285 1117.2216 285 1103.9801V1096.7983z" fill="#7d7c7c"/></g><g id="Graphic_90"><path d="M345.82102 1027c16.38353.0 30.52273 9.65059999999994 36.80682 23.7898C385.9943 1048.5455 389.80966 1047.1989 394.2983 1047.1989c11.2216.0 20.19886 8.75279999999998 20.4233 19.75C430.65625 1068.2955 443 1083.5568 443 1095.9006V1098.5938c0 13.2413999999999-14.36364 26.4829-32.09375 26.4829H316.8693C299.1392 1125.0767 285 1111.8352 285 1098.5938V1095.9006C285 1085.8011 293.5284 1071.8864 305.4233 1068.5199 305.4233 1068.071 305.4233 1067.8466 305.4233 1067.3977 305.4233 1044.9545 323.37784 1027 345.82102 1027z" fill="#d2d3d3"/></g></g><g id="Graphic_88"><text transform="translate(336.4865 1132.4631)" fill="#000"><tspan font-family="Helvetica" font-size="16" font-weight="400" fill="#000" x="0" y="15">GitHub</tspan></text></g></g><g id="Group_92"><title>General - Internet</title><g id="Group_94"><g id="Graphic_96"><path d="M1188 1063.7975V1070.9793C1188 1083.9964 1173.6364 1097.4623 1156.1307 1097.4623H1061.8693C1044.1392 1097.4623 1030 1084.2208 1030 1070.9793V1063.7975z" fill="#7d7c7c"/></g><g id="Graphic_95"><path d="M1090.821 993.9992C1107.2045 993.9992 1121.3438 1003.6498 1127.6278 1017.789 1130.9943 1015.5447 1134.8097 1014.1981 1139.2983 1014.1981 1150.5199 1014.1981 1159.4972 1022.951 1159.7216 1033.9481 1175.6562 1035.2947 1188 1050.556 1188 1062.8998V1065.593C1188 1078.8345 1173.6364 1092.076 1155.9062 1092.076H1061.8693C1044.1392 1092.076 1030 1078.8345 1030 1065.593V1062.8998C1030 1052.8004 1038.5284 1038.8856 1050.4233 1035.5191c0-.448799999999892.0-.673299999999927.0-1.12210000000005C1050.4233 1011.9538 1068.3778 993.9992 1090.821 993.9992z" fill="#d2d3d3"/></g></g><g id="Graphic_93"><text transform="translate(1085.4865 1099.4623)" fill="#000"><tspan font-family="Helvetica" font-size="16" font-weight="400" fill="#000" x="0" y="15">Gitlab</tspan></text></g></g><g id="Group_97"><title>Mobile Services - SNS - Topic</title><g id="Group_99"><title>Layer_1</title><g id="Group_112"><g id="Graphic_113"><rect x="586.5" y="1084.7692" width="279" height="47.69231" fill="#692f56"/></g></g><g id="Group_110"><g id="Graphic_111"><rect x="586.5" y="1030.2637" width="279" height="43.263736" fill="#692f56"/></g></g><g id="Group_108"><g id="Graphic_109"><path d="M865.1593 1007.0989V1015.6154H586.5V1007.0989l160.45055-46.3297z" fill="#692f56"/></g></g><g id="Group_106"><g id="Graphic_107"><rect x="586.5" y="956" width="279" height="51.0989" fill="#ad688b"/><text transform="translate(591.5 970.5495)" fill="#fff"><tspan font-family="PingFang SC" font-size="16" font-weight="400" fill="#fff" x="102.5" y="17">本地仓库</tspan></text></g></g><g id="Group_104"><g id="Graphic_105"><rect x="586.5" y="1022.4286" width="279" height="42.58242" fill="#ad688b"/></g></g><g id="Group_102"><g id="Graphic_103"><rect x="586.5" y="1081.3626" width="279" height="42.58242" fill="#ad688b"/></g></g><g id="Graphic_101"><rect x="595.35714" y="1031.2857" width="260.94505" height="24.527473" fill="#fff"/><text transform="translate(600.35714 1034.3255)" fill="#000"><tspan font-family="Helvetica Neue" font-size="16" font-weight="400" fill="#000" x="73.91253" y="15">remotes/origin</tspan></text></g><g id="Graphic_100"><rect x="595.35714" y="1090.5604" width="260.94505" height="24.527473" fill="#fff"/><text transform="translate(600.35714 1093.6002)" fill="#000"><tspan font-family="Helvetica Neue" font-size="16" font-weight="400" fill="#000" x="71.23253" y="15">remotes/github</tspan></text></g></g><g id="Graphic_98"><text transform="translate(572.375 1134.4615)" fill="#000"><tspan font-family="Courier New" font-size="16" font-weight="400" fill="#000" x="76.05078" y="13">git push origin</tspan><tspan font-family="Courier New" font-size="16" font-weight="400" fill="#000" x="52.046875" y="31">refs/remotes/github/</tspan><tspan font-family="Courier New" font-size="16" font-weight="400" fill="#000" x="95.25391" y="49">alpha:alpha</tspan></text></g></g><g id="Line_114"><line x1="586.5" y1="1091" x2="443" y2="1090.2315" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-dasharray="8.0,8.0" stroke-width="2"/></g><g id="Line_115"><line x1="870.5" y1="1034.1538" x2="1017.2329" y2="1055.3836" marker-end="url(#FilledArrow_Marker)" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></g></g></g></svg><h2 id=移动中心同步脚本说明>移动中心同步脚本说明<a hidden class=anchor aria-hidden=true href=#移动中心同步脚本说明>#</a></h2><blockquote><p>同步脚本gitlab地址： <a href=http://172.17.0.205/Development/Mobile/tools/all/-/blob/master/scripts/sync-code/syncCode.sh>syncCode.sh</a></p></blockquote><h3 id=用法说明>用法说明<a hidden class=anchor aria-hidden=true href=#用法说明>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>source syncCode.sh
</span></span><span style=display:flex><span>WORKDIR<span style=color:#f92672>=</span>/Users/hanlyjiang/Wksp/work/gitlab/MOA-auto-sync
</span></span><span style=display:flex><span><span style=color:#75715e># 移动端代码同步 </span>
</span></span><span style=display:flex><span>sync_work_repo_branch https://chuanqi900:stgzsz821006@github.com/3930615/moa-release-geo.git $WORKDIR/moa-release-geo-github.git git@172.17.0.205:GeoPanel/MobileCenter/geopanel-android.git 
</span></span><span style=display:flex><span><span style=color:#75715e># 后台代码同步</span>
</span></span><span style=display:flex><span>sync_work_repo_branch https://chuanqi900:stgzsz821006@github.com/3930615/moa-release.git $WORKDIR/moa-release-github.git git@172.17.0.205:GeoPanel/MobileCenter/geopanel-mobile-server.git
</span></span></code></pre></div><p>执行如上同步命令之后，会将从链动github仓库获取的所有分支及tag推送到gitlab仓库；</p><h1 id=geopanel-移动中心-arm镜像制作-成果链接>GeoPanel-移动中心-ARM镜像制作-成果链接<a hidden class=anchor aria-hidden=true href=#geopanel-移动中心-arm镜像制作-成果链接>#</a></h1><p>本节介绍移动中心国产化的构建成果，请阅读以下文章：</p><ul><li><a href=https://shimo.im/docs/0l3NVKX0BgflYN3R/>《移动中心国产化-ARM迁移基本思路》</a></li><li><a href=https://shimo.im/docs/VHgRHrXYq9vQkX3Q/>《移动中心国产化-MOA服务迁移记录》</a></li><li><a href=https://shimo.im/docs/gO3ox1XzJlHlVzqD/>《移动中心国产化-实时音视频服务迁移记录》</a></li></ul><p>相关成果已上传到gitlab仓库的如下分支：</p><ul><li><a href=http://zh-gitlab.geostar.com.cn/GeoPanel/MobileCenter/geopanel-mobile-server/-/tree/arm/0.5.0-dev>arm/0.5.0-dev</a></li><li><a href=http://zh-gitlab.geostar.com.cn/GeoPanel/MobileCenter/geopanel-mobile-server/-/tree/arm/v0.3.0-im>arm/v0.3.0-im</a></li></ul><h1 id=geopanel-移动中心-app相关>GeoPanel-移动中心-APP相关<a hidden class=anchor aria-hidden=true href=#geopanel-移动中心-app相关>#</a></h1><p>本小节介绍移动中心APP相关内容，主要包括如下内容：</p><ul><li>项目仓库介绍</li><li>注意点介绍：主要是我方进行的一些修改，对修改点有所了解，以便后续需要合并代码时减少可能由合并导致的错误。</li></ul><h2 id=项目仓库介绍>项目仓库介绍<a hidden class=anchor aria-hidden=true href=#项目仓库介绍>#</a></h2><h3 id=项目地址>项目地址<a hidden class=anchor aria-hidden=true href=#项目地址>#</a></h3><ul><li>项目仓库地址： http://172.17.0.205/GeoPanel/MobileCenter/geopanel-android</li><li>相关文档：</li></ul><h3 id=仓库分支及tag说明>仓库分支及Tag说明<a hidden class=anchor aria-hidden=true href=#仓库分支及tag说明>#</a></h3><h4 id=分支说明>分支说明<a hidden class=anchor aria-hidden=true href=#分支说明>#</a></h4><p>此仓库同步了链动的代码分支，并新建新的分支对链动代码进行修改，具体分支跟踪关系如下：</p><svg width="834" height="587" viewBox="0 0 834 587" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="移动中心APP分支图" transform="translate(-196.000000, -78.000000)"><g id="export" transform="translate(197.000000, 79.000000)"><g id="Github链动分支"><g id="架构图/带标题栏框"><g id="编组" stroke-linejoin="round"><g id="分组"><rect id="边框栏" stroke="#FF9500" x=".5" y=".5" width="283" height="584"/><rect id="标题栏" fill="#FF9500" x="0" y="0" width="284" height="26"/></g></g><text id="标题" font-family="PingFangSC-Regular, PingFang SC" font-size="16" font-weight="normal" letter-spacing=".0959999995" fill="#FFF"><tspan x="84.8480622" y="17">链动Github仓库</tspan></text></g><g id="分支/直线分支备份-7" transform="translate(20.000000, 499.000000)"><line x1=".603462208" y1="20.5434783" x2="234.508368" y2="20.5434783" id="分支直线" stroke="#979797" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/><text id="分支名称" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="0" y="13.2608696">moa-app-workbench</tspan></text><text id="说明" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="157.85841" y="13.2608696">小应用-工作台</tspan></text></g><g id="分支/直线分支备份-6" transform="translate(20.000000, 434.000000)"><line x1=".603462208" y1="20.5434783" x2="234.508368" y2="20.5434783" id="分支直线" stroke="#979797" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/><text id="分支名称" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="0" y="13.2608696">moa-app-task</tspan></text><text id="说明" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="169.93041" y="13.2608696">小应用-任务</tspan></text></g><g id="分支/直线分支备份-5" transform="translate(20.000000, 369.000000)"><line x1=".603462208" y1="20.5434783" x2="234.508368" y2="20.5434783" id="分支直线" stroke="#979797" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/><text id="分支名称" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="0" y="13.2608696">moa-app-calendar</tspan></text><text id="说明" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="169.93041" y="13.2608696">小应用-日历</tspan></text></g><g id="分支/直线分支备份-4" transform="translate(20.000000, 304.000000)"><line x1=".603462208" y1="20.5434783" x2="234.508368" y2="20.5434783" id="分支直线" stroke="#979797" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/><text id="分支名称" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="0" y="13.2608696">moa-app-appmarket</tspan></text><text id="说明" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="145.78641" y="13.2608696">小应用-应用市场</tspan></text></g><g id="分支/直线分支备份-3" transform="translate(20.000000, 239.000000)"><line x1=".603462208" y1="20.5434783" x2="234.508368" y2="20.5434783" id="分支直线" stroke="#979797" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/><text id="分支名称" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="0" y="13.2608696">moa-app-addressbook</tspan></text><text id="说明" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="157.85841" y="13.2608696">小应用-通讯录</tspan></text></g><g id="分支/直线分支备份-2" transform="translate(20.000000, 174.000000)"><line x1=".603462208" y1="20.5434783" x2="234.508368" y2="20.5434783" id="分支直线" stroke="#979797" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/><text id="分支名称" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="0" y="13.2608696">moa-web-imsdk</tspan></text><text id="说明" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="198.29841" y="13.2608696">imsdk</tspan></text></g><g id="分支/直线分支备份" transform="translate(20.000000, 109.000000)"><line x1=".603462208" y1="20.5434783" x2="234.508368" y2="20.5434783" id="分支直线" stroke="#979797" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/><text id="分支名称" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="0" y="13.2608696">moa-client-android-module</tspan></text><text id="说明" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="174.31041" y="13.2608696">APP库模块</tspan></text></g><g id="分支/直线分支" transform="translate(20.000000, 44.000000)"><line x1=".603462208" y1="20.5434783" x2="234.508368" y2="20.5434783" id="分支直线" stroke="#979797" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/><text id="分支名称" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="0" y="13.2608696">moa-client-android</tspan></text><text id="说明" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="210.52641" y="13.2608696">APP</tspan></text></g></g><g id="GeoStar仓库备份" transform="translate(370.000000, 0.000000)"><g id="架构图/带标题栏框备份"><g id="编组" stroke-linejoin="round"><g id="分组"><rect id="边框栏" stroke="#FF9500" x=".5" y=".5" width="461" height="583"/><rect id="标题栏" fill="#FF9500" x="0" y="0" width="462" height="26"/></g></g><text id="标题" font-family="PingFangSC-Regular, PingFang SC" font-size="16" font-weight="normal" letter-spacing=".0959999995" fill="#FFF"><tspan x="158.956777" y="17">GeoStar Gitlab仓库</tspan></text></g><g id="链动原分支" transform="translate(18.000000, 44.000000)"><g id="分支/直线分支备份-8" transform="translate(0.000000, 455.000000)"><line x1=".595758436" y1="20.5434783" x2="231.514644" y2="20.5434783" id="分支直线" stroke="#979797" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/><text id="分支名称" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="0" y="13.2608696">moa-app-workbench</tspan></text><text id="说明" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="155.172218" y="13.2608696">小应用-工作台</tspan></text></g><g id="分支/直线分支备份-9" transform="translate(0.000000, 390.000000)"><line x1=".595758436" y1="20.5434783" x2="231.514644" y2="20.5434783" id="分支直线" stroke="#979797" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/><text id="分支名称" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="0" y="13.2608696">moa-app-task</tspan></text><text id="说明" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="167.244218" y="13.2608696">小应用-任务</tspan></text></g><g id="分支/直线分支备份-10" transform="translate(0.000000, 325.000000)"><line x1=".595758436" y1="20.5434783" x2="231.514644" y2="20.5434783" id="分支直线" stroke="#979797" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/><text id="分支名称" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="0" y="13.2608696">moa-app-calendar</tspan></text><text id="说明" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="167.244218" y="13.2608696">小应用-日历</tspan></text></g><g id="分支/直线分支备份-11" transform="translate(0.000000, 260.000000)"><line x1=".595758436" y1="20.5434783" x2="231.514644" y2="20.5434783" id="分支直线" stroke="#979797" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/><text id="分支名称" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="0" y="13.2608696">moa-app-appmarket</tspan></text><text id="说明" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="143.100218" y="13.2608696">小应用-应用市场</tspan></text></g><g id="分支/直线分支备份-12" transform="translate(0.000000, 195.000000)"><line x1=".595758436" y1="20.5434783" x2="231.514644" y2="20.5434783" id="分支直线" stroke="#979797" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/><text id="分支名称" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="0" y="13.2608696">moa-app-addressbook</tspan></text><text id="说明" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="155.172218" y="13.2608696">小应用-通讯录</tspan></text></g><g id="分支/直线分支备份-13" transform="translate(0.000000, 130.000000)"><line x1=".595758436" y1="20.5434783" x2="231.514644" y2="20.5434783" id="分支直线" stroke="#979797" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/><text id="分支名称" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="0" y="13.2608696">moa-web-imsdk</tspan></text><text id="说明" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="195.612218" y="13.2608696">imsdk</tspan></text></g><g id="分支/直线分支备份-14" transform="translate(0.000000, 65.000000)"><line x1=".595758436" y1="20.5434783" x2="231.514644" y2="20.5434783" id="分支直线" stroke="#979797" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/><text id="分支名称" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="0" y="13.2608696">moa-client-android-module</tspan></text><text id="说明" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="171.624218" y="13.2608696">APP库模块</tspan></text></g><g id="分支/直线分支备份-15"><line x1=".595758436" y1="20.5434783" x2="231.514644" y2="20.5434783" id="分支直线" stroke="#979797" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/><text id="分支名称" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="0" y="13.2608696">moa-client-android</tspan></text><text id="说明" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="207.840218" y="13.2608696">APP</tspan></text></g></g><g id="编组" transform="translate(115.000000, 67.500000)"><path d="M-568434189e-22.0V7.33908739C-522101777e-22 16.1622639 7.14257577 23.3201537 15.965732 23.3390507L324.567554 24" id="路径-2" stroke="#F7B500" stroke-width="5" stroke-linecap="round"/><text id="geo-client-android/m" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="172.132" y="16.5">geo-client-android/master</tspan></text></g><g id="分支/派生备份" transform="translate(115.000000, 129.500000)"><path d="M-568434189e-22.0V7.33908739C-522101777e-22 16.1622639 7.14257577 23.3201537 15.965732 23.3390507L324.567554 24" id="路径-2" stroke="#F7B500" stroke-width="5" stroke-linecap="round"/><text id="geo-client-android/m" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="93.772" y="16.5">geo-moa-client-android-module/master</tspan></text></g><g id="分支/派生备份-2" transform="translate(115.000000, 196.500000)"><path d="M-568434189e-22.0V7.33908739C-522101777e-22 16.1622639 7.14257577 23.3201537 15.965732 23.3390507L324.567554 24" id="路径-2" stroke="#F7B500" stroke-width="5" stroke-linecap="round"/><text id="geo-client-android/m" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="161.584" y="16.5">geo-moa-web-imsdk/master</tspan></text></g><g id="分支/派生备份-3" transform="translate(118.000000, 259.500000)"><path d="M-568434189e-22.0V7.33908739C-522101777e-22 16.1622639 7.14257577 23.3201537 15.965732 23.3390507L324.567554 24" id="路径-2" stroke="#F7B500" stroke-width="5" stroke-linecap="round"/><text id="geo-client-android/m" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="155.548" y="16.5">geo-app-addressbook/master</tspan></text></g><g id="分支/派生备份-4" transform="translate(115.000000, 326.500000)"><path d="M-568434189e-22.0V7.33908739C-522101777e-22 16.1622639 7.14257577 23.3201537 15.965732 23.3390507L324.567554 24" id="路径-2" stroke="#F7B500" stroke-width="5" stroke-linecap="round"/><text id="geo-client-android/m" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="166.204" y="16.5">geo-app-appmarket/master</tspan></text></g><g id="分支/派生备份-5" transform="translate(115.000000, 393.500000)"><path d="M-568434189e-22.0V7.33908739C-522101777e-22 16.1622639 7.14257577 23.3201537 15.965732 23.3390507L324.567554 24" id="路径-2" stroke="#F7B500" stroke-width="5" stroke-linecap="round"/><text id="geo-client-android/m" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="144.148" y="16.5">geo-app-calendar/nskst/master</tspan></text></g><g id="分支/派生备份-6" transform="translate(115.000000, 456.500000)"><path d="M-568434189e-22.0V7.33908739C-522101777e-22 16.1622639 7.14257577 23.3201537 15.965732 23.3390507L324.567554 24" id="路径-2" stroke="#F7B500" stroke-width="5" stroke-linecap="round"/><text id="geo-client-android/m" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="171.112" y="16.5">geo-app-task/nskst/master</tspan></text></g><g id="分支/派生备份-7" transform="translate(115.000000, 519.500000)"><path d="M-568434189e-22.0V7.33908739C-522101777e-22 16.1622639 7.14257577 23.3201537 15.965732 23.3390507L324.567554 24" id="路径-2" stroke="#F7B500" stroke-width="5" stroke-linecap="round"/><text id="geo-client-android/m" font-family="NotoSerifCJKsc-Regular, Noto Serif CJK SC" font-size="12" font-weight="normal" letter-spacing=".0719999996" fill="#000" fill-opacity=".85"><tspan x="128.956" y="16.5">geo-app-workbench/nskst/master</tspan></text></g></g><g id="连接线" transform="translate(259.000000, 63.000000)" fill="#7A7A7A" fill-rule="nonzero"><path id="直线-2" d="M.188059701-4C2.5043073-4 4.41182503-2.25001939 4.6605859-.851613636e-4L9.6880597.0V1L4.66051705 1.00070744C4.41147331 3.25034205 2.50409376 5 .188059701 5-2.29722167 5-4.3119403 2.98528137-4.3119403.5S-2.29722167-4 .188059701-4zM117.31194-4l9 4.5-9 4.5L117.311 1H113.68806V0H117.311L117.31194-4zM19.6880597.0V1h-6V0h6zm10 0V1h-6V0h6zm10 0V1h-6V0h6zm10 0V1h-6V0h6zm10 0V1h-6V0h6zm10 0V1h-6V0h6zm10 0V1h-6V0h6zm10 0V1h-6V0h6zm10 0V1h-6V0h6zM109.68806.0V1h-6V0h6z"/><path id="直线-2备份" d="M.5 61c2.31637876.0 4.22398135 1.7501788 4.47256844 4.000297L10 65v1L4.97245735 66.0007074C4.7234136 68.2503421 2.81603406 70 .5 70-1.98528137 70-4 67.9852814-4 65.5-4 63.0147186-1.98528137 61 .5 61zm116.81194.0 9 4.5-9 4.5L117.311 66H114V65H117.311L117.31194 61zM20 65v1H14V65h6zm10 0v1H24V65h6zm10 0v1H34V65h6zm10 0v1H44V65h6zm10 0v1H54V65h6zm10 0v1H64V65h6zm10 0v1H74V65h6zm10 0v1H84V65h6zm10 0v1H94V65h6zm10 0v1h-6V65h6z"/><path id="直线-2备份-2" d="M.5 127C2.81637876 127 4.72398135 128.750179 4.97256844 131.000297L10 131v1L4.97245735 132.000707C4.7234136 134.250342 2.81603406 136 .5 136-1.98528137 136-4 133.985281-4 131.5S-1.98528137 127 .5 127zm116.81194.0 9 4.5-9 4.5L117.311 132H114v-1H117.311L117.31194 127zM20 131v1H14v-1h6zm10 0v1H24v-1h6zm10 0v1H34v-1h6zm10 0v1H44v-1h6zm10 0v1H54v-1h6zm10 0v1H64v-1h6zm10 0v1H74v-1h6zm10 0v1H84v-1h6zm10 0v1H94v-1h6zm10 0v1h-6v-1h6z"/><path id="直线-2备份-3" d="M1.5 191C3.81637876 191 5.72398135 192.750179 5.97256844 195.000297L11 195v1L5.97245735 196.000707C5.7234136 198.250342 3.81603406 2e2 1.5 2e2-.985281374 2e2-3 197.985281-3 195.5S-.985281374 191 1.5 191zm115.81194.0 9 4.5-9 4.5L117.311 196H115v-1H117.311L117.31194 191zM21 195v1H15v-1h6zm10 0v1H25v-1h6zm10 0v1H35v-1h6zm10 0v1H45v-1h6zm10 0v1H55v-1h6zm10 0v1H65v-1h6zm10 0v1H75v-1h6zm10 0v1H85v-1h6zm10 0v1H95v-1h6zm10 0v1h-6v-1h6z"/><path id="直线-2备份-4" d="M.482071855 257.000036C2.79821908 256.990808 4.7126401 258.733051 4.97047097 260.981861L9.99586739 260.962164 9.99985142 261.962156 4.97441669 261.982885C4.73433754 264.233494 2.83394382 265.990737.517928145 265.999964-1.96733351 266.009866-3.99006285 264.00319-3.99996429 261.517928-4.00986573 259.032666-2.00318979 257.009937.482071855 257.000036zM117.482139 256.5339 126.499996 260.998008l-8.982 4.535821L117.501 261.533 114.499022 261.545825 113.999026 261.547817 113.995042 260.547825 114.495038 260.545833 117.498 260.533 117.482139 256.5339zM19.995788 260.922324 19.9997721 261.922316 13.9998197 261.94622 13.9958356 260.946228 19.995788 260.922324zM29.9957087 260.882483 29.9996927 261.882475 23.9997403 261.90638 23.9957563 260.906387 29.9957087 260.882483zM39.9956293 260.842643 39.9996133 261.842635 33.9996609 261.866539 33.9956769 260.866547 39.9956293 260.842643zM49.9955499 260.802803 49.999534 261.802795 43.9995816 261.826699 43.9955976 260.826707 49.9955499 260.802803zM59.9954706 260.762962 59.9994546 261.762954 53.9995022 261.786859 53.9955182 260.786866 59.9954706 260.762962zM69.9953912 260.723122 69.9993752 261.723114 63.9994229 261.747018 63.9954388 260.747026 69.9953912 260.723122zM79.9953118 260.683282 79.9992959 261.683274 73.9993435 261.707178 73.9953595 260.707186 79.9953118 260.683282zM89.9952325 260.643441 89.9992165 261.643433 83.9992641 261.667338 83.9952801 260.667346 89.9952325 260.643441zM99.9951531 260.603601 99.9991372 261.603593 93.9991848 261.627497 93.9952007 260.627505 99.9951531 260.603601zM109.995074 260.563761 109.999058 261.563753 103.999105 261.587657 103.995121 260.587665 109.995074 260.563761z"/><path id="直线-2备份-5" d="M1.48192786 323.000036C3.79794324 322.990735 5.71233408 324.732719 5.97041043 326.981335L10.9958338 326.96186 10.9998499 327.961852 5.97453919 327.981737C5.73499066 330.232835 3.83443222 331.990661 1.51807214 331.999964-.967189189 332.009945-2.98998274 330.003333-2.99996371 327.518072-3.00994468 325.032811-1.00333348 323.010017 1.48192786 323.000036zM117.481996 322.534173l9.018 4.463819L117.518141 331.5341 117.502 327.534 115.499007 327.542177 114.999011 327.544185 114.994995 326.544193 115.494991 326.542185 117.497 326.534 117.481996 322.534173zM20.9957532 326.9217 20.9997692 327.921692 14.9998176 327.945788 14.9958016 326.945796 20.9957532 326.9217zM30.9956726 326.881539 30.9996886 327.881531 24.999737 327.905628 24.9957209 326.905636 30.9956726 326.881539zM40.9955919 326.841379 40.999608 327.841371 34.9996563 327.865467 34.9956403 326.865475 40.9955919 326.841379zM50.9955113 326.801219 50.9995273 327.801211 44.9995757 327.825307 44.9955597 326.825315 50.9955113 326.801219zM60.9954306 326.761058 60.9994467 327.76105 54.9994951 327.785147 54.995479 326.785155 60.9954306 326.761058zM70.99535 326.720898 70.999366 327.72089 64.9994144 327.744986 64.9953984 326.744994 70.99535 326.720898zM80.9952693 326.680738 80.9992854 327.68073 74.9993338 327.704826 74.9953177 326.704834 80.9952693 326.680738zM90.9951887 326.640578 90.9992047 327.640569 84.9992531 327.664666 84.9952371 326.664674 90.9951887 326.640578zM100.995108 326.600417 100.999124 327.600409 94.9991725 327.624505 94.9951564 326.624513 100.995108 326.600417zM110.995027 326.560257 110.999043 327.560249 104.999092 327.584345 104.995076 326.584353 110.995027 326.560257z"/><path id="直线-2备份-6" d="M1.5 387C3.81637876 387 5.72398135 388.750179 5.97256844 391.000297L11 391v1L5.97245735 392.000707C5.7234136 394.250342 3.81603406 396 1.5 396-.985281374 396-3 393.985281-3 391.5S-.985281374 387 1.5 387zm115.81194.0 9 4.5-9 4.5L117.311 392H115v-1H117.311L117.31194 387zM21 391v1H15v-1h6zm10 0v1H25v-1h6zm10 0v1H35v-1h6zm10 0v1H45v-1h6zm10 0v1H55v-1h6zm10 0v1H65v-1h6zm10 0v1H75v-1h6zm10 0v1H85v-1h6zm10 0v1H95v-1h6zm10 0v1h-6v-1h6z"/><path id="直线-2备份-7" d="M0 451C2.31637876 451 4.22398135 452.750179 4.47256844 455.000297L9.5 455v1L4.47245735 456.000707C4.2234136 458.250342 2.31603406 460 0 460-2.48528137 460-4.5 457.985281-4.5 455.5S-2.48528137 451 0 451zm117.31194.0 9 4.5-9 4.5L117.311 456H113.5v-1H117.311L117.31194 451zM19.5 455v1h-6v-1h6zm10 0v1h-6v-1h6zm10 0v1h-6v-1h6zm10 0v1h-6v-1h6zm10 0v1h-6v-1h6zm10 0v1h-6v-1h6zm10 0v1h-6v-1h6zm10 0v1h-6v-1h6zm10 0v1h-6v-1h6zm10 0v1h-6v-1h6z"/></g></g></g></g></svg><p>由上面图可以看出，链动在一个仓库中通过分支分别存放了移动端Android源码，移动端APP库源码，imsdk及示例源码，还有5个基础H5小应用。</p><ul><li>首先，我们完全同步链动的几个分支（<code>moa-xxx</code>）到我们的gitlab仓库；</li><li>然后，我们基于链动的几个分支，分别拉取了我们自己的分支进行修改，命名为 <code>geo-xxxx</code></li></ul><h4 id=tag管理>Tag管理<a hidden class=anchor aria-hidden=true href=#tag管理>#</a></h4><p>由于我们在一个仓库中放置了若干个模块，通过分支区分，在建立tag时，也需要相应的区分；另外由于链动也会在仓库中提交tag，所以我们需要对tag的命名作一定的约束，一般tag应将分支名称作为前缀，如：</p><ul><li><a href=http://172.17.0.205/GeoPanel/MobileCenter/geopanel-android/-/releases/geo-client-android-v1.2.22>geo-client-android-v1.2.22</a>: 为android端的最新版本tag</li><li><a href=http://172.17.0.205/GeoPanel/MobileCenter/geopanel-android/-/releases/geo-app-appmarket-v1.0.2>geo-app-appmarket-v1.0.2</a>： 为小应用的最新版本tag</li></ul><p><strong>Android端版本tag说明</strong></p><p>Android端代码会对应多个地区的项目，如果为每个地区单独区分版本号，会造成主线版本管理混乱。</p><p>APP的版本号不与任何项目进行关联，打包时不论针对哪个项目/产品发包，只要发布了Release版本，就将版本号递增。如下图所示：</p><ul><li>南山块事通发布版本时，版本号为 1.2.19</li><li>洪山管理通时则将版本号设置为 1.2.20</li></ul><p><img alt=image-20210406160652462 loading=lazy src=https://gitee.com/hanlyjiang/image-repo/raw/master/imgs/20210406160652.png></p><h2 id=重要修改说明>重要修改说明<a hidden class=anchor aria-hidden=true href=#重要修改说明>#</a></h2><p>前面说过，我们的代码从链动分支拉取新分支进行了一些修改，这里主要介绍一些重要的修改点：</p><ol><li><strong>打包配置逻辑调整（包括包名，签名，第三方服务账号的key等的修改）</strong></li><li><strong>UI界面样式调整；</strong></li><li><strong>迁移到AndroidX；</strong></li><li><strong>扩展cordova插件；</strong></li></ol><h3 id=打包配置修改>打包配置修改<a hidden class=anchor aria-hidden=true href=#打包配置修改>#</a></h3><h4 id=不同项目的包配置区分>不同项目的包配置区分<a hidden class=anchor aria-hidden=true href=#不同项目的包配置区分>#</a></h4><p>链动提供的版本中，包名为链动的包名，而我们需要将一个包应用到不同的项目之中，故需要对包名进行区分，同时还有对应的百度地图及三方推送等的账号也需要进行区分，故提取了一套配置方式，为了减少对链动原有代码文件的修改，我们的配置主要位于如下新增加的文件及目录中：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>android
</span></span><span style=display:flex><span>├── dist-config  -  不同项目的打包配置定义
</span></span><span style=display:flex><span>│   └── moa-moa-geo-third-share.gradle
</span></span><span style=display:flex><span>│   ├── hongshan_sgt_debug_wuhan.gradle
</span></span><span style=display:flex><span>│   ├── hongshan_sgt_release.gradle
</span></span><span style=display:flex><span>│   ├── jiujiang_egt_debug_wuhan.gradle
</span></span><span style=display:flex><span>│   ├── jiujiang_egt_official.gradle
</span></span><span style=display:flex><span>│   ├── ld_test.gradle
</span></span><span style=display:flex><span>│   ├── luohu_kst_official.gradle
</span></span><span style=display:flex><span>│   ├── moa_jiujiang_wuhan_fixed.gradle
</span></span><span style=display:flex><span>│   ├── moa_wxtest_wuhan_195.gradle
</span></span><span style=display:flex><span>│   ├── mobile_center_aliyun.gradle
</span></span><span style=display:flex><span>│   ├── nskst_official.gradle
</span></span><span style=display:flex><span>│   ├── nskst_official_demonstration.gradle
</span></span><span style=display:flex><span>│   ├── nskst_official_pre_release.gradle
</span></span><span style=display:flex><span>│   ├── nskst_test_internet_shenzhen.gradle
</span></span><span style=display:flex><span>│   ├── nskst_test_shenzhen.gradle
</span></span><span style=display:flex><span>│   ├── nskst_test_wuhan_fixed.gradle
</span></span><span style=display:flex><span>│   ├── nskst_test_wuhan_jianghang.gradle
</span></span><span style=display:flex><span>│   ├── nskst_test_wuhan_open.gradle
</span></span><span style=display:flex><span>│   ├── nskst_test_wuhan_private.gradle
</span></span><span style=display:flex><span>│   ├── nskst_test_wuhan_sr.gradle
</span></span><span style=display:flex><span>│   ├── nskst_test_wuhan_wsr.gradle
</span></span><span style=display:flex><span>│   ├── rongjiang_kst_official.gradle
</span></span><span style=display:flex><span>│   ├── shenzhen_shi_official.gradle
</span></span><span style=display:flex><span>│   └── template.gradle
</span></span><span style=display:flex><span>├── dist-config.gradle - 定义配置dist-config目录中配置的加载逻辑 
</span></span></code></pre></div><ul><li><p>引入dist-config.gradle：(platforms/android/app/build.gradle)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span>apply from: <span style=color:#e6db74>&#39;../dist-config.gradle&#39;</span>
</span></span></code></pre></div></li></ul><blockquote><p>具体的每个地方的配置，由于已经有接触并配置过，不再赘述</p></blockquote><h4 id=签名配置>签名配置<a hidden class=anchor aria-hidden=true href=#签名配置>#</a></h4><ul><li><p>设置debug和release相同签名: (platforms/android/app/build.gradle)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span> buildTypes <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        release <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            minifyEnabled <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>            zipAlignEnabled <span style=color:#66d9ef>true</span>  <span style=color:#75715e>//压缩优化
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            shrinkResources <span style=color:#66d9ef>true</span>  <span style=color:#75715e>//移出无用资源
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            proguardFiles <span style=color:#a6e22e>getDefaultProguardFile</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;proguard-android.txt&#34;</span><span style=color:#f92672>),</span> <span style=color:#e6db74>&#34;proguard-rules.pro&#34;</span>
</span></span><span style=display:flex><span>            signingConfig signingConfigs<span style=color:#f92672>.</span><span style=color:#a6e22e>moasign</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        debug <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            signingConfig signingConfigs<span style=color:#f92672>.</span><span style=color:#a6e22e>moasign</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div></li><li><p>签名信息替换：(platforms/android/gradle.properties)(链动未提供其签名信息，所以我们自己生成了签名并替换链动的配置)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span> keyAlias
</span></span><span style=display:flex><span>MOA_RELEASE_KEY_ALIAS<span style=color:#f92672>=</span>geostar<span style=color:#f92672>-</span>moa
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span>keyPassword
</span></span><span style=display:flex><span>MOA_RELEASE_KEY_PASSWORD<span style=color:#f92672>=</span>a7cbf71f1019635fc794df0e1abc3e79
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span>storeFile
</span></span><span style=display:flex><span>MOA_RELEASE_STORE_FILE<span style=color:#f92672>=../</span>geostar<span style=color:#f92672>.</span><span style=color:#a6e22e>moa</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jks</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span>storePassword
</span></span><span style=display:flex><span>MOA_RELEASE_STORE_PASSWORD<span style=color:#f92672>=</span><span style=color:#ae81ff>9</span>b1d0e07ee4bdb03e2249bf57f6974a4
</span></span></code></pre></div></li></ul><h3 id=迁移到androidx>迁移到AndroidX<a hidden class=anchor aria-hidden=true href=#迁移到androidx>#</a></h3><p>google最初发布了support库（如：v4，v7，design），之前很多控件都是位于这些库中的（如：RecyclerView，CardView等），后统一为androidx的库，旧的support库不再维护，为了能够避免后续开发功能时引入的某些库无法使用，故将项目其迁移到androidx。</p><p>迁移androidx的修改可以查看Gitlab上的提交：<a href=http://172.17.0.205/GeoPanel/MobileCenter/geopanel-android/-/commit/adc773ca06c807ec0cb271fb900e72bff48ae5ee>migrate： 迁移到AndroidX (adc773ca) · 提交 · GeoPanel / 移动中心 / 移动平台-Android端 · GitLab</a></p><p>迁移使用androidstudio提供的迁移命令，会自动将项目中的原先使用support库的部分替换为对应的androidx库的用法，同时在编译时也会对依赖库中jar里面使用的support库进行处理。</p><h3 id=ui界面样式调整>UI界面样式调整<a hidden class=anchor aria-hidden=true href=#ui界面样式调整>#</a></h3><p>在MOA最初应用到南山项目时，按照南山的UI界面进行了一波界面调整。主要包括：</p><ul><li>登录界面替换；</li><li>所有native页面的顶部样式；</li><li>基础小应用的顶部样式及界面样式；</li></ul><h3 id=扩展cordova插件>扩展cordova插件<a hidden class=anchor aria-hidden=true href=#扩展cordova插件>#</a></h3><p>APP整体的架构如下：</p><svg width="423" height="345" viewBox="0 0 423 345" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="移动中心APP架构" transform="translate(-219.000000, -162.000000)"><g id="架构图/带标题栏框" transform="translate(219.000000, 429.000000)"><g id="分组"><rect id="边框栏" stroke="#FF9500" x=".5" y=".5" width="422" height="77"/><rect id="标题栏" fill="#FF9500" x="0" y="0" width="423" height="26"/></g><text id="标题" font-family="PingFangSC-Regular, PingFang SC" font-size="16" font-weight="normal" letter-spacing=".0959999995" fill="#FFF"><tspan x="179.034036" y="17">系统能力</tspan></text></g><g id="架构图/带标题栏框备份" transform="translate(219.000000, 340.000000)"><g id="分组"><rect id="边框栏" stroke="#FF9500" x=".5" y=".5" width="422" height="77"/><rect id="标题栏" fill="#FF9500" x="0" y="0" width="423" height="26"/></g><text id="标题" font-family="PingFangSC-Regular, PingFang SC" font-size="16" font-weight="normal" letter-spacing=".0959999995" fill="#FFF"><tspan x="179.458036" y="17">APP能力</tspan></text></g><g id="架构图/带标题栏框备份-2" transform="translate(219.000000, 251.000000)"><g id="分组"><rect id="边框栏" stroke="#FF9500" x=".5" y=".5" width="422" height="77"/><rect id="标题栏" fill="#FF9500" x="0" y="0" width="423" height="26"/></g><text id="标题" font-family="PingFangSC-Regular, PingFang SC" font-size="16" font-weight="normal" letter-spacing=".0959999995" fill="#FFF"><tspan x="149.010036" y="17">cordova插件框架</tspan></text></g><g id="架构图/带标题栏框备份-3" transform="translate(219.000000, 162.000000)"><g id="分组"><rect id="边框栏" stroke="#FF9500" x=".5" y=".5" width="422" height="77"/><rect id="标题栏" fill="#FF9500" x="0" y="0" width="423" height="26"/></g><text id="标题" font-family="PingFangSC-Regular, PingFang SC" font-size="16" font-weight="normal" letter-spacing=".0959999995" fill="#FFF"><tspan x="176.426036" y="17">H5小应用</tspan></text></g><g id="架构图/单个模块" transform="translate(228.000000, 468.000000)"><rect id="矩形" stroke="#C0C0C0" fill="#EEE" x=".5" y=".5" width="52.814433" height="23"/><text id="模块名称" font-family="PingFangSC-Semibold, PingFang SC" font-size="11" font-weight="500" letter-spacing=".121000004" fill="#151515" fill-opacity=".88378138"><tspan x="15.9717835" y="12">相机</tspan></text></g><g id="架构图/单个模块备份-6" transform="translate(228.000000, 379.000000)"><rect id="矩形" stroke="#C0C0C0" fill="#EEE" x=".5" y=".5" width="52.814433" height="23"/><text id="模块名称" font-family="PingFangSC-Semibold, PingFang SC" font-size="11" font-weight="500" letter-spacing=".121000004" fill="#151515" fill-opacity=".88378138"><tspan x="10.4112835" y="12">通讯录</tspan></text></g><g id="架构图/单个模块备份-6" transform="translate(228.000000, 201.000000)"><rect id="矩形" stroke="#C0C0C0" fill="#EEE" x=".5" y=".5" width="52.814433" height="23"/><text id="模块名称" font-family="PingFangSC-Semibold, PingFang SC" font-size="11" font-weight="500" letter-spacing=".121000004" fill="#151515" fill-opacity=".88378138"><tspan x="10.4112835" y="12">通讯录</tspan></text></g><g id="架构图/单个模块备份-16" transform="translate(294.000000, 201.000000)"><rect id="矩形" stroke="#C0C0C0" fill="#EEE" x=".5" y=".5" width="52.814433" height="23"/><text id="模块名称" font-family="PingFangSC-Semibold, PingFang SC" font-size="11" font-weight="500" letter-spacing=".121000004" fill="#151515" fill-opacity=".88378138"><tspan x="15.9717835" y="12">日程</tspan></text></g><g id="架构图/单个模块备份-17" transform="translate(360.000000, 201.000000)"><rect id="矩形" stroke="#C0C0C0" fill="#EEE" x=".5" y=".5" width="52.814433" height="23"/><text id="模块名称" font-family="PingFangSC-Semibold, PingFang SC" font-size="11" font-weight="500" letter-spacing=".121000004" fill="#151515" fill-opacity=".88378138"><tspan x="15.9717835" y="12">任务</tspan></text></g><g id="架构图/单个模块备份-18" transform="translate(426.000000, 201.000000)"><rect id="矩形" stroke="#C0C0C0" fill="#EEE" x=".5" y=".5" width="52.814433" height="23"/><text id="模块名称" font-family="PingFangSC-Semibold, PingFang SC" font-size="11" font-weight="500" letter-spacing=".121000004" fill="#151515" fill-opacity=".88378138"><tspan x="10.4112835" y="12">工作台</tspan></text></g><g id="架构图/单个模块备份-12" transform="translate(228.000000, 290.000000)"><rect id="矩形" stroke="#C0C0C0" fill="#EEE" x=".5" y=".5" width="402.608247" height="23"/><text id="模块名称" font-family="PingFangSC-Semibold, PingFang SC" font-size="11" font-weight="500" letter-spacing=".121000004" fill="#151515" fill-opacity=".88378138"><tspan x="66.7353762" y="12">将系统能力及APP能力以JS接口的方式暴露给H5小应用</tspan></text></g><g id="架构图/单个模块备份-7" transform="translate(294.000000, 379.000000)"><rect id="矩形" stroke="#C0C0C0" fill="#EEE" x=".5" y=".5" width="52.814433" height="23"/><text id="模块名称" font-family="PingFangSC-Semibold, PingFang SC" font-size="11" font-weight="500" letter-spacing=".121000004" fill="#151515" fill-opacity=".88378138"><tspan x="15.9717835" y="12">消息</tspan></text></g><g id="架构图/单个模块备份-14" transform="translate(491.000000, 201.000000)"><rect id="矩形" stroke="#C0C0C0" fill="#EEE" x=".5" y=".5" width="52.814433" height="23"/><text id="模块名称" font-family="PingFangSC-Semibold, PingFang SC" font-size="11" font-weight="500" letter-spacing=".121000004" fill="#151515" fill-opacity=".88378138"><tspan x="4.8507835" y="12">应用市场</tspan></text></g><g id="架构图/单个模块备份-8" transform="translate(360.000000, 379.000000)"><rect id="矩形" stroke="#C0C0C0" fill="#EEE" x=".5" y=".5" width="52.814433" height="23"/><text id="模块名称" font-family="PingFangSC-Semibold, PingFang SC" font-size="11" font-weight="500" letter-spacing=".121000004" fill="#151515" fill-opacity=".88378138"><tspan x="4.8507835" y="12">镜像管理</tspan></text></g><g id="架构图/单个模块备份-15" transform="translate(558.000000, 201.000000)"><rect id="矩形" stroke="#C0C0C0" fill="#EEE" x=".5" y=".5" width="73.742268" height="23"/><text id="模块名称" font-family="PingFangSC-Semibold, PingFang SC" font-size="11" font-weight="500" letter-spacing=".121000004" fill="#151515" fill-opacity=".88378138"><tspan x="9.82636597" y="12">其他小应用</tspan></text></g><g id="架构图/单个模块备份-9" transform="translate(426.000000, 379.000000)"><rect id="矩形" stroke="#C0C0C0" fill="#EEE" x=".5" y=".5" width="69.7560137" height="23"/><text id="模块名称" font-family="PingFangSC-Semibold, PingFang SC" font-size="11" font-weight="500" letter-spacing=".121000004" fill="#151515" fill-opacity=".88378138"><tspan x="7.81949312" y="12">数据库存储</tspan></text></g><g id="架构图/单个模块备份-10" transform="translate(509.000000, 379.000000)"><rect id="矩形" stroke="#C0C0C0" fill="#EEE" x=".5" y=".5" width="69.7560137" height="23"/><text id="模块名称" font-family="PingFangSC-Semibold, PingFang SC" font-size="11" font-weight="500" letter-spacing=".121000004" fill="#151515" fill-opacity=".88378138"><tspan x="13.3799931" y="12">文件存储</tspan></text></g><g id="架构图/单个模块备份-11" transform="translate(592.000000, 379.000000)"><rect id="矩形" stroke="#C0C0C0" fill="#EEE" x=".5" y=".5" width="39.8591065" height="23"/><text id="模块名称" font-family="PingFangSC-Semibold, PingFang SC" font-size="11" font-weight="500" letter-spacing=".121000004" fill="#151515" fill-opacity=".88378138"><tspan x="9.44944673" y="12">其他</tspan></text></g><g id="架构图/单个模块备份" transform="translate(294.000000, 468.000000)"><rect id="矩形" stroke="#C0C0C0" fill="#EEE" x=".5" y=".5" width="52.814433" height="23"/><text id="模块名称" font-family="PingFangSC-Semibold, PingFang SC" font-size="11" font-weight="500" letter-spacing=".121000004" fill="#151515" fill-opacity=".88378138"><tspan x="15.9717835" y="12">文件</tspan></text></g><g id="架构图/单个模块备份-2" transform="translate(360.000000, 468.000000)"><rect id="矩形" stroke="#C0C0C0" fill="#EEE" x=".5" y=".5" width="69.7560137" height="23"/><text id="模块名称" font-family="PingFangSC-Semibold, PingFang SC" font-size="11" font-weight="500" letter-spacing=".121000004" fill="#151515" fill-opacity=".88378138"><tspan x="7.81949312" y="12">方向传感器</tspan></text></g><g id="架构图/单个模块备份-3" transform="translate(443.000000, 468.000000)"><rect id="矩形" stroke="#C0C0C0" fill="#EEE" x=".5" y=".5" width="52.814433" height="23"/><text id="模块名称" font-family="PingFangSC-Semibold, PingFang SC" font-size="11" font-weight="500" letter-spacing=".121000004" fill="#151515" fill-opacity=".88378138"><tspan x="15.5702835" y="12">GPS</tspan></text></g><g id="架构图/单个模块备份-4" transform="translate(509.000000, 468.000000)"><rect id="矩形" stroke="#C0C0C0" fill="#EEE" x=".5" y=".5" width="60.7869416" height="23"/><text id="模块名称" font-family="PingFangSC-Semibold, PingFang SC" font-size="11" font-weight="500" letter-spacing=".121000004" fill="#151515" fill-opacity=".88378138"><tspan x="8.8645292" y="12">网络请求</tspan></text></g><g id="架构图/单个模块备份-5" transform="translate(583.000000, 468.000000)"><rect id="矩形" stroke="#C0C0C0" fill="#EEE" x=".5" y=".5" width="48.8281787" height="23"/><text id="模块名称" font-family="PingFangSC-Semibold, PingFang SC" font-size="11" font-weight="500" letter-spacing=".121000004" fill="#151515" fill-opacity=".88378138"><tspan x="13.9649106" y="12">其他</tspan></text></g></g></g></svg><p>业务的开发主要以H5开发为主，为此APP需要将原生的能力提供为JS的API，链动提供了很多API接口，不过后续发现部分接口有BUG，或者项目上有新的需求，为此我们对cordova插件做了一些修改及扩展，主要包括如下内容：</p><ul><li><a href=http://172.17.0.208:12345/moa-doc/api/barcode.html>二维码扫描</a>功能扩展，支持更多自定义选项</li><li><a href=http://172.17.0.208:12345/moa-doc/api/private-settings.html>设置</a>功能扩展，添加若干设置项API，包括清除IM消息，打开消息设置界面等</li><li><a href=http://172.17.0.208:12345/moa-doc/api/media.html#app-video-getvideo>拍摄视频限制时长，视频选择添加时长及大小限制</a></li><li><a href=http://172.17.0.208:12345/moa-doc/api/photo.html#app-picture-camera>拍照支持添加水印</a></li><li><a href=http://172.17.0.208:12345/moa-doc/api/filebrowser.html#%E6%96%87%E4%BB%B6%E6%B5%8F%E8%A7%88%E5%99%A8>增加附件查看接口</a></li><li><a href=http://172.17.0.208:12345/moa-doc/api/private-settings.html#app-settings-opengestureunlocksetting-%E6%89%93%E5%BC%80%E5%86%85%E7%BD%AE%E7%9A%84%E6%89%8B%E5%8A%BF%E8%A7%A3%E9%94%81%E8%AE%BE%E7%BD%AE%E9%A1%B5%E9%9D%A2>添加手势密码保护相关设置</a></li><li><a href=http://172.17.0.208:12345/moa-doc/api/third-share.html#%E5%88%86%E4%BA%AB%E6%8E%A5%E5%8F%A3-app-share>添加第三方分享接口</a></li><li><a href=http://172.17.0.208:12345/moa-doc/api/third-share.html#%E6%89%93%E5%BC%80%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F-app-weixin-openminiprogram>添加打开微信小程序接口</a></li><li><a href=http://172.17.0.208:12345/moa-doc/api/private-settings.html>添加启用引导页面的接口</a></li></ul><p>我方添加的接口都在 <code>cd plugins_dev/repo/cordova-plugin-moa-geo-app </code>目录中，具体细节也可以在git log中筛选 “H5”，或者针对此目录相关的文件查看历史修改记录，定位具体的commit进行了解。</p><p>关于插件开发的方式，之前已有接触，不在赘述，仅整理一些文档：</p><ul><li><a href=https://shimo.im/docs/XRkgJOPwzmtrFbqM/>https://shimo.im/docs/XRkgJOPwzmtrFbqM/</a> 《Cordova相关-README》，可复制链接后用石墨文档 App 或小程序打开</li><li><a href=https://shimo.im/docs/ne3VVlGLWQf8FB3b/>https://shimo.im/docs/ne3VVlGLWQf8FB3b/</a> 《MOA中的Cordova插件开发 - 工作流程篇》，可复制链接后用石墨文档 App 或小程序打开</li><li><a href=http://172.17.0.205/GeoPanel/MobileCenter/geopanel-android/-/blob/geo-client-android/master/plugins_dev/jsMerge/README.md>Gitlab-插件JS合并readme</a></li></ul><h2 id=其他说明>其他说明<a hidden class=anchor aria-hidden=true href=#其他说明>#</a></h2><p>由于最初规划是链动开发基础版本，后续由公司自行维护，故前期部分修改并未特别严格的考虑同链动的代码后续的合并。且我方代码只有非常少的部分同步到了链动，故后续合并代码时应该特别注意。==建议合并代码后再与合并前的代码进行对比，确认合并所产生的差异==。</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://hanlyjiang.github.io/tags/%E5%B7%A5%E4%BD%9C/>工作</a></li></ul><nav class=paginav><a class=prev href=https://hanlyjiang.github.io/posts/%E5%B7%A5%E4%BD%9C%E4%BA%A4%E6%8E%A5-gitlab%E7%9B%B8%E5%85%B3/><span class=title>«</span><br><span>工作交接-Gitlab相关</span>
</a><a class=next href=https://hanlyjiang.github.io/posts/geopanel-rong-qi-hua/><span class=title>»</span><br><span>GeoPanel容器化</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://hanlyjiang.github.io/>清水池塘</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>