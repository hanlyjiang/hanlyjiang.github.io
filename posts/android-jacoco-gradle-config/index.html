<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Android Jacocoè¦†ç›–ç‡ç»Ÿè®¡é…ç½® | æ¸…æ°´æ± å¡˜</title><meta name=keywords content="Android,æµ‹è¯•"><meta name=description content='Android Jacoco è¦†ç›–ç‡ç»Ÿè®¡Gradleé…ç½®ï¼ŒåŒ…æ‹¬ç”Ÿæˆæœ¬åœ°å•å…ƒæµ‹è¯•æŠ¥å‘Šï¼Œä»ªå™¨å•å…ƒæµ‹è¯•æŠ¥å‘Šï¼Œåˆå¹¶ä¸¤ç§æµ‹è¯•çš„æŠ¥å‘Šï¼Œåˆå¹¶ä¸¤ç§æµ‹è¯•çš„æ‰§è¡Œæ•°æ®å¹¶åœ¨AndroidStudioçš„ç¼–è¾‘å™¨ä¸­æŸ¥çœ‹æ¯ä¸€è¡Œçš„è¦†ç›–ç‡æƒ…å†µã€‚
å¦‚ä½•è®©æµ‹è¯•ä»»åŠ¡ç”Ÿæˆ Jacoco è¦†ç›–ç‡ç»Ÿè®¡æ•°æ®ï¼Ÿ
è¿™é‡Œæˆ‘ä»¬ä»…ä»…ä»Gradleä»»åŠ¡æ¥è¯´ï¼Œä¸è€ƒè™‘ AndroidStudio/IDEAã€‚
æœ¬åœ°å•å…ƒæµ‹è¯•ï¼ˆTestï¼‰
å¯¹äºæœ¬åœ°å•å…ƒæµ‹è¯•æ¥è¯´ï¼ŒåŸå…ˆæœ‰ä¸€ä¸ª testDebugUnitTest çš„æµ‹è¯•ä»»åŠ¡ï¼Œå¦‚æœä¸åšé…ç½®ï¼Œè¯¥ä»»åŠ¡åªä¼šç”Ÿæˆæµ‹è¯•é€šè¿‡æƒ…å†µçš„æŠ¥å‘Šã€‚åªè¦åº”ç”¨ jacoco æ’ä»¶ï¼Œç„¶åè¿è¡Œ testDebugUnitTest ä»»åŠ¡æ—¶ï¼Œå°±ä¼šåŒæ—¶ç”Ÿæˆjacocoè¦†ç›–ç‡ç»Ÿè®¡æ‰§è¡Œæ•°æ®æ–‡ä»¶ã€‚
// build.gradle 
apply(plugin = "jacoco")
ä¹‹æ‰€ä»¥èƒ½è¿™æ ·æ˜¯å› ä¸º jacoco æ’ä»¶ä¼šç»™æ‰€æœ‰ Test ç±»å‹çš„ä»»åŠ¡æ·»åŠ  jacoco çš„é…ç½®ã€‚
å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è¾“å‡ºå…¶æ‰§è¡Œæ•°æ®æ–‡ä»¶è·¯å¾„ï¼š
afterEvaluate {
    tasks.getByName("testDebugUnitTest").apply {
        doLast {
            (this.extensions.getByName("jacoco") as JacocoTaskExtension).apply {
                logger.lifecycle("testDebugUnitTest dest: ${this.destinationFile?.absolutePath}")
            }
        }
    }
}
æ‰§è¡Œæƒ…å†µå¦‚ä¸‹ï¼š
testDebugUnitTest dest: /Users/hanlyjiang/Wksp/project/AndroidTestSample/app/build/outputs/unit_test_code_coverage/debugUnitTest/testDebugUnitTest.exec
ä»ªå™¨å•å…ƒæµ‹è¯•ï¼ˆAndroidTestï¼‰
ä»ªå™¨å•å…ƒæµ‹è¯•è¦†ç›–ç‡æ•°æ®çš„ç»Ÿè®¡éœ€è¦æ‰“å¼€testCoverageEnabledå¼€å…³ï¼Œç„¶åä¼šæœ‰ä¸€ä¸ªcreateDebugCoverageReport çš„ä»»åŠ¡ç”Ÿæˆï¼ŒåŒæ—¶ä¹Ÿä¼šç”Ÿæˆhtmlçš„æŠ¥å‘Šã€‚
// groovy
android {
    buildTypes {
        debug {
            testCoverageEnabled = true
        }
    }
}

// kotlin
android {
    buildTypes {
        getByName("debug").apply {
            isTestCoverageEnabled = true
        }
    }
}
è¿æ¥è®¾å¤‡æ‰§è¡Œè¯¥ä»»åŠ¡å³å¯ç”Ÿæˆå¯¹åº”çš„æ‰§è¡Œæ•°æ®æ–‡ä»¶åŠå¯¹åº”çš„è¦†ç›–ç‡æŠ¥å‘Šã€‚'><meta name=author content="é‡ç”Ÿè²è—•"><link rel=canonical href=https://hanlyjiang.github.io/posts/android-jacoco-gradle-config/><link crossorigin=anonymous href=/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css integrity="sha256-NDzEgLn/yPBMy+XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as=style><link rel=icon href=https://hanlyjiang.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://hanlyjiang.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://hanlyjiang.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://hanlyjiang.github.io/apple-touch-icon.png><link rel=mask-icon href=https://hanlyjiang.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://hanlyjiang.github.io/posts/android-jacoco-gradle-config/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="https://hanlyjiang.github.io/posts/android-jacoco-gradle-config/"><meta property="og:site_name" content="æ¸…æ°´æ± å¡˜"><meta property="og:title" content="Android Jacocoè¦†ç›–ç‡ç»Ÿè®¡é…ç½®"><meta property="og:description" content='Android Jacoco è¦†ç›–ç‡ç»Ÿè®¡Gradleé…ç½®ï¼ŒåŒ…æ‹¬ç”Ÿæˆæœ¬åœ°å•å…ƒæµ‹è¯•æŠ¥å‘Šï¼Œä»ªå™¨å•å…ƒæµ‹è¯•æŠ¥å‘Šï¼Œåˆå¹¶ä¸¤ç§æµ‹è¯•çš„æŠ¥å‘Šï¼Œåˆå¹¶ä¸¤ç§æµ‹è¯•çš„æ‰§è¡Œæ•°æ®å¹¶åœ¨AndroidStudioçš„ç¼–è¾‘å™¨ä¸­æŸ¥çœ‹æ¯ä¸€è¡Œçš„è¦†ç›–ç‡æƒ…å†µã€‚
å¦‚ä½•è®©æµ‹è¯•ä»»åŠ¡ç”Ÿæˆ Jacoco è¦†ç›–ç‡ç»Ÿè®¡æ•°æ®ï¼Ÿ è¿™é‡Œæˆ‘ä»¬ä»…ä»…ä»Gradleä»»åŠ¡æ¥è¯´ï¼Œä¸è€ƒè™‘ AndroidStudio/IDEAã€‚
æœ¬åœ°å•å…ƒæµ‹è¯•ï¼ˆTestï¼‰ å¯¹äºæœ¬åœ°å•å…ƒæµ‹è¯•æ¥è¯´ï¼ŒåŸå…ˆæœ‰ä¸€ä¸ª testDebugUnitTest çš„æµ‹è¯•ä»»åŠ¡ï¼Œå¦‚æœä¸åšé…ç½®ï¼Œè¯¥ä»»åŠ¡åªä¼šç”Ÿæˆæµ‹è¯•é€šè¿‡æƒ…å†µçš„æŠ¥å‘Šã€‚åªè¦åº”ç”¨ jacoco æ’ä»¶ï¼Œç„¶åè¿è¡Œ testDebugUnitTest ä»»åŠ¡æ—¶ï¼Œå°±ä¼šåŒæ—¶ç”Ÿæˆjacocoè¦†ç›–ç‡ç»Ÿè®¡æ‰§è¡Œæ•°æ®æ–‡ä»¶ã€‚
// build.gradle apply(plugin = "jacoco") ä¹‹æ‰€ä»¥èƒ½è¿™æ ·æ˜¯å› ä¸º jacoco æ’ä»¶ä¼šç»™æ‰€æœ‰ Test ç±»å‹çš„ä»»åŠ¡æ·»åŠ  jacoco çš„é…ç½®ã€‚
å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è¾“å‡ºå…¶æ‰§è¡Œæ•°æ®æ–‡ä»¶è·¯å¾„ï¼š
afterEvaluate { tasks.getByName("testDebugUnitTest").apply { doLast { (this.extensions.getByName("jacoco") as JacocoTaskExtension).apply { logger.lifecycle("testDebugUnitTest dest: ${this.destinationFile?.absolutePath}") } } } } æ‰§è¡Œæƒ…å†µå¦‚ä¸‹ï¼š
testDebugUnitTest dest: /Users/hanlyjiang/Wksp/project/AndroidTestSample/app/build/outputs/unit_test_code_coverage/debugUnitTest/testDebugUnitTest.exec ä»ªå™¨å•å…ƒæµ‹è¯•ï¼ˆAndroidTestï¼‰ ä»ªå™¨å•å…ƒæµ‹è¯•è¦†ç›–ç‡æ•°æ®çš„ç»Ÿè®¡éœ€è¦æ‰“å¼€testCoverageEnabledå¼€å…³ï¼Œç„¶åä¼šæœ‰ä¸€ä¸ªcreateDebugCoverageReport çš„ä»»åŠ¡ç”Ÿæˆï¼ŒåŒæ—¶ä¹Ÿä¼šç”Ÿæˆhtmlçš„æŠ¥å‘Šã€‚
// groovy android { buildTypes { debug { testCoverageEnabled = true } } } // kotlin android { buildTypes { getByName("debug").apply { isTestCoverageEnabled = true } } } è¿æ¥è®¾å¤‡æ‰§è¡Œè¯¥ä»»åŠ¡å³å¯ç”Ÿæˆå¯¹åº”çš„æ‰§è¡Œæ•°æ®æ–‡ä»¶åŠå¯¹åº”çš„è¦†ç›–ç‡æŠ¥å‘Šã€‚'><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-03-19T22:29:12+00:00"><meta property="article:modified_time" content="2022-03-19T22:29:12+00:00"><meta property="article:tag" content="Android"><meta property="article:tag" content="æµ‹è¯•"><meta name=twitter:card content="summary"><meta name=twitter:title content="Android Jacocoè¦†ç›–ç‡ç»Ÿè®¡é…ç½®"><meta name=twitter:description content='Android Jacoco è¦†ç›–ç‡ç»Ÿè®¡Gradleé…ç½®ï¼ŒåŒ…æ‹¬ç”Ÿæˆæœ¬åœ°å•å…ƒæµ‹è¯•æŠ¥å‘Šï¼Œä»ªå™¨å•å…ƒæµ‹è¯•æŠ¥å‘Šï¼Œåˆå¹¶ä¸¤ç§æµ‹è¯•çš„æŠ¥å‘Šï¼Œåˆå¹¶ä¸¤ç§æµ‹è¯•çš„æ‰§è¡Œæ•°æ®å¹¶åœ¨AndroidStudioçš„ç¼–è¾‘å™¨ä¸­æŸ¥çœ‹æ¯ä¸€è¡Œçš„è¦†ç›–ç‡æƒ…å†µã€‚
å¦‚ä½•è®©æµ‹è¯•ä»»åŠ¡ç”Ÿæˆ Jacoco è¦†ç›–ç‡ç»Ÿè®¡æ•°æ®ï¼Ÿ
è¿™é‡Œæˆ‘ä»¬ä»…ä»…ä»Gradleä»»åŠ¡æ¥è¯´ï¼Œä¸è€ƒè™‘ AndroidStudio/IDEAã€‚
æœ¬åœ°å•å…ƒæµ‹è¯•ï¼ˆTestï¼‰
å¯¹äºæœ¬åœ°å•å…ƒæµ‹è¯•æ¥è¯´ï¼ŒåŸå…ˆæœ‰ä¸€ä¸ª testDebugUnitTest çš„æµ‹è¯•ä»»åŠ¡ï¼Œå¦‚æœä¸åšé…ç½®ï¼Œè¯¥ä»»åŠ¡åªä¼šç”Ÿæˆæµ‹è¯•é€šè¿‡æƒ…å†µçš„æŠ¥å‘Šã€‚åªè¦åº”ç”¨ jacoco æ’ä»¶ï¼Œç„¶åè¿è¡Œ testDebugUnitTest ä»»åŠ¡æ—¶ï¼Œå°±ä¼šåŒæ—¶ç”Ÿæˆjacocoè¦†ç›–ç‡ç»Ÿè®¡æ‰§è¡Œæ•°æ®æ–‡ä»¶ã€‚
// build.gradle 
apply(plugin = "jacoco")
ä¹‹æ‰€ä»¥èƒ½è¿™æ ·æ˜¯å› ä¸º jacoco æ’ä»¶ä¼šç»™æ‰€æœ‰ Test ç±»å‹çš„ä»»åŠ¡æ·»åŠ  jacoco çš„é…ç½®ã€‚
å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è¾“å‡ºå…¶æ‰§è¡Œæ•°æ®æ–‡ä»¶è·¯å¾„ï¼š
afterEvaluate {
    tasks.getByName("testDebugUnitTest").apply {
        doLast {
            (this.extensions.getByName("jacoco") as JacocoTaskExtension).apply {
                logger.lifecycle("testDebugUnitTest dest: ${this.destinationFile?.absolutePath}")
            }
        }
    }
}
æ‰§è¡Œæƒ…å†µå¦‚ä¸‹ï¼š
testDebugUnitTest dest: /Users/hanlyjiang/Wksp/project/AndroidTestSample/app/build/outputs/unit_test_code_coverage/debugUnitTest/testDebugUnitTest.exec
ä»ªå™¨å•å…ƒæµ‹è¯•ï¼ˆAndroidTestï¼‰
ä»ªå™¨å•å…ƒæµ‹è¯•è¦†ç›–ç‡æ•°æ®çš„ç»Ÿè®¡éœ€è¦æ‰“å¼€testCoverageEnabledå¼€å…³ï¼Œç„¶åä¼šæœ‰ä¸€ä¸ªcreateDebugCoverageReport çš„ä»»åŠ¡ç”Ÿæˆï¼ŒåŒæ—¶ä¹Ÿä¼šç”Ÿæˆhtmlçš„æŠ¥å‘Šã€‚
// groovy
android {
    buildTypes {
        debug {
            testCoverageEnabled = true
        }
    }
}

// kotlin
android {
    buildTypes {
        getByName("debug").apply {
            isTestCoverageEnabled = true
        }
    }
}
è¿æ¥è®¾å¤‡æ‰§è¡Œè¯¥ä»»åŠ¡å³å¯ç”Ÿæˆå¯¹åº”çš„æ‰§è¡Œæ•°æ®æ–‡ä»¶åŠå¯¹åº”çš„è¦†ç›–ç‡æŠ¥å‘Šã€‚'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://hanlyjiang.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Android Jacocoè¦†ç›–ç‡ç»Ÿè®¡é…ç½®","item":"https://hanlyjiang.github.io/posts/android-jacoco-gradle-config/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Android Jacocoè¦†ç›–ç‡ç»Ÿè®¡é…ç½®","name":"Android Jacocoè¦†ç›–ç‡ç»Ÿè®¡é…ç½®","description":"Android Jacoco è¦†ç›–ç‡ç»Ÿè®¡Gradleé…ç½®ï¼ŒåŒ…æ‹¬ç”Ÿæˆæœ¬åœ°å•å…ƒæµ‹è¯•æŠ¥å‘Šï¼Œä»ªå™¨å•å…ƒæµ‹è¯•æŠ¥å‘Šï¼Œåˆå¹¶ä¸¤ç§æµ‹è¯•çš„æŠ¥å‘Šï¼Œåˆå¹¶ä¸¤ç§æµ‹è¯•çš„æ‰§è¡Œæ•°æ®å¹¶åœ¨AndroidStudioçš„ç¼–è¾‘å™¨ä¸­æŸ¥çœ‹æ¯ä¸€è¡Œçš„è¦†ç›–ç‡æƒ…å†µã€‚\nå¦‚ä½•è®©æµ‹è¯•ä»»åŠ¡ç”Ÿæˆ Jacoco è¦†ç›–ç‡ç»Ÿè®¡æ•°æ®ï¼Ÿ è¿™é‡Œæˆ‘ä»¬ä»…ä»…ä»Gradleä»»åŠ¡æ¥è¯´ï¼Œä¸è€ƒè™‘ AndroidStudio/IDEAã€‚\næœ¬åœ°å•å…ƒæµ‹è¯•ï¼ˆTestï¼‰ å¯¹äºæœ¬åœ°å•å…ƒæµ‹è¯•æ¥è¯´ï¼ŒåŸå…ˆæœ‰ä¸€ä¸ª testDebugUnitTest çš„æµ‹è¯•ä»»åŠ¡ï¼Œå¦‚æœä¸åšé…ç½®ï¼Œè¯¥ä»»åŠ¡åªä¼šç”Ÿæˆæµ‹è¯•é€šè¿‡æƒ…å†µçš„æŠ¥å‘Šã€‚åªè¦åº”ç”¨ jacoco æ’ä»¶ï¼Œç„¶åè¿è¡Œ testDebugUnitTest ä»»åŠ¡æ—¶ï¼Œå°±ä¼šåŒæ—¶ç”Ÿæˆjacocoè¦†ç›–ç‡ç»Ÿè®¡æ‰§è¡Œæ•°æ®æ–‡ä»¶ã€‚\n// build.gradle apply(plugin = \u0026#34;jacoco\u0026#34;) ä¹‹æ‰€ä»¥èƒ½è¿™æ ·æ˜¯å› ä¸º jacoco æ’ä»¶ä¼šç»™æ‰€æœ‰ Test ç±»å‹çš„ä»»åŠ¡æ·»åŠ  jacoco çš„é…ç½®ã€‚\nå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è¾“å‡ºå…¶æ‰§è¡Œæ•°æ®æ–‡ä»¶è·¯å¾„ï¼š\nafterEvaluate { tasks.getByName(\u0026#34;testDebugUnitTest\u0026#34;).apply { doLast { (this.extensions.getByName(\u0026#34;jacoco\u0026#34;) as JacocoTaskExtension).apply { logger.lifecycle(\u0026#34;testDebugUnitTest dest: ${this.destinationFile?.absolutePath}\u0026#34;) } } } } æ‰§è¡Œæƒ…å†µå¦‚ä¸‹ï¼š\ntestDebugUnitTest dest: /Users/hanlyjiang/Wksp/project/AndroidTestSample/app/build/outputs/unit_test_code_coverage/debugUnitTest/testDebugUnitTest.exec ä»ªå™¨å•å…ƒæµ‹è¯•ï¼ˆAndroidTestï¼‰ ä»ªå™¨å•å…ƒæµ‹è¯•è¦†ç›–ç‡æ•°æ®çš„ç»Ÿè®¡éœ€è¦æ‰“å¼€testCoverageEnabledå¼€å…³ï¼Œç„¶åä¼šæœ‰ä¸€ä¸ªcreateDebugCoverageReport çš„ä»»åŠ¡ç”Ÿæˆï¼ŒåŒæ—¶ä¹Ÿä¼šç”Ÿæˆhtmlçš„æŠ¥å‘Šã€‚\n// groovy android { buildTypes { debug { testCoverageEnabled = true } } } // kotlin android { buildTypes { getByName(\u0026#34;debug\u0026#34;).apply { isTestCoverageEnabled = true } } } è¿æ¥è®¾å¤‡æ‰§è¡Œè¯¥ä»»åŠ¡å³å¯ç”Ÿæˆå¯¹åº”çš„æ‰§è¡Œæ•°æ®æ–‡ä»¶åŠå¯¹åº”çš„è¦†ç›–ç‡æŠ¥å‘Šã€‚\n","keywords":["Android","æµ‹è¯•"],"articleBody":"Android Jacoco è¦†ç›–ç‡ç»Ÿè®¡Gradleé…ç½®ï¼ŒåŒ…æ‹¬ç”Ÿæˆæœ¬åœ°å•å…ƒæµ‹è¯•æŠ¥å‘Šï¼Œä»ªå™¨å•å…ƒæµ‹è¯•æŠ¥å‘Šï¼Œåˆå¹¶ä¸¤ç§æµ‹è¯•çš„æŠ¥å‘Šï¼Œåˆå¹¶ä¸¤ç§æµ‹è¯•çš„æ‰§è¡Œæ•°æ®å¹¶åœ¨AndroidStudioçš„ç¼–è¾‘å™¨ä¸­æŸ¥çœ‹æ¯ä¸€è¡Œçš„è¦†ç›–ç‡æƒ…å†µã€‚\nå¦‚ä½•è®©æµ‹è¯•ä»»åŠ¡ç”Ÿæˆ Jacoco è¦†ç›–ç‡ç»Ÿè®¡æ•°æ®ï¼Ÿ è¿™é‡Œæˆ‘ä»¬ä»…ä»…ä»Gradleä»»åŠ¡æ¥è¯´ï¼Œä¸è€ƒè™‘ AndroidStudio/IDEAã€‚\næœ¬åœ°å•å…ƒæµ‹è¯•ï¼ˆTestï¼‰ å¯¹äºæœ¬åœ°å•å…ƒæµ‹è¯•æ¥è¯´ï¼ŒåŸå…ˆæœ‰ä¸€ä¸ª testDebugUnitTest çš„æµ‹è¯•ä»»åŠ¡ï¼Œå¦‚æœä¸åšé…ç½®ï¼Œè¯¥ä»»åŠ¡åªä¼šç”Ÿæˆæµ‹è¯•é€šè¿‡æƒ…å†µçš„æŠ¥å‘Šã€‚åªè¦åº”ç”¨ jacoco æ’ä»¶ï¼Œç„¶åè¿è¡Œ testDebugUnitTest ä»»åŠ¡æ—¶ï¼Œå°±ä¼šåŒæ—¶ç”Ÿæˆjacocoè¦†ç›–ç‡ç»Ÿè®¡æ‰§è¡Œæ•°æ®æ–‡ä»¶ã€‚\n// build.gradle apply(plugin = \"jacoco\") ä¹‹æ‰€ä»¥èƒ½è¿™æ ·æ˜¯å› ä¸º jacoco æ’ä»¶ä¼šç»™æ‰€æœ‰ Test ç±»å‹çš„ä»»åŠ¡æ·»åŠ  jacoco çš„é…ç½®ã€‚\nå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è¾“å‡ºå…¶æ‰§è¡Œæ•°æ®æ–‡ä»¶è·¯å¾„ï¼š\nafterEvaluate { tasks.getByName(\"testDebugUnitTest\").apply { doLast { (this.extensions.getByName(\"jacoco\") as JacocoTaskExtension).apply { logger.lifecycle(\"testDebugUnitTest dest: ${this.destinationFile?.absolutePath}\") } } } } æ‰§è¡Œæƒ…å†µå¦‚ä¸‹ï¼š\ntestDebugUnitTest dest: /Users/hanlyjiang/Wksp/project/AndroidTestSample/app/build/outputs/unit_test_code_coverage/debugUnitTest/testDebugUnitTest.exec ä»ªå™¨å•å…ƒæµ‹è¯•ï¼ˆAndroidTestï¼‰ ä»ªå™¨å•å…ƒæµ‹è¯•è¦†ç›–ç‡æ•°æ®çš„ç»Ÿè®¡éœ€è¦æ‰“å¼€testCoverageEnabledå¼€å…³ï¼Œç„¶åä¼šæœ‰ä¸€ä¸ªcreateDebugCoverageReport çš„ä»»åŠ¡ç”Ÿæˆï¼ŒåŒæ—¶ä¹Ÿä¼šç”Ÿæˆhtmlçš„æŠ¥å‘Šã€‚\n// groovy android { buildTypes { debug { testCoverageEnabled = true } } } // kotlin android { buildTypes { getByName(\"debug\").apply { isTestCoverageEnabled = true } } } è¿æ¥è®¾å¤‡æ‰§è¡Œè¯¥ä»»åŠ¡å³å¯ç”Ÿæˆå¯¹åº”çš„æ‰§è¡Œæ•°æ®æ–‡ä»¶åŠå¯¹åº”çš„è¦†ç›–ç‡æŠ¥å‘Šã€‚\né€šè¿‡åœ¨build.gradleä¸­æ·»åŠ å¦‚ä¸‹é…ç½®å¯ä»¥åœ¨æ‰§è¡Œæ—¶è¾“å‡ºå…¶æ‰§è¡Œæ•°æ®æ–‡ä»¶åœ¨æœ¬æœºçš„ä½ç½®ï¼š\ntasks.withType(com.android.build.gradle.internal.coverage.JacocoReportTask::class.java) { logger.lifecycle(\"-\u003e JacocoReportTask task : $name\") doFirst { logger.lifecycle(\"-\u003e JacocoReportTask task : $name , ${jacocoConnectedTestsCoverageDir.get()})}\") } } ç„¶åæ‰§è¡ŒcreateDebugCoverageReport, è¾“å‡ºå¦‚ä¸‹ ï¼š\n\u003e Task :app:createDebugAndroidTestCoverageReport -\u003e JacocoReportTask task : createDebugAndroidTestCoverageReport , /Users/hanlyjiang/Wksp/project/AndroidTestSample/app/build/outputs/code_coverage/debugAndroidTest/connected)} \u003e Task :app:createDebugCoverageReport å°ç»“ é€šè¿‡ä»¥ä¸Šä¿¡æ¯æˆ‘ä»¬å¯çŸ¥ï¼š\nåº”ç”¨ jacoco æ’ä»¶ä¹‹åï¼Œæœ¬åœ°å•å…ƒæµ‹è¯•ä»»åŠ¡ï¼ˆtestDebugUnitTestï¼‰å°±ä¼šç”Ÿæˆ jacoco è¦†ç›–ç‡executionæ•°æ®æ–‡ä»¶ï¼Œä½†æ˜¯ä¸ä¼šç”ŸæˆhtmlæŠ¥å‘Šï¼› å¼€å¯ isTestCoverageEnabled å¼€å…³ï¼Œä¼šç”Ÿæˆ createDebugCoverageReport ä»»åŠ¡ï¼Œè¯¥ä»»åŠ¡ä¼šæ‰§è¡Œä»ªå™¨å•å…ƒæµ‹è¯•ï¼ŒåŒæ—¶ç”Ÿæˆexecutionæ•°æ®æ–‡ä»¶ï¼Œå¹¶ç”ŸæˆhtmlæŠ¥å‘Šã€‚ ç”Ÿæˆ HTML æŠ¥å‘Š ç”±äºandroidTest å·²ç»ç”Ÿæˆäº†htmlæŠ¥å‘Šï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦è¦ä¸ºæˆ‘ä»¬çš„æœ¬åœ°å•å…ƒæµ‹è¯•ç”ŸæˆHTMLæŠ¥å‘Šã€‚\nè¦ç”ŸæˆhtmlæŠ¥å‘Šï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç±»å‹ä¸º JacocoReport çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬åœ¨gradle ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼Œç”¨äºç”Ÿæˆ jacocoTestDebugUnitTestReport ä»»åŠ¡\napply(plugin = \"jacoco\") android { buildTypes { getByName(\"debug\").apply { isTestCoverageEnabled = true } } } afterEvaluate { // ç”±äºæˆ‘ä»¬éœ€è¦è·å–å¯¹åº”çš„æºç åŠclassç›®å½•ï¼Œæ‰€ä»¥ä½¿ç”¨ android.applicationVariants forEach æ¥è·å–å˜ä½“ android.applicationVariants.forEach { variant -\u003e if (variant.buildType.isTestCoverageEnabled) { val variantCapName = variant.name.capitalize(); tasks.register( \"jacocoTest${variantCapName}UnitTestReport\", JacocoReport::class.java ) { group = \"jacoco\" // ä¾èµ–æµ‹è¯•ä»»åŠ¡ dependsOn(\"test${variantCapName}UnitTest\") // æ ¹æ®æ‰§è¡Œæ•°æ®ç”ŸæˆæŠ¥å‘Šï¼Œç›´æ¥ä¼ è¾“taskå³å¯ executionData(tasks.getByName(\"test${variantCapName}UnitTest\")) // æŠ¥å‘Šä¸­ä¼šåŒ…å«æºç ï¼Œå¯ä»¥æŸ¥çœ‹æºç çš„å¯¹åº”çš„è¦†ç›–æƒ…å†µ sourceDirectories.from(variant.sourceSets.flatMap { it.javaDirectories + it.kotlinDirectories }) // æ²¡æœ‰ class æ•°æ®æŠ¥å‘Šä¼šæ˜¯ç©ºçš„ classDirectories.from(variant.javaCompileProvider.get().destinationDirectory) doLast { logger.lifecycle(reports.html.outputLocation.asFile.get().absolutePath) } } } } } æ·»åŠ ä¹‹å sync gradleï¼Œå³å¯ç”Ÿæˆä¸€ä¸ª jacocoTestDebugUnitTestReport çš„ä»»åŠ¡ï¼Œæ‰§è¡Œå®ƒå³å¯ç”Ÿæˆæµ‹è¯•æŠ¥å‘Šï¼Œç”Ÿæˆçš„æµ‹è¯•æŠ¥å‘Šä½äºï¼š build/reports/jacoco/jacocoTestDebugUnitTestReportä¸­ã€‚\nä¸‹å›¾å°±æ˜¯æˆ‘ä»¬ç”Ÿæˆçš„æŠ¥å‘Šï¼Œå¯ä»¥çœ‹åˆ°StringUtilså·²ç»èƒ½å¤Ÿç»Ÿè®¡è¦†ç›–ç‡äº†ã€‚è€ŒMainActivityè¿˜æ²¡æœ‰æ•°æ®ã€‚\nç”Ÿæˆåˆå¹¶HTMLæŠ¥å‘Š æˆ‘ä»¬å·²ç»å¯ä»¥ç”Ÿæˆæœ¬åœ°å•å…ƒæµ‹è¯•çš„è¦†ç›–ç‡æŠ¥å‘Šï¼Œç°åœ¨æˆ‘ä»¬éœ€è¦ç”ŸæˆandroidTest + test çš„åˆå¹¶æŠ¥å‘Šã€‚\nä¹‹å‰æˆ‘ä»¬å·²ç»çŸ¥é“ï¼š\ncreateDebugCoverageReport ä»»åŠ¡å³å¯ç”Ÿæˆ execution æ–‡ä»¶å¹¶ä¸”ç”ŸæˆhtmlæŠ¥å‘Š æˆ‘ä»¬å·²ç»æ·»åŠ äº†ä¸€ä¸ªä»»åŠ¡å¯ä»¥ç”Ÿæˆæœ¬åœ°å•å…ƒæµ‹è¯•çš„æŠ¥å‘Šã€‚ ç°åœ¨æˆ‘ä»¬è¦åšçš„æ˜¯å°†å®ƒä»¬åˆå¹¶ï¼Œä½†æ˜¯æˆ‘ä»¬çš„åˆå¹¶å¹¶ä¸æ˜¯é’ˆå¯¹htmlæŠ¥å‘Šï¼Œè€Œæ˜¯é’ˆå¯¹executionæ•°æ®ã€‚\nè®©æˆ‘ä»¬æ·»åŠ å¦‚ä¸‹é…ç½®æ¥ç”Ÿæˆä¸€ä¸ªåˆå¹¶æŠ¥å‘Šçš„gradleä»»åŠ¡ï¼š\napply(plugin = \"jacoco\") android { buildTypes { getByName(\"debug\").apply { isTestCoverageEnabled = true } } } afterEvaluate { android.applicationVariants.forEach { variant -\u003e if (variant.buildType.isTestCoverageEnabled) { val variantCapName = variant.name.capitalize(); tasks.register(\"mergedJacoco${variantCapName}TestReport\", JacocoReport::class.java) { group = \"jacoco\" executionData( tasks.getByName(\"test${variantCapName}UnitTest\"), ) val androidCoverageTask = tasks.getByName(\"create${variantCapName}AndroidTestCoverageReport\") if (androidCoverageTask is com.android.build.gradle.internal.coverage.JacocoReportTask) { executionData(androidCoverageTask.jacocoConnectedTestsCoverageDir.asFileTree) } sourceDirectories.from(variant.sourceSets.flatMap { it.javaDirectories + it.kotlinDirectories }) classDirectories.from(variant.javaCompileProvider.get().destinationDirectory) dependsOn( \"test${variantCapName}UnitTest\", \"create${variantCapName}AndroidTestCoverageReport\" ) doLast { logger.lifecycle(reports.html.outputLocation.asFile.get().absolutePath) } } } } } è¿™æ ·ï¼Œæˆ‘ä»¬ä¾¿æœ‰äº†ä¸€ä¸ª mergedJacocoDebugTestReport çš„ä»»åŠ¡ï¼Œæ‰§è¡Œåå³å¯åœ¨build/reports/jacoco/mergedJacocoDebugTestReport/html ç›®å½•ä¸­æ‰¾åˆ°æˆ‘ä»¬çš„ report ã€‚\nç°åœ¨å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬çš„MainActivityï¼ˆAndroidTestï¼‰åŠStringUtilsï¼ˆtestï¼‰å¯ä»¥åœ¨ä¸€ä»½æŠ¥å‘Šä¸­æ˜¾ç¤ºè¦†ç›–ç‡æ•°æ®äº†ã€‚\nç”Ÿæˆåˆå¹¶ Execution æ•°æ®æ–‡ä»¶ åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»ç”Ÿæˆäº†HTMLç‰ˆæœ¬çš„åˆå¹¶æŠ¥å‘Šï¼Œå¹¶ä¸”å¯ä»¥åœ¨å…¶ä¸­çœ‹åˆ°æºç æ²¡ä¸€è¡Œè¦†ç›–çš„æƒ…å†µã€‚\nä½†æ˜¯ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿåœ¨AndroidStudioçš„ç¼–è¾‘å™¨ä¸­æ˜¾ç¤ºè¦†ç›–ç‡çš„æƒ…å†µï¼Œå‘ä¸‹é¢è¿™æ ·ğŸ‘‡ï¼š\nå®é™…ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡AndroidStudioçš„Menu-Run-Show Covarage DataåŠ è½½ execution æ–‡ä»¶ï¼Œç„¶ååœ¨AndroidStudioä¸­æ˜¾ç¤ºè¦†ç›–ç‡æ•°æ®ã€‚\næ‰§è¡Œçš„æ•°æ®æ–‡ä»¶ä½äºç±»ä¼¼å¦‚ä¸‹ç›®å½• ï¼š\nbuild/outputs/unit_test_code_coverage/debugUnitTest/testDebugUnitTest.exec build/outputs/code_coverage/debugAndroidTest/connected/Pixel_5_API_Tiramisu(AVD) - 12/coverage.ec ä½†æ˜¯è¿™é‡Œæœ‰ä¸¤ä¸ªé—®é¢˜ï¼š\ndebugAndroidTest ç›®å½•ä¸­çš„ .ec æ–‡ä»¶æ— æ³•è¢«AndroidStudioè¯†åˆ«ã€‚ è¿™ä¸¤ä¸ªæ–‡ä»¶æ˜¯åˆ†å¼€çš„ï¼Œæ¯ä¸€ä¸ªæ–‡ä»¶åªåŒ…å«ä¸€ç§æµ‹è¯•çš„è¦†ç›–æ•°æ®ã€‚ ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªåˆå¹¶ä»»åŠ¡ï¼š\nafterEvaluate { tasks.getByName(\"testDebugUnitTest\").apply { (this.extensions.getByName(\"jacoco\") as JacocoTaskExtension).apply { logger.lifecycle(\"testDebugUnitTest dest: ${this.destinationFile?.absolutePath}\") } } tasks.withType(org.gradle.api.tasks.testing.Test::class.java) { logger.lifecycle(\"-\u003e test task : $name\") } tasks.withType(JacocoReport::class.java) { logger.lifecycle(\"-\u003e JacocoReport task : $name\") } tasks.withType(com.android.build.gradle.internal.coverage.JacocoReportTask::class.java) { logger.lifecycle(\"-\u003e JacocoReportTask task : $name\") doFirst { logger.lifecycle(\"-\u003e JacocoReportTask task : $name , ${jacocoConnectedTestsCoverageDir.get()})}\") } } android.applicationVariants.forEach { variant -\u003e if (variant.buildType.isTestCoverageEnabled) { val variantCapName = variant.name.capitalize(); tasks.register( \"jacocoTest${variantCapName}UnitTestReport\", JacocoReport::class.java ) { group = \"jacoco\" executionData(tasks.getByName(\"test${variantCapName}UnitTest\")) sourceDirectories.from(variant.sourceSets.flatMap { it.javaDirectories + it.kotlinDirectories }) classDirectories.from(variant.javaCompileProvider.get().destinationDirectory) dependsOn(\"test${variantCapName}UnitTest\") doLast { logger.lifecycle(\"Jacoco Report: \" + reports.html.outputLocation.asFile.get().absolutePath) } } tasks.register(\"mergedJacoco${variantCapName}TestReport\", JacocoReport::class.java) { group = \"jacoco\" executionData( tasks.getByName(\"test${variantCapName}UnitTest\"), ) val androidCoverageTask = tasks.getByName(\"create${variantCapName}AndroidTestCoverageReport\") if (androidCoverageTask is com.android.build.gradle.internal.coverage.JacocoReportTask) { executionData(androidCoverageTask.jacocoConnectedTestsCoverageDir.asFileTree) } sourceDirectories.from(variant.sourceSets.flatMap { it.javaDirectories + it.kotlinDirectories }) classDirectories.from(variant.javaCompileProvider.get().destinationDirectory) dependsOn( \"test${variantCapName}UnitTest\", \"create${variantCapName}AndroidTestCoverageReport\" ) doLast { logger.lifecycle(\"Jacoco Report: \" + reports.html.outputLocation.asFile.get().absolutePath) } } tasks.register(\"mergeJacoco${variantCapName}Execution\", JacocoMerge::class.java) { group = \"jacoco\" executionData( tasks.getByName(\"test${variantCapName}UnitTest\"), ) val androidCoverageTask = tasks.getByName(\"create${variantCapName}AndroidTestCoverageReport\") if (androidCoverageTask is com.android.build.gradle.internal.coverage.JacocoReportTask) { executionData(androidCoverageTask.jacocoConnectedTestsCoverageDir.asFileTree) } doLast { logger.lifecycle(\"Jacoco Execution: \" + destinationFile.absolutePath) } } } } } æ‰§è¡Œä¹‹åä½äºï¼šbuild/jacoco/mergeJacocoDebugExecution.exec, é€šè¿‡AndroidStudio åŠ è½½ä¹‹åï¼Œæ˜¾ç¤ºå¦‚ä¸‹ï¼Œä¸¤ç§æµ‹è¯•çš„ç»“æœå·²ç»åˆå¹¶æ˜¾ç¤ºäº†ã€‚\nå®Œæ•´é…ç½®æ–‡ä»¶ è¯·å‚è€ƒï¼š AndroidTestSample/build.gradle.kts at main Â· hanlyjiang/AndroidTestSample (github.com)\n","wordCount":"492","inLanguage":"en","datePublished":"2022-03-19T22:29:12Z","dateModified":"2022-03-19T22:29:12Z","author":{"@type":"Person","name":"é‡ç”Ÿè²è—•"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://hanlyjiang.github.io/posts/android-jacoco-gradle-config/"},"publisher":{"@type":"Organization","name":"æ¸…æ°´æ± å¡˜","logo":{"@type":"ImageObject","url":"https://hanlyjiang.github.io/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://hanlyjiang.github.io/ accesskey=h title="æ¸…æ°´æ± å¡˜ (Alt + H)">æ¸…æ°´æ± å¡˜</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Android Jacocoè¦†ç›–ç‡ç»Ÿè®¡é…ç½®</h1><div class=post-meta><span title='2022-03-19 22:29:12 +0000 UTC'>March 19, 2022</span>&nbsp;Â·&nbsp;<span>3 min</span>&nbsp;Â·&nbsp;<span>é‡ç”Ÿè²è—•</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e5%a6%82%e4%bd%95%e8%ae%a9%e6%b5%8b%e8%af%95%e4%bb%bb%e5%8a%a1%e7%94%9f%e6%88%90-jacoco-%e8%a6%86%e7%9b%96%e7%8e%87%e7%bb%9f%e8%ae%a1%e6%95%b0%e6%8d%ae aria-label="å¦‚ä½•è®©æµ‹è¯•ä»»åŠ¡ç”Ÿæˆ Jacoco è¦†ç›–ç‡ç»Ÿè®¡æ•°æ®ï¼Ÿ">å¦‚ä½•è®©æµ‹è¯•ä»»åŠ¡ç”Ÿæˆ Jacoco è¦†ç›–ç‡ç»Ÿè®¡æ•°æ®ï¼Ÿ</a><ul><li><a href=#%e6%9c%ac%e5%9c%b0%e5%8d%95%e5%85%83%e6%b5%8b%e8%af%95test aria-label=æœ¬åœ°å•å…ƒæµ‹è¯•ï¼ˆTestï¼‰>æœ¬åœ°å•å…ƒæµ‹è¯•ï¼ˆTestï¼‰</a></li><li><a href=#%e4%bb%aa%e5%99%a8%e5%8d%95%e5%85%83%e6%b5%8b%e8%af%95androidtest aria-label=ä»ªå™¨å•å…ƒæµ‹è¯•ï¼ˆAndroidTestï¼‰>ä»ªå™¨å•å…ƒæµ‹è¯•ï¼ˆAndroidTestï¼‰</a></li><li><a href=#%e5%b0%8f%e7%bb%93 aria-label=å°ç»“>å°ç»“</a></li></ul></li><li><a href=#%e7%94%9f%e6%88%90-html-%e6%8a%a5%e5%91%8a aria-label="ç”Ÿæˆ HTML æŠ¥å‘Š">ç”Ÿæˆ HTML æŠ¥å‘Š</a></li><li><a href=#%e7%94%9f%e6%88%90%e5%90%88%e5%b9%b6html%e6%8a%a5%e5%91%8a aria-label=ç”Ÿæˆåˆå¹¶HTMLæŠ¥å‘Š>ç”Ÿæˆåˆå¹¶HTMLæŠ¥å‘Š</a></li><li><a href=#%e7%94%9f%e6%88%90%e5%90%88%e5%b9%b6-execution-%e6%95%b0%e6%8d%ae%e6%96%87%e4%bb%b6 aria-label="ç”Ÿæˆåˆå¹¶ Execution æ•°æ®æ–‡ä»¶">ç”Ÿæˆåˆå¹¶ Execution æ•°æ®æ–‡ä»¶</a></li><li><a href=#%e5%ae%8c%e6%95%b4%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6 aria-label=å®Œæ•´é…ç½®æ–‡ä»¶>å®Œæ•´é…ç½®æ–‡ä»¶</a></li></ul></div></details></div><div class=post-content><p>Android Jacoco è¦†ç›–ç‡ç»Ÿè®¡Gradleé…ç½®ï¼ŒåŒ…æ‹¬ç”Ÿæˆæœ¬åœ°å•å…ƒæµ‹è¯•æŠ¥å‘Šï¼Œä»ªå™¨å•å…ƒæµ‹è¯•æŠ¥å‘Šï¼Œåˆå¹¶ä¸¤ç§æµ‹è¯•çš„æŠ¥å‘Šï¼Œåˆå¹¶ä¸¤ç§æµ‹è¯•çš„æ‰§è¡Œæ•°æ®å¹¶åœ¨AndroidStudioçš„ç¼–è¾‘å™¨ä¸­æŸ¥çœ‹æ¯ä¸€è¡Œçš„è¦†ç›–ç‡æƒ…å†µã€‚</p><h2 id=å¦‚ä½•è®©æµ‹è¯•ä»»åŠ¡ç”Ÿæˆ-jacoco-è¦†ç›–ç‡ç»Ÿè®¡æ•°æ®>å¦‚ä½•è®©æµ‹è¯•ä»»åŠ¡ç”Ÿæˆ Jacoco è¦†ç›–ç‡ç»Ÿè®¡æ•°æ®ï¼Ÿ<a hidden class=anchor aria-hidden=true href=#å¦‚ä½•è®©æµ‹è¯•ä»»åŠ¡ç”Ÿæˆ-jacoco-è¦†ç›–ç‡ç»Ÿè®¡æ•°æ®>#</a></h2><p>è¿™é‡Œæˆ‘ä»¬ä»…ä»…ä»Gradleä»»åŠ¡æ¥è¯´ï¼Œä¸è€ƒè™‘ AndroidStudio/IDEAã€‚</p><h3 id=æœ¬åœ°å•å…ƒæµ‹è¯•test>æœ¬åœ°å•å…ƒæµ‹è¯•ï¼ˆTestï¼‰<a hidden class=anchor aria-hidden=true href=#æœ¬åœ°å•å…ƒæµ‹è¯•test>#</a></h3><p>å¯¹äºæœ¬åœ°å•å…ƒæµ‹è¯•æ¥è¯´ï¼ŒåŸå…ˆæœ‰ä¸€ä¸ª <code>testDebugUnitTest</code> çš„æµ‹è¯•ä»»åŠ¡ï¼Œå¦‚æœä¸åšé…ç½®ï¼Œè¯¥ä»»åŠ¡åªä¼šç”Ÿæˆæµ‹è¯•é€šè¿‡æƒ…å†µçš„æŠ¥å‘Šã€‚åªè¦åº”ç”¨ jacoco æ’ä»¶ï¼Œç„¶åè¿è¡Œ <code>testDebugUnitTest</code> ä»»åŠ¡æ—¶ï¼Œå°±ä¼šåŒæ—¶ç”Ÿæˆjacocoè¦†ç›–ç‡ç»Ÿè®¡<strong>æ‰§è¡Œæ•°æ®æ–‡ä»¶</strong>ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#75715e>// build.gradle 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>apply(plugin = <span style=color:#e6db74>&#34;jacoco&#34;</span>)
</span></span></code></pre></div><p>ä¹‹æ‰€ä»¥èƒ½è¿™æ ·æ˜¯å› ä¸º jacoco æ’ä»¶ä¼šç»™æ‰€æœ‰ Test ç±»å‹çš„ä»»åŠ¡æ·»åŠ  jacoco çš„é…ç½®ã€‚</p><p>å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è¾“å‡ºå…¶æ‰§è¡Œæ•°æ®æ–‡ä»¶è·¯å¾„ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>afterEvaluate {
</span></span><span style=display:flex><span>    tasks.getByName(<span style=color:#e6db74>&#34;testDebugUnitTest&#34;</span>).apply {
</span></span><span style=display:flex><span>        doLast {
</span></span><span style=display:flex><span>            (<span style=color:#66d9ef>this</span>.extensions.getByName(<span style=color:#e6db74>&#34;jacoco&#34;</span>) <span style=color:#66d9ef>as</span> JacocoTaskExtension).apply {
</span></span><span style=display:flex><span>                logger.lifecycle(<span style=color:#e6db74>&#34;testDebugUnitTest dest: </span><span style=color:#e6db74>${this.destinationFile?.absolutePath}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>æ‰§è¡Œæƒ…å†µå¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>testDebugUnitTest dest: /Users/hanlyjiang/Wksp/project/AndroidTestSample/app/build/outputs/unit_test_code_coverage/debugUnitTest/testDebugUnitTest.exec
</span></span></code></pre></div><h3 id=ä»ªå™¨å•å…ƒæµ‹è¯•androidtest>ä»ªå™¨å•å…ƒæµ‹è¯•ï¼ˆAndroidTestï¼‰<a hidden class=anchor aria-hidden=true href=#ä»ªå™¨å•å…ƒæµ‹è¯•androidtest>#</a></h3><p>ä»ªå™¨å•å…ƒæµ‹è¯•è¦†ç›–ç‡æ•°æ®çš„ç»Ÿè®¡éœ€è¦æ‰“å¼€<code>testCoverageEnabled</code>å¼€å…³ï¼Œç„¶åä¼šæœ‰ä¸€ä¸ª<code>createDebugCoverageReport</code> çš„ä»»åŠ¡ç”Ÿæˆï¼ŒåŒæ—¶ä¹Ÿä¼šç”Ÿæˆhtmlçš„æŠ¥å‘Šã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span><span style=color:#75715e>// groovy
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>android <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    buildTypes <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        debug <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            testCoverageEnabled <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// kotlin
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>android <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    buildTypes <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        getByName<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;debug&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>apply</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            isTestCoverageEnabled <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>è¿æ¥è®¾å¤‡æ‰§è¡Œè¯¥ä»»åŠ¡å³å¯ç”Ÿæˆå¯¹åº”çš„æ‰§è¡Œæ•°æ®æ–‡ä»¶åŠå¯¹åº”çš„è¦†ç›–ç‡æŠ¥å‘Šã€‚</p><p>é€šè¿‡åœ¨build.gradleä¸­æ·»åŠ å¦‚ä¸‹é…ç½®å¯ä»¥åœ¨æ‰§è¡Œæ—¶è¾“å‡ºå…¶æ‰§è¡Œæ•°æ®æ–‡ä»¶åœ¨æœ¬æœºçš„ä½ç½®ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>    tasks.withType(com.android.build.gradle.<span style=color:#66d9ef>internal</span>.coverage.JacocoReportTask<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java) {
</span></span><span style=display:flex><span>        logger.lifecycle(<span style=color:#e6db74>&#34;-&gt; JacocoReportTask task : </span><span style=color:#e6db74>$name</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        doFirst {
</span></span><span style=display:flex><span>            logger.lifecycle(<span style=color:#e6db74>&#34;-&gt; JacocoReportTask task : </span><span style=color:#e6db74>$name</span><span style=color:#e6db74> , </span><span style=color:#e6db74>${jacocoConnectedTestsCoverageDir.get()}</span><span style=color:#e6db74>)}&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>ç„¶åæ‰§è¡Œ<code>createDebugCoverageReport</code>, è¾“å‡ºå¦‚ä¸‹ ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>&gt; Task :app:createDebugAndroidTestCoverageReport
</span></span><span style=display:flex><span>-&gt; JacocoReportTask task : createDebugAndroidTestCoverageReport , /Users/hanlyjiang/Wksp/project/AndroidTestSample/app/build/outputs/code_coverage/debugAndroidTest/connected<span style=color:#f92672>)}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&gt; Task :app:createDebugCoverageReport
</span></span></code></pre></div><h3 id=å°ç»“>å°ç»“<a hidden class=anchor aria-hidden=true href=#å°ç»“>#</a></h3><p>é€šè¿‡ä»¥ä¸Šä¿¡æ¯æˆ‘ä»¬å¯çŸ¥ï¼š</p><ol><li>åº”ç”¨ jacoco æ’ä»¶ä¹‹åï¼Œæœ¬åœ°å•å…ƒæµ‹è¯•ä»»åŠ¡ï¼ˆ<code>testDebugUnitTest</code>ï¼‰å°±ä¼šç”Ÿæˆ jacoco è¦†ç›–ç‡executionæ•°æ®æ–‡ä»¶ï¼Œä½†æ˜¯ä¸ä¼šç”ŸæˆhtmlæŠ¥å‘Šï¼›</li><li>å¼€å¯ isTestCoverageEnabled å¼€å…³ï¼Œä¼šç”Ÿæˆ <code>createDebugCoverageReport</code> ä»»åŠ¡ï¼Œè¯¥ä»»åŠ¡ä¼šæ‰§è¡Œä»ªå™¨å•å…ƒæµ‹è¯•ï¼ŒåŒæ—¶ç”Ÿæˆexecutionæ•°æ®æ–‡ä»¶ï¼Œå¹¶ç”ŸæˆhtmlæŠ¥å‘Šã€‚</li></ol><h2 id=ç”Ÿæˆ-html-æŠ¥å‘Š>ç”Ÿæˆ HTML æŠ¥å‘Š<a hidden class=anchor aria-hidden=true href=#ç”Ÿæˆ-html-æŠ¥å‘Š>#</a></h2><p>ç”±äºandroidTest å·²ç»ç”Ÿæˆäº†htmlæŠ¥å‘Šï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦è¦ä¸ºæˆ‘ä»¬çš„æœ¬åœ°å•å…ƒæµ‹è¯•ç”ŸæˆHTMLæŠ¥å‘Šã€‚</p><p>è¦ç”ŸæˆhtmlæŠ¥å‘Šï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç±»å‹ä¸º JacocoReport çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬åœ¨gradle ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼Œç”¨äºç”Ÿæˆ <code>jacocoTestDebugUnitTestReport</code> ä»»åŠ¡</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>apply(plugin = <span style=color:#e6db74>&#34;jacoco&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>android {
</span></span><span style=display:flex><span>    buildTypes {
</span></span><span style=display:flex><span>        getByName(<span style=color:#e6db74>&#34;debug&#34;</span>).apply {
</span></span><span style=display:flex><span>            isTestCoverageEnabled = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>afterEvaluate {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// ç”±äºæˆ‘ä»¬éœ€è¦è·å–å¯¹åº”çš„æºç åŠclassç›®å½•ï¼Œæ‰€ä»¥ä½¿ç”¨ android.applicationVariants forEach æ¥è·å–å˜ä½“
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	android.applicationVariants.forEach { variant <span style=color:#f92672>-&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (variant.buildType.isTestCoverageEnabled) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>val</span> variantCapName = variant.name.capitalize();
</span></span><span style=display:flex><span>            tasks.register(
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;jacocoTest</span><span style=color:#e6db74>${variantCapName}</span><span style=color:#e6db74>UnitTestReport&#34;</span>,
</span></span><span style=display:flex><span>                JacocoReport<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java
</span></span><span style=display:flex><span>            ) {
</span></span><span style=display:flex><span>                group = <span style=color:#e6db74>&#34;jacoco&#34;</span>
</span></span><span style=display:flex><span>              	<span style=color:#75715e>// ä¾èµ–æµ‹è¯•ä»»åŠ¡
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	              dependsOn(<span style=color:#e6db74>&#34;test</span><span style=color:#e6db74>${variantCapName}</span><span style=color:#e6db74>UnitTest&#34;</span>)
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>              	<span style=color:#75715e>// æ ¹æ®æ‰§è¡Œæ•°æ®ç”ŸæˆæŠ¥å‘Šï¼Œç›´æ¥ä¼ è¾“taskå³å¯
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                executionData(tasks.getByName(<span style=color:#e6db74>&#34;test</span><span style=color:#e6db74>${variantCapName}</span><span style=color:#e6db74>UnitTest&#34;</span>))
</span></span><span style=display:flex><span>              	<span style=color:#75715e>// æŠ¥å‘Šä¸­ä¼šåŒ…å«æºç ï¼Œå¯ä»¥æŸ¥çœ‹æºç çš„å¯¹åº”çš„è¦†ç›–æƒ…å†µ
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                sourceDirectories.from(variant.sourceSets.flatMap { <span style=color:#66d9ef>it</span>.javaDirectories + <span style=color:#66d9ef>it</span>.kotlinDirectories })
</span></span><span style=display:flex><span>                <span style=color:#75715e>// æ²¡æœ‰ class æ•°æ®æŠ¥å‘Šä¼šæ˜¯ç©ºçš„
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                classDirectories.from(variant.javaCompileProvider.<span style=color:#66d9ef>get</span>().destinationDirectory)
</span></span><span style=display:flex><span>              
</span></span><span style=display:flex><span>              	doLast {
</span></span><span style=display:flex><span>                    logger.lifecycle(reports.html.outputLocation.asFile.<span style=color:#66d9ef>get</span>().absolutePath)
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>æ·»åŠ ä¹‹å sync gradleï¼Œå³å¯ç”Ÿæˆä¸€ä¸ª <code>jacocoTestDebugUnitTestReport</code> çš„ä»»åŠ¡ï¼Œæ‰§è¡Œå®ƒå³å¯ç”Ÿæˆæµ‹è¯•æŠ¥å‘Šï¼Œç”Ÿæˆçš„æµ‹è¯•æŠ¥å‘Šä½äºï¼š <code>build/reports/jacoco/jacocoTestDebugUnitTestReport</code>ä¸­ã€‚</p><p>ä¸‹å›¾å°±æ˜¯æˆ‘ä»¬ç”Ÿæˆçš„æŠ¥å‘Šï¼Œå¯ä»¥çœ‹åˆ°StringUtilså·²ç»èƒ½å¤Ÿç»Ÿè®¡è¦†ç›–ç‡äº†ã€‚è€ŒMainActivityè¿˜æ²¡æœ‰æ•°æ®ã€‚</p><h2 id=ç”Ÿæˆåˆå¹¶htmlæŠ¥å‘Š>ç”Ÿæˆåˆå¹¶HTMLæŠ¥å‘Š<a hidden class=anchor aria-hidden=true href=#ç”Ÿæˆåˆå¹¶htmlæŠ¥å‘Š>#</a></h2><p>æˆ‘ä»¬å·²ç»å¯ä»¥ç”Ÿæˆæœ¬åœ°å•å…ƒæµ‹è¯•çš„è¦†ç›–ç‡æŠ¥å‘Šï¼Œç°åœ¨æˆ‘ä»¬éœ€è¦ç”ŸæˆandroidTest + test çš„åˆå¹¶æŠ¥å‘Šã€‚</p><p>ä¹‹å‰æˆ‘ä»¬å·²ç»çŸ¥é“ï¼š</p><ul><li>createDebugCoverageReport ä»»åŠ¡å³å¯ç”Ÿæˆ execution æ–‡ä»¶å¹¶ä¸”ç”ŸæˆhtmlæŠ¥å‘Š</li><li>æˆ‘ä»¬å·²ç»æ·»åŠ äº†ä¸€ä¸ªä»»åŠ¡å¯ä»¥ç”Ÿæˆæœ¬åœ°å•å…ƒæµ‹è¯•çš„æŠ¥å‘Šã€‚</li></ul><p>ç°åœ¨æˆ‘ä»¬è¦åšçš„æ˜¯å°†å®ƒä»¬åˆå¹¶ï¼Œä½†æ˜¯æˆ‘ä»¬çš„åˆå¹¶å¹¶ä¸æ˜¯é’ˆå¯¹htmlæŠ¥å‘Šï¼Œè€Œæ˜¯é’ˆå¯¹executionæ•°æ®ã€‚</p><p>è®©æˆ‘ä»¬æ·»åŠ å¦‚ä¸‹é…ç½®æ¥ç”Ÿæˆä¸€ä¸ªåˆå¹¶æŠ¥å‘Šçš„gradleä»»åŠ¡ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>apply(plugin = <span style=color:#e6db74>&#34;jacoco&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>android {
</span></span><span style=display:flex><span>    buildTypes {
</span></span><span style=display:flex><span>        getByName(<span style=color:#e6db74>&#34;debug&#34;</span>).apply {
</span></span><span style=display:flex><span>            isTestCoverageEnabled = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>afterEvaluate {
</span></span><span style=display:flex><span>    android.applicationVariants.forEach { variant <span style=color:#f92672>-&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (variant.buildType.isTestCoverageEnabled) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>val</span> variantCapName = variant.name.capitalize();
</span></span><span style=display:flex><span>            tasks.register(<span style=color:#e6db74>&#34;mergedJacoco</span><span style=color:#e6db74>${variantCapName}</span><span style=color:#e6db74>TestReport&#34;</span>, JacocoReport<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java) {
</span></span><span style=display:flex><span>                group = <span style=color:#e6db74>&#34;jacoco&#34;</span>
</span></span><span style=display:flex><span>                executionData(
</span></span><span style=display:flex><span>                    tasks.getByName(<span style=color:#e6db74>&#34;test</span><span style=color:#e6db74>${variantCapName}</span><span style=color:#e6db74>UnitTest&#34;</span>),
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>val</span> androidCoverageTask =
</span></span><span style=display:flex><span>                    tasks.getByName(<span style=color:#e6db74>&#34;create</span><span style=color:#e6db74>${variantCapName}</span><span style=color:#e6db74>AndroidTestCoverageReport&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (androidCoverageTask <span style=color:#66d9ef>is</span> com.android.build.gradle.<span style=color:#66d9ef>internal</span>.coverage.JacocoReportTask) {
</span></span><span style=display:flex><span>                    executionData(androidCoverageTask.jacocoConnectedTestsCoverageDir.asFileTree)
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                sourceDirectories.from(variant.sourceSets.flatMap { <span style=color:#66d9ef>it</span>.javaDirectories + <span style=color:#66d9ef>it</span>.kotlinDirectories })
</span></span><span style=display:flex><span>                classDirectories.from(variant.javaCompileProvider.<span style=color:#66d9ef>get</span>().destinationDirectory)
</span></span><span style=display:flex><span>                dependsOn(
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;test</span><span style=color:#e6db74>${variantCapName}</span><span style=color:#e6db74>UnitTest&#34;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;create</span><span style=color:#e6db74>${variantCapName}</span><span style=color:#e6db74>AndroidTestCoverageReport&#34;</span>
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>              	doLast {
</span></span><span style=display:flex><span>                    logger.lifecycle(reports.html.outputLocation.asFile.<span style=color:#66d9ef>get</span>().absolutePath)
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿™æ ·ï¼Œæˆ‘ä»¬ä¾¿æœ‰äº†ä¸€ä¸ª <code>mergedJacocoDebugTestReport</code> çš„ä»»åŠ¡ï¼Œæ‰§è¡Œåå³å¯åœ¨<code>build/reports/jacoco/mergedJacocoDebugTestReport/html</code> ç›®å½•ä¸­æ‰¾åˆ°æˆ‘ä»¬çš„ report ã€‚</p><p>ç°åœ¨å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬çš„MainActivityï¼ˆAndroidTestï¼‰åŠStringUtilsï¼ˆtestï¼‰å¯ä»¥åœ¨ä¸€ä»½æŠ¥å‘Šä¸­æ˜¾ç¤ºè¦†ç›–ç‡æ•°æ®äº†ã€‚</p><h2 id=ç”Ÿæˆåˆå¹¶-execution-æ•°æ®æ–‡ä»¶>ç”Ÿæˆåˆå¹¶ Execution æ•°æ®æ–‡ä»¶<a hidden class=anchor aria-hidden=true href=#ç”Ÿæˆåˆå¹¶-execution-æ•°æ®æ–‡ä»¶>#</a></h2><p>åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»ç”Ÿæˆäº†HTMLç‰ˆæœ¬çš„åˆå¹¶æŠ¥å‘Šï¼Œå¹¶ä¸”å¯ä»¥åœ¨å…¶ä¸­çœ‹åˆ°æºç æ²¡ä¸€è¡Œè¦†ç›–çš„æƒ…å†µã€‚</p><p>ä½†æ˜¯ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿåœ¨AndroidStudioçš„ç¼–è¾‘å™¨ä¸­æ˜¾ç¤ºè¦†ç›–ç‡çš„æƒ…å†µï¼Œå‘ä¸‹é¢è¿™æ ·ğŸ‘‡ï¼š</p><p>å®é™…ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡AndroidStudioçš„<code>Menu-Run-Show Covarage Data</code>åŠ è½½ execution æ–‡ä»¶ï¼Œç„¶ååœ¨AndroidStudioä¸­æ˜¾ç¤ºè¦†ç›–ç‡æ•°æ®ã€‚</p><p>æ‰§è¡Œçš„æ•°æ®æ–‡ä»¶ä½äºç±»ä¼¼å¦‚ä¸‹ç›®å½• ï¼š</p><ul><li>build/outputs/unit_test_code_coverage/debugUnitTest/testDebugUnitTest.exec</li><li>build/outputs/code_coverage/debugAndroidTest/connected/Pixel_5_API_Tiramisu(AVD) - 12/coverage.ec</li></ul><p>ä½†æ˜¯è¿™é‡Œæœ‰ä¸¤ä¸ªé—®é¢˜ï¼š</p><ol><li>debugAndroidTest ç›®å½•ä¸­çš„ <code>.ec</code> æ–‡ä»¶æ— æ³•è¢«AndroidStudioè¯†åˆ«ã€‚</li><li>è¿™ä¸¤ä¸ªæ–‡ä»¶æ˜¯åˆ†å¼€çš„ï¼Œæ¯ä¸€ä¸ªæ–‡ä»¶åªåŒ…å«ä¸€ç§æµ‹è¯•çš„è¦†ç›–æ•°æ®ã€‚</li></ol><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªåˆå¹¶ä»»åŠ¡ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>
</span></span><span style=display:flex><span>afterEvaluate {
</span></span><span style=display:flex><span>    tasks.getByName(<span style=color:#e6db74>&#34;testDebugUnitTest&#34;</span>).apply {
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>this</span>.extensions.getByName(<span style=color:#e6db74>&#34;jacoco&#34;</span>) <span style=color:#66d9ef>as</span> JacocoTaskExtension).apply {
</span></span><span style=display:flex><span>            logger.lifecycle(<span style=color:#e6db74>&#34;testDebugUnitTest dest: </span><span style=color:#e6db74>${this.destinationFile?.absolutePath}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    tasks.withType(org.gradle.api.tasks.testing.Test<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java) {
</span></span><span style=display:flex><span>        logger.lifecycle(<span style=color:#e6db74>&#34;-&gt; test task : </span><span style=color:#e6db74>$name</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    tasks.withType(JacocoReport<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java) {
</span></span><span style=display:flex><span>        logger.lifecycle(<span style=color:#e6db74>&#34;-&gt; JacocoReport task : </span><span style=color:#e6db74>$name</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    tasks.withType(com.android.build.gradle.<span style=color:#66d9ef>internal</span>.coverage.JacocoReportTask<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java) {
</span></span><span style=display:flex><span>        logger.lifecycle(<span style=color:#e6db74>&#34;-&gt; JacocoReportTask task : </span><span style=color:#e6db74>$name</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        doFirst {
</span></span><span style=display:flex><span>            logger.lifecycle(<span style=color:#e6db74>&#34;-&gt; JacocoReportTask task : </span><span style=color:#e6db74>$name</span><span style=color:#e6db74> , </span><span style=color:#e6db74>${jacocoConnectedTestsCoverageDir.get()}</span><span style=color:#e6db74>)}&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    android.applicationVariants.forEach { variant <span style=color:#f92672>-&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (variant.buildType.isTestCoverageEnabled) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>val</span> variantCapName = variant.name.capitalize();
</span></span><span style=display:flex><span>            tasks.register(
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;jacocoTest</span><span style=color:#e6db74>${variantCapName}</span><span style=color:#e6db74>UnitTestReport&#34;</span>,
</span></span><span style=display:flex><span>                JacocoReport<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java
</span></span><span style=display:flex><span>            ) {
</span></span><span style=display:flex><span>                group = <span style=color:#e6db74>&#34;jacoco&#34;</span>
</span></span><span style=display:flex><span>                executionData(tasks.getByName(<span style=color:#e6db74>&#34;test</span><span style=color:#e6db74>${variantCapName}</span><span style=color:#e6db74>UnitTest&#34;</span>))
</span></span><span style=display:flex><span>                sourceDirectories.from(variant.sourceSets.flatMap { <span style=color:#66d9ef>it</span>.javaDirectories + <span style=color:#66d9ef>it</span>.kotlinDirectories })
</span></span><span style=display:flex><span>                classDirectories.from(variant.javaCompileProvider.<span style=color:#66d9ef>get</span>().destinationDirectory)
</span></span><span style=display:flex><span>                dependsOn(<span style=color:#e6db74>&#34;test</span><span style=color:#e6db74>${variantCapName}</span><span style=color:#e6db74>UnitTest&#34;</span>)
</span></span><span style=display:flex><span>                doLast {
</span></span><span style=display:flex><span>                    logger.lifecycle(<span style=color:#e6db74>&#34;Jacoco Report: &#34;</span> + reports.html.outputLocation.asFile.<span style=color:#66d9ef>get</span>().absolutePath)
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            tasks.register(<span style=color:#e6db74>&#34;mergedJacoco</span><span style=color:#e6db74>${variantCapName}</span><span style=color:#e6db74>TestReport&#34;</span>, JacocoReport<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java) {
</span></span><span style=display:flex><span>                group = <span style=color:#e6db74>&#34;jacoco&#34;</span>
</span></span><span style=display:flex><span>                executionData(
</span></span><span style=display:flex><span>                    tasks.getByName(<span style=color:#e6db74>&#34;test</span><span style=color:#e6db74>${variantCapName}</span><span style=color:#e6db74>UnitTest&#34;</span>),
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>val</span> androidCoverageTask =
</span></span><span style=display:flex><span>                    tasks.getByName(<span style=color:#e6db74>&#34;create</span><span style=color:#e6db74>${variantCapName}</span><span style=color:#e6db74>AndroidTestCoverageReport&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (androidCoverageTask <span style=color:#66d9ef>is</span> com.android.build.gradle.<span style=color:#66d9ef>internal</span>.coverage.JacocoReportTask) {
</span></span><span style=display:flex><span>                    executionData(androidCoverageTask.jacocoConnectedTestsCoverageDir.asFileTree)
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                sourceDirectories.from(variant.sourceSets.flatMap { <span style=color:#66d9ef>it</span>.javaDirectories + <span style=color:#66d9ef>it</span>.kotlinDirectories })
</span></span><span style=display:flex><span>                classDirectories.from(variant.javaCompileProvider.<span style=color:#66d9ef>get</span>().destinationDirectory)
</span></span><span style=display:flex><span>                dependsOn(
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;test</span><span style=color:#e6db74>${variantCapName}</span><span style=color:#e6db74>UnitTest&#34;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;create</span><span style=color:#e6db74>${variantCapName}</span><span style=color:#e6db74>AndroidTestCoverageReport&#34;</span>
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>                doLast {
</span></span><span style=display:flex><span>                    logger.lifecycle(<span style=color:#e6db74>&#34;Jacoco Report: &#34;</span> + reports.html.outputLocation.asFile.<span style=color:#66d9ef>get</span>().absolutePath)
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            tasks.register(<span style=color:#e6db74>&#34;mergeJacoco</span><span style=color:#e6db74>${variantCapName}</span><span style=color:#e6db74>Execution&#34;</span>, JacocoMerge<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java) {
</span></span><span style=display:flex><span>                group = <span style=color:#e6db74>&#34;jacoco&#34;</span>
</span></span><span style=display:flex><span>                executionData(
</span></span><span style=display:flex><span>                    tasks.getByName(<span style=color:#e6db74>&#34;test</span><span style=color:#e6db74>${variantCapName}</span><span style=color:#e6db74>UnitTest&#34;</span>),
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>val</span> androidCoverageTask =
</span></span><span style=display:flex><span>                    tasks.getByName(<span style=color:#e6db74>&#34;create</span><span style=color:#e6db74>${variantCapName}</span><span style=color:#e6db74>AndroidTestCoverageReport&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (androidCoverageTask <span style=color:#66d9ef>is</span> com.android.build.gradle.<span style=color:#66d9ef>internal</span>.coverage.JacocoReportTask) {
</span></span><span style=display:flex><span>                    executionData(androidCoverageTask.jacocoConnectedTestsCoverageDir.asFileTree)
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                doLast {
</span></span><span style=display:flex><span>                    logger.lifecycle(<span style=color:#e6db74>&#34;Jacoco Execution: &#34;</span> + destinationFile.absolutePath)
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>æ‰§è¡Œä¹‹åä½äºï¼š<code>build/jacoco/mergeJacocoDebugExecution.exec</code>, é€šè¿‡AndroidStudio åŠ è½½ä¹‹åï¼Œæ˜¾ç¤ºå¦‚ä¸‹ï¼Œä¸¤ç§æµ‹è¯•çš„ç»“æœå·²ç»åˆå¹¶æ˜¾ç¤ºäº†ã€‚</p><h2 id=å®Œæ•´é…ç½®æ–‡ä»¶>å®Œæ•´é…ç½®æ–‡ä»¶<a hidden class=anchor aria-hidden=true href=#å®Œæ•´é…ç½®æ–‡ä»¶>#</a></h2><p>è¯·å‚è€ƒï¼š <a href=https://github.com/hanlyjiang/AndroidTestSample/blob/main/app/build.gradle.kts>AndroidTestSample/build.gradle.kts at main Â· hanlyjiang/AndroidTestSample (github.com)</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://hanlyjiang.github.io/tags/android/>Android</a></li><li><a href=https://hanlyjiang.github.io/tags/%E6%B5%8B%E8%AF%95/>æµ‹è¯•</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://hanlyjiang.github.io/>æ¸…æ°´æ± å¡˜</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>