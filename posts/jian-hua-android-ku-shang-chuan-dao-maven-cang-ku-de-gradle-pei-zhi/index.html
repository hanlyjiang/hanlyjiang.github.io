<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>简化Android库上传到Maven仓库的gradle配置 | 清水池塘</title><meta name=keywords content="Gradle,Android,工具"><meta name=description content='配置 android 上传到 maven 中心仓库，发现配置的代码有点多，而且如果有多个库模块需要上传，则需要复制粘贴不少重复的配置代码，于是编写了一个 gradle 插件用于简化提取这个配置过程；
插件用途及效果
本插件用于简化Android库上传到Maven中心仓库的配置，避免每个project的gradle中都放置一份重复较多的配置；
插件有如下功能：

简化 maven-publish 插件的配置流程；
添加上传到Maven中心仓库的 publish 任务；
支持配置上传时是否包含 javadoc 及源码；

直接使用maven-publish插件的配置：
import org.gradle.api.publish.maven.MavenPom

plugins {
    id("com.android.library")
    id("signing")
    `maven-publish`
}

android {
    defaultConfig {
        versionName("1.0.0-SNAPSHOT")
    }
}

dependencies {
   // 
}

tasks.register("javadoc", Javadoc::class.java) {
    group = "publishing"
    dependsOn("assemble")
    source = android.sourceSets["main"].java.getSourceFiles()
    classpath += project.files(android.bootClasspath + File.pathSeparator)
    if (JavaVersion.current().isJava9Compatible) {
        (options as StandardJavadocDocletOptions).addBooleanOption("html5", true)
    }
    android.libraryVariants.forEach { libraryVariant ->
        classpath += libraryVariant.javaCompileProvider.get().classpath
    }
    options.apply {
        encoding("UTF-8")
        charset("UTF-8")
        isFailOnError = false

        (this as StandardJavadocDocletOptions).apply {
//            addStringOption("Xdoclint:none")
            links?.add("https://developer.android.google.cn/reference/")
            links?.add("http://docs.oracle.com/javase/8/docs/api/")
        }
    }
}

tasks.register("jarSource", Jar::class.java) {
    group = "publishing"
    from(android.sourceSets["main"].java.srcDirs)
    archiveClassifier.set("sources")
}

tasks.register("jarJavadoc", Jar::class.java) {
    group = "publishing"
    dependsOn("javadoc")
    val javadoc: Javadoc = tasks.getByName("javadoc") as Javadoc
    from(javadoc.destinationDir)
    archiveClassifier.set("javadoc")
}

fun getMyPom(): Action<in MavenPom> {
    return Action<MavenPom> {
        name.set("Android Common Utils Lib")
        description.set("Android Common Utils Library For HJ")
        url.set("https://github.com/hanlyjiang/lib_common_utils")
        licenses {
            license {
                name.set("The Apache License, Version 2.0")
                url.set("http://www.apache.org/licenses/LICENSE-2.0.txt")
            }
        }
        developers {
            developer {
                id.set("hanlyjiang")
                name.set("Hanly Jiang")
                email.set("hanlyjiang@outlook.com")
            }
        }
        scm {
            connection.set("scm:git:git://github.com/hanlyjiang/lib_common_utils.git")
            developerConnection.set("scm:git:ssh://github.com/hanlyjiang/lib_common_utils.git")
            url.set("https://github.com/hanlyjiang/lib_common_utils")
        }
    }
}


afterEvaluate {
    publishing {
        publications {
            create<MavenPublication>("release") {
                from(components.getByName("release"))
                groupId = "com.github.hanlyjiang"
                artifactId = "android_common_utils"
                version = android.defaultConfig.versionName
                pom(getMyPom())
                // 添加javadoc
                artifact(tasks.getByName("jarJavadoc") as Jar)
                // 添加source
                artifact(tasks.getByName("jarSource") as Jar)
            }
        }

        repositories {
            val ossrhCredentials = Action<PasswordCredentials> {
                username = properties["ossrhUsername"].toString()
                password = properties["ossrhPassword"].toString()
            }
            // sonar的仓库，地址根据项目的版本号来确定是snapshot还是正式仓库
            maven {
                name = "Sonartype"

                val releasesRepoUrl = uri("https://oss.sonatype.org/service/local/staging/deploy/maven2")
                val snapshotsRepoUrl = uri("https://oss.sonatype.org/content/repositories/snapshots/")
                url = if (android.defaultConfig.versionName.toString().endsWith("SNAPSHOT")) snapshotsRepoUrl else releasesRepoUrl
                credentials(ossrhCredentials)
                // snapshot的地址：
                // https://oss.sonatype.org/content/repositories/snapshots/com/github/hanlyjiang/android_common_utils/
            }
            // 项目本地的仓库
            maven {
                name = "ProjectLocal"

                val releasesRepoUrl = uri(layout.buildDirectory.dir("repos/releases"))
                val snapshotsRepoUrl = uri(layout.buildDirectory.dir("repos/snapshots"))
                url = if (android.defaultConfig.versionName.toString().endsWith("SNAPSHOT")) snapshotsRepoUrl else releasesRepoUrl
            }
        }
    }

    signing {
        sign(publishing.publications.getByName("release"))
    }

}
使用AndroidMavenPubPlugin简化后的配置：
import org.gradle.api.publish.maven.MavenPom


plugins {
    id("com.android.library")
    id("signing")
    `maven-publish`
    // 引入我们本地仓库中的gradle插件
    id("com.github.hanlyjiang.android_maven_pub") version ("0.0.5") apply (false)
}

android {
    defaultConfig {
        versionName("1.0.1-SNAPSHOT")
    }
}

dependencies {
  // 
}

apply(plugin = "com.github.hanlyjiang.android_maven_pub")

configure<io.hanlyjiang.gradle.android.AndroidMavenPubPluginExtension> {
    groupId.set("com.github.hanlyjiang")
    artifactId.set("android-common-utils")
    projectLocalRepoPath.set("local-maven-repo")
    mavenPomAction.set(Action<MavenPom> {
        name.set("Android Common Utils Lib")
        description.set("Android Common Utils Library For HJ")
        url.set("https://github.com/hanlyjiang/lib_common_utils")
        properties.set(
            mapOf(
                "myProp" to "value",
                "prop.with.dots" to "anotherValue"
            )
        )
        licenses {
            license {
                name.set("The Apache License, Version 2.0")
                url.set("http://www.apache.org/licenses/LICENSE-2.0.txt")
            }
        }
        developers {
            developer {
                id.set("hanlyjiang")
                name.set("Hanly Jiang")
                email.set("hanlyjiang@outlook.com")
            }
        }
        scm {
            connection.set("scm:git:git://github.com/hanlyjiang/lib_common_utils.git")
            developerConnection.set("scm:git:ssh://github.com/hanlyjiang/lib_common_utils.git")
            url.set("https://github.com/hanlyjiang/lib_common_utils")
        }
    })
}
使用步骤
引入插件
在需要使用的模块的build脚本中，引入我们的插件，同时引入 maven-publish 插件和 signing 插件。'><meta name=author content="野生莲藕"><link rel=canonical href=https://anlyjiang.github.io/posts/jian-hua-android-ku-shang-chuan-dao-maven-cang-ku-de-gradle-pei-zhi/><link crossorigin=anonymous href=/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css integrity="sha256-NDzEgLn/yPBMy+XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as=style><link rel=icon href=https://anlyjiang.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://anlyjiang.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://anlyjiang.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://anlyjiang.github.io/apple-touch-icon.png><link rel=mask-icon href=https://anlyjiang.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://anlyjiang.github.io/posts/jian-hua-android-ku-shang-chuan-dao-maven-cang-ku-de-gradle-pei-zhi/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="https://anlyjiang.github.io/posts/jian-hua-android-ku-shang-chuan-dao-maven-cang-ku-de-gradle-pei-zhi/"><meta property="og:site_name" content="清水池塘"><meta property="og:title" content="简化Android库上传到Maven仓库的gradle配置"><meta property="og:description" content='配置 android 上传到 maven 中心仓库，发现配置的代码有点多，而且如果有多个库模块需要上传，则需要复制粘贴不少重复的配置代码，于是编写了一个 gradle 插件用于简化提取这个配置过程；
插件用途及效果 本插件用于简化Android库上传到Maven中心仓库的配置，避免每个project的gradle中都放置一份重复较多的配置；
插件有如下功能：
简化 maven-publish 插件的配置流程； 添加上传到Maven中心仓库的 publish 任务； 支持配置上传时是否包含 javadoc 及源码； 直接使用maven-publish插件的配置： import org.gradle.api.publish.maven.MavenPom plugins { id("com.android.library") id("signing") `maven-publish` } android { defaultConfig { versionName("1.0.0-SNAPSHOT") } } dependencies { // } tasks.register("javadoc", Javadoc::class.java) { group = "publishing" dependsOn("assemble") source = android.sourceSets["main"].java.getSourceFiles() classpath += project.files(android.bootClasspath + File.pathSeparator) if (JavaVersion.current().isJava9Compatible) { (options as StandardJavadocDocletOptions).addBooleanOption("html5", true) } android.libraryVariants.forEach { libraryVariant -> classpath += libraryVariant.javaCompileProvider.get().classpath } options.apply { encoding("UTF-8") charset("UTF-8") isFailOnError = false (this as StandardJavadocDocletOptions).apply { // addStringOption("Xdoclint:none") links?.add("https://developer.android.google.cn/reference/") links?.add("http://docs.oracle.com/javase/8/docs/api/") } } } tasks.register("jarSource", Jar::class.java) { group = "publishing" from(android.sourceSets["main"].java.srcDirs) archiveClassifier.set("sources") } tasks.register("jarJavadoc", Jar::class.java) { group = "publishing" dependsOn("javadoc") val javadoc: Javadoc = tasks.getByName("javadoc") as Javadoc from(javadoc.destinationDir) archiveClassifier.set("javadoc") } fun getMyPom(): Action<in MavenPom> { return Action<MavenPom> { name.set("Android Common Utils Lib") description.set("Android Common Utils Library For HJ") url.set("https://github.com/hanlyjiang/lib_common_utils") licenses { license { name.set("The Apache License, Version 2.0") url.set("http://www.apache.org/licenses/LICENSE-2.0.txt") } } developers { developer { id.set("hanlyjiang") name.set("Hanly Jiang") email.set("hanlyjiang@outlook.com") } } scm { connection.set("scm:git:git://github.com/hanlyjiang/lib_common_utils.git") developerConnection.set("scm:git:ssh://github.com/hanlyjiang/lib_common_utils.git") url.set("https://github.com/hanlyjiang/lib_common_utils") } } } afterEvaluate { publishing { publications { create<MavenPublication>("release") { from(components.getByName("release")) groupId = "com.github.hanlyjiang" artifactId = "android_common_utils" version = android.defaultConfig.versionName pom(getMyPom()) // 添加javadoc artifact(tasks.getByName("jarJavadoc") as Jar) // 添加source artifact(tasks.getByName("jarSource") as Jar) } } repositories { val ossrhCredentials = Action<PasswordCredentials> { username = properties["ossrhUsername"].toString() password = properties["ossrhPassword"].toString() } // sonar的仓库，地址根据项目的版本号来确定是snapshot还是正式仓库 maven { name = "Sonartype" val releasesRepoUrl = uri("https://oss.sonatype.org/service/local/staging/deploy/maven2") val snapshotsRepoUrl = uri("https://oss.sonatype.org/content/repositories/snapshots/") url = if (android.defaultConfig.versionName.toString().endsWith("SNAPSHOT")) snapshotsRepoUrl else releasesRepoUrl credentials(ossrhCredentials) // snapshot的地址： // https://oss.sonatype.org/content/repositories/snapshots/com/github/hanlyjiang/android_common_utils/ } // 项目本地的仓库 maven { name = "ProjectLocal" val releasesRepoUrl = uri(layout.buildDirectory.dir("repos/releases")) val snapshotsRepoUrl = uri(layout.buildDirectory.dir("repos/snapshots")) url = if (android.defaultConfig.versionName.toString().endsWith("SNAPSHOT")) snapshotsRepoUrl else releasesRepoUrl } } } signing { sign(publishing.publications.getByName("release")) } } 使用AndroidMavenPubPlugin简化后的配置： import org.gradle.api.publish.maven.MavenPom plugins { id("com.android.library") id("signing") `maven-publish` // 引入我们本地仓库中的gradle插件 id("com.github.hanlyjiang.android_maven_pub") version ("0.0.5") apply (false) } android { defaultConfig { versionName("1.0.1-SNAPSHOT") } } dependencies { // } apply(plugin = "com.github.hanlyjiang.android_maven_pub") configure<io.hanlyjiang.gradle.android.AndroidMavenPubPluginExtension> { groupId.set("com.github.hanlyjiang") artifactId.set("android-common-utils") projectLocalRepoPath.set("local-maven-repo") mavenPomAction.set(Action<MavenPom> { name.set("Android Common Utils Lib") description.set("Android Common Utils Library For HJ") url.set("https://github.com/hanlyjiang/lib_common_utils") properties.set( mapOf( "myProp" to "value", "prop.with.dots" to "anotherValue" ) ) licenses { license { name.set("The Apache License, Version 2.0") url.set("http://www.apache.org/licenses/LICENSE-2.0.txt") } } developers { developer { id.set("hanlyjiang") name.set("Hanly Jiang") email.set("hanlyjiang@outlook.com") } } scm { connection.set("scm:git:git://github.com/hanlyjiang/lib_common_utils.git") developerConnection.set("scm:git:ssh://github.com/hanlyjiang/lib_common_utils.git") url.set("https://github.com/hanlyjiang/lib_common_utils") } }) } 使用步骤 引入插件 在需要使用的模块的build脚本中，引入我们的插件，同时引入 maven-publish 插件和 signing 插件。'><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-06-01T10:26:00+00:00"><meta property="article:modified_time" content="2021-06-01T10:26:00+00:00"><meta property="article:tag" content="Gradle"><meta property="article:tag" content="Android"><meta property="article:tag" content="工具"><meta name=twitter:card content="summary"><meta name=twitter:title content="简化Android库上传到Maven仓库的gradle配置"><meta name=twitter:description content='配置 android 上传到 maven 中心仓库，发现配置的代码有点多，而且如果有多个库模块需要上传，则需要复制粘贴不少重复的配置代码，于是编写了一个 gradle 插件用于简化提取这个配置过程；
插件用途及效果
本插件用于简化Android库上传到Maven中心仓库的配置，避免每个project的gradle中都放置一份重复较多的配置；
插件有如下功能：

简化 maven-publish 插件的配置流程；
添加上传到Maven中心仓库的 publish 任务；
支持配置上传时是否包含 javadoc 及源码；

直接使用maven-publish插件的配置：
import org.gradle.api.publish.maven.MavenPom

plugins {
    id("com.android.library")
    id("signing")
    `maven-publish`
}

android {
    defaultConfig {
        versionName("1.0.0-SNAPSHOT")
    }
}

dependencies {
   // 
}

tasks.register("javadoc", Javadoc::class.java) {
    group = "publishing"
    dependsOn("assemble")
    source = android.sourceSets["main"].java.getSourceFiles()
    classpath += project.files(android.bootClasspath + File.pathSeparator)
    if (JavaVersion.current().isJava9Compatible) {
        (options as StandardJavadocDocletOptions).addBooleanOption("html5", true)
    }
    android.libraryVariants.forEach { libraryVariant ->
        classpath += libraryVariant.javaCompileProvider.get().classpath
    }
    options.apply {
        encoding("UTF-8")
        charset("UTF-8")
        isFailOnError = false

        (this as StandardJavadocDocletOptions).apply {
//            addStringOption("Xdoclint:none")
            links?.add("https://developer.android.google.cn/reference/")
            links?.add("http://docs.oracle.com/javase/8/docs/api/")
        }
    }
}

tasks.register("jarSource", Jar::class.java) {
    group = "publishing"
    from(android.sourceSets["main"].java.srcDirs)
    archiveClassifier.set("sources")
}

tasks.register("jarJavadoc", Jar::class.java) {
    group = "publishing"
    dependsOn("javadoc")
    val javadoc: Javadoc = tasks.getByName("javadoc") as Javadoc
    from(javadoc.destinationDir)
    archiveClassifier.set("javadoc")
}

fun getMyPom(): Action<in MavenPom> {
    return Action<MavenPom> {
        name.set("Android Common Utils Lib")
        description.set("Android Common Utils Library For HJ")
        url.set("https://github.com/hanlyjiang/lib_common_utils")
        licenses {
            license {
                name.set("The Apache License, Version 2.0")
                url.set("http://www.apache.org/licenses/LICENSE-2.0.txt")
            }
        }
        developers {
            developer {
                id.set("hanlyjiang")
                name.set("Hanly Jiang")
                email.set("hanlyjiang@outlook.com")
            }
        }
        scm {
            connection.set("scm:git:git://github.com/hanlyjiang/lib_common_utils.git")
            developerConnection.set("scm:git:ssh://github.com/hanlyjiang/lib_common_utils.git")
            url.set("https://github.com/hanlyjiang/lib_common_utils")
        }
    }
}


afterEvaluate {
    publishing {
        publications {
            create<MavenPublication>("release") {
                from(components.getByName("release"))
                groupId = "com.github.hanlyjiang"
                artifactId = "android_common_utils"
                version = android.defaultConfig.versionName
                pom(getMyPom())
                // 添加javadoc
                artifact(tasks.getByName("jarJavadoc") as Jar)
                // 添加source
                artifact(tasks.getByName("jarSource") as Jar)
            }
        }

        repositories {
            val ossrhCredentials = Action<PasswordCredentials> {
                username = properties["ossrhUsername"].toString()
                password = properties["ossrhPassword"].toString()
            }
            // sonar的仓库，地址根据项目的版本号来确定是snapshot还是正式仓库
            maven {
                name = "Sonartype"

                val releasesRepoUrl = uri("https://oss.sonatype.org/service/local/staging/deploy/maven2")
                val snapshotsRepoUrl = uri("https://oss.sonatype.org/content/repositories/snapshots/")
                url = if (android.defaultConfig.versionName.toString().endsWith("SNAPSHOT")) snapshotsRepoUrl else releasesRepoUrl
                credentials(ossrhCredentials)
                // snapshot的地址：
                // https://oss.sonatype.org/content/repositories/snapshots/com/github/hanlyjiang/android_common_utils/
            }
            // 项目本地的仓库
            maven {
                name = "ProjectLocal"

                val releasesRepoUrl = uri(layout.buildDirectory.dir("repos/releases"))
                val snapshotsRepoUrl = uri(layout.buildDirectory.dir("repos/snapshots"))
                url = if (android.defaultConfig.versionName.toString().endsWith("SNAPSHOT")) snapshotsRepoUrl else releasesRepoUrl
            }
        }
    }

    signing {
        sign(publishing.publications.getByName("release"))
    }

}
使用AndroidMavenPubPlugin简化后的配置：
import org.gradle.api.publish.maven.MavenPom


plugins {
    id("com.android.library")
    id("signing")
    `maven-publish`
    // 引入我们本地仓库中的gradle插件
    id("com.github.hanlyjiang.android_maven_pub") version ("0.0.5") apply (false)
}

android {
    defaultConfig {
        versionName("1.0.1-SNAPSHOT")
    }
}

dependencies {
  // 
}

apply(plugin = "com.github.hanlyjiang.android_maven_pub")

configure<io.hanlyjiang.gradle.android.AndroidMavenPubPluginExtension> {
    groupId.set("com.github.hanlyjiang")
    artifactId.set("android-common-utils")
    projectLocalRepoPath.set("local-maven-repo")
    mavenPomAction.set(Action<MavenPom> {
        name.set("Android Common Utils Lib")
        description.set("Android Common Utils Library For HJ")
        url.set("https://github.com/hanlyjiang/lib_common_utils")
        properties.set(
            mapOf(
                "myProp" to "value",
                "prop.with.dots" to "anotherValue"
            )
        )
        licenses {
            license {
                name.set("The Apache License, Version 2.0")
                url.set("http://www.apache.org/licenses/LICENSE-2.0.txt")
            }
        }
        developers {
            developer {
                id.set("hanlyjiang")
                name.set("Hanly Jiang")
                email.set("hanlyjiang@outlook.com")
            }
        }
        scm {
            connection.set("scm:git:git://github.com/hanlyjiang/lib_common_utils.git")
            developerConnection.set("scm:git:ssh://github.com/hanlyjiang/lib_common_utils.git")
            url.set("https://github.com/hanlyjiang/lib_common_utils")
        }
    })
}
使用步骤
引入插件
在需要使用的模块的build脚本中，引入我们的插件，同时引入 maven-publish 插件和 signing 插件。'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://anlyjiang.github.io/posts/"},{"@type":"ListItem","position":2,"name":"简化Android库上传到Maven仓库的gradle配置","item":"https://anlyjiang.github.io/posts/jian-hua-android-ku-shang-chuan-dao-maven-cang-ku-de-gradle-pei-zhi/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"简化Android库上传到Maven仓库的gradle配置","name":"简化Android库上传到Maven仓库的gradle配置","description":"配置 android 上传到 maven 中心仓库，发现配置的代码有点多，而且如果有多个库模块需要上传，则需要复制粘贴不少重复的配置代码，于是编写了一个 gradle 插件用于简化提取这个配置过程；\n插件用途及效果 本插件用于简化Android库上传到Maven中心仓库的配置，避免每个project的gradle中都放置一份重复较多的配置；\n插件有如下功能：\n简化 maven-publish 插件的配置流程； 添加上传到Maven中心仓库的 publish 任务； 支持配置上传时是否包含 javadoc 及源码； 直接使用maven-publish插件的配置： import org.gradle.api.publish.maven.MavenPom plugins { id(\u0026#34;com.android.library\u0026#34;) id(\u0026#34;signing\u0026#34;) `maven-publish` } android { defaultConfig { versionName(\u0026#34;1.0.0-SNAPSHOT\u0026#34;) } } dependencies { // } tasks.register(\u0026#34;javadoc\u0026#34;, Javadoc::class.java) { group = \u0026#34;publishing\u0026#34; dependsOn(\u0026#34;assemble\u0026#34;) source = android.sourceSets[\u0026#34;main\u0026#34;].java.getSourceFiles() classpath += project.files(android.bootClasspath + File.pathSeparator) if (JavaVersion.current().isJava9Compatible) { (options as StandardJavadocDocletOptions).addBooleanOption(\u0026#34;html5\u0026#34;, true) } android.libraryVariants.forEach { libraryVariant -\u0026gt; classpath += libraryVariant.javaCompileProvider.get().classpath } options.apply { encoding(\u0026#34;UTF-8\u0026#34;) charset(\u0026#34;UTF-8\u0026#34;) isFailOnError = false (this as StandardJavadocDocletOptions).apply { // addStringOption(\u0026#34;Xdoclint:none\u0026#34;) links?.add(\u0026#34;https://developer.android.google.cn/reference/\u0026#34;) links?.add(\u0026#34;http://docs.oracle.com/javase/8/docs/api/\u0026#34;) } } } tasks.register(\u0026#34;jarSource\u0026#34;, Jar::class.java) { group = \u0026#34;publishing\u0026#34; from(android.sourceSets[\u0026#34;main\u0026#34;].java.srcDirs) archiveClassifier.set(\u0026#34;sources\u0026#34;) } tasks.register(\u0026#34;jarJavadoc\u0026#34;, Jar::class.java) { group = \u0026#34;publishing\u0026#34; dependsOn(\u0026#34;javadoc\u0026#34;) val javadoc: Javadoc = tasks.getByName(\u0026#34;javadoc\u0026#34;) as Javadoc from(javadoc.destinationDir) archiveClassifier.set(\u0026#34;javadoc\u0026#34;) } fun getMyPom(): Action\u0026lt;in MavenPom\u0026gt; { return Action\u0026lt;MavenPom\u0026gt; { name.set(\u0026#34;Android Common Utils Lib\u0026#34;) description.set(\u0026#34;Android Common Utils Library For HJ\u0026#34;) url.set(\u0026#34;https://github.com/hanlyjiang/lib_common_utils\u0026#34;) licenses { license { name.set(\u0026#34;The Apache License, Version 2.0\u0026#34;) url.set(\u0026#34;http://www.apache.org/licenses/LICENSE-2.0.txt\u0026#34;) } } developers { developer { id.set(\u0026#34;hanlyjiang\u0026#34;) name.set(\u0026#34;Hanly Jiang\u0026#34;) email.set(\u0026#34;hanlyjiang@outlook.com\u0026#34;) } } scm { connection.set(\u0026#34;scm:git:git://github.com/hanlyjiang/lib_common_utils.git\u0026#34;) developerConnection.set(\u0026#34;scm:git:ssh://github.com/hanlyjiang/lib_common_utils.git\u0026#34;) url.set(\u0026#34;https://github.com/hanlyjiang/lib_common_utils\u0026#34;) } } } afterEvaluate { publishing { publications { create\u0026lt;MavenPublication\u0026gt;(\u0026#34;release\u0026#34;) { from(components.getByName(\u0026#34;release\u0026#34;)) groupId = \u0026#34;com.github.hanlyjiang\u0026#34; artifactId = \u0026#34;android_common_utils\u0026#34; version = android.defaultConfig.versionName pom(getMyPom()) // 添加javadoc artifact(tasks.getByName(\u0026#34;jarJavadoc\u0026#34;) as Jar) // 添加source artifact(tasks.getByName(\u0026#34;jarSource\u0026#34;) as Jar) } } repositories { val ossrhCredentials = Action\u0026lt;PasswordCredentials\u0026gt; { username = properties[\u0026#34;ossrhUsername\u0026#34;].toString() password = properties[\u0026#34;ossrhPassword\u0026#34;].toString() } // sonar的仓库，地址根据项目的版本号来确定是snapshot还是正式仓库 maven { name = \u0026#34;Sonartype\u0026#34; val releasesRepoUrl = uri(\u0026#34;https://oss.sonatype.org/service/local/staging/deploy/maven2\u0026#34;) val snapshotsRepoUrl = uri(\u0026#34;https://oss.sonatype.org/content/repositories/snapshots/\u0026#34;) url = if (android.defaultConfig.versionName.toString().endsWith(\u0026#34;SNAPSHOT\u0026#34;)) snapshotsRepoUrl else releasesRepoUrl credentials(ossrhCredentials) // snapshot的地址： // https://oss.sonatype.org/content/repositories/snapshots/com/github/hanlyjiang/android_common_utils/ } // 项目本地的仓库 maven { name = \u0026#34;ProjectLocal\u0026#34; val releasesRepoUrl = uri(layout.buildDirectory.dir(\u0026#34;repos/releases\u0026#34;)) val snapshotsRepoUrl = uri(layout.buildDirectory.dir(\u0026#34;repos/snapshots\u0026#34;)) url = if (android.defaultConfig.versionName.toString().endsWith(\u0026#34;SNAPSHOT\u0026#34;)) snapshotsRepoUrl else releasesRepoUrl } } } signing { sign(publishing.publications.getByName(\u0026#34;release\u0026#34;)) } } 使用AndroidMavenPubPlugin简化后的配置： import org.gradle.api.publish.maven.MavenPom plugins { id(\u0026#34;com.android.library\u0026#34;) id(\u0026#34;signing\u0026#34;) `maven-publish` // 引入我们本地仓库中的gradle插件 id(\u0026#34;com.github.hanlyjiang.android_maven_pub\u0026#34;) version (\u0026#34;0.0.5\u0026#34;) apply (false) } android { defaultConfig { versionName(\u0026#34;1.0.1-SNAPSHOT\u0026#34;) } } dependencies { // } apply(plugin = \u0026#34;com.github.hanlyjiang.android_maven_pub\u0026#34;) configure\u0026lt;io.hanlyjiang.gradle.android.AndroidMavenPubPluginExtension\u0026gt; { groupId.set(\u0026#34;com.github.hanlyjiang\u0026#34;) artifactId.set(\u0026#34;android-common-utils\u0026#34;) projectLocalRepoPath.set(\u0026#34;local-maven-repo\u0026#34;) mavenPomAction.set(Action\u0026lt;MavenPom\u0026gt; { name.set(\u0026#34;Android Common Utils Lib\u0026#34;) description.set(\u0026#34;Android Common Utils Library For HJ\u0026#34;) url.set(\u0026#34;https://github.com/hanlyjiang/lib_common_utils\u0026#34;) properties.set( mapOf( \u0026#34;myProp\u0026#34; to \u0026#34;value\u0026#34;, \u0026#34;prop.with.dots\u0026#34; to \u0026#34;anotherValue\u0026#34; ) ) licenses { license { name.set(\u0026#34;The Apache License, Version 2.0\u0026#34;) url.set(\u0026#34;http://www.apache.org/licenses/LICENSE-2.0.txt\u0026#34;) } } developers { developer { id.set(\u0026#34;hanlyjiang\u0026#34;) name.set(\u0026#34;Hanly Jiang\u0026#34;) email.set(\u0026#34;hanlyjiang@outlook.com\u0026#34;) } } scm { connection.set(\u0026#34;scm:git:git://github.com/hanlyjiang/lib_common_utils.git\u0026#34;) developerConnection.set(\u0026#34;scm:git:ssh://github.com/hanlyjiang/lib_common_utils.git\u0026#34;) url.set(\u0026#34;https://github.com/hanlyjiang/lib_common_utils\u0026#34;) } }) } 使用步骤 引入插件 在需要使用的模块的build脚本中，引入我们的插件，同时引入 maven-publish 插件和 signing 插件。\n","keywords":["Gradle","Android","工具"],"articleBody":"配置 android 上传到 maven 中心仓库，发现配置的代码有点多，而且如果有多个库模块需要上传，则需要复制粘贴不少重复的配置代码，于是编写了一个 gradle 插件用于简化提取这个配置过程；\n插件用途及效果 本插件用于简化Android库上传到Maven中心仓库的配置，避免每个project的gradle中都放置一份重复较多的配置；\n插件有如下功能：\n简化 maven-publish 插件的配置流程； 添加上传到Maven中心仓库的 publish 任务； 支持配置上传时是否包含 javadoc 及源码； 直接使用maven-publish插件的配置： import org.gradle.api.publish.maven.MavenPom plugins { id(\"com.android.library\") id(\"signing\") `maven-publish` } android { defaultConfig { versionName(\"1.0.0-SNAPSHOT\") } } dependencies { // } tasks.register(\"javadoc\", Javadoc::class.java) { group = \"publishing\" dependsOn(\"assemble\") source = android.sourceSets[\"main\"].java.getSourceFiles() classpath += project.files(android.bootClasspath + File.pathSeparator) if (JavaVersion.current().isJava9Compatible) { (options as StandardJavadocDocletOptions).addBooleanOption(\"html5\", true) } android.libraryVariants.forEach { libraryVariant -\u003e classpath += libraryVariant.javaCompileProvider.get().classpath } options.apply { encoding(\"UTF-8\") charset(\"UTF-8\") isFailOnError = false (this as StandardJavadocDocletOptions).apply { // addStringOption(\"Xdoclint:none\") links?.add(\"https://developer.android.google.cn/reference/\") links?.add(\"http://docs.oracle.com/javase/8/docs/api/\") } } } tasks.register(\"jarSource\", Jar::class.java) { group = \"publishing\" from(android.sourceSets[\"main\"].java.srcDirs) archiveClassifier.set(\"sources\") } tasks.register(\"jarJavadoc\", Jar::class.java) { group = \"publishing\" dependsOn(\"javadoc\") val javadoc: Javadoc = tasks.getByName(\"javadoc\") as Javadoc from(javadoc.destinationDir) archiveClassifier.set(\"javadoc\") } fun getMyPom(): Action\u003cin MavenPom\u003e { return Action { name.set(\"Android Common Utils Lib\") description.set(\"Android Common Utils Library For HJ\") url.set(\"https://github.com/hanlyjiang/lib_common_utils\") licenses { license { name.set(\"The Apache License, Version 2.0\") url.set(\"http://www.apache.org/licenses/LICENSE-2.0.txt\") } } developers { developer { id.set(\"hanlyjiang\") name.set(\"Hanly Jiang\") email.set(\"hanlyjiang@outlook.com\") } } scm { connection.set(\"scm:git:git://github.com/hanlyjiang/lib_common_utils.git\") developerConnection.set(\"scm:git:ssh://github.com/hanlyjiang/lib_common_utils.git\") url.set(\"https://github.com/hanlyjiang/lib_common_utils\") } } } afterEvaluate { publishing { publications { create(\"release\") { from(components.getByName(\"release\")) groupId = \"com.github.hanlyjiang\" artifactId = \"android_common_utils\" version = android.defaultConfig.versionName pom(getMyPom()) // 添加javadoc artifact(tasks.getByName(\"jarJavadoc\") as Jar) // 添加source artifact(tasks.getByName(\"jarSource\") as Jar) } } repositories { val ossrhCredentials = Action { username = properties[\"ossrhUsername\"].toString() password = properties[\"ossrhPassword\"].toString() } // sonar的仓库，地址根据项目的版本号来确定是snapshot还是正式仓库 maven { name = \"Sonartype\" val releasesRepoUrl = uri(\"https://oss.sonatype.org/service/local/staging/deploy/maven2\") val snapshotsRepoUrl = uri(\"https://oss.sonatype.org/content/repositories/snapshots/\") url = if (android.defaultConfig.versionName.toString().endsWith(\"SNAPSHOT\")) snapshotsRepoUrl else releasesRepoUrl credentials(ossrhCredentials) // snapshot的地址： // https://oss.sonatype.org/content/repositories/snapshots/com/github/hanlyjiang/android_common_utils/ } // 项目本地的仓库 maven { name = \"ProjectLocal\" val releasesRepoUrl = uri(layout.buildDirectory.dir(\"repos/releases\")) val snapshotsRepoUrl = uri(layout.buildDirectory.dir(\"repos/snapshots\")) url = if (android.defaultConfig.versionName.toString().endsWith(\"SNAPSHOT\")) snapshotsRepoUrl else releasesRepoUrl } } } signing { sign(publishing.publications.getByName(\"release\")) } } 使用AndroidMavenPubPlugin简化后的配置： import org.gradle.api.publish.maven.MavenPom plugins { id(\"com.android.library\") id(\"signing\") `maven-publish` // 引入我们本地仓库中的gradle插件 id(\"com.github.hanlyjiang.android_maven_pub\") version (\"0.0.5\") apply (false) } android { defaultConfig { versionName(\"1.0.1-SNAPSHOT\") } } dependencies { // } apply(plugin = \"com.github.hanlyjiang.android_maven_pub\") configure { groupId.set(\"com.github.hanlyjiang\") artifactId.set(\"android-common-utils\") projectLocalRepoPath.set(\"local-maven-repo\") mavenPomAction.set(Action { name.set(\"Android Common Utils Lib\") description.set(\"Android Common Utils Library For HJ\") url.set(\"https://github.com/hanlyjiang/lib_common_utils\") properties.set( mapOf( \"myProp\" to \"value\", \"prop.with.dots\" to \"anotherValue\" ) ) licenses { license { name.set(\"The Apache License, Version 2.0\") url.set(\"http://www.apache.org/licenses/LICENSE-2.0.txt\") } } developers { developer { id.set(\"hanlyjiang\") name.set(\"Hanly Jiang\") email.set(\"hanlyjiang@outlook.com\") } } scm { connection.set(\"scm:git:git://github.com/hanlyjiang/lib_common_utils.git\") developerConnection.set(\"scm:git:ssh://github.com/hanlyjiang/lib_common_utils.git\") url.set(\"https://github.com/hanlyjiang/lib_common_utils\") } }) } 使用步骤 引入插件 在需要使用的模块的build脚本中，引入我们的插件，同时引入 maven-publish 插件和 signing 插件。\nkotlin.kts 脚本写法 plugins { id(\"com.android.library\") // 引入signing插件 id(\"signing\") // 引入maven-publish插件 `maven-publish` // 引入 android_maven_pub 插件，注意这里设置 apply 为 false，表示引入但是不应用，我们需要放在android配置段定义之后再应用 id(\"com.github.hanlyjiang.android_maven_pub\") version (\"0.0.5\") apply (false) } groovy 的写法 plugins { id 'com.android.library' id 'signing' id 'maven-publish' id(\"com.github.hanlyjiang.android_maven_pub\") version(\"0.0.5\") apply(false) } 配置 gradle 在引入 AndroidMavenPubPlugin 插件之后，我们可以对插件进行配置。 建议将脚本转换为 kotlin dsl 的写法，能有对应的自动提示；\nkotlin dsl 写法 android { } // 需要先应用插件，在android配置完成之后，建议放在脚本最下方 apply(plugin = \"com.github.hanlyjiang.android_maven_pub\") configure { groupId.set(\"com.github.hanlyjiang\") artifactId.set(\"android_common_utils\") mavenPomAction.set(Action { name.set(\"Android Common Utils Lib\") description.set(\"Android Common Utils Library For HJ\") url.set(\"https://github.com/hanlyjiang/lib_common_utils\") properties.set( mapOf( \"myProp\" to \"value\", \"prop.with.dots\" to \"anotherValue\" ) ) licenses { license { name.set(\"The Apache License, Version 2.0\") url.set(\"http://www.apache.org/licenses/LICENSE-2.0.txt\") } } developers { developer { id.set(\"hanlyjiang\") name.set(\"Hanly Jiang\") email.set(\"hanlyjiang@outlook.com\") } } scm { connection.set(\"scm:git:git://github.com/hanlyjiang/lib_common_utils.git\") developerConnection.set(\"scm:git:ssh://github.com/hanlyjiang/lib_common_utils.git\") url.set(\"https://github.com/hanlyjiang/lib_common_utils\") } }) } groovy 脚本写法 apply plugin: \"com.github.hanlyjiang.android_maven_pub\" android_maven_pub { groupId.set(\"com.github.hanlyjiang\") artifactId.set(\"android-common-utils\") mavenPomAction.set({ pom -\u003e pom.with { name.set('HJ Android Plugin Framework') description.set(\"A Android Plugin Framework\") url.set(\"https://github.com/hanlyjiang/apf-library\") licenses { license { name = 'The Apache Software License, Version 2.0' url = 'http://www.apache.org/licenses/LICENSE-2.0.txt' } } developers { developer { id = 'hanlyjiang' name = 'hanly jiang' email = 'hanlyjiang@outlook.com' } } scm { connection = 'https://github.com/hanlyjiang/apf-library' developerConnection = 'https://github.com/hanlyjiang/apf-library.git' url = 'https://github.com/hanlyjiang/apf-library' } } } as Action\u003cMavenPom\u003e) } ⚠️注意：\n可以看到我们这里并没有定义版本号，版本号从 android.defaultConfig.versionName 中取 ；\n同时，如果版本号结尾为 -SNAPSHOT，则会发布到 snapshot 仓库，如果没有，则发布到 release 仓库；\nmaven仓库的属性文件配置 上传到maven center中心仓库需要进行一些账号申请和key的生成操作，可以参考Jcenter 停止服务，说一说我们的迁移方案 - InfoQ 写作平台 来完成，我们需要将最后获取到的认证信息：\n按如下配置，将对应的 value 的值更改为自己的账号及 key 的对应值，然后填入到 ~/.gradle/gradle.properties 中即可\n# 配置maven中心仓库访问账号 ossrhUsername=sonatype jira 账号的用户名 ossrhPassword=sonatype jira 账号的密码 # 配置签名信息 signing.keyId=公钥 ID 的后 8 位 signing.password=钥匙串的密码 signing.secretKeyRingFile=导出的 gpg 文件路径 如： /Users/hanlyjiang/.gnupg/secring.gpg ⚠️注意： 这里的 key 是固定的，不要修改\n执行上传任务 经过上面的配置，我们同步下 gradle ，对应引入了插件的项目中会生成若干任务：\n其中：\njarJavadoc, jarSource,javadoc 为我们生成的辅助任务 publish 及 generate 开头的为 mave-publish 插件生成的任务，我们执行 publish 相关的任务即可发布 maven 库； publish 相关的任务有如下几个：\nTask Name Description publish 等于执行了下面的所有任务 publishAllPublicationsToProjectLocalRepository 将由此项目产生的所有Maven库发布到 ProjectLocal 存储库。 ProjectLocal 定义为当前项目的 build 目录的 mavenRepos 目录中，有两个子目录 snapshots及 release， 方便查看将要发布的生成物及进行本地测试； publishAllPublicationsToSonartypeRepository 将由此项目产生的所有 Maven 库发布到 Sonartype 存储库。 publishReleasePublicationToMavenLocal 将由此项目产生的名为release的 Maven库发布到本机 maven 缓存库。 publishReleasePublicationToProjectLocalRepository 将由此项目产生的名为release的 Maven库发布到本机 ProjectLocal 库。 publishReleasePublicationToSonartypeRepository 将由此项目产生的名为release的 Maven库发布到本机 Sonartype 库。 publishToMavenLocal 将由此项目产生的所有 Maven 库发布到 本机 maven 缓存库。 说明：\n上面的任务由 maven-publish 的插件生成，该插件生成任务的规则使用 Publications 和 Repo 来组合实现，其中：\npublication 是我们定义的发布库；android_maven_pub 插件中，我们定义了一个名为release 的配置； repo 是我们定义的 maven 仓库的位置，android_maven_pub 定义了两个仓库的位置，分别名为 ProjectLocal 和 Sonartype ，另外maven-publish会给我们加上一个 MavenLocal 的配置（指向本机 maven 仓库缓存目录） 其中 ProjectLocal 指向引入了该插件的项目（模块）的 build/repos 目录 Sonartype 则默认指向 maven 中心仓库的地址，可以通过配置来更改； 可配置项目说明 配置字段 说明 默认值 groupId maven 的 group id，需要设置为自己申请的 无默认值-必需填写 artifactId library 的 id 无默认值-必需填写 mavenPomAction 用于配置 pom 信息的字段 无默认值-必需填写 fromAndroidPubName 表示发布的 android 的 aar 的类型，release 或 debug release releasesRepoUrl maven release 仓库的上传地址 https://oss.sonatype.org/service/local/staging/deploy/maven2 snapshotsRepoUrl maven snapshots 仓库的上传地址 https://oss.sonatype.org/content/repositories/snapshots/ includeSourceJar 是否上传源码 true includeJavadocJar 是否上传 javadoc true projectLocalRepoPath 本地仓库的目录，相对于rootProject的目录，如：local-maven-repo 默认位于根项目的 build/mavenRepos 目录中 常见问题 发布到 snapshot 我们根据版本号来选择发布到的是 snapshot 还是 release 仓库，版本号从 android-\u003edefaultConfig - versionName 中读取，如：\nandroid { compileSdkVersion(30) buildToolsVersion(\"30.0.3\") defaultConfig { minSdkVersion(22) targetSdkVersion(30) versionCode(1) versionName(\"1.0.0-SNAPSHOT\") } } 发布到本地并进行测试 首先我们通过 projectLocalRepoPath 来改变 ProjectLocal 仓库的目录，下面的示例中将其设置为 rootProject 的 local-maven-repo 目录中\napply(plugin = \"com.github.hanlyjiang.android_maven_pub\") configure { groupId.set(\"com.github.hanlyjiang\") artifactId.set(\"android-common-utils\") projectLocalRepoPath.set(\"local-maven-repo\") // ... } 接下来我们定义本地的 Repo ，见下方名为 ProjectLocal-Snapshots 及 ProjectLocal-Release 的仓库。\nallprojects { repositories { maven { setUrl(\"https://maven.aliyun.com/repository/jcenter\") } maven { setUrl(\"https://maven.aliyun.com/repository/google\") } maven { setUrl(\"https://maven.aliyun.com/repository/gradle-plugin\") } maven { setUrl(\"https://maven.aliyun.com/repository/public\") } // 定义本地repo路径 maven { name = \"ProjectLocal-Snapshots\" setUrl(File(rootProject.rootDir, \"local-maven-repo${File.separator}snapshots\")) } maven { name = \"ProjectLocal-Release\" setUrl(File(rootProject.rootDir, \"local-maven-repo${File.separator}release\")) } maven { name = \"Sonatype-Snapshots\" setUrl(\"https://oss.sonatype.org/content/repositories/snapshots\") // setUrl(\"https://s01.oss.sonatype.org/content/repositories/snapshots\") // snapshot可以不用用户名密码 // 查看自己的snapshot版本： https://oss.sonatype.org/content/repositories/snapshots/com/github/hanlyjiang/ credentials(PasswordCredentials::class.java) { username = property(\"ossrhUsername\").toString() password = property(\"ossrhPassword\").toString() } } maven { name = \"Sonatype-Staging\" setUrl(\"https://oss.sonatype.org/service/local/staging/deploy/maven2/\") // setUrl(\"https://s01.oss.sonatype.org/service/local/staging/deploy/maven2/\") credentials(PasswordCredentials::class.java) { username = property(\"ossrhUsername\").toString() password = property(\"ossrhPassword\").toString() } } } } ","wordCount":"884","inLanguage":"en","datePublished":"2021-06-01T10:26:00Z","dateModified":"2021-06-01T10:26:00Z","author":{"@type":"Person","name":"野生莲藕"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://anlyjiang.github.io/posts/jian-hua-android-ku-shang-chuan-dao-maven-cang-ku-de-gradle-pei-zhi/"},"publisher":{"@type":"Organization","name":"清水池塘","logo":{"@type":"ImageObject","url":"https://anlyjiang.github.io/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://anlyjiang.github.io/ accesskey=h title="清水池塘 (Alt + H)">清水池塘</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">简化Android库上传到Maven仓库的gradle配置</h1><div class=post-meta><span title='2021-06-01 10:26:00 +0000 UTC'>June 1, 2021</span>&nbsp;·&nbsp;<span>5 min</span>&nbsp;·&nbsp;<span>野生莲藕</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e6%8f%92%e4%bb%b6%e7%94%a8%e9%80%94%e5%8f%8a%e6%95%88%e6%9e%9c aria-label=插件用途及效果>插件用途及效果</a><ul><li><a href=#%e7%9b%b4%e6%8e%a5%e4%bd%bf%e7%94%a8maven-publish%e6%8f%92%e4%bb%b6%e7%9a%84%e9%85%8d%e7%bd%ae aria-label=直接使用maven-publish插件的配置：>直接使用maven-publish插件的配置：</a></li><li><a href=#%e4%bd%bf%e7%94%a8androidmavenpubplugin%e7%ae%80%e5%8c%96%e5%90%8e%e7%9a%84%e9%85%8d%e7%bd%ae aria-label=使用AndroidMavenPubPlugin简化后的配置：>使用AndroidMavenPubPlugin简化后的配置：</a></li></ul></li><li><a href=#%e4%bd%bf%e7%94%a8%e6%ad%a5%e9%aa%a4 aria-label=使用步骤>使用步骤</a><ul><li><a href=#%e5%bc%95%e5%85%a5%e6%8f%92%e4%bb%b6 aria-label=引入插件>引入插件</a><ul><li><a href=#kotlinkts-%e8%84%9a%e6%9c%ac%e5%86%99%e6%b3%95 aria-label="kotlin.kts 脚本写法">kotlin.kts 脚本写法</a></li><li><a href=#groovy-%e7%9a%84%e5%86%99%e6%b3%95 aria-label="groovy 的写法">groovy 的写法</a></li></ul></li><li><a href=#%e9%85%8d%e7%bd%ae-gradle aria-label="配置 gradle">配置 gradle</a><ul><li><a href=#kotlin-dsl-%e5%86%99%e6%b3%95 aria-label="kotlin dsl 写法">kotlin dsl 写法</a></li><li><a href=#groovy-%e8%84%9a%e6%9c%ac%e5%86%99%e6%b3%95 aria-label="groovy 脚本写法">groovy 脚本写法</a></li></ul></li><li><a href=#maven%e4%bb%93%e5%ba%93%e7%9a%84%e5%b1%9e%e6%80%a7%e6%96%87%e4%bb%b6%e9%85%8d%e7%bd%ae aria-label=maven仓库的属性文件配置>maven仓库的属性文件配置</a></li><li><a href=#%e6%89%a7%e8%a1%8c%e4%b8%8a%e4%bc%a0%e4%bb%bb%e5%8a%a1 aria-label=执行上传任务>执行上传任务</a></li></ul></li><li><a href=#%e5%8f%af%e9%85%8d%e7%bd%ae%e9%a1%b9%e7%9b%ae%e8%af%b4%e6%98%8e aria-label=可配置项目说明>可配置项目说明</a></li><li><a href=#%e5%b8%b8%e8%a7%81%e9%97%ae%e9%a2%98 aria-label=常见问题>常见问题</a><ul><li><a href=#%e5%8f%91%e5%b8%83%e5%88%b0-snapshot aria-label="发布到 snapshot">发布到 snapshot</a></li><li><a href=#%e5%8f%91%e5%b8%83%e5%88%b0%e6%9c%ac%e5%9c%b0%e5%b9%b6%e8%bf%9b%e8%a1%8c%e6%b5%8b%e8%af%95 aria-label=发布到本地并进行测试>发布到本地并进行测试</a></li></ul></li></ul></div></details></div><div class=post-content><p>配置 android 上传到 maven 中心仓库，发现配置的代码有点多，而且如果有多个库模块需要上传，则需要复制粘贴不少重复的配置代码，于是编写了一个 gradle 插件用于简化提取这个配置过程；</p><h2 id=插件用途及效果>插件用途及效果<a hidden class=anchor aria-hidden=true href=#插件用途及效果>#</a></h2><p>本插件用于简化Android库上传到Maven中心仓库的配置，避免每个project的gradle中都放置一份重复较多的配置；</p><p>插件有如下功能：</p><ol><li>简化 maven-publish 插件的配置流程；</li><li>添加上传到Maven中心仓库的 publish 任务；</li><li>支持配置上传时是否包含 javadoc 及源码；</li></ol><h3 id=直接使用maven-publish插件的配置>直接使用maven-publish插件的配置：<a hidden class=anchor aria-hidden=true href=#直接使用maven-publish插件的配置>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>import</span> org.gradle.api.publish.maven.MavenPom
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>plugins {
</span></span><span style=display:flex><span>    id(<span style=color:#e6db74>&#34;com.android.library&#34;</span>)
</span></span><span style=display:flex><span>    id(<span style=color:#e6db74>&#34;signing&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#960050;background-color:#1e0010>`</span>maven-publish<span style=color:#960050;background-color:#1e0010>`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>android {
</span></span><span style=display:flex><span>    defaultConfig {
</span></span><span style=display:flex><span>        versionName(<span style=color:#e6db74>&#34;1.0.0-SNAPSHOT&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dependencies {
</span></span><span style=display:flex><span>   <span style=color:#75715e>// 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>tasks.register(<span style=color:#e6db74>&#34;javadoc&#34;</span>, Javadoc<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java) {
</span></span><span style=display:flex><span>    group = <span style=color:#e6db74>&#34;publishing&#34;</span>
</span></span><span style=display:flex><span>    dependsOn(<span style=color:#e6db74>&#34;assemble&#34;</span>)
</span></span><span style=display:flex><span>    source = android.sourceSets[<span style=color:#e6db74>&#34;main&#34;</span>].java.getSourceFiles()
</span></span><span style=display:flex><span>    classpath <span style=color:#f92672>+=</span> project.files(android.bootClasspath + <span style=color:#a6e22e>File</span>.pathSeparator)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>JavaVersion</span>.current().isJava9Compatible) {
</span></span><span style=display:flex><span>        (options <span style=color:#66d9ef>as</span> StandardJavadocDocletOptions).addBooleanOption(<span style=color:#e6db74>&#34;html5&#34;</span>, <span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    android.libraryVariants.forEach { libraryVariant <span style=color:#f92672>-&gt;</span>
</span></span><span style=display:flex><span>        classpath <span style=color:#f92672>+=</span> libraryVariant.javaCompileProvider.<span style=color:#66d9ef>get</span>().classpath
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    options.apply {
</span></span><span style=display:flex><span>        encoding(<span style=color:#e6db74>&#34;UTF-8&#34;</span>)
</span></span><span style=display:flex><span>        charset(<span style=color:#e6db74>&#34;UTF-8&#34;</span>)
</span></span><span style=display:flex><span>        isFailOnError = <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>this</span> <span style=color:#66d9ef>as</span> StandardJavadocDocletOptions).apply {
</span></span><span style=display:flex><span><span style=color:#75715e>//            addStringOption(&#34;Xdoclint:none&#34;)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            links<span style=color:#f92672>?.</span>add(<span style=color:#e6db74>&#34;https://developer.android.google.cn/reference/&#34;</span>)
</span></span><span style=display:flex><span>            links<span style=color:#f92672>?.</span>add(<span style=color:#e6db74>&#34;http://docs.oracle.com/javase/8/docs/api/&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>tasks.register(<span style=color:#e6db74>&#34;jarSource&#34;</span>, Jar<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java) {
</span></span><span style=display:flex><span>    group = <span style=color:#e6db74>&#34;publishing&#34;</span>
</span></span><span style=display:flex><span>    from(android.sourceSets[<span style=color:#e6db74>&#34;main&#34;</span>].java.srcDirs)
</span></span><span style=display:flex><span>    archiveClassifier.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;sources&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>tasks.register(<span style=color:#e6db74>&#34;jarJavadoc&#34;</span>, Jar<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java) {
</span></span><span style=display:flex><span>    group = <span style=color:#e6db74>&#34;publishing&#34;</span>
</span></span><span style=display:flex><span>    dependsOn(<span style=color:#e6db74>&#34;javadoc&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> javadoc: Javadoc = tasks.getByName(<span style=color:#e6db74>&#34;javadoc&#34;</span>) <span style=color:#66d9ef>as</span> Javadoc
</span></span><span style=display:flex><span>    from(javadoc.destinationDir)
</span></span><span style=display:flex><span>    archiveClassifier.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;javadoc&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>getMyPom</span>(): Action&lt;<span style=color:#66d9ef>in</span> MavenPom&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> Action&lt;MavenPom&gt; {
</span></span><span style=display:flex><span>        name.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;Android Common Utils Lib&#34;</span>)
</span></span><span style=display:flex><span>        description.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;Android Common Utils Library For HJ&#34;</span>)
</span></span><span style=display:flex><span>        url.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;https://github.com/hanlyjiang/lib_common_utils&#34;</span>)
</span></span><span style=display:flex><span>        licenses {
</span></span><span style=display:flex><span>            license {
</span></span><span style=display:flex><span>                name.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;The Apache License, Version 2.0&#34;</span>)
</span></span><span style=display:flex><span>                url.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;http://www.apache.org/licenses/LICENSE-2.0.txt&#34;</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        developers {
</span></span><span style=display:flex><span>            developer {
</span></span><span style=display:flex><span>                id.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;hanlyjiang&#34;</span>)
</span></span><span style=display:flex><span>                name.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;Hanly Jiang&#34;</span>)
</span></span><span style=display:flex><span>                email.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;hanlyjiang@outlook.com&#34;</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        scm {
</span></span><span style=display:flex><span>            connection.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;scm:git:git://github.com/hanlyjiang/lib_common_utils.git&#34;</span>)
</span></span><span style=display:flex><span>            developerConnection.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;scm:git:ssh://github.com/hanlyjiang/lib_common_utils.git&#34;</span>)
</span></span><span style=display:flex><span>            url.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;https://github.com/hanlyjiang/lib_common_utils&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>afterEvaluate {
</span></span><span style=display:flex><span>    publishing {
</span></span><span style=display:flex><span>        publications {
</span></span><span style=display:flex><span>            create&lt;MavenPublication&gt;(<span style=color:#e6db74>&#34;release&#34;</span>) {
</span></span><span style=display:flex><span>                from(components.getByName(<span style=color:#e6db74>&#34;release&#34;</span>))
</span></span><span style=display:flex><span>                groupId = <span style=color:#e6db74>&#34;com.github.hanlyjiang&#34;</span>
</span></span><span style=display:flex><span>                artifactId = <span style=color:#e6db74>&#34;android_common_utils&#34;</span>
</span></span><span style=display:flex><span>                version = android.defaultConfig.versionName
</span></span><span style=display:flex><span>                pom(getMyPom())
</span></span><span style=display:flex><span>                <span style=color:#75715e>// 添加javadoc
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                artifact(tasks.getByName(<span style=color:#e6db74>&#34;jarJavadoc&#34;</span>) <span style=color:#66d9ef>as</span> Jar)
</span></span><span style=display:flex><span>                <span style=color:#75715e>// 添加source
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                artifact(tasks.getByName(<span style=color:#e6db74>&#34;jarSource&#34;</span>) <span style=color:#66d9ef>as</span> Jar)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        repositories {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>val</span> ossrhCredentials = Action&lt;PasswordCredentials&gt; {
</span></span><span style=display:flex><span>                username = properties[<span style=color:#e6db74>&#34;ossrhUsername&#34;</span>].toString()
</span></span><span style=display:flex><span>                password = properties[<span style=color:#e6db74>&#34;ossrhPassword&#34;</span>].toString()
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#75715e>// sonar的仓库，地址根据项目的版本号来确定是snapshot还是正式仓库
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            maven {
</span></span><span style=display:flex><span>                name = <span style=color:#e6db74>&#34;Sonartype&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>val</span> releasesRepoUrl = uri(<span style=color:#e6db74>&#34;https://oss.sonatype.org/service/local/staging/deploy/maven2&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>val</span> snapshotsRepoUrl = uri(<span style=color:#e6db74>&#34;https://oss.sonatype.org/content/repositories/snapshots/&#34;</span>)
</span></span><span style=display:flex><span>                url = <span style=color:#66d9ef>if</span> (android.defaultConfig.versionName.toString().endsWith(<span style=color:#e6db74>&#34;SNAPSHOT&#34;</span>)) snapshotsRepoUrl <span style=color:#66d9ef>else</span> releasesRepoUrl
</span></span><span style=display:flex><span>                credentials(ossrhCredentials)
</span></span><span style=display:flex><span>                <span style=color:#75715e>// snapshot的地址：
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#75715e>// https://oss.sonatype.org/content/repositories/snapshots/com/github/hanlyjiang/android_common_utils/
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            }
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 项目本地的仓库
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            maven {
</span></span><span style=display:flex><span>                name = <span style=color:#e6db74>&#34;ProjectLocal&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>val</span> releasesRepoUrl = uri(layout.buildDirectory.dir(<span style=color:#e6db74>&#34;repos/releases&#34;</span>))
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>val</span> snapshotsRepoUrl = uri(layout.buildDirectory.dir(<span style=color:#e6db74>&#34;repos/snapshots&#34;</span>))
</span></span><span style=display:flex><span>                url = <span style=color:#66d9ef>if</span> (android.defaultConfig.versionName.toString().endsWith(<span style=color:#e6db74>&#34;SNAPSHOT&#34;</span>)) snapshotsRepoUrl <span style=color:#66d9ef>else</span> releasesRepoUrl
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    signing {
</span></span><span style=display:flex><span>        sign(publishing.publications.getByName(<span style=color:#e6db74>&#34;release&#34;</span>))
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=使用androidmavenpubplugin简化后的配置>使用AndroidMavenPubPlugin简化后的配置：<a hidden class=anchor aria-hidden=true href=#使用androidmavenpubplugin简化后的配置>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>import</span> org.gradle.api.publish.maven.MavenPom
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>plugins {
</span></span><span style=display:flex><span>    id(<span style=color:#e6db74>&#34;com.android.library&#34;</span>)
</span></span><span style=display:flex><span>    id(<span style=color:#e6db74>&#34;signing&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#960050;background-color:#1e0010>`</span>maven-publish<span style=color:#960050;background-color:#1e0010>`</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 引入我们本地仓库中的gradle插件
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    id(<span style=color:#e6db74>&#34;com.github.hanlyjiang.android_maven_pub&#34;</span>) version (<span style=color:#e6db74>&#34;0.0.5&#34;</span>) apply (<span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>android {
</span></span><span style=display:flex><span>    defaultConfig {
</span></span><span style=display:flex><span>        versionName(<span style=color:#e6db74>&#34;1.0.1-SNAPSHOT&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dependencies {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>apply(plugin = <span style=color:#e6db74>&#34;com.github.hanlyjiang.android_maven_pub&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>configure&lt;io.hanlyjiang.gradle.android.AndroidMavenPubPluginExtension&gt; {
</span></span><span style=display:flex><span>    groupId.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;com.github.hanlyjiang&#34;</span>)
</span></span><span style=display:flex><span>    artifactId.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;android-common-utils&#34;</span>)
</span></span><span style=display:flex><span>    projectLocalRepoPath.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;local-maven-repo&#34;</span>)
</span></span><span style=display:flex><span>    mavenPomAction.<span style=color:#66d9ef>set</span>(Action&lt;MavenPom&gt; {
</span></span><span style=display:flex><span>        name.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;Android Common Utils Lib&#34;</span>)
</span></span><span style=display:flex><span>        description.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;Android Common Utils Library For HJ&#34;</span>)
</span></span><span style=display:flex><span>        url.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;https://github.com/hanlyjiang/lib_common_utils&#34;</span>)
</span></span><span style=display:flex><span>        properties.<span style=color:#66d9ef>set</span>(
</span></span><span style=display:flex><span>            mapOf(
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;myProp&#34;</span> to <span style=color:#e6db74>&#34;value&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;prop.with.dots&#34;</span> to <span style=color:#e6db74>&#34;anotherValue&#34;</span>
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>        licenses {
</span></span><span style=display:flex><span>            license {
</span></span><span style=display:flex><span>                name.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;The Apache License, Version 2.0&#34;</span>)
</span></span><span style=display:flex><span>                url.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;http://www.apache.org/licenses/LICENSE-2.0.txt&#34;</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        developers {
</span></span><span style=display:flex><span>            developer {
</span></span><span style=display:flex><span>                id.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;hanlyjiang&#34;</span>)
</span></span><span style=display:flex><span>                name.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;Hanly Jiang&#34;</span>)
</span></span><span style=display:flex><span>                email.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;hanlyjiang@outlook.com&#34;</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        scm {
</span></span><span style=display:flex><span>            connection.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;scm:git:git://github.com/hanlyjiang/lib_common_utils.git&#34;</span>)
</span></span><span style=display:flex><span>            developerConnection.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;scm:git:ssh://github.com/hanlyjiang/lib_common_utils.git&#34;</span>)
</span></span><span style=display:flex><span>            url.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;https://github.com/hanlyjiang/lib_common_utils&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=使用步骤>使用步骤<a hidden class=anchor aria-hidden=true href=#使用步骤>#</a></h2><h3 id=引入插件>引入插件<a hidden class=anchor aria-hidden=true href=#引入插件>#</a></h3><p>在需要使用的模块的build脚本中，引入我们的插件，同时引入 <code>maven-publish</code> 插件和<code> signing</code> 插件。</p><h4 id=kotlinkts-脚本写法>kotlin.kts 脚本写法<a hidden class=anchor aria-hidden=true href=#kotlinkts-脚本写法>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>plugins {
</span></span><span style=display:flex><span>    id(<span style=color:#e6db74>&#34;com.android.library&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 引入signing插件
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    id(<span style=color:#e6db74>&#34;signing&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 引入maven-publish插件
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#960050;background-color:#1e0010>`</span>maven-publish<span style=color:#960050;background-color:#1e0010>`</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 引入 android_maven_pub 插件，注意这里设置 apply 为 false，表示引入但是不应用，我们需要放在android配置段定义之后再应用
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    id(<span style=color:#e6db74>&#34;com.github.hanlyjiang.android_maven_pub&#34;</span>) version (<span style=color:#e6db74>&#34;0.0.5&#34;</span>) apply (<span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=groovy-的写法>groovy 的写法<a hidden class=anchor aria-hidden=true href=#groovy-的写法>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span>plugins <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    id <span style=color:#e6db74>&#39;com.android.library&#39;</span>
</span></span><span style=display:flex><span>    id <span style=color:#e6db74>&#39;signing&#39;</span>
</span></span><span style=display:flex><span>    id <span style=color:#e6db74>&#39;maven-publish&#39;</span>
</span></span><span style=display:flex><span>    id<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;com.github.hanlyjiang.android_maven_pub&#34;</span><span style=color:#f92672>)</span> version<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;0.0.5&#34;</span><span style=color:#f92672>)</span> apply<span style=color:#f92672>(</span><span style=color:#66d9ef>false</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=配置-gradle>配置 gradle<a hidden class=anchor aria-hidden=true href=#配置-gradle>#</a></h3><p>在引入 AndroidMavenPubPlugin 插件之后，我们可以对插件进行配置。 建议将脚本转换为 kotlin dsl 的写法，能有对应的自动提示；</p><h4 id=kotlin-dsl-写法>kotlin dsl 写法<a hidden class=anchor aria-hidden=true href=#kotlin-dsl-写法>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>android {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 需要先应用插件，在android配置完成之后，建议放在脚本最下方
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>apply(plugin = <span style=color:#e6db74>&#34;com.github.hanlyjiang.android_maven_pub&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>configure&lt;io.hanlyjiang.gradle.android.AndroidMavenPubPluginExtension&gt; {
</span></span><span style=display:flex><span>    groupId.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;com.github.hanlyjiang&#34;</span>)
</span></span><span style=display:flex><span>    artifactId.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;android_common_utils&#34;</span>)
</span></span><span style=display:flex><span>    mavenPomAction.<span style=color:#66d9ef>set</span>(Action&lt;MavenPom&gt; {
</span></span><span style=display:flex><span>        name.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;Android Common Utils Lib&#34;</span>)
</span></span><span style=display:flex><span>        description.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;Android Common Utils Library For HJ&#34;</span>)
</span></span><span style=display:flex><span>        url.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;https://github.com/hanlyjiang/lib_common_utils&#34;</span>)
</span></span><span style=display:flex><span>        properties.<span style=color:#66d9ef>set</span>(
</span></span><span style=display:flex><span>            mapOf(
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;myProp&#34;</span> to <span style=color:#e6db74>&#34;value&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;prop.with.dots&#34;</span> to <span style=color:#e6db74>&#34;anotherValue&#34;</span>
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>        licenses {
</span></span><span style=display:flex><span>            license {
</span></span><span style=display:flex><span>                name.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;The Apache License, Version 2.0&#34;</span>)
</span></span><span style=display:flex><span>                url.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;http://www.apache.org/licenses/LICENSE-2.0.txt&#34;</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        developers {
</span></span><span style=display:flex><span>            developer {
</span></span><span style=display:flex><span>                id.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;hanlyjiang&#34;</span>)
</span></span><span style=display:flex><span>                name.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;Hanly Jiang&#34;</span>)
</span></span><span style=display:flex><span>                email.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;hanlyjiang@outlook.com&#34;</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        scm {
</span></span><span style=display:flex><span>            connection.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;scm:git:git://github.com/hanlyjiang/lib_common_utils.git&#34;</span>)
</span></span><span style=display:flex><span>            developerConnection.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;scm:git:ssh://github.com/hanlyjiang/lib_common_utils.git&#34;</span>)
</span></span><span style=display:flex><span>            url.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;https://github.com/hanlyjiang/lib_common_utils&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=groovy-脚本写法>groovy 脚本写法<a hidden class=anchor aria-hidden=true href=#groovy-脚本写法>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span>apply plugin: <span style=color:#e6db74>&#34;com.github.hanlyjiang.android_maven_pub&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>android_maven_pub <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    groupId<span style=color:#f92672>.</span><span style=color:#a6e22e>set</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;com.github.hanlyjiang&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    artifactId<span style=color:#f92672>.</span><span style=color:#a6e22e>set</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;android-common-utils&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    mavenPomAction<span style=color:#f92672>.</span><span style=color:#a6e22e>set</span><span style=color:#f92672>({</span> pom <span style=color:#f92672>-&gt;</span>
</span></span><span style=display:flex><span>        pom<span style=color:#f92672>.</span><span style=color:#a6e22e>with</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            name<span style=color:#f92672>.</span><span style=color:#a6e22e>set</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#39;HJ Android Plugin Framework&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            description<span style=color:#f92672>.</span><span style=color:#a6e22e>set</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;A Android Plugin Framework&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            url<span style=color:#f92672>.</span><span style=color:#a6e22e>set</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;https://github.com/hanlyjiang/apf-library&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            licenses <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                license <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;The Apache Software License, Version 2.0&#39;</span>
</span></span><span style=display:flex><span>                    url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;http://www.apache.org/licenses/LICENSE-2.0.txt&#39;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            developers <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                developer <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;hanlyjiang&#39;</span>
</span></span><span style=display:flex><span>                    name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;hanly jiang&#39;</span>
</span></span><span style=display:flex><span>                    email <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;hanlyjiang@outlook.com&#39;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            scm <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                connection <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;https://github.com/hanlyjiang/apf-library&#39;</span>
</span></span><span style=display:flex><span>                developerConnection <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;https://github.com/hanlyjiang/apf-library.git&#39;</span>
</span></span><span style=display:flex><span>                url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;https://github.com/hanlyjiang/apf-library&#39;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> <span style=color:#66d9ef>as</span> Action<span style=color:#f92672>&lt;</span>MavenPom<span style=color:#f92672>&gt;)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><blockquote><p>⚠️<strong>注意</strong>：</p><ul><li><p>可以看到我们这里并没有定义版本号，版本号从 <code>android.defaultConfig.versionName</code> 中取 ；</p></li><li><p>同时，如果版本号结尾为 <code>-SNAPSHOT</code>，则会发布到 snapshot 仓库，如果没有，则发布到 release 仓库；</p></li></ul></blockquote><h3 id=maven仓库的属性文件配置>maven仓库的属性文件配置<a hidden class=anchor aria-hidden=true href=#maven仓库的属性文件配置>#</a></h3><p>上传到maven center中心仓库需要进行一些账号申请和key的生成操作，可以参考<a href=https://xie.infoq.cn/article/e2345e367a139f37fc2fc0bbb>Jcenter 停止服务，说一说我们的迁移方案 - InfoQ 写作平台</a> 来完成，我们需要将最后获取到的认证信息：</p><p>按如下配置，将对应的 value 的值更改为自己的账号及 key 的对应值，然后填入到 <code>~/.gradle/gradle.properties</code> 中即可</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-properties data-lang=properties><span style=display:flex><span><span style=color:#75715e># 配置maven中心仓库访问账号</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ossrhUsername</span><span style=color:#f92672>=</span><span style=color:#e6db74>sonatype jira 账号的用户名</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ossrhPassword</span><span style=color:#f92672>=</span><span style=color:#e6db74>sonatype jira 账号的密码</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 配置签名信息</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>signing.keyId</span><span style=color:#f92672>=</span><span style=color:#e6db74>公钥 ID 的后 8 位</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>signing.password</span><span style=color:#f92672>=</span><span style=color:#e6db74>钥匙串的密码</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>signing.secretKeyRingFile</span><span style=color:#f92672>=</span><span style=color:#e6db74>导出的 gpg 文件路径 如： /Users/hanlyjiang/.gnupg/secring.gpg </span>
</span></span></code></pre></div><blockquote><p>⚠️注意： 这里的 key 是固定的，不要修改</p></blockquote><h3 id=执行上传任务>执行上传任务<a hidden class=anchor aria-hidden=true href=#执行上传任务>#</a></h3><p>经过上面的配置，我们同步下 gradle ，对应引入了插件的项目中会生成若干任务：</p><p><img alt=在这里插入图片描述 loading=lazy src="https://img-blog.csdnimg.cn/20210531175716679.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21vc3B1aXRv,size_16,color_FFFFFF,t_70"></p><p>其中：</p><ul><li><code>jarJavadoc</code>, <code>jarSource</code>,<code>javadoc</code> 为我们生成的辅助任务</li><li><code>publish</code> 及 <code>generate</code> 开头的为 <code>mave-publish</code> 插件生成的任务，我们执行 <code>publish</code> 相关的任务即可发布 maven 库；</li></ul><p><code>publish </code>相关的任务有如下几个：</p><table><thead><tr><th>Task Name</th><th>Description</th></tr></thead><tbody><tr><td>publish</td><td>等于执行了下面的所有任务</td></tr><tr><td>publishAllPublicationsToProjectLocalRepository</td><td>将由此项目产生的所有Maven库发布到 ProjectLocal 存储库。 ProjectLocal 定义为当前项目的 build 目录的 <code>mavenRepos</code> 目录中，有两个子目录 <code>snapshots</code>及 <code>release</code>， 方便查看将要发布的生成物及进行本地测试；</td></tr><tr><td>publishAllPublicationsToSonartypeRepository</td><td>将由此项目产生的所有 Maven 库发布到 Sonartype 存储库。</td></tr><tr><td>publishReleasePublicationToMavenLocal</td><td>将由此项目产生的名为<code>release</code>的 Maven库发布到本机 maven 缓存库。</td></tr><tr><td>publishReleasePublicationToProjectLocalRepository</td><td>将由此项目产生的名为<code>release</code>的 Maven库发布到本机 ProjectLocal 库。</td></tr><tr><td>publishReleasePublicationToSonartypeRepository</td><td>将由此项目产生的名为<code>release</code>的 Maven库发布到本机 Sonartype 库。</td></tr><tr><td>publishToMavenLocal</td><td>将由此项目产生的所有 Maven 库发布到 本机 maven 缓存库。</td></tr></tbody></table><p><strong>说明：</strong></p><p>上面的任务由 <code>maven-publish</code> 的插件生成，该插件生成任务的规则使用 Publications 和 Repo 来组合实现，其中：</p><ul><li>publication 是我们定义的发布库；<code>android_maven_pub</code> 插件中，我们定义了一个名为<code>release</code> 的配置；</li><li>repo 是我们定义的 maven 仓库的位置，<code>android_maven_pub</code> 定义了两个仓库的位置，分别名为 ProjectLocal 和 Sonartype ，另外<code>maven-publish</code>会给我们加上一个 MavenLocal 的配置（指向本机 maven 仓库缓存目录）<ul><li>其中 ProjectLocal 指向引入了该插件的项目（模块）的 <code>build/repos</code> 目录</li><li><code>Sonartype</code> 则默认指向 maven 中心仓库的地址，可以通过配置来更改；</li></ul></li></ul><h2 id=可配置项目说明>可配置项目说明<a hidden class=anchor aria-hidden=true href=#可配置项目说明>#</a></h2><table><thead><tr><th>配置字段</th><th>说明</th><th>默认值</th></tr></thead><tbody><tr><td>groupId</td><td>maven 的 group id，需要设置为自己申请的</td><td>无默认值-必需填写</td></tr><tr><td>artifactId</td><td>library 的 id</td><td>无默认值-必需填写</td></tr><tr><td>mavenPomAction</td><td>用于配置 pom 信息的字段</td><td>无默认值-必需填写</td></tr><tr><td>fromAndroidPubName</td><td>表示发布的 android 的 aar 的类型，<code>release</code> 或 <code>debug</code></td><td><code>release</code></td></tr><tr><td>releasesRepoUrl</td><td>maven release 仓库的上传地址</td><td><code>https://oss.sonatype.org/service/local/staging/deploy/maven2</code></td></tr><tr><td>snapshotsRepoUrl</td><td>maven snapshots 仓库的上传地址</td><td><code>https://oss.sonatype.org/content/repositories/snapshots/</code></td></tr><tr><td>includeSourceJar</td><td>是否上传源码</td><td><code>true</code></td></tr><tr><td>includeJavadocJar</td><td>是否上传 javadoc</td><td><code>true</code></td></tr><tr><td>projectLocalRepoPath</td><td>本地仓库的目录，相对于rootProject的目录，如：<code>local-maven-repo</code></td><td>默认位于根项目的 <code>build/mavenRepos</code> 目录中</td></tr></tbody></table><h2 id=常见问题>常见问题<a hidden class=anchor aria-hidden=true href=#常见问题>#</a></h2><h3 id=发布到-snapshot>发布到 snapshot<a hidden class=anchor aria-hidden=true href=#发布到-snapshot>#</a></h3><p>我们根据版本号来选择发布到的是 snapshot 还是 release 仓库，版本号从 <code>android->defaultConfig - versionName</code> 中读取，如：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>android {
</span></span><span style=display:flex><span>    compileSdkVersion(<span style=color:#ae81ff>30</span>)
</span></span><span style=display:flex><span>    buildToolsVersion(<span style=color:#e6db74>&#34;30.0.3&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    defaultConfig {
</span></span><span style=display:flex><span>        minSdkVersion(<span style=color:#ae81ff>22</span>)
</span></span><span style=display:flex><span>        targetSdkVersion(<span style=color:#ae81ff>30</span>)
</span></span><span style=display:flex><span>        versionCode(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        versionName(<span style=color:#e6db74>&#34;1.0.0-SNAPSHOT&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=发布到本地并进行测试>发布到本地并进行测试<a hidden class=anchor aria-hidden=true href=#发布到本地并进行测试>#</a></h3><p>首先我们通过 <code>projectLocalRepoPath</code> 来改变 ProjectLocal 仓库的目录，下面的示例中将其设置为 rootProject 的 local-maven-repo 目录中</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>apply(plugin = <span style=color:#e6db74>&#34;com.github.hanlyjiang.android_maven_pub&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>configure&lt;io.hanlyjiang.gradle.android.AndroidMavenPubPluginExtension&gt; {
</span></span><span style=display:flex><span>    groupId.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;com.github.hanlyjiang&#34;</span>)
</span></span><span style=display:flex><span>    artifactId.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;android-common-utils&#34;</span>)
</span></span><span style=display:flex><span>    projectLocalRepoPath.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;local-maven-repo&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>接下来我们定义本地的 Repo ，见下方名为 <code>ProjectLocal-Snapshots</code> 及 <code>ProjectLocal-Release</code> 的仓库。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>allprojects {
</span></span><span style=display:flex><span>    repositories {
</span></span><span style=display:flex><span>        maven { setUrl(<span style=color:#e6db74>&#34;https://maven.aliyun.com/repository/jcenter&#34;</span>) }
</span></span><span style=display:flex><span>        maven { setUrl(<span style=color:#e6db74>&#34;https://maven.aliyun.com/repository/google&#34;</span>) }
</span></span><span style=display:flex><span>        maven { setUrl(<span style=color:#e6db74>&#34;https://maven.aliyun.com/repository/gradle-plugin&#34;</span>) }
</span></span><span style=display:flex><span>        maven { setUrl(<span style=color:#e6db74>&#34;https://maven.aliyun.com/repository/public&#34;</span>) }
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 定义本地repo路径
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        maven {
</span></span><span style=display:flex><span>            name = <span style=color:#e6db74>&#34;ProjectLocal-Snapshots&#34;</span>
</span></span><span style=display:flex><span>            setUrl(File(rootProject.rootDir, <span style=color:#e6db74>&#34;local-maven-repo</span><span style=color:#e6db74>${File.separator}</span><span style=color:#e6db74>snapshots&#34;</span>))
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        maven {
</span></span><span style=display:flex><span>            name = <span style=color:#e6db74>&#34;ProjectLocal-Release&#34;</span>
</span></span><span style=display:flex><span>            setUrl(File(rootProject.rootDir, <span style=color:#e6db74>&#34;local-maven-repo</span><span style=color:#e6db74>${File.separator}</span><span style=color:#e6db74>release&#34;</span>))
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        maven {
</span></span><span style=display:flex><span>            name = <span style=color:#e6db74>&#34;Sonatype-Snapshots&#34;</span>
</span></span><span style=display:flex><span>            setUrl(<span style=color:#e6db74>&#34;https://oss.sonatype.org/content/repositories/snapshots&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e>//            setUrl(&#34;https://s01.oss.sonatype.org/content/repositories/snapshots&#34;)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#75715e>// snapshot可以不用用户名密码
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#75715e>// 查看自己的snapshot版本： https://oss.sonatype.org/content/repositories/snapshots/com/github/hanlyjiang/
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            credentials(PasswordCredentials<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java) {
</span></span><span style=display:flex><span>                username = <span style=color:#66d9ef>property</span>(<span style=color:#e6db74>&#34;ossrhUsername&#34;</span>).toString()
</span></span><span style=display:flex><span>                password = <span style=color:#66d9ef>property</span>(<span style=color:#e6db74>&#34;ossrhPassword&#34;</span>).toString()
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        maven {
</span></span><span style=display:flex><span>            name = <span style=color:#e6db74>&#34;Sonatype-Staging&#34;</span>
</span></span><span style=display:flex><span>            setUrl(<span style=color:#e6db74>&#34;https://oss.sonatype.org/service/local/staging/deploy/maven2/&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e>//            setUrl(&#34;https://s01.oss.sonatype.org/service/local/staging/deploy/maven2/&#34;)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            credentials(PasswordCredentials<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java) {
</span></span><span style=display:flex><span>                username = <span style=color:#66d9ef>property</span>(<span style=color:#e6db74>&#34;ossrhUsername&#34;</span>).toString()
</span></span><span style=display:flex><span>                password = <span style=color:#66d9ef>property</span>(<span style=color:#e6db74>&#34;ossrhPassword&#34;</span>).toString()
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://anlyjiang.github.io/tags/gradle/>Gradle</a></li><li><a href=https://anlyjiang.github.io/tags/android/>Android</a></li><li><a href=https://anlyjiang.github.io/tags/%E5%B7%A5%E5%85%B7/>工具</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://anlyjiang.github.io/>清水池塘</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>