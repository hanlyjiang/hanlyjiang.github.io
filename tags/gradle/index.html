<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Gradle | æ¸…æ°´æ± å¡˜</title><meta name=keywords content><meta name=description content><meta name=author content="é‡ç”Ÿè²è—•"><link rel=canonical href=https://hanlyjiang.github.io/tags/gradle/><link crossorigin=anonymous href=/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css integrity="sha256-NDzEgLn/yPBMy+XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as=style><link rel=icon href=https://hanlyjiang.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://hanlyjiang.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://hanlyjiang.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://hanlyjiang.github.io/apple-touch-icon.png><link rel=mask-icon href=https://hanlyjiang.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://hanlyjiang.github.io/tags/gradle/index.xml title=rss><link rel=alternate hreflang=en href=https://hanlyjiang.github.io/tags/gradle/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="https://hanlyjiang.github.io/tags/gradle/"><meta property="og:site_name" content="æ¸…æ°´æ± å¡˜"><meta property="og:title" content="Gradle"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="Gradle"><meta name=twitter:description content></head><body class=list id=top><header class=header><nav class=nav><div class=logo><a href=https://hanlyjiang.github.io/ accesskey=h title="æ¸…æ°´æ± å¡˜ (Alt + H)">æ¸…æ°´æ± å¡˜</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu></ul></nav></header><main class=main><header class=page-header><h1>Gradle</h1></header><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>ä½¿ç”¨Kotlinç¼–å†™gradleè„šæœ¬</h2></header><div class=entry-content><p>å°†gradle è„šæœ¬ä» groovy è¿ç§»åˆ° kotlin dslã€‚
æ¦‚è¿° IDE æ”¯æŒ Build import Syntax highlighting 1 Semantic editor 2 IntelliJ IDEA âœ“ âœ“ âœ“ Android Studio âœ“ âœ“ âœ“ Eclipse IDE âœ“ âœ“ âœ– CLion âœ“ âœ“ âœ– Apache NetBeans âœ“ âœ“ âœ– Visual Studio Code (LSP) âœ“ âœ“ âœ– Visual Studio âœ“ âœ– âœ– Gradle Kotlin DSL scripts ä¸­çš„Kotlinè¯­æ³•é«˜äº® Gradle Kotlin DSL scripts ä¸­æ”¯æŒä»£ç è¡¥å…¨ï¼Œå¯¼èˆªåˆ°æºç ï¼Œæ–‡æ¡£æŸ¥çœ‹ï¼Œé‡æ„ç­‰ç­‰ï¼› Kotlin DSL è„šæœ¬å‘½å å‘½å Groovy DSL script æ–‡ä»¶ä½¿ç”¨ .gradle æ‰©å±•æ–‡ä»¶å
...</p></div><footer class=entry-footer><span title='2022-02-24 22:29:04 +0000 UTC'>February 24, 2022</span>&nbsp;Â·&nbsp;<span>4 min</span>&nbsp;Â·&nbsp;<span>é‡ç”Ÿè²è—•</span></footer><a class=entry-link aria-label="post link to ä½¿ç”¨Kotlinç¼–å†™gradleè„šæœ¬" href=https://hanlyjiang.github.io/posts/shi-yong-kotlin-bian-xie-gradle-jiao-ben/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Gradleå­¦ä¹ æŒ‡å—-å‰è¨€</h2></header><div class=entry-content><p>è¿™ä¸ªå¯¹äºå®‰å“å¼€å‘æ¥è¯´ï¼ŒGradleå¯ä»¥ä¸äº†è§£ï¼Œä½†æ˜¯åˆå¿…é¡»äº†è§£ã€‚
è¯´ä¸éœ€è¦äº†è§£ï¼Œæ˜¯å› ä¸ºï¼š é€šè¿‡AndroidStudioå»ºç«‹å·¥ç¨‹çš„æ—¶å€™ï¼Œé»˜è®¤å°±åˆ›å»ºå¥½äº†Gradleçš„é¡¹ç›®ç»“æ„åŠå¯¹åº”çš„ä»»åŠ¡ï¼Œé€šè¿‡IDEæ¥æ·»åŠ æ¨¡å—çš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥è‡ªåŠ¨çš„æ·»åŠ Gradleçš„é…ç½®ã€‚
è¯´éœ€è¦äº†è§£ï¼Œæ˜¯å› ä¸ºï¼šæœ‰æ—¶å€™ä¼šé‡åˆ°æ„å»ºé”™è¯¯ï¼Œè¿˜æœ‰æ—¶å€™éœ€è¦æ”¹ä¸€æ”¹æ„å»ºæµç¨‹çš„é»˜è®¤è¡Œä¸ºï¼Œå¦å¤–æœ‰äº›æ—¶å€™ï¼Œéœ€è¦è‡ªè¡Œæ‰©å±•ä¸€ä¸ªæ„å»ºä»»åŠ¡ã€‚
Gradleå­¦ä¹ çš„ä¸€ä¸ªéš¾ç‚¹åœ¨äºï¼Œå…¶å­¦ä¹ èµ„æ–™éå¸¸é›¶æ•£ï¼Œå°‘æœ‰æˆä½“ç³»çš„å­¦ä¹ èµ„æ–™ã€‚å½“ç„¶ï¼Œå®˜æ–¹æ–‡æ¡£æ˜¯å¾ˆæˆä½“ç³»çš„ï¼Œå®˜æ–¹æ–‡æ¡£ä¹Ÿæœ‰ä¸å¥½çš„åœ°æ–¹ï¼š
çº¯è‹±æ–‡ï¼› ç‰ˆæœ¬æ›´æ–°ä¹‹åï¼Œæ–‡æ¡£ç»“æ„æœ‰å˜åŒ–ã€‚ å®˜æ–¹æ–‡æ¡£å¯¹äºå®‰å“é¡¹ç›®çš„è¯´æ˜æ²¡æœ‰ï¼ˆå› ä¸ºandroidçš„æ’ä»¶æ˜¯googleè‡ªè¡Œæ‰©å±•çš„ï¼‰ è¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œå‰æœŸgradleçš„è„šæœ¬éƒ½æ˜¯ä½¿ç”¨groovyæ¥ç¼–å†™ï¼Œæˆ‘ä»¬è¦å†™è„šæœ¬ï¼Œéœ€è¦å»å­¦ä¹ ä¸€é—¨æ–°çš„è¯­è¨€ï¼Œè™½ç„¶è¿™ä¸ªè¯­è¨€å’Œjavaæ¯”è¾ƒæ¥è¿‘ï¼Œä½†æ˜¯ç”±äºæ²¡ä»€ä¹ˆå…¶ä»–ç”¨é€”ï¼ŒåŠ ä¸Šéœ€è¦ç¼–å†™gradleè„šæœ¬çš„åœºæ™¯ä¹Ÿä¸æ˜¯é‚£ä¹ˆå¸¸è§ï¼Œå°±ä¼šè®©è§‰å¾—æœ‰ç‚¹ä¸å€¼å¾—æŠ•å…¥ï¼Œè¿™ä¸¤ä¸ªå› ç´ ç»“åˆèµ·æ¥ï¼Œä¼šåŠé€€å¾ˆå¤šå®‰å“å¼€å‘äººå‘˜ã€‚ç°åœ¨ï¼Œgradleå¯ä»¥ä½¿ç”¨kotlinæ¥ç¼–å†™å…¶dslè„šæœ¬ï¼Œå­¦ä¹ æˆæœ¬ä¼šé™ä½å¾ˆå¤šã€‚
è§åˆ°å…¶wrapperçš„è®¾è®¡ä»¤æˆ‘å°è±¡æ·±åˆ»ï¼Œå¯¹æ¯”antåŠmavenéœ€è¦æ‰‹åŠ¨å»ä¸‹è½½ä¸€ä»½äºŒè¿›åˆ¶å‰¯æœ¬ï¼Œç„¶åé…ç½®åˆ°ç¯å¢ƒå˜é‡ä¸­ï¼Œè€Œä½ è·å–åˆ°åˆ«äººçš„gradleé¡¹ç›®ä¹‹åï¼Œç›´æ¥ä½¿ç”¨wrapperè„šæœ¬ï¼Œå°±å¯ä»¥æ‰§è¡Œgradleä»»åŠ¡ï¼Œwrapperè„šæœ¬ä¼šè‡ªåŠ¨å¸®åŠ©ä½ å»è·å–ä¸€ä»½gradleçš„äºŒè¿›åˆ¶å‰¯æœ¬ï¼Œå°±å¥½åƒä½ ç›´æ¥æ‰§è¡Œgradleçš„äºŒè¿›åˆ¶å‘½ä»¤ä¸€æ ·ã€‚
å¦å¤–gradleä¹Ÿæä¾›äº†æ–¹ä¾¿çš„æ‰©å±•æœºåˆ¶ï¼Œèƒ½å¯¹æ„å»ºæµç¨‹è¿›è¡Œå®šåˆ¶ã€‚
æ¥ä¸‹æ¥ï¼Œæˆ‘å°†ä»å®‰å“å¼€å‘çš„è§†è§’ï¼Œå¯¹Gradleçš„ä½¿ç”¨åšä¸€ä¸ªæ•´ä½“çš„ä»‹ç»ã€‚å†…å®¹ä¸Šä¼šåŒ…æ‹¬Gradleçš„ä¸€äº›åŸºç¡€æ¦‚å¿µï¼Œä¸€äº›å¸¸è§çš„Gradleä»»åŠ¡ä»‹ç»ï¼ŒAndroidçš„å¸¸è§Gradleé…ç½®ä»‹ç»ï¼ŒåŒæ—¶ä¹Ÿä¼šä»‹ç»è‡ªå®šä¹‰Gradleä»»åŠ¡åŠGradleæ’ä»¶ã€‚</p></div><footer class=entry-footer><span title='2021-10-07 22:07:09 +0000 UTC'>October 7, 2021</span>&nbsp;Â·&nbsp;<span>1 min</span>&nbsp;Â·&nbsp;<span>é‡ç”Ÿè²è—•</span></footer><a class=entry-link aria-label="post link to Gradleå­¦ä¹ æŒ‡å—-å‰è¨€" href=https://hanlyjiang.github.io/posts/gradle-xue-xi-zhi-nan-qian-yan/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>ç®€åŒ–Androidåº“ä¸Šä¼ åˆ°Mavenä»“åº“çš„gradleé…ç½®</h2></header><div class=entry-content><p>é…ç½® android ä¸Šä¼ åˆ° maven ä¸­å¿ƒä»“åº“ï¼Œå‘ç°é…ç½®çš„ä»£ç æœ‰ç‚¹å¤šï¼Œè€Œä¸”å¦‚æœæœ‰å¤šä¸ªåº“æ¨¡å—éœ€è¦ä¸Šä¼ ï¼Œåˆ™éœ€è¦å¤åˆ¶ç²˜è´´ä¸å°‘é‡å¤çš„é…ç½®ä»£ç ï¼Œäºæ˜¯ç¼–å†™äº†ä¸€ä¸ª gradle æ’ä»¶ç”¨äºç®€åŒ–æå–è¿™ä¸ªé…ç½®è¿‡ç¨‹ï¼›
æ’ä»¶ç”¨é€”åŠæ•ˆæœ æœ¬æ’ä»¶ç”¨äºç®€åŒ–Androidåº“ä¸Šä¼ åˆ°Mavenä¸­å¿ƒä»“åº“çš„é…ç½®ï¼Œé¿å…æ¯ä¸ªprojectçš„gradleä¸­éƒ½æ”¾ç½®ä¸€ä»½é‡å¤è¾ƒå¤šçš„é…ç½®ï¼›
æ’ä»¶æœ‰å¦‚ä¸‹åŠŸèƒ½ï¼š
ç®€åŒ– maven-publish æ’ä»¶çš„é…ç½®æµç¨‹ï¼› æ·»åŠ ä¸Šä¼ åˆ°Mavenä¸­å¿ƒä»“åº“çš„ publish ä»»åŠ¡ï¼› æ”¯æŒé…ç½®ä¸Šä¼ æ—¶æ˜¯å¦åŒ…å« javadoc åŠæºç ï¼› ç›´æ¥ä½¿ç”¨maven-publishæ’ä»¶çš„é…ç½®ï¼š import org.gradle.api.publish.maven.MavenPom plugins { id("com.android.library") id("signing") `maven-publish` } android { defaultConfig { versionName("1.0.0-SNAPSHOT") } } dependencies { // } tasks.register("javadoc", Javadoc::class.java) { group = "publishing" dependsOn("assemble") source = android.sourceSets["main"].java.getSourceFiles() classpath += project.files(android.bootClasspath + File.pathSeparator) if (JavaVersion.current().isJava9Compatible) { (options as StandardJavadocDocletOptions).addBooleanOption("html5", true) } android.libraryVariants.forEach { libraryVariant -> classpath += libraryVariant.javaCompileProvider.get().classpath } options.apply { encoding("UTF-8") charset("UTF-8") isFailOnError = false (this as StandardJavadocDocletOptions).apply { // addStringOption("Xdoclint:none") links?.add("https://developer.android.google.cn/reference/") links?.add("http://docs.oracle.com/javase/8/docs/api/") } } } tasks.register("jarSource", Jar::class.java) { group = "publishing" from(android.sourceSets["main"].java.srcDirs) archiveClassifier.set("sources") } tasks.register("jarJavadoc", Jar::class.java) { group = "publishing" dependsOn("javadoc") val javadoc: Javadoc = tasks.getByName("javadoc") as Javadoc from(javadoc.destinationDir) archiveClassifier.set("javadoc") } fun getMyPom(): Action&lt;in MavenPom> { return Action&lt;MavenPom> { name.set("Android Common Utils Lib") description.set("Android Common Utils Library For HJ") url.set("https://github.com/hanlyjiang/lib_common_utils") licenses { license { name.set("The Apache License, Version 2.0") url.set("http://www.apache.org/licenses/LICENSE-2.0.txt") } } developers { developer { id.set("hanlyjiang") name.set("Hanly Jiang") email.set("hanlyjiang@outlook.com") } } scm { connection.set("scm:git:git://github.com/hanlyjiang/lib_common_utils.git") developerConnection.set("scm:git:ssh://github.com/hanlyjiang/lib_common_utils.git") url.set("https://github.com/hanlyjiang/lib_common_utils") } } } afterEvaluate { publishing { publications { create&lt;MavenPublication>("release") { from(components.getByName("release")) groupId = "com.github.hanlyjiang" artifactId = "android_common_utils" version = android.defaultConfig.versionName pom(getMyPom()) // æ·»åŠ javadoc artifact(tasks.getByName("jarJavadoc") as Jar) // æ·»åŠ source artifact(tasks.getByName("jarSource") as Jar) } } repositories { val ossrhCredentials = Action&lt;PasswordCredentials> { username = properties["ossrhUsername"].toString() password = properties["ossrhPassword"].toString() } // sonarçš„ä»“åº“ï¼Œåœ°å€æ ¹æ®é¡¹ç›®çš„ç‰ˆæœ¬å·æ¥ç¡®å®šæ˜¯snapshotè¿˜æ˜¯æ­£å¼ä»“åº“ maven { name = "Sonartype" val releasesRepoUrl = uri("https://oss.sonatype.org/service/local/staging/deploy/maven2") val snapshotsRepoUrl = uri("https://oss.sonatype.org/content/repositories/snapshots/") url = if (android.defaultConfig.versionName.toString().endsWith("SNAPSHOT")) snapshotsRepoUrl else releasesRepoUrl credentials(ossrhCredentials) // snapshotçš„åœ°å€ï¼š // https://oss.sonatype.org/content/repositories/snapshots/com/github/hanlyjiang/android_common_utils/ } // é¡¹ç›®æœ¬åœ°çš„ä»“åº“ maven { name = "ProjectLocal" val releasesRepoUrl = uri(layout.buildDirectory.dir("repos/releases")) val snapshotsRepoUrl = uri(layout.buildDirectory.dir("repos/snapshots")) url = if (android.defaultConfig.versionName.toString().endsWith("SNAPSHOT")) snapshotsRepoUrl else releasesRepoUrl } } } signing { sign(publishing.publications.getByName("release")) } } ä½¿ç”¨AndroidMavenPubPluginç®€åŒ–åçš„é…ç½®ï¼š import org.gradle.api.publish.maven.MavenPom plugins { id("com.android.library") id("signing") `maven-publish` // å¼•å…¥æˆ‘ä»¬æœ¬åœ°ä»“åº“ä¸­çš„gradleæ’ä»¶ id("com.github.hanlyjiang.android_maven_pub") version ("0.0.5") apply (false) } android { defaultConfig { versionName("1.0.1-SNAPSHOT") } } dependencies { // } apply(plugin = "com.github.hanlyjiang.android_maven_pub") configure&lt;io.hanlyjiang.gradle.android.AndroidMavenPubPluginExtension> { groupId.set("com.github.hanlyjiang") artifactId.set("android-common-utils") projectLocalRepoPath.set("local-maven-repo") mavenPomAction.set(Action&lt;MavenPom> { name.set("Android Common Utils Lib") description.set("Android Common Utils Library For HJ") url.set("https://github.com/hanlyjiang/lib_common_utils") properties.set( mapOf( "myProp" to "value", "prop.with.dots" to "anotherValue" ) ) licenses { license { name.set("The Apache License, Version 2.0") url.set("http://www.apache.org/licenses/LICENSE-2.0.txt") } } developers { developer { id.set("hanlyjiang") name.set("Hanly Jiang") email.set("hanlyjiang@outlook.com") } } scm { connection.set("scm:git:git://github.com/hanlyjiang/lib_common_utils.git") developerConnection.set("scm:git:ssh://github.com/hanlyjiang/lib_common_utils.git") url.set("https://github.com/hanlyjiang/lib_common_utils") } }) } ä½¿ç”¨æ­¥éª¤ å¼•å…¥æ’ä»¶ åœ¨éœ€è¦ä½¿ç”¨çš„æ¨¡å—çš„buildè„šæœ¬ä¸­ï¼Œå¼•å…¥æˆ‘ä»¬çš„æ’ä»¶ï¼ŒåŒæ—¶å¼•å…¥ maven-publish æ’ä»¶å’Œ signing æ’ä»¶ã€‚
...</p></div><footer class=entry-footer><span title='2021-06-01 10:26:00 +0000 UTC'>June 1, 2021</span>&nbsp;Â·&nbsp;<span>5 min</span>&nbsp;Â·&nbsp;<span>é‡ç”Ÿè²è—•</span></footer><a class=entry-link aria-label="post link to ç®€åŒ–Androidåº“ä¸Šä¼ åˆ°Mavenä»“åº“çš„gradleé…ç½®" href=https://hanlyjiang.github.io/posts/jian-hua-android-ku-shang-chuan-dao-maven-cang-ku-de-gradle-pei-zhi/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>ç¼–å†™ä¸€ä¸ªAndroid Gradleæ’ä»¶</h2></header><div class=entry-content><p>gradleæœ‰ä¸‰ç§ç¼–å†™æ’ä»¶çš„æ–¹å¼ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨åœ¨é¡¹ç›®ä¸­çš„buildSrcæ¨¡å—ä¸­ç¼–å†™æ’ä»¶çš„æ–¹å¼ï¼Œè‡ªå®šä¹‰äº†ä¸€ä¸ªåº”ç”¨äºAndroidé¡¹ç›®çš„æ ¹æ®flavorè¿‡æ»¤soåº“çš„gradleæ’ä»¶ï¼›
æ¦‚è¿° è‡ªå®šä¹‰gradleæ’ä»¶æœ‰å¦‚ä¸‹ä¸‰ç§æ–¹å¼ï¼ˆğŸ”—é“¾æ¥ï¼‰ï¼š
åœ¨buildscriptä¸­ç›´æ¥ç¼–å†™ï¼› åœ¨buildSrcé¡¹ç›®ä¸­ç¼–å†™æ’ä»¶ä»£ç ï¼› åœ¨ç‹¬ç«‹çš„é¡¹ç›®ä¸­ç¼–å†™æ’ä»¶ä»£ç ï¼› è¿™é‡Œæˆ‘ä»¬å°†ä½¿ç”¨buildSrcæ–¹å¼å®ç°ä¸€ä¸ªgradleæ’ä»¶ã€‚
æ–°å»º buildSrc module gradleä¼šåœ¨é¡¹ç›®ä¸­å¯»æ‰¾åç§°ä¸ºbuildSrcæ¨¡å—ï¼Œå°†å…¶åŠ è½½ä¸ºgradleçš„æ’ä»¶ä»£ç ç›®å½•ã€‚æ‰€ä»¥æˆ‘ä»¬ç›´æ¥é€šè¿‡èœå•æ–°å»ºä¸€ä¸ªåä¸º buildSrc çš„java/kotlinæ¨¡å—ã€‚
ç„¶ååœ¨build.gradleä¸­æ·»åŠ ç›¸å…³çš„plugin(java-gradle-plugin)åŠä¾èµ–ï¼š
plugins { id 'java' id 'java-gradle-plugin' id "org.jetbrains.kotlin.jvm" version '1.3.61' } group = "io.github.hanlyjiang.gradle" version = "0.0.2" dependencies { testCompile group: 'junit', name: 'junit', version: '4.12' // æ·»åŠ androidç›¸å…³build toolsä¾èµ–ï¼Œä»¥ä¾¿ä½¿ç”¨ android gradle ç›¸å…³çš„API compile 'com.android.tools.build:gradle:3.2.0' } ç¼–å†™æ’ä»¶ éœ€æ±‚ç®€ä»‹ **åº”ç”¨åœºæ™¯ï¼š**æˆ‘ä»¬çš„äº§å“ä¸­é›†æˆäº†ä¸¤ç§VPN SDKï¼Œä½†æ˜¯å…·ä½“åˆ°æ¯ä¸ªé¡¹ç›®ä¸Šé¢ï¼Œéƒ½åªä¼šè½åœ°åˆ°å…·ä½“çš„ä¸€ç§ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦æ’é™¤å¯¹åº”çš„SDKçš„SOåº“ä»¥å‡å°APPåŒ…å¤§å°ï¼Œä¸åŒçš„åœ°åŒºçš„æ‰“åŒ…é…ç½®é€šè¿‡flavoræ¥è¿›è¡ŒåŒºåˆ†é…ç½®ï¼Œå³æ¯ä¸ªåœ°åŒºä¼šå¯¹åº”ä¸åŒçš„flavorï¼›
éœ€æ±‚æå–ï¼š è¿™é‡Œå®é™…ä¸Šæˆ‘ä»¬éœ€è¦çš„æ˜¯èƒ½å¤Ÿæ ¹æ®flavorï¼Œåœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­ç§»é™¤æŒ‡å®šçš„soæ–‡ä»¶ï¼›
å®ç°æ€è·¯ï¼š
flavoré…ç½®æ–¹å¼ï¼šåœ¨flavorä¸­é…ç½®ä¸€ä¸ªbuildConfigFieldå­—æ®µï¼Œç”¨äºæŒ‡å®šæˆ‘ä»¬çš„flavoréœ€è¦çš„é…ç½®
// é…ç½®VPNç±»å‹ buildConfigField "String", "VPN_TYPE", "\"$VpnType.SANG_FOR\"" æ’ä»¶é…ç½®ï¼šæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªso_excludeé…ç½®æ¥æŒ‡å®šå…·ä½“çš„excludeè§„åˆ™ï¼ŒåŒ…å«ä¸¤ä¸ªå­—æ®µã€‚
buildConfigFieldKey ç”¨äºæŒ‡å®šä¹‹å‰åœ¨flavorä¸­å®šä¹‰çš„é…ç½®ï¼› configMap ä¸ºä¸€ä¸ªé…ç½®è¡¨ï¼ŒæŒ‡å®šä¸Šé¢çš„å­—æ®µå¯å–çš„å€¼ï¼Œå³å¯¹åº”å€¼åº”è¯¥excludeçš„soæ–‡ä»¶åˆ—è¡¨ï¼› so_exclude { /** * ä½¿ç”¨VPN_TYPE æ¥è®¾ç½®soè¿‡æ»¤çš„è§„åˆ™ */ buildConfigFieldKey = "VPN_TYPE" configMap = [ (VpnType.H3C_iNode.name()): [ // æ–°åä¸‰è¿‡æ»¤æ·±ä¿¡æœçš„ "lib/armeabi-v7a/libauth_forward.so", "lib/armeabi-v7a/libhttps.so", "lib/armeabi-v7a/libpkcs12cert.so", "lib/armeabi-v7a/libsvpnservice.so" ], (VpnType.SANG_FOR.name()) : [ // æ·±ä¿¡æœè¿‡æ»¤æ–°åä¸‰çš„ "lib/armeabi-v7a/libies.so", ], (VpnType.NONE.name()) : [ // å¦‚é…ç½®æˆ NONEï¼Œåˆ™è¿‡æ»¤æ‰æ‰€æœ‰çš„VPNçš„ // æ·±ä¿¡æœçš„so "lib/armeabi-v7a/libauth_forward.so", "lib/armeabi-v7a/libhttps.so", "lib/armeabi-v7a/libpkcs12cert.so", "lib/armeabi-v7a/libsvpnservice.so", // inodeçš„so "lib/armeabi-v7a/libies.so", ] ] } å®šä¹‰æ’ä»¶åŠä½¿ç”¨æ’ä»¶ç®€ä»‹ æ’ä»¶éœ€è¦ç»§æ‰¿ org.gradle.api.Pluginï¼Œå¯åœ¨Pluginå¯¹æ„å»ºæµç¨‹è¿›è¡Œè‡ªå®šä¹‰ï¼ˆå¦‚ï¼šåˆ›å»ºä»»åŠ¡ï¼Œå®šä¹‰ä»»åŠ¡å…³ç³»ï¼Œä¿®æ”¹å·²æœ‰ä»»åŠ¡åŠ¨ä½œç­‰ï¼‰ æ’ä»¶å¦‚æœéœ€è¦èƒ½å¤Ÿè¯»å–ä¸€äº›é…ç½®ï¼Œå¯é€šè¿‡ project.extensions.create æ¥ä»build.gradleä¸­æå– å¦‚éœ€åœ¨è‡ªå·±çš„ androidä»£ç æ¨¡å—ä¸­ä½¿ç”¨æ’ä»¶ï¼Œé€šè¿‡ apply plugin: æ’ä»¶ç±»å¼•ç”¨å³å¯ æ’ä»¶å®ç° æ’ä»¶çš„å®ç°å¦‚ä¸‹ï¼š è¯»å– so_exclude é…ç½®ï¼Œå­˜å‚¨åˆ° extensionï¼ˆç±»å‹ä¸º FlavorSoExcludePluginExtension ï¼‰ä¸­ è¯»å– android çš„é…ç½®ï¼Œæ‰¾åˆ° AppExtensionç±»å‹çš„é…ç½®ï¼Œä¹Ÿå°±æ˜¯åº”ç”¨äº† apply application çš„æ¨¡å—çš„é…ç½®ï¼Œæˆ‘ä»¬çš„é¡¹ç›®ä¸­åªæœ‰ä¸€ä¸ªappæ¨¡å—åº”ç”¨æ­¤é…ç½®-å³æˆ‘ä»¬çš„apkæ¨¡å—ï¼› éå†æ‰€æœ‰å˜ä½“ï¼Œè·å–å¯¹åº”å˜ä½“çš„ so_exclude å¯¹åº”çš„é…ç½®å­—æ®µçš„å€¼ï¼Œå»ºç«‹flavoråˆ°é…ç½®å€¼çš„æ˜ å°„è¡¨ï¼› ä¿®æ”¹ packageApplication ä»»åŠ¡ï¼Œè®©å…¶åœ¨æ‰§è¡Œä¹‹å‰å³åˆ é™¤å¾…æ‰“åŒ…ä¸´æ—¶ç›®å½•ä¸­çš„å¯¹åº”soæ–‡ä»¶ï¼› package io.github.hanlyjiang.gradle.plugin.soexclude import com.android.build.gradle.AppExtension import com.android.build.gradle.api.ApkVariantOutput import org.gradle.api.Plugin import org.gradle.api.Project import org.gradle.api.logging.LogLevel import org.gradle.api.logging.Logger import org.gradle.api.logging.Logging import java.io.File /** * so æ’ä»¶çš„ gradle é…ç½®å®ä½“ */ open class FlavorSoExcludePluginExtension { /** * so è¿‡æ»¤é…ç½®è¡¨ */ var configMap: Map&lt;String, List&lt;String>>? = null /** * é…ç½®å­—æ®µçš„åç§° */ var buildConfigFieldKey: String = FlavorSoExcludePlugin.DEFAULT_CONFIG_KEY } /** * flavor so æ‰“åŒ…è¿‡æ»¤é…ç½® * * ## ç”¨æ³•è¯´æ˜ï¼š * * 1. åœ¨build.gradle ä¸­å¼•å…¥æ’ä»¶ &lt;code>apply plugin: FlavorSoExcludePlugin&lt;/code>; * 2. æ·»åŠ  so_exclude é…ç½®æ®µï¼š * * ```groovy * so_exclude { * buildConfigFieldKey = "VPN_TYPE" * configMap = [ * (VpnType.H3C_iNode.name()): [ * "lib/armeabi-v7a/libauth_forward.so", * "lib/armeabi-v7a/libhttps.so", * "lib/armeabi-v7a/libpkcs12cert.so", * "lib/armeabi-v7a/libsvpnservice.so" * ], * (VpnType.SANG_FOR.name()) : [ * "lib/armeabi-v7a/libies.so", * ], * (VpnType.NONE.name()) : [ * // æ·±ä¿¡æœçš„so * "lib/armeabi-v7a/libauth_forward.so", * "lib/armeabi-v7a/libhttps.so", * "lib/armeabi-v7a/libpkcs12cert.so", * "lib/armeabi-v7a/libsvpnservice.so", * // inodeçš„so * "lib/armeabi-v7a/libies.so", * ] * ] *} *``` * 3. åœ¨flavorçš„é…ç½®ä¸­æ·»åŠ  buildConfigField é…ç½®ï¼Œå¦‚ï¼š * ``` * buildConfigField "String", "VPN_TYPE", "\"$VpnType.H3C_iNode\"" * ``` * å…¶ä¸­å­—æ®µçš„åç§°ä¸º ä¹‹å‰ so_exclude ä¸­é…ç½®çš„ `buildConfigFieldKey` å­—æ®µï¼Œå¯¹åº”çš„å€¼ä¸º configMap ä¸­çš„ key ï¼Œå¦‚æ­¤é…ç½®åï¼Œæ‰“åŒ…æ—¶å°±ä¼šå°†configMapå¯¹åº”keyä¸­çš„soåˆ—è¡¨è¿‡æ»¤æ‰ * @author hanlyjiang 09/20/20 2:42 PM * @version 1.0 */ class FlavorSoExcludePlugin : Plugin&lt;Project> { companion object { const val PLUGIN_NAME = "FlavorSoExcludePlugin" const val DEFAULT_CONFIG_KEY = "SO_EXCLUDE" const val DEBUG = false private val logger: Logger = Logging.getLogger(FlavorSoExcludePlugin::class.java) fun logInfo(msg: String) { logger.log(LogLevel.LIFECYCLE, "&lt;- $PLUGIN_NAME: $msg ->") } fun logDebug(msg: String) { if (DEBUG) { logInfo(msg) } } } lateinit var extension: FlavorSoExcludePluginExtension override fun apply(project: Project) { // æ·»åŠ è‡ªå·±çš„é…ç½® extension = project.extensions.create("so_exclude", FlavorSoExcludePluginExtension::class.java) // åˆ›å»ºä¸€ä¸ªæ‰“å°é…ç½®çš„ä»»åŠ¡ï¼Œç”¨äºå®šä¹‰ val task = project.tasks.create("printConfig") task.group = "soExclude-plugin" task.doLast { logInfo("-- é…ç½®å­—æ®µï¼šbuildConfigFieldKey= " + extension.buildConfigFieldKey) logInfo("-- å½“å‰é…ç½®ï¼š") extension.configMap?.run { this.keys.forEach { key -> logInfo("-- config: $key -- ") get(key)?.forEach { logInfo("values: $it") } logInfo("------------------ ") } } } // è·å–androidçš„é…ç½® val androidExtensions = project.extensions.getByName("android") logInfo("" + androidExtensions.javaClass) if (androidExtensions is AppExtension) { // applicatoinç±»å‹çš„å°±è¿›è¡Œä»»åŠ¡å¤„ç† initPackageOptions(project, androidExtensions) } } /** * vpn é…ç½® */ private var configMap: MutableMap&lt;String, String> = HashMap() private fun initPackageOptions(project: Project, android: AppExtension) { project.afterEvaluate { android.productFlavors.all { val flavorName = it.name logDebug("--productFlavors : ${it.name}") var soExcludeConfig = "" it.buildConfigFields[extension.buildConfigFieldKey]?.run { soExcludeConfig = value.replace("\"", "") } logDebug("--productFlavors : $flavorName, soExcludeConfig: $soExcludeConfig") configMap[flavorName] = soExcludeConfig } android.applicationVariants.all { variant -> logDebug("app variant flavorName: ${variant.flavorName}") val flavorName = variant.flavorName val configKey = configMap[flavorName] variant.outputs.forEach { output -> if (output is ApkVariantOutput) { //æ ¸å¿ƒé€»è¾‘ï¼šä¿®æ”¹packageApplicationä»»åŠ¡ï¼Œåœ¨ç”ŸæˆapkåŒ…ä¹‹å‰ï¼Œåˆ é™¤æ‰“åŒ…ä¸´æ—¶ç›®å½•ä¸­çš„soæ–‡ä»¶å³å¯é¿å…æ‰“åŒ…soåˆ°apkä¸­ output.packageApplication.doFirst { output.packageApplication.jniFolders.all { // jniFolder ç›®å½•ä¸ºæœ€åæ‰“åŒ…apkæ—¶ï¼Œç”¨äºå­˜æ”¾soæ–‡ä»¶çš„ä¸´æ—¶ç›®å½• logInfo("å˜ä½“åç§°: ${variant.flavorName} , configKey: ${configKey}, jniFolders: " + it.absoluteFile) handleExclude(it, configKey); true } } } } } } } private fun handleExclude(jniFolder: File?, configKey: String?) { extension.configMap?.run { val soExcludeList: List&lt;String>? = get(configKey) soExcludeList?.run { deleteJniSoFiles(jniFolder, *(soExcludeList.toTypedArray())) } } } private fun deleteJniSoFiles(jniFolder: File?, vararg files: String) { for (item in files) { val file = File(jniFolder, item) if (file.exists()) { val deleteResult = file.delete() logInfo("åˆ é™¤soæ–‡ä»¶ $item : ${if (deleteResult) "æˆåŠŸ" else "å¤±è´¥"}") } } } } ä½¿ç”¨æšä¸¾è¿›è¡Œé…ç½® æˆ‘ä»¬åœ¨buildSrcä¸­å®šä¹‰ä¸€ä¸ªæšä¸¾ç±»ï¼Œç”¨äºçº¦å®šå¯ä»¥é…ç½®çš„å€¼ï¼Œå³å¯ä»¥æ¸…æ™°å®šä¹‰é…ç½®å€¼é¿å…é…ç½®æ—¶ç›´æ¥å†™å­—ç¬¦ä¸²å®¹æ˜“å‡ºé”™ï¼Œåˆå¯ä»¥æ”¯æŒä»£ç è‡ªåŠ¨è¡¥å…¨æ–¹ä¾¿é…ç½®ã€‚
...</p></div><footer class=entry-footer><span title='2020-09-20 10:18:50 +0000 UTC'>September 20, 2020</span>&nbsp;Â·&nbsp;<span>4 min</span>&nbsp;Â·&nbsp;<span>é‡ç”Ÿè²è—•</span></footer><a class=entry-link aria-label="post link to ç¼–å†™ä¸€ä¸ªAndroid Gradleæ’ä»¶" href=https://hanlyjiang.github.io/posts/%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AAandroid-gradle%E6%8F%92%E4%BB%B6/></a></article></main><footer class=footer><span>&copy; 2025 <a href=https://hanlyjiang.github.io/>æ¸…æ°´æ± å¡˜</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>