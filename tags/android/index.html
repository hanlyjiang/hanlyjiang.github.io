<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Android | æ¸…æ°´æ± å¡˜</title><meta name=keywords content><meta name=description content><meta name=author content="é‡ç”Ÿè²è—•"><link rel=canonical href=https://hanlyjiang.github.io/tags/android/><link crossorigin=anonymous href=/assets/css/stylesheet.d77462565513052a87c950bb53e36f2bd3370ba61307f161d7a360a3f34c13d5.css integrity="sha256-13RiVlUTBSqHyVC7U+NvK9M3C6YTB/Fh16Ngo/NME9U=" rel="preload stylesheet" as=style><link rel=icon href=https://hanlyjiang.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://hanlyjiang.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://hanlyjiang.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://hanlyjiang.github.io/apple-touch-icon.png><link rel=mask-icon href=https://hanlyjiang.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://hanlyjiang.github.io/tags/android/index.xml title=rss><link rel=alternate hreflang=en href=https://hanlyjiang.github.io/tags/android/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="https://hanlyjiang.github.io/tags/android/"><meta property="og:site_name" content="æ¸…æ°´æ± å¡˜"><meta property="og:title" content="Android"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="Android"><meta name=twitter:description content></head><body class=list id=top><header class=header><nav class=nav><div class=logo><a href=https://hanlyjiang.github.io/ accesskey=h title="æ¸…æ°´æ± å¡˜ (Alt + H)">æ¸…æ°´æ± å¡˜</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu></ul></nav></header><main class=main><header class=page-header><h1>Android</h1></header><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Android Jacocoè¦†ç›–ç‡ç»Ÿè®¡é…ç½®</h2></header><div class=entry-content><p>Android Jacoco è¦†ç›–ç‡ç»Ÿè®¡Gradleé…ç½®ï¼ŒåŒ…æ‹¬ç”Ÿæˆæœ¬åœ°å•å…ƒæµ‹è¯•æŠ¥å‘Šï¼Œä»ªå™¨å•å…ƒæµ‹è¯•æŠ¥å‘Šï¼Œåˆå¹¶ä¸¤ç§æµ‹è¯•çš„æŠ¥å‘Šï¼Œåˆå¹¶ä¸¤ç§æµ‹è¯•çš„æ‰§è¡Œæ•°æ®å¹¶åœ¨AndroidStudioçš„ç¼–è¾‘å™¨ä¸­æŸ¥çœ‹æ¯ä¸€è¡Œçš„è¦†ç›–ç‡æƒ…å†µã€‚
å¦‚ä½•è®©æµ‹è¯•ä»»åŠ¡ç”Ÿæˆ Jacoco è¦†ç›–ç‡ç»Ÿè®¡æ•°æ®ï¼Ÿ è¿™é‡Œæˆ‘ä»¬ä»…ä»…ä»Gradleä»»åŠ¡æ¥è¯´ï¼Œä¸è€ƒè™‘ AndroidStudio/IDEAã€‚
æœ¬åœ°å•å…ƒæµ‹è¯•ï¼ˆTestï¼‰ å¯¹äºæœ¬åœ°å•å…ƒæµ‹è¯•æ¥è¯´ï¼ŒåŸå…ˆæœ‰ä¸€ä¸ª testDebugUnitTest çš„æµ‹è¯•ä»»åŠ¡ï¼Œå¦‚æœä¸åšé…ç½®ï¼Œè¯¥ä»»åŠ¡åªä¼šç”Ÿæˆæµ‹è¯•é€šè¿‡æƒ…å†µçš„æŠ¥å‘Šã€‚åªè¦åº”ç”¨ jacoco æ’ä»¶ï¼Œç„¶åè¿è¡Œ testDebugUnitTest ä»»åŠ¡æ—¶ï¼Œå°±ä¼šåŒæ—¶ç”Ÿæˆjacocoè¦†ç›–ç‡ç»Ÿè®¡æ‰§è¡Œæ•°æ®æ–‡ä»¶ã€‚
// build.gradle apply(plugin = "jacoco") ä¹‹æ‰€ä»¥èƒ½è¿™æ ·æ˜¯å› ä¸º jacoco æ’ä»¶ä¼šç»™æ‰€æœ‰ Test ç±»å‹çš„ä»»åŠ¡æ·»åŠ  jacoco çš„é…ç½®ã€‚
å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è¾“å‡ºå…¶æ‰§è¡Œæ•°æ®æ–‡ä»¶è·¯å¾„ï¼š
afterEvaluate { tasks.getByName("testDebugUnitTest").apply { doLast { (this.extensions.getByName("jacoco") as JacocoTaskExtension).apply { logger.lifecycle("testDebugUnitTest dest: ${this.destinationFile?.absolutePath}") } } } } æ‰§è¡Œæƒ…å†µå¦‚ä¸‹ï¼š
testDebugUnitTest dest: /Users/hanlyjiang/Wksp/project/AndroidTestSample/app/build/outputs/unit_test_code_coverage/debugUnitTest/testDebugUnitTest.exec ä»ªå™¨å•å…ƒæµ‹è¯•ï¼ˆAndroidTestï¼‰ ä»ªå™¨å•å…ƒæµ‹è¯•è¦†ç›–ç‡æ•°æ®çš„ç»Ÿè®¡éœ€è¦æ‰“å¼€testCoverageEnabledå¼€å…³ï¼Œç„¶åä¼šæœ‰ä¸€ä¸ªcreateDebugCoverageReport çš„ä»»åŠ¡ç”Ÿæˆï¼ŒåŒæ—¶ä¹Ÿä¼šç”Ÿæˆhtmlçš„æŠ¥å‘Šã€‚
// groovy android { buildTypes { debug { testCoverageEnabled = true } } } // kotlin android { buildTypes { getByName("debug").apply { isTestCoverageEnabled = true } } } è¿æ¥è®¾å¤‡æ‰§è¡Œè¯¥ä»»åŠ¡å³å¯ç”Ÿæˆå¯¹åº”çš„æ‰§è¡Œæ•°æ®æ–‡ä»¶åŠå¯¹åº”çš„è¦†ç›–ç‡æŠ¥å‘Šã€‚
...</p></div><footer class=entry-footer><span title='2022-03-19 22:29:12 +0000 UTC'>March 19, 2022</span>&nbsp;Â·&nbsp;<span>3 min</span>&nbsp;Â·&nbsp;<span>492 words</span>&nbsp;Â·&nbsp;<span>é‡ç”Ÿè²è—•</span></footer><a class=entry-link aria-label="post link to Android Jacocoè¦†ç›–ç‡ç»Ÿè®¡é…ç½®" href=https://hanlyjiang.github.io/posts/android-jacoco-gradle-config/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>AAR Java8 æ¥å£ NoSuchMethodError é”™è¯¯è§£å†³è®°å½•</h2></header><div class=entry-content><p>é‡åˆ°ä¸€ä¸ªåˆçœ‹æ—¶éå¸¸è¯¡å¼‚çš„é—®é¢˜ï¼Œç°å·²è§£å†³ï¼Œç‰¹è®°å½•ä¸€ä¸‹è§£å†³è¿‡ç¨‹ã€‚
ğŸ™‹â€â™€ï¸ æ˜¯ä»€ä¹ˆé—®é¢˜ï¼Ÿ é”™è¯¯æ—¥å¿— APPè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¿½ç„¶æŠ¥äº†ä¸€ä¸ªè«åå…¶å¦™çš„é”™è¯¯ï¼š NoSuchMethodError, æŠ¥é”™çš„åœ°æ–¹æ˜¯ rxjava3 çš„ Disposable.disposed()
E/AndroidRuntime: FATAL EXCEPTION: main Process: com.github.hanlyjiang.sample, PID: 7357 java.lang.NoSuchMethodError: No static method disposed()Lio/reactivex/rxjava3/disposables/Disposable; in class Lio/reactivex/rxjava3/disposables/Disposable; or its super classes (declaration of 'io.reactivex.rxjava3.disposables.Disposable' appears in /data/app/~~veR3ZUFYzXjZ48FDcAW0Nw==/com.github.hanlyjiang.sample-bhuZG0wVNdVKs_mfxOh5gg==/base.apk) at com.github.hanlyjiang.lib_mod.ViewTest.disposable(ViewTest.java:8) at com.github.hanlyjiang.sample.MainActivity.lambda$onCreate$0(MainActivity.java:15) at com.github.hanlyjiang.sample.MainActivity$$ExternalSyntheticLambda0.onClick(Unknown Source:0) at android.view.View.performClick(View.java:7456) at com.google.android.material.button.MaterialButton.performClick(MaterialButton.java:1119) at android.view.View.performClickInternal(View.java:7433) at android.view.View.access$3700(View.java:836) at android.view.View$PerformClick.run(View.java:28832) at android.os.Handler.handleCallback(Handler.java:938) at android.os.Handler.dispatchMessage(Handler.java:99) at android.os.Looper.loopOnce(Looper.java:201) at android.os.Looper.loop(Looper.java:288) at android.app.ActivityThread.main(ActivityThread.java:7902) at java.lang.reflect.Method.invoke(Native Method) at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:548) at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:933) â° Tip
...</p></div><footer class=entry-footer><span title='2022-03-13 23:18:16 +0000 UTC'>March 13, 2022</span>&nbsp;Â·&nbsp;<span>3 min</span>&nbsp;Â·&nbsp;<span>594 words</span>&nbsp;Â·&nbsp;<span>é‡ç”Ÿè²è—•</span></footer><a class=entry-link aria-label="post link to  AAR Java8 æ¥å£ NoSuchMethodError é”™è¯¯è§£å†³è®°å½•" href=https://hanlyjiang.github.io/posts/aar-java8-jie-kou-nosuchmethoderror-cuo-wu-jie-jue-ji-lu/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Dagger åœ¨Androidåº“(SDK)æ¨¡å—ä¸­çš„ä½¿ç”¨å®è·µ</h2></header><div class=entry-content><p>æœ¬æ–‡ä¸»è¦æè¿°å¦‚ä½•ä½¿ç”¨Daggerè§£å†³å®é™…é¡¹ç›®ä¸­é‡åˆ°çš„é—®é¢˜ï¼Œè¿™ä¸¤ä¸ªé—®é¢˜æ˜¯ï¼š
å¦‚ä½•åœ¨åº“ï¼ˆSDKï¼‰æ¨¡å—ä¸­ä½¿ç”¨Daggerä¾èµ–æ³¨å…¥ï¼Ÿ MVPä¸­çš„Daggerä¾èµ–æ³¨å…¥å¦‚ä½•å®ç°æ— æ„Ÿæ³¨å…¥ï¼Ÿ æœ¬æ–‡ä¸ä¼šä»‹ç»å¦‚ä½•ä½¿ç”¨Daggerï¼Œåªä¸“æ³¨äºæè¿°å¦‚ä¸Šä¸¤ä¸ªé—®é¢˜çš„è§£å†³çš„å‰å› åæœåŠè§£å†³æ–¹æ¡ˆã€‚
èƒŒæ™¯ æ¥æ‰‹å¼€å‘ä¸€ä¸ªSDKï¼Œå¤§è‡´æƒ…å†µå¦‚ä¸‹ï¼š
è¯¥SDKå†…éƒ¨æœ‰è‹¥å¹²ç•Œé¢ï¼ŒåŒ…æ‹¬Activityï¼ŒFragmentç­‰ ä½¿ç”¨MVPæ¶æ„ é€æ¸å‘ç°å†…éƒ¨ä¾èµ–æ··ä¹±ï¼Œåœ¨å¾—ç©ºåï¼Œé‚å¯¹å…¶ä¾èµ–éƒ¨åˆ†è¿›è¡Œé‡æ„æ”¹é€ ã€‚
ä¸ºä»€ä¹ˆä½¿ç”¨ä¾èµ–æ³¨å…¥è¿›è¡Œæ”¹é€ ï¼Ÿ ä¸»è¦æ˜¯ä¾èµ–æ··ä¹±ï¼Œå•ä¾‹çš„æ»¥ç”¨å¯¼è‡´ä¾èµ–å…³ç³»ä¸æ˜æ˜¾ï¼Œæ— æ³•ç®¡ç†ï¼Œæ— æ³•æµ‹è¯•
æŸäº›å¯¹è±¡ï¼Œæˆ‘ä»¬åœ¨å¾ˆå¤šç±»ä¸­éƒ½éœ€è¦ä½¿ç”¨ï¼Œå¦‚ Retrofit çš„è¯·æ±‚å¯¹è±¡ï¼Œä»£è¡¨ä¿¡æ¯çš„æ ‡è¯†å­—æ®µç­‰ï¼Œæ­¤æ—¶ä¸ºäº†é¿å…é€šè¿‡æ„é€ å‡½æ•°æˆ–è€…setteræ–¹æ³•æ¥ä¼ é€’ï¼Œå°±ç›´æ¥èµ·äº†ä¸ªå•ä¾‹ï¼Œè¿˜æœ‰å¾ˆå¤šå…¶ä»–ç±»ä¼¼çš„æƒ…å†µï¼Œæœ€ç»ˆå¯¼è‡´å•ä¾‹æœ‰10å¤šä¸ªï¼Œè°ƒç”¨å•ä¾‹ getInstance çš„åœ°æ–¹æ›´æ˜¯æ•°ä¸èƒœæ•°ã€‚
å¯¼è‡´æˆ‘ä»¬è¦å¯¹å¯¹åº”çš„ä»£ç è¿›è¡Œå•å…ƒæµ‹è¯•åšmockæ“ä½œå¼‚å¸¸å›°éš¾ï¼Œ
å› ä¸ºä¾èµ–å…³ç³»å¤ªä¸æ˜æ˜¾ï¼Œå‡ ä¹å¾—ä¸€è¡Œè¡Œæ‰¾æ‰èƒ½æ‰¾åˆ°ç±»æˆ–æ–¹æ³•åˆ°åº•ä¾èµ–äº†å“ªäº›å¯¹è±¡ åŒæ—¶mockçš„è¿‡ç¨‹ä¹Ÿå˜å¾—éº»çƒ¦ï¼Œç”±äºæ²¡æœ‰ä½œä¸ºç±»æˆå‘˜ï¼Œæ‰€ä»¥æ— æ³•ç®€å•é€šè¿‡mockæ›¿æ¢ å¯¹åº”æˆå‘˜ï¼› ä¾èµ–æ³¨å…¥æ”¹é€ çš„é—®é¢˜ç‚¹ ä¸»è¦æœ‰å¦‚ä¸‹é—®é¢˜ï¼š
ä¹‹æ‰€ä»¥æç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œæ˜¯å› ä¸ºGoogle é’ˆå¯¹Androidï¼Œåœ¨Daggerçš„åŸºç¡€ä¸Šé’ˆå¯¹æ€§çš„æ„å»ºäº†ä¸€ä¸ªHilt çš„ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œèƒ½å¤Ÿå‡å°‘Androidä¸­ç›´æ¥ä½¿ç”¨Daggerçš„æ¨¡æ¿ä»£ç ã€‚ä½†æ˜¯Hiltçš„ä½¿ä¸­æœ‰è¦æ±‚ï¼š
æ‰€æœ‰ä½¿ç”¨ Hilt çš„åº”ç”¨éƒ½å¿…é¡»åŒ…å«ä¸€ä¸ªå¸¦æœ‰ @HiltAndroidApp æ³¨é‡Šçš„ Application ç±»ã€‚
å‚è€ƒï¼š ä½¿ç”¨ Hilt å®ç°ä¾èµ–é¡¹æ³¨å…¥ | Android å¼€å‘è€… | Android Developers (google.cn)
ä¹Ÿå°±æ˜¯å¿…é¡»èƒ½æ§åˆ¶ä½Applicationï¼Œå¦‚ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬ä½œä¸ºä¸€ä¸ªSDKçš„æä¾›æ–¹ï¼š
æ˜¯æ²¡æœ‰æœºä¼šä¿®æ”¹Applicationçš„ä»£ç çš„ è€Œä¸”ï¼Œæˆ‘ä»¬ä¹Ÿä¸èƒ½è¦æ±‚ä½¿ç”¨æ–¹å»åšè¿™ç§é™åˆ¶ï¼›åŒæ—¶ï¼Œå¦‚æœä½¿ç”¨æ–¹æœ‰ä½¿ç”¨ Hilt å‘¢ï¼Œæˆ‘ä»¬çš„ä»£ç æ˜¯å¦ä¼šå¯¹å…¶äº§ç”Ÿå½±å“ï¼Ÿ æ•…ï¼Œæˆ‘ä»¬åªèƒ½ç›´æ¥ä½¿ç”¨Daggerã€‚
è€Œå¦å¤–ä¸€ä¸ªé—®é¢˜åœ¨äºMVPçš„æ¶æ„é™åˆ¶ï¼ŒP å±‚éœ€è¦æŒæœ‰Vå±‚çš„å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯Pä¾èµ–Vï¼Œè€ŒVé€šå¸¸æ˜¯Activityæˆ–è€…Fragmentï¼Œè€ŒActivityåŠFragmentçš„åˆ›å»ºè¿‡ç¨‹ç”±Androidç³»ç»Ÿæ§åˆ¶ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨Daggeræ—¶æˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€äº›æ¨¡æ¿ä»£ç ï¼ˆä¸‹æ–¹ä¼šè¯´æ˜ï¼‰ï¼Œå°† ActivityåŠFragmentå¯¹è±¡æ³¨å…¥åˆ° Dagger çš„ä¾èµ–å›¾è°±ä¸­ã€‚
æ²¡æœ‰ Application çš„é—®é¢˜è§£å†³ é¦–å…ˆï¼Œæˆ‘ä»¬è¦è§£å†³çš„æ˜¯æ²¡æœ‰Applicationçš„é—®é¢˜ï¼Œé‚£ä¹ˆæ²¡æœ‰Applicationä¼šç»™æˆ‘ä»¬å¸¦æ¥å“ªäº›é—®é¢˜å‘¢ï¼Ÿ
æ— æ³•ä½¿ç”¨ Hilt æ— æ³•ç›´æ¥ä½¿ç”¨ dagger-android è¿™ä¸¤ä¸ªé—®é¢˜å®é™…ä¸Šæ˜¯ç±»ä¼¼çš„ï¼ŒHiltåŠDagger-Androidéƒ½æ˜¯ç”¨äºè§£å†³ Android ç»„ä»¶ï¼ˆActivityï¼ŒFragmentï¼ŒServiceï¼ŒBroadcastReceiver ç­‰ï¼‰çš„ä¾èµ–æ³¨å…¥çš„ã€‚ä½†æ˜¯ä»–ä»¬éƒ½è¦æ±‚æˆ‘ä»¬å¿…é¡»ä½¿ç”¨ Applicationã€‚
...</p></div><footer class=entry-footer><span title='2022-03-06 15:11:54 +0000 UTC'>March 6, 2022</span>&nbsp;Â·&nbsp;<span>8 min</span>&nbsp;Â·&nbsp;<span>1587 words</span>&nbsp;Â·&nbsp;<span>é‡ç”Ÿè²è—•</span></footer><a class=entry-link aria-label="post link to Dagger åœ¨Androidåº“(SDK)æ¨¡å—ä¸­çš„ä½¿ç”¨å®è·µ" href=https://hanlyjiang.github.io/posts/dagger-zai-android-ku-sdkmo-kuai-zhong-de-shi-yong-shi-jian/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Gradleå­¦ä¹ æŒ‡å—-å‰è¨€</h2></header><div class=entry-content><p>è¿™ä¸ªå¯¹äºå®‰å“å¼€å‘æ¥è¯´ï¼ŒGradleå¯ä»¥ä¸äº†è§£ï¼Œä½†æ˜¯åˆå¿…é¡»äº†è§£ã€‚
è¯´ä¸éœ€è¦äº†è§£ï¼Œæ˜¯å› ä¸ºï¼š é€šè¿‡AndroidStudioå»ºç«‹å·¥ç¨‹çš„æ—¶å€™ï¼Œé»˜è®¤å°±åˆ›å»ºå¥½äº†Gradleçš„é¡¹ç›®ç»“æ„åŠå¯¹åº”çš„ä»»åŠ¡ï¼Œé€šè¿‡IDEæ¥æ·»åŠ æ¨¡å—çš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥è‡ªåŠ¨çš„æ·»åŠ Gradleçš„é…ç½®ã€‚
è¯´éœ€è¦äº†è§£ï¼Œæ˜¯å› ä¸ºï¼šæœ‰æ—¶å€™ä¼šé‡åˆ°æ„å»ºé”™è¯¯ï¼Œè¿˜æœ‰æ—¶å€™éœ€è¦æ”¹ä¸€æ”¹æ„å»ºæµç¨‹çš„é»˜è®¤è¡Œä¸ºï¼Œå¦å¤–æœ‰äº›æ—¶å€™ï¼Œéœ€è¦è‡ªè¡Œæ‰©å±•ä¸€ä¸ªæ„å»ºä»»åŠ¡ã€‚
Gradleå­¦ä¹ çš„ä¸€ä¸ªéš¾ç‚¹åœ¨äºï¼Œå…¶å­¦ä¹ èµ„æ–™éå¸¸é›¶æ•£ï¼Œå°‘æœ‰æˆä½“ç³»çš„å­¦ä¹ èµ„æ–™ã€‚å½“ç„¶ï¼Œå®˜æ–¹æ–‡æ¡£æ˜¯å¾ˆæˆä½“ç³»çš„ï¼Œå®˜æ–¹æ–‡æ¡£ä¹Ÿæœ‰ä¸å¥½çš„åœ°æ–¹ï¼š
çº¯è‹±æ–‡ï¼› ç‰ˆæœ¬æ›´æ–°ä¹‹åï¼Œæ–‡æ¡£ç»“æ„æœ‰å˜åŒ–ã€‚ å®˜æ–¹æ–‡æ¡£å¯¹äºå®‰å“é¡¹ç›®çš„è¯´æ˜æ²¡æœ‰ï¼ˆå› ä¸ºandroidçš„æ’ä»¶æ˜¯googleè‡ªè¡Œæ‰©å±•çš„ï¼‰ è¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œå‰æœŸgradleçš„è„šæœ¬éƒ½æ˜¯ä½¿ç”¨groovyæ¥ç¼–å†™ï¼Œæˆ‘ä»¬è¦å†™è„šæœ¬ï¼Œéœ€è¦å»å­¦ä¹ ä¸€é—¨æ–°çš„è¯­è¨€ï¼Œè™½ç„¶è¿™ä¸ªè¯­è¨€å’Œjavaæ¯”è¾ƒæ¥è¿‘ï¼Œä½†æ˜¯ç”±äºæ²¡ä»€ä¹ˆå…¶ä»–ç”¨é€”ï¼ŒåŠ ä¸Šéœ€è¦ç¼–å†™gradleè„šæœ¬çš„åœºæ™¯ä¹Ÿä¸æ˜¯é‚£ä¹ˆå¸¸è§ï¼Œå°±ä¼šè®©è§‰å¾—æœ‰ç‚¹ä¸å€¼å¾—æŠ•å…¥ï¼Œè¿™ä¸¤ä¸ªå› ç´ ç»“åˆèµ·æ¥ï¼Œä¼šåŠé€€å¾ˆå¤šå®‰å“å¼€å‘äººå‘˜ã€‚ç°åœ¨ï¼Œgradleå¯ä»¥ä½¿ç”¨kotlinæ¥ç¼–å†™å…¶dslè„šæœ¬ï¼Œå­¦ä¹ æˆæœ¬ä¼šé™ä½å¾ˆå¤šã€‚
è§åˆ°å…¶wrapperçš„è®¾è®¡ä»¤æˆ‘å°è±¡æ·±åˆ»ï¼Œå¯¹æ¯”antåŠmavenéœ€è¦æ‰‹åŠ¨å»ä¸‹è½½ä¸€ä»½äºŒè¿›åˆ¶å‰¯æœ¬ï¼Œç„¶åé…ç½®åˆ°ç¯å¢ƒå˜é‡ä¸­ï¼Œè€Œä½ è·å–åˆ°åˆ«äººçš„gradleé¡¹ç›®ä¹‹åï¼Œç›´æ¥ä½¿ç”¨wrapperè„šæœ¬ï¼Œå°±å¯ä»¥æ‰§è¡Œgradleä»»åŠ¡ï¼Œwrapperè„šæœ¬ä¼šè‡ªåŠ¨å¸®åŠ©ä½ å»è·å–ä¸€ä»½gradleçš„äºŒè¿›åˆ¶å‰¯æœ¬ï¼Œå°±å¥½åƒä½ ç›´æ¥æ‰§è¡Œgradleçš„äºŒè¿›åˆ¶å‘½ä»¤ä¸€æ ·ã€‚
å¦å¤–gradleä¹Ÿæä¾›äº†æ–¹ä¾¿çš„æ‰©å±•æœºåˆ¶ï¼Œèƒ½å¯¹æ„å»ºæµç¨‹è¿›è¡Œå®šåˆ¶ã€‚
æ¥ä¸‹æ¥ï¼Œæˆ‘å°†ä»å®‰å“å¼€å‘çš„è§†è§’ï¼Œå¯¹Gradleçš„ä½¿ç”¨åšä¸€ä¸ªæ•´ä½“çš„ä»‹ç»ã€‚å†…å®¹ä¸Šä¼šåŒ…æ‹¬Gradleçš„ä¸€äº›åŸºç¡€æ¦‚å¿µï¼Œä¸€äº›å¸¸è§çš„Gradleä»»åŠ¡ä»‹ç»ï¼ŒAndroidçš„å¸¸è§Gradleé…ç½®ä»‹ç»ï¼ŒåŒæ—¶ä¹Ÿä¼šä»‹ç»è‡ªå®šä¹‰Gradleä»»åŠ¡åŠGradleæ’ä»¶ã€‚</p></div><footer class=entry-footer><span title='2021-10-07 22:07:09 +0000 UTC'>October 7, 2021</span>&nbsp;Â·&nbsp;<span>1 min</span>&nbsp;Â·&nbsp;<span>12 words</span>&nbsp;Â·&nbsp;<span>é‡ç”Ÿè²è—•</span></footer><a class=entry-link aria-label="post link to Gradleå­¦ä¹ æŒ‡å—-å‰è¨€" href=https://hanlyjiang.github.io/posts/gradle-xue-xi-zhi-nan-qian-yan/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>ç®€åŒ–Androidåº“ä¸Šä¼ åˆ°Mavenä»“åº“çš„gradleé…ç½®</h2></header><div class=entry-content><p>é…ç½® android ä¸Šä¼ åˆ° maven ä¸­å¿ƒä»“åº“ï¼Œå‘ç°é…ç½®çš„ä»£ç æœ‰ç‚¹å¤šï¼Œè€Œä¸”å¦‚æœæœ‰å¤šä¸ªåº“æ¨¡å—éœ€è¦ä¸Šä¼ ï¼Œåˆ™éœ€è¦å¤åˆ¶ç²˜è´´ä¸å°‘é‡å¤çš„é…ç½®ä»£ç ï¼Œäºæ˜¯ç¼–å†™äº†ä¸€ä¸ª gradle æ’ä»¶ç”¨äºç®€åŒ–æå–è¿™ä¸ªé…ç½®è¿‡ç¨‹ï¼›
æ’ä»¶ç”¨é€”åŠæ•ˆæœ æœ¬æ’ä»¶ç”¨äºç®€åŒ–Androidåº“ä¸Šä¼ åˆ°Mavenä¸­å¿ƒä»“åº“çš„é…ç½®ï¼Œé¿å…æ¯ä¸ªprojectçš„gradleä¸­éƒ½æ”¾ç½®ä¸€ä»½é‡å¤è¾ƒå¤šçš„é…ç½®ï¼›
æ’ä»¶æœ‰å¦‚ä¸‹åŠŸèƒ½ï¼š
ç®€åŒ– maven-publish æ’ä»¶çš„é…ç½®æµç¨‹ï¼› æ·»åŠ ä¸Šä¼ åˆ°Mavenä¸­å¿ƒä»“åº“çš„ publish ä»»åŠ¡ï¼› æ”¯æŒé…ç½®ä¸Šä¼ æ—¶æ˜¯å¦åŒ…å« javadoc åŠæºç ï¼› ç›´æ¥ä½¿ç”¨maven-publishæ’ä»¶çš„é…ç½®ï¼š import org.gradle.api.publish.maven.MavenPom plugins { id("com.android.library") id("signing") `maven-publish` } android { defaultConfig { versionName("1.0.0-SNAPSHOT") } } dependencies { // } tasks.register("javadoc", Javadoc::class.java) { group = "publishing" dependsOn("assemble") source = android.sourceSets["main"].java.getSourceFiles() classpath += project.files(android.bootClasspath + File.pathSeparator) if (JavaVersion.current().isJava9Compatible) { (options as StandardJavadocDocletOptions).addBooleanOption("html5", true) } android.libraryVariants.forEach { libraryVariant -> classpath += libraryVariant.javaCompileProvider.get().classpath } options.apply { encoding("UTF-8") charset("UTF-8") isFailOnError = false (this as StandardJavadocDocletOptions).apply { // addStringOption("Xdoclint:none") links?.add("https://developer.android.google.cn/reference/") links?.add("http://docs.oracle.com/javase/8/docs/api/") } } } tasks.register("jarSource", Jar::class.java) { group = "publishing" from(android.sourceSets["main"].java.srcDirs) archiveClassifier.set("sources") } tasks.register("jarJavadoc", Jar::class.java) { group = "publishing" dependsOn("javadoc") val javadoc: Javadoc = tasks.getByName("javadoc") as Javadoc from(javadoc.destinationDir) archiveClassifier.set("javadoc") } fun getMyPom(): Action&lt;in MavenPom> { return Action&lt;MavenPom> { name.set("Android Common Utils Lib") description.set("Android Common Utils Library For HJ") url.set("https://github.com/hanlyjiang/lib_common_utils") licenses { license { name.set("The Apache License, Version 2.0") url.set("http://www.apache.org/licenses/LICENSE-2.0.txt") } } developers { developer { id.set("hanlyjiang") name.set("Hanly Jiang") email.set("hanlyjiang@outlook.com") } } scm { connection.set("scm:git:git://github.com/hanlyjiang/lib_common_utils.git") developerConnection.set("scm:git:ssh://github.com/hanlyjiang/lib_common_utils.git") url.set("https://github.com/hanlyjiang/lib_common_utils") } } } afterEvaluate { publishing { publications { create&lt;MavenPublication>("release") { from(components.getByName("release")) groupId = "com.github.hanlyjiang" artifactId = "android_common_utils" version = android.defaultConfig.versionName pom(getMyPom()) // æ·»åŠ javadoc artifact(tasks.getByName("jarJavadoc") as Jar) // æ·»åŠ source artifact(tasks.getByName("jarSource") as Jar) } } repositories { val ossrhCredentials = Action&lt;PasswordCredentials> { username = properties["ossrhUsername"].toString() password = properties["ossrhPassword"].toString() } // sonarçš„ä»“åº“ï¼Œåœ°å€æ ¹æ®é¡¹ç›®çš„ç‰ˆæœ¬å·æ¥ç¡®å®šæ˜¯snapshotè¿˜æ˜¯æ­£å¼ä»“åº“ maven { name = "Sonartype" val releasesRepoUrl = uri("https://oss.sonatype.org/service/local/staging/deploy/maven2") val snapshotsRepoUrl = uri("https://oss.sonatype.org/content/repositories/snapshots/") url = if (android.defaultConfig.versionName.toString().endsWith("SNAPSHOT")) snapshotsRepoUrl else releasesRepoUrl credentials(ossrhCredentials) // snapshotçš„åœ°å€ï¼š // https://oss.sonatype.org/content/repositories/snapshots/com/github/hanlyjiang/android_common_utils/ } // é¡¹ç›®æœ¬åœ°çš„ä»“åº“ maven { name = "ProjectLocal" val releasesRepoUrl = uri(layout.buildDirectory.dir("repos/releases")) val snapshotsRepoUrl = uri(layout.buildDirectory.dir("repos/snapshots")) url = if (android.defaultConfig.versionName.toString().endsWith("SNAPSHOT")) snapshotsRepoUrl else releasesRepoUrl } } } signing { sign(publishing.publications.getByName("release")) } } ä½¿ç”¨AndroidMavenPubPluginç®€åŒ–åçš„é…ç½®ï¼š import org.gradle.api.publish.maven.MavenPom plugins { id("com.android.library") id("signing") `maven-publish` // å¼•å…¥æˆ‘ä»¬æœ¬åœ°ä»“åº“ä¸­çš„gradleæ’ä»¶ id("com.github.hanlyjiang.android_maven_pub") version ("0.0.5") apply (false) } android { defaultConfig { versionName("1.0.1-SNAPSHOT") } } dependencies { // } apply(plugin = "com.github.hanlyjiang.android_maven_pub") configure&lt;io.hanlyjiang.gradle.android.AndroidMavenPubPluginExtension> { groupId.set("com.github.hanlyjiang") artifactId.set("android-common-utils") projectLocalRepoPath.set("local-maven-repo") mavenPomAction.set(Action&lt;MavenPom> { name.set("Android Common Utils Lib") description.set("Android Common Utils Library For HJ") url.set("https://github.com/hanlyjiang/lib_common_utils") properties.set( mapOf( "myProp" to "value", "prop.with.dots" to "anotherValue" ) ) licenses { license { name.set("The Apache License, Version 2.0") url.set("http://www.apache.org/licenses/LICENSE-2.0.txt") } } developers { developer { id.set("hanlyjiang") name.set("Hanly Jiang") email.set("hanlyjiang@outlook.com") } } scm { connection.set("scm:git:git://github.com/hanlyjiang/lib_common_utils.git") developerConnection.set("scm:git:ssh://github.com/hanlyjiang/lib_common_utils.git") url.set("https://github.com/hanlyjiang/lib_common_utils") } }) } ä½¿ç”¨æ­¥éª¤ å¼•å…¥æ’ä»¶ åœ¨éœ€è¦ä½¿ç”¨çš„æ¨¡å—çš„buildè„šæœ¬ä¸­ï¼Œå¼•å…¥æˆ‘ä»¬çš„æ’ä»¶ï¼ŒåŒæ—¶å¼•å…¥ maven-publish æ’ä»¶å’Œ signing æ’ä»¶ã€‚
...</p></div><footer class=entry-footer><span title='2021-06-01 10:26:00 +0000 UTC'>June 1, 2021</span>&nbsp;Â·&nbsp;<span>5 min</span>&nbsp;Â·&nbsp;<span>884 words</span>&nbsp;Â·&nbsp;<span>é‡ç”Ÿè²è—•</span></footer><a class=entry-link aria-label="post link to ç®€åŒ–Androidåº“ä¸Šä¼ åˆ°Mavenä»“åº“çš„gradleé…ç½®" href=https://hanlyjiang.github.io/posts/jian-hua-android-ku-shang-chuan-dao-maven-cang-ku-de-gradle-pei-zhi/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Android bindServiceæµç¨‹</h2></header><div class=entry-content><p>æœ¬æ–‡åˆ†æbindServiceçš„æµç¨‹ï¼Œé¦–å…ˆæˆ‘ä»¬é€šè¿‡é˜…è¯»æºç è·å–ä¸€ä¸ªä¸»çº¿çš„è°ƒç”¨åœ°å›¾ï¼Œç„¶åæå‡ºè‹¥å¹²é—®é¢˜ï¼ŒåŒ…æ‹¬ï¼šAPPè¿›ç¨‹ä¸­å¦‚ä½•è·å–AMSï¼ŒAMSå¦‚ä½•å¯åŠ¨APP-serviceçš„è¿›ç¨‹ï¼ŒAMSä¸­å¦‚ä½•è·å–ApplicationThreadå¹¶ä¸ä¹‹é€šè®¯ï¼ŒServiceçš„å¯åŠ¨åŠç»‘å®šæµç¨‹ï¼›ç„¶åå†é€šè¿‡æºç ä¸€ä¸€è§£ç­”ã€‚æœ€åå†æ•´ä½“æ€»ç»“æ¢³ç†ä¸€ä¸‹æ•´ä½“æµç¨‹ï¼›
é¢„å…ˆçŸ¥è¯†ï¼š
Binderé€šä¿¡æœºåˆ¶ æ•´ä½“åˆ†æä¸æ€»ç»“ ä¸»çº¿åœ°å›¾ä¸é—®é¢˜æå‡º æˆ‘ä»¬ä»bindServiceä¸€è·¯è·Ÿè¸ªï¼Œåˆæ­¥ç»˜åˆ¶äº†å¦‚ä¸‹çš„è°ƒç”¨åºåˆ—å›¾ï¼Œæˆ‘ä»¬å¯ä»¥ä»¥ä¸‹é¢çš„å›¾ä½œä¸ºä¸€ä¸ªä¸»çº¿åœ°å›¾ï¼Œé¿å…èµ°å¤±ï¼Œç„¶åæ ¹æ®å…·ä½“é—®é¢˜è¿›è¡Œç»†èŠ‚åˆ†æã€‚
ä»ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬æå‡ºå¦‚ä¸‹é—®é¢˜ï¼š
bindServiceCommonåˆ°IActivityManagerçš„è°ƒç”¨ä¸­ï¼Œæ˜¯å¦‚ä½•è·å–åˆ°ActivityManagerServiceçš„ï¼Ÿ AMSä¸­å¦‚ä½•è·å–ApplicationThreadå¹¶ä¸ä¹‹é€šè®¯ï¼Ÿ ApplicatoinThreadçš„ç”¨é€”ï¼ŸApplicationThreadè¿è¡Œçš„è¿›ç¨‹æ˜¯å“ªä¸ªï¼Ÿ è¿›ç¨‹å¦‚ä½•å¯åŠ¨-å³AMSå¦‚ä½•åˆ›å»ºAPP:serverè¿›ç¨‹ï¼Ÿ Serviceå¦‚ä½•å¯åŠ¨ï¼Ÿ Serviceå¦‚ä½•ç»‘å®šï¼Ÿ ServiceConnection çš„å›è°ƒæ–¹æ³•ä½•æ—¶ä½¿ç”¨ï¼Ÿ é—®é¢˜è§£ç­”æ±‡æ€» æˆ‘ä»¬å°†ç›¸å…³é—®é¢˜çš„ç»“è®ºæå‰åˆ°æ­¤å°èŠ‚ï¼Œä¾¿äºåç»­ä»æ¯”è¾ƒæŠ½è±¡çš„å±‚æ¬¡ä¸Šæ¥è¿›è¡Œå¤ä¹ åŠé¢„è§ˆï¼›
APPè¿›ç¨‹å¦‚ä½•è·å–AMSï¼Ÿ APPè¿›ç¨‹ä¸­é€šè¿‡ ServiceManager.getService(Context.ACTIVITY_SERVICE) è·å–çš„ActivityManagerServiceçš„å®¢æˆ·ç«¯æ“ä½œä»£ç†å¯¹è±¡ï¼ˆProxyï¼‰ã€‚
è¯¥å¯¹è±¡ä½äºAPPè¿›ç¨‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ­¤å¯¹è±¡ï¼ˆé€šè¿‡Binderè¿›ç¨‹é—´é€šä¿¡ï¼‰æ¥è¦æ±‚ï¼ˆä½äºsystem_processä¸­ï¼‰çš„ActivityManagerServiceè¿›è¡Œå¯¹åº”çš„æœåŠ¡æ“ä½œï¼›
AMSå¦‚ä½•è·å–ApplicationThreadï¼Ÿ APPè¿›ç¨‹åœ¨binderSericeæ—¶ï¼Œå°†è‡ªå·±è¿›ç¨‹ä¸­çš„ApplicationThreadå–å‡ºï¼Œé€šè¿‡Binderæœºåˆ¶ä¼ é€’ç»™AMSè¿›ç¨‹ï¼Œä¼ é€’è¿‡ç¨‹ä¸­ä¼šè½¬æ¢æˆä¸€ä¸ªProxyå¯¹è±¡ï¼›
ActivityManager.getService().bindIsolatedService( mMainThread.getApplicationThread(), getActivityToken(), service, service.resolveTypeIfNeeded(getContentResolver()), sd, flags, instanceName, getOpPackageName(), user.getIdentifier()); æœåŠ¡å¦‚ä½•ç»‘å®šï¼ŸæœåŠ¡å¦‚ä½•å¯åŠ¨ï¼Ÿè¿›ç¨‹å¦‚ä½•å¯åŠ¨ï¼Ÿ è¿›ç¨‹å¯åŠ¨ï¼š åœ¨ç‹¬ç«‹çš„è¿›ç¨‹ä¸­è¿è¡Œçš„æœåŠ¡éœ€è¦å…ˆå°†è¿›ç¨‹å¯åŠ¨ï¼Œè¿›ç¨‹çš„å¯åŠ¨æ˜¯é€šè¿‡APPè¿›ç¨‹ï¼Œè¯·æ±‚ç³»ç»Ÿè¿›ç¨‹ä¸­çš„AMSæ¥æ‰§è¡Œï¼Œé€šè¿‡AMSçš„startProcessLockedæ–¹æ³•å¯åŠ¨è¿›ç¨‹ï¼Œæœ€ç»ˆä¼šé€šè¿‡socketæ¥å£è¯·æ±‚zygoteè¿›ç¨‹æ¥å¯åŠ¨è¿›ç¨‹ã€‚ åœ¨å¯åŠ¨æ—¶ä¼šæŒ‡å®šjavaçš„å…¥å£ç‚¹ä¸ºActivityThreadï¼Œå³è¿›ç¨‹å¯åŠ¨åä¼šè¿è¡ŒActivityThreadçš„mainæ–¹æ³•ï¼› AMSä¸­ä¼šè®°å½•å¯åŠ¨çš„è¿›ç¨‹è®°å½•ï¼ˆProcessRecordï¼‰ï¼Œå¯¹åº”çš„ProcessRecordä¸­ä¼šè®°å½•è¿›ç¨‹å¯¹åº”çš„ApplicationThreadï¼› æœåŠ¡å¯åŠ¨ï¼š æœåŠ¡çš„å¯åŠ¨éœ€è¦è¯·æ±‚AMSæ¥å®Œæˆ å¯åŠ¨æ—¶éœ€è¦å…ˆé€šè¿‡PIDè·å–è¦å¯åŠ¨åˆ°çš„ProcessRecordï¼Œé€šè¿‡ProcessRecordä¸­è®°å½•çš„ApplicationThreadæ¥ä¸å¯¹åº”çš„è¿›ç¨‹é€šä¿¡ã€‚ AMSé€šè¿‡ApplicationThreadæ¥é€šçŸ¥å¯¹åº”çš„è¿›ç¨‹åˆ›å»ºæœåŠ¡ï¼ŒApplicationThreadä½œä¸ºé€šä¿¡çš„æ¥å£ï¼Œå®é™…ä¸Šæœ€ç»ˆä¼šé€šè¿‡ActivityThreadçš„handleCreateServiceæ¥åˆ›å»ºæœåŠ¡çš„å®ä¾‹ï¼› æœåŠ¡åˆ›å»ºæ—¶ï¼Œæ˜¯åœ¨APPè¿›ç¨‹ï¼ˆå¯èƒ½æ˜¯ç‹¬ç«‹çš„è¿›ç¨‹ï¼‰ä¸­è¿›è¡Œçš„ï¼Œéœ€è¦é€šè¿‡ç±»åŠ è½½å™¨åŠ è½½å¯¹åº”çš„Serviceçš„ç±»ï¼ŒåŒæ—¶æ„é€ ç›¸åº”çš„ä¸Šä¸‹æ–‡åŠèµ„æºå¯¹è±¡ç­‰ï¼Œç„¶åæ„é€ å¯¹åº”çš„å®ä¾‹ï¼› æœåŠ¡åˆ›å»ºæˆåŠŸåï¼Œä¼šè®°å½•åˆ°ActivityThreadçš„ä¸€ä¸ªServiceåˆ—è¡¨ä¸­ï¼Œä»¥ä¾¿åç»­ç®¡ç†ï¼› æœåŠ¡ç»‘å®šï¼š æœåŠ¡ç»‘å®šå…ˆåœ¨APPè¿›ç¨‹ä¸­ï¼Œé€šè¿‡AMSä»£ç†å¯¹è±¡å‘èµ·è¯·æ±‚ï¼Œç”±AMSæ¥å®‰æ’bindï¼ˆActivityManagerService.bindIsolatedServiceï¼‰; ç„¶åå…·ä½“çš„ç»‘å®šåŠ¨ä½œè¿˜æ˜¯é€šè¿‡IApplicationThreadå®‰æ’åˆ°APPçš„Serviceè¿›ç¨‹ä¸­ï¼Œæœ€ç»ˆæ‰§è¡Œçš„ActivityThread#handleBindService; åœ¨APPè¿›ç¨‹ä¸­ï¼Œä¼šå°†Serviceå–å‡ºï¼Œç„¶åè°ƒç”¨å…¶onBindæ–¹æ³•æ¥è·å–IBinderè¿œç¨‹æ“ä½œå¯¹è±¡ï¼› ä¹‹åå†é€šè¿‡AMSè°ƒç”¨ ActivityManagerService#publishService æ¥é€šçŸ¥ç»‘å®šæˆåŠŸçš„é€šçŸ¥åˆ°å¯¹åº”çš„éœ€è¦ç»‘å®šæœåŠ¡çš„APPè¿›ç¨‹ï¼› publishServiceä¸­ä¼šè°ƒç”¨ServiceConnectionçš„onServiceConnectedæ–¹æ³•é€šçŸ¥æœåŠ¡è¿æ¥äº†ï¼› æ•´ä½“æµç¨‹æ€»ç»“ å¾…è¡¥å……
è¯¦ç»†åˆ†æè§£ç­”é—®é¢˜ APPè¿›ç¨‹ä¸­å¦‚ä½•è·å–AMSï¼Ÿ è¯´æ˜ï¼š
ç¬¬ä¸€æ¬¡å…ˆé€é¡¹æŸ¥çœ‹å„ä¸ªå°èŠ‚ï¼Œæœ€åå†çœ‹æ­¤å¤„çš„æ€»ç»“ï¼›
åç»­ç›´æ¥æŸ¥çœ‹æ€»ç»“æ¥å¿«é€Ÿè·å–ç»“è®ºï¼›
==æ€»ç»“ï¼š==
...</p></div><footer class=entry-footer><span title='2021-04-12 10:18:50 +0000 UTC'>April 12, 2021</span>&nbsp;Â·&nbsp;<span>22 min</span>&nbsp;Â·&nbsp;<span>4643 words</span>&nbsp;Â·&nbsp;<span>é‡ç”Ÿè²è—•</span></footer><a class=entry-link aria-label="post link to Android bindServiceæµç¨‹" href=https://hanlyjiang.github.io/posts/androidbindservice-liu-cheng-fen-xi/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>æ­å»ºAndroidæºç å·¥ä½œç¯å¢ƒ</h2></header><div class=entry-content><p>ç®€å•ä»‹ç»ç³»ç»Ÿæ¶æ„ã€ç¼–è¯‘ç¯å¢ƒçš„æ­å»º ç®€å•ä»‹ç»åˆ©ç”¨ AndroidStudio è°ƒè¯• system_process è¿›ç¨‹çš„æ–¹æ³•åŠç¼–è¯‘æ›´æ–°éƒ¨åˆ†ç³»ç»Ÿæ¨¡å—çš„æ–¹å¼ Androidç³»ç»Ÿæ¶æ„ Android ç³»ç»Ÿæ¶æ„å¦‚ä¸‹ä¸¤å›¾æ‰€ç¤ºï¼š
åº”ç”¨æ¡†æ¶ã€‚åº”ç”¨æ¡†æ¶æœ€å¸¸è¢«åº”ç”¨å¼€å‘è€…ä½¿ç”¨ã€‚å¾ˆå¤šæ­¤ç±» API éƒ½å¯ä»¥ç›´æ¥æ˜ å°„åˆ°åº•å±‚ HAL æ¥å£ï¼Œå¹¶å¯æä¾›ä¸å®ç°é©±åŠ¨ç¨‹åºç›¸å…³çš„å®ç”¨ä¿¡æ¯ã€‚ Binder IPCã€‚Binder è¿›ç¨‹é—´é€šä¿¡ (IPC) æœºåˆ¶å…è®¸åº”ç”¨æ¡†æ¶è·¨è¶Šè¿›ç¨‹è¾¹ç•Œå¹¶è°ƒç”¨ Android ç³»ç»ŸæœåŠ¡ä»£ç ï¼Œè¿™ä½¿å¾—é«˜çº§æ¡†æ¶ API èƒ½ä¸ Android ç³»ç»ŸæœåŠ¡è¿›è¡Œäº¤äº’ã€‚åœ¨åº”ç”¨æ¡†æ¶çº§åˆ«ï¼Œå¼€å‘è€…æ— æ³•çœ‹åˆ°æ­¤ç±»é€šä¿¡çš„è¿‡ç¨‹ï¼Œä½†ä¸€åˆ‡ä¼¼ä¹éƒ½åœ¨â€œæŒ‰éƒ¨å°±ç­åœ°è¿è¡Œâ€ã€‚ ç³»ç»ŸæœåŠ¡ã€‚ç³»ç»ŸæœåŠ¡æ˜¯ä¸“æ³¨äºç‰¹å®šåŠŸèƒ½çš„æ¨¡å—åŒ–ç»„ä»¶ï¼Œä¾‹å¦‚çª—å£ç®¡ç†å™¨ã€æœç´¢æœåŠ¡æˆ–é€šçŸ¥ç®¡ç†å™¨ã€‚åº”ç”¨æ¡†æ¶ API æ‰€æä¾›çš„åŠŸèƒ½å¯ä¸ç³»ç»ŸæœåŠ¡é€šä¿¡ï¼Œä»¥è®¿é—®åº•å±‚ç¡¬ä»¶ã€‚Android åŒ…å«ä¸¤ç»„æœåŠ¡ï¼šâ€œç³»ç»Ÿâ€ï¼ˆè¯¸å¦‚çª—å£ç®¡ç†å™¨å’Œé€šçŸ¥ç®¡ç†å™¨ä¹‹ç±»çš„æœåŠ¡ï¼‰å’Œâ€œåª’ä½“â€ï¼ˆä¸æ’­æ”¾å’Œå½•åˆ¶åª’ä½“ç›¸å…³çš„æœåŠ¡ï¼‰ã€‚ ç¡¬ä»¶æŠ½è±¡å±‚ (HAL)ã€‚HAL å¯å®šä¹‰ä¸€ä¸ªæ ‡å‡†æ¥å£ä»¥ä¾›ç¡¬ä»¶ä¾›åº”å•†å®ç°ï¼Œè¿™å¯è®© Android å¿½ç•¥è¾ƒä½çº§åˆ«çš„é©±åŠ¨ç¨‹åºå®ç°ã€‚å€ŸåŠ© HALï¼Œç¡¬ä»¶å¼€å‘è€…å¯ä»¥é¡ºåˆ©å®ç°ç›¸å…³åŠŸèƒ½ï¼Œè€Œä¸ä¼šå½±å“æˆ–æ›´æ”¹æ›´é«˜çº§åˆ«çš„ç³»ç»Ÿã€‚HAL å®ç°ä¼šè¢«å°è£…æˆæ¨¡å—ï¼Œå¹¶ä¼šç”± Android ç³»ç»Ÿé€‚æ—¶åœ°åŠ è½½ã€‚å¦‚éœ€äº†è§£è¯¦æƒ…ï¼Œè¯·å‚é˜…ç¡¬ä»¶æŠ½è±¡å±‚ (HAL)ã€‚ Linux å†…æ ¸ã€‚å¼€å‘è®¾å¤‡é©±åŠ¨ç¨‹åºä¸å¼€å‘å…¸å‹çš„ Linux è®¾å¤‡é©±åŠ¨ç¨‹åºç±»ä¼¼ã€‚Android ä½¿ç”¨çš„ Linux å†…æ ¸ç‰ˆæœ¬åŒ…å«ä¸€äº›ç‰¹æ®Šçš„è¡¥å……åŠŸèƒ½ï¼Œä¾‹å¦‚ä½å†…å­˜ç»ˆæ­¢å®ˆæŠ¤è¿›ç¨‹ï¼ˆä¸€ä¸ªå†…å­˜ç®¡ç†ç³»ç»Ÿï¼Œå¯æ›´ä¸»åŠ¨åœ°ä¿ç•™å†…å­˜ï¼‰ã€å”¤é†’é”å®šï¼ˆä¸€ç§ PowerManager ç³»ç»ŸæœåŠ¡ï¼‰ã€Binder IPC é©±åŠ¨ç¨‹åºï¼Œä»¥åŠå¯¹ç§»åŠ¨åµŒå…¥å¼å¹³å°æ¥è¯´éå¸¸é‡è¦çš„å…¶ä»–åŠŸèƒ½ã€‚è¿™äº›è¡¥å……åŠŸèƒ½ä¸»è¦ç”¨äºå¢å¼ºç³»ç»ŸåŠŸèƒ½ï¼Œä¸ä¼šå½±å“é©±åŠ¨ç¨‹åºå¼€å‘ã€‚å¯ä»¥ä½¿ç”¨ä»»æ„ç‰ˆæœ¬çš„å†…æ ¸ï¼Œåªè¦å®ƒæ”¯æŒæ‰€éœ€åŠŸèƒ½ï¼ˆå¦‚ Binder é©±åŠ¨ç¨‹åºï¼‰å³å¯ã€‚ä¸è¿‡å»ºè®®ä½¿ç”¨ Android å†…æ ¸çš„æœ€æ–°ç‰ˆæœ¬ã€‚å¦‚éœ€äº†è§£è¯¦æƒ…ï¼Œè¯·å‚é˜…æ„å»ºå†…æ ¸ä¸€æ–‡ã€‚ ä»¥ä¸Šéƒ¨åˆ†å†…å®¹æ¥æºï¼š https://source.android.google.cn/devices/architecture?hl=zh-cn
æ­å»ºå¼€å‘ç¯å¢ƒå¹¶ç¼–è¯‘æºç  æœ¬èŠ‚å°†è®¨è®º Android 11 æºç ä¸‹è½½å’Œç¼–è¯‘çš„æ–¹æ³•ã€AndroidStudioå¼€å‘ç¯å¢ƒçš„æ­å»ºæ–¹æ³•ï¼ŒåŠ system_process è¿›ç¨‹çš„è°ƒè¯•æ–¹æ³•ç­‰ç›¸å…³çŸ¥è¯†ã€‚
é€‰æ‹©åˆ†æ”¯ å¯å‚è€ƒ source.android.google.cn çš„æ–‡æ¡£ ä»£å·ã€æ ‡è®°å’Œ Build å· ï¼Œå¯ä»¥çœ‹åˆ°å½“å‰æœ€æ–°çš„ç‰ˆæœ¬åŠæ ‡è®°å¦‚ä¸‹ï¼š
...</p></div><footer class=entry-footer><span title='2021-04-08 10:18:50 +0000 UTC'>April 8, 2021</span>&nbsp;Â·&nbsp;<span>6 min</span>&nbsp;Â·&nbsp;<span>1134 words</span>&nbsp;Â·&nbsp;<span>é‡ç”Ÿè²è—•</span></footer><a class=entry-link aria-label="post link to æ­å»ºAndroidæºç å·¥ä½œç¯å¢ƒ" href=https://hanlyjiang.github.io/posts/%E6%90%AD%E5%BB%BAandroid%E6%BA%90%E7%A0%81%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>[è¯‘]Androidå¼€å‘æ‰€éœ€è¦çš„çŸ©é˜µçŸ¥è¯†</h2></header><div class=entry-content><p>ç¿»è¯‘å›½å¤–æ–‡ç« ï¼Œè¯¥æ–‡ç« ä»‹ç»äº†Androidå¼€å‘ä¸­çŸ©é˜µç›¸å…³çš„æ•°å­¦çŸ¥è¯†ï¼ŒåŒ…æ‹¬çŸ©é˜µæ˜¯ä»€ä¹ˆï¼ŸçŸ©é˜µåŠ æ³•åŠä¹˜æ³•è¿ç®—ï¼Œ2x2çŸ©é˜µçš„å˜æ¢ï¼Œæœ€åæ¼”è¿›ä¸ºAndroidä¸­ä½¿ç”¨çš„3x3çŸ©é˜µã€‚æ–‡ä¸­å›¾ç‰‡åŠåŠ¨å›¾æ¯”è¾ƒå¤šï¼Œç›¸å¯¹å¥½æ‡‚ã€‚
åŸæ–‡é“¾æ¥ï¼šhttps://i-rant.arnaudbos.com/matrices-for-developers/#technical-challenge
å‡ å‘¨å‰ï¼Œæˆ‘åœ¨ä¸€ä¸ªandroid-user-groupé¢‘é“ä¸Šï¼Œæœ‰äººé—®ä¸€ä¸ªå…³äºAndroidçš„Matrix.postScaleï¼ˆsxï¼Œsyï¼Œpxï¼Œpyï¼‰æ–¹æ³•åŠå…¶å·¥ä½œåŸç†çš„é—®é¢˜ï¼Œå› ä¸ºå®ƒâ€œéš¾ä»¥æŒæ¡â€ã€‚
åœ¨2016å¹´åˆï¼Œæˆ‘åœ¨ä¸€ä¸ªAndroidåº”ç”¨ç¨‹åºä¸Šå®Œæˆäº†ä¸€ä¸ªè‡ªç”±é¡¹ç›®ï¼Œåœ¨å…¶ä¸­æˆ‘å¿…é¡»å®ç°ä¸€ä¸ªä»¤äººå…´å¥‹çš„åŠŸèƒ½ï¼š
ç”¨æˆ·åœ¨è´­ä¹°å¹¶ä¸‹è½½äº†å²©å£çš„æ•°å­—åœ°å½¢åï¼Œå¿…é¡»èƒ½å¤ŸæŸ¥çœ‹ç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆçš„å²©å£ï¼š
æ‚¬å´–çš„ç…§ç‰‡ï¼Œ åŒ…å«çˆ¬å¡è·¯çº¿å åŠ å±‚çš„SVGæ–‡ä»¶ã€‚ ç”¨æˆ·å¿…é¡»å…·æœ‰éšæ„å¹³ç§»å’Œç¼©æ”¾çš„èƒ½åŠ›ï¼Œå¹¶ä¸”å¿…é¡»å…·æœ‰â€œè·Ÿéšâ€å›¾ç‰‡çš„è·¯çº¿å±‚ã€‚
APPæˆªå›¾1 APPæˆªå›¾2 APPæˆªå›¾3 æŠ€æœ¯æŒ‘æˆ˜ ä¸ºäº†è®©æ”€çˆ¬è·¯çº¿çš„å›¾å±‚èƒ½å¤Ÿè·Ÿéšç”¨æˆ·çš„æ‰‹åŠ¿æ“ä½œï¼Œæˆ‘å‘ç°æˆ‘ä¸å¾—ä¸é‡è½½Android ImageViewï¼Œåœ¨Canvasä¸Šç»˜åˆ¶å¹¶å¤„ç†æ‰‹æŒ‡æ‰‹åŠ¿ã€‚ ä½œä¸ºä¸€åä¼˜ç§€çš„å·¥ç¨‹å¸ˆï¼šæˆ‘æœç´¢äº†Stack OverflowğŸ˜… æˆ‘å‘ç°éœ€è¦android.graphics.Matrixç±»è¿›è¡Œ2Dè½¬æ¢ã€‚
è¿™ä¸ªç±»çš„é—®é¢˜åœ¨äºï¼Œä»æ–¹æ³•åç§°æ¥è¯´ï¼Œä½ èƒ½å¾ˆæ¸…æ¥šçš„äº†è§£å®ƒçš„ä½œç”¨ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰æ²¡æœ‰ä¸€å®šçš„æ•°å­¦èƒŒæ™¯çŸ¥è¯†ï¼Œä½ å¾ˆéš¾äº†è§£å®ƒèƒŒåæ˜¯æ€ä¹ˆå®ç°çš„ï¼Œæ¯”æ–¹è¯´ä¸‹é¢æ˜¯matrixçš„æŸä¸ªæ–¹æ³•çš„APIæ–‡æ¡£è¯´æ˜ï¼š
boolean postScale (float sx, float sy, float px, float py)
Postconcats the matrix with the specified scale. Mâ€™ = S(sx, sy, px, py) * M
ä»æ–‡æ¡£çœ‹èµ·å®ƒå¯ä»¥é€šè¿‡æŸäº›å‚æ•°ç¼©æ”¾æŸäº›ä¸œè¥¿ï¼Œå¹¶é€šè¿‡æŸç§ä¹˜æ³•æ¥å®Œæˆå®ƒã€‚ä¸è¿‡æˆ‘è¿˜æ˜¯æœ‰å¾ˆå¤šç–‘é—®ï¼š
å®ƒåˆ°åº•æ˜¯åšä»€ä¹ˆçš„ï¼Ÿ ç¼©æ”¾çŸ©é˜µï¼Ÿ é‚£æ˜¯ä»€ä¹ˆæ„æ€ï¼Œæˆ‘æƒ³ç¼©æ”¾ç”»å¸ƒâ€¦ æˆ‘åº”è¯¥ä½¿ç”¨preScaleè¿˜æ˜¯postScaleï¼Ÿ å½“æˆ‘ä»ä»æ‰‹åŠ¿æ£€æµ‹ä»£ç è·å–è¾“å…¥å‚æ•°ï¼Œç„¶åè¿›å…¥å°è¯•å’Œé”™è¯¯çš„æ— é™å¾ªç¯æ—¶ï¼Œæ˜¯å¦éœ€è¦å°è¯•åŒæ—¶ä½¿ç”¨è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Ÿ å› æ­¤ï¼Œåœ¨å¼€å‘è¿‡ç¨‹çš„è¿™ä¸€åˆ»ï¼Œæˆ‘æ„è¯†åˆ°åœ¨å®Œæˆå¤§å­¦çš„å¤´ä¸¤å¹´åï¼Œæˆ‘éœ€è¦é‡æ–°å­¦ä¹ å¾ˆå¤šå¹´å‰å…³äºçŸ©é˜µçš„åŸºæœ¬æ•°å­¦æŠ€èƒ½ã€‚
åœ¨æœå¯»ç½‘ç»œèµ„æ–™æ—¶ï¼Œæˆ‘å‘ç°äº†å¾ˆå¤šä¸é”™çš„èµ„æºï¼Œå¹¶ä¸”èƒ½å¤Ÿå†æ¬¡å­¦ä¹ ä¸€äº›æ•°å­¦çŸ¥è¯†ã€‚ é€šè¿‡å°†æˆ‘çš„ç†è§£åº”ç”¨åˆ°Javaå’ŒAndroidä¸­çš„ä»£ç ï¼Œå®ƒè¿˜å¸®åŠ©æˆ‘è§£å†³äº†2Dè½¬æ¢é—®é¢˜ã€‚ å› æ­¤ï¼Œè€ƒè™‘åˆ°æˆ‘åœ¨ä¸Šé¢æåˆ°çš„é¢‘é“ä¸Šè¿›è¡Œçš„è®¨è®ºï¼Œä¼¼ä¹æˆ‘ä¸æ˜¯å”¯ä¸€ä¸€ä¸ªåœ¨çŸ©é˜µä¸­è‹¦è‹¦æŒ£æ‰çš„äººï¼Œè¯•å›¾å¼„æ˜ç™½è¿™ä¸€ç‚¹ï¼Œå¹¶åœ¨Androidçš„Matrixç±»å’Œæ–¹æ³•ä¸­ä½¿ç”¨è¿™äº›æŠ€èƒ½ï¼Œæ‰€ä»¥æˆ‘æƒ³æˆ‘ä¼šå†™ä¸€ç¯‡æ–‡ç« ï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯å…³äºçŸ©é˜µçš„ï¼Œç¬¬äºŒéƒ¨åˆ†â€œä½¿ç”¨Androidå’ŒJavaè¿›è¡Œ2Dè½¬æ¢â€æ˜¯å…³äºå¦‚ä½•åœ¨Javaå’ŒAndroidä¸Šå°†å…³äºçŸ©é˜µçš„çŸ¥è¯†åº”ç”¨åˆ°ä»£ç ä¸­ã€‚
Matrixæ˜¯ä»€ä¹ˆï¼Ÿ æˆ‘åœ¨å¯æ±—å­¦é™¢ï¼ˆKhan Academyï¼‰ä¸Šå‘ç°ä¸€é—¨å…³äºçŸ©é˜µçš„å¾ˆå¥½çš„ä»£æ•°è¯¾ç¨‹ã€‚
...</p></div><footer class=entry-footer><span title='2021-02-08 10:38:22 +0000 UTC'>February 8, 2021</span>&nbsp;Â·&nbsp;<span>23 min</span>&nbsp;Â·&nbsp;<span>4790 words</span>&nbsp;Â·&nbsp;<span>é‡ç”Ÿè²è—•</span></footer><a class=entry-link aria-label="post link to [è¯‘]Androidå¼€å‘æ‰€éœ€è¦çš„çŸ©é˜µçŸ¥è¯†" href=https://hanlyjiang.github.io/posts/android%E5%BC%80%E5%8F%91%E6%89%80%E9%9C%80%E8%A6%81%E7%9A%84%E7%9F%A9%E9%98%B5%E7%9F%A5%E8%AF%86/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>ç¼–å†™ä¸€ä¸ªAndroid Gradleæ’ä»¶</h2></header><div class=entry-content><p>gradleæœ‰ä¸‰ç§ç¼–å†™æ’ä»¶çš„æ–¹å¼ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨åœ¨é¡¹ç›®ä¸­çš„buildSrcæ¨¡å—ä¸­ç¼–å†™æ’ä»¶çš„æ–¹å¼ï¼Œè‡ªå®šä¹‰äº†ä¸€ä¸ªåº”ç”¨äºAndroidé¡¹ç›®çš„æ ¹æ®flavorè¿‡æ»¤soåº“çš„gradleæ’ä»¶ï¼›
æ¦‚è¿° è‡ªå®šä¹‰gradleæ’ä»¶æœ‰å¦‚ä¸‹ä¸‰ç§æ–¹å¼ï¼ˆğŸ”—é“¾æ¥ï¼‰ï¼š
åœ¨buildscriptä¸­ç›´æ¥ç¼–å†™ï¼› åœ¨buildSrcé¡¹ç›®ä¸­ç¼–å†™æ’ä»¶ä»£ç ï¼› åœ¨ç‹¬ç«‹çš„é¡¹ç›®ä¸­ç¼–å†™æ’ä»¶ä»£ç ï¼› è¿™é‡Œæˆ‘ä»¬å°†ä½¿ç”¨buildSrcæ–¹å¼å®ç°ä¸€ä¸ªgradleæ’ä»¶ã€‚
æ–°å»º buildSrc module gradleä¼šåœ¨é¡¹ç›®ä¸­å¯»æ‰¾åç§°ä¸ºbuildSrcæ¨¡å—ï¼Œå°†å…¶åŠ è½½ä¸ºgradleçš„æ’ä»¶ä»£ç ç›®å½•ã€‚æ‰€ä»¥æˆ‘ä»¬ç›´æ¥é€šè¿‡èœå•æ–°å»ºä¸€ä¸ªåä¸º buildSrc çš„java/kotlinæ¨¡å—ã€‚
ç„¶ååœ¨build.gradleä¸­æ·»åŠ ç›¸å…³çš„plugin(java-gradle-plugin)åŠä¾èµ–ï¼š
plugins { id 'java' id 'java-gradle-plugin' id "org.jetbrains.kotlin.jvm" version '1.3.61' } group = "io.github.hanlyjiang.gradle" version = "0.0.2" dependencies { testCompile group: 'junit', name: 'junit', version: '4.12' // æ·»åŠ androidç›¸å…³build toolsä¾èµ–ï¼Œä»¥ä¾¿ä½¿ç”¨ android gradle ç›¸å…³çš„API compile 'com.android.tools.build:gradle:3.2.0' } ç¼–å†™æ’ä»¶ éœ€æ±‚ç®€ä»‹ **åº”ç”¨åœºæ™¯ï¼š**æˆ‘ä»¬çš„äº§å“ä¸­é›†æˆäº†ä¸¤ç§VPN SDKï¼Œä½†æ˜¯å…·ä½“åˆ°æ¯ä¸ªé¡¹ç›®ä¸Šé¢ï¼Œéƒ½åªä¼šè½åœ°åˆ°å…·ä½“çš„ä¸€ç§ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦æ’é™¤å¯¹åº”çš„SDKçš„SOåº“ä»¥å‡å°APPåŒ…å¤§å°ï¼Œä¸åŒçš„åœ°åŒºçš„æ‰“åŒ…é…ç½®é€šè¿‡flavoræ¥è¿›è¡ŒåŒºåˆ†é…ç½®ï¼Œå³æ¯ä¸ªåœ°åŒºä¼šå¯¹åº”ä¸åŒçš„flavorï¼›
éœ€æ±‚æå–ï¼š è¿™é‡Œå®é™…ä¸Šæˆ‘ä»¬éœ€è¦çš„æ˜¯èƒ½å¤Ÿæ ¹æ®flavorï¼Œåœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­ç§»é™¤æŒ‡å®šçš„soæ–‡ä»¶ï¼›
å®ç°æ€è·¯ï¼š
flavoré…ç½®æ–¹å¼ï¼šåœ¨flavorä¸­é…ç½®ä¸€ä¸ªbuildConfigFieldå­—æ®µï¼Œç”¨äºæŒ‡å®šæˆ‘ä»¬çš„flavoréœ€è¦çš„é…ç½®
// é…ç½®VPNç±»å‹ buildConfigField "String", "VPN_TYPE", "\"$VpnType.SANG_FOR\"" æ’ä»¶é…ç½®ï¼šæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªso_excludeé…ç½®æ¥æŒ‡å®šå…·ä½“çš„excludeè§„åˆ™ï¼ŒåŒ…å«ä¸¤ä¸ªå­—æ®µã€‚
buildConfigFieldKey ç”¨äºæŒ‡å®šä¹‹å‰åœ¨flavorä¸­å®šä¹‰çš„é…ç½®ï¼› configMap ä¸ºä¸€ä¸ªé…ç½®è¡¨ï¼ŒæŒ‡å®šä¸Šé¢çš„å­—æ®µå¯å–çš„å€¼ï¼Œå³å¯¹åº”å€¼åº”è¯¥excludeçš„soæ–‡ä»¶åˆ—è¡¨ï¼› so_exclude { /** * ä½¿ç”¨VPN_TYPE æ¥è®¾ç½®soè¿‡æ»¤çš„è§„åˆ™ */ buildConfigFieldKey = "VPN_TYPE" configMap = [ (VpnType.H3C_iNode.name()): [ // æ–°åä¸‰è¿‡æ»¤æ·±ä¿¡æœçš„ "lib/armeabi-v7a/libauth_forward.so", "lib/armeabi-v7a/libhttps.so", "lib/armeabi-v7a/libpkcs12cert.so", "lib/armeabi-v7a/libsvpnservice.so" ], (VpnType.SANG_FOR.name()) : [ // æ·±ä¿¡æœè¿‡æ»¤æ–°åä¸‰çš„ "lib/armeabi-v7a/libies.so", ], (VpnType.NONE.name()) : [ // å¦‚é…ç½®æˆ NONEï¼Œåˆ™è¿‡æ»¤æ‰æ‰€æœ‰çš„VPNçš„ // æ·±ä¿¡æœçš„so "lib/armeabi-v7a/libauth_forward.so", "lib/armeabi-v7a/libhttps.so", "lib/armeabi-v7a/libpkcs12cert.so", "lib/armeabi-v7a/libsvpnservice.so", // inodeçš„so "lib/armeabi-v7a/libies.so", ] ] } å®šä¹‰æ’ä»¶åŠä½¿ç”¨æ’ä»¶ç®€ä»‹ æ’ä»¶éœ€è¦ç»§æ‰¿ org.gradle.api.Pluginï¼Œå¯åœ¨Pluginå¯¹æ„å»ºæµç¨‹è¿›è¡Œè‡ªå®šä¹‰ï¼ˆå¦‚ï¼šåˆ›å»ºä»»åŠ¡ï¼Œå®šä¹‰ä»»åŠ¡å…³ç³»ï¼Œä¿®æ”¹å·²æœ‰ä»»åŠ¡åŠ¨ä½œç­‰ï¼‰ æ’ä»¶å¦‚æœéœ€è¦èƒ½å¤Ÿè¯»å–ä¸€äº›é…ç½®ï¼Œå¯é€šè¿‡ project.extensions.create æ¥ä»build.gradleä¸­æå– å¦‚éœ€åœ¨è‡ªå·±çš„ androidä»£ç æ¨¡å—ä¸­ä½¿ç”¨æ’ä»¶ï¼Œé€šè¿‡ apply plugin: æ’ä»¶ç±»å¼•ç”¨å³å¯ æ’ä»¶å®ç° æ’ä»¶çš„å®ç°å¦‚ä¸‹ï¼š è¯»å– so_exclude é…ç½®ï¼Œå­˜å‚¨åˆ° extensionï¼ˆç±»å‹ä¸º FlavorSoExcludePluginExtension ï¼‰ä¸­ è¯»å– android çš„é…ç½®ï¼Œæ‰¾åˆ° AppExtensionç±»å‹çš„é…ç½®ï¼Œä¹Ÿå°±æ˜¯åº”ç”¨äº† apply application çš„æ¨¡å—çš„é…ç½®ï¼Œæˆ‘ä»¬çš„é¡¹ç›®ä¸­åªæœ‰ä¸€ä¸ªappæ¨¡å—åº”ç”¨æ­¤é…ç½®-å³æˆ‘ä»¬çš„apkæ¨¡å—ï¼› éå†æ‰€æœ‰å˜ä½“ï¼Œè·å–å¯¹åº”å˜ä½“çš„ so_exclude å¯¹åº”çš„é…ç½®å­—æ®µçš„å€¼ï¼Œå»ºç«‹flavoråˆ°é…ç½®å€¼çš„æ˜ å°„è¡¨ï¼› ä¿®æ”¹ packageApplication ä»»åŠ¡ï¼Œè®©å…¶åœ¨æ‰§è¡Œä¹‹å‰å³åˆ é™¤å¾…æ‰“åŒ…ä¸´æ—¶ç›®å½•ä¸­çš„å¯¹åº”soæ–‡ä»¶ï¼› package io.github.hanlyjiang.gradle.plugin.soexclude import com.android.build.gradle.AppExtension import com.android.build.gradle.api.ApkVariantOutput import org.gradle.api.Plugin import org.gradle.api.Project import org.gradle.api.logging.LogLevel import org.gradle.api.logging.Logger import org.gradle.api.logging.Logging import java.io.File /** * so æ’ä»¶çš„ gradle é…ç½®å®ä½“ */ open class FlavorSoExcludePluginExtension { /** * so è¿‡æ»¤é…ç½®è¡¨ */ var configMap: Map&lt;String, List&lt;String>>? = null /** * é…ç½®å­—æ®µçš„åç§° */ var buildConfigFieldKey: String = FlavorSoExcludePlugin.DEFAULT_CONFIG_KEY } /** * flavor so æ‰“åŒ…è¿‡æ»¤é…ç½® * * ## ç”¨æ³•è¯´æ˜ï¼š * * 1. åœ¨build.gradle ä¸­å¼•å…¥æ’ä»¶ &lt;code>apply plugin: FlavorSoExcludePlugin&lt;/code>; * 2. æ·»åŠ  so_exclude é…ç½®æ®µï¼š * * ```groovy * so_exclude { * buildConfigFieldKey = "VPN_TYPE" * configMap = [ * (VpnType.H3C_iNode.name()): [ * "lib/armeabi-v7a/libauth_forward.so", * "lib/armeabi-v7a/libhttps.so", * "lib/armeabi-v7a/libpkcs12cert.so", * "lib/armeabi-v7a/libsvpnservice.so" * ], * (VpnType.SANG_FOR.name()) : [ * "lib/armeabi-v7a/libies.so", * ], * (VpnType.NONE.name()) : [ * // æ·±ä¿¡æœçš„so * "lib/armeabi-v7a/libauth_forward.so", * "lib/armeabi-v7a/libhttps.so", * "lib/armeabi-v7a/libpkcs12cert.so", * "lib/armeabi-v7a/libsvpnservice.so", * // inodeçš„so * "lib/armeabi-v7a/libies.so", * ] * ] *} *``` * 3. åœ¨flavorçš„é…ç½®ä¸­æ·»åŠ  buildConfigField é…ç½®ï¼Œå¦‚ï¼š * ``` * buildConfigField "String", "VPN_TYPE", "\"$VpnType.H3C_iNode\"" * ``` * å…¶ä¸­å­—æ®µçš„åç§°ä¸º ä¹‹å‰ so_exclude ä¸­é…ç½®çš„ `buildConfigFieldKey` å­—æ®µï¼Œå¯¹åº”çš„å€¼ä¸º configMap ä¸­çš„ key ï¼Œå¦‚æ­¤é…ç½®åï¼Œæ‰“åŒ…æ—¶å°±ä¼šå°†configMapå¯¹åº”keyä¸­çš„soåˆ—è¡¨è¿‡æ»¤æ‰ * @author hanlyjiang 09/20/20 2:42 PM * @version 1.0 */ class FlavorSoExcludePlugin : Plugin&lt;Project> { companion object { const val PLUGIN_NAME = "FlavorSoExcludePlugin" const val DEFAULT_CONFIG_KEY = "SO_EXCLUDE" const val DEBUG = false private val logger: Logger = Logging.getLogger(FlavorSoExcludePlugin::class.java) fun logInfo(msg: String) { logger.log(LogLevel.LIFECYCLE, "&lt;- $PLUGIN_NAME: $msg ->") } fun logDebug(msg: String) { if (DEBUG) { logInfo(msg) } } } lateinit var extension: FlavorSoExcludePluginExtension override fun apply(project: Project) { // æ·»åŠ è‡ªå·±çš„é…ç½® extension = project.extensions.create("so_exclude", FlavorSoExcludePluginExtension::class.java) // åˆ›å»ºä¸€ä¸ªæ‰“å°é…ç½®çš„ä»»åŠ¡ï¼Œç”¨äºå®šä¹‰ val task = project.tasks.create("printConfig") task.group = "soExclude-plugin" task.doLast { logInfo("-- é…ç½®å­—æ®µï¼šbuildConfigFieldKey= " + extension.buildConfigFieldKey) logInfo("-- å½“å‰é…ç½®ï¼š") extension.configMap?.run { this.keys.forEach { key -> logInfo("-- config: $key -- ") get(key)?.forEach { logInfo("values: $it") } logInfo("------------------ ") } } } // è·å–androidçš„é…ç½® val androidExtensions = project.extensions.getByName("android") logInfo("" + androidExtensions.javaClass) if (androidExtensions is AppExtension) { // applicatoinç±»å‹çš„å°±è¿›è¡Œä»»åŠ¡å¤„ç† initPackageOptions(project, androidExtensions) } } /** * vpn é…ç½® */ private var configMap: MutableMap&lt;String, String> = HashMap() private fun initPackageOptions(project: Project, android: AppExtension) { project.afterEvaluate { android.productFlavors.all { val flavorName = it.name logDebug("--productFlavors : ${it.name}") var soExcludeConfig = "" it.buildConfigFields[extension.buildConfigFieldKey]?.run { soExcludeConfig = value.replace("\"", "") } logDebug("--productFlavors : $flavorName, soExcludeConfig: $soExcludeConfig") configMap[flavorName] = soExcludeConfig } android.applicationVariants.all { variant -> logDebug("app variant flavorName: ${variant.flavorName}") val flavorName = variant.flavorName val configKey = configMap[flavorName] variant.outputs.forEach { output -> if (output is ApkVariantOutput) { //æ ¸å¿ƒé€»è¾‘ï¼šä¿®æ”¹packageApplicationä»»åŠ¡ï¼Œåœ¨ç”ŸæˆapkåŒ…ä¹‹å‰ï¼Œåˆ é™¤æ‰“åŒ…ä¸´æ—¶ç›®å½•ä¸­çš„soæ–‡ä»¶å³å¯é¿å…æ‰“åŒ…soåˆ°apkä¸­ output.packageApplication.doFirst { output.packageApplication.jniFolders.all { // jniFolder ç›®å½•ä¸ºæœ€åæ‰“åŒ…apkæ—¶ï¼Œç”¨äºå­˜æ”¾soæ–‡ä»¶çš„ä¸´æ—¶ç›®å½• logInfo("å˜ä½“åç§°: ${variant.flavorName} , configKey: ${configKey}, jniFolders: " + it.absoluteFile) handleExclude(it, configKey); true } } } } } } } private fun handleExclude(jniFolder: File?, configKey: String?) { extension.configMap?.run { val soExcludeList: List&lt;String>? = get(configKey) soExcludeList?.run { deleteJniSoFiles(jniFolder, *(soExcludeList.toTypedArray())) } } } private fun deleteJniSoFiles(jniFolder: File?, vararg files: String) { for (item in files) { val file = File(jniFolder, item) if (file.exists()) { val deleteResult = file.delete() logInfo("åˆ é™¤soæ–‡ä»¶ $item : ${if (deleteResult) "æˆåŠŸ" else "å¤±è´¥"}") } } } } ä½¿ç”¨æšä¸¾è¿›è¡Œé…ç½® æˆ‘ä»¬åœ¨buildSrcä¸­å®šä¹‰ä¸€ä¸ªæšä¸¾ç±»ï¼Œç”¨äºçº¦å®šå¯ä»¥é…ç½®çš„å€¼ï¼Œå³å¯ä»¥æ¸…æ™°å®šä¹‰é…ç½®å€¼é¿å…é…ç½®æ—¶ç›´æ¥å†™å­—ç¬¦ä¸²å®¹æ˜“å‡ºé”™ï¼Œåˆå¯ä»¥æ”¯æŒä»£ç è‡ªåŠ¨è¡¥å…¨æ–¹ä¾¿é…ç½®ã€‚
...</p></div><footer class=entry-footer><span title='2020-09-20 10:18:50 +0000 UTC'>September 20, 2020</span>&nbsp;Â·&nbsp;<span>4 min</span>&nbsp;Â·&nbsp;<span>752 words</span>&nbsp;Â·&nbsp;<span>é‡ç”Ÿè²è—•</span></footer><a class=entry-link aria-label="post link to ç¼–å†™ä¸€ä¸ªAndroid Gradleæ’ä»¶" href=https://hanlyjiang.github.io/posts/%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AAandroid-gradle%E6%8F%92%E4%BB%B6/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Android-WebViewä¸­JavaåŒJSçš„äº¤äº’</h2></header><div class=entry-content><p>Androidæä¾›çš„å‡ ç§JSåŒJavaäº¤äº’çš„æ–¹å¼ä»‹ç»ï¼Œé€šè¿‡ä¸€ä¸ªå®ä¾‹ä»‹ç»é€šè¿‡evaluateJavascriptè°ƒç”¨JSæ–¹æ³•ã€‚
Androidæä¾›çš„jsåŸç”Ÿäº¤äº’API Androidè°ƒç”¨ JS ä»£ç ï¼š é€šè¿‡WebViewçš„ loadUrl() é€šè¿‡WebViewçš„ evaluateJavascript() æ–¹æ³• Androidè°ƒç”¨ JS ä»£ç ä¸»è¦ä½¿ç”¨ ç¬¬äºŒç§æ–¹æ³•ã€‚
JS è°ƒç”¨ Android ä»£ç ï¼š é€šè¿‡ WebView çš„ addJavascriptInterface() è¿›è¡Œå¯¹è±¡æ˜ å°„ é€šè¿‡WebChromeClientçš„ onJsAlert() ã€onJsConfirm()ã€onJsPrompt() æ–¹æ³•å›è°ƒæ‹¦æˆªJSå¯¹è¯æ¡†alert()ã€confirm()ã€prompt() æ¶ˆæ¯ é€šè¿‡WebViewClientçš„shouldOverrideUrlLoading() æ–¹æ³•å›è°ƒæ‹¦æˆª url ç¬¬2å’Œç¬¬3ä¸­æ–¹å¼èƒ½åŠ›æœ‰é™ï¼Œæ‰€ä»¥ä¸»è¦æ˜¯ç¬¬ä¸€ç§ã€‚
å®˜æ–¹ç¤ºä¾‹ä»£ç ï¼š
addJavaScriptInterface æ³¨å…¥åŸç”Ÿå¯¹è±¡åˆ°JS + åŸç”Ÿé€šè¿‡loadUrl è°ƒç”¨JSä»£ç 
class JsObject { @JavascriptInterface public String toString() { return "injectedObject"; } } webview.getSettings().setJavaScriptEnabled(true); // æ³¨å…¥Javaå¯¹è±¡åˆ° JavaScript ï¼ŒJSä¸­å¯ä»¥é€šè¿‡ injectedObject æ¥è°ƒç”¨åŸç”Ÿä»£ç  webView.addJavascriptInterface(new JsObject(), "injectedObject"); webView.loadData("", "text/html", null); webView.loadUrl("javascript:alert(injectedObject.toString())"); æ³¨æ„ï¼š
Android 4.2ï¼ˆJELLY BEANï¼‰åŠæ›´é«˜ç‰ˆæœ¬ä¸­åªæœ‰è¢«JavascriptInterfaceæ³¨è§£çš„publicæ–¹æ³•æ‰å¯ä»¥åœ¨jsä¸­è°ƒç”¨ï¼› Android4.2ä»¥ä¸‹è®¾å¤‡ä¸Šï¼Œæ‰€æœ‰publicæ–¹æ³•éƒ½å¯ä»¥è¢«jsè®¿é—®ï¼ˆåŒ…æ‹¬ç»§æ‰¿çš„ï¼‰ é€šè¿‡addJavaScriptInterfaceåŠ å…¥å¯¹è±¡ ï¼š å¿…é¡»åœ¨æ³¨å…¥å¯¹è±¡ä¹‹å‰å¯ç”¨JavaScriptï¼Œå¹¶ä¸”æ³¨å…¥çš„å¯¹è±¡ç›´åˆ°ä¸‹æ¬¡é¡µé¢é‡æ–°åŠ è½½æ‰ä¼šå‡ºç°åœ¨JavaScriptä¸­ã€‚ åº”ç”¨å®ä¾‹ï¼šJavaåŒVueäº¤äº’ æˆ‘ä»¬éœ€è¦åœ¨é¡µé¢åŠ è½½å®Œæ¯•ä¹‹åæ›´æ–°æ•°æ®ï¼Œæ­¤æ—¶éœ€è¦é€šè¿‡Javaä¾§è°ƒç”¨JSçš„æ–¹æ³•æ¥å°†æ•°æ®ä¼ é€’ç»™JSé€šçŸ¥å…¶æ›´æ–°ï¼› é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨JSä¾§å®šä¹‰ä¸€ä¸ªæ¥æ”¶æ•°æ®çš„æ–¹æ³•ï¼Œä¸ºäº†èƒ½è®©Javaä¾§èƒ½æ–¹ä¾¿æ‰¾åˆ°ï¼Œæˆ‘ä»¬å°†æ–¹æ³•å®šä¹‰åˆ°windowå¯¹è±¡ä¸Šã€‚ ç„¶ååœ¨WebViewä¸­é¡µé¢åŠ è½½å®Œæ¯•ï¼ˆonPageFinishedï¼‰åï¼Œè°ƒç”¨ webView.evaluateJavascript æ¥è°ƒç”¨æ­¤JSæ–¹æ³•ï¼›
...</p></div><footer class=entry-footer><span title='2020-03-20 10:18:50 +0000 UTC'>March 20, 2020</span>&nbsp;Â·&nbsp;<span>2 min</span>&nbsp;Â·&nbsp;<span>280 words</span>&nbsp;Â·&nbsp;<span>é‡ç”Ÿè²è—•</span></footer><a class=entry-link aria-label="post link to Android-WebViewä¸­JavaåŒJSçš„äº¤äº’" href=https://hanlyjiang.github.io/posts/android-webview%E4%B8%ADjava%E5%90%8Cjs%E7%9A%84%E4%BA%A4%E4%BA%92/></a></article><footer class=page-footer><nav class=pagination><a class=next href=https://hanlyjiang.github.io/tags/android/page/2/>Next&nbsp;&nbsp;Â»</a></nav></footer></main><footer class=footer><span>&copy; 2025 <a href=https://hanlyjiang.github.io/>æ¸…æ°´æ± å¡˜</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>